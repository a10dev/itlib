%!PS-Adobe-1.0
%%Creator: devps (Pipeline Associates, Inc.)
%%CreationDate: Sat Sep 14 12:48:01 1996
%%Pages: (atend)
%%DocumentFonts: (atend)

/devps 180 dict def devps begin
/res 10.000000 def
/y_offset 843 def
/X{exch}bind def
/mm {transform round X round X itransform} bind def
/r{rmoveto}bind def
/m{moveto}bind def
/l{lineto}bind def
/rl{rlineto}bind def
/st{stroke}bind def
/gs{gsave}bind def
/gr{grestore}bind def
/cp{currentpoint}bind def
/np{newpath}bind def
/ct{curveto}bind def
systemdict /setpacking known
 { /savepacking currentpacking def true setpacking } if
/m0{0 0 moveto}bind def
/xc{//res div}bind def
/yc{//res neg div //y_offset add}bind def
/lc{yc X xc X l st}bind def
/mc{yc X xc X m}bind def
/el{gs /a X def a div 1 X scale cp np a xc 2 div 0 360 arc st gr}bind def
/ar{cp 7 2 roll np xc 5 1 roll atan 3 1 roll atan X arc st}bind def
/sp{yc X xc X 6 2 roll yc X xc X 6 2 roll yc X xc X 6 2 roll ct}bind def
/V{//res neg div //y_offset add
currentpoint pop X
m}bind def
/H{//res div
0 transform X round X itransform pop
currentpoint X pop
moveto}bind def
/h{//res div 0 r}bind def
/v{//res neg div 0 X r}bind def
/S{X H show}bind def
/A{H //res div 1 index stringwidth pop sub 1 index length div 0 3 2 roll ashow}bind def
/psize 10 def
/height 0 def
/cheight { height 0 ne { height } { psize } ifelse } bind def
/slant 0 def
/FF{findfont X dup 30 div 0 mm pop setlinewidth /psize X def
    [psize 0 cheight slant sin slant cos div mul cheight 0 0]
    makefont setfont}bind def
/shade{gs
 /dy X def
 /dx X def
 np m
 0 /dy rl
 /dx 0 rl
 0 /dy neg rl
 /dx neg 0 rl
 closepath
 .9 setgray
 fill
gr}bind def
1 setlinecap

/resolution res 72 mul def


/startFig {
	/SavedState save def
	userdict maxlength dict begin
	currentpoint transform

	DocumentInitState setmiterlimit setgray setdash setlinejoin setlinecap
		setlinewidth setmatrix

	itransform moveto

	/ury exch def
	/urx exch def
	/lly exch def
	/llx exch def
	/y exch 72 mul resolution div def
	/x exch 72 mul resolution div def
	
	currentpoint /cy exch def /cx exch def

	/sx x urx llx sub div def
	/sy y ury lly sub div def

	sx sy scale

	cx sx div llx sub
	cy sy div ury sub translate
	
	/DefFigCTM matrix currentmatrix def

	/initmatrix {
		DefFigCTM setmatrix
	} def
	/defaultmatrix {
		DefFigCTM exch copy
	} def

	/initgraphics {
		DocumentInitState setmiterlimit setgray setdash 
			setlinejoin setlinecap setlinewidth setmatrix
		DefFigCTM setmatrix
	} def

	/showpage {
		initgraphics
	} def

}bind  def
/clipFig {
	currentpoint 6 2 roll
	newpath 4 copy
	4 2 roll moveto
	6 -1 roll exch lineto
	exch lineto
	exch lineto
	closepath clip
	newpath
	moveto
}bind  def
/doclip { llx lly urx ury clipFig } def
/endFig {
	end SavedState restore
}bind  def
/globalstart {
	fontnum psize slant height resolution currentpoint 
	pagesave restore gsave 
}bind  def
/globalend {
	grestore moveto
	/resolution exch def /height exch def
	/slant exch def /psize exch def /fontnum exch def
	F
	/pagesave save def
}bind  def


/fontnum 1 def 
systemdict /setpacking known { savepacking setpacking} if
end
/BP{
save mark devps begin m0
/DocumentInitState [ matrix currentmatrix currentlinewidth currentlinecap
currentlinejoin currentdash currentgray currentmiterlimit ] cvx def
}bind def
/EP{
end cleartomark restore showpage}def
/R{/Times-Roman FF}def
/B{/Times-Bold FF}def
/LST{/LucidaSans-Typewriter FF}def
%%EndProlog
%%Page: 1 1
BP
/slant 0 def
/height 0 def
720 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2111(File:)S
2344(include/ansi.h)S
12 B
4368(1)S
1080 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1170 V
(include/ansi.h)588 2034 A
1260 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1440 V
(00000)210 648 A
1026(/*)S
(The)126 1152 A
(<ansi.h>)336 1320 A
(header)252 1698 A
(attempts)336 1992 A
2370(to)S
(decide)252 2496 A
(whether)294 2790 A
(the)126 3126 A
(compiler)336 3294 A
(has)126 3672 A
(enough)252 3840 A
1530 V
(00001)210 648 A
1068(*)S
(conformance)462 1152 A
1656(to)S
(Standard)336 1782 A
2160(C)S
(for)126 2244 A
(Minix)210 2412 A
2664(to)S
(take)168 2790 A
(advantage)378 3000 A
(of.)126 3420 A
3630(If)S
(so,)126 3756 A
(the)126 3924 A
1620 V
(00002)210 648 A
1068(*)S
(symbol)252 1152 A
(_ANSI)210 1446 A
1698(is)S
(defined)294 1824 A
(\(as)126 2160 A
(31415\).)294 2328 A
(Otherwise)378 2706 A
(_ANSI)210 3126 A
3378(is)S
(not)126 3504 A
(defined)294 3672 A
1710 V
(00003)210 648 A
1068(*)S
(here,)210 1152 A
(but)126 1404 A
1572(it)S
(may)126 1698 A
1866(be)S
(defined)294 1992 A
2328(by)S
(applications)504 2454 A
(that)168 3000 A
(want)168 3210 A
3420(to)S
(bend)168 3546 A
(the)126 3756 A
(rules.)252 3924 A
1800 V
(00004)210 648 A
1068(*)S
(The)126 1152 A
(magic)210 1320 A
(number)252 1572 A
1866(in)S
(the)126 1992 A
(definition)420 2160 A
2622(is)S
2748(to)S
(inhibit)294 2874 A
(unnecessary)462 3210 A
(bending)294 3714 A
1890 V
(00005)210 648 A
1068(*)S
1152(of)S
(the)126 1278 A
(rules.)252 1446 A
(\(For)168 1782 A
(consistency)462 1992 A
(with)168 2496 A
(the)126 2706 A
(new)126 2874 A
('#ifdef)294 3042 A
(_ANSI")252 3378 A
(tests)210 3672 A
3924(in)S
1980 V
(00006)210 648 A
1068(*)S
(the)126 1152 A
(headers,)336 1320 A
(_ANSI)210 1698 A
(should)252 1950 A
(really)252 2244 A
2538(be)S
(defined)294 2664 A
3000(as)S
(nothing,)336 3126 A
(but)126 3504 A
(that)168 3672 A
(would)210 3882 A
2070 V
(00007)210 648 A
1068(*)S
(break)210 1152 A
(many)168 1404 A
(library)294 1614 A
(routines)336 1950 A
(that)168 2328 A
(use)126 2538 A
("#if)168 2706 A
(_ANSI".\))336 2916 A
2160 V
(00008)210 648 A
2250 V
(00009)210 648 A
1068(*)S
1152(If)S
(_ANSI)210 1278 A
(ends)168 1530 A
1740(up)S
(being)210 1866 A
(defined,)336 2118 A
2496(a)S
(macro)210 2580 A
2340 V
(00010)210 648 A
1068(*)S
2430 V
(00011)210 648 A
1068(*)S
(_PROTOTYPE\(function,)840 1362 A
(params\))294 2244 A
2520 V
(00012)210 648 A
1068(*)S
2610 V
(00013)210 648 A
1068(*)S
1152(is)S
(defined.)336 1278 A
(This)168 1698 A
(macro)210 1908 A
(expands)294 2160 A
2496(in)S
(different)378 2622 A
(ways,)210 3042 A
(generating)420 3294 A
(either)252 3756 A
2700 V
(00014)210 648 A
1068(*)S
(ANSI)168 1152 A
(Standard)336 1362 A
1740(C)S
(prototypes)420 1824 A
2286(or)S
(old-style)378 2412 A
(K&R)126 2832 A
(\(Kernighan)420 3000 A
3462(&)S
(Ritchie\))336 3546 A
2790 V
(00015)210 648 A
1068(*)S
(prototypes,)462 1152 A
1656(as)S
(needed.)294 1782 A
(Finally,)336 2160 A
(some)168 2538 A
(programs)336 2748 A
(use)126 3126 A
(_CONST,)294 3294 A
(_VOIDSTAR)378 3630 A
(etc)126 4050 A
2880 V
(00016)210 648 A
1068(*)S
1152(in)S
(such)168 1278 A
1488(a)S
(way)126 1572 A
(that)168 1740 A
(they)168 1950 A
(are)126 2160 A
(portable)336 2328 A
(over)168 2706 A
(both)168 2916 A
(ANSI)168 3126 A
(and)126 3336 A
(K&R)126 3504 A
(compilers.)420 3672 A
2970 V
(00017)210 648 A
1068(*)S
(The)126 1152 A
(appropriate)462 1320 A
(macros)252 1824 A
(are)126 2118 A
(defined)294 2286 A
(here.)210 2622 A
3060 V
(00018)210 648 A
1068(*/)S
3150 V
(00019)210 648 A
3240 V
(00020)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
3330 V
(00021)210 648 A
(#define)294 1026 A
(_ANSI_H)294 1362 A
3420 V
(00022)210 648 A
3510 V
(00023)210 648 A
(#if)126 1026 A
(__STDC__)336 1194 A
1572(==)S
1698(1)S
3600 V
(00024)210 648 A
(#define)294 1026 A
(_ANSI)210 1362 A
(31459)210 2034 A
2370(/*)S
(compiler)336 2496 A
(claims)252 2874 A
(full)168 3168 A
(ANSI)168 3378 A
(conformance)462 3588 A
4092(*/)S
3690 V
(00025)210 648 A
(#endif)252 1026 A
3780 V
(00026)210 648 A
3870 V
(00027)210 648 A
(#ifdef)252 1026 A
(__GNUC__)336 1320 A
3960 V
(00028)210 648 A
(#define)294 1026 A
(_ANSI)210 1362 A
(31459)210 2034 A
2370(/*)S
(gcc)126 2496 A
(conforms)336 2664 A
(enough)252 3042 A
(even)168 3336 A
3546(in)S
(non-ANSI)336 3672 A
(mode)168 4050 A
4260(*/)S
4050 V
(00029)210 648 A
(#endif)252 1026 A
4140 V
(00030)210 648 A
4230 V
(00031)210 648 A
(#ifdef)252 1026 A
(_ANSI)210 1320 A
4320 V
(00032)210 648 A
4410 V
(00033)210 648 A
1026(/*)S
(Keep)168 1152 A
(everything)420 1362 A
(for)126 1824 A
(ANSI)168 1992 A
(prototypes.)462 2202 A
2706(*/)S
4500 V
(00034)210 648 A
(#define)294 1026 A
(_PROTOTYPE\(function,)840 1362 A
(params\))294 2244 A
(function)336 2706 A
(params)252 3084 A
4590 V
(00035)210 648 A
(#define)294 1026 A
(_ARGS\(params\))546 1362 A
(params)252 2706 A
4680 V
(00036)210 648 A
4770 V
(00037)210 648 A
(#define)294 1026 A
(_VOIDSTAR)378 1362 A
(void)168 2034 A
2244(*)S
4860 V
(00038)210 648 A
(#define)294 1026 A
(_VOID)210 1362 A
(void)168 2034 A
4950 V
(00039)210 648 A
(#define)294 1026 A
(_CONST)252 1362 A
(const)210 2034 A
5040 V
(00040)210 648 A
(#define)294 1026 A
(_VOLATILE)378 1362 A
(volatile)336 2034 A
5130 V
(00041)210 648 A
(#define)294 1026 A
(_SIZET)252 1362 A
(size_t)252 2034 A
5220 V
(00042)210 648 A
5310 V
(00043)210 648 A
(#else)210 1026 A
5400 V
(00044)210 648 A
5490 V
(00045)210 648 A
1026(/*)S
(Throw)210 1152 A
(away)168 1404 A
(the)126 1614 A
(parameters)420 1782 A
(for)126 2244 A
(K&R)126 2412 A
(prototypes.)462 2580 A
3084(*/)S
5580 V
(00046)210 648 A
(#define)294 1026 A
(_PROTOTYPE\(function,)840 1362 A
(params\))294 2244 A
(function\(\))420 2706 A
5670 V
(00047)210 648 A
(#define)294 1026 A
(_ARGS\(params\))546 1362 A
2706(\(\))S
5760 V
(00048)210 648 A
5850 V
(00049)210 648 A
(#define)294 1026 A
(_VOIDSTAR)378 1362 A
(void)168 2034 A
2244(*)S
5940 V
(00050)210 648 A
(#define)294 1026 A
(_VOID)210 1362 A
(void)168 2034 A
6030 V
(00051)210 648 A
(#define)294 1026 A
(_CONST)252 1362 A
6120 V
(00052)210 648 A
(#define)294 1026 A
(_VOLATILE)378 1362 A
6210 V
(00053)210 648 A
(#define)294 1026 A
(_SIZET)252 1362 A
(int)126 2034 A
6300 V
(00054)210 648 A
8418 V
EP
%%Page: 2 2
BP
/slant 0 def
/height 0 def
630 V
12 B
648(2)S
11 R
2111(File:)S
2344(include/ansi.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(00055)210 648 A
(#endif)252 1026 A
1320(/*)S
(_ANSI)210 1446 A
1698(*/)S
990 V
(00056)210 648 A
1080 V
(00057)210 648 A
(#endif)252 1026 A
1320(/*)S
(ANSI_H)252 1446 A
1740(*/)S
1440 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1530 V
(include/limits.h)672 2034 A
1620 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1800 V
(00100)210 648 A
1026(/*)S
(The)126 1152 A
(<limits.h>)420 1320 A
(header)252 1782 A
(defines)294 2076 A
(some)168 2412 A
(basic)210 2622 A
(sizes,)252 2874 A
(both)168 3168 A
3378(of)S
(the)126 3504 A
(language)336 3672 A
(types)210 4050 A
1890 V
(00101)210 648 A
1068(*)S
(\(e.g.,)252 1152 A
(the)126 1446 A
(number)252 1614 A
1908(of)S
(bits)168 2034 A
2244(in)S
2370(an)S
(integer\),)378 2496 A
(and)126 2916 A
3084(of)S
(the)126 3210 A
(operating)378 3378 A
(system)252 3798 A
(\(e.g.)210 4092 A
1980 V
(00102)210 648 A
1068(*)S
(the)126 1152 A
(number)252 1320 A
1614(of)S
(characters)420 1740 A
2202(in)S
2328(a)S
(file)168 2412 A
(name.)210 2622 A
2070 V
(00103)210 648 A
1068(*/)S
2160 V
(00104)210 648 A
2250 V
(00105)210 648 A
(#ifndef)294 1026 A
(_LIMITS_H)378 1362 A
2340 V
(00106)210 648 A
(#define)294 1026 A
(_LIMITS_H)378 1362 A
2430 V
(00107)210 648 A
2520 V
(00108)210 648 A
1026(/*)S
(Definitions)462 1152 A
(about)210 1656 A
(chars)210 1908 A
2160(\(8)S
(bits)168 2286 A
2496(in)S
(MINIX,)252 2622 A
(and)126 2916 A
(signed\).)336 3084 A
3462(*/)S
2610 V
(00109)210 648 A
(#define)294 1026 A
(CHAR_BIT)336 1362 A
2160(8)S
2370(/*)S
2496(#)S
(bits)168 2580 A
2790(in)S
2916(a)S
(char)168 3000 A
3210(*/)S
2700 V
(00110)210 648 A
(#define)294 1026 A
(CHAR_MIN)336 1362 A
(-128)168 2034 A
2370(/*)S
(minimum)294 2496 A
(value)210 2832 A
3084(of)S
3210(a)S
(char)168 3294 A
3504(*/)S
2790 V
(00111)210 648 A
(#define)294 1026 A
(CHAR_MAX)336 1362 A
(127)126 2076 A
2370(/*)S
(maximum)294 2496 A
(value)210 2832 A
3084(of)S
3210(a)S
(char)168 3294 A
3504(*/)S
2880 V
(00112)210 648 A
(#define)294 1026 A
(SCHAR_MIN)378 1362 A
(-128)168 2034 A
2370(/*)S
(minimum)294 2496 A
(value)210 2832 A
3084(of)S
3210(a)S
(signed)252 3294 A
(char)168 3588 A
3798(*/)S
2970 V
(00113)210 648 A
(#define)294 1026 A
(SCHAR_MAX)378 1362 A
(127)126 2076 A
2370(/*)S
(maximum)294 2496 A
(value)210 2832 A
3084(of)S
3210(a)S
(signed)252 3294 A
(char)168 3588 A
3798(*/)S
3060 V
(00114)210 648 A
(#define)294 1026 A
(UCHAR_MAX)378 1362 A
(255)126 2076 A
2370(/*)S
(maximum)294 2496 A
(value)210 2832 A
3084(of)S
3210(an)S
(unsigned)336 3336 A
(char)168 3714 A
3924(*/)S
3150 V
(00115)210 648 A
(#define)294 1026 A
(MB_LEN_MAX)420 1362 A
2160(1)S
2370(/*)S
(maximum)294 2496 A
(length)252 2832 A
3126(of)S
3252(a)S
(multibyte)378 3336 A
(char)168 3756 A
3966(*/)S
3240 V
(00116)210 648 A
3330 V
(00117)210 648 A
1026(/*)S
(Definitions)462 1152 A
(about)210 1656 A
(shorts)252 1908 A
(\(16)126 2202 A
(bits)168 2370 A
2580(in)S
(MINIX\).)294 2706 A
3042(*/)S
3420 V
(00118)210 648 A
(#define)294 1026 A
(SHRT_MIN)336 1362 A
(\(-32767-1\))420 1782 A
2370(/*)S
(minimum)294 2496 A
(value)210 2832 A
3084(of)S
3210(a)S
(short)210 3294 A
3546(*/)S
3510 V
(00119)210 648 A
(#define)294 1026 A
(SHRT_MAX)336 1362 A
(32767)210 1992 A
2370(/*)S
(maximum)294 2496 A
(value)210 2832 A
3084(of)S
3210(a)S
(short)210 3294 A
3546(*/)S
3600 V
(00120)210 648 A
(#define)294 1026 A
(USHRT_MAX)378 1362 A
(0xFFFF)252 1950 A
2370(/*)S
(maximum)294 2496 A
(value)210 2832 A
3084(of)S
(unsigned)336 3210 A
(short)210 3588 A
3840(*/)S
3690 V
(00121)210 648 A
3780 V
(00122)210 648 A
1026(/*)S
(_EM_WSIZE)378 1152 A
1572(is)S
1698(a)S
(compiler-generated)756 1782 A
(symbol)252 2580 A
(giving)252 2874 A
(the)126 3168 A
(word)168 3336 A
(size)168 3546 A
3756(in)S
(bytes.)252 3882 A
4176(*/)S
3870 V
(00123)210 648 A
(#if)126 1026 A
(_EM_WSIZE)378 1194 A
1614(==)S
1740(2)S
3960 V
(00124)210 648 A
(#define)294 1026 A
(INT_MIN)294 1362 A
(\(-32767-1\))420 1782 A
2370(/*)S
(minimum)294 2496 A
(value)210 2832 A
3084(of)S
3210(a)S
(16-bit)252 3294 A
(int)126 3588 A
3756(*/)S
4050 V
(00125)210 648 A
(#define)294 1026 A
(INT_MAX)294 1362 A
(32767)210 1992 A
2370(/*)S
(maximum)294 2496 A
(value)210 2832 A
3084(of)S
3210(a)S
(16-bit)252 3294 A
(int)126 3588 A
3756(*/)S
4140 V
(00126)210 648 A
(#define)294 1026 A
(UINT_MAX)336 1362 A
(0xFFFF)252 1950 A
2370(/*)S
(maximum)294 2496 A
(value)210 2832 A
3084(of)S
3210(an)S
(unsigned)336 3336 A
(16-bit)252 3714 A
(int)126 4008 A
4176(*/)S
4230 V
(00127)210 648 A
(#endif)252 1026 A
4320 V
(00128)210 648 A
4410 V
(00129)210 648 A
(#if)126 1026 A
(_EM_WSIZE)378 1194 A
1614(==)S
1740(4)S
4500 V
(00130)210 648 A
(#define)294 1026 A
(INT_MIN)294 1362 A
(\(-2147483647-1\))630 1698 A
2370(/*)S
(minimum)294 2496 A
(value)210 2832 A
3084(of)S
3210(a)S
(32-bit)252 3294 A
(int)126 3588 A
3756(*/)S
4590 V
(00131)210 648 A
(#define)294 1026 A
(INT_MAX)294 1362 A
(2147483647)420 1782 A
2370(/*)S
(maximum)294 2496 A
(value)210 2832 A
3084(of)S
3210(a)S
(32-bit)252 3294 A
(int)126 3588 A
3756(*/)S
4680 V
(00132)210 648 A
(#define)294 1026 A
(UINT_MAX)336 1362 A
(0xFFFFFFFF)420 1782 A
2370(/*)S
(maximum)294 2496 A
(value)210 2832 A
3084(of)S
3210(an)S
(unsigned)336 3336 A
(32-bit)252 3714 A
(int)126 4008 A
4176(*/)S
4770 V
(00133)210 648 A
(#endif)252 1026 A
4860 V
(00134)210 648 A
4950 V
(00135)210 648 A
(/*Definitions)546 1026 A
(about)210 1614 A
(longs)210 1866 A
(\(32)126 2118 A
(bits)168 2286 A
2496(in)S
(MINIX\).)294 2622 A
2958(*/)S
5040 V
(00136)210 648 A
(#define)294 1026 A
(LONG_MIN)336 1362 A
(\(-2147483647L-1\)/*)756 1740 A
(minimum)294 2538 A
(value)210 2874 A
3126(of)S
3252(a)S
(long)168 3336 A
3546(*/)S
5130 V
(00137)210 648 A
(#define)294 1026 A
(LONG_MAX)336 1362 A
(2147483647L)462 1782 A
2370(/*)S
(maximum)294 2496 A
(value)210 2832 A
3084(of)S
3210(a)S
(long)168 3294 A
3504(*/)S
5220 V
(00138)210 648 A
(#define)294 1026 A
(ULONG_MAX)378 1362 A
(0xFFFFFFFFL)462 1782 A
2370(/*)S
(maximum)294 2496 A
(value)210 2832 A
3084(of)S
3210(an)S
(unsigned)336 3336 A
(long)168 3714 A
3924(*/)S
5310 V
(00139)210 648 A
5400 V
(00140)210 648 A
1026(/*)S
(Minimum)294 1152 A
(sizes)210 1488 A
(required)336 1740 A
2118(by)S
(the)126 2244 A
(POSIX)210 2412 A
(P1003.1)294 2664 A
(standard)336 3000 A
(\(Table)252 3378 A
(2-3\).)210 3672 A
3924(*/)S
5490 V
(00141)210 648 A
(#ifdef)252 1026 A
(_POSIX_SOURCE)546 1320 A
2370(/*)S
(these)210 2496 A
(are)126 2748 A
(only)168 2916 A
(visible)294 3126 A
(for)126 3462 A
(POSIX)210 3630 A
3882(*/)S
5580 V
(00142)210 648 A
(#define)294 1026 A
(_POSIX_ARG_MAX)588 1362 A
(4096)168 2118 A
2370(/*)S
(exec\(\))252 2496 A
(may)126 2790 A
(have)168 2958 A
3168(4K)S
(worth)210 3294 A
3546(of)S
(args)168 3672 A
3882(*/)S
5670 V
(00143)210 648 A
(#define)294 1026 A
(_POSIX_CHILD_MAX)672 1362 A
2244(6)S
2370(/*)S
2496(a)S
(process)294 2580 A
(may)126 2916 A
(have)168 3084 A
3294(6)S
(children)336 3378 A
3756(*/)S
5760 V
(00144)210 648 A
(#define)294 1026 A
(_POSIX_LINK_MAX)630 1362 A
2244(8)S
2370(/*)S
2496(a)S
(file)168 2580 A
(may)126 2790 A
(have)168 2958 A
3168(8)S
(links)210 3252 A
3504(*/)S
5850 V
(00145)210 648 A
(#define)294 1026 A
(_POSIX_MAX_CANON)672 1362 A
(255)126 2160 A
2370(/*)S
(size)168 2496 A
2706(of)S
(the)126 2832 A
(canonical)378 3000 A
(input)210 3420 A
(queue)210 3672 A
3924(*/)S
5940 V
(00146)210 648 A
(#define)294 1026 A
(_POSIX_MAX_INPUT)672 1362 A
(255)126 2160 A
2370(/*)S
(you)126 2496 A
(can)126 2664 A
(type)168 2832 A
(255)126 3042 A
(chars)210 3210 A
(ahead)210 3462 A
3714(*/)S
6030 V
(00147)210 648 A
(#define)294 1026 A
(_POSIX_NAME_MAX)630 1362 A
2202(14)S
2370(/*)S
2496(a)S
(file)168 2580 A
(name)168 2790 A
(may)126 3000 A
(have)168 3168 A
3378(14)S
(chars)210 3504 A
3756(*/)S
6120 V
(00148)210 648 A
(#define)294 1026 A
(_POSIX_NGROUPS_MAX)756 1362 A
2244(0)S
2370(/*)S
(supplementary)546 2496 A
(group)210 3084 A
(IDs)126 3336 A
(are)126 3504 A
(optional)336 3672 A
4050(*/)S
6210 V
(00149)210 648 A
(#define)294 1026 A
(_POSIX_OPEN_MAX)630 1362 A
2202(16)S
2370(/*)S
2496(a)S
(process)294 2580 A
(may)126 2916 A
(have)168 3084 A
3294(16)S
(files)210 3420 A
(open)168 3672 A
3882(*/)S
8418 V
EP
%%Page: 3 3
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2074(File:)S
(include/limits.h)694 2307 A
12 B
4368(3)S
900 V
7 LST
(00150)210 648 A
(#define)294 1026 A
(_POSIX_PATH_MAX)630 1362 A
(255)126 2160 A
2370(/*)S
2496(a)S
(pathname)336 2580 A
(may)126 2958 A
(contain)294 3126 A
(255)126 3462 A
(chars)210 3630 A
3882(*/)S
990 V
(00151)210 648 A
(#define)294 1026 A
(_POSIX_PIPE_BUF)630 1362 A
(512)126 2160 A
2370(/*)S
(pipes)210 2496 A
(writes)252 2748 A
3042(of)S
(512)126 3168 A
(bytes)210 3336 A
(must)168 3588 A
3798(be)S
(atomic)252 3924 A
4218(*/)S
1080 V
(00152)210 648 A
(#define)294 1026 A
(_POSIX_STREAM_MAX)714 1362 A
2244(8)S
2370(/*)S
2496(at)S
(least)210 2622 A
2874(8)S
(FILEs)210 2958 A
(can)126 3210 A
3378(be)S
(open)168 3504 A
3714(at)S
(once)168 3840 A
4050(*/)S
1170 V
(00153)210 648 A
(#define)294 1026 A
(_POSIX_TZNAME_MAX)714 1362 A
2244(3)S
2370(/*)S
(time)168 2496 A
(zone)168 2706 A
(names)210 2916 A
(can)126 3168 A
3336(be)S
3462(at)S
(least)210 3588 A
3840(3)S
(chars)210 3924 A
4176(*/)S
1260 V
(00154)210 648 A
(#define)294 1026 A
(_POSIX_SSIZE_MAX)672 1362 A
(32767)210 2076 A
2370(/*)S
(read\(\))252 2496 A
(must)168 2790 A
(support)294 3000 A
(32767)210 3336 A
(byte)168 3588 A
(reads)210 3798 A
4050(*/)S
1350 V
(00155)210 648 A
1440 V
(00156)210 648 A
1026(/*)S
(Values)252 1152 A
(actually)336 1446 A
(implemented)462 1824 A
2328(by)S
(MINIX)210 2454 A
(\(Tables)294 2706 A
(2-4,)168 3042 A
(2-5,)168 3252 A
(2-6,)168 3462 A
(and)126 3672 A
(2-7\).)210 3840 A
4092(*/)S
1530 V
(00157)210 648 A
1026(/*)S
(Some)168 1152 A
1362(of)S
(these)210 1488 A
(old)126 1740 A
(names)210 1908 A
(had)126 2160 A
(better)252 2328 A
2622(be)S
(defined)294 2748 A
(when)168 3084 A
(not)126 3294 A
(POSIX.)252 3462 A
3756(*/)S
1620 V
(00158)210 648 A
(#define)294 1026 A
(_NO_LIMIT)378 1362 A
(100)126 2076 A
2370(/*)S
(arbitrary)378 2496 A
(number;)294 2916 A
(limit)210 3252 A
(not)126 3504 A
(enforced)336 3672 A
4050(*/)S
1710 V
(00159)210 648 A
1800 V
(00160)210 648 A
(#define)294 1026 A
(NGROUPS_MAX)462 1362 A
2160(0)S
2370(/*)S
(supplemental)504 2496 A
(group)210 3042 A
(IDs)126 3294 A
(not)126 3462 A
(available)378 3630 A
4050(*/)S
1890 V
(00161)210 648 A
(#if)126 1026 A
(_EM_WSIZE)378 1194 A
1614(>)S
1698(2)S
1980 V
(00162)210 648 A
(#define)294 1026 A
(ARG_MAX)294 1362 A
(16384)210 1992 A
2370(/*)S
2496(#)S
(bytes)210 2580 A
2832(of)S
(args)168 2958 A
3168(+)S
(environ)294 3252 A
(for)126 3588 A
(exec\(\))252 3756 A
4050(*/)S
2070 V
(00163)210 648 A
(#else)210 1026 A
2160 V
(00164)210 648 A
(#define)294 1026 A
(ARG_MAX)294 1362 A
(4096)168 2034 A
2370(/*)S
(args)168 2496 A
2706(+)S
(environ)294 2790 A
3126(on)S
(small)210 3252 A
(machines)336 3504 A
3882(*/)S
2250 V
(00165)210 648 A
(#endif)252 1026 A
2340 V
(00166)210 648 A
(#define)294 1026 A
(CHILD_MAX)378 1362 A
(_NO_LIMIT)378 1824 A
2370(/*)S
(MINIX)210 2496 A
(does)168 2748 A
(not)126 2958 A
(limit)210 3126 A
(children)336 3378 A
3756(*/)S
2430 V
(00167)210 648 A
(#define)294 1026 A
(OPEN_MAX)336 1362 A
2118(20)S
2370(/*)S
2496(#)S
(open)168 2580 A
(files)210 2790 A
3042(a)S
(process)294 3126 A
(may)126 3462 A
(have)168 3630 A
3840(*/)S
2520 V
(00168)210 648 A
(#define)294 1026 A
(LINK_MAX)336 1362 A
(127)126 2076 A
2370(/*)S
2496(#)S
(links)210 2580 A
2832(a)S
(file)168 2916 A
(may)126 3126 A
(have)168 3294 A
3504(*/)S
2610 V
(00169)210 648 A
(#define)294 1026 A
(MAX_CANON)378 1362 A
(255)126 2076 A
2370(/*)S
(size)168 2496 A
2706(of)S
(the)126 2832 A
(canonical)378 3000 A
(input)210 3420 A
(queue)210 3672 A
3924(*/)S
2700 V
(00170)210 648 A
(#define)294 1026 A
(MAX_INPUT)378 1362 A
(255)126 2076 A
2370(/*)S
(size)168 2496 A
2706(of)S
(the)126 2832 A
(type-ahead)420 3000 A
(buffer)252 3462 A
3756(*/)S
2790 V
(00171)210 648 A
(#define)294 1026 A
(NAME_MAX)336 1362 A
2118(14)S
2370(/*)S
2496(#)S
(chars)210 2580 A
2832(in)S
2958(a)S
(file)168 3042 A
(name)168 3252 A
3462(*/)S
2880 V
(00172)210 648 A
(#define)294 1026 A
(PATH_MAX)336 1362 A
(255)126 2076 A
2370(/*)S
2496(#)S
(chars)210 2580 A
2832(in)S
2958(a)S
(path)168 3042 A
(name)168 3252 A
3462(*/)S
2970 V
(00173)210 648 A
(#define)294 1026 A
(PIPE_BUF)336 1362 A
(7168)168 2034 A
2370(/*)S
2496(#)S
(bytes)210 2580 A
2832(in)S
(atomic)252 2958 A
(write)210 3252 A
3504(to)S
3630(a)S
(pipe)168 3714 A
3924(*/)S
3060 V
(00174)210 648 A
(#define)294 1026 A
(STREAM_MAX)420 1362 A
2118(20)S
2370(/*)S
(must)168 2496 A
2706(be)S
(the)126 2832 A
(same)168 3000 A
3210(as)S
(FOPEN_MAX)378 3336 A
3756(in)S
(stdio.h)294 3882 A
4218(*/)S
3150 V
(00175)210 648 A
(#define)294 1026 A
(TZNAME_MAX)420 1362 A
2160(3)S
2370(/*)S
(maximum)294 2496 A
(bytes)210 2832 A
3084(in)S
3210(a)S
(time)168 3294 A
(zone)168 3504 A
(name)168 3714 A
3924(is)S
4050(3)S
4134(*/)S
3240 V
(00176)210 648 A
(#define)294 1026 A
(SSIZE_MAX)378 1362 A
(32767)210 1992 A
2370(/*)S
(max)126 2496 A
(defined)294 2664 A
(byte)168 3000 A
(count)210 3210 A
(for)126 3462 A
(read\(\))252 3630 A
3924(*/)S
3330 V
(00177)210 648 A
3420 V
(00178)210 648 A
(#endif)252 1026 A
1320(/*)S
(_POSIX_SOURCE)546 1446 A
2034(*/)S
3510 V
(00179)210 648 A
3600 V
(00180)210 648 A
(#endif)252 1026 A
1320(/*)S
(_LIMITS_H)378 1446 A
1866(*/)S
4140 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4230 V
(include/errno.h)630 2034 A
4320 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4500 V
(00200)210 648 A
1026(/*)S
(The)126 1152 A
(<errno.h>)378 1320 A
(header)252 1740 A
(defines)294 2034 A
(the)126 2370 A
(numbers)294 2538 A
2874(of)S
(the)126 3000 A
(various)294 3168 A
(errors)252 3504 A
(that)168 3798 A
(can)126 4008 A
4590 V
(00201)210 648 A
1068(*)S
(occur)210 1152 A
(during)252 1404 A
(program)294 1698 A
(execution.)420 2034 A
(They)168 2538 A
(are)126 2748 A
(visible)294 2916 A
3252(to)S
(user)168 3378 A
(programs)336 3588 A
(and)126 3966 A
4680 V
(00202)210 648 A
1068(*)S
(should)252 1152 A
1446(be)S
(small)210 1572 A
(positive)336 1824 A
(integers.)378 2202 A
(However,)336 2664 A
(they)168 3042 A
(are)126 3252 A
(also)168 3420 A
(used)168 3630 A
(within)252 3840 A
4770 V
(00203)210 648 A
1068(*)S
(MINIX,)252 1152 A
(where)210 1446 A
(they)168 1698 A
(must)168 1908 A
2118(be)S
(negative.)378 2244 A
(For)126 2706 A
(example,)336 2874 A
(the)126 3252 A
(READ)168 3420 A
(system)252 3630 A
(call)168 3924 A
4134(is)S
4860 V
(00204)210 648 A
1068(*)S
(executed)336 1152 A
(internally)420 1530 A
1992(by)S
(calling)294 2118 A
(do_read\(\).)420 2454 A
(This)168 2958 A
(function)336 3168 A
(returns)294 3546 A
(either)252 3882 A
4176(a)S
4950 V
(00205)210 648 A
1068(*)S
(\(negative\))420 1152 A
(error)210 1614 A
(number)252 1866 A
2160(or)S
2286(a)S
(\(positive\))420 2370 A
(number)252 2832 A
3126(of)S
(bytes)210 3252 A
(actually)336 3504 A
(read.)210 3882 A
5040 V
(00206)210 648 A
1068(*)S
5130 V
(00207)210 648 A
1068(*)S
1152(To)S
(solve)210 1278 A
(the)126 1530 A
(problem)294 1698 A
2034(of)S
(having)252 2160 A
(the)126 2454 A
(error)210 2622 A
(numbers)294 2874 A
3210(be)S
(negative)336 3336 A
(inside)252 3714 A
(the)126 4008 A
5220 V
(00208)210 648 A
1068(*)S
(the)126 1152 A
(system)252 1320 A
(and)126 1614 A
(positive)336 1782 A
(outside,)336 2160 A
(the)126 2538 A
(following)378 2706 A
(mechanism)378 3126 A
3546(is)S
(used.)210 3672 A
(All)126 3966 A
(the)126 4134 A
5310 V
(00209)210 648 A
1068(*)S
(definitions)462 1152 A
(are)126 1656 A
(are)126 1824 A
(the)126 1992 A
(form:)210 2160 A
5400 V
(00210)210 648 A
1068(*)S
5490 V
(00211)210 648 A
1068(*)S
(#define)294 1362 A
(EPERM)210 1698 A
(\(_SIGN)252 2370 A
2664(1\))S
5580 V
(00212)210 648 A
1068(*)S
5670 V
(00213)210 648 A
1068(*)S
1152(If)S
(the)126 1278 A
(macro)210 1446 A
(_SYSTEM)294 1698 A
2034(is)S
(defined,)336 2160 A
(then)168 2538 A
(_SIGN)210 2790 A
3042(is)S
(set)126 3168 A
3336(to)S
("-",)168 3462 A
(otherwise)378 3672 A
4092(it)S
4218(is)S
5760 V
(00214)210 648 A
1068(*)S
(set)126 1152 A
1320(to)S
("".)126 1446 A
(Thus)168 1656 A
(when)168 1866 A
(compiling)378 2076 A
(the)126 2496 A
(operating)378 2664 A
(system,)294 3084 A
(the)126 3420 A
(macro)210 3630 A
(_SYSTEM)294 3882 A
5850 V
(00215)210 648 A
1068(*)S
(will)168 1152 A
1362(be)S
(defined,)336 1488 A
(setting)294 1866 A
(EPERM)210 2202 A
2454(to)S
2580(\(-)S
(1\),)126 2706 A
(whereas)294 2874 A
(when)168 3210 A
(when)168 3420 A
(this)168 3630 A
5940 V
(00216)210 648 A
1068(*)S
(file)168 1152 A
1362(is)S
(included)336 1488 A
1866(in)S
1992(an)S
(ordinary)336 2118 A
(user)168 2496 A
(program,)336 2706 A
(EPERM)210 3084 A
(has)126 3336 A
(the)126 3504 A
(value)210 3672 A
3924(\()S
(1\).)126 4008 A
6030 V
(00217)210 648 A
1068(*/)S
6120 V
(00218)210 648 A
6210 V
(00219)210 648 A
(#ifndef)294 1026 A
(_ERRNO_H)336 1362 A
2370(/*)S
(check)210 2496 A
2748(if)S
(<errno.h>)378 2874 A
3294(is)S
(already)294 3420 A
(included)336 3756 A
4134(*/)S
8418 V
EP
%%Page: 4 4
BP
/slant 0 def
/height 0 def
630 V
12 B
648(4)S
11 R
2084(File:)S
2317(include/errno.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(00220)210 648 A
(#define)294 1026 A
(_ERRNO_H)336 1362 A
2370(/*)S
2496(it)S
2622(is)S
(not)126 2748 A
(included;)378 2916 A
(note)168 3336 A
(that)168 3546 A
(fact)168 3756 A
3966(*/)S
990 V
(00221)210 648 A
1080 V
(00222)210 648 A
1026(/*)S
(Now)126 1152 A
(define)252 1320 A
(_SIGN)210 1614 A
1866(as)S
1992("")S
2118(or)S
("-")126 2244 A
(depending)378 2412 A
2832(on)S
(_SYSTEM.)336 2958 A
3336(*/)S
1170 V
(00223)210 648 A
(#ifdef)252 1026 A
(_SYSTEM)294 1320 A
1260 V
(00224)210 648 A
1026(#)S
(define)252 1194 A
(_SIGN)210 1488 A
2076(-)S
1350 V
(00225)210 648 A
1026(#)S
(define)252 1194 A
1488(OK)S
2076(0)S
1440 V
(00226)210 648 A
(#else)210 1026 A
1530 V
(00227)210 648 A
1026(#)S
(define)252 1194 A
(_SIGN)210 1488 A
1620 V
(00228)210 648 A
(#endif)252 1026 A
1710 V
(00229)210 648 A
1800 V
(00230)210 648 A
(extern)252 1026 A
(int)126 1320 A
(errno;)252 1488 A
2454(/*)S
(place)210 2580 A
(where)210 2832 A
(the)126 3084 A
(error)210 3252 A
(numbers)294 3504 A
3840(go)S
3966(*/)S
1890 V
(00231)210 648 A
1980 V
(00232)210 648 A
1026(/*)S
(Here)168 1152 A
(are)126 1362 A
(the)126 1530 A
(numerical)378 1698 A
(values)252 2118 A
2412(of)S
(the)126 2538 A
(error)210 2706 A
(numbers.)336 2958 A
3336(*/)S
2070 V
(00233)210 648 A
(#define)294 1026 A
(_NERROR)294 1362 A
2286(70)S
2454(/*)S
(number)252 2580 A
2874(of)S
(errors)252 3000 A
3294(*/)S
2160 V
(00234)210 648 A
2250 V
(00235)210 648 A
(#define)294 1026 A
(EGENERIC)336 1362 A
(\(_SIGN)252 1950 A
(99\))126 2244 A
2454(/*)S
(generic)294 2580 A
(error)210 2916 A
3168(*/)S
2340 V
(00236)210 648 A
(#define)294 1026 A
(EPERM)210 1362 A
(\(_SIGN)252 1950 A
2286(1\))S
2454(/*)S
(operation)378 2580 A
(not)126 3000 A
(permitted)378 3168 A
3588(*/)S
2430 V
(00237)210 648 A
(#define)294 1026 A
(ENOENT)252 1362 A
(\(_SIGN)252 1950 A
2286(2\))S
2454(/*)S
2580(no)S
(such)168 2706 A
(file)168 2916 A
3126(or)S
(directory)378 3252 A
3672(*/)S
2520 V
(00238)210 648 A
(#define)294 1026 A
(ESRCH)210 1362 A
(\(_SIGN)252 1950 A
2286(3\))S
2454(/*)S
2580(no)S
(such)168 2706 A
(process)294 2916 A
3252(*/)S
2610 V
(00239)210 648 A
(#define)294 1026 A
(EINTR)210 1362 A
(\(_SIGN)252 1950 A
2286(4\))S
2454(/*)S
(interrupted)462 2580 A
(function)336 3084 A
(call)168 3462 A
3672(*/)S
2700 V
(00240)210 648 A
(#define)294 1026 A
(EIO)126 1362 A
(\(_SIGN)252 1950 A
2286(5\))S
2454(/*)S
(input/output)504 2580 A
(error)210 3126 A
3378(*/)S
2790 V
(00241)210 648 A
(#define)294 1026 A
(ENXIO)210 1362 A
(\(_SIGN)252 1950 A
2286(6\))S
2454(/*)S
2580(no)S
(such)168 2706 A
(device)252 2916 A
3210(or)S
(address)294 3336 A
3672(*/)S
2880 V
(00242)210 648 A
(#define)294 1026 A
(E2BIG)210 1362 A
(\(_SIGN)252 1950 A
2286(7\))S
2454(/*)S
(arg)126 2580 A
(list)168 2748 A
(too)126 2958 A
(long)168 3126 A
3336(*/)S
2970 V
(00243)210 648 A
(#define)294 1026 A
(ENOEXEC)294 1362 A
(\(_SIGN)252 1950 A
2286(8\))S
2454(/*)S
(exec)168 2580 A
(format)252 2790 A
(error)210 3084 A
3336(*/)S
3060 V
(00244)210 648 A
(#define)294 1026 A
(EBADF)210 1362 A
(\(_SIGN)252 1950 A
2286(9\))S
2454(/*)S
(bad)126 2580 A
(file)168 2748 A
(descriptor)420 2958 A
3420(*/)S
3150 V
(00245)210 648 A
(#define)294 1026 A
(ECHILD)252 1362 A
(\(_SIGN)252 1950 A
(10\))126 2244 A
2454(/*)S
2580(no)S
(child)210 2706 A
(process)294 2958 A
3294(*/)S
3240 V
(00246)210 648 A
(#define)294 1026 A
(EAGAIN)252 1362 A
(\(_SIGN)252 1950 A
(11\))126 2244 A
2454(/*)S
(resource)336 2580 A
(temporarily)462 2958 A
(unavailable)462 3462 A
3966(*/)S
3330 V
(00247)210 648 A
(#define)294 1026 A
(ENOMEM)252 1362 A
(\(_SIGN)252 1950 A
(12\))126 2244 A
2454(/*)S
(not)126 2580 A
(enough)252 2748 A
(space)210 3042 A
3294(*/)S
3420 V
(00248)210 648 A
(#define)294 1026 A
(EACCES)252 1362 A
(\(_SIGN)252 1950 A
(13\))126 2244 A
2454(/*)S
(permission)420 2580 A
(denied)252 3042 A
3336(*/)S
3510 V
(00249)210 648 A
(#define)294 1026 A
(EFAULT)252 1362 A
(\(_SIGN)252 1950 A
(14\))126 2244 A
2454(/*)S
(bad)126 2580 A
(address)294 2748 A
3084(*/)S
3600 V
(00250)210 648 A
(#define)294 1026 A
(ENOTBLK)294 1362 A
(\(_SIGN)252 1950 A
(15\))126 2244 A
2454(/*)S
(Extension:)420 2580 A
(not)126 3042 A
3210(a)S
(block)210 3294 A
(special)294 3546 A
(file)168 3882 A
4092(*/)S
3690 V
(00251)210 648 A
(#define)294 1026 A
(EBUSY)210 1362 A
(\(_SIGN)252 1950 A
(16\))126 2244 A
2454(/*)S
(resource)336 2580 A
(busy)168 2958 A
3168(*/)S
3780 V
(00252)210 648 A
(#define)294 1026 A
(EEXIST)252 1362 A
(\(_SIGN)252 1950 A
(17\))126 2244 A
2454(/*)S
(file)168 2580 A
(exists)252 2790 A
3084(*/)S
3870 V
(00253)210 648 A
(#define)294 1026 A
(EXDEV)210 1362 A
(\(_SIGN)252 1950 A
(18\))126 2244 A
2454(/*)S
(improper)336 2580 A
(link)168 2958 A
3168(*/)S
3960 V
(00254)210 648 A
(#define)294 1026 A
(ENODEV)252 1362 A
(\(_SIGN)252 1950 A
(19\))126 2244 A
2454(/*)S
2580(no)S
(such)168 2706 A
(device)252 2916 A
3210(*/)S
4050 V
(00255)210 648 A
(#define)294 1026 A
(ENOTDIR)294 1362 A
(\(_SIGN)252 1950 A
(20\))126 2244 A
2454(/*)S
(not)126 2580 A
2748(a)S
(directory)378 2832 A
3252(*/)S
4140 V
(00256)210 648 A
(#define)294 1026 A
(EISDIR)252 1362 A
(\(_SIGN)252 1950 A
(21\))126 2244 A
2454(/*)S
2580(is)S
2706(a)S
(directory)378 2790 A
3210(*/)S
4230 V
(00257)210 648 A
(#define)294 1026 A
(EINVAL)252 1362 A
(\(_SIGN)252 1950 A
(22\))126 2244 A
2454(/*)S
(invalid)294 2580 A
(argument)336 2916 A
3294(*/)S
4320 V
(00258)210 648 A
(#define)294 1026 A
(ENFILE)252 1362 A
(\(_SIGN)252 1950 A
(23\))126 2244 A
2454(/*)S
(too)126 2580 A
(many)168 2748 A
(open)168 2958 A
(files)210 3168 A
3420(in)S
(system)252 3546 A
3840(*/)S
4410 V
(00259)210 648 A
(#define)294 1026 A
(EMFILE)252 1362 A
(\(_SIGN)252 1950 A
(24\))126 2244 A
2454(/*)S
(too)126 2580 A
(many)168 2748 A
(open)168 2958 A
(files)210 3168 A
3420(*/)S
4500 V
(00260)210 648 A
(#define)294 1026 A
(ENOTTY)252 1362 A
(\(_SIGN)252 1950 A
(25\))126 2244 A
2454(/*)S
(inappropriate)546 2580 A
(I/O)126 3168 A
(control)294 3336 A
(operation)378 3672 A
4092(*/)S
4590 V
(00261)210 648 A
(#define)294 1026 A
(ETXTBSY)294 1362 A
(\(_SIGN)252 1950 A
(26\))126 2244 A
2454(/*)S
2580(no)S
(longer)252 2706 A
(used)168 3000 A
3210(*/)S
4680 V
(00262)210 648 A
(#define)294 1026 A
(EFBIG)210 1362 A
(\(_SIGN)252 1950 A
(27\))126 2244 A
2454(/*)S
(file)168 2580 A
(too)126 2790 A
(large)210 2958 A
3210(*/)S
4770 V
(00263)210 648 A
(#define)294 1026 A
(ENOSPC)252 1362 A
(\(_SIGN)252 1950 A
(28\))126 2244 A
2454(/*)S
2580(no)S
(space)210 2706 A
(left)168 2958 A
3168(on)S
(device)252 3294 A
3588(*/)S
4860 V
(00264)210 648 A
(#define)294 1026 A
(ESPIPE)252 1362 A
(\(_SIGN)252 1950 A
(29\))126 2244 A
2454(/*)S
(invalid)294 2580 A
(seek)168 2916 A
3126(*/)S
4950 V
(00265)210 648 A
(#define)294 1026 A
(EROFS)210 1362 A
(\(_SIGN)252 1950 A
(30\))126 2244 A
2454(/*)S
(read-only)378 2580 A
(file)168 3000 A
(system)252 3210 A
3504(*/)S
5040 V
(00266)210 648 A
(#define)294 1026 A
(EMLINK)252 1362 A
(\(_SIGN)252 1950 A
(31\))126 2244 A
2454(/*)S
(too)126 2580 A
(many)168 2748 A
(links)210 2958 A
3210(*/)S
5130 V
(00267)210 648 A
(#define)294 1026 A
(EPIPE)210 1362 A
(\(_SIGN)252 1950 A
(32\))126 2244 A
2454(/*)S
(broken)252 2580 A
(pipe)168 2874 A
3084(*/)S
5220 V
(00268)210 648 A
(#define)294 1026 A
(EDOM)168 1362 A
(\(_SIGN)252 1950 A
(33\))126 2244 A
2454(/*)S
(domain)252 2580 A
(error)210 2874 A
(\(from)210 3378 A
(ANSI)168 3630 A
3840(C)S
(std\))168 3924 A
4134(*/)S
5310 V
(00269)210 648 A
(#define)294 1026 A
(ERANGE)252 1362 A
(\(_SIGN)252 1950 A
(34\))126 2244 A
2454(/*)S
(result)252 2580 A
(too)126 2874 A
(large)210 3042 A
(\(from)210 3378 A
(ANSI)168 3630 A
3840(C)S
(std\))168 3924 A
4134(*/)S
5400 V
(00270)210 648 A
(#define)294 1026 A
(EDEADLK)294 1362 A
(\(_SIGN)252 1950 A
(35\))126 2244 A
2454(/*)S
(resource)336 2580 A
(deadlock)336 2958 A
(avoided)294 3336 A
3672(*/)S
5490 V
(00271)210 648 A
(#define)294 1026 A
(ENAMETOOLONG)504 1362 A
(\(_SIGN)252 1950 A
(36\))126 2244 A
2454(/*)S
(file)168 2580 A
(name)168 2790 A
(too)126 3000 A
(long)168 3168 A
3378(*/)S
5580 V
(00272)210 648 A
(#define)294 1026 A
(ENOLCK)252 1362 A
(\(_SIGN)252 1950 A
(37\))126 2244 A
2454(/*)S
2580(no)S
(locks)210 2706 A
(available)378 2958 A
3378(*/)S
5670 V
(00273)210 648 A
(#define)294 1026 A
(ENOSYS)252 1362 A
(\(_SIGN)252 1950 A
(38\))126 2244 A
2454(/*)S
(function)336 2580 A
(not)126 2958 A
(implemented)462 3126 A
3630(*/)S
5760 V
(00274)210 648 A
(#define)294 1026 A
(ENOTEMPTY)378 1362 A
(\(_SIGN)252 1950 A
(39\))126 2244 A
2454(/*)S
(directory)378 2580 A
(not)126 3000 A
(empty)210 3168 A
3420(*/)S
5850 V
(00275)210 648 A
5940 V
(00276)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(errors)252 1740 A
(relate)252 2034 A
2328(to)S
(networking.)462 2454 A
2958(*/)S
6030 V
(00277)210 648 A
(#define)294 1026 A
(EPACKSIZE)378 1362 A
(\(_SIGN)252 1950 A
(50\))126 2244 A
2454(/*)S
(invalid)294 2580 A
(packet)252 2916 A
(size)168 3210 A
(for)126 3420 A
(some)168 3588 A
(protocol)336 3798 A
4176(*/)S
6120 V
(00278)210 648 A
(#define)294 1026 A
(EOUTOFBUFS)420 1362 A
(\(_SIGN)252 1950 A
(51\))126 2244 A
2454(/*)S
(not)126 2580 A
(enough)252 2748 A
(buffers)294 3042 A
(left)168 3378 A
3588(*/)S
6210 V
(00279)210 648 A
(#define)294 1026 A
(EBADIOCTL)378 1362 A
(\(_SIGN)252 1950 A
(52\))126 2244 A
2454(/*)S
(illegal)294 2580 A
(ioctl)210 2916 A
(for)126 3168 A
(device)252 3336 A
3630(*/)S
8418 V
EP
%%Page: 5 5
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2084(File:)S
2317(include/errno.h)S
12 B
4368(5)S
900 V
7 LST
(00280)210 648 A
(#define)294 1026 A
(EBADMODE)336 1362 A
(\(_SIGN)252 1950 A
(53\))126 2244 A
2454(/*)S
(badmode)294 2580 A
2916(in)S
(ioctl)210 3042 A
3294(*/)S
990 V
(00281)210 648 A
(#define)294 1026 A
(EWOULDBLOCK)462 1362 A
(\(_SIGN)252 1950 A
(54\))126 2244 A
1080 V
(00282)210 648 A
(#define)294 1026 A
(EBADDEST)336 1362 A
(\(_SIGN)252 1950 A
(55\))126 2244 A
2454(/*)S
(not)126 2580 A
2748(a)S
(valid)210 2832 A
(destination)462 3084 A
(address)294 3588 A
3924(*/)S
1170 V
(00283)210 648 A
(#define)294 1026 A
(EDSTNOTRCH)420 1362 A
(\(_SIGN)252 1950 A
(56\))126 2244 A
2454(/*)S
(destination)462 2580 A
(not)126 3084 A
(reachable)378 3252 A
3672(*/)S
1260 V
(00284)210 648 A
(#define)294 1026 A
(EISCONN)294 1362 A
(\(_SIGN)252 1950 A
(57\))126 2244 A
2454(/*)S
(all)126 2580 A
(ready)210 2748 A
(connected)378 3000 A
3420(*/)S
1350 V
(00285)210 648 A
(#define)294 1026 A
(EADDRINUSE)420 1362 A
(\(_SIGN)252 1950 A
(58\))126 2244 A
2454(/*)S
(address)294 2580 A
2916(in)S
(use)126 3042 A
3210(*/)S
1440 V
(00286)210 648 A
(#define)294 1026 A
(ECONNREFUSED)504 1362 A
(\(_SIGN)252 1950 A
(59\))126 2244 A
2454(/*)S
(connection)420 2580 A
(refused)294 3042 A
3378(*/)S
1530 V
(00287)210 648 A
(#define)294 1026 A
(ECONNRESET)420 1362 A
(\(_SIGN)252 1950 A
(60\))126 2244 A
2454(/*)S
(connection)420 2580 A
(reset)210 3042 A
3294(*/)S
1620 V
(00288)210 648 A
(#define)294 1026 A
(ETIMEDOUT)378 1362 A
(\(_SIGN)252 1950 A
(61\))126 2244 A
2454(/*)S
(connection)420 2580 A
(timed)210 3042 A
(out)126 3294 A
3462(*/)S
1710 V
(00289)210 648 A
(#define)294 1026 A
(EURG)168 1362 A
(\(_SIGN)252 1950 A
(62\))126 2244 A
2454(/*)S
(urgent)252 2580 A
(data)168 2874 A
(present)294 3084 A
3420(*/)S
1800 V
(00290)210 648 A
(#define)294 1026 A
(ENOURG)252 1362 A
(\(_SIGN)252 1950 A
(63\))126 2244 A
2454(/*)S
2580(no)S
(urgent)252 2706 A
(data)168 3000 A
(present)294 3210 A
3546(*/)S
1890 V
(00291)210 648 A
(#define)294 1026 A
(ENOTCONN)336 1362 A
(\(_SIGN)252 1950 A
(64\))126 2244 A
2454(/*)S
2580(no)S
(connection)420 2706 A
(\(yet)168 3168 A
3378(or)S
(anymore\))336 3504 A
3882(*/)S
1980 V
(00292)210 648 A
(#define)294 1026 A
(ESHUTDOWN)378 1362 A
(\(_SIGN)252 1950 A
(65\))126 2244 A
2454(/*)S
2580(a)S
(write)210 2664 A
(call)168 2916 A
3126(to)S
3252(a)S
(shutdown)336 3336 A
(connection)420 3714 A
4176(*/)S
2070 V
(00293)210 648 A
(#define)294 1026 A
(ENOCONN)294 1362 A
(\(_SIGN)252 1950 A
(66\))126 2244 A
2454(/*)S
2580(no)S
(such)168 2706 A
(connection)420 2916 A
3378(*/)S
2160 V
(00294)210 648 A
2250 V
(00295)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(are)126 1740 A
(not)126 1908 A
(POSIX)210 2076 A
(errors,)294 2328 A
(but)126 2664 A
(they)168 2832 A
(can)126 3042 A
(still)210 3210 A
(happen.)294 3462 A
3798(*/)S
2340 V
(00296)210 648 A
(#define)294 1026 A
(ELOCKED)294 1362 A
(\(_SIGN)252 1908 A
(101\))168 2202 A
2454(/*)S
(can't)210 2580 A
(send)168 2832 A
(message)294 3042 A
3378(*/)S
2430 V
(00297)210 648 A
(#define)294 1026 A
(EBADCALL)336 1362 A
(\(_SIGN)252 1908 A
(102\))168 2202 A
2454(/*)S
(error)210 2580 A
2832(on)S
(send/receive)504 2958 A
3504(*/)S
2520 V
(00298)210 648 A
2610 V
(00299)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(error)210 1740 A
(codes)210 1992 A
(are)126 2244 A
(generated)378 2412 A
2832(by)S
(the)126 2958 A
(kernel)252 3126 A
(itself.)294 3420 A
3756(*/)S
2700 V
(00300)210 648 A
(#ifdef)252 1026 A
(_SYSTEM)294 1320 A
2790 V
(00301)210 648 A
(#define)294 1026 A
(E_BAD_DEST)420 1362 A
(-1001)210 1992 A
2370(/*)S
(destination)462 2496 A
(address)294 3000 A
(illegal)294 3336 A
3672(*/)S
2880 V
(00302)210 648 A
(#define)294 1026 A
(E_BAD_SRC)378 1362 A
(-1002)210 1992 A
2370(/*)S
(source)252 2496 A
(address)294 2790 A
(illegal)294 3126 A
3462(*/)S
2970 V
(00303)210 648 A
(#define)294 1026 A
(E_TRY_AGAIN)462 1362 A
(-1003)210 1992 A
2370(/*)S
(can't)210 2496 A
(send--)252 2748 A
(tables)252 3042 A
(full)168 3336 A
3546(*/)S
3060 V
(00304)210 648 A
(#define)294 1026 A
(E_OVERRUN)378 1362 A
(-1004)210 1992 A
2370(/*)S
(interrupt)378 2496 A
(for)126 2916 A
(task)168 3084 A
(that)168 3294 A
3504(is)S
(not)126 3630 A
(waiting)294 3798 A
4134(*/)S
3150 V
(00305)210 648 A
(#define)294 1026 A
(E_BAD_BUF)378 1362 A
(-1005)210 1992 A
2370(/*)S
(message)294 2496 A
(buf)126 2832 A
(outside)294 3000 A
(caller's)336 3336 A
(addr)168 3714 A
(space)210 3924 A
4176(*/)S
3240 V
(00306)210 648 A
(#define)294 1026 A
(E_TASK)252 1362 A
(-1006)210 1992 A
2370(/*)S
(can't)210 2496 A
(send)168 2748 A
2958(to)S
(task)168 3084 A
3294(*/)S
3330 V
(00307)210 648 A
(#define)294 1026 A
(E_NO_MESSAGE)504 1362 A
(-1007)210 1992 A
2370(/*)S
(RECEIVE)294 2496 A
(failed:)294 2832 A
3168(no)S
(message)294 3294 A
(present)294 3630 A
3966(*/)S
3420 V
(00308)210 648 A
(#define)294 1026 A
(E_NO_PERM)378 1362 A
(-1008)210 1992 A
2370(/*)S
(ordinary)336 2496 A
(users)210 2874 A
(can't)210 3126 A
(send)168 3378 A
3588(to)S
(tasks)210 3714 A
3966(*/)S
3510 V
(00309)210 648 A
(#define)294 1026 A
(E_BAD_FCN)378 1362 A
(-1009)210 1992 A
2370(/*)S
(only)168 2496 A
(valid)210 2706 A
(fcns)168 2958 A
(are)126 3168 A
(SEND,)210 3336 A
(RECEIVE,)336 3588 A
(BOTH)168 3966 A
4176(*/)S
3600 V
(00310)210 648 A
(#define)294 1026 A
(E_BAD_ADDR)420 1362 A
(-1010)210 1992 A
2370(/*)S
(bad)126 2496 A
(address)294 2664 A
(given)210 3000 A
3252(to)S
(utility)294 3378 A
(routine)294 3714 A
4050(*/)S
3690 V
(00311)210 648 A
(#define)294 1026 A
(E_BAD_PROC)420 1362 A
(-1011)210 1992 A
2370(/*)S
(bad)126 2496 A
(proc)168 2664 A
(number)252 2874 A
(given)210 3168 A
3420(to)S
(utility)294 3546 A
3882(*/)S
3780 V
(00312)210 648 A
(#endif)252 1026 A
1320(/*)S
(_SYSTEM)294 1446 A
1782(*/)S
3870 V
(00313)210 648 A
3960 V
(00314)210 648 A
(#endif)252 1026 A
1320(/*)S
(_ERRNO_H)336 1446 A
1824(*/)S
4590 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4680 V
(include/unistd.h)672 2034 A
4770 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4950 V
(00400)210 648 A
1026(/*)S
(The)126 1152 A
(<unistd.h>)420 1320 A
(header)252 1782 A
(contains)336 2076 A
2454(a)S
(few)126 2538 A
(miscellaneous)546 2706 A
(manifest)336 3294 A
(constants.)420 3672 A
4134(*/)S
5040 V
(00401)210 648 A
5130 V
(00402)210 648 A
(#ifndef)294 1026 A
(_UNISTD_H)378 1362 A
5220 V
(00403)210 648 A
(#define)294 1026 A
(_UNISTD_H)378 1362 A
5310 V
(00404)210 648 A
5400 V
(00405)210 648 A
1026(/*)S
(POSIX)210 1152 A
(requires)336 1404 A
(size_t)252 1782 A
(and)126 2076 A
(ssize_t)294 2244 A
2580(in)S
(<unistd.h>)420 2706 A
(and)126 3168 A
(elsewhere.)420 3336 A
3798(*/)S
5490 V
(00406)210 648 A
(#ifndef)294 1026 A
(_SIZE_T)294 1362 A
5580 V
(00407)210 648 A
(#define)294 1026 A
(_SIZE_T)294 1362 A
5670 V
(00408)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(size_t;)294 1908 A
5760 V
(00409)210 648 A
(#endif)252 1026 A
5850 V
(00410)210 648 A
5940 V
(00411)210 648 A
(#ifndef)294 1026 A
(_SSIZE_T)336 1362 A
6030 V
(00412)210 648 A
(#define)294 1026 A
(_SSIZE_T)336 1362 A
6120 V
(00413)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(ssize_t;)336 1530 A
6210 V
(00414)210 648 A
(#endif)252 1026 A
8418 V
EP
%%Page: 6 6
BP
/slant 0 def
/height 0 def
630 V
12 B
648(6)S
11 R
2066(File:)S
2299(include/unistd.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(00415)210 648 A
990 V
(00416)210 648 A
1026(/*)S
(Values)252 1152 A
(used)168 1446 A
1656(by)S
(access\(\).)378 1782 A
(POSIX)210 2244 A
(Table)210 2496 A
(2-8.)168 2748 A
2958(*/)S
1080 V
(00417)210 648 A
(#define)294 1026 A
(F_OK)168 1362 A
2160(0)S
2370(/*)S
(test)168 2496 A
2706(if)S
(file)168 2832 A
(exists)252 3042 A
3336(*/)S
1170 V
(00418)210 648 A
(#define)294 1026 A
(X_OK)168 1362 A
2160(1)S
2370(/*)S
(test)168 2496 A
2706(if)S
(file)168 2832 A
3042(is)S
(executable)420 3168 A
3630(*/)S
1260 V
(00419)210 648 A
(#define)294 1026 A
(W_OK)168 1362 A
2160(2)S
2370(/*)S
(test)168 2496 A
2706(if)S
(file)168 2832 A
3042(is)S
(writable)336 3168 A
3546(*/)S
1350 V
(00420)210 648 A
(#define)294 1026 A
(R_OK)168 1362 A
2160(4)S
2370(/*)S
(test)168 2496 A
2706(if)S
(file)168 2832 A
3042(is)S
(readable)336 3168 A
3546(*/)S
1440 V
(00421)210 648 A
1530 V
(00422)210 648 A
1026(/*)S
(Values)252 1152 A
(used)168 1446 A
(for)126 1656 A
(whence)252 1824 A
2118(in)S
(lseek\(fd,)378 2244 A
(offset,)294 2664 A
(whence\).)336 3000 A
(POSIX)210 3420 A
(Table)210 3672 A
(2-9.)168 3924 A
4134(*/)S
1620 V
(00423)210 648 A
(#define)294 1026 A
(SEEK_SET)336 1362 A
2160(0)S
2370(/*)S
(offset)252 2496 A
2790(is)S
(absolute)336 2916 A
3336(*/)S
1710 V
(00424)210 648 A
(#define)294 1026 A
(SEEK_CUR)336 1362 A
2160(1)S
2370(/*)S
(offset)252 2496 A
2790(is)S
(relative)336 2916 A
3294(to)S
(current)294 3420 A
(position)336 3756 A
4134(*/)S
1800 V
(00425)210 648 A
(#define)294 1026 A
(SEEK_END)336 1362 A
2160(2)S
2370(/*)S
(offset)252 2496 A
2790(is)S
(relative)336 2916 A
3294(to)S
(end)126 3420 A
3588(of)S
(file)168 3714 A
3924(*/)S
1890 V
(00426)210 648 A
1980 V
(00427)210 648 A
1026(/*)S
(This)168 1152 A
(value)210 1362 A
1614(is)S
(required)336 1740 A
2118(by)S
(POSIX)210 2244 A
(Table)210 2496 A
(2-10.)210 2748 A
3000(*/)S
2070 V
(00428)210 648 A
(#define)294 1026 A
(_POSIX_VERSION)588 1362 A
(199009L)294 1992 A
2370(/*)S
(which)210 2496 A
(standard)336 2748 A
3126(is)S
(being)210 3252 A
(conformed)378 3504 A
3924(to)S
4050(*/)S
2160 V
(00429)210 648 A
2250 V
(00430)210 648 A
1026(/*)S
(These)210 1152 A
(three)210 1404 A
(definitions)462 1656 A
(are)126 2160 A
(required)336 2328 A
2706(by)S
(POSIX)210 2832 A
(Sec.)168 3084 A
(8.2.1.2.)336 3294 A
3672(*/)S
2340 V
(00431)210 648 A
(#define)294 1026 A
(STDIN_FILENO)504 1362 A
2160(0)S
2370(/*)S
(file)168 2496 A
(descriptor)420 2706 A
(for)126 3168 A
(stdin)210 3336 A
3588(*/)S
2430 V
(00432)210 648 A
(#define)294 1026 A
(STDOUT_FILENO)546 1362 A
2160(1)S
2370(/*)S
(file)168 2496 A
(descriptor)420 2706 A
(for)126 3168 A
(stdout)252 3336 A
3630(*/)S
2520 V
(00433)210 648 A
(#define)294 1026 A
(STDERR_FILENO)546 1362 A
2160(2)S
2370(/*)S
(file)168 2496 A
(descriptor)420 2706 A
(for)126 3168 A
(stderr)252 3336 A
3630(*/)S
2610 V
(00434)210 648 A
2700 V
(00435)210 648 A
(#ifdef)252 1026 A
(_MINIX)252 1320 A
2790 V
(00436)210 648 A
1026(/*)S
(How)126 1152 A
1320(to)S
(exit)168 1446 A
(the)126 1656 A
(system.)294 1824 A
2160(*/)S
2880 V
(00437)210 648 A
(#define)294 1026 A
(RBT_HALT)336 1362 A
2160(0)S
2970 V
(00438)210 648 A
(#define)294 1026 A
(RBT_REBOOT)420 1362 A
2160(1)S
3060 V
(00439)210 648 A
(#define)294 1026 A
(RBT_PANIC)378 1362 A
2160(2)S
2370(/*)S
(for)126 2496 A
(servers)294 2664 A
3000(*/)S
3150 V
(00440)210 648 A
(#define)294 1026 A
(RBT_MONITOR)462 1362 A
2160(3)S
2370(/*)S
(let)126 2496 A
(the)126 2664 A
(monitor)294 2832 A
3168(do)S
(this)168 3294 A
3504(*/)S
3240 V
(00441)210 648 A
(#define)294 1026 A
(RBT_RESET)378 1362 A
2160(4)S
2370(/*)S
(hard)168 2496 A
(reset)210 2706 A
(the)126 2958 A
(system)252 3126 A
3420(*/)S
3330 V
(00442)210 648 A
(#endif)252 1026 A
3420 V
(00443)210 648 A
3510 V
(00444)210 648 A
1026(/*)S
(NULL)168 1152 A
(must)168 1362 A
1572(be)S
(defined)294 1698 A
2034(in)S
(<unistd.h>)420 2160 A
(according)378 2622 A
3042(to)S
(POSIX)210 3168 A
(Sec.)168 3420 A
(2.7.1.)252 3630 A
3924(*/)S
3600 V
(00445)210 648 A
(#define)294 1026 A
(NULL)168 1362 A
(\(\(void)252 1698 A
(*\)0\))168 1992 A
3690 V
(00446)210 648 A
3780 V
(00447)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(relate)252 1740 A
2034(to)S
(configurable)504 2160 A
(system)252 2706 A
(variables.)420 3000 A
(POSIX)210 3462 A
(Table)210 3714 A
(4-2.)168 3966 A
4176(*/)S
3870 V
(00448)210 648 A
(#define)294 1026 A
(_SC_ARG_MAX)462 1362 A
2370(1)S
3960 V
(00449)210 648 A
(#define)294 1026 A
(_SC_CHILD_MAX)546 1362 A
2370(2)S
4050 V
(00450)210 648 A
(#define)294 1026 A
(_SC_CLOCKS_PER_SEC)756 1362 A
2370(3)S
4140 V
(00451)210 648 A
(#define)294 1026 A
(_SC_CLK_TCK)462 1362 A
2370(3)S
4230 V
(00452)210 648 A
(#define)294 1026 A
(_SC_NGROUPS_MAX)630 1362 A
2370(4)S
4320 V
(00453)210 648 A
(#define)294 1026 A
(_SC_OPEN_MAX)504 1362 A
2370(5)S
4410 V
(00454)210 648 A
(#define)294 1026 A
(_SC_JOB_CONTROL)630 1362 A
2370(6)S
4500 V
(00455)210 648 A
(#define)294 1026 A
(_SC_SAVED_IDS)546 1362 A
2370(7)S
4590 V
(00456)210 648 A
(#define)294 1026 A
(_SC_VERSION)462 1362 A
2370(8)S
4680 V
(00457)210 648 A
(#define)294 1026 A
(_SC_STREAM_MAX)588 1362 A
2370(9)S
4770 V
(00458)210 648 A
(#define)294 1026 A
(_SC_TZNAME_MAX)588 1362 A
2328(10)S
4860 V
(00459)210 648 A
4950 V
(00460)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(relate)252 1740 A
2034(to)S
(configurable)504 2160 A
(pathname)336 2706 A
(variables.)420 3084 A
(POSIX)210 3546 A
(Table)210 3798 A
(5-2.)168 4050 A
4260(*/)S
5040 V
(00461)210 648 A
(#define)294 1026 A
(_PC_LINK_MAX)504 1362 A
2370(1)S
2706(/*)S
(link)168 2832 A
(count)210 3042 A
3294(*/)S
5130 V
(00462)210 648 A
(#define)294 1026 A
(_PC_MAX_CANON)546 1362 A
2370(2)S
2706(/*)S
(size)168 2832 A
3042(of)S
(the)126 3168 A
(canonical)378 3336 A
(input)210 3756 A
(queue)210 4008 A
4260(*/)S
5220 V
(00463)210 648 A
(#define)294 1026 A
(_PC_MAX_INPUT)546 1362 A
2370(3)S
2706(/*)S
(type-ahead)420 2832 A
(buffer)252 3294 A
(size)168 3588 A
3798(*/)S
5310 V
(00464)210 648 A
(#define)294 1026 A
(_PC_NAME_MAX)504 1362 A
2370(4)S
2706(/*)S
(file)168 2832 A
(name)168 3042 A
(size)168 3252 A
3462(*/)S
5400 V
(00465)210 648 A
(#define)294 1026 A
(_PC_PATH_MAX)504 1362 A
2370(5)S
2706(/*)S
(pathname)336 2832 A
(size)168 3210 A
3420(*/)S
5490 V
(00466)210 648 A
(#define)294 1026 A
(_PC_PIPE_BUF)504 1362 A
2370(6)S
2706(/*)S
(pipe)168 2832 A
(size)168 3042 A
3252(*/)S
5580 V
(00467)210 648 A
(#define)294 1026 A
(_PC_NO_TRUNC)504 1362 A
2370(7)S
2706(/*)S
(treatment)378 2832 A
3252(of)S
(long)168 3378 A
(name)168 3588 A
(components)420 3798 A
4260(*/)S
5670 V
(00468)210 648 A
(#define)294 1026 A
(_PC_VDISABLE)504 1362 A
2370(8)S
2706(/*)S
(tty)126 2832 A
(disable)294 3000 A
3336(*/)S
5760 V
(00469)210 648 A
(#define)294 1026 A
(_PC_CHOWN_RESTRICTED)840 1362 A
2370(9)S
2706(/*)S
(chown)210 2832 A
(restricted)420 3084 A
3546(or)S
(not)126 3672 A
3840(*/)S
5850 V
(00470)210 648 A
5940 V
(00471)210 648 A
1026(/*)S
(POSIX)210 1152 A
(defines)294 1404 A
(several)294 1740 A
(options)294 2076 A
(that)168 2412 A
(may)126 2622 A
2790(be)S
(implemented)462 2916 A
3420(or)S
(not,)168 3546 A
3756(at)S
(the)126 3882 A
6030 V
(00472)210 648 A
1068(*)S
(implementer's)546 1152 A
(whim.)210 1740 A
(This)168 2034 A
(implementer)462 2244 A
(has)126 2748 A
(made)168 2916 A
(the)126 3126 A
(following)378 3294 A
(choices:)336 3714 A
6120 V
(00473)210 648 A
1068(*)S
6210 V
(00474)210 648 A
1068(*)S
(_POSIX_JOB_CONTROL)756 1152 A
(not)126 2202 A
(defined:)336 2370 A
3042(no)S
(job)126 3168 A
(control)294 3336 A
8418 V
EP
%%Page: 7 7
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2066(File:)S
2299(include/unistd.h)S
12 B
4368(7)S
900 V
7 LST
(00475)210 648 A
1068(*)S
(_POSIX_SAVED_IDS)672 1152 A
(not)126 2202 A
(defined:)336 2370 A
3042(no)S
(saved)210 3168 A
(uid/gid)294 3420 A
990 V
(00476)210 648 A
1068(*)S
(_POSIX_NO_TRUNC)630 1152 A
(defined)294 2202 A
2538(as)S
(-1:)126 2664 A
(long)168 3042 A
(path)168 3252 A
(names)210 3462 A
(are)126 3714 A
(truncated)378 3882 A
1080 V
(00477)210 648 A
1068(*)S
(_POSIX_CHOWN_RESTRICTED)966 1152 A
(defined:)336 2202 A
(you)126 3042 A
(can't)210 3210 A
(give)168 3462 A
(away)168 3672 A
(files)210 3882 A
1170 V
(00478)210 648 A
1068(*)S
(_POSIX_VDISABLE)630 1152 A
(defined:)336 2202 A
(tty)126 3042 A
(functions)378 3210 A
(can)126 3630 A
3798(be)S
(disabled)336 3924 A
1260 V
(00479)210 648 A
1068(*/)S
1350 V
(00480)210 648 A
(#define)294 1026 A
(_POSIX_NO_TRUNC)630 1362 A
(\(-1\))168 2286 A
1440 V
(00481)210 648 A
(#define)294 1026 A
(_POSIX_CHOWN_RESTRICTED)966 1362 A
2412(1)S
1530 V
(00482)210 648 A
1620 V
(00483)210 648 A
1026(/*)S
(Function)336 1152 A
(Prototypes.)462 1530 A
2034(*/)S
1710 V
(00484)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
1800 V
(00485)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
1890 V
(00486)210 648 A
(#endif)252 1026 A
1980 V
(00487)210 648 A
2070 V
(00488)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(_exit,)252 1740 A
(\(int)168 2034 A
(_status\))336 2244 A
4050(\);)S
2160 V
(00489)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(access,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_path,)294 2538 A
(int)126 2874 A
(_amode\))294 3042 A
4050(\);)S
2250 V
(00490)210 648 A
(_PROTOTYPE\()462 1026 A
(unsigned)336 1530 A
(int)126 1908 A
(alarm,)252 2076 A
(\(unsigned)378 2370 A
(int)126 2790 A
(_seconds\))378 2958 A
4050(\);)S
2340 V
(00491)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(chdir,)252 1698 A
(\(const)252 1992 A
(char)168 2286 A
(*_path\))294 2496 A
4050(\);)S
2430 V
(00492)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(chown,)252 1698 A
(\(const)252 1992 A
(char)168 2286 A
(*_path,)294 2496 A
(Uid_t)210 2832 A
(_owner,)294 3084 A
(Gid_t)210 3420 A
(_group\))294 3672 A
4050(\);)S
2520 V
(00493)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(close,)252 1698 A
(\(int)168 1992 A
(_fd\))168 2202 A
4050(\);)S
2610 V
(00494)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*ctermid,)378 1740 A
(\(char)210 2160 A
(*_s\))168 2412 A
4050(\);)S
2700 V
(00495)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*cuserid,)378 1740 A
(\(char)210 2160 A
(*_s\))168 2412 A
4050(\);)S
2790 V
(00496)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(dup,)168 1698 A
(\(int)168 1908 A
(_fd\))168 2118 A
4050(\);)S
2880 V
(00497)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(dup2,)210 1698 A
(\(int)168 1950 A
(_fd,)168 2160 A
(int)126 2370 A
(_fd2\))210 2538 A
4050(\);)S
2970 V
(00498)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(execl,)252 1698 A
(\(const)252 1992 A
(char)168 2286 A
(*_path,)294 2496 A
(const)210 2832 A
(char)168 3084 A
(*_arg,)252 3294 A
(...\))168 3588 A
4050(\);)S
3060 V
(00499)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(execle,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_path,)294 2538 A
(const)210 2874 A
(char)168 3126 A
(*_arg,)252 3336 A
(...\))168 3630 A
4050(\);)S
3150 V
(00500)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(execlp,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_file,)294 2538 A
(const)210 2874 A
(char)168 3126 A
(*arg,)210 3336 A
(...\))168 3588 A
4050(\);)S
3240 V
(00501)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(execv,)252 1698 A
(\(const)252 1992 A
(char)168 2286 A
(*_path,)294 2496 A
(char)168 2832 A
(*const)252 3042 A
(_argv[]\))336 3336 A
4050(\);)S
3330 V
(00502)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(execve,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_path,)294 2538 A
(char)168 2874 A
(*const)252 3084 A
(_argv[],)336 3378 A
3420 V
(00503)210 648 A
(char)168 3042 A
(*const)252 3252 A
(_envp[]\))336 3546 A
4050(\);)S
3510 V
(00504)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(execvp,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_file,)294 2538 A
(char)168 2874 A
(*const)252 3084 A
(_argv[]\))336 3378 A
4050(\);)S
3600 V
(00505)210 648 A
(_PROTOTYPE\()462 1026 A
(pid_t)210 1530 A
(fork,)210 1782 A
(\(void\))252 2034 A
4050(\);)S
3690 V
(00506)210 648 A
(_PROTOTYPE\()462 1026 A
(long)168 1530 A
(fpathconf,)420 1740 A
(\(int)168 2202 A
(_fd,)168 2412 A
(int)126 2622 A
(_name\))252 2790 A
4050(\);)S
3780 V
(00507)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*getcwd,)336 1740 A
(\(char)210 2118 A
(*_buf,)252 2370 A
(size_t)252 2664 A
(_size\))252 2958 A
4050(\);)S
3870 V
(00508)210 648 A
(_PROTOTYPE\()462 1026 A
(gid_t)210 1530 A
(getegid,)336 1782 A
(\(void\))252 2160 A
4050(\);)S
3960 V
(00509)210 648 A
(_PROTOTYPE\()462 1026 A
(uid_t)210 1530 A
(geteuid,)336 1782 A
(\(void\))252 2160 A
4050(\);)S
4050 V
(00510)210 648 A
(_PROTOTYPE\()462 1026 A
(gid_t)210 1530 A
(getgid,)294 1782 A
(\(void\))252 2118 A
4050(\);)S
4140 V
(00511)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(getgroups,)420 1698 A
(\(int)168 2160 A
(_gidsetsize,)504 2370 A
(gid_t)210 2916 A
(_grouplist[]\))546 3168 A
4050(\);)S
4230 V
(00512)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*getlogin,)420 1740 A
(\(void\))252 2202 A
4050(\);)S
4320 V
(00513)210 648 A
(_PROTOTYPE\()462 1026 A
(pid_t)210 1530 A
(getpgrp,)336 1782 A
(\(void\))252 2160 A
4050(\);)S
4410 V
(00514)210 648 A
(_PROTOTYPE\()462 1026 A
(pid_t)210 1530 A
(getpid,)294 1782 A
(\(void\))252 2118 A
4050(\);)S
4500 V
(00515)210 648 A
(_PROTOTYPE\()462 1026 A
(pid_t)210 1530 A
(getppid,)336 1782 A
(\(void\))252 2160 A
4050(\);)S
4590 V
(00516)210 648 A
(_PROTOTYPE\()462 1026 A
(uid_t)210 1530 A
(getuid,)294 1782 A
(\(void\))252 2118 A
4050(\);)S
4680 V
(00517)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(isatty,)294 1698 A
(\(int)168 2034 A
(_fd\))168 2244 A
4050(\);)S
4770 V
(00518)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(link,)210 1698 A
(\(const)252 1950 A
(char)168 2244 A
(*_existing,)462 2454 A
(const)210 2958 A
(char)168 3210 A
(*_new\))252 3420 A
4050(\);)S
4860 V
(00519)210 648 A
(_PROTOTYPE\()462 1026 A
(off_t)210 1530 A
(lseek,)252 1782 A
(\(int)168 2076 A
(_fd,)168 2286 A
(off_t)210 2496 A
(_offset,)336 2748 A
(int)126 3126 A
(_whence\))336 3294 A
4050(\);)S
4950 V
(00520)210 648 A
(_PROTOTYPE\()462 1026 A
(long)168 1530 A
(pathconf,)378 1740 A
(\(const)252 2160 A
(char)168 2454 A
(*_path,)294 2664 A
(int)126 3000 A
(_name\))252 3168 A
4050(\);)S
5040 V
(00521)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(pause,)252 1698 A
(\(void\))252 1992 A
4050(\);)S
5130 V
(00522)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(pipe,)210 1698 A
(\(int)168 1950 A
(_fildes[2]\))462 2160 A
4050(\);)S
5220 V
(00523)210 648 A
(_PROTOTYPE\()462 1026 A
(ssize_t)294 1530 A
(read,)210 1866 A
(\(int)168 2118 A
(_fd,)168 2328 A
(void)168 2538 A
(*_buf,)252 2748 A
(size_t)252 3042 A
(_n\))126 3336 A
4050(\);)S
5310 V
(00524)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(rmdir,)252 1698 A
(\(const)252 1992 A
(char)168 2286 A
(*_path\))294 2496 A
4050(\);)S
5400 V
(00525)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(setgid,)294 1698 A
(\(Gid_t)252 2034 A
(_gid\))210 2328 A
4050(\);)S
5490 V
(00526)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(setpgid,)336 1698 A
(\(pid_t)252 2076 A
(_pid,)210 2370 A
(pid_t)210 2622 A
(_pgid\))252 2874 A
4050(\);)S
5580 V
(00527)210 648 A
(_PROTOTYPE\()462 1026 A
(pid_t)210 1530 A
(setsid,)294 1782 A
(\(void\))252 2118 A
4050(\);)S
5670 V
(00528)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(setuid,)294 1698 A
(\(Uid_t)252 2034 A
(_uid\))210 2328 A
4050(\);)S
5760 V
(00529)210 648 A
(_PROTOTYPE\()462 1026 A
(unsigned)336 1530 A
(int)126 1908 A
(sleep,)252 2076 A
(\(unsigned)378 2370 A
(int)126 2790 A
(_seconds\))378 2958 A
4050(\);)S
5850 V
(00530)210 648 A
(_PROTOTYPE\()462 1026 A
(long)168 1530 A
(sysconf,)336 1740 A
(\(int)168 2118 A
(_name\))252 2328 A
4050(\);)S
5940 V
(00531)210 648 A
(_PROTOTYPE\()462 1026 A
(pid_t)210 1530 A
(tcgetpgrp,)420 1782 A
(\(int)168 2244 A
(_fd\))168 2454 A
4050(\);)S
6030 V
(00532)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(tcsetpgrp,)420 1698 A
(\(int)168 2160 A
(_fd,)168 2370 A
(pid_t)210 2580 A
(_pgrp_id\))378 2832 A
4050(\);)S
6120 V
(00533)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*ttyname,)378 1740 A
(\(int)168 2160 A
(_fd\))168 2370 A
4050(\);)S
6210 V
(00534)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(unlink,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_path\))294 2538 A
4050(\);)S
8418 V
EP
%%Page: 8 8
BP
/slant 0 def
/height 0 def
630 V
12 B
648(8)S
11 R
2066(File:)S
2299(include/unistd.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(00535)210 648 A
(_PROTOTYPE\()462 1026 A
(ssize_t)294 1530 A
(write,)252 1866 A
(\(int)168 2160 A
(_fd,)168 2370 A
(const)210 2580 A
(void)168 2832 A
(*_buf,)252 3042 A
(size_t)252 3336 A
(_n\))126 3630 A
4050(\);)S
990 V
(00536)210 648 A
1080 V
(00537)210 648 A
(#ifdef)252 1026 A
(_MINIX)252 1320 A
1170 V
(00538)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(brk,)168 1698 A
(\(char)210 1908 A
(*_addr\))294 2160 A
4050(\);)S
1260 V
(00539)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(chroot,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_name\))294 2538 A
4050(\);)S
1350 V
(00540)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(mknod,)252 1698 A
(\(const)252 1992 A
(char)168 2286 A
(*_name,)294 2496 A
(Mode_t)252 2832 A
(_mode,)252 3126 A
(Dev_t)210 3420 A
(_addr\))252 3672 A
4050(\);)S
1440 V
(00541)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(mknod4,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_name,)294 2538 A
(Mode_t)252 2874 A
(_mode,)252 3168 A
(Dev_t)210 3462 A
(_addr,)252 3714 A
1530 V
(00542)210 648 A
(long)168 1530 A
(_size\))252 1740 A
4050(\);)S
1620 V
(00543)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*mktemp,)336 1740 A
(\(char)210 2118 A
(*_template\))462 2370 A
4050(\);)S
1710 V
(00544)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(mount,)252 1698 A
(\(char)210 1992 A
(*_spec,)294 2244 A
(char)168 2580 A
(*_name,)294 2790 A
(int)126 3126 A
(_flag\))252 3294 A
4050(\);)S
1800 V
(00545)210 648 A
(_PROTOTYPE\()462 1026 A
(long)168 1530 A
(ptrace,)294 1740 A
(\(int)168 2076 A
(_req,)210 2286 A
(pid_t)210 2538 A
(_pid,)210 2790 A
(long)168 3042 A
(_addr,)252 3252 A
(long)168 3546 A
(_data\))252 3756 A
4050(\);)S
1890 V
(00546)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*sbrk,)252 1740 A
(\(int)168 2034 A
(_incr\))252 2244 A
4050(\);)S
1980 V
(00547)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sync,)210 1698 A
(\(void\))252 1950 A
4050(\);)S
2070 V
(00548)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(umount,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_name\))294 2538 A
4050(\);)S
2160 V
(00549)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(reboot,)294 1698 A
(\(int)168 2034 A
(_how,)210 2244 A
(...\))168 2496 A
4050(\);)S
2250 V
(00550)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(gethostname,)504 1698 A
(\(char)210 2244 A
(*_hostname,)462 2496 A
(size_t)252 3000 A
(_len\))210 3294 A
4050(\);)S
2340 V
(00551)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(getdomainname,)588 1698 A
(\(char)210 2328 A
(*_domain,)378 2580 A
(size_t)252 3000 A
(_len\))210 3294 A
4050(\);)S
2430 V
(00552)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(ttyslot,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
2520 V
(00553)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(fttyslot,)378 1698 A
(\(int)168 2118 A
(_fd\))168 2328 A
4050(\);)S
2610 V
(00554)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*crypt,)294 1740 A
(\(const)252 2076 A
(char)168 2370 A
(*_key,)252 2580 A
(const)210 2874 A
(char)168 3126 A
(*_salt\))294 3336 A
4050(\);)S
2700 V
(00555)210 648 A
(#endif)252 1026 A
2790 V
(00556)210 648 A
2880 V
(00557)210 648 A
(#endif)252 1026 A
1320(/*)S
(_UNISTD_H)378 1446 A
1866(*/)S
3240 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3330 V
(include/string.h)672 2034 A
3420 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3600 V
(00600)210 648 A
1026(/*)S
(The)126 1152 A
(<string.h>)420 1320 A
(header)252 1782 A
(contains)336 2076 A
(prototypes)420 2454 A
(for)126 2916 A
(the)126 3084 A
(string)252 3252 A
(handling)336 3546 A
3690 V
(00601)210 648 A
1068(*)S
(functions.)420 1152 A
3780 V
(00602)210 648 A
1068(*/)S
3870 V
(00603)210 648 A
3960 V
(00604)210 648 A
(#ifndef)294 1026 A
(_STRING_H)378 1362 A
4050 V
(00605)210 648 A
(#define)294 1026 A
(_STRING_H)378 1362 A
4140 V
(00606)210 648 A
4230 V
(00607)210 648 A
(#define)294 1026 A
(NULL)168 1362 A
(\(\(void)252 1698 A
(*\)0\))168 1992 A
4320 V
(00608)210 648 A
4410 V
(00609)210 648 A
(#ifndef)294 1026 A
(_SIZE_T)294 1362 A
4500 V
(00610)210 648 A
(#define)294 1026 A
(_SIZE_T)294 1362 A
4590 V
(00611)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(size_t;)294 1908 A
2370(/*)S
(type)168 2496 A
(returned)336 2706 A
3084(by)S
(sizeof)252 3210 A
3504(*/)S
4680 V
(00612)210 648 A
(#endif)252 1026 A
(/*_SIZE_T)378 1320 A
1740(*/)S
4770 V
(00613)210 648 A
4860 V
(00614)210 648 A
1026(/*)S
(Function)336 1152 A
(Prototypes.)462 1530 A
2034(*/)S
4950 V
(00615)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
5040 V
(00616)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
5130 V
(00617)210 648 A
(#endif)252 1026 A
5220 V
(00618)210 648 A
5310 V
(00619)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(*memchr,)336 1740 A
(\(const)252 2118 A
(void)168 2412 A
(*_s,)168 2622 A
(int)126 2832 A
(_c,)126 3000 A
(size_t)252 3168 A
(_n\))126 3462 A
4050(\);)S
5400 V
(00620)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(memcmp,)294 1698 A
(\(const)252 2034 A
(void)168 2328 A
(*_s1,)210 2538 A
(const)210 2790 A
(void)168 3042 A
(*_s2,)210 3252 A
(size_t)252 3504 A
(_n\))126 3798 A
4050(\);)S
5490 V
(00621)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(*memcpy,)336 1740 A
(\(void)210 2118 A
(*_s1,)210 2370 A
(const)210 2622 A
(void)168 2874 A
(*_s2,)210 3084 A
(size_t)252 3336 A
(_n\))126 3630 A
4050(\);)S
5580 V
(00622)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(*memmove,)378 1740 A
(\(void)210 2160 A
(*_s1,)210 2412 A
(const)210 2664 A
(void)168 2916 A
(*_s2,)210 3126 A
(size_t)252 3378 A
(_n\))126 3672 A
4050(\);)S
5670 V
(00623)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(*memset,)336 1740 A
(\(void)210 2118 A
(*_s,)168 2370 A
(int)126 2580 A
(_c,)126 2748 A
(size_t)252 2916 A
(_n\))126 3210 A
4050(\);)S
5760 V
(00624)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*strcat,)336 1740 A
(\(char)210 2118 A
(*_s1,)210 2370 A
(const)210 2622 A
(char)168 2874 A
(*_s2\))210 3084 A
4050(\);)S
5850 V
(00625)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*strchr,)336 1740 A
(\(const)252 2118 A
(char)168 2412 A
(*_s,)168 2622 A
(int)126 2832 A
(_c\))126 3000 A
4050(\);)S
5940 V
(00626)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(strncmp,)336 1698 A
(\(const)252 2076 A
(char)168 2370 A
(*_s1,)210 2580 A
(const)210 2832 A
(char)168 3084 A
(*_s2,)210 3294 A
(size_t)252 3546 A
(_n\))126 3840 A
4050(\);)S
6030 V
(00627)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(strcmp,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_s1,)210 2538 A
(const)210 2790 A
(char)168 3042 A
(*_s2\))210 3252 A
4050(\);)S
6120 V
(00628)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(strcoll,)336 1698 A
(\(const)252 2076 A
(char)168 2370 A
(*_s1,)210 2580 A
(const)210 2832 A
(char)168 3084 A
(*_s2\))210 3294 A
4050(\);)S
6210 V
(00629)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*strcpy,)336 1740 A
(\(char)210 2118 A
(*_s1,)210 2370 A
(const)210 2622 A
(char)168 2874 A
(*_s2\))210 3084 A
4050(\);)S
8418 V
EP
%%Page: 9 9
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2075(File:)S
2308(include/string.h)S
12 B
4368(9)S
900 V
7 LST
(00630)210 648 A
(_PROTOTYPE\()462 1026 A
(size_t)252 1530 A
(strcspn,)336 1824 A
(\(const)252 2202 A
(char)168 2496 A
(*_s1,)210 2706 A
(const)210 2958 A
(char)168 3210 A
(*_s2\))210 3420 A
4050(\);)S
990 V
(00631)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*strerror,)420 1740 A
(\(int)168 2202 A
(_errnum\))336 2412 A
4050(\);)S
1080 V
(00632)210 648 A
(_PROTOTYPE\()462 1026 A
(size_t)252 1530 A
(strlen,)294 1824 A
(\(const)252 2160 A
(char)168 2454 A
(*_s\))168 2664 A
4050(\);)S
1170 V
(00633)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*strncat,)378 1740 A
(\(char)210 2160 A
(*_s1,)210 2412 A
(const)210 2664 A
(char)168 2916 A
(*_s2,)210 3126 A
(size_t)252 3378 A
(_n\))126 3672 A
4050(\);)S
1260 V
(00634)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*strncpy,)378 1740 A
(\(char)210 2160 A
(*_s1,)210 2412 A
(const)210 2664 A
(char)168 2916 A
(*_s2,)210 3126 A
(size_t)252 3378 A
(_n\))126 3672 A
4050(\);)S
1350 V
(00635)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*strpbrk,)378 1740 A
(\(const)252 2160 A
(char)168 2454 A
(*_s1,)210 2664 A
(const)210 2916 A
(char)168 3168 A
(*_s2\))210 3378 A
4050(\);)S
1440 V
(00636)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*strrchr,)378 1740 A
(\(const)252 2160 A
(char)168 2454 A
(*_s,)168 2664 A
(int)126 2874 A
(_c\))126 3042 A
4050(\);)S
1530 V
(00637)210 648 A
(_PROTOTYPE\()462 1026 A
(size_t)252 1530 A
(strspn,)294 1824 A
(\(const)252 2160 A
(char)168 2454 A
(*_s1,)210 2664 A
(const)210 2916 A
(char)168 3168 A
(*_s2\))210 3378 A
4050(\);)S
1620 V
(00638)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*strstr,)336 1740 A
(\(const)252 2118 A
(char)168 2412 A
(*_s1,)210 2622 A
(const)210 2874 A
(char)168 3126 A
(*_s2\))210 3336 A
4050(\);)S
1710 V
(00639)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*strtok,)336 1740 A
(\(char)210 2118 A
(*_s1,)210 2370 A
(const)210 2622 A
(char)168 2874 A
(*_s2\))210 3084 A
4050(\);)S
1800 V
(00640)210 648 A
(_PROTOTYPE\()462 1026 A
(size_t)252 1530 A
(strxfrm,)336 1824 A
(\(char)210 2202 A
(*_s1,)210 2454 A
(const)210 2706 A
(char)168 2958 A
(*_s2,)210 3168 A
(size_t)252 3420 A
(_n\))126 3714 A
4050(\);)S
1890 V
(00641)210 648 A
1980 V
(00642)210 648 A
(#ifdef)252 1026 A
(_MINIX)252 1320 A
2070 V
(00643)210 648 A
1026(/*)S
(For)126 1152 A
(backward)336 1320 A
(compatibility.)588 1698 A
2328(*/)S
2160 V
(00644)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*index,)294 1740 A
(\(const)252 2076 A
(char)168 2370 A
(*_s,)168 2580 A
(int)126 2790 A
(_charwanted\))504 2958 A
4050(\);)S
2250 V
(00645)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*rindex,)336 1740 A
(\(const)252 2118 A
(char)168 2412 A
(*_s,)168 2622 A
(int)126 2832 A
(_charwanted\))504 3000 A
4050(\);)S
2340 V
(00646)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(bcopy,)252 1740 A
(\(const)252 2034 A
(void)168 2328 A
(*_src,)252 2538 A
(void)168 2832 A
(*_dst,)252 3042 A
(size_t)252 3336 A
(_length\))336 3630 A
4050(\);)S
2430 V
(00647)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(bcmp,)210 1698 A
(\(const)252 1950 A
(void)168 2244 A
(*_s1,)210 2454 A
(const)210 2706 A
(void)168 2958 A
(*_s2,)210 3168 A
(size_t)252 3420 A
(_length\)\);)420 3714 A
2520 V
(00648)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(bzero,)252 1740 A
(\(void)210 2034 A
(*_dst,)252 2286 A
(size_t)252 2580 A
(_length\))336 2874 A
4050(\);)S
2610 V
(00649)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(*memccpy,)378 1740 A
(\(char)210 2160 A
(*_dst,)252 2412 A
(const)210 2706 A
(char)168 2958 A
(*_src,)252 3168 A
(int)126 3462 A
(_ucharstop,)462 3630 A
2700 V
(00650)210 648 A
(size_t)252 3210 A
(_size\))252 3504 A
4050(\);)S
2790 V
(00651)210 648 A
1026(/*)S
(BSD)126 1152 A
(functions)378 1320 A
1740(*/)S
2880 V
(00652)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(strcasecmp,)462 1698 A
(\(const)252 2202 A
(char)168 2496 A
(*_s1,)210 2706 A
(const)210 2958 A
(char)168 3210 A
(*_s2\))210 3420 A
4050(\);)S
2970 V
(00653)210 648 A
(#endif)252 1026 A
3060 V
(00654)210 648 A
3150 V
(00655)210 648 A
(#endif)252 1026 A
1320(/*)S
(_STRING_H)378 1446 A
1866(*/)S
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(include/signal.h)672 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(00700)210 648 A
1026(/*)S
(The)126 1152 A
(<signal.h>)420 1320 A
(header)252 1782 A
(defines)294 2076 A
(all)126 2412 A
(the)126 2580 A
(ANSI)168 2748 A
(and)126 2958 A
(POSIX)210 3126 A
(signals.)336 3378 A
4140 V
(00701)210 648 A
1068(*)S
(MINIX)210 1152 A
(supports)336 1404 A
(all)126 1782 A
(the)126 1950 A
(signals)294 2118 A
(required)336 2454 A
2832(by)S
(POSIX.)252 2958 A
(They)168 3252 A
(are)126 3462 A
(defined)294 3630 A
(below.)252 3966 A
4230 V
(00702)210 648 A
1068(*)S
(Some)168 1152 A
(additional)420 1362 A
(signals)294 1824 A
(are)126 2160 A
(also)168 2328 A
(supported.)420 2538 A
4320 V
(00703)210 648 A
1068(*/)S
4410 V
(00704)210 648 A
4500 V
(00705)210 648 A
(#ifndef)294 1026 A
(_SIGNAL_H)378 1362 A
4590 V
(00706)210 648 A
(#define)294 1026 A
(_SIGNAL_H)378 1362 A
4680 V
(00707)210 648 A
4770 V
(00708)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
4860 V
(00709)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
4950 V
(00710)210 648 A
(#endif)252 1026 A
5040 V
(00711)210 648 A
5130 V
(00712)210 648 A
1026(/*)S
(Here)168 1152 A
(are)126 1362 A
(types)210 1530 A
(that)168 1782 A
(are)126 1992 A
(closely)294 2160 A
(associated)420 2496 A
(with)168 2958 A
(signal)252 3168 A
(handling.)378 3462 A
3882(*/)S
5220 V
(00713)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(sig_atomic_t;)546 1530 A
5310 V
(00714)210 648 A
5400 V
(00715)210 648 A
(#ifdef)252 1026 A
(_POSIX_SOURCE)546 1320 A
5490 V
(00716)210 648 A
(#ifndef)294 1026 A
(_SIGSET_T)378 1362 A
5580 V
(00717)210 648 A
(#define)294 1026 A
(_SIGSET_T)378 1362 A
5670 V
(00718)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(long)168 1740 A
(sigset_t;)378 1950 A
5760 V
(00719)210 648 A
(#endif)252 1026 A
5850 V
(00720)210 648 A
(#endif)252 1026 A
5940 V
(00721)210 648 A
6030 V
(00722)210 648 A
(#define)294 1026 A
(_NSIG)210 1362 A
2118(16)S
2370(/*)S
(number)252 2496 A
2790(of)S
(signals)294 2916 A
(used)168 3252 A
3462(*/)S
6120 V
(00723)210 648 A
6210 V
(00724)210 648 A
(#define)294 1026 A
(SIGHUP)252 1362 A
2160(1)S
2370(/*)S
(hangup)252 2496 A
2790(*/)S
8418 V
EP
%%Page: 10 10
BP
/slant 0 def
/height 0 def
630 V
12 B
648(10)S
11 R
2068(File:)S
2301(include/signal.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(00725)210 648 A
(#define)294 1026 A
(SIGINT)252 1362 A
2160(2)S
2370(/*)S
(interrupt)378 2496 A
(\(DEL\))210 2916 A
3168(*/)S
990 V
(00726)210 648 A
(#define)294 1026 A
(SIGQUIT)294 1362 A
2160(3)S
2370(/*)S
(quit)168 2496 A
(\(ASCII)252 2706 A
(FS\))126 3000 A
3168(*/)S
1080 V
(00727)210 648 A
(#define)294 1026 A
(SIGILL)252 1362 A
2160(4)S
2370(/*)S
(illegal)294 2496 A
(instruction)462 2832 A
3336(*/)S
1170 V
(00728)210 648 A
(#define)294 1026 A
(SIGTRAP)294 1362 A
2160(5)S
2370(/*)S
(trace)210 2496 A
(trap)168 2748 A
(\(not)168 2958 A
(reset)210 3168 A
(when)168 3420 A
(caught\))294 3630 A
3966(*/)S
1260 V
(00729)210 648 A
(#define)294 1026 A
(SIGABRT)294 1362 A
2160(6)S
2370(/*)S
(IOT)126 2496 A
(instruction)462 2664 A
3168(*/)S
1350 V
(00730)210 648 A
(#define)294 1026 A
(SIGIOT)252 1362 A
2160(6)S
2370(/*)S
(SIGABRT)294 2496 A
(for)126 2832 A
(people)252 3000 A
(who)126 3294 A
(speak)210 3462 A
(PDP-11)252 3714 A
4008(*/)S
1440 V
(00731)210 648 A
(#define)294 1026 A
(SIGUNUSED)378 1362 A
2160(7)S
2370(/*)S
(spare)210 2496 A
(code)168 2748 A
2958(*/)S
1530 V
(00732)210 648 A
(#define)294 1026 A
(SIGFPE)252 1362 A
2160(8)S
2370(/*)S
(floating)336 2496 A
(point)210 2874 A
(exception)378 3126 A
3546(*/)S
1620 V
(00733)210 648 A
(#define)294 1026 A
(SIGKILL)294 1362 A
2160(9)S
2370(/*)S
(kill)168 2496 A
(\(cannot)294 2706 A
3042(be)S
(caught)252 3168 A
3462(or)S
(ignored\))336 3588 A
3966(*/)S
1710 V
(00734)210 648 A
(#define)294 1026 A
(SIGUSR1)294 1362 A
2118(10)S
2370(/*)S
(user)168 2496 A
(defined)294 2706 A
(signal)252 3042 A
3336(#)S
3420(1)S
3504(*/)S
1800 V
(00735)210 648 A
(#define)294 1026 A
(SIGSEGV)294 1362 A
2118(11)S
2370(/*)S
(segmentation)504 2496 A
(violation)378 3042 A
3462(*/)S
1890 V
(00736)210 648 A
(#define)294 1026 A
(SIGUSR2)294 1362 A
2118(12)S
2370(/*)S
(user)168 2496 A
(defined)294 2706 A
(signal)252 3042 A
3336(#)S
3420(2)S
3504(*/)S
1980 V
(00737)210 648 A
(#define)294 1026 A
(SIGPIPE)294 1362 A
2118(13)S
2370(/*)S
(write)210 2496 A
2748(on)S
2874(a)S
(pipe)168 2958 A
(with)168 3168 A
3378(no)S
(one)126 3504 A
3672(to)S
(read)168 3798 A
4008(it)S
4134(*/)S
2070 V
(00738)210 648 A
(#define)294 1026 A
(SIGALRM)294 1362 A
2118(14)S
2370(/*)S
(alarm)210 2496 A
(clock)210 2748 A
3000(*/)S
2160 V
(00739)210 648 A
(#define)294 1026 A
(SIGTERM)294 1362 A
2118(15)S
2370(/*)S
(software)336 2496 A
(termination)462 2874 A
(signal)252 3378 A
(from)168 3672 A
(kill)168 3882 A
4092(*/)S
2250 V
(00740)210 648 A
2340 V
(00741)210 648 A
(#define)294 1026 A
(SIGEMT)252 1362 A
2160(7)S
2370(/*)S
(obsolete)336 2496 A
2874(*/)S
2430 V
(00742)210 648 A
(#define)294 1026 A
(SIGBUS)252 1362 A
2118(10)S
2370(/*)S
(obsolete)336 2496 A
2874(*/)S
2520 V
(00743)210 648 A
2610 V
(00744)210 648 A
1026(/*)S
(POSIX)210 1152 A
(requires)336 1404 A
(the)126 1782 A
(following)378 1950 A
(signals)294 2370 A
2706(to)S
2832(be)S
(defined,)336 2958 A
(even)168 3336 A
3546(if)S
(they)168 3672 A
(are)126 3882 A
2700 V
(00745)210 648 A
1068(*)S
(not)126 1152 A
(supported.)420 1320 A
(Here)168 1824 A
(are)126 2034 A
(the)126 2202 A
(definitions,)504 2370 A
(but)126 2916 A
(they)168 3084 A
(are)126 3294 A
(not)126 3462 A
(supported.)420 3630 A
2790 V
(00746)210 648 A
1068(*/)S
2880 V
(00747)210 648 A
(#define)294 1026 A
(SIGCHLD)294 1362 A
2118(17)S
2370(/*)S
(child)210 2496 A
(process)294 2748 A
(terminated)420 3084 A
3546(or)S
(stopped)294 3672 A
4008(*/)S
2970 V
(00748)210 648 A
(#define)294 1026 A
(SIGCONT)294 1362 A
2118(18)S
2370(/*)S
(continue)336 2496 A
2874(if)S
(stopped)294 3000 A
3336(*/)S
3060 V
(00749)210 648 A
(#define)294 1026 A
(SIGSTOP)294 1362 A
2118(19)S
2370(/*)S
(stop)168 2496 A
(signal)252 2706 A
3000(*/)S
3150 V
(00750)210 648 A
(#define)294 1026 A
(SIGTSTP)294 1362 A
2118(20)S
2370(/*)S
(interactive)462 2496 A
(stop)168 3000 A
(signal)252 3210 A
3504(*/)S
3240 V
(00751)210 648 A
(#define)294 1026 A
(SIGTTIN)294 1362 A
2118(21)S
2370(/*)S
(background)420 2496 A
(process)294 2958 A
(wants)210 3294 A
3546(to)S
(read)168 3672 A
3882(*/)S
3330 V
(00752)210 648 A
(#define)294 1026 A
(SIGTTOU)294 1362 A
2118(22)S
2370(/*)S
(background)420 2496 A
(process)294 2958 A
(wants)210 3294 A
3546(to)S
(write)210 3672 A
3924(*/)S
3420 V
(00753)210 648 A
3510 V
(00754)210 648 A
1026(/*)S
(The)126 1152 A
(sighandler_t)504 1320 A
(type)168 1866 A
2076(is)S
(not)126 2202 A
(allowed)294 2370 A
(unless)252 2706 A
(_POSIX_SOURCE)546 3000 A
3588(is)S
(defined.)336 3714 A
4092(*/)S
3600 V
(00755)210 648 A
(#ifdef)252 1026 A
(_POSIX_SOURCE)546 1320 A
3690 V
(00756)210 648 A
(#define)294 1026 A
(__sighandler_t)588 1362 A
(sighandler_t)504 1992 A
3780 V
(00757)210 648 A
(#else)210 1026 A
3870 V
(00758)210 648 A
(typedef)294 1026 A
(void)168 1362 A
(\(*__sighandler_t\))714 1572 A
(\(int\);)252 2328 A
3960 V
(00759)210 648 A
(#endif)252 1026 A
4050 V
(00760)210 648 A
4140 V
(00761)210 648 A
1026(/*)S
(Macros)252 1152 A
(used)168 1446 A
1656(as)S
(function)336 1782 A
(pointers.)378 2160 A
2580(*/)S
4230 V
(00762)210 648 A
(#define)294 1026 A
(SIG_ERR)294 1362 A
(\(\(__sighandler_t\))714 1824 A
(-1\))126 2580 A
3042(/*)S
(error)210 3168 A
(return)252 3420 A
3714(*/)S
4320 V
(00763)210 648 A
(#define)294 1026 A
(SIG_DFL)294 1362 A
(\(\(__sighandler_t\))714 1824 A
2622(0\))S
3042(/*)S
(default)294 3168 A
(signal)252 3504 A
(handling)336 3798 A
4176(*/)S
4410 V
(00764)210 648 A
(#define)294 1026 A
(SIG_IGN)294 1362 A
(\(\(__sighandler_t\))714 1824 A
2622(1\))S
3042(/*)S
(ignore)252 3168 A
(signal)252 3462 A
3756(*/)S
4500 V
(00765)210 648 A
(#define)294 1026 A
(SIG_HOLD)336 1362 A
(\(\(__sighandler_t\))714 1824 A
2622(2\))S
3042(/*)S
(block)210 3168 A
(signal)252 3420 A
3714(*/)S
4590 V
(00766)210 648 A
(#define)294 1026 A
(SIG_CATCH)378 1362 A
(\(\(__sighandler_t\))714 1824 A
2622(3\))S
3042(/*)S
(catch)210 3168 A
(signal)252 3420 A
3714(*/)S
4680 V
(00767)210 648 A
4770 V
(00768)210 648 A
(#ifdef)252 1026 A
(_POSIX_SOURCE)546 1320 A
4860 V
(00769)210 648 A
(struct)252 1026 A
(sigaction)378 1320 A
1740({)S
4950 V
(00770)210 648 A
(__sighandler_t)588 1110 A
(sa_handler;)462 1740 A
2370(/*)S
(SIG_DFL,)336 2496 A
(SIG_IGN,)336 2874 A
3252(or)S
(pointer)294 3378 A
3714(to)S
(function)336 3840 A
4218(*/)S
5040 V
(00771)210 648 A
(sigset_t)336 1110 A
(sa_mask;)336 1488 A
2370(/*)S
(signals)294 2496 A
2832(to)S
2958(be)S
(blocked)294 3084 A
(during)252 3420 A
(handler)294 3714 A
4050(*/)S
5130 V
(00772)210 648 A
(int)126 1110 A
(sa_flags;)378 1278 A
2370(/*)S
(special)294 2496 A
(flags)210 2832 A
3084(*/)S
5220 V
(00773)210 648 A
1026(};)S
5310 V
(00774)210 648 A
5400 V
(00775)210 648 A
1026(/*)S
(Fields)252 1152 A
(for)126 1446 A
(sa_flags.)378 1614 A
2034(*/)S
5490 V
(00776)210 648 A
(#define)294 1026 A
(SA_ONSTACK)420 1362 A
(0x0001)252 1908 A
2370(/*)S
(deliver)294 2496 A
(signal)252 2832 A
3126(on)S
(alternate)378 3252 A
(stack)210 3672 A
3924(*/)S
5580 V
(00777)210 648 A
(#define)294 1026 A
(SA_RESETHAND)504 1362 A
(0x0002)252 1908 A
2370(/*)S
(reset)210 2496 A
(signal)252 2748 A
(handler)294 3042 A
(when)168 3378 A
(signal)252 3588 A
(caught)252 3882 A
4176(*/)S
5670 V
(00778)210 648 A
(#define)294 1026 A
(SA_NODEFER)420 1362 A
(0x0004)252 1908 A
2370(/*)S
(don't)210 2496 A
(block)210 2748 A
(signal)252 3000 A
(while)210 3294 A
(catching)336 3546 A
3924(it)S
4050(*/)S
5760 V
(00779)210 648 A
(#define)294 1026 A
(SA_RESTART)420 1362 A
(0x0008)252 1908 A
2370(/*)S
(automatic)378 2496 A
(system)252 2916 A
(call)168 3210 A
(restart)294 3420 A
3756(*/)S
5850 V
(00780)210 648 A
(#define)294 1026 A
(SA_SIGINFO)420 1362 A
(0x0010)252 1908 A
2370(/*)S
(extended)336 2496 A
(signal)252 2874 A
(handling)336 3168 A
3546(*/)S
5940 V
(00781)210 648 A
(#define)294 1026 A
(SA_NOCLDWAIT)504 1362 A
(0x0020)252 1908 A
2370(/*)S
(don't)210 2496 A
(create)252 2748 A
(zombies)294 3042 A
3378(*/)S
6030 V
(00782)210 648 A
(#define)294 1026 A
(SA_NOCLDSTOP)504 1362 A
(0x0040)252 1908 A
2370(/*)S
(don't)210 2496 A
(receive)294 2748 A
(SIGCHLD)294 3084 A
(when)168 3420 A
(child)210 3630 A
(stops)210 3882 A
4134(*/)S
6120 V
(00783)210 648 A
6210 V
(00784)210 648 A
1026(/*)S
(POSIX)210 1152 A
(requires)336 1404 A
(these)210 1782 A
(values)252 2034 A
(for)126 2328 A
(use)126 2496 A
(with)168 2664 A
(sigprocmask\(2\).)630 2874 A
3546(*/)S
8418 V
EP
%%Page: 11 11
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2068(File:)S
2301(include/signal.h)S
12 B
4308(11)S
900 V
7 LST
(00785)210 648 A
(#define)294 1026 A
(SIG_BLOCK)378 1362 A
2160(0)S
2370(/*)S
(for)126 2496 A
(blocking)336 2664 A
(signals)294 3042 A
3378(*/)S
990 V
(00786)210 648 A
(#define)294 1026 A
(SIG_UNBLOCK)462 1362 A
2160(1)S
2370(/*)S
(for)126 2496 A
(unblocking)420 2664 A
(signals)294 3126 A
3462(*/)S
1080 V
(00787)210 648 A
(#define)294 1026 A
(SIG_SETMASK)462 1362 A
2160(2)S
2370(/*)S
(for)126 2496 A
(setting)294 2664 A
(the)126 3000 A
(signal)252 3168 A
(mask)168 3462 A
3672(*/)S
1170 V
(00788)210 648 A
(#define)294 1026 A
(SIG_INQUIRE)462 1362 A
2160(4)S
2370(/*)S
(for)126 2496 A
(internal)336 2664 A
(use)126 3042 A
(only)168 3210 A
3420(*/)S
1260 V
(00789)210 648 A
(#endif)252 1026 A
1362(/*)S
(_POSIX_SOURCE)546 1488 A
2076(*/)S
1350 V
(00790)210 648 A
1440 V
(00791)210 648 A
1026(/*)S
(POSIX)210 1152 A
(and)126 1404 A
(ANSI)168 1572 A
(function)336 1782 A
(prototypes.)462 2160 A
2664(*/)S
1530 V
(00792)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(raise,)252 1698 A
(\(int)168 1992 A
(_sig\))210 2202 A
4050(\);)S
1620 V
(00793)210 648 A
(_PROTOTYPE\()462 1026 A
(__sighandler_t)588 1530 A
(signal,)294 2160 A
(\(int)168 2496 A
(_sig,)210 2706 A
(__sighandler_t)588 2958 A
(_func\))252 3588 A
4050(\);)S
1710 V
(00794)210 648 A
1800 V
(00795)210 648 A
(#ifdef)252 1026 A
(_POSIX_SOURCE)546 1320 A
1890 V
(00796)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(kill,)210 1698 A
(\(pid_t)252 1950 A
(_pid,)210 2244 A
(int)126 2496 A
(_sig\))210 2664 A
4050(\);)S
1980 V
(00797)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sigaction,)420 1698 A
2070 V
(00798)210 648 A
(\(int)168 1194 A
(_sig,)210 1404 A
(const)210 1656 A
(struct)252 1908 A
(sigaction)378 2202 A
(*_act,)252 2622 A
(struct)252 2916 A
(sigaction)378 3210 A
(*_oact\))294 3630 A
4050(\);)S
2160 V
(00799)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sigaddset,)420 1698 A
(\(sigset_t)378 2160 A
(*_set,)252 2580 A
(int)126 2874 A
(_sig\))210 3042 A
4050(\);)S
2250 V
(00800)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sigdelset,)420 1698 A
(\(sigset_t)378 2160 A
(*_set,)252 2580 A
(int)126 2874 A
(_sig\))210 3042 A
4050(\);)S
2340 V
(00801)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sigemptyset,)504 1698 A
(\(sigset_t)378 2244 A
(*_set\))252 2664 A
4050(\);)S
2430 V
(00802)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sigfillset,)462 1698 A
(\(sigset_t)378 2202 A
(*_set\))252 2622 A
4050(\);)S
2520 V
(00803)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sigismember,)504 1698 A
(\(sigset_t)378 2244 A
(*_set,)252 2664 A
(int)126 2958 A
(_sig\))210 3126 A
4050(\);)S
2610 V
(00804)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sigpending,)462 1698 A
(\(sigset_t)378 2202 A
(*_set\))252 2622 A
4050(\);)S
2700 V
(00805)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sigprocmask,)504 1698 A
2790 V
(00806)210 648 A
(\(int)168 1530 A
(_how,)210 1740 A
(const)210 1992 A
(sigset_t)336 2244 A
(*_set,)252 2622 A
(sigset_t)336 2916 A
(*_oset\))294 3294 A
4050(\);)S
2880 V
(00807)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sigsuspend,)462 1698 A
(\(const)252 2202 A
(sigset_t)336 2496 A
(*_sigmask\))420 2874 A
4050(\);)S
2970 V
(00808)210 648 A
(#endif)252 1026 A
3060 V
(00809)210 648 A
3150 V
(00810)210 648 A
(#endif)252 1026 A
1320(/*)S
(_SIGNAL_H)378 1446 A
1866(*/)S
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(include/fcntl.h)630 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(00900)210 648 A
1026(/*)S
(The)126 1152 A
(<fcntl.h>)378 1320 A
(header)252 1740 A
2034(is)S
(needed)252 2160 A
2454(by)S
(the)126 2580 A
(open\(\))252 2748 A
(and)126 3042 A
(fcntl\(\))294 3210 A
(system)252 3546 A
(calls,)252 3840 A
4140 V
(00901)210 648 A
1068(*)S
(which)210 1152 A
(have)168 1446 A
1656(a)S
(variety)294 1740 A
2076(of)S
(parameters)420 2202 A
(and)126 2664 A
(flags.)252 2832 A
(They)168 3168 A
(are)126 3378 A
(described)378 3546 A
(here.)210 3966 A
4230 V
(00902)210 648 A
1068(*)S
(The)126 1152 A
(formats)294 1320 A
1656(of)S
(the)126 1782 A
(calls)210 1950 A
2202(to)S
(each)168 2328 A
2538(of)S
(these)210 2664 A
(are:)168 2916 A
4320 V
(00903)210 648 A
1068(*)S
4410 V
(00904)210 648 A
1068(*)S
(open\(path,)420 1362 A
(oflag)210 1824 A
([,mode]\))336 2076 A
(open)168 2706 A
2916(a)S
(file)168 3000 A
4500 V
(00905)210 648 A
1068(*)S
(fcntl\(fd,)378 1362 A
(cmd)126 1782 A
([,arg]\))294 1950 A
(get)126 2706 A
2874(or)S
(set)126 3000 A
(file)168 3168 A
(attributes)420 3378 A
4590 V
(00906)210 648 A
1068(*)S
4680 V
(00907)210 648 A
1068(*/)S
4770 V
(00908)210 648 A
4860 V
(00909)210 648 A
(#ifndef)294 1026 A
(_FCNTL_H)336 1362 A
4950 V
(00910)210 648 A
(#define)294 1026 A
(_FCNTL_H)336 1362 A
5040 V
(00911)210 648 A
5130 V
(00912)210 648 A
1026(/*)S
(These)210 1152 A
(values)252 1404 A
(are)126 1698 A
(used)168 1866 A
(for)126 2076 A
(cmd)126 2244 A
2412(in)S
(fcntl\(\).)336 2538 A
(POSIX)210 2958 A
(Table)210 3210 A
(6-1.)168 3462 A
3714(*/)S
5220 V
(00913)210 648 A
(#define)294 1026 A
(F_DUPFD)294 1362 A
2160(0)S
2370(/*)S
(duplicate)378 2496 A
(file)168 2916 A
(descriptor)420 3126 A
3588(*/)S
5310 V
(00914)210 648 A
(#define)294 1026 A
(F_GETFD)294 1362 A
2160(1)S
2370(/*)S
(get)126 2496 A
(file)168 2664 A
(descriptor)420 2874 A
(flags)210 3336 A
3588(*/)S
5400 V
(00915)210 648 A
(#define)294 1026 A
(F_SETFD)294 1362 A
2160(2)S
2370(/*)S
(set)126 2496 A
(file)168 2664 A
(descriptor)420 2874 A
(flags)210 3336 A
3588(*/)S
5490 V
(00916)210 648 A
(#define)294 1026 A
(F_GETFL)294 1362 A
2160(3)S
2370(/*)S
(get)126 2496 A
(file)168 2664 A
(status)252 2874 A
(flags)210 3168 A
3420(*/)S
5580 V
(00917)210 648 A
(#define)294 1026 A
(F_SETFL)294 1362 A
2160(4)S
2370(/*)S
(set)126 2496 A
(file)168 2664 A
(status)252 2874 A
(flags)210 3168 A
3420(*/)S
5670 V
(00918)210 648 A
(#define)294 1026 A
(F_GETLK)294 1362 A
2160(5)S
2370(/*)S
(get)126 2496 A
(record)252 2664 A
(locking)294 2958 A
(information)462 3294 A
3798(*/)S
5760 V
(00919)210 648 A
(#define)294 1026 A
(F_SETLK)294 1362 A
2160(6)S
2370(/*)S
(set)126 2496 A
(record)252 2664 A
(locking)294 2958 A
(information)462 3294 A
3798(*/)S
5850 V
(00920)210 648 A
(#define)294 1026 A
(F_SETLKW)336 1362 A
2160(7)S
2370(/*)S
(set)126 2496 A
(record)252 2664 A
(locking)294 2958 A
(info;)210 3294 A
(wait)168 3546 A
3756(if)S
(blocked)294 3882 A
4218(*/)S
5940 V
(00921)210 648 A
6030 V
(00922)210 648 A
1026(/*)S
(File)168 1152 A
(descriptor)420 1362 A
(flags)210 1824 A
(used)168 2076 A
(for)126 2286 A
(fcntl\(\).)336 2454 A
(POSIX)210 2874 A
(Table)210 3126 A
(6-2.)168 3378 A
3588(*/)S
6120 V
(00923)210 648 A
(#define)294 1026 A
(FD_CLOEXEC)420 1362 A
2160(1)S
2370(/*)S
(close)210 2496 A
2748(on)S
(exec)168 2874 A
(flag)168 3084 A
(for)126 3294 A
(third)210 3462 A
(arg)126 3714 A
3882(of)S
(fcntl)210 4008 A
4260(*/)S
6210 V
(00924)210 648 A
8418 V
EP
%%Page: 12 12
BP
/slant 0 def
/height 0 def
630 V
12 B
648(12)S
11 R
2099(File:)S
2332(include/fcntl.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(00925)210 648 A
1026(/*)S
(L_type)252 1152 A
(values)252 1446 A
(for)126 1740 A
(record)252 1908 A
(locking)294 2202 A
(with)168 2538 A
(fcntl\(\).)336 2748 A
(POSIX)210 3168 A
(Table)210 3420 A
(6-3.)168 3672 A
3882(*/)S
990 V
(00926)210 648 A
(#define)294 1026 A
(F_RDLCK)294 1362 A
2160(1)S
2370(/*)S
(shared)252 2496 A
2790(or)S
(read)168 2916 A
(lock)168 3126 A
3336(*/)S
1080 V
(00927)210 648 A
(#define)294 1026 A
(F_WRLCK)294 1362 A
2160(2)S
2370(/*)S
(exclusive)378 2496 A
2916(or)S
(write)210 3042 A
(lock)168 3294 A
3504(*/)S
1170 V
(00928)210 648 A
(#define)294 1026 A
(F_UNLCK)294 1362 A
2160(3)S
2370(/*)S
(unlock)252 2496 A
2790(*/)S
1260 V
(00929)210 648 A
1350 V
(00930)210 648 A
1026(/*)S
(Oflag)210 1152 A
(values)252 1404 A
(for)126 1698 A
(open\(\).)294 1866 A
(POSIX)210 2244 A
(Table)210 2496 A
(6-4.)168 2748 A
2958(*/)S
1440 V
(00931)210 648 A
(#define)294 1026 A
(O_CREAT)294 1362 A
(00100)210 1992 A
2370(/*)S
(creat)210 2496 A
(file)168 2748 A
2958(if)S
3084(it)S
(doesn't)294 3210 A
(exist)210 3546 A
3798(*/)S
1530 V
(00932)210 648 A
(#define)294 1026 A
(O_EXCL)252 1362 A
(00200)210 1992 A
2370(/*)S
(exclusive)378 2496 A
(use)126 2916 A
(flag)168 3084 A
3294(*/)S
1620 V
(00933)210 648 A
(#define)294 1026 A
(O_NOCTTY)336 1362 A
(00400)210 1992 A
2370(/*)S
2496(do)S
(not)126 2622 A
(assign)252 2790 A
3084(a)S
(controlling)462 3168 A
(terminal)336 3672 A
4050(*/)S
1710 V
(00934)210 648 A
(#define)294 1026 A
(O_TRUNC)294 1362 A
(01000)210 1992 A
2370(/*)S
(truncate)336 2496 A
(flag)168 2874 A
3084(*/)S
1800 V
(00935)210 648 A
1890 V
(00936)210 648 A
1026(/*)S
(File)168 1152 A
(status)252 1362 A
(flags)210 1656 A
(for)126 1908 A
(open\(\))252 2076 A
(and)126 2370 A
(fcntl\(\).)336 2538 A
(POSIX)210 2958 A
(Table)210 3210 A
(6-5.)168 3462 A
3672(*/)S
1980 V
(00937)210 648 A
(#define)294 1026 A
(O_APPEND)336 1362 A
(02000)210 1992 A
2370(/*)S
(set)126 2496 A
(append)252 2664 A
(mode)168 2958 A
3168(*/)S
2070 V
(00938)210 648 A
(#define)294 1026 A
(O_NONBLOCK)420 1362 A
(04000)210 1992 A
2370(/*)S
2496(no)S
(delay)210 2622 A
2874(*/)S
2160 V
(00939)210 648 A
2250 V
(00940)210 648 A
1026(/*)S
(File)168 1152 A
(access)252 1362 A
(modes)210 1656 A
(for)126 1908 A
(open\(\))252 2076 A
(and)126 2370 A
(fcntl\(\).)336 2538 A
(POSIX)210 2958 A
(Table)210 3210 A
(6-6.)168 3462 A
3672(*/)S
2340 V
(00941)210 648 A
(#define)294 1026 A
(O_RDONLY)336 1362 A
2160(0)S
2370(/*)S
(open\(name,)420 2496 A
(O_RDONLY\))378 2958 A
(opens)210 3378 A
(read)168 3630 A
(only)168 3840 A
4050(*/)S
2430 V
(00942)210 648 A
(#define)294 1026 A
(O_WRONLY)336 1362 A
2160(1)S
2370(/*)S
(open\(name,)420 2496 A
(O_WRONLY\))378 2958 A
(opens)210 3378 A
(write)210 3630 A
(only)168 3882 A
4092(*/)S
2520 V
(00943)210 648 A
(#define)294 1026 A
(O_RDWR)252 1362 A
2160(2)S
2370(/*)S
(open\(name,)420 2496 A
(O_RDWR\))294 2958 A
(opens)210 3294 A
(read/write)420 3546 A
4008(*/)S
2610 V
(00944)210 648 A
2700 V
(00945)210 648 A
1026(/*)S
(Mask)168 1152 A
(for)126 1362 A
(use)126 1530 A
(with)168 1698 A
(file)168 1908 A
(access)252 2118 A
(modes.)252 2412 A
(POSIX)210 2748 A
(Table)210 3000 A
(6-7.)168 3252 A
3462(*/)S
2790 V
(00946)210 648 A
(#define)294 1026 A
(O_ACCMODE)378 1362 A
2118(03)S
2370(/*)S
(mask)168 2496 A
(for)126 2706 A
(file)168 2874 A
(access)252 3084 A
(modes)210 3378 A
3630(*/)S
2880 V
(00947)210 648 A
2970 V
(00948)210 648 A
1026(/*)S
(Struct)252 1152 A
(used)168 1446 A
(for)126 1656 A
(locking.)336 1824 A
(POSIX)210 2244 A
(Table)210 2496 A
(6-8.)168 2748 A
2958(*/)S
3060 V
(00949)210 648 A
(struct)252 1026 A
(flock)210 1320 A
1572({)S
3150 V
(00950)210 648 A
(short)210 1110 A
(l_type;)294 1362 A
2370(/*)S
(type:)210 2496 A
(F_RDLCK,)336 2748 A
(F_WRLCK,)336 3126 A
3504(or)S
(F_UNLCK)294 3630 A
3966(*/)S
3240 V
(00951)210 648 A
(short)210 1110 A
(l_whence;)378 1362 A
2370(/*)S
(flag)168 2496 A
(for)126 2706 A
(starting)336 2874 A
(offset)252 3252 A
3546(*/)S
3330 V
(00952)210 648 A
(off_t)210 1110 A
(l_start;)336 1362 A
2370(/*)S
(relative)336 2496 A
(offset)252 2874 A
3168(in)S
(bytes)210 3294 A
3546(*/)S
3420 V
(00953)210 648 A
(off_t)210 1110 A
(l_len;)252 1362 A
2370(/*)S
(size;)210 2496 A
2748(if)S
2874(0,)S
(then)168 3000 A
(until)210 3210 A
(EOF)126 3462 A
3630(*/)S
3510 V
(00954)210 648 A
(pid_t)210 1110 A
(l_pid;)252 1362 A
2370(/*)S
(process)294 2496 A
2832(id)S
2958(of)S
(the)126 3084 A
(locks')252 3252 A
(owner)210 3546 A
3798(*/)S
3600 V
(00955)210 648 A
1026(};)S
3690 V
(00956)210 648 A
3780 V
(00957)210 648 A
3870 V
(00958)210 648 A
1026(/*)S
(Function)336 1152 A
(Prototypes.)462 1530 A
2034(*/)S
3960 V
(00959)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
4050 V
(00960)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
4140 V
(00961)210 648 A
(#endif)252 1026 A
4230 V
(00962)210 648 A
4320 V
(00963)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(creat,)252 1698 A
(\(const)252 1992 A
(char)168 2286 A
(*_path,)294 2496 A
(Mode_t)252 2832 A
(_mode\))252 3126 A
4050(\);)S
4410 V
(00964)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(fcntl,)252 1698 A
(\(int)168 1992 A
(_filedes,)378 2202 A
(int)126 2622 A
(_cmd,)210 2790 A
(...\))168 3042 A
4050(\);)S
4500 V
(00965)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(open,)210 1698 A
(\(const)252 1992 A
(char)168 2286 A
(*_path,)294 2496 A
(int)126 2832 A
(_oflag,)294 3000 A
(...\))168 3336 A
4050(\);)S
4590 V
(00966)210 648 A
4680 V
(00967)210 648 A
(#endif)252 1026 A
1320(/*)S
(_FCNTL_H)336 1446 A
1824(*/)S
5040 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5130 V
(include/stdlib.h)672 2034 A
5220 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5400 V
(01000)210 648 A
1026(/*)S
(The)126 1152 A
(<stdlib.h>)420 1320 A
(header)252 1782 A
(defines)294 2076 A
(certain)294 2412 A
(common)252 2748 A
(macros,)294 3042 A
(types,)252 3378 A
(and)126 3672 A
(functions.*/)504 3840 A
5490 V
(01001)210 648 A
5580 V
(01002)210 648 A
(#ifndef)294 1026 A
(_STDLIB_H)378 1362 A
5670 V
(01003)210 648 A
(#define)294 1026 A
(_STDLIB_H)378 1362 A
5760 V
(01004)210 648 A
5850 V
(01005)210 648 A
1026(/*)S
(The)126 1152 A
(macros)252 1320 A
(are)126 1614 A
(NULL,)210 1782 A
(EXIT_FAILURE,)546 2034 A
(EXIT_SUCCESS,)546 2622 A
(RAND_MAX,)378 3210 A
(and)126 3630 A
(MB_CUR_MAX.*/)546 3798 A
5940 V
(01006)210 648 A
(#define)294 1026 A
(NULL)168 1362 A
(\(\(void)252 1698 A
(*\)0\))168 1992 A
6030 V
(01007)210 648 A
6120 V
(01008)210 648 A
(#define)294 1026 A
(EXIT_FAILURE)504 1362 A
2160(1)S
2370(/*)S
(standard)336 2496 A
(error)210 2874 A
(return)252 3126 A
(using)210 3420 A
(exit\(\))252 3672 A
3966(*/)S
6210 V
(01009)210 648 A
(#define)294 1026 A
(EXIT_SUCCESS)504 1362 A
2160(0)S
2370(/*)S
(successful)420 2496 A
(return)252 2958 A
(using)210 3252 A
(exit\(\))252 3504 A
3798(*/)S
8418 V
EP
%%Page: 13 13
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2078(File:)S
2311(include/stdlib.h)S
12 B
4308(13)S
900 V
7 LST
(01010)210 648 A
(#define)294 1026 A
(RAND_MAX)336 1362 A
(32767)210 1992 A
2370(/*)S
(largest)294 2496 A
(value)210 2832 A
(generated)378 3084 A
3504(by)S
(rand\(\))252 3630 A
3924(*/)S
990 V
(01011)210 648 A
(#define)294 1026 A
(MB_CUR_MAX)420 1362 A
2160(1)S
2370(/*)S
(max)126 2496 A
(value)210 2664 A
2916(of)S
(multibyte)378 3042 A
(character)378 3462 A
3882(in)S
(MINIX)210 4008 A
4260(*/)S
1080 V
(01012)210 648 A
1170 V
(01013)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
1656({)S
(int)126 1740 A
(quot,)210 1908 A
(rem;)168 2160 A
2370(})S
(div_t;)252 2454 A
1260 V
(01014)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
1656({)S
(long)168 1740 A
(quot,)210 1950 A
(rem;)168 2202 A
2412(})S
(ldiv_t;)294 2496 A
1350 V
(01015)210 648 A
1440 V
(01016)210 648 A
1026(/*)S
(The)126 1152 A
(types)210 1320 A
(are)126 1572 A
(size_t,)294 1740 A
(wchar_t,)336 2076 A
(div_t,)252 2454 A
(and)126 2748 A
(ldiv_t.)294 2916 A
3252(*/)S
1530 V
(01017)210 648 A
(#ifndef)294 1026 A
(_SIZE_T)294 1362 A
1620 V
(01018)210 648 A
(#define)294 1026 A
(_SIZE_T)294 1362 A
1710 V
(01019)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(size_t;)294 1908 A
2370(/*)S
(type)168 2496 A
(returned)336 2706 A
3084(by)S
(sizeof)252 3210 A
3504(*/)S
1800 V
(01020)210 648 A
(#endif)252 1026 A
1890 V
(01021)210 648 A
1980 V
(01022)210 648 A
(#ifndef)294 1026 A
(_WCHAR_T)336 1362 A
2070 V
(01023)210 648 A
(#define)294 1026 A
(_WCHAR_T)336 1362 A
2160 V
(01024)210 648 A
(typedef)294 1026 A
(char)168 1362 A
(wchar_t;)336 1572 A
2370(/*)S
(type)168 2496 A
(expanded)336 2706 A
(character)378 3084 A
(set)126 3504 A
3672(*/)S
2250 V
(01025)210 648 A
(#endif)252 1026 A
2340 V
(01026)210 648 A
2430 V
(01027)210 648 A
1026(/*)S
(Function)336 1152 A
(Prototypes.)462 1530 A
2034(*/)S
2520 V
(01028)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
2610 V
(01029)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
2700 V
(01030)210 648 A
(#endif)252 1026 A
2790 V
(01031)210 648 A
2880 V
(01032)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(abort,)252 1740 A
(\(void\))252 2034 A
4050(\);)S
2970 V
(01033)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(abs,)168 1698 A
(\(int)168 1908 A
(_j\))126 2118 A
4050(\);)S
3060 V
(01034)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(atexit,)294 1698 A
(\(void)210 2034 A
(\(*_func\)\(void\)\))630 2286 A
4050(\);)S
3150 V
(01035)210 648 A
(_PROTOTYPE\()462 1026 A
(double)252 1530 A
(atof,)210 1824 A
(\(const)252 2076 A
(char)168 2370 A
(*_nptr\))294 2580 A
4050(\);)S
3240 V
(01036)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(atoi,)210 1698 A
(\(const)252 1950 A
(char)168 2244 A
(*_nptr\))294 2454 A
4050(\);)S
3330 V
(01037)210 648 A
(_PROTOTYPE\()462 1026 A
(long)168 1530 A
(atol,)210 1740 A
(\(const)252 1992 A
(char)168 2286 A
(*_nptr\))294 2496 A
4050(\);)S
3420 V
(01038)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(*calloc,)336 1740 A
(\(size_t)294 2118 A
(_nmemb,)294 2454 A
(size_t)252 2790 A
(_size\))252 3084 A
4050(\);)S
3510 V
(01039)210 648 A
(_PROTOTYPE\()462 1026 A
(div_t)210 1530 A
(div,)168 1782 A
(\(int)168 1992 A
(_numer,)294 2202 A
(int)126 2538 A
(_denom\))294 2706 A
4050(\);)S
3600 V
(01040)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(exit,)210 1740 A
(\(int)168 1992 A
(_status\))336 2202 A
4050(\);)S
3690 V
(01041)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(free,)210 1740 A
(\(void)210 1992 A
(*_ptr\))252 2244 A
4050(\);)S
3780 V
(01042)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*getenv,)336 1740 A
(\(const)252 2118 A
(char)168 2412 A
(*_name\))294 2622 A
4050(\);)S
3870 V
(01043)210 648 A
(_PROTOTYPE\()462 1026 A
(long)168 1530 A
(labs,)210 1740 A
(\(long)210 1992 A
(_j\))126 2244 A
4050(\);)S
3960 V
(01044)210 648 A
(_PROTOTYPE\()462 1026 A
(ldiv_t)252 1530 A
(ldiv,)210 1824 A
(\(long)210 2076 A
(_numer,)294 2328 A
(long)168 2664 A
(_denom\))294 2874 A
4050(\);)S
4050 V
(01045)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(*malloc,)336 1740 A
(\(size_t)294 2118 A
(_size\))252 2454 A
4050(\);)S
4140 V
(01046)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(mblen,)252 1698 A
(\(const)252 1992 A
(char)168 2286 A
(*_s,)168 2496 A
(size_t)252 2706 A
(_n\))126 3000 A
4050(\);)S
4230 V
(01047)210 648 A
(_PROTOTYPE\()462 1026 A
(size_t)252 1530 A
(mbstowcs,)378 1824 A
(\(wchar_t)336 2244 A
(*_pwcs,)294 2622 A
(const)210 2958 A
(char)168 3210 A
(*_s,)168 3420 A
(size_t)252 3630 A
(_n\)\);)210 3924 A
4320 V
(01048)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(mbtowc,)294 1698 A
(\(wchar_t)336 2034 A
(*_pwc,)252 2412 A
(const)210 2706 A
(char)168 2958 A
(*_s,)168 3168 A
(size_t)252 3378 A
(_n\))126 3672 A
4050(\);)S
4410 V
(01049)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(rand,)210 1698 A
(\(void\))252 1950 A
4050(\);)S
4500 V
(01050)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(*realloc,)378 1740 A
(\(void)210 2160 A
(*_ptr,)252 2412 A
(size_t)252 2706 A
(_size\))252 3000 A
4050(\);)S
4590 V
(01051)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(srand,)252 1740 A
(\(unsigned)378 2034 A
(int)126 2454 A
(_seed\))252 2622 A
4050(\);)S
4680 V
(01052)210 648 A
(_PROTOTYPE\()462 1026 A
(double)252 1530 A
(strtod,)294 1824 A
(\(const)252 2160 A
(char)168 2454 A
(*_nptr,)294 2664 A
(char)168 3000 A
(**_endptr\))420 3210 A
4050(\);)S
4770 V
(01053)210 648 A
(_PROTOTYPE\()462 1026 A
(long)168 1530 A
(strtol,)294 1740 A
(\(const)252 2076 A
(char)168 2370 A
(*_nptr,)294 2580 A
(char)168 2916 A
(**_endptr,)420 3126 A
(int)126 3588 A
(_base\))252 3756 A
4050(\);)S
4860 V
(01054)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(system,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_string\))378 2538 A
4050(\);)S
4950 V
(01055)210 648 A
(_PROTOTYPE\()462 1026 A
(size_t)252 1530 A
(wcstombs,)378 1824 A
(\(char)210 2244 A
(*_s,)168 2496 A
(const)210 2706 A
(wchar_t)294 2958 A
(*_pwcs,)294 3294 A
(size_t)252 3630 A
(_n\)\);)210 3924 A
5040 V
(01056)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(wctomb,)294 1698 A
(\(char)210 2034 A
(*_s,)168 2286 A
(wchar_t)294 2496 A
(_wchar\))294 2832 A
4050(\);)S
5130 V
(01057)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(*bsearch,)378 1740 A
(\(const)252 2160 A
(void)168 2454 A
(*_key,)252 2664 A
(const)210 2958 A
(void)168 3210 A
(*_base,)294 3420 A
5220 V
(01058)210 648 A
(size_t)252 1362 A
(_nmemb,)294 1656 A
(size_t)252 1992 A
(_size,)252 2286 A
5310 V
(01059)210 648 A
(int)126 1362 A
(\(*compar\))378 1530 A
(\(const)252 1950 A
(void)168 2244 A
2454(*,)S
(const)210 2580 A
(void)168 2832 A
(*\)\))126 3042 A
4050(\);)S
5400 V
(01060)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(qsort,)252 1740 A
(\(void)210 2034 A
(*_base,)294 2286 A
(size_t)252 2622 A
(_nmemb,)294 2916 A
(size_t)252 3252 A
(_size,)252 3546 A
5490 V
(01061)210 648 A
(int)126 1362 A
(\(*compar\))378 1530 A
(\(const)252 1950 A
(void)168 2244 A
2454(*,)S
(const)210 2580 A
(void)168 2832 A
(*\)\))126 3042 A
4050(\);)S
5580 V
(01062)210 648 A
(_PROTOTYPE\()462 1026 A
(unsigned)336 1530 A
(long)168 1908 A
(int)126 2118 A
(strtoul,)336 2286 A
5670 V
(01063)210 648 A
(\(const)252 2034 A
(char)168 2328 A
(*_nptr,)294 2538 A
(char)168 2874 A
(**_endptr,)420 3084 A
(int)126 3546 A
(_base\))252 3714 A
4050(\);)S
5760 V
(01064)210 648 A
5850 V
(01065)210 648 A
(#ifdef)252 1026 A
(_MINIX)252 1320 A
5940 V
(01066)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(putenv,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_name\))294 2538 A
4050(\);)S
6030 V
(01067)210 648 A
(_PROTOTYPE\(int)588 1026 A
(getopt,)294 1656 A
(\(int)168 1992 A
(_argc,)252 2202 A
(char)168 2496 A
(**_argv,)336 2706 A
(char)168 3084 A
(*_opts\)\);)378 3294 A
6120 V
(01068)210 648 A
(extern)252 1026 A
(char)168 1320 A
(*optarg;)336 1530 A
6210 V
(01069)210 648 A
(extern)252 1026 A
(int)126 1320 A
(optind,)294 1488 A
(opterr,)294 1824 A
(optopt;)294 2160 A
8418 V
EP
%%Page: 14 14
BP
/slant 0 def
/height 0 def
630 V
12 B
648(14)S
11 R
2078(File:)S
2311(include/stdlib.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(01070)210 648 A
(#endif)252 1026 A
1320(/*)S
(_MINIX)252 1446 A
1740(*/)S
990 V
(01071)210 648 A
1080 V
(01072)210 648 A
(#endif)252 1026 A
1320(/*)S
(STDLIB_H)336 1446 A
1824(*/)S
1440 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1530 V
(include/termios.h)714 2034 A
1620 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1800 V
(01100)210 648 A
1026(/*)S
(The)126 1152 A
(<termios.h>)462 1320 A
(header)252 1824 A
2118(is)S
(used)168 2244 A
(for)126 2454 A
(controlling)462 2622 A
(tty)126 3126 A
(modes.)252 3294 A
3588(*/)S
1890 V
(01101)210 648 A
1980 V
(01102)210 648 A
(#ifndef)294 1026 A
(_TERMIOS_H)420 1362 A
2070 V
(01103)210 648 A
(#define)294 1026 A
(_TERMIOS_H)420 1362 A
2160 V
(01104)210 648 A
2250 V
(01105)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(short)210 1740 A
(tcflag_t;)378 1992 A
2340 V
(01106)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(char)168 1740 A
(cc_t;)210 1950 A
2430 V
(01107)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(speed_t;)336 1908 A
2520 V
(01108)210 648 A
2610 V
(01109)210 648 A
(#define)294 1026 A
(NCCS)168 1362 A
2034(20)S
2370(/*)S
(size)168 2496 A
2706(of)S
(cc_c)168 2832 A
(array,)252 3042 A
(some)168 3336 A
(extra)210 3546 A
(space)210 3798 A
2700 V
(01110)210 648 A
2412(*)S
(for)126 2496 A
(extensions.)462 2664 A
3168(*/)S
2790 V
(01111)210 648 A
2880 V
(01112)210 648 A
1026(/*)S
(Primary)294 1152 A
(terminal)336 1488 A
(control)294 1866 A
(structure.)420 2202 A
(POSIX)210 2664 A
(Table)210 2916 A
(7-1.)168 3168 A
3378(*/)S
2970 V
(01113)210 648 A
(struct)252 1026 A
(termios)294 1320 A
1656({)S
3060 V
(01114)210 648 A
(tcflag_t)336 1110 A
(c_iflag;)336 1488 A
2370(/*)S
(input)210 2496 A
(modes)210 2748 A
3000(*/)S
3150 V
(01115)210 648 A
(tcflag_t)336 1110 A
(c_oflag;)336 1488 A
2370(/*)S
(output)252 2496 A
(modes)210 2790 A
3042(*/)S
3240 V
(01116)210 648 A
(tcflag_t)336 1110 A
(c_cflag;)336 1488 A
2370(/*)S
(control)294 2496 A
(modes)210 2832 A
3084(*/)S
3330 V
(01117)210 648 A
(tcflag_t)336 1110 A
(c_lflag;)336 1488 A
2370(/*)S
(local)210 2496 A
(modes)210 2748 A
3000(*/)S
3420 V
(01118)210 648 A
(speed_t)294 1110 A
(c_ispeed;)378 1488 A
2370(/*)S
(input)210 2496 A
(speed)210 2748 A
3000(*/)S
3510 V
(01119)210 648 A
(speed_t)294 1110 A
(c_ospeed;)378 1488 A
2370(/*)S
(output)252 2496 A
(speed)210 2790 A
3042(*/)S
3600 V
(01120)210 648 A
(cc_t)168 1110 A
(c_cc[NCCS];)462 1320 A
2370(/*)S
(control)294 2496 A
(characters)420 2832 A
3294(*/)S
3690 V
(01121)210 648 A
1026(};)S
3780 V
(01122)210 648 A
3870 V
(01123)210 648 A
1026(/*)S
(Values)252 1152 A
(for)126 1446 A
(termios)294 1614 A
(c_iflag)294 1950 A
(bit)126 2286 A
(map.)168 2454 A
(POSIX)210 2706 A
(Table)210 2958 A
(7-2.)168 3210 A
3420(*/)S
3960 V
(01124)210 648 A
(#define)294 1026 A
(BRKINT)252 1362 A
(0x0001)252 2034 A
2370(/*)S
(signal)252 2496 A
(interrupt)378 2790 A
3210(on)S
(break)210 3336 A
3588(*/)S
4050 V
(01125)210 648 A
(#define)294 1026 A
(ICRNL)210 1362 A
(0x0002)252 2034 A
2370(/*)S
(map)126 2496 A
2664(CR)S
2790(to)S
2916(NL)S
3042(on)S
(input)210 3168 A
3420(*/)S
4140 V
(01126)210 648 A
(#define)294 1026 A
(IGNBRK)252 1362 A
(0x0004)252 2034 A
2370(/*)S
(ignore)252 2496 A
(break)210 2790 A
3042(*/)S
4230 V
(01127)210 648 A
(#define)294 1026 A
(IGNCR)210 1362 A
(0x0008)252 2034 A
2370(/*)S
(ignore)252 2496 A
2790(CR)S
2916(*/)S
4320 V
(01128)210 648 A
(#define)294 1026 A
(IGNPAR)252 1362 A
(0x0010)252 2034 A
2370(/*)S
(ignore)252 2496 A
(characters)420 2790 A
(with)168 3252 A
(parity)252 3462 A
(errors)252 3756 A
4050(*/)S
4410 V
(01129)210 648 A
(#define)294 1026 A
(INLCR)210 1362 A
(0x0020)252 2034 A
2370(/*)S
(map)126 2496 A
2664(NL)S
2790(to)S
2916(CR)S
3042(on)S
(input)210 3168 A
3420(*/)S
4500 V
(01130)210 648 A
(#define)294 1026 A
(INPCK)210 1362 A
(0x0040)252 2034 A
2370(/*)S
(enable)252 2496 A
(input)210 2790 A
(parity)252 3042 A
(check)210 3336 A
3588(*/)S
4590 V
(01131)210 648 A
(#define)294 1026 A
(ISTRIP)252 1362 A
(0x0080)252 2034 A
2370(/*)S
(mask)168 2496 A
(off)126 2706 A
(8th)126 2874 A
(bit)126 3042 A
3210(*/)S
4680 V
(01132)210 648 A
(#define)294 1026 A
(IXOFF)210 1362 A
(0x0100)252 2034 A
2370(/*)S
(enable)252 2496 A
(start/stop)420 2790 A
(input)210 3252 A
(control)294 3504 A
3840(*/)S
4770 V
(01133)210 648 A
(#define)294 1026 A
(IXON)168 1362 A
(0x0200)252 2034 A
2370(/*)S
(enable)252 2496 A
(start/stop)420 2790 A
(output)252 3252 A
(control)294 3546 A
3882(*/)S
4860 V
(01134)210 648 A
(#define)294 1026 A
(PARMRK)252 1362 A
(0x0400)252 2034 A
2370(/*)S
(mark)168 2496 A
(parity)252 2706 A
(errors)252 3000 A
3294(in)S
(the)126 3420 A
(input)210 3588 A
(queue)210 3840 A
4092(*/)S
4950 V
(01135)210 648 A
5040 V
(01136)210 648 A
1026(/*)S
(Values)252 1152 A
(for)126 1446 A
(termios)294 1614 A
(c_oflag)294 1950 A
(bit)126 2286 A
(map.)168 2454 A
(POSIX)210 2706 A
(Sec.)168 2958 A
(7.1.2.3.)336 3168 A
3546(*/)S
5130 V
(01137)210 648 A
(#define)294 1026 A
(OPOST)210 1362 A
(0x0001)252 2034 A
2370(/*)S
(perform)294 2496 A
(output)252 2832 A
(processing)420 3126 A
3588(*/)S
5220 V
(01138)210 648 A
5310 V
(01139)210 648 A
1026(/*)S
(Values)252 1152 A
(for)126 1446 A
(termios)294 1614 A
(c_cflag)294 1950 A
(bit)126 2286 A
(map.)168 2454 A
(POSIX)210 2706 A
(Table)210 2958 A
(7-3.)168 3210 A
3420(*/)S
5400 V
(01140)210 648 A
(#define)294 1026 A
(CLOCAL)252 1362 A
(0x0001)252 2034 A
2370(/*)S
(ignore)252 2496 A
(modem)210 2790 A
(status)252 3042 A
(lines)210 3336 A
3588(*/)S
5490 V
(01141)210 648 A
(#define)294 1026 A
(CREAD)210 1362 A
(0x0002)252 2034 A
2370(/*)S
(enable)252 2496 A
(receiver)336 2790 A
3168(*/)S
5580 V
(01142)210 648 A
(#define)294 1026 A
(CSIZE)210 1362 A
(0x000C)252 2034 A
2370(/*)S
(number)252 2496 A
2790(of)S
(bits)168 2916 A
(per)126 3126 A
(character)378 3294 A
3714(*/)S
5670 V
(01143)210 648 A
(#define)294 1026 A
(CS5)126 1698 A
(0x0000)252 2034 A
2370(/*)S
2496(if)S
(CSIZE)210 2622 A
2874(is)S
(CS5,)168 3000 A
(characters)420 3210 A
(are)126 3672 A
3840(5)S
(bits)168 3924 A
4134(*/)S
5760 V
(01144)210 648 A
(#define)294 1026 A
(CS6)126 1698 A
(0x0004)252 2034 A
2370(/*)S
2496(if)S
(CSIZE)210 2622 A
2874(is)S
(CS6,)168 3000 A
(characters)420 3210 A
(are)126 3672 A
3840(6)S
(bits)168 3924 A
4134(*/)S
5850 V
(01145)210 648 A
(#define)294 1026 A
(CS7)126 1698 A
(0x0008)252 2034 A
2370(/*)S
2496(if)S
(CSIZE)210 2622 A
2874(is)S
(CS7,)168 3000 A
(characters)420 3210 A
(are)126 3672 A
3840(7)S
(bits)168 3924 A
4134(*/)S
5940 V
(01146)210 648 A
(#define)294 1026 A
(CS8)126 1698 A
(0x000C)252 2034 A
2370(/*)S
2496(if)S
(CSIZE)210 2622 A
2874(is)S
(CS8,)168 3000 A
(characters)420 3210 A
(are)126 3672 A
3840(8)S
(bits)168 3924 A
4134(*/)S
6030 V
(01147)210 648 A
(#define)294 1026 A
(CSTOPB)252 1362 A
(0x0010)252 2034 A
2370(/*)S
(send)168 2496 A
2706(2)S
(stop)168 2790 A
(bits)168 3000 A
3210(if)S
(set,)168 3336 A
(else)168 3546 A
3756(1)S
3840(*/)S
6120 V
(01148)210 648 A
(#define)294 1026 A
(HUPCL)210 1362 A
(0x0020)252 2034 A
2370(/*)S
(hang)168 2496 A
2706(up)S
2832(on)S
(last)168 2958 A
(close)210 3168 A
3420(*/)S
6210 V
(01149)210 648 A
(#define)294 1026 A
(PARENB)252 1362 A
(0x0040)252 2034 A
2370(/*)S
(enable)252 2496 A
(parity)252 2790 A
3084(on)S
(output)252 3210 A
3504(*/)S
8418 V
EP
%%Page: 15 15
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2034(File:)S
2267(include/termios.h)S
12 B
4308(15)S
900 V
7 LST
(01150)210 648 A
(#define)294 1026 A
(PARODD)252 1362 A
(0x0080)252 2034 A
2370(/*)S
(use)126 2496 A
(odd)126 2664 A
(parity)252 2832 A
3126(if)S
(set,)168 3252 A
(else)168 3462 A
(even)168 3672 A
3882(*/)S
990 V
(01151)210 648 A
1080 V
(01152)210 648 A
1026(/*)S
(Values)252 1152 A
(for)126 1446 A
(termios)294 1614 A
(c_lflag)294 1950 A
(bit)126 2286 A
(map.)168 2454 A
(POSIX)210 2706 A
(Table)210 2958 A
(7-4.)168 3210 A
3420(*/)S
1170 V
(01153)210 648 A
(#define)294 1026 A
(ECHO)168 1362 A
(0x0001)252 2034 A
2370(/*)S
(enable)252 2496 A
(echoing)294 2790 A
3126(of)S
(input)210 3252 A
(characters)420 3504 A
3966(*/)S
1260 V
(01154)210 648 A
(#define)294 1026 A
(ECHOE)210 1362 A
(0x0002)252 2034 A
2370(/*)S
(echo)168 2496 A
(ERASE)210 2706 A
2958(as)S
(backspace)378 3084 A
3504(*/)S
1350 V
(01155)210 648 A
(#define)294 1026 A
(ECHOK)210 1362 A
(0x0004)252 2034 A
2370(/*)S
(echo)168 2496 A
(KILL)168 2706 A
2916(*/)S
1440 V
(01156)210 648 A
(#define)294 1026 A
(ECHONL)252 1362 A
(0x0008)252 2034 A
2370(/*)S
(echo)168 2496 A
2706(NL)S
2832(*/)S
1530 V
(01157)210 648 A
(#define)294 1026 A
(ICANON)252 1362 A
(0x0010)252 2034 A
2370(/*)S
(canonical)378 2496 A
(input)210 2916 A
(\(erase)252 3168 A
(and)126 3462 A
(kill)168 3630 A
(enabled\))336 3840 A
4218(*/)S
1620 V
(01158)210 648 A
(#define)294 1026 A
(IEXTEN)252 1362 A
(0x0020)252 2034 A
2370(/*)S
(enable)252 2496 A
(extended)336 2790 A
(functions)378 3168 A
3588(*/)S
1710 V
(01159)210 648 A
(#define)294 1026 A
(ISIG)168 1362 A
(0x0040)252 2034 A
2370(/*)S
(enable)252 2496 A
(signals)294 2790 A
3126(*/)S
1800 V
(01160)210 648 A
(#define)294 1026 A
(NOFLSH)252 1362 A
(0x0080)252 2034 A
2370(/*)S
(disable)294 2496 A
(flush)210 2832 A
(after)210 3084 A
(interrupt)378 3336 A
3756(or)S
(quit)168 3882 A
4092(*/)S
1890 V
(01161)210 648 A
(#define)294 1026 A
(TOSTOP)252 1362 A
(0x0100)252 2034 A
2370(/*)S
(send)168 2496 A
(SIGTTOU)294 2706 A
(\(job)168 3042 A
(control,)336 3252 A
(not)126 3630 A
(implemented*/)546 3798 A
1980 V
(01162)210 648 A
2070 V
(01163)210 648 A
1026(/*)S
(Indices)294 1152 A
(into)168 1488 A
(c_cc)168 1698 A
(array.)252 1908 A
(Default)294 2244 A
(values)252 2580 A
2874(in)S
(parentheses.)504 3000 A
(POSIX)210 3546 A
(Table)210 3798 A
(7-5.)168 4050 A
4260(*/)S
2160 V
(01164)210 648 A
(#define)294 1026 A
(VEOF)168 1362 A
2160(0)S
2370(/*)S
(cc_c[VEOF])420 2496 A
2958(=)S
(EOF)126 3042 A
(char)168 3210 A
(\(\303D\))168 3420 A
3630(*/)S
2250 V
(01165)210 648 A
(#define)294 1026 A
(VEOL)168 1362 A
2160(1)S
2370(/*)S
(cc_c[VEOL])420 2496 A
2958(=)S
(EOL)126 3042 A
(char)168 3210 A
(\(undef\))294 3420 A
3756(*/)S
2340 V
(01166)210 648 A
(#define)294 1026 A
(VERASE)252 1362 A
2160(2)S
2370(/*)S
(cc_c[VERASE])504 2496 A
3042(=)S
(ERASE)210 3126 A
(char)168 3378 A
(\(\303H\))168 3588 A
3798(*/)S
2430 V
(01167)210 648 A
(#define)294 1026 A
(VINTR)210 1362 A
2160(3)S
2370(/*)S
(cc_c[VINTR])462 2496 A
3000(=)S
(INTR)168 3084 A
(char)168 3294 A
(\(DEL\))210 3504 A
3756(*/)S
2520 V
(01168)210 648 A
(#define)294 1026 A
(VKILL)210 1362 A
2160(4)S
2370(/*)S
(cc_c[VKILL])462 2496 A
3000(=)S
(KILL)168 3084 A
(char)168 3294 A
(\(\303U\))168 3504 A
3714(*/)S
2610 V
(01169)210 648 A
(#define)294 1026 A
(VMIN)168 1362 A
2160(5)S
2370(/*)S
(cc_c[VMIN])420 2496 A
2958(=)S
(MIN)126 3042 A
(value)210 3210 A
(for)126 3462 A
(timer)210 3630 A
3882(*/)S
2700 V
(01170)210 648 A
(#define)294 1026 A
(VQUIT)210 1362 A
2160(6)S
2370(/*)S
(cc_c[VQUIT])462 2496 A
3000(=)S
(QUIT)168 3084 A
(char)168 3294 A
(\(\303\\\))168 3504 A
3714(*/)S
2790 V
(01171)210 648 A
(#define)294 1026 A
(VTIME)210 1362 A
2160(7)S
2370(/*)S
(cc_c[VTIME])462 2496 A
3000(=)S
(TIME)168 3084 A
(value)210 3294 A
(for)126 3546 A
(timer)210 3714 A
3966(*/)S
2880 V
(01172)210 648 A
(#define)294 1026 A
(VSUSP)210 1362 A
2160(8)S
2370(/*)S
(cc_c[VSUSP])462 2496 A
3000(=)S
(SUSP)168 3084 A
(\(\303Z,)168 3294 A
(ignored\))336 3504 A
3882(*/)S
2970 V
(01173)210 648 A
(#define)294 1026 A
(VSTART)252 1362 A
2160(9)S
2370(/*)S
(cc_c[VSTART])504 2496 A
3042(=)S
(START)210 3126 A
(char)168 3378 A
(\(\303S\))168 3588 A
3798(*/)S
3060 V
(01174)210 648 A
(#define)294 1026 A
(VSTOP)210 1362 A
2118(10)S
2370(/*)S
(cc_c[VSTOP])462 2496 A
3000(=)S
(STOP)168 3084 A
(char)168 3294 A
(\(\303Q\))168 3504 A
3714(*/)S
3150 V
(01175)210 648 A
3240 V
(01176)210 648 A
(#define)294 1026 A
(_POSIX_VDISABLE)630 1362 A
(\(cc_t\)0xFF)420 2118 A
2706(/*)S
(You)126 2832 A
(can't)210 3000 A
(even)168 3252 A
(generate)336 3462 A
(this)168 3840 A
3330 V
(01177)210 648 A
2748(*)S
(character)378 2832 A
(with)168 3252 A
('normal')336 3462 A
(keyboards.)420 3840 A
3420 V
(01178)210 648 A
2748(*)S
(But)126 2832 A
(some)168 3000 A
(language)336 3210 A
(specific)336 3588 A
(keyboards)378 3966 A
3510 V
(01179)210 648 A
2748(*)S
(can)126 2832 A
(generate)336 3000 A
(0xFF.)210 3378 A
3630(It)S
(seems)210 3756 A
(that)168 4008 A
(all)126 4218 A
3600 V
(01180)210 648 A
2748(*)S
(256)126 2832 A
(are)126 3000 A
(used,)210 3168 A
3420(so)S
(cc_t)168 3546 A
(should)252 3756 A
4050(be)S
4176(a)S
3690 V
(01181)210 648 A
2748(*)S
(short...)336 2832 A
3780 V
(01182)210 648 A
2748(*/)S
3870 V
(01183)210 648 A
3960 V
(01184)210 648 A
1026(/*)S
(Values)252 1152 A
(for)126 1446 A
(the)126 1614 A
(baud)168 1782 A
(rate)168 1992 A
(settings.)378 2202 A
(POSIX)210 2664 A
(Table)210 2916 A
(7-6.)168 3168 A
3378(*/)S
4050 V
(01185)210 648 A
(#define)294 1026 A
1362(B0)S
(0x0000)252 2034 A
2370(/*)S
(hang)168 2496 A
2706(up)S
(the)126 2832 A
(line)168 3000 A
3210(*/)S
4140 V
(01186)210 648 A
(#define)294 1026 A
(B50)126 1362 A
(0x1000)252 2034 A
2370(/*)S
2496(50)S
(baud)168 2622 A
2832(*/)S
4230 V
(01187)210 648 A
(#define)294 1026 A
(B75)126 1362 A
(0x2000)252 2034 A
2370(/*)S
2496(75)S
(baud)168 2622 A
2832(*/)S
4320 V
(01188)210 648 A
(#define)294 1026 A
(B110)168 1362 A
(0x3000)252 2034 A
2370(/*)S
(110)126 2496 A
(baud)168 2664 A
2874(*/)S
4410 V
(01189)210 648 A
(#define)294 1026 A
(B134)168 1362 A
(0x4000)252 2034 A
2370(/*)S
(134.5)210 2496 A
(baud)168 2748 A
2958(*/)S
4500 V
(01190)210 648 A
(#define)294 1026 A
(B150)168 1362 A
(0x5000)252 2034 A
2370(/*)S
(150)126 2496 A
(baud)168 2664 A
2874(*/)S
4590 V
(01191)210 648 A
(#define)294 1026 A
(B200)168 1362 A
(0x6000)252 2034 A
2370(/*)S
(200)126 2496 A
(baud)168 2664 A
2874(*/)S
4680 V
(01192)210 648 A
(#define)294 1026 A
(B300)168 1362 A
(0x7000)252 2034 A
2370(/*)S
(300)126 2496 A
(baud)168 2664 A
2874(*/)S
4770 V
(01193)210 648 A
(#define)294 1026 A
(B600)168 1362 A
(0x8000)252 2034 A
2370(/*)S
(600)126 2496 A
(baud)168 2664 A
2874(*/)S
4860 V
(01194)210 648 A
(#define)294 1026 A
(B1200)210 1362 A
(0x9000)252 2034 A
2370(/*)S
(1200)168 2496 A
(baud)168 2706 A
2916(*/)S
4950 V
(01195)210 648 A
(#define)294 1026 A
(B1800)210 1362 A
(0xA000)252 2034 A
2370(/*)S
(1800)168 2496 A
(baud)168 2706 A
2916(*/)S
5040 V
(01196)210 648 A
(#define)294 1026 A
(B2400)210 1362 A
(0xB000)252 2034 A
2370(/*)S
(2400)168 2496 A
(baud)168 2706 A
2916(*/)S
5130 V
(01197)210 648 A
(#define)294 1026 A
(B4800)210 1362 A
(0xC000)252 2034 A
2370(/*)S
(4800)168 2496 A
(baud)168 2706 A
2916(*/)S
5220 V
(01198)210 648 A
(#define)294 1026 A
(B9600)210 1362 A
(0xD000)252 2034 A
2370(/*)S
(9600)168 2496 A
(baud)168 2706 A
2916(*/)S
5310 V
(01199)210 648 A
(#define)294 1026 A
(B19200)252 1362 A
(0xE000)252 2034 A
2370(/*)S
(19200)210 2496 A
(baud)168 2748 A
2958(*/)S
5400 V
(01200)210 648 A
(#define)294 1026 A
(B38400)252 1362 A
(0xF000)252 2034 A
2370(/*)S
(38400)210 2496 A
(baud)168 2748 A
2958(*/)S
5490 V
(01201)210 648 A
5580 V
(01202)210 648 A
1026(/*)S
(Optional)336 1152 A
(actions)294 1530 A
(for)126 1866 A
(tcsetattr\(\).)504 2034 A
(POSIX)210 2622 A
(Sec.)168 2874 A
(7.2.1.2.)336 3084 A
3462(*/)S
5670 V
(01203)210 648 A
(#define)294 1026 A
(TCSANOW)294 1362 A
2160(1)S
2370(/*)S
(changes)294 2496 A
(take)168 2832 A
(effect)252 3042 A
(immediately)462 3336 A
3840(*/)S
5760 V
(01204)210 648 A
(#define)294 1026 A
(TCSADRAIN)378 1362 A
2160(2)S
2370(/*)S
(changes)294 2496 A
(take)168 2832 A
(effect)252 3042 A
(after)210 3336 A
(output)252 3588 A
3882(is)S
(done)168 4008 A
4218(*/)S
5850 V
(01205)210 648 A
(#define)294 1026 A
(TCSAFLUSH)378 1362 A
2160(3)S
2370(/*)S
(wait)168 2496 A
(for)126 2706 A
(output)252 2874 A
3168(to)S
(finish)252 3294 A
(and)126 3588 A
(flush)210 3756 A
(input)210 4008 A
4260(*/)S
5940 V
(01206)210 648 A
6030 V
(01207)210 648 A
1026(/*)S
(Queue_selector)588 1152 A
(values)252 1782 A
(for)126 2076 A
(tcflush\(\).)420 2244 A
(POSIX)210 2748 A
(Sec.)168 3000 A
(7.2.2.2.)336 3210 A
3588(*/)S
6120 V
(01208)210 648 A
(#define)294 1026 A
(TCIFLUSH)336 1362 A
2160(1)S
2370(/*)S
(flush)210 2496 A
(accumulated)462 2748 A
(input)210 3252 A
(data)168 3504 A
3714(*/)S
6210 V
(01209)210 648 A
(#define)294 1026 A
(TCOFLUSH)336 1362 A
2160(2)S
2370(/*)S
(flush)210 2496 A
(accumulated)462 2748 A
(output)252 3252 A
(data)168 3546 A
3756(*/)S
8418 V
EP
%%Page: 16 16
BP
/slant 0 def
/height 0 def
630 V
12 B
648(16)S
11 R
2034(File:)S
2267(include/termios.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(01210)210 648 A
(#define)294 1026 A
(TCIOFLUSH)378 1362 A
2160(3)S
2370(/*)S
(flush)210 2496 A
(accumulated)462 2748 A
(input)210 3252 A
(and)126 3504 A
(output)252 3672 A
(data)168 3966 A
4176(*/)S
990 V
(01211)210 648 A
1080 V
(01212)210 648 A
1026(/*)S
(Action)252 1152 A
(values)252 1446 A
(for)126 1740 A
(tcflow\(\).)378 1908 A
(POSIX)210 2370 A
(Sec.)168 2622 A
(7.2.2.2.)336 2832 A
3210(*/)S
1170 V
(01213)210 648 A
(#define)294 1026 A
(TCOOFF)252 1362 A
2160(1)S
2370(/*)S
(suspend)294 2496 A
(output)252 2832 A
3126(*/)S
1260 V
(01214)210 648 A
(#define)294 1026 A
(TCOON)210 1362 A
2160(2)S
2370(/*)S
(restart)294 2496 A
(suspended)378 2832 A
(output)252 3252 A
3546(*/)S
1350 V
(01215)210 648 A
(#define)294 1026 A
(TCIOFF)252 1362 A
2160(3)S
2370(/*)S
(transmit)336 2496 A
2874(a)S
(STOP)168 2958 A
(character)378 3168 A
3588(on)S
(the)126 3714 A
(line)168 3882 A
4092(*/)S
1440 V
(01216)210 648 A
(#define)294 1026 A
(TCION)210 1362 A
2160(4)S
2370(/*)S
(transmit)336 2496 A
2874(a)S
(START)210 2958 A
(character)378 3210 A
3630(on)S
(the)126 3756 A
(line)168 3924 A
4134(*/)S
1530 V
(01217)210 648 A
1620 V
(01218)210 648 A
1710 V
(01219)210 648 A
1026(/*)S
(Function)336 1152 A
(Prototypes.)462 1530 A
2034(*/)S
1800 V
(01220)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
1890 V
(01221)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
1980 V
(01222)210 648 A
(#endif)252 1026 A
2070 V
(01223)210 648 A
2160 V
(01224)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(tcsendbreak,)504 1698 A
(\(int)168 2244 A
(_fildes,)336 2454 A
(int)126 2832 A
(_duration\))420 3000 A
4260(\);)S
2250 V
(01225)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(tcdrain,)336 1698 A
(\(int)168 2076 A
(_filedes\))378 2286 A
4260(\);)S
2340 V
(01226)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(tcflush,)336 1698 A
(\(int)168 2076 A
(_filedes,)378 2286 A
(int)126 2706 A
(_queue_selector\))672 2874 A
4260(\);)S
2430 V
(01227)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(tcflow,)294 1698 A
(\(int)168 2034 A
(_filedes,)378 2244 A
(int)126 2664 A
(_action\))336 2832 A
4260(\);)S
2520 V
(01228)210 648 A
(_PROTOTYPE\()462 1026 A
(speed_t)294 1530 A
(cfgetispeed,)504 1866 A
(\(const)252 2412 A
(struct)252 2706 A
(termios)294 3000 A
(*_termios_p\))504 3336 A
4260(\);)S
2610 V
(01229)210 648 A
(_PROTOTYPE\()462 1026 A
(speed_t)294 1530 A
(cfgetospeed,)504 1866 A
(\(const)252 2412 A
(struct)252 2706 A
(termios)294 3000 A
(*_termios_p\))504 3336 A
4260(\);)S
2700 V
(01230)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(cfsetispeed,)504 1698 A
(\(struct)294 2244 A
(termios)294 2580 A
(*_termios_p,)504 2916 A
(speed_t)294 3462 A
(_speed\))294 3798 A
4260(\);)S
2790 V
(01231)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(cfsetospeed,)504 1698 A
(\(struct)294 2244 A
(termios)294 2580 A
(*_termios_p,)504 2916 A
(speed_t)294 3462 A
(_speed\))294 3798 A
4260(\);)S
2880 V
(01232)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(tcgetattr,)420 1698 A
(\(int)168 2160 A
(_filedes,)378 2370 A
(struct)252 2790 A
(termios)294 3084 A
(*_termios_p\))504 3420 A
4260(\);)S
2970 V
(01233)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(tcsetattr,)420 1698 A
2160(\\)S
3060 V
(01234)210 648 A
(\(int)168 1362 A
(_filedes,)378 1572 A
(int)126 1992 A
(_opt_actions,)546 2160 A
(const)210 2748 A
(struct)252 3000 A
(termios)294 3294 A
(*_termios_p\))504 3630 A
4260(\);)S
3150 V
(01235)210 648 A
3240 V
(01236)210 648 A
(#define)294 1026 A
(cfgetispeed\(termios_p\))924 1362 A
(\(\(termios_p\)->c_ispeed\))966 2706 A
3330 V
(01237)210 648 A
(#define)294 1026 A
(cfgetospeed\(termios_p\))924 1362 A
(\(\(termios_p\)->c_ospeed\))966 2706 A
3420 V
(01238)210 648 A
(#define)294 1026 A
(cfsetispeed\(termios_p,)924 1362 A
(speed\))252 2328 A
(\(\(termios_p\)->c_ispeed)924 2706 A
3672(=)S
(\(speed\),)336 3756 A
4134(0\))S
3510 V
(01239)210 648 A
(#define)294 1026 A
(cfsetospeed\(termios_p,)924 1362 A
(speed\))252 2328 A
(\(\(termios_p\)->c_ospeed)924 2706 A
3672(=)S
(\(speed\),)336 3756 A
4134(0\))S
3600 V
(01240)210 648 A
3690 V
(01241)210 648 A
(#ifdef)252 1026 A
(_MINIX)252 1320 A
3780 V
(01242)210 648 A
1026(/*)S
(Here)168 1152 A
(are)126 1362 A
(the)126 1530 A
(local)210 1698 A
(extensions)420 1950 A
2412(to)S
(the)126 2538 A
(POSIX)210 2706 A
(standard)336 2958 A
(for)126 3336 A
(Minix.)252 3504 A
(Posix)210 3798 A
3870 V
(01243)210 648 A
1068(*)S
(conforming)420 1152 A
(programs)336 1614 A
(are)126 1992 A
(not)126 2160 A
(able)168 2328 A
2538(to)S
(access)252 2664 A
(these,)252 2958 A
(and)126 3252 A
(therefore)378 3420 A
(they)168 3840 A
(are)126 4050 A
3960 V
(01244)210 648 A
1068(*)S
(only)168 1152 A
(defined)294 1362 A
(when)168 1698 A
1908(a)S
(Minix)210 1992 A
(program)294 2244 A
2580(is)S
(compiled.)378 2706 A
4050 V
(01245)210 648 A
1068(*/)S
4140 V
(01246)210 648 A
4230 V
(01247)210 648 A
1026(/*)S
(Extensions)420 1152 A
1614(to)S
(the)126 1740 A
(termios)294 1908 A
(c_iflag)294 2244 A
(bit)126 2580 A
(map.)168 2748 A
3000(*/)S
4320 V
(01248)210 648 A
(#define)294 1026 A
(IXANY)210 1362 A
(0x0800)252 2034 A
2370(/*)S
(allow)210 2496 A
(any)126 2748 A
(key)126 2916 A
3084(to)S
(continue)336 3210 A
(ouptut)252 3588 A
3882(*/)S
4410 V
(01249)210 648 A
4500 V
(01250)210 648 A
1026(/*)S
(Extensions)420 1152 A
1614(to)S
(the)126 1740 A
(termios)294 1908 A
(c_oflag)294 2244 A
(bit)126 2580 A
(map.)168 2748 A
(They)168 2958 A
(are)126 3168 A
(only)168 3336 A
(active)252 3546 A
(iff)126 3840 A
4590 V
(01251)210 648 A
1068(*)S
(OPOST)210 1152 A
1404(is)S
(enabled.)336 1530 A
1908(*/)S
4680 V
(01252)210 648 A
(#define)294 1026 A
(ONLCR)210 1362 A
(0x0002)252 2034 A
2370(/*)S
(Map)126 2496 A
2664(NL)S
2790(to)S
(CR-NL)210 2916 A
3168(on)S
(output)252 3294 A
3588(*/)S
4770 V
(01253)210 648 A
(#define)294 1026 A
(XTABS)210 1362 A
(0x0004)252 2034 A
2370(/*)S
(Expand)252 2496 A
(tabs)168 2790 A
3000(to)S
(spaces)252 3126 A
3420(*/)S
4860 V
(01254)210 648 A
(#define)294 1026 A
(ONOEOT)252 1362 A
(0x0008)252 2034 A
2370(/*)S
(discard)294 2496 A
(EOT's)210 2832 A
(\(\303D\))168 3084 A
3294(on)S
(output\))294 3420 A
3756(*/)S
4950 V
(01255)210 648 A
5040 V
(01256)210 648 A
1026(/*)S
(Extensions)420 1152 A
1614(to)S
(the)126 1740 A
(termios)294 1908 A
(c_lflag)294 2244 A
(bit)126 2580 A
(map.)168 2748 A
3000(*/)S
5130 V
(01257)210 648 A
(#define)294 1026 A
(LFLUSHO)294 1362 A
(0x0200)252 2034 A
2370(/*)S
(Flush)210 2496 A
(output.)294 2748 A
3084(*/)S
5220 V
(01258)210 648 A
5310 V
(01259)210 648 A
1026(/*)S
(Extensions)420 1152 A
1614(to)S
(the)126 1740 A
(c_cc)168 1908 A
(array.)252 2118 A
2412(*/)S
5400 V
(01260)210 648 A
(#define)294 1026 A
(VREPRINT)336 1362 A
2118(11)S
2370(/*)S
(cc_c[VREPRINT])588 2496 A
(\(\303R\))168 3126 A
3336(*/)S
5490 V
(01261)210 648 A
(#define)294 1026 A
(VLNEXT)252 1362 A
2118(12)S
2370(/*)S
(cc_c[VLNEXT])504 2496 A
(\(\303V\))168 3042 A
3252(*/)S
5580 V
(01262)210 648 A
(#define)294 1026 A
(VDISCARD)336 1362 A
2118(13)S
2370(/*)S
(cc_c[VDISCARD])588 2496 A
(\(\303O\))168 3126 A
3336(*/)S
5670 V
(01263)210 648 A
5760 V
(01264)210 648 A
1026(/*)S
(Extensions)420 1152 A
1614(to)S
(baud)168 1740 A
(rate)168 1950 A
(settings.)378 2160 A
2580(*/)S
5850 V
(01265)210 648 A
(#define)294 1026 A
(B57600)252 1362 A
(0x0100)252 2034 A
2370(/*)S
(57600)210 2496 A
(baud)168 2748 A
2958(*/)S
5940 V
(01266)210 648 A
(#define)294 1026 A
(B115200)294 1362 A
(0x0200)252 2034 A
2370(/*)S
(115200)252 2496 A
(baud)168 2790 A
3000(*/)S
6030 V
(01267)210 648 A
6120 V
(01268)210 648 A
1026(/*)S
(These)210 1152 A
(are)126 1404 A
(the)126 1572 A
(default)294 1740 A
(settings)336 2076 A
(used)168 2454 A
2664(by)S
(the)126 2790 A
(kernel)252 2958 A
(and)126 3252 A
3420(by)S
('stty)210 3546 A
(sane')210 3798 A
4050(*/)S
6210 V
(01269)210 648 A
8418 V
EP
%%Page: 17 17
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2034(File:)S
2267(include/termios.h)S
12 B
4308(17)S
900 V
7 LST
(01270)210 648 A
(#define)294 1026 A
(TCTRL_DEF)378 1362 A
(\(CREAD)252 2034 A
2328(|)S
(CS8)126 2412 A
2580(|)S
(HUPCL\))252 2664 A
990 V
(01271)210 648 A
(#define)294 1026 A
(TINPUT_DEF)420 1362 A
(\(BRKINT)294 2034 A
2370(|)S
(ICRNL)210 2454 A
2706(|)S
(IXON)168 2790 A
3000(|)S
(IXANY\))252 3084 A
1080 V
(01272)210 648 A
(#define)294 1026 A
(TOUTPUT_DEF)462 1362 A
(\(OPOST)252 2034 A
2328(|)S
(ONLCR\))252 2412 A
1170 V
(01273)210 648 A
(#define)294 1026 A
(TLOCAL_DEF)420 1362 A
(\(ISIG)210 2034 A
2286(|)S
(IEXTEN)252 2370 A
2664(|)S
(ICANON)252 2748 A
3042(|)S
(ECHO)168 3126 A
3336(|)S
(ECHOE\))252 3420 A
1260 V
(01274)210 648 A
(#define)294 1026 A
(TSPEED_DEF)420 1362 A
(B9600)210 2034 A
1350 V
(01275)210 648 A
1440 V
(01276)210 648 A
(#define)294 1026 A
(TEOF_DEF)336 1362 A
('\\4')168 2034 A
2370(/*)S
2496(\303D)S
2622(*/)S
1530 V
(01277)210 648 A
(#define)294 1026 A
(TEOL_DEF)336 1362 A
(_POSIX_VDISABLE)630 2034 A
1620 V
(01278)210 648 A
(#define)294 1026 A
(TERASE_DEF)420 1362 A
('\\10')210 2034 A
2370(/*)S
2496(\303H)S
2622(*/)S
1710 V
(01279)210 648 A
(#define)294 1026 A
(TINTR_DEF)378 1362 A
('\\177')252 2034 A
2370(/*)S
2496(\303?)S
2622(*/)S
1800 V
(01280)210 648 A
(#define)294 1026 A
(TKILL_DEF)378 1362 A
('\\25')210 2034 A
2370(/*)S
2496(\303U)S
2622(*/)S
1890 V
(01281)210 648 A
(#define)294 1026 A
(TMIN_DEF)336 1362 A
2034(1)S
1980 V
(01282)210 648 A
(#define)294 1026 A
(TQUIT_DEF)378 1362 A
('\\34')210 2034 A
2370(/*)S
2496(\303\\)S
2622(*/)S
2070 V
(01283)210 648 A
(#define)294 1026 A
(TSTART_DEF)420 1362 A
('\\21')210 2034 A
2370(/*)S
2496(\303Q)S
2622(*/)S
2160 V
(01284)210 648 A
(#define)294 1026 A
(TSTOP_DEF)378 1362 A
('\\23')210 2034 A
2370(/*)S
2496(\303S)S
2622(*/)S
2250 V
(01285)210 648 A
(#define)294 1026 A
(TSUSP_DEF)378 1362 A
('\\32')210 2034 A
2370(/*)S
2496(\303Z)S
2622(*/)S
2340 V
(01286)210 648 A
(#define)294 1026 A
(TTIME_DEF)378 1362 A
2034(0)S
2430 V
(01287)210 648 A
(#define)294 1026 A
(TREPRINT_DEF)504 1362 A
('\\22')210 2034 A
2370(/*)S
2496(\303R)S
2622(*/)S
2520 V
(01288)210 648 A
(#define)294 1026 A
(TLNEXT_DEF)420 1362 A
('\\26')210 2034 A
2370(/*)S
2496(\303V)S
2622(*/)S
2610 V
(01289)210 648 A
(#define)294 1026 A
(TDISCARD_DEF)504 1362 A
('\\17')210 2034 A
2370(/*)S
2496(\303O)S
2622(*/)S
2700 V
(01290)210 648 A
2790 V
(01291)210 648 A
1026(/*)S
(Window)252 1152 A
(size.)210 1446 A
(This)168 1698 A
(information)462 1908 A
2412(is)S
(stored)252 2538 A
2832(in)S
(the)126 2958 A
(TTY)126 3126 A
(driver)252 3294 A
(but)126 3588 A
(not)126 3756 A
(used.)210 3924 A
2880 V
(01292)210 648 A
1068(*)S
(This)168 1152 A
(can)126 1362 A
1530(be)S
(used)168 1656 A
(for)126 1866 A
(screen)252 2034 A
(based)210 2328 A
(applications)504 2580 A
3126(in)S
3252(a)S
(window)252 3336 A
(environment.)504 3630 A
2970 V
(01293)210 648 A
1068(*)S
(The)126 1152 A
(ioctls)252 1320 A
(TIOCGWINSZ)420 1614 A
(and)126 2076 A
(TIOCSWINSZ)420 2244 A
(can)126 2706 A
2874(be)S
(used)168 3000 A
3210(to)S
(get)126 3336 A
(and)126 3504 A
(set)126 3672 A
(this)168 3840 A
3060 V
(01294)210 648 A
1068(*)S
(information.)504 1152 A
3150 V
(01295)210 648 A
1068(*/)S
3240 V
(01296)210 648 A
3330 V
(01297)210 648 A
(struct)252 1026 A
(winsize)294 1320 A
3420 V
(01298)210 648 A
1026({)S
3510 V
(01299)210 648 A
(unsigned)336 1362 A
(short)210 1740 A
(ws_row;)294 2034 A
2706(/*)S
(rows,)210 2832 A
3084(in)S
(characters)420 3210 A
3672(*/)S
3600 V
(01300)210 648 A
(unsigned)336 1362 A
(short)210 1740 A
(ws_col;)294 2034 A
2706(/*)S
(columns,)336 2832 A
3210(in)S
(characters)420 3336 A
3798(*/)S
3690 V
(01301)210 648 A
(unsigned)336 1362 A
(short)210 1740 A
(ws_xpixel;)420 2034 A
2706(/*)S
(horizontal)420 2832 A
(size,)210 3294 A
(pixels)252 3546 A
3840(*/)S
3780 V
(01302)210 648 A
(unsigned)336 1362 A
(short)210 1740 A
(ws_ypixel;)420 2034 A
2706(/*)S
(vertical)336 2832 A
(size,)210 3210 A
(pixels)252 3462 A
3756(*/)S
3870 V
(01303)210 648 A
1026(};)S
3960 V
(01304)210 648 A
(#endif)252 1026 A
1320(/*)S
(_MINIX)252 1446 A
1740(*/)S
4050 V
(01305)210 648 A
4140 V
(01306)210 648 A
(#endif)252 1026 A
1320(/*)S
(_TERMIOS_H)420 1446 A
1908(*/)S
4590 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4680 V
(include/a.out.h)630 2034 A
4770 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4950 V
(01400)210 648 A
1026(/*)S
(The)126 1152 A
(<a.out>)294 1320 A
(header)252 1656 A
(file)168 1950 A
(describes)378 2160 A
(the)126 2580 A
(format)252 2748 A
3042(of)S
(executable)420 3168 A
(files.)252 3630 A
3924(*/)S
5040 V
(01401)210 648 A
5130 V
(01402)210 648 A
(#ifndef)294 1026 A
(_AOUT_H)294 1362 A
5220 V
(01403)210 648 A
(#define)294 1026 A
(_AOUT_H)294 1362 A
5310 V
(01404)210 648 A
5400 V
(01405)210 648 A
(struct)252 1026 A
(exec)168 1362 A
1572({)S
2370(/*)S
(a.out)210 2496 A
(header)252 2748 A
3042(*/)S
5490 V
(01406)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(a_magic[2];)462 1698 A
2370(/*)S
(magic)210 2496 A
(number)252 2748 A
3042(*/)S
5580 V
(01407)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(a_flags;)336 1698 A
2370(/*)S
(flags,)252 2496 A
(see)126 2790 A
(below)210 2958 A
3210(*/)S
5670 V
(01408)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(a_cpu;)252 1698 A
2370(/*)S
(cpu)126 2496 A
2664(id)S
2790(*/)S
5760 V
(01409)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(a_hdrlen;)378 1698 A
2370(/*)S
(length)252 2496 A
2790(of)S
(header)252 2916 A
3210(*/)S
5850 V
(01410)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(a_unused;)378 1698 A
2370(/*)S
(reserved)336 2496 A
(for)126 2874 A
(future)252 3042 A
(use)126 3336 A
3504(*/)S
5940 V
(01411)210 648 A
(unsigned)336 1110 A
(short)210 1488 A
(a_version;)420 1740 A
2370(/*)S
(version)294 2496 A
(stamp)210 2832 A
(\(not)168 3084 A
(used)168 3294 A
3504(at)S
(present\))336 3630 A
4008(*/)S
6030 V
(01412)210 648 A
(long)168 1110 A
(a_text;)294 1698 A
2370(/*)S
(size)168 2496 A
2706(of)S
(text)168 2832 A
(segement)336 3042 A
3420(in)S
(bytes)210 3546 A
3798(*/)S
6120 V
(01413)210 648 A
(long)168 1110 A
(a_data;)294 1698 A
2370(/*)S
(size)168 2496 A
2706(of)S
(data)168 2832 A
(segment)294 3042 A
3378(in)S
(bytes)210 3504 A
3756(*/)S
6210 V
(01414)210 648 A
(long)168 1110 A
(a_bss;)252 1698 A
2370(/*)S
(size)168 2496 A
2706(of)S
(bss)126 2832 A
(segment)294 3000 A
3336(in)S
(bytes)210 3462 A
3714(*/)S
8418 V
EP
%%Page: 18 18
BP
/slant 0 def
/height 0 def
630 V
12 B
648(18)S
11 R
2091(File:)S
2324(include/a.out.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(01415)210 648 A
(long)168 1110 A
(a_entry;)336 1698 A
2370(/*)S
(entry)210 2496 A
(point)210 2748 A
3000(*/)S
990 V
(01416)210 648 A
(long)168 1110 A
(a_total;)336 1698 A
2370(/*)S
(total)210 2496 A
(memory)252 2748 A
(allocated)378 3042 A
3462(*/)S
1080 V
(01417)210 648 A
(long)168 1110 A
(a_syms;)294 1698 A
2370(/*)S
(size)168 2496 A
2706(of)S
(symbol)252 2832 A
(table)210 3126 A
3378(*/)S
1170 V
(01418)210 648 A
1260 V
(01419)210 648 A
1110(/*)S
(SHORT)210 1236 A
(FORM)168 1488 A
(ENDS)168 1698 A
(HERE)168 1908 A
2118(*/)S
1350 V
(01420)210 648 A
(long)168 1110 A
(a_trsize;)378 1698 A
2370(/*)S
(text)168 2496 A
(relocation)420 2706 A
(size)168 3168 A
3378(*/)S
1440 V
(01421)210 648 A
(long)168 1110 A
(a_drsize;)378 1698 A
2370(/*)S
(data)168 2496 A
(relocation)420 2706 A
(size)168 3168 A
3378(*/)S
1530 V
(01422)210 648 A
(long)168 1110 A
(a_tbase;)336 1698 A
2370(/*)S
(text)168 2496 A
(relocation)420 2706 A
(base)168 3168 A
3378(*/)S
1620 V
(01423)210 648 A
(long)168 1110 A
(a_dbase;)336 1698 A
2370(/*)S
(data)168 2496 A
(relocation)420 2706 A
(base)168 3168 A
3378(*/)S
1710 V
(01424)210 648 A
1026(};)S
1800 V
(01425)210 648 A
1890 V
(01426)210 648 A
(#define)294 1026 A
(A_MAGIC0)336 1362 A
(\(unsigned)378 1950 A
(char\))210 2370 A
(0x01)168 2622 A
1980 V
(01427)210 648 A
(#define)294 1026 A
(A_MAGIC1)336 1362 A
(\(unsigned)378 1950 A
(char\))210 2370 A
(0x03)168 2622 A
2070 V
(01428)210 648 A
(#define)294 1026 A
(BADMAG\(X\))378 1362 A
(\(\(X\).a_magic[0])630 1950 A
2622(!=)S
(A_MAGIC0)336 2748 A
(||\(X\).a_magic[1])672 3126 A
3840(!=)S
(A_MAGIC1\))378 3966 A
2160 V
(01429)210 648 A
2250 V
(01430)210 648 A
1026(/*)S
(CPU)126 1152 A
1320(Id)S
1446(of)S
(TARGET)252 1572 A
(machine)294 1866 A
(\(byte)210 2202 A
(order)210 2454 A
(coded)210 2706 A
2958(in)S
(low)126 3084 A
(order)210 3252 A
(two)126 3504 A
(bits\))210 3672 A
3924(*/)S
2340 V
(01431)210 648 A
(#define)294 1026 A
(A_NONE)252 1362 A
(0x00)168 1698 A
2034(/*)S
(unknown)294 2160 A
2496(*/)S
2430 V
(01432)210 648 A
(#define)294 1026 A
(A_I8086)294 1362 A
(0x04)168 1698 A
2034(/*)S
(intel)210 2160 A
(i8086/8088)420 2412 A
2874(*/)S
2520 V
(01433)210 648 A
(#define)294 1026 A
(A_M68K)252 1362 A
(0x0B)168 1698 A
2034(/*)S
(motorola)336 2160 A
(m68000)252 2538 A
2832(*/)S
2610 V
(01434)210 648 A
(#define)294 1026 A
(A_NS16K)294 1362 A
(0x0C)168 1698 A
2034(/*)S
(national)336 2160 A
(semiconductor)546 2538 A
(16032)210 3126 A
3378(*/)S
2700 V
(01435)210 648 A
(#define)294 1026 A
(A_I80386)336 1362 A
(0x10)168 1740 A
2034(/*)S
(intel)210 2160 A
(i80386)252 2412 A
2706(*/)S
2790 V
(01436)210 648 A
(#define)294 1026 A
(A_SPARC)294 1362 A
(0x17)168 1698 A
2034(/*)S
(Sun)126 2160 A
(SPARC)210 2328 A
2580(*/)S
2880 V
(01437)210 648 A
2970 V
(01438)210 648 A
(#define)294 1026 A
(A_BLR\(cputype\))588 1362 A
(\(\(cputype&0x01\)!=0\))798 2034 A
2874(/*)S
(TRUE)168 3000 A
3210(if)S
(bytes)210 3336 A
(left-to-right)546 3588 A
4176(*/)S
3060 V
(01439)210 648 A
(#define)294 1026 A
(A_WLR\(cputype\))588 1362 A
(\(\(cputype&0x02\)!=0\))798 2034 A
2874(/*)S
(TRUE)168 3000 A
3210(if)S
(words)210 3336 A
(left-to-right)546 3588 A
4176(*/)S
3150 V
(01440)210 648 A
3240 V
(01441)210 648 A
1026(/*)S
(Flags.)252 1152 A
1446(*/)S
3330 V
(01442)210 648 A
(#define)294 1026 A
(A_UZP)210 1362 A
(0x01)168 1698 A
2034(/*)S
(unmapped)336 2160 A
(zero)168 2538 A
(page)168 2748 A
(\(pages\))294 2958 A
3294(*/)S
3420 V
(01443)210 648 A
(#define)294 1026 A
(A_PAL)210 1362 A
(0x02)168 1698 A
2034(/*)S
(page)168 2160 A
(aligned)294 2370 A
(executable)420 2706 A
3168(*/)S
3510 V
(01444)210 648 A
(#define)294 1026 A
(A_NSYM)252 1362 A
(0x04)168 1698 A
2034(/*)S
(new)126 2160 A
(style)210 2328 A
(symbol)252 2580 A
(table)210 2874 A
3126(*/)S
3600 V
(01445)210 648 A
(#define)294 1026 A
(A_EXEC)252 1362 A
(0x10)168 1698 A
2034(/*)S
(executable)420 2160 A
2622(*/)S
3690 V
(01446)210 648 A
(#define)294 1026 A
(A_SEP)210 1362 A
(0x20)168 1698 A
2034(/*)S
(separate)336 2160 A
(I/D)126 2538 A
2706(*/)S
3780 V
(01447)210 648 A
(#define)294 1026 A
(A_PURE)252 1362 A
(0x40)168 1698 A
2034(/*)S
(pure)168 2160 A
(text)168 2370 A
2580(*/)S
3042(/*)S
(not)126 3168 A
(used)168 3336 A
3546(*/)S
3870 V
(01448)210 648 A
(#define)294 1026 A
(A_TOVLY)294 1362 A
(0x80)168 1698 A
2034(/*)S
(text)168 2160 A
(overlay)294 2370 A
2706(*/)S
3042(/*)S
(not)126 3168 A
(used)168 3336 A
3546(*/)S
3960 V
(01449)210 648 A
4050 V
(01450)210 648 A
1026(/*)S
(Offsets)294 1152 A
1488(of)S
(various)294 1614 A
(things.)294 1950 A
2286(*/)S
4140 V
(01451)210 648 A
(#define)294 1026 A
(A_MINHDR)336 1362 A
2034(32)S
4230 V
(01452)210 648 A
(#define)294 1026 A
(A_TEXTPOS\(X\))504 1362 A
(\(\(long\)\(X\).a_hdrlen\))840 2034 A
4320 V
(01453)210 648 A
(#define)294 1026 A
(A_DATAPOS\(X\))504 1362 A
(\(A_TEXTPOS\(X\))546 2034 A
2622(+)S
(\(X\).a_text\))462 2706 A
4410 V
(01454)210 648 A
(#define)294 1026 A
(A_HASRELS\(X\))504 1362 A
(\(\(X\).a_hdrlen)546 2034 A
2622(>)S
(\(unsigned)378 2706 A
(char\))210 3126 A
(A_MINHDR\))378 3378 A
4500 V
(01455)210 648 A
(#define)294 1026 A
(A_HASEXT\(X\))462 1362 A
(\(\(X\).a_hdrlen)546 2034 A
2622(>)S
(\(unsigned)378 2706 A
(char\))210 3126 A
(\(A_MINHDR)378 3378 A
3798(+)S
(8\)\))126 3924 A
4590 V
(01456)210 648 A
(#define)294 1026 A
(A_HASLNS\(X\))462 1362 A
(\(\(X\).a_hdrlen)546 2034 A
2622(>)S
(\(unsigned)378 2706 A
(char\))210 3126 A
(\(A_MINHDR)378 3378 A
3798(+)S
(16\)\))168 3882 A
4680 V
(01457)210 648 A
(#define)294 1026 A
(A_HASTOFF\(X\))504 1362 A
(\(\(X\).a_hdrlen)546 2034 A
2622(>)S
(\(unsigned)378 2706 A
(char\))210 3126 A
(\(A_MINHDR)378 3378 A
3798(+)S
(24\)\))168 3882 A
4770 V
(01458)210 648 A
(#define)294 1026 A
(A_TRELPOS\(X\))504 1362 A
(\(A_DATAPOS\(X\))546 2034 A
2622(+)S
(\(X\).a_data\))462 2706 A
4860 V
(01459)210 648 A
(#define)294 1026 A
(A_DRELPOS\(X\))504 1362 A
(\(A_TRELPOS\(X\))546 2034 A
2622(+)S
(\(X\).a_trsize\))546 2706 A
4950 V
(01460)210 648 A
(#define)294 1026 A
(A_SYMPOS\(X\))462 1362 A
(\(A_TRELPOS\(X\))546 2034 A
2622(+)S
(\(A_HASRELS\(X\))546 2706 A
3294(?)S
3378(\\)S
5040 V
(01461)210 648 A
(\(\(X\).a_trsize)546 2034 A
2622(+)S
(\(X\).a_drsize\))546 2706 A
3294(:)S
(0\)\))126 3378 A
5130 V
(01462)210 648 A
5220 V
(01463)210 648 A
(struct)252 1026 A
(reloc)210 1320 A
1572({)S
5310 V
(01464)210 648 A
(long)168 1110 A
(r_vaddr;)336 1320 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
3168(of)S
(reference)378 3294 A
3714(*/)S
5400 V
(01465)210 648 A
(unsigned)336 1110 A
(short)210 1488 A
(r_symndx;)378 1740 A
2370(/*)S
(internal)336 2496 A
(segnum)252 2874 A
3168(or)S
(extern)252 3294 A
(symbol)252 3588 A
(num)126 3882 A
4050(*/)S
5490 V
(01466)210 648 A
(unsigned)336 1110 A
(short)210 1488 A
(r_type;)294 1740 A
2370(/*)S
(relocation)420 2496 A
(type)168 2958 A
3168(*/)S
5580 V
(01467)210 648 A
1026(};)S
5670 V
(01468)210 648 A
5760 V
(01469)210 648 A
1026(/*)S
(r_tyep)252 1152 A
(values:)294 1446 A
1782(*/)S
5850 V
(01470)210 648 A
(#define)294 1026 A
(R_ABBS)252 1362 A
2034(0)S
5940 V
(01471)210 648 A
(#define)294 1026 A
(R_RELLBYTE)420 1362 A
2034(2)S
6030 V
(01472)210 648 A
(#define)294 1026 A
(R_PCRBYTE)378 1362 A
2034(3)S
6120 V
(01473)210 648 A
(#define)294 1026 A
(R_RELWORD)378 1362 A
2034(4)S
6210 V
(01474)210 648 A
(#define)294 1026 A
(R_PCRWORD)378 1362 A
2034(5)S
8418 V
EP
%%Page: 19 19
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2091(File:)S
2324(include/a.out.h)S
12 B
4308(19)S
900 V
7 LST
(01475)210 648 A
(#define)294 1026 A
(R_RELLONG)378 1362 A
2034(6)S
990 V
(01476)210 648 A
(#define)294 1026 A
(R_PCRLONG)378 1362 A
2034(7)S
1080 V
(01477)210 648 A
(#define)294 1026 A
(R_REL3BYTE)420 1362 A
2034(8)S
1170 V
(01478)210 648 A
(#define)294 1026 A
(R_KBRANCHE)420 1362 A
2034(9)S
1260 V
(01479)210 648 A
1350 V
(01480)210 648 A
1026(/*)S
(r_symndx)336 1152 A
(for)126 1530 A
(internal)336 1698 A
(segments)336 2076 A
2454(*/)S
1440 V
(01481)210 648 A
(#define)294 1026 A
(S_ABS)210 1362 A
(\(\(unsigned)420 2034 A
(short\)-1\))378 2496 A
1530 V
(01482)210 648 A
(#define)294 1026 A
(S_TEXT)252 1362 A
(\(\(unsigned)420 2034 A
(short\)-2\))378 2496 A
1620 V
(01483)210 648 A
(#define)294 1026 A
(S_DATA)252 1362 A
(\(\(unsigned)420 2034 A
(short\)-3\))378 2496 A
1710 V
(01484)210 648 A
(#define)294 1026 A
(S_BSS)210 1362 A
(\(\(unsigned)420 2034 A
(short\)-4\))378 2496 A
1800 V
(01485)210 648 A
1890 V
(01486)210 648 A
(struct)252 1026 A
(nlist)210 1320 A
1572({)S
2370(/*)S
(symbol)252 2496 A
(table)210 2790 A
(entry)210 3042 A
3294(*/)S
1980 V
(01487)210 648 A
(char)168 1110 A
(n_name[8];)420 1320 A
2370(/*)S
(symbol)252 2496 A
(name)168 2790 A
3000(*/)S
2070 V
(01488)210 648 A
(long)168 1110 A
(n_value;)336 1320 A
2370(/*)S
(value)210 2496 A
2748(*/)S
2160 V
(01489)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(n_sclass;)378 1698 A
2370(/*)S
(storage)294 2496 A
(class)210 2832 A
3084(*/)S
2250 V
(01490)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(n_numaux;)378 1698 A
2370(/*)S
(number)252 2496 A
2790(of)S
(auxiliary)378 2916 A
(entries)294 3336 A
(\(not)168 3672 A
(used\))210 3882 A
4134(*/)S
2340 V
(01491)210 648 A
(unsigned)336 1110 A
(short)210 1488 A
(n_type;)294 1740 A
2370(/*)S
(language)336 2496 A
(base)168 2874 A
(and)126 3084 A
(derived)294 3252 A
(type)168 3588 A
(\(not)168 3798 A
(used\))210 4008 A
4260(*/)S
2430 V
(01492)210 648 A
1026(};)S
2520 V
(01493)210 648 A
2610 V
(01494)210 648 A
1026(/*)S
(Low)126 1152 A
(bits)168 1320 A
1530(of)S
(storage)294 1656 A
(class)210 1992 A
(\(section\).)420 2244 A
2706(*/)S
2700 V
(01495)210 648 A
(#define)294 1026 A
(N_SECT)252 1362 A
2118(07)S
2370(/*)S
(section)294 2496 A
(mask)168 2832 A
3042(*/)S
2790 V
(01496)210 648 A
(#define)294 1026 A
(N_UNDF)252 1362 A
2118(00)S
2370(/*)S
(undefined)378 2496 A
2916(*/)S
2880 V
(01497)210 648 A
(#define)294 1026 A
(N_ABS)210 1362 A
2118(01)S
2370(/*)S
(absolute)336 2496 A
2874(*/)S
2970 V
(01498)210 648 A
(#define)294 1026 A
(N_TEXT)252 1362 A
2118(02)S
2370(/*)S
(text)168 2496 A
2706(*/)S
3060 V
(01499)210 648 A
(#define)294 1026 A
(N_DATA)252 1362 A
2118(03)S
2370(/*)S
(data)168 2496 A
2706(*/)S
3150 V
(01500)210 648 A
(#define)294 1026 A
(N_BSS)210 1362 A
2118(04)S
2370(/*)S
(bss)126 2496 A
2664(*/)S
3240 V
(01501)210 648 A
(#define)294 1026 A
(N_COMM)252 1362 A
2118(05)S
2370(/*)S
(\(common\))336 2496 A
2874(*/)S
3330 V
(01502)210 648 A
3420 V
(01503)210 648 A
1026(/*)S
(High)168 1152 A
(bits)168 1362 A
1572(of)S
(storage)294 1698 A
(class.)252 2034 A
2328(*/)S
3510 V
(01504)210 648 A
(#define)294 1026 A
(N_CLASS)294 1362 A
(0370)168 2034 A
2370(/*)S
(storage)294 2496 A
(class)210 2832 A
(mask)168 3084 A
3294(*/)S
3600 V
(01505)210 648 A
(#define)294 1026 A
(C_NULL)252 1362 A
3690 V
(01506)210 648 A
(#define)294 1026 A
(C_EXT)210 1362 A
(0020)168 2034 A
2370(/*)S
(external)336 2496 A
(symbol)252 2874 A
3168(*/)S
3780 V
(01507)210 648 A
(#define)294 1026 A
(C_STAT)252 1362 A
(0030)168 2034 A
2370(/*)S
(static)252 2496 A
2790(*/)S
3870 V
(01508)210 648 A
3960 V
(01509)210 648 A
1026(/*)S
(Function)336 1152 A
(prototypes.)462 1530 A
2034(*/)S
4050 V
(01510)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
4140 V
(01511)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
4230 V
(01512)210 648 A
(#endif)252 1026 A
4320 V
(01513)210 648 A
4410 V
(01514)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(nlist,)252 1698 A
(\(char)210 1992 A
(*_file,)294 2244 A
(struct)252 2580 A
(nlist)210 2874 A
(*_nl\))210 3126 A
4050(\);)S
4500 V
(01515)210 648 A
4590 V
(01516)210 648 A
(#endif)252 1026 A
1320(/*)S
(_AOUT_H)294 1446 A
1782(*/)S
5040 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5130 V
(include/sys/types.h)798 2034 A
5220 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5400 V
(01600)210 648 A
1026(/*)S
(The)126 1152 A
(<sys/types.h>)546 1320 A
(header)252 1908 A
(contains)336 2202 A
(important)378 2580 A
(data)168 3000 A
(type)168 3210 A
(definitions.)504 3420 A
5490 V
(01601)210 648 A
1068(*)S
1152(It)S
1278(is)S
(considered)420 1404 A
(good)168 1866 A
(programming)462 2076 A
(practice)336 2580 A
2958(to)S
(use)126 3084 A
(these)210 3252 A
(definitions,)504 3504 A
5580 V
(01602)210 648 A
1068(*)S
(instead)294 1152 A
1488(of)S
(the)126 1614 A
(underlying)420 1782 A
(base)168 2244 A
(type.)210 2454 A
2748(By)S
(convention,)462 2874 A
(all)126 3378 A
(type)168 3546 A
(names)210 3756 A
(end)126 4008 A
5670 V
(01603)210 648 A
1068(*)S
(with)168 1152 A
(_t.)126 1362 A
5760 V
(01604)210 648 A
1068(*/)S
5850 V
(01605)210 648 A
5940 V
(01606)210 648 A
(#ifndef)294 1026 A
(_TYPES_H)336 1362 A
6030 V
(01607)210 648 A
(#define)294 1026 A
(_TYPES_H)336 1362 A
6120 V
(01608)210 648 A
6210 V
(01609)210 648 A
1026(/*)S
(_ANSI)210 1152 A
1404(is)S
(somehow)294 1530 A
(used)168 1866 A
2076(to)S
(determine)378 2202 A
(whether)294 2622 A
2958(or)S
(not)126 3084 A
(the)126 3252 A
(compiler)336 3420 A
3798(is)S
3924(a)S
8418 V
EP
%%Page: 20 20
BP
/slant 0 def
/height 0 def
630 V
12 B
648(20)S
11 R
1998(File:)S
2231(include/sys/types.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(01610)210 648 A
1068(*)S
1152(16)S
(bit)126 1278 A
(compiler)336 1446 A
990 V
(01611)210 648 A
1068(*/)S
1080 V
(01612)210 648 A
(#ifndef)294 1026 A
(_ANSI)210 1362 A
1170 V
(01613)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
1260 V
(01614)210 648 A
(#endif)252 1026 A
1350 V
(01615)210 648 A
1440 V
(01616)210 648 A
1026(/*)S
(The)126 1152 A
(type)168 1320 A
(size_t)252 1530 A
(holds)210 1824 A
(all)126 2076 A
(results)294 2244 A
2580(of)S
(the)126 2706 A
(sizeof)252 2874 A
(operator.)378 3168 A
3630(At)S
(first)210 3756 A
(glance,)294 4008 A
1530 V
(01617)210 648 A
1068(*)S
1152(it)S
(seems)210 1278 A
(obvious)294 1530 A
(that)168 1866 A
2076(it)S
(should)252 2202 A
2496(be)S
2622(an)S
(unsigned)336 2748 A
(int,)168 3126 A
(but)126 3336 A
(this)168 3504 A
3714(is)S
(not)126 3840 A
(always)252 4008 A
1620 V
(01618)210 648 A
1068(*)S
(the)126 1152 A
(case.)210 1320 A
(For)126 1572 A
(example,)336 1740 A
(MINIX-ST)336 2118 A
(\(68000\))294 2496 A
(has)126 2832 A
(32-bit)252 3000 A
(pointers)336 3294 A
(and)126 3672 A
(16-bit)252 3840 A
1710 V
(01619)210 648 A
1068(*)S
(integers.)378 1152 A
(When)168 1572 A
(one)126 1782 A
(asks)168 1950 A
(for)126 2160 A
(the)126 2328 A
(size)168 2496 A
2706(of)S
2832(a)S
(70K)126 2916 A
(struct)252 3084 A
3378(or)S
(array,)252 3504 A
(the)126 3798 A
(result)252 3966 A
1800 V
(01620)210 648 A
1068(*)S
(requires)336 1152 A
1530(17)S
(bits)168 1656 A
1866(to)S
(express,)336 1992 A
2370(so)S
(size_t)252 2496 A
(must)168 2790 A
3000(be)S
3126(a)S
(long)168 3210 A
(type.)210 3420 A
(The)126 3714 A
(type)168 3882 A
1890 V
(01621)210 648 A
1068(*)S
(ssize_t)294 1152 A
1488(is)S
(the)126 1614 A
(signed)252 1782 A
(version)294 2076 A
2412(of)S
(size_t.)294 2538 A
1980 V
(01622)210 648 A
1068(*/)S
2070 V
(01623)210 648 A
(#ifndef)294 1026 A
(_SIZE_T)294 1362 A
2160 V
(01624)210 648 A
(#define)294 1026 A
(_SIZE_T)294 1362 A
2250 V
(01625)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(size_t;)294 1908 A
2340 V
(01626)210 648 A
(#endif)252 1026 A
2430 V
(01627)210 648 A
2520 V
(01628)210 648 A
(#ifndef)294 1026 A
(_SSIZE_T)336 1362 A
2610 V
(01629)210 648 A
(#define)294 1026 A
(_SSIZE_T)336 1362 A
2700 V
(01630)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(ssize_t;)336 1530 A
2790 V
(01631)210 648 A
(#endif)252 1026 A
2880 V
(01632)210 648 A
2970 V
(01633)210 648 A
(#ifndef)294 1026 A
(_TIME_T)294 1362 A
3060 V
(01634)210 648 A
(#define)294 1026 A
(_TIME_T)294 1362 A
3150 V
(01635)210 648 A
(typedef)294 1026 A
(long)168 1362 A
(time_t;)294 1572 A
2496(/*)S
(time)168 2622 A
2832(in)S
(sec)126 2958 A
(since)210 3126 A
3378(1)S
(Jan)126 3462 A
(1970)168 3630 A
(0000)168 3840 A
(GMT)126 4050 A
4218(*/)S
3240 V
(01636)210 648 A
(#endif)252 1026 A
3330 V
(01637)210 648 A
3420 V
(01638)210 648 A
(#ifndef)294 1026 A
(_CLOCK_T)336 1362 A
3510 V
(01639)210 648 A
(#define)294 1026 A
(_CLOCK_T)336 1362 A
3600 V
(01640)210 648 A
(typedef)294 1026 A
(long)168 1362 A
(clock_t;)336 1572 A
2496(/*)S
(unit)168 2622 A
(for)126 2832 A
(system)252 3000 A
(accounting)420 3294 A
3756(*/)S
3690 V
(01641)210 648 A
(#endif)252 1026 A
3780 V
(01642)210 648 A
3870 V
(01643)210 648 A
(#ifndef)294 1026 A
(_SIGSET_T)378 1362 A
3960 V
(01644)210 648 A
(#define)294 1026 A
(_SIGSET_T)378 1362 A
4050 V
(01645)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(long)168 1740 A
(sigset_t;)378 1950 A
4140 V
(01646)210 648 A
(#endif)252 1026 A
4230 V
(01647)210 648 A
4320 V
(01648)210 648 A
1026(/*)S
(Types)210 1152 A
(used)168 1404 A
1614(in)S
(disk,)210 1740 A
(inode,)252 1992 A
(etc.)168 2286 A
(data)168 2496 A
(structures.)462 2706 A
3210(*/)S
4410 V
(01649)210 648 A
(typedef)294 1026 A
(short)210 1362 A
(dev_t;)252 1992 A
2496(/*)S
(holds)210 2622 A
(\(major|minor\))546 2874 A
(device)252 3462 A
(pair)168 3756 A
3966(*/)S
4500 V
(01650)210 648 A
(typedef)294 1026 A
(char)168 1362 A
(gid_t;)252 1992 A
2496(/*)S
(group)210 2622 A
2874(id)S
3000(*/)S
4590 V
(01651)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(short)210 1740 A
(ino_t;)252 1992 A
2496(/*)S
(i-node)252 2622 A
(number)252 2916 A
3210(*/)S
4680 V
(01652)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(short)210 1740 A
(mode_t;)294 1992 A
2496(/*)S
(file)168 2622 A
(type)168 2832 A
(and)126 3042 A
(permissions)462 3210 A
(bits)168 3714 A
3924(*/)S
4770 V
(01653)210 648 A
(typedef)294 1026 A
(char)168 1362 A
(nlink_t;)336 1908 A
2496(/*)S
(number)252 2622 A
2916(of)S
(links)210 3042 A
3294(to)S
3420(a)S
(file)168 3504 A
3714(*/)S
4860 V
(01654)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(long)168 1740 A
(off_t;)252 1992 A
2496(/*)S
(offset)252 2622 A
(within)252 2916 A
3210(a)S
(file)168 3294 A
3504(*/)S
4950 V
(01655)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(pid_t;)252 1992 A
2496(/*)S
(process)294 2622 A
2958(id)S
(\(must)210 3084 A
3336(be)S
(signed\))294 3462 A
3798(*/)S
5040 V
(01656)210 648 A
(typedef)294 1026 A
(short)210 1362 A
(uid_t;)252 1992 A
2496(/*)S
(user)168 2622 A
2832(id)S
2958(*/)S
5130 V
(01657)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(long)168 1740 A
(zone_t;)294 1950 A
2496(/*)S
(zone)168 2622 A
(number)252 2832 A
3126(*/)S
5220 V
(01658)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(long)168 1740 A
(block_t;)336 1950 A
2496(/*)S
(block)210 2622 A
(number)252 2874 A
3168(*/)S
5310 V
(01659)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(long)168 1740 A
(bit_t;)252 1992 A
2496(/*)S
(bit)126 2622 A
(number)252 2790 A
3084(in)S
3210(a)S
(bit)126 3294 A
(map)126 3462 A
3630(*/)S
5400 V
(01660)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(short)210 1740 A
(zone1_t;)336 1992 A
2496(/*)S
(zone)168 2622 A
(number)252 2832 A
(for)126 3126 A
3294(V1)S
(file)168 3420 A
(systems)294 3630 A
3966(*/)S
5490 V
(01661)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(short)210 1740 A
(bitchunk_t;)462 1992 A
2496(/*)S
(collection)420 2622 A
3084(of)S
(bits)168 3210 A
3420(in)S
3546(a)S
(bitmap)252 3630 A
3924(*/)S
5580 V
(01662)210 648 A
5670 V
(01663)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(char)168 1740 A
(u8_t;)210 2034 A
2496(/*)S
2622(8)S
(bit)126 2706 A
(type)168 2874 A
3084(*/)S
5760 V
(01664)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(short)210 1740 A
(u16_t;)252 1992 A
2496(/*)S
2622(16)S
(bit)126 2748 A
(type)168 2916 A
3126(*/)S
5850 V
(01665)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(long)168 1740 A
(u32_t;)252 1992 A
2496(/*)S
2622(32)S
(bit)126 2748 A
(type)168 2916 A
3126(*/)S
5940 V
(01666)210 648 A
6030 V
(01667)210 648 A
(typedef)294 1026 A
(char)168 1362 A
(i8_t;)210 2034 A
2496(/*)S
2622(8)S
(bit)126 2706 A
(signed)252 2874 A
(type)168 3168 A
3378(*/)S
6120 V
(01668)210 648 A
(typedef)294 1026 A
(short)210 1362 A
(i16_t;)252 1992 A
2496(/*)S
2622(16)S
(bit)126 2748 A
(signed)252 2916 A
(type)168 3210 A
3420(*/)S
6210 V
(01669)210 648 A
(typedef)294 1026 A
(long)168 1362 A
(i32_t;)252 1992 A
2496(/*)S
2622(32)S
(bit)126 2748 A
(signed)252 2916 A
(type)168 3210 A
3420(*/)S
8418 V
EP
%%Page: 21 21
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1998(File:)S
2231(include/sys/types.h)S
12 B
4308(21)S
900 V
7 LST
(01670)210 648 A
990 V
(01671)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(types)210 1740 A
(are)126 1992 A
(needed)252 2160 A
(because)294 2454 A
(MINIX)210 2790 A
(uses)168 3042 A
(K&R)126 3252 A
(style)210 3420 A
(function)336 3672 A
1080 V
(01672)210 648 A
1068(*)S
(definitions)462 1152 A
(\(for)168 1656 A
(maximum)294 1866 A
(portability\).)546 2202 A
(When)168 2832 A
3042(a)S
(short,)252 3126 A
(such)168 3420 A
3630(as)S
(dev_t,)252 3756 A
4050(is)S
1170 V
(01673)210 648 A
1068(*)S
(passed)252 1152 A
1446(to)S
1572(a)S
(function)336 1656 A
(with)168 2034 A
2244(a)S
(K&R)126 2328 A
(definition,)462 2496 A
(the)126 3000 A
(compiler)336 3168 A
(automatically)546 3546 A
1260 V
(01674)210 648 A
1068(*)S
(promotes)336 1152 A
1530(it)S
1656(to)S
1782(an)S
(int.)168 1908 A
(The)126 2160 A
(prototype)378 2328 A
(must)168 2748 A
(contain)294 2958 A
3294(an)S
(int)126 3420 A
3588(as)S
(the)126 3714 A
(parameter,)420 3882 A
1350 V
(01675)210 648 A
1068(*)S
(not)126 1152 A
1320(a)S
(short,)252 1404 A
(because)294 1698 A
2034(an)S
(int)126 2160 A
2328(is)S
(what)168 2454 A
2664(an)S
(old-style)378 2790 A
(function)336 3210 A
(definition)420 3588 A
1440 V
(01676)210 648 A
1068(*)S
(expects.)336 1152 A
(Thus)168 1572 A
(using)210 1782 A
(dev_t)210 2034 A
2286(in)S
2412(a)S
(prototype)378 2496 A
(would)210 2916 A
3168(be)S
(incorrect.)420 3294 A
3798(It)S
(would)210 3924 A
4176(be)S
1530 V
(01677)210 648 A
1068(*)S
(sufficient)420 1152 A
1614(to)S
(just)168 1740 A
(use)126 1950 A
(int)126 2118 A
(instead)294 2286 A
2622(of)S
(dev_t)210 2748 A
3000(in)S
(the)126 3126 A
(prototypes,)462 3294 A
(but)126 3798 A
(Dev_t)210 3966 A
1620 V
(01678)210 648 A
1068(*)S
1152(is)S
(clearer.)336 1278 A
1710 V
(01679)210 648 A
1068(*/)S
1800 V
(01680)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(Dev_t;)252 1992 A
1890 V
(01681)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(Gid_t;)252 1992 A
1980 V
(01682)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(Nlink_t;)336 1908 A
2070 V
(01683)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(Uid_t;)252 1992 A
2160 V
(01684)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(U8_t;)210 2034 A
2250 V
(01685)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(long)168 1740 A
(U32_t;)252 1992 A
2340 V
(01686)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(I8_t;)210 2034 A
2430 V
(01687)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(I16_t;)252 1992 A
2520 V
(01688)210 648 A
(typedef)294 1026 A
(long)168 1362 A
(I32_t;)252 2034 A
2610 V
(01689)210 648 A
2700 V
(01690)210 648 A
1026(/*)S
(ANSI)168 1152 A
1362(C)S
(makes)210 1446 A
(writing)294 1698 A
(down)168 2034 A
(the)126 2244 A
(promotion)378 2412 A
2832(of)S
(unsigned)336 2958 A
(types)210 3336 A
(very)168 3588 A
(messy.)252 3798 A
(When)168 4134 A
2790 V
(01691)210 648 A
1068(*)S
(sizeof\(short\))546 1152 A
1740(==)S
(sizeof\(int\),)504 1866 A
(there)210 2412 A
2664(is)S
2790(no)S
(promotion,)420 2916 A
3378(so)S
(the)126 3504 A
(type)168 3672 A
(stays)210 3882 A
2880 V
(01692)210 648 A
1068(*)S
(unsigned.)378 1152 A
(When)168 1614 A
(the)126 1824 A
(compiler)336 1992 A
2370(is)S
(not)126 2496 A
(ANSI,)210 2664 A
(there)210 2916 A
3168(is)S
(usually)294 3294 A
3630(no)S
(loss)168 3756 A
3966(of)S
2970 V
(01693)210 648 A
1068(*)S
(unsignedness,)546 1152 A
(and)126 1740 A
(there)210 1908 A
(are)126 2160 A
(usually)294 2328 A
2664(no)S
(prototypes)420 2790 A
3252(so)S
(the)126 3378 A
(promoted)336 3546 A
(type)168 3924 A
3060 V
(01694)210 648 A
1068(*)S
(doesn't)294 1152 A
(matter.)294 1488 A
(The)126 1866 A
(use)126 2034 A
2202(of)S
(types)210 2328 A
(like)168 2580 A
(Ino_t)210 2790 A
3042(is)S
3168(an)S
(attempt)294 3294 A
3630(to)S
(use)126 3756 A
(ints)168 3924 A
3150 V
(01695)210 648 A
1068(*)S
(\(which)252 1152 A
(are)126 1446 A
(not)126 1614 A
(promoted\))378 1782 A
(while)210 2202 A
(providing)378 2454 A
(information)462 2874 A
3378(to)S
(the)126 3504 A
(reader.)294 3672 A
3240 V
(01696)210 648 A
1068(*/)S
3330 V
(01697)210 648 A
3420 V
(01698)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
3510 V
(01699)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
3600 V
(01700)210 648 A
(#endif)252 1026 A
3690 V
(01701)210 648 A
3780 V
(01702)210 648 A
(#if)126 1026 A
(_EM_WSIZE)378 1194 A
1614(==)S
1740(2)S
1824(||)S
(!defined\(_ANSI\))630 1950 A
3870 V
(01703)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(Ino_t;)252 2118 A
3960 V
(01704)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(Zone1_t;)336 2034 A
4050 V
(01705)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(Bitchunk_t;)462 1908 A
4140 V
(01706)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(U16_t;)252 2118 A
4230 V
(01707)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(Mode_t;)294 1950 A
4320 V
(01708)210 648 A
4410 V
(01709)210 648 A
(#else)210 1026 A
1278(/*)S
(_EM_WSIZE)378 1404 A
1824(==)S
1950(4,)S
2076(or)S
(_EM_WSIZE)378 2202 A
(undefined,)420 2622 A
3084(or)S
(_ANSI)210 3210 A
(defined)294 3462 A
3798(*/)S
4500 V
(01710)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(Ino_t;)252 2118 A
4590 V
(01711)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(Zone1_t;)336 2034 A
4680 V
(01712)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(Bitchunk_t;)462 1908 A
4770 V
(01713)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(U16_t;)252 2118 A
4860 V
(01714)210 648 A
(typedef)294 1026 A
(int)126 1362 A
(Mode_t;)294 1950 A
4950 V
(01715)210 648 A
5040 V
(01716)210 648 A
(#endif)252 1026 A
1320(/*)S
(_EM_WSIZE)378 1446 A
1866(==)S
1992(2,)S
(etc)126 2118 A
2286(*/)S
5130 V
(01717)210 648 A
5220 V
(01718)210 648 A
1026(/*)S
(Signal)252 1152 A
(handler)294 1446 A
(type,)210 1782 A
(e.g.)168 2034 A
(SIG_IGN)294 2244 A
2580(*/)S
5310 V
(01719)210 648 A
(#if)126 1026 A
(defined\(_ANSI\))588 1194 A
5400 V
(01720)210 648 A
(typedef)294 1026 A
(void)168 1362 A
(\(*sighandler_t\))630 1572 A
(\(int\);)252 2244 A
5490 V
(01721)210 648 A
(#else)210 1026 A
5580 V
(01722)210 648 A
(typedef)294 1026 A
(void)168 1362 A
(\(*sighandler_t\)\(\);)756 1572 A
5670 V
(01723)210 648 A
(#endif)252 1026 A
5760 V
(01724)210 648 A
5850 V
(01725)210 648 A
(#endif)252 1026 A
1320(/*)S
(_TYPES_H)336 1446 A
1824(*/)S
8418 V
EP
%%Page: 22 22
BP
/slant 0 def
/height 0 def
630 V
12 B
648(22)S
11 R
2016(File:)S
2249(include/sys/ioctl.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(include/sys/ioctl.h)798 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(01800)210 648 A
1026(/*)S
(The)126 1152 A
(ioctl.h)294 1320 A
(header)252 1656 A
(declares)336 1950 A
(device)252 2328 A
(controlling)462 2622 A
(operations.)462 3126 A
3630(*/)S
1440 V
(01801)210 648 A
1530 V
(01802)210 648 A
(#ifndef)294 1026 A
(_IOCTL_H)336 1362 A
1620 V
(01803)210 648 A
(#define)294 1026 A
(_IOCTL_H)336 1362 A
1710 V
(01804)210 648 A
1800 V
(01805)210 648 A
(#if)126 1026 A
(_EM_WSIZE)378 1194 A
1614(>=)S
1740(4)S
1890 V
(01806)210 648 A
1026(/*)S
(Ioctls)252 1152 A
(have)168 1446 A
(the)126 1656 A
(command)294 1824 A
(encoded)294 2160 A
2496(in)S
(the)126 2622 A
(low-order)378 2790 A
(word,)210 3210 A
(and)126 3462 A
(the)126 3630 A
(size)168 3798 A
1980 V
(01807)210 648 A
1068(*)S
1152(of)S
(the)126 1278 A
(parameter)378 1446 A
1866(in)S
(the)126 1992 A
(high-order)420 2160 A
(word.)210 2622 A
(The)126 2874 A
3042(3)S
(high)168 3126 A
(bits)168 3336 A
3546(of)S
(the)126 3672 A
(high-)210 3840 A
2070 V
(01808)210 648 A
1068(*)S
(order)210 1152 A
(word)168 1404 A
(are)126 1614 A
(used)168 1782 A
1992(to)S
(encode)252 2118 A
(the)126 2412 A
(in/out/void)462 2580 A
(status)252 3084 A
3378(of)S
(the)126 3504 A
(parameter.)420 3672 A
2160 V
(01809)210 648 A
1068(*/)S
2250 V
(01810)210 648 A
2340 V
(01811)210 648 A
(#define)294 1026 A
(_IOCPARM_MASK)546 1362 A
(0x1FFF)252 2034 A
2430 V
(01812)210 648 A
(#define)294 1026 A
(_IOC_VOID)378 1362 A
(0x20000000)420 2034 A
2520 V
(01813)210 648 A
(#define)294 1026 A
(_IOCTYPE_MASK)546 1362 A
(0xFFFF)252 2034 A
2610 V
(01814)210 648 A
(#define)294 1026 A
(_IOC_IN)294 1362 A
(0x40000000)420 2034 A
2700 V
(01815)210 648 A
(#define)294 1026 A
(_IOC_OUT)336 1362 A
(0x80000000)420 2034 A
2790 V
(01816)210 648 A
(#define)294 1026 A
(_IOC_INOUT)420 1362 A
(\(_IOC_IN)336 2034 A
2412(|)S
(_IOC_OUT\))378 2496 A
2880 V
(01817)210 648 A
2970 V
(01818)210 648 A
(#define)294 1026 A
(_IO\(x,y\))336 1362 A
(\(\(x)126 2034 A
2202(<<)S
2328(8\))S
2454(|)S
2538(y)S
2622(|)S
(_IOC_VOID\))420 2706 A
3060 V
(01819)210 648 A
(#define)294 1026 A
(_IOR\(x,y,t\))462 1362 A
(\(\(x)126 2034 A
2202(<<)S
2328(8\))S
2454(|)S
2538(y)S
2622(|)S
(\(\(sizeof\(t\))462 2706 A
3210(&)S
(_IOCPARM_MASK\))588 3294 A
3924(<<)S
(16\))126 4050 A
4218(|\\)S
3150 V
(01820)210 648 A
(_IOC_OUT\))378 2370 A
3240 V
(01821)210 648 A
(#define)294 1026 A
(_IOW\(x,y,t\))462 1362 A
(\(\(x)126 2034 A
2202(<<)S
2328(8\))S
2454(|)S
2538(y)S
2622(|)S
(\(\(sizeof\(t\))462 2706 A
3210(&)S
(_IOCPARM_MASK\))588 3294 A
3924(<<)S
(16\))126 4050 A
4218(|\\)S
3330 V
(01822)210 648 A
(_IOC_IN\))336 2370 A
3420 V
(01823)210 648 A
(#define)294 1026 A
(_IORW\(x,y,t\))504 1362 A
(\(\(x)126 2034 A
2202(<<)S
2328(8\))S
2454(|)S
2538(y)S
2622(|)S
(\(\(sizeof\(t\))462 2706 A
3210(&)S
(_IOCPARM_MASK\))588 3294 A
3924(<<)S
(16\))126 4050 A
4218(|\\)S
3510 V
(01824)210 648 A
(_IOC_INOUT\))462 2370 A
3600 V
(01825)210 648 A
(#else)210 1026 A
3690 V
(01826)210 648 A
1026(/*)S
1152(No)S
(fancy)210 1278 A
(encoding)336 1530 A
1908(on)S
2034(a)S
(16-bit)252 2118 A
(machine.)336 2412 A
2790(*/)S
3780 V
(01827)210 648 A
3870 V
(01828)210 648 A
(#define)294 1026 A
(_IO\(x,y\))336 1362 A
(\(\(x)126 2034 A
2202(<<)S
2328(8\))S
2454(|)S
2538(y\))S
3960 V
(01829)210 648 A
(#define)294 1026 A
(_IOR\(x,y,t\))462 1362 A
(_IO\(x,y\))336 2034 A
4050 V
(01830)210 648 A
(#define)294 1026 A
(_IOW\(x,y,t\))462 1362 A
(_IO\(x,y\))336 2034 A
4140 V
(01831)210 648 A
(#define)294 1026 A
(_IORW\(x,y,t\))504 1362 A
(_IO\(x,y\))336 2034 A
4230 V
(01832)210 648 A
(#endif)252 1026 A
4320 V
(01833)210 648 A
4410 V
(01834)210 648 A
4500 V
(01835)210 648 A
1026(/*)S
(Terminal)336 1152 A
(ioctls.)294 1530 A
1866(*/)S
4590 V
(01836)210 648 A
(#define)294 1026 A
(TCGETS)252 1362 A
(_IOR\('T',)378 2034 A
2496(8,)S
(struct)252 2622 A
(termios\))336 2916 A
3294(/*)S
(tcgetattr)378 3420 A
3840(*/)S
4680 V
(01837)210 648 A
(#define)294 1026 A
(TCSETS)252 1362 A
(_IOW\('T',)378 2034 A
2496(9,)S
(struct)252 2622 A
(termios\))336 2916 A
3294(/*)S
(tcsetattr,)420 3420 A
(TCSANOW)294 3882 A
4218(*/)S
4770 V
(01838)210 648 A
(#define)294 1026 A
(TCSETSW)294 1362 A
(_IOW\('T',)378 2034 A
(10,)126 2454 A
(struct)252 2622 A
(termios\))336 2916 A
3294(/*)S
(tcsetattr,)420 3420 A
(TCSADRAIN)378 3882 A
4302(*/)S
4860 V
(01839)210 648 A
(#define)294 1026 A
(TCSETSF)294 1362 A
(_IOW\('T',)378 2034 A
(11,)126 2454 A
(struct)252 2622 A
(termios\))336 2916 A
3294(/*)S
(tcsetattr,)420 3420 A
(TCSAFLUSH)378 3882 A
4302(*/)S
4950 V
(01840)210 648 A
(#define)294 1026 A
(TCSBRK)252 1362 A
(_IOW\('T',)378 2034 A
(12,)126 2454 A
(int\))168 2622 A
3294(/*)S
(tcsendbreak)462 3420 A
3924(*/)S
5040 V
(01841)210 648 A
(#define)294 1026 A
(TCDRAIN)294 1362 A
(_IO)126 2034 A
(\('T',)210 2202 A
(13\))126 2454 A
3294(/*)S
(tcdrain)294 3420 A
3756(*/)S
5130 V
(01842)210 648 A
(#define)294 1026 A
(TCFLOW)252 1362 A
(_IOW\('T',)378 2034 A
(14,)126 2454 A
(int\))168 2622 A
3294(/*)S
(tcflow)252 3420 A
3714(*/)S
5220 V
(01843)210 648 A
(#define)294 1026 A
(TCFLSH)252 1362 A
(_IOW\('T',)378 2034 A
(15,)126 2454 A
(int\))168 2622 A
3294(/*)S
(tcflush)294 3420 A
3756(*/)S
5310 V
(01844)210 648 A
(#define)294 1026 A
(TIOCGWINSZ)420 1362 A
(_IOR\('T',)378 2034 A
(16,)126 2454 A
(struct)252 2622 A
(winsize\))336 2916 A
5400 V
(01845)210 648 A
(#define)294 1026 A
(TIOCSWINSZ)420 1362 A
(_IOW\('T',)378 2034 A
(17,)126 2454 A
(struct)252 2622 A
(winsize\))336 2916 A
5490 V
(01846)210 648 A
(#define)294 1026 A
(TIOCGPGRP)378 1362 A
(_IOW\('T',)378 2034 A
(18,)126 2454 A
(int\))168 2622 A
5580 V
(01847)210 648 A
(#define)294 1026 A
(TIOCSPGRP)378 1362 A
(_IOW\('T',)378 2034 A
(19,)126 2454 A
(int\))168 2622 A
5670 V
(01848)210 648 A
(#define)294 1026 A
(TIOCSFON)336 1362 A
(_IOW\('T',)378 2034 A
(20,)126 2454 A
(u8_t)168 2622 A
([8192]\))294 2832 A
5760 V
(01849)210 648 A
5850 V
(01850)210 648 A
(#define)294 1026 A
(TIOCGETP)336 1362 A
(_IOR\('t',)378 2034 A
2496(1,)S
(struct)252 2622 A
(sgttyb\))294 2916 A
5940 V
(01851)210 648 A
(#define)294 1026 A
(TIOCSETP)336 1362 A
(_IOW\('t',)378 2034 A
2496(2,)S
(struct)252 2622 A
(sgttyb\))294 2916 A
6030 V
(01852)210 648 A
(#define)294 1026 A
(TIOCGETC)336 1362 A
(_IOR\('t',)378 2034 A
2496(3,)S
(struct)252 2622 A
(tchars\))294 2916 A
6120 V
(01853)210 648 A
(#define)294 1026 A
(TIOCSETC)336 1362 A
(_IOW\('t',)378 2034 A
2496(4,)S
(struct)252 2622 A
(tchars\))294 2916 A
6210 V
(01854)210 648 A
8418 V
EP
%%Page: 23 23
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2016(File:)S
2249(include/sys/ioctl.h)S
12 B
4308(23)S
900 V
7 LST
(01855)210 648 A
990 V
(01856)210 648 A
1026(/*)S
(Network)294 1152 A
(ioctls.)294 1488 A
1824(*/)S
1080 V
(01857)210 648 A
(#define)294 1026 A
(NWIOSETHOPT)462 1362 A
(_IOW\('n',)378 2034 A
(16,)126 2454 A
(struct)252 2622 A
(nwio_ethopt\))504 2916 A
1170 V
(01858)210 648 A
(#define)294 1026 A
(NWIOGETHOPT)462 1362 A
(_IOR\('n',)378 2034 A
(17,)126 2454 A
(struct)252 2622 A
(nwio_ethopt\))504 2916 A
1260 V
(01859)210 648 A
(#define)294 1026 A
(NWIOGETHSTAT)504 1362 A
(_IOR\('n',)378 2034 A
(18,)126 2454 A
(struct)252 2622 A
(nwio_ethstat\))546 2916 A
1350 V
(01860)210 648 A
1440 V
(01861)210 648 A
(#define)294 1026 A
(NWIOSIPCONF)462 1362 A
(_IOW\('n',)378 2034 A
(32,)126 2454 A
(struct)252 2622 A
(nwio_ipconf\))504 2916 A
1530 V
(01862)210 648 A
(#define)294 1026 A
(NWIOGIPCONF)462 1362 A
(_IOR\('n',)378 2034 A
(33,)126 2454 A
(struct)252 2622 A
(nwio_ipconf\))504 2916 A
1620 V
(01863)210 648 A
(#define)294 1026 A
(NWIOSIPOPT)420 1362 A
(_IOW\('n',)378 2034 A
(34,)126 2454 A
(struct)252 2622 A
(nwio_ipopt\))462 2916 A
1710 V
(01864)210 648 A
(#define)294 1026 A
(NWIOGIPOPT)420 1362 A
(_IOR\('n',)378 2034 A
(35,)126 2454 A
(struct)252 2622 A
(nwio_ipopt\))462 2916 A
1800 V
(01865)210 648 A
1890 V
(01866)210 648 A
(#define)294 1026 A
(NWIOIPGROUTE)504 1362 A
(_IORW\('n',)420 2034 A
(40,)126 2496 A
(struct)252 2664 A
(nwio_route\))462 2958 A
1980 V
(01867)210 648 A
(#define)294 1026 A
(NWIOIPSROUTE)504 1362 A
(_IOW)168 2034 A
(\('n',)210 2244 A
(41,)126 2496 A
(struct)252 2664 A
(nwio_route\))462 2958 A
2070 V
(01868)210 648 A
(#define)294 1026 A
(NWIOIPDROUTE)504 1362 A
(_IOW)168 2034 A
(\('n',)210 2244 A
(42,)126 2496 A
(struct)252 2664 A
(nwio_route\))462 2958 A
2160 V
(01869)210 648 A
2250 V
(01870)210 648 A
(#define)294 1026 A
(NWIOSTCPCONF)504 1362 A
(_IOW\('n',)378 2034 A
(48,)126 2454 A
(struct)252 2622 A
(nwio_tcpconf\))546 2916 A
2340 V
(01871)210 648 A
(#define)294 1026 A
(NWIOGTCPCONF)504 1362 A
(_IOR\('n',)378 2034 A
(49,)126 2454 A
(struct)252 2622 A
(nwio_tcpconf\))546 2916 A
2430 V
(01872)210 648 A
(#define)294 1026 A
(NWIOTCPCONN)462 1362 A
(_IOW\('n',)378 2034 A
(50,)126 2454 A
(struct)252 2622 A
(nwio_tcpcl\))462 2916 A
2520 V
(01873)210 648 A
(#define)294 1026 A
(NWIOTCPLISTEN)546 1362 A
(_IOW\('n',)378 2034 A
(51,)126 2454 A
(struct)252 2622 A
(nwio_tcpcl\))462 2916 A
2610 V
(01874)210 648 A
(#define)294 1026 A
(NWIOTCPATTACH)546 1362 A
(_IOW\('n',)378 2034 A
(52,)126 2454 A
(struct)252 2622 A
(nwio_tcpatt\))504 2916 A
2700 V
(01875)210 648 A
(#define)294 1026 A
(NWIOTCPSHUTDOWN)630 1362 A
(_IO)126 2034 A
(\('n',)210 2202 A
(53\))126 2454 A
2790 V
(01876)210 648 A
(#define)294 1026 A
(NWIOSTCPOPT)462 1362 A
(_IOW\('n',)378 2034 A
(54,)126 2454 A
(struct)252 2622 A
(nwio_tcpopt\))504 2916 A
2880 V
(01877)210 648 A
(#define)294 1026 A
(NWIOGTCPOPT)462 1362 A
(_IOR\('n',)378 2034 A
(55,)126 2454 A
(struct)252 2622 A
(nwio_tcpopt\))504 2916 A
2970 V
(01878)210 648 A
3060 V
(01879)210 648 A
(#define)294 1026 A
(NWIOSUDPOPT)462 1362 A
(_IOW\('n',)378 2034 A
(64,)126 2454 A
(struct)252 2622 A
(nwio_udpopt\))504 2916 A
3150 V
(01880)210 648 A
(#define)294 1026 A
(NWIOGUDPOPT)462 1362 A
(_IOR\('n',)378 2034 A
(65,)126 2454 A
(struct)252 2622 A
(nwio_udpopt\))504 2916 A
3240 V
(01881)210 648 A
3330 V
(01882)210 648 A
1026(/*)S
(Disk)168 1152 A
(ioctls.)294 1362 A
1698(*/)S
3420 V
(01883)210 648 A
(#define)294 1026 A
(DIOCEJECT)378 1362 A
(_IO)126 2034 A
(\('d',)210 2202 A
2454(5\))S
3510 V
(01884)210 648 A
(#define)294 1026 A
(DIOCSETP)336 1362 A
(_IOW\('d',)378 2034 A
2454(6,)S
(struct)252 2580 A
(partition\))420 2874 A
3600 V
(01885)210 648 A
(#define)294 1026 A
(DIOCGETP)336 1362 A
(_IOR\('d',)378 2034 A
2454(7,)S
(struct)252 2580 A
(partition\))420 2874 A
3690 V
(01886)210 648 A
3780 V
(01887)210 648 A
1026(/*)S
(Keyboard)336 1152 A
(ioctls.)294 1530 A
1866(*/)S
3870 V
(01888)210 648 A
(#define)294 1026 A
(KIOCSMAP)336 1362 A
(_IOW\('k',)378 2034 A
2454(3,)S
(keymap_t\))378 2580 A
3960 V
(01889)210 648 A
4050 V
(01890)210 648 A
1026(/*)S
(Memory)252 1152 A
(ioctls.)294 1446 A
1782(*/)S
4140 V
(01891)210 648 A
(#define)294 1026 A
(MIOCRAMSIZE)462 1362 A
(_IOW\('m',)378 2034 A
2454(3,)S
(u32_t\))252 2580 A
3042(/*)S
(Size)168 3168 A
3378(of)S
(the)126 3504 A
(ramdisk)294 3672 A
4008(*/)S
4230 V
(01892)210 648 A
(#define)294 1026 A
(MIOCSPSINFO)462 1362 A
(_IOW\('m',)378 2034 A
2454(4,)S
(void)168 2580 A
2790(*\))S
4320 V
(01893)210 648 A
(#define)294 1026 A
(MIOCGPSINFO)462 1362 A
(_IOR\('m',)378 2034 A
2454(5,)S
(struct)252 2580 A
(psinfo\))294 2874 A
4410 V
(01894)210 648 A
4500 V
(01895)210 648 A
1026(/*)S
(Magnetic)336 1152 A
(tape)168 1530 A
(ioctls.)294 1740 A
2076(*/)S
4590 V
(01896)210 648 A
(#define)294 1026 A
(MTIOCTOP)336 1362 A
(_IOW\('M',)378 2034 A
2454(1,)S
(struct)252 2580 A
(mtop\))210 2874 A
4680 V
(01897)210 648 A
(#define)294 1026 A
(MTIOCGET)336 1362 A
(_IOR\('M',)378 2034 A
2454(2,)S
(struct)252 2580 A
(mtget\))252 2874 A
4770 V
(01898)210 648 A
4860 V
(01899)210 648 A
1026(/*)S
(SCSI)168 1152 A
(command.)336 1362 A
1740(*/)S
4950 V
(01900)210 648 A
(#define)294 1026 A
(SCIOCCMD)336 1362 A
(_IOW\('S',)378 2034 A
2454(1,)S
(struct)252 2580 A
(scsicmd\))336 2874 A
5040 V
(01901)210 648 A
5130 V
(01902)210 648 A
1026(/*)S
(CD-ROM)252 1152 A
(ioctls.)294 1446 A
1782(*/)S
5220 V
(01903)210 648 A
(#define)294 1026 A
(CDIOPLAYTI)420 1362 A
(_IOR\('c',)378 2034 A
2454(1,)S
(struct)252 2580 A
(cd_play_track\))588 2874 A
5310 V
(01904)210 648 A
(#define)294 1026 A
(CDIOPLAYMSS)462 1362 A
(_IOR\('c',)378 2034 A
2454(2,)S
(struct)252 2580 A
(cd_play_mss\))504 2874 A
5400 V
(01905)210 648 A
(#define)294 1026 A
(CDIOREADTOCHDR)588 1362 A
(_IOW\('c',)378 2034 A
2454(3,)S
(struct)252 2580 A
(cd_toc_entry\))546 2874 A
5490 V
(01906)210 648 A
(#define)294 1026 A
(CDIOREADTOC)462 1362 A
(_IOW\('c',)378 2034 A
2454(4,)S
(struct)252 2580 A
(cd_toc_entry\))546 2874 A
5580 V
(01907)210 648 A
(#define)294 1026 A
(CDIOREADSUBCH)546 1362 A
(_IOW\('c',)378 2034 A
2454(5,)S
(struct)252 2580 A
(cd_toc_entry\))546 2874 A
5670 V
(01908)210 648 A
(#define)294 1026 A
(CDIOSTOP)336 1362 A
(_IO)126 2034 A
(\('c',)210 2202 A
(10\))126 2454 A
5760 V
(01909)210 648 A
(#define)294 1026 A
(CDIOPAUSE)378 1362 A
(_IO)126 2034 A
(\('c',)210 2202 A
(11\))126 2454 A
5850 V
(01910)210 648 A
(#define)294 1026 A
(CDIORESUME)420 1362 A
(_IO)126 2034 A
(\('c',)210 2202 A
(12\))126 2454 A
5940 V
(01911)210 648 A
(#define)294 1026 A
(CDIOEJECT)378 1362 A
(DIOCEJECT)378 2034 A
6030 V
(01912)210 648 A
6120 V
(01913)210 648 A
1026(/*)S
(Soundcard)378 1152 A
(DSP)126 1572 A
(ioctls.)294 1740 A
2076(*/)S
6210 V
(01914)210 648 A
(#define)294 1026 A
(DSPIORATE)378 1362 A
(_IOR\('s',)378 2034 A
2454(1,)S
(unsigned)336 2580 A
(int\))168 2958 A
8418 V
EP
%%Page: 24 24
BP
/slant 0 def
/height 0 def
630 V
12 B
648(24)S
11 R
2016(File:)S
2249(include/sys/ioctl.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(01915)210 648 A
(#define)294 1026 A
(DSPIOSTEREO)462 1362 A
(_IOR\('s',)378 2034 A
2454(2,)S
(unsigned)336 2580 A
(int\))168 2958 A
990 V
(01916)210 648 A
(#define)294 1026 A
(DSPIOSIZE)378 1362 A
(_IOR\('s',)378 2034 A
2454(3,)S
(unsigned)336 2580 A
(int\))168 2958 A
1080 V
(01917)210 648 A
(#define)294 1026 A
(DSPIOBITS)378 1362 A
(_IOR\('s',)378 2034 A
2454(4,)S
(unsigned)336 2580 A
(int\))168 2958 A
1170 V
(01918)210 648 A
(#define)294 1026 A
(DSPIOSIGN)378 1362 A
(_IOR\('s',)378 2034 A
2454(5,)S
(unsigned)336 2580 A
(int\))168 2958 A
1260 V
(01919)210 648 A
(#define)294 1026 A
(DSPIOMAX)336 1362 A
(_IOW\('s',)378 2034 A
2454(6,)S
(unsigned)336 2580 A
(int\))168 2958 A
1350 V
(01920)210 648 A
(#define)294 1026 A
(DSPIORESET)420 1362 A
(_IO)126 2034 A
(\('s',)210 2202 A
2454(7\))S
1440 V
(01921)210 648 A
1530 V
(01922)210 648 A
1026(/*)S
(Soundcard)378 1152 A
(mixer)210 1572 A
(ioctls.)294 1824 A
2160(*/)S
1620 V
(01923)210 648 A
(#define)294 1026 A
(MIXIOGETVOLUME)588 1362 A
(_IORW\('s',)420 2370 A
(10,)126 2832 A
(struct)252 3000 A
(volume_level\))546 3294 A
1710 V
(01924)210 648 A
(#define)294 1026 A
(MIXIOGETINPUTLEFT)714 1362 A
(_IORW\('s',)420 2370 A
(11,)126 2832 A
(struct)252 3000 A
(inout_ctrl\))462 3294 A
1800 V
(01925)210 648 A
(#define)294 1026 A
(MIXIOGETINPUTRIGHT)756 1362 A
(_IORW\('s',)420 2370 A
(12,)126 2832 A
(struct)252 3000 A
(inout_ctrl\))462 3294 A
1890 V
(01926)210 648 A
(#define)294 1026 A
(MIXIOGETOUTPUT)588 1362 A
(_IORW\('s',)420 2370 A
(13,)126 2832 A
(struct)252 3000 A
(inout_ctrl\))462 3294 A
1980 V
(01927)210 648 A
(#define)294 1026 A
(MIXIOSETVOLUME)588 1362 A
(_IORW\('s',)420 2370 A
(20,)126 2832 A
(struct)252 3000 A
(volume_level\))546 3294 A
2070 V
(01928)210 648 A
(#define)294 1026 A
(MIXIOSETINPUTLEFT)714 1362 A
(_IORW\('s',)420 2370 A
(21,)126 2832 A
(struct)252 3000 A
(inout_ctrl\))462 3294 A
2160 V
(01929)210 648 A
(#define)294 1026 A
(MIXIOSETINPUTRIGHT)756 1362 A
(_IORW\('s',)420 2370 A
(22,)126 2832 A
(struct)252 3000 A
(inout_ctrl\))462 3294 A
2250 V
(01930)210 648 A
(#define)294 1026 A
(MIXIOSETOUTPUT)588 1362 A
(_IORW\('s',)420 2370 A
(23,)126 2832 A
(struct)252 3000 A
(inout_ctrl\))462 3294 A
2340 V
(01931)210 648 A
2430 V
(01932)210 648 A
(#ifndef)294 1026 A
(_ANSI)210 1362 A
2520 V
(01933)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
2610 V
(01934)210 648 A
(#endif)252 1026 A
2700 V
(01935)210 648 A
2790 V
(01936)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(ioctl,)252 1698 A
(\(int)168 1992 A
(_fd,)168 2202 A
(int)126 2412 A
(_request,)378 2580 A
(void)168 3000 A
(*_data\))294 3210 A
4050(\);)S
2880 V
(01937)210 648 A
2970 V
(01938)210 648 A
(#endif)252 1026 A
1320(/*)S
(_IOCTL_H)336 1446 A
1824(*/)S
3240 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3330 V
(include/sys/sigcontext.h)1008 2034 A
3420 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3600 V
(02000)210 648 A
(#ifndef)294 1026 A
(_SIGCONTEXT_H)546 1362 A
3690 V
(02001)210 648 A
(#define)294 1026 A
(_SIGCONTEXT_H)546 1362 A
3780 V
(02002)210 648 A
3870 V
(02003)210 648 A
1026(/*)S
(The)126 1152 A
(sigcontext)420 1320 A
(structure)378 1782 A
2202(is)S
(used)168 2328 A
2538(by)S
(the)126 2664 A
(sigreturn\(2\))504 2832 A
(system)252 3378 A
(call.)210 3672 A
3960 V
(02004)210 648 A
1068(*)S
(sigreturn\(\))462 1152 A
1656(is)S
(seldom)252 1782 A
(called)252 2076 A
2370(by)S
(user)168 2496 A
(programs,)378 2706 A
(but)126 3126 A
3294(it)S
3420(is)S
(used)168 3546 A
(internally)420 3756 A
4050 V
(02005)210 648 A
1068(*)S
1152(by)S
(the)126 1278 A
(signal)252 1446 A
(catching)336 1740 A
(mechanism.)420 2118 A
4140 V
(02006)210 648 A
1068(*/)S
4230 V
(02007)210 648 A
4320 V
(02008)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
4410 V
(02009)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
4500 V
(02010)210 648 A
(#endif)252 1026 A
4590 V
(02011)210 648 A
4680 V
(02012)210 648 A
(#ifndef)294 1026 A
(_CONFIG_H)378 1362 A
4770 V
(02013)210 648 A
(#include)336 1026 A
(<minix/config.h>)672 1404 A
4860 V
(02014)210 648 A
(#endif)252 1026 A
4950 V
(02015)210 648 A
5040 V
(02016)210 648 A
(#if)126 1026 A
(!defined\(CHIP\))588 1194 A
5130 V
(02017)210 648 A
(#include)336 1026 A
("error,)294 1404 A
(configuration)546 1740 A
2328(is)S
(not)126 2454 A
(known")252 2622 A
5220 V
(02018)210 648 A
(#endif)252 1026 A
5310 V
(02019)210 648 A
5400 V
(02020)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(structure)378 1740 A
(should)252 2160 A
(match)210 2454 A
(the)126 2706 A
(stackframe_s)504 2874 A
(structure)378 3420 A
(used)168 3840 A
5490 V
(02021)210 648 A
1068(*)S
1152(by)S
(the)126 1278 A
(kernel's)336 1446 A
(context)294 1824 A
(switching)378 2160 A
(code.)210 2580 A
(Floating)336 2874 A
(point)210 3252 A
(registers)378 3504 A
(should)252 3924 A
5580 V
(02022)210 648 A
1068(*)S
1152(be)S
(added)210 1278 A
1530(in)S
1656(a)S
(different)378 1740 A
(struct.)294 2160 A
5670 V
(02023)210 648 A
1068(*/)S
5760 V
(02024)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
5850 V
(02025)210 648 A
(struct)252 1026 A
(sigregs)294 1320 A
1656({)S
5940 V
(02026)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(4)S
6030 V
(02027)210 648 A
(short)210 1110 A
(sr_gs;)252 1362 A
6120 V
(02028)210 648 A
(short)210 1110 A
(sr_fs;)252 1362 A
6210 V
(02029)210 648 A
(#endif)252 1026 A
1320(/*)S
(_WORD_SIZE)420 1446 A
1908(==)S
2034(4)S
2118(*/)S
8418 V
EP
%%Page: 25 25
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1887(File:)S
2120(include/sys/sigcontext.h)S
12 B
4308(25)S
900 V
7 LST
(02030)210 648 A
(short)210 1110 A
(sr_es;)252 1362 A
990 V
(02031)210 648 A
(short)210 1110 A
(sr_ds;)252 1362 A
1080 V
(02032)210 648 A
(int)126 1110 A
(sr_di;)252 1278 A
1170 V
(02033)210 648 A
(int)126 1110 A
(sr_si;)252 1278 A
1260 V
(02034)210 648 A
(int)126 1110 A
(sr_bp;)252 1278 A
1350 V
(02035)210 648 A
(int)126 1110 A
(sr_st;)252 1278 A
2370(/*)S
(stack)210 2496 A
(top)126 2748 A
2916(--)S
(used)168 3042 A
3252(in)S
(kernel)252 3378 A
3672(*/)S
1440 V
(02036)210 648 A
(int)126 1110 A
(sr_bx;)252 1278 A
1530 V
(02037)210 648 A
(int)126 1110 A
(sr_dx;)252 1278 A
1620 V
(02038)210 648 A
(int)126 1110 A
(sr_cx;)252 1278 A
1710 V
(02039)210 648 A
(int)126 1110 A
(sr_retreg;)420 1278 A
1800 V
(02040)210 648 A
(int)126 1110 A
(sr_retadr;)420 1278 A
2370(/*)S
(return)252 2496 A
(address)294 2790 A
3126(to)S
(caller)252 3252 A
3546(of)S
(save)168 3672 A
3882(--)S
(used)168 4008 A
1890 V
(02041)210 648 A
2412(*)S
2496(in)S
(kernel)252 2622 A
2916(*/)S
1980 V
(02042)210 648 A
(int)126 1110 A
(sr_pc;)252 1278 A
2070 V
(02043)210 648 A
(int)126 1110 A
(sr_cs;)252 1278 A
2160 V
(02044)210 648 A
(int)126 1110 A
(sr_psw;)294 1278 A
2250 V
(02045)210 648 A
(int)126 1110 A
(sr_sp;)252 1278 A
2340 V
(02046)210 648 A
(int)126 1110 A
(sr_ss;)252 1278 A
2430 V
(02047)210 648 A
1026(};)S
2520 V
(02048)210 648 A
2610 V
(02049)210 648 A
(struct)252 1026 A
(sigframe)336 1320 A
1698({)S
2370(/*)S
(stack)210 2496 A
(frame)210 2748 A
(created)294 3000 A
(for)126 3336 A
(signalled)378 3504 A
(process)294 3924 A
4260(*/)S
2700 V
(02050)210 648 A
(_PROTOTYPE\()462 1110 A
(void)168 1614 A
(\(*sf_retadr\),)546 1824 A
(\(void\))252 2412 A
2706(\);)S
2790 V
(02051)210 648 A
(int)126 1110 A
(sf_signo;)378 1278 A
2880 V
(02052)210 648 A
(int)126 1110 A
(sf_code;)336 1278 A
2970 V
(02053)210 648 A
(struct)252 1110 A
(sigcontext)420 1404 A
(*sf_scp;)336 1866 A
3060 V
(02054)210 648 A
(int)126 1110 A
(sf_fp;)252 1278 A
3150 V
(02055)210 648 A
(_PROTOTYPE\()462 1110 A
(void)168 1614 A
(\(*sf_retadr2\),)588 1824 A
(\(void\))252 2454 A
2748(\);)S
3240 V
(02056)210 648 A
(struct)252 1110 A
(sigcontext)420 1404 A
(*sf_scpcopy;)504 1866 A
3330 V
(02057)210 648 A
1026(};)S
3420 V
(02058)210 648 A
3510 V
(02059)210 648 A
(#else)210 1026 A
3600 V
(02060)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(M68000\))294 1572 A
3690 V
(02061)210 648 A
(struct)252 1026 A
(sigregs)294 1320 A
1656({)S
3780 V
(02062)210 648 A
(long)168 1110 A
(sr_retreg;)420 1320 A
2706(/*)S
2832(d0)S
2958(*/)S
3870 V
(02063)210 648 A
(long)168 1110 A
(sr_d1;)252 1320 A
3960 V
(02064)210 648 A
(long)168 1110 A
(sr_d2;)252 1320 A
4050 V
(02065)210 648 A
(long)168 1110 A
(sr_d3;)252 1320 A
4140 V
(02066)210 648 A
(long)168 1110 A
(sr_d4;)252 1320 A
4230 V
(02067)210 648 A
(long)168 1110 A
(sr_d5;)252 1320 A
4320 V
(02068)210 648 A
(long)168 1110 A
(sr_d6;)252 1320 A
4410 V
(02069)210 648 A
(long)168 1110 A
(sr_d7;)252 1320 A
4500 V
(02070)210 648 A
(long)168 1110 A
(sr_a0;)252 1320 A
4590 V
(02071)210 648 A
(long)168 1110 A
(sr_a1;)252 1320 A
4680 V
(02072)210 648 A
(long)168 1110 A
(sr_a2;)252 1320 A
4770 V
(02073)210 648 A
(long)168 1110 A
(sr_a3;)252 1320 A
4860 V
(02074)210 648 A
(long)168 1110 A
(sr_a4;)252 1320 A
4950 V
(02075)210 648 A
(long)168 1110 A
(sr_a5;)252 1320 A
5040 V
(02076)210 648 A
(long)168 1110 A
(sr_a6;)252 1320 A
5130 V
(02077)210 648 A
(long)168 1110 A
(sr_sp;)252 1320 A
2370(/*)S
(also)168 2496 A
(known)210 2706 A
2958(as)S
3084(a7)S
3210(*/)S
5220 V
(02078)210 648 A
(long)168 1110 A
(sr_pc;)252 1320 A
5310 V
(02079)210 648 A
(short)210 1110 A
(sr_psw;)294 1362 A
5400 V
(02080)210 648 A
(short)210 1110 A
(sr_dummy;)378 1362 A
2370(/*)S
(make)168 2496 A
(size)168 2706 A
(multiple)336 2916 A
3294(of)S
3420(4)S
(for)126 3504 A
(system.c)336 3672 A
4050(*/)S
5490 V
(02081)210 648 A
1026(};)S
5580 V
(02082)210 648 A
(#else)210 1026 A
5670 V
(02083)210 648 A
(#include)336 1026 A
("error,)294 1404 A
(CHIP)168 1740 A
1950(is)S
(not)126 2076 A
(supported")420 2244 A
5760 V
(02084)210 648 A
(#endif)252 1026 A
5850 V
(02085)210 648 A
(#endif)252 1026 A
1320(/*)S
(CHIP)168 1446 A
1656(==)S
(INTEL)210 1782 A
2034(*/)S
5940 V
(02086)210 648 A
6030 V
(02087)210 648 A
(struct)252 1026 A
(sigcontext)420 1320 A
1782({)S
6120 V
(02088)210 648 A
(int)126 1110 A
(sc_flags;)378 1278 A
2370(/*)S
(sigstack)336 2496 A
(state)210 2874 A
3126(to)S
(restore)294 3252 A
3588(*/)S
6210 V
(02089)210 648 A
(long)168 1110 A
(sc_mask;)336 1320 A
2370(/*)S
(signal)252 2496 A
(mask)168 2790 A
3000(to)S
(restore)294 3126 A
3462(*/)S
8418 V
EP
%%Page: 26 26
BP
/slant 0 def
/height 0 def
630 V
12 B
648(26)S
11 R
1887(File:)S
2120(include/sys/sigcontext.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(02090)210 648 A
(struct)252 1110 A
(sigregs)294 1404 A
(sc_regs;)336 1740 A
2370(/*)S
(register)336 2496 A
(set)126 2874 A
3042(to)S
(restore)294 3168 A
3504(*/)S
990 V
(02091)210 648 A
1026(};)S
1080 V
(02092)210 648 A
1170 V
(02093)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
1260 V
(02094)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(4)S
1350 V
(02095)210 648 A
(#define)294 1026 A
(sc_gs)210 1362 A
(sc_regs.sr_gs)546 1614 A
1440 V
(02096)210 648 A
(#define)294 1026 A
(sc_fs)210 1362 A
(sc_regs.sr_fs)546 1614 A
1530 V
(02097)210 648 A
(#endif)252 1026 A
1320(/*)S
(_WORD_SIZE)420 1446 A
1908(==)S
2034(4)S
2118(*/)S
1620 V
(02098)210 648 A
(#define)294 1026 A
(sc_es)210 1362 A
(sc_regs.sr_es)546 1614 A
1710 V
(02099)210 648 A
(#define)294 1026 A
(sc_ds)210 1362 A
(sc_regs.sr_ds)546 1614 A
1800 V
(02100)210 648 A
(#define)294 1026 A
(sc_di)210 1362 A
(sc_regs.sr_di)546 1614 A
1890 V
(02101)210 648 A
(#define)294 1026 A
(sc_si)210 1362 A
(sc_regs.sr_si)546 1614 A
1980 V
(02102)210 648 A
(#define)294 1026 A
(sc_fp)210 1362 A
(sc_regs.sr_bp)546 1614 A
2070 V
(02103)210 648 A
(#define)294 1026 A
(sc_st)210 1362 A
(sc_regs.sr_st)546 1614 A
2706(/*)S
(stack)210 2832 A
(top)126 3084 A
3252(--)S
(used)168 3378 A
3588(in)S
(kernel)252 3714 A
4008(*/)S
2160 V
(02104)210 648 A
(#define)294 1026 A
(sc_bx)210 1362 A
(sc_regs.sr_bx)546 1614 A
2250 V
(02105)210 648 A
(#define)294 1026 A
(sc_dx)210 1362 A
(sc_regs.sr_dx)546 1614 A
2340 V
(02106)210 648 A
(#define)294 1026 A
(sc_cx)210 1362 A
(sc_regs.sr_cx)546 1614 A
2430 V
(02107)210 648 A
(#define)294 1026 A
(sc_retreg)378 1362 A
(sc_regs.sr_retreg)714 1782 A
2520 V
(02108)210 648 A
(#define)294 1026 A
(sc_retadr)378 1362 A
(sc_regs.sr_retadr)714 1782 A
2706(/*)S
(return)252 2832 A
(address)294 3126 A
3462(to)S
(caller)252 3588 A
3882(of)S
2610 V
(02109)210 648 A
(save)168 2706 A
2916(--)S
(used)168 3042 A
3252(in)S
(kernel)252 3378 A
3672(*/)S
2700 V
(02110)210 648 A
(#define)294 1026 A
(sc_pc)210 1362 A
(sc_regs.sr_pc)546 1614 A
2790 V
(02111)210 648 A
(#define)294 1026 A
(sc_cs)210 1362 A
(sc_regs.sr_cs)546 1614 A
2880 V
(02112)210 648 A
(#define)294 1026 A
(sc_psw)252 1362 A
(sc_regs.sr_psw)588 1656 A
2970 V
(02113)210 648 A
(#define)294 1026 A
(sc_sp)210 1362 A
(sc_regs.sr_sp)546 1614 A
3060 V
(02114)210 648 A
(#define)294 1026 A
(sc_ss)210 1362 A
(sc_regs.sr_ss)546 1614 A
3150 V
(02115)210 648 A
(#endif)252 1026 A
1320(/*)S
(CHIP)168 1446 A
1656(==)S
(INTEL)210 1782 A
2034(*/)S
3240 V
(02116)210 648 A
3330 V
(02117)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(M68000\))294 1572 A
3420 V
(02118)210 648 A
(#define)294 1026 A
(sc_retreg)378 1362 A
(sc_regs.sr_retreg)714 1782 A
3510 V
(02119)210 648 A
(#define)294 1026 A
(sc_d1)210 1362 A
(sc_regs.sr_d1)546 1614 A
3600 V
(02120)210 648 A
(#define)294 1026 A
(sc_d2)210 1362 A
(sc_regs.sr_d2)546 1614 A
3690 V
(02121)210 648 A
(#define)294 1026 A
(sc_d3)210 1362 A
(sc_regs.sr_d3)546 1614 A
3780 V
(02122)210 648 A
(#define)294 1026 A
(sc_d4)210 1362 A
(sc_regs.sr_d4)546 1614 A
3870 V
(02123)210 648 A
(#define)294 1026 A
(sc_d5)210 1362 A
(sc_regs.sr_d5)546 1614 A
3960 V
(02124)210 648 A
(#define)294 1026 A
(sc_d6)210 1362 A
(sc_regs.sr_d6)546 1614 A
4050 V
(02125)210 648 A
(#define)294 1026 A
(sc_d7)210 1362 A
(sc_regs.sr_d7)546 1614 A
4140 V
(02126)210 648 A
(#define)294 1026 A
(sc_a0)210 1362 A
(sc_regs.sr_a0)546 1614 A
4230 V
(02127)210 648 A
(#define)294 1026 A
(sc_a1)210 1362 A
(sc_regs.sr_a1)546 1614 A
4320 V
(02128)210 648 A
(#define)294 1026 A
(sc_a2)210 1362 A
(sc_regs.sr_a2)546 1614 A
4410 V
(02129)210 648 A
(#define)294 1026 A
(sc_a3)210 1362 A
(sc_regs.sr_a3)546 1614 A
4500 V
(02130)210 648 A
(#define)294 1026 A
(sc_a4)210 1362 A
(sc_regs.sr_a4)546 1614 A
4590 V
(02131)210 648 A
(#define)294 1026 A
(sc_a5)210 1362 A
(sc_regs.sr_a5)546 1614 A
4680 V
(02132)210 648 A
(#define)294 1026 A
(sc_fp)210 1362 A
(sc_regs.sr_a6)546 1614 A
4770 V
(02133)210 648 A
(#define)294 1026 A
(sc_sp)210 1362 A
(sc_regs.sr_sp)546 1614 A
4860 V
(02134)210 648 A
(#define)294 1026 A
(sc_pc)210 1362 A
(sc_regs.sr_pc)546 1614 A
4950 V
(02135)210 648 A
(#define)294 1026 A
(sc_psw)252 1362 A
(sc_regs.sr_psw)588 1656 A
5040 V
(02136)210 648 A
(#endif)252 1026 A
1320(/*)S
(CHIP)168 1446 A
1656(==)S
(M68000)252 1782 A
2076(*/)S
5130 V
(02137)210 648 A
5220 V
(02138)210 648 A
1026(/*)S
(Values)252 1152 A
(for)126 1446 A
(sc_flags.)378 1614 A
(Must)168 2076 A
(agree)210 2286 A
(with)168 2538 A
(<minix/jmp_buf.h>.)756 2748 A
3546(*/)S
5310 V
(02139)210 648 A
(#define)294 1026 A
(SC_SIGCONTEXT)546 1362 A
2034(2)S
2370(/*)S
(nonzero)294 2496 A
(when)168 2832 A
(signal)252 3042 A
(context)294 3336 A
3672(is)S
(included)336 3798 A
4176(*/)S
5400 V
(02140)210 648 A
(#define)294 1026 A
(SC_NOREGLOCALS)588 1362 A
2034(4)S
2370(/*)S
(nonzero)294 2496 A
(when)168 2832 A
(registers)378 3042 A
(are)126 3462 A
(not)126 3630 A
3798(to)S
3924(be)S
5490 V
(02141)210 648 A
(saved)210 2706 A
(and)126 2958 A
(restored)336 3126 A
3504(*/)S
5580 V
(02142)210 648 A
5670 V
(02143)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sigreturn,)420 1698 A
(\(struct)294 2160 A
(sigcontext)420 2496 A
(*_scp\))252 2958 A
4050(\);)S
5760 V
(02144)210 648 A
5850 V
(02145)210 648 A
(#endif)252 1026 A
1320(/*)S
(_SIGCONTEXT_H)546 1446 A
2034(*/)S
8418 V
EP
%%Page: 27 27
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1978(File:)S
(include/sys/ptrace.h)886 2211 A
12 B
4308(27)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(include/sys/ptrace.h)840 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(02200)210 648 A
1026(/*)S
(<sys/ptrace.h>)588 1152 A
1440 V
(02201)210 648 A
1068(*)S
(definitions)462 1152 A
(for)126 1656 A
(ptrace\(2\))378 1824 A
1530 V
(02202)210 648 A
1068(*/)S
1620 V
(02203)210 648 A
1710 V
(02204)210 648 A
(#ifndef)294 1026 A
(_PTRACE_H)378 1362 A
1800 V
(02205)210 648 A
(#define)294 1026 A
(_PTRACE_H)378 1362 A
1890 V
(02206)210 648 A
1980 V
(02207)210 648 A
(#define)294 1026 A
(T_STOP)252 1362 A
1992(-1)S
2370(/*)S
(stop)168 2496 A
(the)126 2706 A
(process)294 2874 A
3210(*/)S
2070 V
(02208)210 648 A
(#define)294 1026 A
(T_OK)168 1362 A
2034(0)S
2370(/*)S
(enable)252 2496 A
(tracing)294 2790 A
3126(by)S
(parent)252 3252 A
(for)126 3546 A
(this)168 3714 A
(process)294 3924 A
4260(*/)S
2160 V
(02209)210 648 A
(#define)294 1026 A
(T_GETINS)336 1362 A
2034(1)S
2370(/*)S
(return)252 2496 A
(value)210 2790 A
(from)168 3042 A
(instruction)462 3252 A
(space)210 3756 A
4008(*/)S
2250 V
(02210)210 648 A
(#define)294 1026 A
(T_GETDATA)378 1362 A
2034(2)S
2370(/*)S
(return)252 2496 A
(value)210 2790 A
(from)168 3042 A
(data)168 3252 A
(space)210 3462 A
3714(*/)S
2340 V
(02211)210 648 A
(#define)294 1026 A
(T_GETUSER)378 1362 A
2034(3)S
2370(/*)S
(return)252 2496 A
(value)210 2790 A
(from)168 3042 A
(user)168 3252 A
(process)294 3462 A
(table)210 3798 A
4050(*/)S
2430 V
(02212)210 648 A
(#define)294 1026 A
(T_SETINS)336 1362 A
2034(4)S
2370(/*)S
(set)126 2496 A
(value)210 2664 A
(from)168 2916 A
(instruction)462 3126 A
(space)210 3630 A
3882(*/)S
2520 V
(02213)210 648 A
(#define)294 1026 A
(T_SETDATA)378 1362 A
2034(5)S
2370(/*)S
(set)126 2496 A
(value)210 2664 A
(from)168 2916 A
(data)168 3126 A
(space)210 3336 A
3588(*/)S
2610 V
(02214)210 648 A
(#define)294 1026 A
(T_SETUSER)378 1362 A
2034(6)S
2370(/*)S
(set)126 2496 A
(value)210 2664 A
2916(in)S
(user)168 3042 A
(process)294 3252 A
(table)210 3588 A
3840(*/)S
2700 V
(02215)210 648 A
(#define)294 1026 A
(T_RESUME)336 1362 A
2034(7)S
2370(/*)S
(resume)252 2496 A
(execution)378 2790 A
3210(*/)S
2790 V
(02216)210 648 A
(#define)294 1026 A
(T_EXIT)252 1362 A
2034(8)S
2370(/*)S
(exit)168 2496 A
2706(*/)S
2880 V
(02217)210 648 A
(#define)294 1026 A
(T_STEP)252 1362 A
2034(9)S
2370(/*)S
(set)126 2496 A
(trace)210 2664 A
(bit)126 2916 A
3084(*/)S
2970 V
(02218)210 648 A
3060 V
(02219)210 648 A
1026(/*)S
(Function)336 1152 A
(Prototypes.)462 1530 A
2034(*/)S
3150 V
(02220)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
3240 V
(02221)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
3330 V
(02222)210 648 A
(#endif)252 1026 A
3420 V
(02223)210 648 A
3510 V
(02224)210 648 A
(_PROTOTYPE\()462 1026 A
(long)168 1530 A
(ptrace,)294 1740 A
(\(int)168 2076 A
(_req,)210 2286 A
(pid_t)210 2538 A
(_pid,)210 2790 A
(long)168 3042 A
(_addr,)252 3252 A
(long)168 3546 A
(_data\))252 3756 A
4050(\);)S
3600 V
(02225)210 648 A
3690 V
(02226)210 648 A
(#endif)252 1026 A
1320(/*)S
(_PTRACE_H)378 1446 A
1866(*/)S
4140 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4230 V
(include/sys/stat.h)756 2034 A
4320 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4500 V
(02300)210 648 A
1026(/*)S
(The)126 1152 A
(<sys/stat.h>)504 1320 A
(header)252 1866 A
(defines)294 2160 A
2496(a)S
(struct)252 2580 A
(that)168 2874 A
3084(is)S
(used)168 3210 A
3420(in)S
(the)126 3546 A
(stat\(\))252 3714 A
(and)126 4008 A
4590 V
(02301)210 648 A
1068(*)S
(fstat)210 1152 A
(functions.)420 1404 A
(The)126 1908 A
(information)462 2076 A
2580(in)S
(this)168 2706 A
(struct)252 2916 A
(comes)210 3210 A
(from)168 3462 A
(the)126 3672 A
(i-node)252 3840 A
4134(of)S
4680 V
(02302)210 648 A
1068(*)S
(some)168 1152 A
(file.)210 1362 A
(These)210 1656 A
(calls)210 1908 A
(are)126 2160 A
(the)126 2328 A
(only)168 2496 A
(approved)336 2706 A
(way)126 3084 A
3252(to)S
(inspect)294 3378 A
(i-nodes.)336 3714 A
4770 V
(02303)210 648 A
1068(*/)S
4860 V
(02304)210 648 A
4950 V
(02305)210 648 A
(#ifndef)294 1026 A
(_STAT_H)294 1362 A
5040 V
(02306)210 648 A
(#define)294 1026 A
(_STAT_H)294 1362 A
5130 V
(02307)210 648 A
5220 V
(02308)210 648 A
(struct)252 1026 A
(stat)168 1320 A
1530({)S
5310 V
(02309)210 648 A
(dev_t)210 1110 A
(st_dev;)294 1362 A
2370(/*)S
(major/minor)462 2496 A
(device)252 3000 A
(number)252 3294 A
3588(*/)S
5400 V
(02310)210 648 A
(ino_t)210 1110 A
(st_ino;)294 1362 A
2370(/*)S
(i-node)252 2496 A
(number)252 2790 A
3084(*/)S
5490 V
(02311)210 648 A
(mode_t)252 1110 A
(st_mode;)336 1404 A
2370(/*)S
(file)168 2496 A
(mode,)210 2706 A
(protection)420 2958 A
(bits,)210 3420 A
(etc.)168 3672 A
3882(*/)S
5580 V
(02312)210 648 A
(short)210 1110 A
(int)126 1362 A
(st_nlink;)378 1530 A
2370(/*)S
2496(#)S
(links;)252 2580 A
(TEMPORARY)378 2874 A
(HACK:)210 3294 A
(should)252 3546 A
3840(be)S
(nlink_t*/)378 3966 A
5670 V
(02313)210 648 A
(uid_t)210 1110 A
(st_uid;)294 1362 A
2370(/*)S
(uid)126 2496 A
2664(of)S
(the)126 2790 A
(file's)252 2958 A
(owner)210 3252 A
3504(*/)S
5760 V
(02314)210 648 A
(short)210 1110 A
(int)126 1362 A
(st_gid;)294 1530 A
2370(/*)S
(gid;)168 2496 A
(TEMPORARY)378 2706 A
(HACK:)210 3126 A
(should)252 3378 A
3672(be)S
(gid_t)210 3798 A
4050(*/)S
5850 V
(02315)210 648 A
(dev_t)210 1110 A
(st_rdev;)336 1362 A
5940 V
(02316)210 648 A
(off_t)210 1110 A
(st_size;)336 1362 A
2370(/*)S
(file)168 2496 A
(size)168 2706 A
2916(*/)S
6030 V
(02317)210 648 A
(time_t)252 1110 A
(st_atime;)378 1404 A
2370(/*)S
(time)168 2496 A
2706(of)S
(last)168 2832 A
(access)252 3042 A
3336(*/)S
6120 V
(02318)210 648 A
(time_t)252 1110 A
(st_mtime;)378 1404 A
2370(/*)S
(time)168 2496 A
2706(of)S
(last)168 2832 A
(data)168 3042 A
(modification)504 3252 A
3798(*/)S
6210 V
(02319)210 648 A
(time_t)252 1110 A
(st_ctime;)378 1404 A
2370(/*)S
(time)168 2496 A
2706(of)S
(last)168 2832 A
(file)168 3042 A
(status)252 3252 A
(change)252 3546 A
3840(*/)S
8418 V
EP
%%Page: 28 28
BP
/slant 0 def
/height 0 def
630 V
12 B
648(28)S
11 R
2037(File:)S
2270(include/sys/stat.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(02320)210 648 A
1026(};)S
990 V
(02321)210 648 A
1080 V
(02322)210 648 A
1026(/*)S
(Traditional)462 1152 A
(mask)168 1656 A
(definitions)462 1866 A
(for)126 2370 A
(st_mode.)336 2538 A
2916(*/)S
1170 V
(02323)210 648 A
1026(/*)S
(The)126 1152 A
(ugly)168 1320 A
(casts)210 1530 A
1782(on)S
(only)168 1908 A
(some)168 2118 A
2328(of)S
(the)126 2454 A
(definitions)462 2622 A
(are)126 3126 A
3294(to)S
(avoid)210 3420 A
(suprising)378 3672 A
(sign)168 4092 A
1260 V
(02324)210 648 A
1068(*)S
(extensions)420 1152 A
(such)168 1614 A
1824(as)S
(S_IFREG)294 1950 A
2286(!=)S
(\(mode_t\))336 2412 A
(S_IFREG)294 2790 A
(when)168 3126 A
(ints)168 3336 A
(are)126 3546 A
3714(32)S
(bits.)210 3840 A
1350 V
(02325)210 648 A
1068(*/)S
1440 V
(02326)210 648 A
(#define)294 1026 A
(S_IFMT)252 1362 A
(\(\(mode_t\))378 1698 A
(0170000\))336 2118 A
2706(/*)S
(type)168 2832 A
3042(of)S
(file)168 3168 A
3378(*/)S
1530 V
(02327)210 648 A
(#define)294 1026 A
(S_IFREG)294 1362 A
(\(\(mode_t\))378 1698 A
(0100000\))336 2118 A
2706(/*)S
(regular)294 2832 A
3168(*/)S
1620 V
(02328)210 648 A
(#define)294 1026 A
(S_IFBLK)294 1362 A
(0060000)294 1698 A
2370(/*)S
(block)210 2496 A
(special)294 2748 A
3084(*/)S
1710 V
(02329)210 648 A
(#define)294 1026 A
(S_IFDIR)294 1362 A
(0040000)294 1698 A
2370(/*)S
(directory)378 2496 A
2916(*/)S
1800 V
(02330)210 648 A
(#define)294 1026 A
(S_IFCHR)294 1362 A
(0020000)294 1698 A
2370(/*)S
(character)378 2496 A
(special)294 2916 A
3252(*/)S
1890 V
(02331)210 648 A
(#define)294 1026 A
(S_IFIFO)294 1362 A
(0010000)294 1698 A
2370(/*)S
(this)168 2496 A
2706(is)S
2832(a)S
(FIFO)168 2916 A
3126(*/)S
1980 V
(02332)210 648 A
(#define)294 1026 A
(S_ISUID)294 1362 A
(0004000)294 1698 A
2370(/*)S
(set)126 2496 A
(user)168 2664 A
2874(id)S
3000(on)S
(execution)378 3126 A
3546(*/)S
2070 V
(02333)210 648 A
(#define)294 1026 A
(S_ISGID)294 1362 A
(0002000)294 1698 A
2370(/*)S
(set)126 2496 A
(group)210 2664 A
2916(id)S
3042(on)S
(execution)378 3168 A
3588(*/)S
2160 V
(02334)210 648 A
2370(/*)S
(next)168 2496 A
2706(is)S
(reserved)336 2832 A
(for)126 3210 A
(future)252 3378 A
(use)126 3672 A
3840(*/)S
2250 V
(02335)210 648 A
(#define)294 1026 A
(S_ISVTX)294 1362 A
(01000)210 1782 A
2370(/*)S
(save)168 2496 A
(swapped)294 2706 A
(text)168 3042 A
(even)168 3252 A
(after)210 3462 A
(use)126 3714 A
3882(*/)S
2340 V
(02336)210 648 A
2430 V
(02337)210 648 A
1026(/*)S
(POSIX)210 1152 A
(masks)210 1404 A
(for)126 1656 A
(st_mode.)336 1824 A
2202(*/)S
2520 V
(02338)210 648 A
(#define)294 1026 A
(S_IRWXU)294 1362 A
(00700)210 1782 A
2370(/*)S
(owner:)252 2496 A
(rwx------)378 2832 A
3252(*/)S
2610 V
(02339)210 648 A
(#define)294 1026 A
(S_IRUSR)294 1362 A
(00400)210 1782 A
2370(/*)S
(owner:)252 2496 A
(r--------)378 2832 A
3252(*/)S
2700 V
(02340)210 648 A
(#define)294 1026 A
(S_IWUSR)294 1362 A
(00200)210 1782 A
2370(/*)S
(owner:)252 2496 A
(-w-------)378 2832 A
3252(*/)S
2790 V
(02341)210 648 A
(#define)294 1026 A
(S_IXUSR)294 1362 A
(00100)210 1782 A
2370(/*)S
(owner:)252 2496 A
(--x------)378 2832 A
3252(*/)S
2880 V
(02342)210 648 A
2970 V
(02343)210 648 A
(#define)294 1026 A
(S_IRWXG)294 1362 A
(00070)210 1782 A
2370(/*)S
(group:)252 2496 A
(---rwx---)378 2832 A
3252(*/)S
3060 V
(02344)210 648 A
(#define)294 1026 A
(S_IRGRP)294 1362 A
(00040)210 1782 A
2370(/*)S
(group:)252 2496 A
(---r-----)378 2832 A
3252(*/)S
3150 V
(02345)210 648 A
(#define)294 1026 A
(S_IWGRP)294 1362 A
(00020)210 1782 A
2370(/*)S
(group:)252 2496 A
(----w----)378 2832 A
3252(*/)S
3240 V
(02346)210 648 A
(#define)294 1026 A
(S_IXGRP)294 1362 A
(00010)210 1782 A
2370(/*)S
(group:)252 2496 A
(-----x---)378 2832 A
3252(*/)S
3330 V
(02347)210 648 A
3420 V
(02348)210 648 A
(#define)294 1026 A
(S_IRWXO)294 1362 A
(00007)210 1782 A
2370(/*)S
(others:)294 2496 A
(------rwx)378 2832 A
3252(*/)S
3510 V
(02349)210 648 A
(#define)294 1026 A
(S_IROTH)294 1362 A
(00004)210 1782 A
2370(/*)S
(others:)294 2496 A
(------r--)378 2832 A
3252(*/)S
3600 V
(02350)210 648 A
(#define)294 1026 A
(S_IWOTH)294 1362 A
(00002)210 1782 A
2370(/*)S
(others:)294 2496 A
(-------w-)378 2832 A
3252(*/)S
3690 V
(02351)210 648 A
(#define)294 1026 A
(S_IXOTH)294 1362 A
(00001)210 1782 A
2370(/*)S
(others:)294 2496 A
(--------x)378 2832 A
3252(*/)S
3780 V
(02352)210 648 A
3870 V
(02353)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(macros)252 1740 A
(test)168 2034 A
(st_mode)294 2244 A
(\(from)210 2580 A
(POSIX)210 2832 A
(Sec.)168 3084 A
(5.6.1.1\).)378 3294 A
3714(*/)S
3960 V
(02354)210 648 A
(#define)294 1026 A
(S_ISREG\(m\))420 1362 A
(\(\(\(m\))210 2034 A
2286(&)S
(S_IFMT\))294 2370 A
2706(==)S
(S_IFREG\))336 2832 A
3378(/*)S
3504(is)S
3630(a)S
(reg)126 3714 A
(file)168 3882 A
4092(*/)S
4050 V
(02355)210 648 A
(#define)294 1026 A
(S_ISDIR\(m\))420 1362 A
(\(\(\(m\))210 2034 A
2286(&)S
(S_IFMT\))294 2370 A
2706(==)S
(S_IFDIR\))336 2832 A
3378(/*)S
3504(is)S
3630(a)S
(directory)378 3714 A
4134(*/)S
4140 V
(02356)210 648 A
(#define)294 1026 A
(S_ISCHR\(m\))420 1362 A
(\(\(\(m\))210 2034 A
2286(&)S
(S_IFMT\))294 2370 A
2706(==)S
(S_IFCHR\))336 2832 A
3378(/*)S
3504(is)S
3630(a)S
(char)168 3714 A
(spec)168 3924 A
4134(*/)S
4230 V
(02357)210 648 A
(#define)294 1026 A
(S_ISBLK\(m\))420 1362 A
(\(\(\(m\))210 2034 A
2286(&)S
(S_IFMT\))294 2370 A
2706(==)S
(S_IFBLK\))336 2832 A
3378(/*)S
3504(is)S
3630(a)S
(block)210 3714 A
(spec)168 3966 A
4176(*/)S
4320 V
(02358)210 648 A
(#define)294 1026 A
(S_ISFIFO\(m\))462 1362 A
(\(\(\(m\))210 2034 A
2286(&)S
(S_IFMT\))294 2370 A
2706(==)S
(S_IFIFO\))336 2832 A
3378(/*)S
3504(is)S
3630(a)S
(pipe/FIFO)378 3714 A
4134(*/)S
4410 V
(02359)210 648 A
4500 V
(02360)210 648 A
4590 V
(02361)210 648 A
1026(/*)S
(Function)336 1152 A
(Prototypes.)462 1530 A
2034(*/)S
4680 V
(02362)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
4770 V
(02363)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
4860 V
(02364)210 648 A
(#endif)252 1026 A
4950 V
(02365)210 648 A
5040 V
(02366)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(chmod,)252 1698 A
(\(const)252 1992 A
(char)168 2286 A
(*_path,)294 2496 A
(Mode_t)252 2832 A
(_mode\))252 3126 A
4050(\);)S
5130 V
(02367)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(fstat,)252 1698 A
(\(int)168 1992 A
(_fildes,)336 2202 A
(struct)252 2580 A
(stat)168 2874 A
(*_buf\))252 3084 A
4050(\);)S
5220 V
(02368)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(mkdir,)252 1698 A
(\(const)252 1992 A
(char)168 2286 A
(*_path,)294 2496 A
(Mode_t)252 2832 A
(_mode\))252 3126 A
4050(\);)S
5310 V
(02369)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(mkfifo,)294 1698 A
(\(const)252 2034 A
(char)168 2328 A
(*_path,)294 2538 A
(Mode_t)252 2874 A
(_mode\))252 3168 A
4050(\);)S
5400 V
(02370)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(stat,)210 1698 A
(\(const)252 1950 A
(char)168 2244 A
(*_path,)294 2454 A
(struct)252 2790 A
(stat)168 3084 A
(*_buf\))252 3294 A
4050(\);)S
5490 V
(02371)210 648 A
(_PROTOTYPE\()462 1026 A
(mode_t)252 1530 A
(umask,)252 1824 A
(\(Mode_t)294 2118 A
(_cmask\))294 2454 A
4050(\);)S
5580 V
(02372)210 648 A
5670 V
(02373)210 648 A
(#endif)252 1026 A
1320(/*)S
(_STAT_H)294 1446 A
1782(*/)S
8418 V
EP
%%Page: 29 29
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2053(File:)S
2286(include/sys/dir.h)S
12 B
4308(29)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(include/sys/dir.h)714 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(02400)210 648 A
1026(/*)S
(The)126 1152 A
(<dir.h>)294 1320 A
(header)252 1656 A
(gives)210 1950 A
(the)126 2202 A
(layout)252 2370 A
2664(of)S
2790(a)S
(directory.)420 2874 A
3336(*/)S
1440 V
(02401)210 648 A
1530 V
(02402)210 648 A
(#ifndef)294 1026 A
(_DIR_H)252 1362 A
1620 V
(02403)210 648 A
(#define)294 1026 A
(_DIR_H)252 1362 A
1710 V
(02404)210 648 A
1800 V
(02405)210 648 A
(#define)294 1026 A
(DIRBLKSIZ)378 1362 A
(512)126 2034 A
2370(/*)S
(size)168 2496 A
2706(of)S
(directory)378 2832 A
(block)210 3252 A
3504(*/)S
1890 V
(02406)210 648 A
1980 V
(02407)210 648 A
(#ifndef)294 1026 A
(DIRSIZ)252 1362 A
2070 V
(02408)210 648 A
(#define)294 1026 A
(DIRSIZ)252 1362 A
1698(14)S
2160 V
(02409)210 648 A
(#endif)252 1026 A
2250 V
(02410)210 648 A
2340 V
(02411)210 648 A
(struct)252 1026 A
(direct)252 1320 A
1614({)S
2430 V
(02412)210 648 A
(ino_t)210 1110 A
(d_ino;)252 1362 A
2520 V
(02413)210 648 A
(char)168 1110 A
(d_name[DIRSIZ];)630 1320 A
2610 V
(02414)210 648 A
1026(};)S
2700 V
(02415)210 648 A
2790 V
(02416)210 648 A
(#endif)252 1026 A
1320(/*)S
(_DIR_H)252 1446 A
1740(*/)S
3240 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3330 V
(include/sys/wait.h)756 2034 A
3420 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3600 V
(02500)210 648 A
1026(/*)S
(The)126 1152 A
(<sys/wait.h>)504 1320 A
(header)252 1866 A
(contains)336 2160 A
(macros)252 2538 A
(related)294 2832 A
3168(to)S
(wait\(\).)294 3294 A
(The)126 3630 A
(value)210 3798 A
3690 V
(02501)210 648 A
1068(*)S
(returned)336 1152 A
1530(by)S
(wait\(\))252 1656 A
(and)126 1950 A
(waitpid\(\))378 2118 A
(depends)294 2538 A
2874(on)S
(whether)294 3000 A
(the)126 3336 A
(process)294 3504 A
3780 V
(02502)210 648 A
1068(*)S
(terminated)420 1152 A
1614(by)S
1740(an)S
(exit\(\))252 1866 A
(call,)210 2160 A
(was)126 2412 A
(killed)252 2580 A
2874(by)S
3000(a)S
(signal,)294 3084 A
3420(or)S
(was)126 3546 A
(stopped)294 3714 A
3870 V
(02503)210 648 A
1068(*)S
(due)126 1152 A
1320(to)S
(job)126 1446 A
(control,)336 1614 A
1992(as)S
(follows:)336 2118 A
3960 V
(02504)210 648 A
1068(*)S
4050 V
(02505)210 648 A
1068(*)S
(High)168 2412 A
(byte)168 2622 A
(Low)126 2916 A
(byte)168 3084 A
4140 V
(02506)210 648 A
1068(*)S
(+---------------------+)966 2370 A
4230 V
(02507)210 648 A
1068(*)S
(exit\(status\))504 1362 A
2370(|)S
(status)252 2496 A
2832(|)S
3042(0)S
3294(|)S
4320 V
(02508)210 648 A
1068(*)S
(+---------------------+)966 2370 A
4410 V
(02509)210 648 A
1068(*)S
(killed)252 1362 A
1656(by)S
(signal)252 1782 A
2370(|)S
2580(0)S
2832(|)S
(signal)252 2958 A
3294(|)S
4500 V
(02510)210 648 A
1068(*)S
(+---------------------+)966 2370 A
4590 V
(02511)210 648 A
1068(*)S
(stopped)294 1362 A
(\(job)168 1698 A
(control\))336 1908 A
2370(|)S
(signal)252 2496 A
2832(|)S
(0177)168 3000 A
3294(|)S
4680 V
(02512)210 648 A
1068(*)S
(+---------------------+)966 2370 A
4770 V
(02513)210 648 A
1068(*/)S
4860 V
(02514)210 648 A
4950 V
(02515)210 648 A
(#ifndef)294 1026 A
(_WAIT_H)294 1362 A
5040 V
(02516)210 648 A
(#define)294 1026 A
(_WAIT_H)294 1362 A
5130 V
(02517)210 648 A
5220 V
(02518)210 648 A
(#define)294 1026 A
(_LOW\(v\))294 1362 A
2034(\()S
(\(v\))126 2118 A
2286(&)S
(0377\))210 2370 A
5310 V
(02519)210 648 A
(#define)294 1026 A
(_HIGH\(v\))336 1362 A
2034(\()S
(\(\(v\))168 2118 A
2328(>>)S
2454(8\))S
2580(&)S
(0377\))210 2664 A
5400 V
(02520)210 648 A
5490 V
(02521)210 648 A
(#define)294 1026 A
(WNOHANG)294 1362 A
2034(1)S
2370(/*)S
2496(do)S
(not)126 2622 A
(wait)168 2790 A
(for)126 3000 A
(child)210 3168 A
3420(to)S
(exit)168 3546 A
3756(*/)S
5580 V
(02522)210 648 A
(#define)294 1026 A
(WUNTRACED)378 1362 A
2034(2)S
2370(/*)S
(for)126 2496 A
(job)126 2664 A
(control;)336 2832 A
(not)126 3210 A
(implemented)462 3378 A
3882(*/)S
5670 V
(02523)210 648 A
5760 V
(02524)210 648 A
(#define)294 1026 A
(WIFEXITED\(s\))504 1362 A
(\(_LOW\(s\))336 2034 A
2412(==)S
2538(0\))S
3546(/*)S
(normal)252 3672 A
(exit)168 3966 A
4176(*/)S
5850 V
(02525)210 648 A
(#define)294 1026 A
(WEXITSTATUS\(s\))588 1362 A
(\(_HIGH\(s\)\))420 2034 A
3546(/*)S
(exit)168 3672 A
(status)252 3882 A
4176(*/)S
5940 V
(02526)210 648 A
(#define)294 1026 A
(WTERMSIG\(s\))462 1362 A
(\(_LOW\(s\))336 2034 A
2412(&)S
(0177\))210 2496 A
3546(/*)S
(sig)126 3672 A
(value)210 3840 A
4092(*/)S
6030 V
(02527)210 648 A
(#define)294 1026 A
(WIFSIGNALED\(s\))588 1362 A
(\(\(\(unsigned)462 2034 A
(int\)\(s\)-1)378 2538 A
2958(&)S
(0xFFFF\))294 3042 A
3378(<)S
(0xFF\))210 3462 A
3714(/*)S
(signaled)336 3840 A
4218(*/)S
6120 V
(02528)210 648 A
(#define)294 1026 A
(WIFSTOPPED\(s\))546 1362 A
(\(_LOW\(s\))336 2034 A
2412(==)S
(0177\))210 2538 A
3546(/*)S
(stopped)294 3672 A
4008(*/)S
6210 V
(02529)210 648 A
(#define)294 1026 A
(WSTOPSIG\(s\))462 1362 A
(\(_HIGH\(s\))378 2034 A
2454(&)S
(0377\))210 2538 A
3546(/*)S
(stop)168 3672 A
(signal)252 3882 A
4176(*/)S
8418 V
EP
%%Page: 30 30
BP
/slant 0 def
/height 0 def
630 V
12 B
648(30)S
11 R
2019(File:)S
2252(include/sys/wait.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(02530)210 648 A
990 V
(02531)210 648 A
1026(/*)S
(Function)336 1152 A
(Prototypes.)462 1530 A
2034(*/)S
1080 V
(02532)210 648 A
(#ifndef)294 1026 A
(_ANSI_H)294 1362 A
1170 V
(02533)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
1260 V
(02534)210 648 A
(#endif)252 1026 A
1350 V
(02535)210 648 A
1440 V
(02536)210 648 A
(_PROTOTYPE\()462 1026 A
(pid_t)210 1530 A
(wait,)210 1782 A
(\(int)168 2034 A
(*_stat_loc\))462 2244 A
4176(\);)S
1530 V
(02537)210 648 A
(_PROTOTYPE\()462 1026 A
(pid_t)210 1530 A
(waitpid,)336 1782 A
(\(pid_t)252 2160 A
(_pid,)210 2454 A
(int)126 2706 A
(*_stat_loc,)462 2874 A
(int)126 3378 A
(_options\))378 3546 A
4176(\);)S
1620 V
(02538)210 648 A
1710 V
(02539)210 648 A
(#endif)252 1026 A
1320(/*)S
(_WAIT_H)294 1446 A
1782(*/)S
2340 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2430 V
(include/minix/config.h)924 2034 A
2520 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2700 V
(02600)210 648 A
(#ifndef)294 1026 A
(_CONFIG_H)378 1362 A
2790 V
(02601)210 648 A
(#define)294 1026 A
(_CONFIG_H)378 1362 A
2880 V
(02602)210 648 A
2970 V
(02603)210 648 A
1026(/*)S
(Minix)210 1152 A
(release)294 1404 A
(and)126 1740 A
(version)294 1908 A
(numbers.)336 2244 A
2622(*/)S
3060 V
(02604)210 648 A
(#define)294 1026 A
(OS_RELEASE)420 1362 A
("2.0")210 1824 A
3150 V
(02605)210 648 A
(#define)294 1026 A
(OS_VERSION)420 1362 A
("0")126 1824 A
3240 V
(02606)210 648 A
3330 V
(02607)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(sets)168 1572 A
(configuration)546 1782 A
(parameters)420 2370 A
(for)126 2832 A
(the)126 3000 A
(MINIX)210 3168 A
(kernel,)294 3420 A
(FS,)126 3756 A
(and)126 3924 A
(MM.)126 4092 A
3420 V
(02608)210 648 A
1068(*)S
1152(It)S
1278(is)S
(divided)294 1404 A
1740(up)S
(into)168 1866 A
(two)126 2076 A
(main)168 2244 A
(sections.)378 2454 A
(The)126 2916 A
(first)210 3084 A
(section)294 3336 A
(contains)336 3672 A
3510 V
(02609)210 648 A
1068(*)S
(user-settable)546 1152 A
(parameters.)462 1740 A
2286(In)S
(the)126 2412 A
(second)252 2580 A
(section,)336 2874 A
(various)294 3252 A
(internal)336 3588 A
(system)252 3966 A
3600 V
(02610)210 648 A
1068(*)S
(parameters)420 1152 A
(are)126 1614 A
(set)126 1782 A
(based)210 1950 A
2202(on)S
(the)126 2328 A
(user-settable)546 2496 A
(parameters.)462 3084 A
3690 V
(02611)210 648 A
1068(*/)S
3780 V
(02612)210 648 A
3870 V
(02613)210 648 A
(/*===========================================================================*)3276 1026 A
3960 V
(02614)210 648 A
1068(*)S
(This)168 1698 A
(section)294 1908 A
(contains)336 2244 A
(user-settable)546 2622 A
(parameters)420 3210 A
4260(*)S
4050 V
(02615)210 648 A
(*===========================================================================*/)3276 1068 A
4140 V
(02616)210 648 A
(#define)294 1026 A
(MACHINE)294 1362 A
(IBM_PC)252 1950 A
2370(/*)S
(Must)168 2496 A
2706(be)S
(one)126 2832 A
3000(of)S
(the)126 3126 A
(names)210 3294 A
(listed)252 3546 A
(below)210 3840 A
4092(*/)S
4230 V
(02617)210 648 A
4320 V
(02618)210 648 A
(#define)294 1026 A
(IBM_PC)252 1362 A
2160(1)S
2370(/*)S
(any)126 2496 A
(8088)168 2706 A
2916(or)S
(80x86-based)462 3042 A
(system)252 3546 A
3840(*/)S
4410 V
(02619)210 648 A
(#define)294 1026 A
(SUN_4)210 1362 A
2118(40)S
2370(/*)S
(any)126 2496 A
(Sun)126 2664 A
(SPARC-based)462 2832 A
(system)252 3336 A
3630(*/)S
4500 V
(02620)210 648 A
(#define)294 1026 A
(SUN_4_60)336 1362 A
2118(40)S
2370(/*)S
(Sun-4/60)336 2496 A
(\(aka)168 2874 A
(SparcStation)504 3084 A
3630(1)S
3714(or)S
(Campus\))294 3840 A
4176(*/)S
4590 V
(02621)210 648 A
(#define)294 1026 A
(ATARI)210 1362 A
2118(60)S
2370(/*)S
(ATARI)210 2496 A
(ST/STe/TT)378 2748 A
(\(68000/68030\))546 3168 A
3756(*/)S
4680 V
(02622)210 648 A
(#define)294 1026 A
(AMIGA)210 1362 A
2118(61)S
2370(/*)S
(Commodore)378 2496 A
(Amiga)210 2916 A
(\(68000\))294 3168 A
3504(*/)S
4770 V
(02623)210 648 A
(#define)294 1026 A
(MACINTOSH)378 1362 A
2118(62)S
2370(/*)S
(Apple)210 2496 A
(Macintosh)378 2748 A
(\(68000\))294 3168 A
3504(*/)S
4860 V
(02624)210 648 A
4950 V
(02625)210 648 A
1026(/*)S
(Word)168 1152 A
(size)168 1362 A
1572(in)S
(bytes)210 1698 A
1950(\(a)S
(constant)336 2076 A
(equal)210 2454 A
2706(to)S
(sizeof\(int\)\).)546 2832 A
3420(*/)S
5040 V
(02626)210 648 A
(#if)126 1026 A
(__ACK__)294 1194 A
5130 V
(02627)210 648 A
(#define)294 1026 A
(_WORD_SIZE)420 1362 A
(_EM_WSIZE)378 2034 A
5220 V
(02628)210 648 A
(#endif)252 1026 A
5310 V
(02629)210 648 A
5400 V
(02630)210 648 A
5490 V
(02631)210 648 A
1026(/*)S
1152(If)S
(ROBUST)252 1278 A
1572(is)S
(set)126 1698 A
1866(to)S
1992(1,)S
(writes)252 2118 A
2412(of)S
(i-node,)294 2538 A
(directory,)420 2874 A
(and)126 3336 A
(indirect)336 3504 A
(blocks)252 3882 A
5580 V
(02632)210 648 A
1068(*)S
(from)168 1152 A
(the)126 1362 A
(cache)210 1530 A
(happen)252 1782 A
2076(as)S
(soon)168 2202 A
2412(as)S
(the)126 2538 A
(blocks)252 2706 A
(are)126 3000 A
(modified.)378 3168 A
(This)168 3630 A
(gives)210 3840 A
4092(a)S
(more)168 4176 A
5670 V
(02633)210 648 A
1068(*)S
(robust,)294 1152 A
(but)126 1488 A
(slower,)294 1656 A
(file)168 1992 A
(system.)294 2202 A
2580(If)S
2706(it)S
2832(is)S
(set)126 2958 A
3126(to)S
3252(0,)S
(these)210 3378 A
(blocks)252 3630 A
(are)126 3924 A
(not)126 4092 A
5760 V
(02634)210 648 A
1068(*)S
(given)210 1152 A
(any)126 1404 A
(special)294 1572 A
(treatment,)420 1908 A
(which)210 2370 A
(may)126 2622 A
(cause)210 2790 A
(problems)336 3042 A
3420(if)S
(the)126 3546 A
(system)252 3714 A
(crashes.)336 4008 A
5850 V
(02635)210 648 A
1068(*/)S
5940 V
(02636)210 648 A
(#define)294 1026 A
(ROBUST)252 1362 A
2160(0)S
2370(/*)S
2496(0)S
(for)126 2580 A
(speed,)252 2748 A
3042(1)S
(for)126 3126 A
(robustness)420 3294 A
3756(*/)S
6030 V
(02637)210 648 A
6120 V
(02638)210 648 A
1026(/*)S
(Number)252 1152 A
1446(of)S
(slots)210 1572 A
1824(in)S
(the)126 1950 A
(process)294 2118 A
(table)210 2454 A
(for)126 2706 A
(user)168 2874 A
(processes.)420 3084 A
3546(*/)S
6210 V
(02639)210 648 A
(#define)294 1026 A
(NR_PROCS)336 1362 A
2118(32)S
8418 V
EP
%%Page: 31 31
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1915(File:)S
2148(include/minix/config.h)S
12 B
4308(31)S
900 V
7 LST
(02640)210 648 A
990 V
(02641)210 648 A
1026(/*)S
(The)126 1152 A
(buffer)252 1320 A
(cache)210 1614 A
(should)252 1866 A
2160(be)S
(made)168 2286 A
2496(as)S
(large)210 2622 A
2874(as)S
(you)126 3000 A
(can)126 3168 A
(afford.)294 3336 A
3672(*/)S
1080 V
(02642)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(IBM_PC)252 1698 A
1992(&&)S
(_WORD_SIZE)420 2118 A
2580(==)S
2706(2\))S
1170 V
(02643)210 648 A
(#define)294 1026 A
(NR_BUFS)294 1362 A
2118(40)S
2370(/*)S
2496(#)S
(blocks)252 2580 A
2874(in)S
(the)126 3000 A
(buffer)252 3168 A
(cache)210 3462 A
3714(*/)S
1260 V
(02644)210 648 A
(#define)294 1026 A
(NR_BUF_HASH)462 1362 A
2118(64)S
2370(/*)S
(size)168 2496 A
2706(of)S
(buf)126 2832 A
(hash)168 3000 A
(table;)252 3210 A
(MUST)168 3504 A
3714(BE)S
(POWER)210 3840 A
4092(OF)S
(2*/)126 4218 A
1350 V
(02645)210 648 A
(#endif)252 1026 A
1440 V
(02646)210 648 A
1530 V
(02647)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(IBM_PC)252 1698 A
1992(&&)S
(_WORD_SIZE)420 2118 A
2580(==)S
2706(4\))S
1620 V
(02648)210 648 A
(#define)294 1026 A
(NR_BUFS)294 1362 A
(512)126 2076 A
2370(/*)S
2496(#)S
(blocks)252 2580 A
2874(in)S
(the)126 3000 A
(buffer)252 3168 A
(cache)210 3462 A
3714(*/)S
1710 V
(02649)210 648 A
(#define)294 1026 A
(NR_BUF_HASH)462 1362 A
(1024)168 2034 A
2370(/*)S
(size)168 2496 A
2706(of)S
(buf)126 2832 A
(hash)168 3000 A
(table;)252 3210 A
(MUST)168 3504 A
3714(BE)S
(POWER)210 3840 A
4092(OF)S
(2*/)126 4218 A
1800 V
(02650)210 648 A
(#endif)252 1026 A
1890 V
(02651)210 648 A
1980 V
(02652)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(SUN_4_60\))378 1698 A
2070 V
(02653)210 648 A
(#define)294 1026 A
(NR_BUFS)294 1362 A
(512)126 2076 A
2370(/*)S
2496(#)S
(blocks)252 2580 A
2874(in)S
(the)126 3000 A
(buffer)252 3168 A
(cache)210 3462 A
(\(<=1536\))336 3714 A
4092(*/)S
2160 V
(02654)210 648 A
(#define)294 1026 A
(NR_BUF_HASH)462 1362 A
(512)126 2076 A
2370(/*)S
(size)168 2496 A
2706(of)S
(buf)126 2832 A
(hash)168 3000 A
(table;)252 3210 A
(MUST)168 3504 A
3714(BE)S
(POWER)210 3840 A
4092(OF)S
(2*/)126 4218 A
2250 V
(02655)210 648 A
(#endif)252 1026 A
2340 V
(02656)210 648 A
2430 V
(02657)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(ATARI\))252 1698 A
2520 V
(02658)210 648 A
(#define)294 1026 A
(NR_BUFS)294 1362 A
(1536)168 2034 A
2370(/*)S
2496(#)S
(blocks)252 2580 A
2874(in)S
(the)126 3000 A
(buffer)252 3168 A
(cache)210 3462 A
(\(<=1536\))336 3714 A
4092(*/)S
2610 V
(02659)210 648 A
(#define)294 1026 A
(NR_BUF_HASH)462 1362 A
(2048)168 2034 A
2370(/*)S
(size)168 2496 A
2706(of)S
(buf)126 2832 A
(hash)168 3000 A
(table;)252 3210 A
(MUST)168 3504 A
3714(BE)S
(POWER)210 3840 A
4092(OF)S
(2*/)126 4218 A
2700 V
(02660)210 648 A
(#endif)252 1026 A
2790 V
(02661)210 648 A
2880 V
(02662)210 648 A
1026(/*)S
(Defines)294 1152 A
(for)126 1488 A
(kernel)252 1656 A
(configuration.)588 1950 A
2580(*/)S
2970 V
(02663)210 648 A
(#define)294 1026 A
(AUTO_BIOS)378 1362 A
2160(0)S
2370(/*)S
(xt_wini.c)378 2496 A
2916(-)S
(use)126 3000 A
(Western's)378 3168 A
(autoconfig)420 3588 A
(BIOS)168 4050 A
4260(*/)S
3060 V
(02664)210 648 A
(#define)294 1026 A
(LINEWRAP)336 1362 A
2160(1)S
2370(/*)S
(console.c)378 2496 A
2916(-)S
(wrap)168 3000 A
(lines)210 3210 A
3462(at)S
(column)252 3588 A
3882(80)S
4008(*/)S
3150 V
(02665)210 648 A
(#define)294 1026 A
(ALLOW_GAP_MESSAGES)756 1362 A
2160(1)S
2370(/*)S
(proc.c)252 2496 A
2790(-)S
(allow)210 2874 A
(messages)336 3126 A
3504(in)S
(the)126 3630 A
(gap)126 3798 A
(between)294 3966 A
3240 V
(02666)210 648 A
2412(*)S
(the)126 2496 A
(end)126 2664 A
2832(of)S
(bss)126 2958 A
(and)126 3126 A
(lowest)252 3294 A
(stack)210 3588 A
(address)294 3840 A
4176(*/)S
3330 V
(02667)210 648 A
3420 V
(02668)210 648 A
1026(/*)S
(Enable)252 1152 A
1446(or)S
(disable)294 1572 A
(the)126 1908 A
(second)252 2076 A
(level)210 2370 A
(file)168 2622 A
(system)252 2832 A
(cache)210 3126 A
3378(on)S
(the)126 3504 A
(RAM)126 3672 A
(disk.)210 3840 A
4092(*/)S
3510 V
(02669)210 648 A
(#define)294 1026 A
(ENABLE_CACHE2)546 1362 A
2160(0)S
3600 V
(02670)210 648 A
3690 V
(02671)210 648 A
1026(/*)S
(Include)294 1152 A
1488(or)S
(exclude)294 1614 A
(device)252 1950 A
(drivers.)336 2244 A
(Set)126 2664 A
2832(to)S
2958(1)S
3042(to)S
(include,)336 3168 A
3546(0)S
3630(to)S
(exclude.)336 3756 A
4134(*/)S
3780 V
(02672)210 648 A
(#define)294 1026 A
(ENABLE_NETWORKING)714 1362 A
2160(0)S
2370(/*)S
(enable)252 2496 A
(TCP/IP)252 2790 A
(code)168 3084 A
3294(*/)S
3870 V
(02673)210 648 A
(#define)294 1026 A
(ENABLE_AT_WINI)588 1362 A
2160(1)S
2370(/*)S
(enable)252 2496 A
2790(AT)S
(winchester)420 2916 A
(driver)252 3378 A
3672(*/)S
3960 V
(02674)210 648 A
(#define)294 1026 A
(ENABLE_BIOS_WINI)672 1362 A
2160(0)S
2370(/*)S
(enable)252 2496 A
(BIOS)168 2790 A
(winchester)420 3000 A
(driver)252 3462 A
3756(*/)S
4050 V
(02675)210 648 A
(#define)294 1026 A
(ENABLE_ESDI_WINI)672 1362 A
2160(0)S
2370(/*)S
(enable)252 2496 A
(ESDI)168 2790 A
(winchester)420 3000 A
(driver)252 3462 A
3756(*/)S
4140 V
(02676)210 648 A
(#define)294 1026 A
(ENABLE_XT_WINI)588 1362 A
2160(0)S
2370(/*)S
(enable)252 2496 A
2790(XT)S
(winchester)420 2916 A
(driver)252 3378 A
3672(*/)S
4230 V
(02677)210 648 A
(#define)294 1026 A
(ENABLE_ADAPTEC_SCSI)798 1362 A
2202(0)S
2370(/*)S
(enable)252 2496 A
(ADAPTEC)294 2790 A
(SCSI)168 3126 A
(driver)252 3336 A
3630(*/)S
4320 V
(02678)210 648 A
(#define)294 1026 A
(ENABLE_MITSUMI_CDROM)840 1362 A
2244(0)S
2370(/*)S
(enable)252 2496 A
(Mitsumi)294 2790 A
(CD-ROM)252 3126 A
(driver)252 3420 A
3714(*/)S
4410 V
(02679)210 648 A
(#define)294 1026 A
(ENABLE_SB_AUDIO)630 1362 A
2160(0)S
2370(/*)S
(enable)252 2496 A
(Soundblaster)504 2790 A
(audio)210 3336 A
(driver)252 3588 A
3882(*/)S
4500 V
(02680)210 648 A
4590 V
(02681)210 648 A
1026(/*)S
(DMA_SECTORS)462 1152 A
(may)126 1656 A
1824(be)S
(increased)378 1950 A
2370(to)S
(speed)210 2496 A
2748(up)S
(DMA)126 2874 A
(based)210 3042 A
(drivers.)336 3294 A
3672(*/)S
4680 V
(02682)210 648 A
(#define)294 1026 A
(DMA_SECTORS)462 1362 A
2160(1)S
2370(/*)S
(DMA)126 2496 A
(buffer)252 2664 A
(size)168 2958 A
(\(must)210 3168 A
3420(be)S
3546(>=)S
3672(1\))S
3798(*/)S
4770 V
(02683)210 648 A
4860 V
(02684)210 648 A
1026(/*)S
(Include)294 1152 A
1488(or)S
(exclude)294 1614 A
(backwards)378 1950 A
(compatibility)546 2370 A
(code.)210 2958 A
3210(*/)S
4950 V
(02685)210 648 A
(#define)294 1026 A
(ENABLE_BINCOMPAT)672 1362 A
2160(0)S
2370(/*)S
(for)126 2496 A
(binaries)336 2664 A
(using)210 3042 A
(obsolete)336 3294 A
(calls)210 3672 A
3924(*/)S
5040 V
(02686)210 648 A
(#define)294 1026 A
(ENABLE_SRCCOMPAT)672 1362 A
2160(0)S
2370(/*)S
(for)126 2496 A
(sources)294 2664 A
(using)210 3000 A
(obsolete)336 3252 A
(calls)210 3630 A
3882(*/)S
5130 V
(02687)210 648 A
5220 V
(02688)210 648 A
1026(/*)S
(Determine)378 1152 A
(which)210 1572 A
(device)252 1824 A
2118(to)S
(use)126 2244 A
(for)126 2412 A
(pipes.)252 2580 A
2874(*/)S
5310 V
(02689)210 648 A
(#define)294 1026 A
(PIPE_DEV)336 1362 A
(ROOT_DEV)336 1866 A
2370(/*)S
(put)126 2496 A
(pipes)210 2664 A
2916(on)S
(root)168 3042 A
(device)252 3252 A
3546(*/)S
5400 V
(02690)210 648 A
5490 V
(02691)210 648 A
1026(/*)S
(NR_CONS,)336 1152 A
(NR_RS_LINES,)504 1530 A
(and)126 2076 A
(NR_PTYS)294 2244 A
(determine)378 2580 A
(the)126 3000 A
(number)252 3168 A
3462(of)S
(terminals)378 3588 A
(the)126 4008 A
5580 V
(02692)210 648 A
1068(*)S
(system)252 1152 A
(can)126 1446 A
(handle.)294 1614 A
5670 V
(02693)210 648 A
1068(*/)S
5760 V
(02694)210 648 A
(#define)294 1026 A
(NR_CONS)294 1362 A
2160(2)S
2370(/*)S
2496(#)S
(system)252 2580 A
(consoles)336 2874 A
3252(\(1)S
3378(to)S
3504(8\))S
3630(*/)S
5850 V
(02695)210 648 A
(#define)294 1026 A
(NR_RS_LINES)462 1362 A
2160(0)S
2370(/*)S
2496(#)S
(rs232)210 2580 A
(terminals)378 2832 A
(\(0,)126 3252 A
3420(1,)S
3546(or)S
3672(2\))S
3798(*/)S
5940 V
(02696)210 648 A
(#define)294 1026 A
(NR_PTYS)294 1362 A
2160(0)S
2370(/*)S
2496(#)S
(pseudo)252 2580 A
(terminals)378 2874 A
3294(\(0)S
3420(to)S
(64\))126 3546 A
3714(*/)S
6030 V
(02697)210 648 A
6120 V
(02698)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(ATARI\))252 1698 A
6210 V
(02699)210 648 A
1026(/*)S
(The)126 1152 A
(next)168 1320 A
(define)252 1530 A
(says)168 1824 A
2034(if)S
(you)126 2160 A
(have)168 2328 A
2538(an)S
(ATARI)210 2664 A
2916(ST)S
3042(or)S
3168(TT)S
3294(*/)S
8418 V
EP
%%Page: 32 32
BP
/slant 0 def
/height 0 def
630 V
12 B
648(32)S
11 R
1915(File:)S
2148(include/minix/config.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(02700)210 648 A
(#define)294 1026 A
(ATARI_TYPE)420 1362 A
2118(TT)S
990 V
(02701)210 648 A
(#define)294 1026 A
1362(ST)S
2160(1)S
2370(/*)S
(all)126 2496 A
(ST's)168 2664 A
(and)126 2874 A
(Mega)168 3042 A
(ST's)168 3252 A
3462(*/)S
1080 V
(02702)210 648 A
(#define)294 1026 A
(STE)126 1362 A
2160(2)S
2370(/*)S
(all)126 2496 A
(STe)126 2664 A
(and)126 2832 A
(Mega)168 3000 A
(STe's)210 3210 A
3462(*/)S
1170 V
(02703)210 648 A
(#define)294 1026 A
1362(TT)S
2160(3)S
1260 V
(02704)210 648 A
1350 V
(02705)210 648 A
1026(/*)S
1152(if)S
(SCREEN)252 1278 A
1572(is)S
(set)126 1698 A
1866(to)S
1992(1)S
(graphical)378 2076 A
(screen)252 2496 A
(operations)420 2790 A
(are)126 3252 A
(possible)336 3420 A
3798(*/)S
1440 V
(02706)210 648 A
(#define)294 1026 A
(SCREEN)252 1362 A
2160(1)S
1530 V
(02707)210 648 A
1620 V
(02708)210 648 A
1026(/*)S
(This)168 1152 A
(define)252 1362 A
(says)168 1656 A
(whether)294 1866 A
(the)126 2202 A
(keyboard)336 2370 A
(generates)378 2748 A
(VT100)210 3168 A
3420(or)S
(IBM_PC)252 3546 A
(escapes.)336 3840 A
4218(*/)S
1710 V
(02709)210 648 A
(#define)294 1026 A
(KEYBOARD)336 1362 A
(VT100)210 1992 A
2370(/*)S
(either)252 2496 A
(VT100)210 2790 A
3042(or)S
(IBM_PC)252 3168 A
3462(*/)S
1800 V
(02710)210 648 A
(#define)294 1026 A
(VT100)210 1362 A
(100)126 2076 A
1890 V
(02711)210 648 A
1980 V
(02712)210 648 A
1026(/*)S
(The)126 1152 A
(next)168 1320 A
(define)252 1530 A
(determines)420 1824 A
(the)126 2286 A
(kind)168 2454 A
2664(of)S
(partitioning.)546 2790 A
3378(*/)S
2070 V
(02713)210 648 A
(#define)294 1026 A
(PARTITIONING)504 1362 A
(SUPRA)210 1992 A
2370(/*)S
(one)126 2496 A
2664(of)S
(the)126 2790 A
(following)378 2958 A
3378(or)S
(ATARI)210 3504 A
3756(*/)S
2160 V
(02714)210 648 A
(#define)294 1026 A
(SUPRA)210 1362 A
2160(1)S
(/*ICD,)252 2370 A
(SUPRA)210 2664 A
(and)126 2916 A
(BMS)126 3084 A
(are)126 3252 A
(all)126 3420 A
(the)126 3588 A
(same)168 3756 A
3966(*/)S
2250 V
(02715)210 648 A
(#define)294 1026 A
(BMS)126 1362 A
2160(1)S
2340 V
(02716)210 648 A
(#define)294 1026 A
(ICD)126 1362 A
2160(1)S
2430 V
(02717)210 648 A
(#define)294 1026 A
(CBHD)168 1362 A
2160(2)S
2520 V
(02718)210 648 A
(#define)294 1026 A
(EICKMANN)336 1362 A
2160(3)S
2610 V
(02719)210 648 A
2700 V
(02720)210 648 A
1026(/*)S
(Define)252 1152 A
(the)126 1446 A
(number)252 1614 A
1908(of)S
(hard)168 2034 A
(disk)168 2244 A
(drives)252 2454 A
2748(on)S
(your)168 2874 A
(system.)294 3084 A
3420(*/)S
2790 V
(02721)210 648 A
(#define)294 1026 A
(NR_ACSI_DRIVES)588 1362 A
2160(3)S
2370(/*)S
(typically)378 2496 A
2916(0)S
3000(or)S
3126(1)S
3210(*/)S
2880 V
(02722)210 648 A
(#define)294 1026 A
(NR_SCSI_DRIVES)588 1362 A
2160(1)S
2370(/*)S
(typically)378 2496 A
2916(0)S
(\(ST,)168 3000 A
(STe\))168 3210 A
3420(or)S
3546(1)S
(\(TT\))168 3630 A
3840(*/)S
2970 V
(02723)210 648 A
3060 V
(02724)210 648 A
1026(/*)S
(Some)168 1152 A
(systems)294 1362 A
(need)168 1698 A
1908(to)S
(have)168 2034 A
2244(a)S
(little)252 2328 A
(delay)210 2622 A
(after)210 2874 A
(each)168 3126 A
(winchester)420 3336 A
3150 V
(02725)210 648 A
1068(*)S
(commands.)378 1152 A
(These)210 1572 A
(systems)294 1824 A
(need)168 2160 A
(FAST_DISK)378 2370 A
(set)126 2790 A
2958(to)S
3084(0.)S
(Other)210 3210 A
(disks)210 3462 A
3714(do)S
(not)126 3840 A
3240 V
(02726)210 648 A
1068(*)S
(need)168 1152 A
(this)168 1362 A
(delay,)252 1572 A
(and)126 1866 A
(thus)168 2034 A
(can)126 2244 A
(have)168 2412 A
(FAST_DISK)378 2622 A
(set)126 3042 A
3210(to)S
3336(1)S
3420(to)S
(avoid)210 3546 A
(this)168 3798 A
(delay.)252 4008 A
3330 V
(02727)210 648 A
1068(*/)S
3420 V
(02728)210 648 A
(#define)294 1026 A
(FAST_DISK)378 1362 A
2160(1)S
2370(/*)S
2496(0)S
2580(or)S
2706(1)S
2790(*/)S
3510 V
(02729)210 648 A
3600 V
(02730)210 648 A
1026(/*)S
(Note:)210 1152 A
1404(if)S
(you)126 1530 A
(want)168 1698 A
1908(to)S
(make)168 2034 A
(your)168 2244 A
(kernel)252 2454 A
(smaller,)336 2748 A
(you)126 3126 A
(can)126 3294 A
(set)126 3462 A
(NR_FD_DRIVES)504 3630 A
3690 V
(02731)210 648 A
1068(*)S
1152(to)S
1278(0.)S
(You)126 1404 A
(will)168 1572 A
(still)210 1782 A
2034(be)S
(able)168 2160 A
2370(to)S
(boot)168 2496 A
(minix.img)378 2706 A
(from)168 3126 A
(floppy.)294 3336 A
(However,)336 3672 A
(you)126 4050 A
3780 V
(02732)210 648 A
1068(*)S
(MUST)168 1152 A
(fetch)210 1362 A
(both)168 1614 A
(the)126 1824 A
(root)168 1992 A
(and)126 2202 A
(usr)126 2370 A
(filesystem)420 2538 A
(from)168 3000 A
3210(a)S
(hard)168 3294 A
(disk)168 3504 A
3870 V
(02733)210 648 A
1068(*/)S
3960 V
(02734)210 648 A
4050 V
(02735)210 648 A
1026(/*)S
(Define)252 1152 A
(the)126 1446 A
(number)252 1614 A
1908(of)S
(floppy)252 2034 A
(disk)168 2328 A
(drives)252 2538 A
2832(on)S
(your)168 2958 A
(system.)294 3168 A
3504(*/)S
4140 V
(02736)210 648 A
(#define)294 1026 A
(NR_FD_DRIVES)504 1362 A
2160(1)S
2370(/*)S
2496(0,)S
2622(1,)S
2748(2)S
2832(*/)S
4230 V
(02737)210 648 A
4320 V
(02738)210 648 A
1026(/*)S
(This)168 1152 A
(configuration)546 1362 A
(define)252 1950 A
(controls)336 2244 A
(parallel)336 2622 A
(printer)294 3000 A
(code.)210 3336 A
3588(*/)S
4410 V
(02739)210 648 A
(#define)294 1026 A
(PAR_PRINTER)462 1362 A
2160(1)S
2370(/*)S
(disable)294 2496 A
(\(0\))126 2832 A
3000(/)S
(enable)252 3084 A
(\(1\))126 3378 A
(parallel)336 3546 A
(printer)294 3924 A
4260(*/)S
4500 V
(02740)210 648 A
4590 V
(02741)210 648 A
1026(/*)S
(This)168 1152 A
(configuration)546 1362 A
(define)252 1950 A
(controls)336 2244 A
(disk)168 2622 A
(controller)420 2832 A
(clock)210 3294 A
(code.)210 3546 A
3798(*/)S
4680 V
(02742)210 648 A
(#define)294 1026 A
(HD_CLOCK)336 1362 A
2160(1)S
2370(/*)S
(disable)294 2496 A
(\(0\))126 2832 A
3000(/)S
(enable)252 3084 A
(\(1\))126 3378 A
(hard)168 3546 A
(disk)168 3756 A
(clock)210 3966 A
4218(*/)S
4770 V
(02743)210 648 A
4860 V
(02744)210 648 A
(#endif)252 1026 A
4950 V
(02745)210 648 A
5040 V
(02746)210 648 A
5130 V
(02747)210 648 A
(/*===========================================================================*)3276 1026 A
5220 V
(02748)210 648 A
1068(*)S
(There)210 1362 A
(are)126 1614 A
1782(no)S
(user-settable)546 1908 A
(parameters)420 2496 A
(after)210 2958 A
(this)168 3210 A
(line)168 3420 A
4260(*)S
5310 V
(02749)210 648 A
(*===========================================================================*/)3276 1068 A
5400 V
(02750)210 648 A
1026(/*)S
(Set)126 1152 A
(the)126 1320 A
(CHIP)168 1488 A
(type)168 1698 A
(based)210 1908 A
2160(on)S
(the)126 2286 A
(machine)294 2454 A
(selected.)378 2790 A
(The)126 3210 A
(symbol)252 3378 A
(CHIP)168 3672 A
3882(is)S
(actually)336 4008 A
5490 V
(02751)210 648 A
1068(*)S
(indicative)420 1152 A
1614(of)S
(more)168 1740 A
(than)168 1950 A
(just)168 2160 A
(the)126 2370 A
(CPU.)168 2538 A
(For)126 2790 A
(example,)336 2958 A
(machines)336 3336 A
(for)126 3714 A
(which)210 3882 A
5580 V
(02752)210 648 A
1068(*)S
(CHIP)168 1152 A
1362(==)S
(INTEL)210 1488 A
(are)126 1740 A
(expected)336 1908 A
2286(to)S
(have)168 2412 A
(8259A)210 2622 A
(interrrupt)420 2874 A
(controllers)462 3336 A
(and)126 3840 A
(the)126 4008 A
5670 V
(02753)210 648 A
1068(*)S
(other)210 1152 A
(properties)420 1404 A
1866(of)S
(IBM)126 1992 A
(PC/XT/AT/386)504 2160 A
(types)210 2706 A
(machines)336 2958 A
3336(in)S
(general.)336 3462 A
3840(*/)S
5760 V
(02754)210 648 A
(#define)294 1026 A
(INTEL)210 1362 A
2118(1)S
2370(/*)S
(CHIP)168 2496 A
(type)168 2706 A
(for)126 2916 A
(PC,)126 3084 A
(XT,)126 3252 A
(AT,)126 3420 A
(386)126 3588 A
(and)126 3756 A
(clones)252 3924 A
4218(*/)S
5850 V
(02755)210 648 A
(#define)294 1026 A
(M68000)252 1362 A
2118(2)S
2370(/*)S
(CHIP)168 2496 A
(type)168 2706 A
(for)126 2916 A
(Atari,)252 3084 A
(Amiga,)252 3378 A
(Macintosh)378 3672 A
4218(*/)S
5940 V
(02756)210 648 A
(#define)294 1026 A
(SPARC)210 1362 A
2118(3)S
2370(/*)S
(CHIP)168 2496 A
(type)168 2706 A
(for)126 2916 A
(SUN-4)210 3084 A
(\(e.g.)210 3336 A
(SPARCstation\))546 3588 A
4218(*/)S
6030 V
(02757)210 648 A
6120 V
(02758)210 648 A
1026(/*)S
(Set)126 1152 A
(the)126 1320 A
(FP_FORMAT)378 1488 A
(type)168 1908 A
(based)210 2118 A
2370(on)S
(the)126 2496 A
(machine)294 2664 A
(selected,)378 3000 A
(either)252 3420 A
3714(hw)S
3840(or)S
3966(sw)S
4218(*/)S
6210 V
(02759)210 648 A
(#define)294 1026 A
(FP_NONE)294 1362 A
2118(0)S
2370(/*)S
2496(no)S
(floating)336 2622 A
(point)210 3000 A
(support)294 3252 A
4218(*/)S
8418 V
EP
%%Page: 33 33
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1915(File:)S
2148(include/minix/config.h)S
12 B
4308(33)S
900 V
7 LST
(02760)210 648 A
(#define)294 1026 A
(FP_IEEE)294 1362 A
2118(1)S
2370(/*)S
(conform)294 2496 A
(IEEE)168 2832 A
(floating)336 3042 A
(point)210 3420 A
(standard)336 3672 A
4218(*/)S
990 V
(02761)210 648 A
1080 V
(02762)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(IBM_PC\))294 1698 A
1170 V
(02763)210 648 A
(#define)294 1026 A
(CHIP)168 1362 A
(INTEL)210 1950 A
1260 V
(02764)210 648 A
(#define)294 1026 A
(SHADOWING)378 1362 A
2118(0)S
1350 V
(02765)210 648 A
(#define)294 1026 A
(ENABLE_WINI)462 1362 A
(\(ENABLE_AT_WINI)630 2034 A
2706(||)S
(ENABLE_BIOS_WINI)672 2832 A
3546(||)S
3672(\\)S
1440 V
(02766)210 648 A
(ENABLE_ESDI_WINI)672 2034 A
2748(||)S
(ENABLE_XT_WINI\))630 2874 A
1530 V
(02767)210 648 A
(#define)294 1026 A
(ENABLE_SCSI)462 1362 A
(\(ENABLE_ADAPTEC_SCSI\))882 2034 A
1620 V
(02768)210 648 A
(#define)294 1026 A
(ENABLE_CDROM)504 1362 A
(\(ENABLE_MITSUMI_CDROM\))924 2034 A
1710 V
(02769)210 648 A
(#define)294 1026 A
(ENABLE_AUDIO)504 1362 A
(\(ENABLE_SB_AUDIO\))714 2034 A
1800 V
(02770)210 648 A
(#endif)252 1026 A
1890 V
(02771)210 648 A
1980 V
(02772)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(ATARI\))252 1698 A
1992(||)S
(\(MACHINE)336 2118 A
2496(==)S
(AMIGA\))252 2622 A
2916(||)S
(\(MACHINE)336 3042 A
3420(==)S
(MACINTOSH\))420 3546 A
2070 V
(02773)210 648 A
(#define)294 1026 A
(CHIP)168 1362 A
(M68000)252 1908 A
2160 V
(02774)210 648 A
(#define)294 1026 A
(SHADOWING)378 1362 A
2118(1)S
2250 V
(02775)210 648 A
(#endif)252 1026 A
2340 V
(02776)210 648 A
2430 V
(02777)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(SUN_4\))252 1698 A
1992(||)S
(\(MACHINE)336 2118 A
2496(==)S
(SUN_4_60\))378 2622 A
2520 V
(02778)210 648 A
(#define)294 1026 A
(CHIP)168 1362 A
(SPARC)210 1950 A
2610 V
(02779)210 648 A
(#define)294 1026 A
(FP_FORMAT)378 1362 A
(FP_IEEE)294 1866 A
2700 V
(02780)210 648 A
(#define)294 1026 A
(SHADOWING)378 1362 A
2118(0)S
2790 V
(02781)210 648 A
(#endif)252 1026 A
2880 V
(02782)210 648 A
2970 V
(02783)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(ATARI\))252 1698 A
1992(||)S
(\(MACHINE)336 2118 A
2496(==)S
(SUN_4\))252 2622 A
3060 V
(02784)210 648 A
(#define)294 1026 A
(ASKDEV)252 1362 A
2118(1)S
2370(/*)S
(ask)126 2496 A
(for)126 2664 A
(boot)168 2832 A
(device)252 3042 A
3336(*/)S
3150 V
(02785)210 648 A
(#define)294 1026 A
(FASTLOAD)336 1362 A
2118(1)S
2370(/*)S
(use)126 2496 A
(multiple)336 2664 A
(block)210 3042 A
(transfers)378 3294 A
3714(to)S
(init)168 3840 A
(ram)126 4050 A
4218(*/)S
3240 V
(02786)210 648 A
(#endif)252 1026 A
3330 V
(02787)210 648 A
3420 V
(02788)210 648 A
(#if)126 1026 A
(\(ATARI_TYPE)462 1194 A
1698(==)S
(TT\))126 1824 A
1992(/*)S
(and)126 2118 A
(all)126 2286 A
(other)210 2454 A
(68030's)294 2706 A
3042(*/)S
3510 V
(02789)210 648 A
(#define)294 1026 A
(FPP)126 1362 A
3600 V
(02790)210 648 A
(#undef)252 1026 A
(SHADOWING)378 1320 A
3690 V
(02791)210 648 A
(#define)294 1026 A
(SHADOWING)378 1362 A
1782(0)S
3780 V
(02792)210 648 A
(#endif)252 1026 A
3870 V
(02793)210 648 A
3960 V
(02794)210 648 A
(#ifndef)294 1026 A
(FP_FORMAT)378 1362 A
4050 V
(02795)210 648 A
(#define)294 1026 A
(FP_FORMAT)378 1362 A
(FP_NONE)294 1866 A
4140 V
(02796)210 648 A
(#endif)252 1026 A
4230 V
(02797)210 648 A
4320 V
(02798)210 648 A
1026(/*)S
(The)126 1152 A
(file)168 1320 A
(buf.h)210 1530 A
(uses)168 1782 A
(MAYBE_WRITE_IMMED.)756 1992 A
2790(*/)S
4410 V
(02799)210 648 A
(#if)126 1026 A
(ROBUST)252 1194 A
4500 V
(02800)210 648 A
(#define)294 1026 A
(MAYBE_WRITE_IMMED)714 1362 A
(WRITE_IMMED)462 2160 A
2706(/*)S
(slower)252 2832 A
(but)126 3126 A
(perhaps)294 3294 A
(safer)210 3630 A
3882(*/)S
4590 V
(02801)210 648 A
(#else)210 1026 A
4680 V
(02802)210 648 A
(#define)294 1026 A
(MAYBE_WRITE_IMMED)714 1362 A
2118(0)S
2706(/*)S
(faster)252 2832 A
3126(*/)S
4770 V
(02803)210 648 A
(#endif)252 1026 A
4860 V
(02804)210 648 A
4950 V
(02805)210 648 A
(#ifndef)294 1026 A
(MACHINE)294 1362 A
5040 V
(02806)210 648 A
(error)210 1026 A
("In)126 1278 A
(<minix/config.h>)672 1446 A
(please)252 2160 A
(define)252 2454 A
(MACHINE")336 2748 A
5130 V
(02807)210 648 A
(#endif)252 1026 A
5220 V
(02808)210 648 A
5310 V
(02809)210 648 A
(#ifndef)294 1026 A
(CHIP)168 1362 A
5400 V
(02810)210 648 A
(error)210 1026 A
("In)126 1278 A
(<minix/config.h>)672 1446 A
(please)252 2160 A
(define)252 2454 A
(MACHINE)294 2748 A
3084(to)S
(have)168 3210 A
3420(a)S
(legal)210 3504 A
(value")252 3756 A
5490 V
(02811)210 648 A
(#endif)252 1026 A
5580 V
(02812)210 648 A
5670 V
(02813)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
1698(0\))S
5760 V
(02814)210 648 A
(error)210 1026 A
("MACHINE)336 1278 A
(has)126 1656 A
(incorrect)378 1824 A
(value)210 2244 A
(\(0\)")168 2496 A
5850 V
(02815)210 648 A
(#endif)252 1026 A
5940 V
(02816)210 648 A
6030 V
(02817)210 648 A
(#endif)252 1026 A
1320(/*)S
(_CONFIG_H)378 1446 A
1866(*/)S
8418 V
EP
%%Page: 34 34
BP
/slant 0 def
/height 0 def
630 V
12 B
648(34)S
11 R
1939(File:)S
2172(include/minix/const.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(include/minix/const.h)882 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(02900)210 648 A
1026(/*)S
(Copyright)378 1152 A
(\(C\))126 1572 A
(1997)168 1740 A
1950(by)S
(Prentice-Hall,)588 2076 A
(Inc.)168 2706 A
(Permission)420 2958 A
3420(is)S
(hereby)252 3546 A
(granted)294 3840 A
1440 V
(02901)210 648 A
1068(*)S
1152(to)S
(redistribute)504 1278 A
(the)126 1824 A
(binary)252 1992 A
(and)126 2286 A
(source)252 2454 A
(programs)336 2748 A
3126(of)S
(this)168 3252 A
(system)252 3462 A
(for)126 3756 A
1530 V
(02902)210 648 A
1068(*)S
(educational)462 1152 A
1656(or)S
(research)336 1782 A
(purposes.)378 2160 A
(For)126 2622 A
(other)210 2790 A
(use,)168 3042 A
(written)294 3252 A
(permission)420 3588 A
(from)168 4050 A
1620 V
(02903)210 648 A
1068(*)S
(Prentice-Hall)546 1152 A
1740(is)S
(required.)378 1866 A
1710 V
(02904)210 648 A
1068(*/)S
1800 V
(02905)210 648 A
1890 V
(02906)210 648 A
(#define)294 1026 A
(EXTERN)252 1362 A
(extern)252 1950 A
2370(/*)S
(used)168 2496 A
2706(in)S
(*.h)126 2832 A
(files)210 3000 A
3252(*/)S
1980 V
(02907)210 648 A
(#define)294 1026 A
(PRIVATE)294 1362 A
(static)252 1950 A
2370(/*)S
(PRIVATE)294 2496 A
2832(x)S
(limits)252 2916 A
(the)126 3210 A
(scope)210 3378 A
3630(of)S
3756(x)S
3840(*/)S
2070 V
(02908)210 648 A
(#define)294 1026 A
(PUBLIC)252 1362 A
2370(/*)S
(PUBLIC)252 2496 A
2790(is)S
(the)126 2916 A
(opposite)336 3084 A
3462(of)S
(PRIVATE)294 3588 A
3924(*/)S
2160 V
(02909)210 648 A
(#define)294 1026 A
(FORWARD)294 1362 A
(static)252 1950 A
2370(/*)S
(some)168 2496 A
(compilers)378 2706 A
(require)294 3126 A
(this)168 3462 A
3672(to)S
3798(be)S
('static'*/)420 3924 A
2250 V
(02910)210 648 A
2340 V
(02911)210 648 A
(#define)294 1026 A
(TRUE)168 1362 A
2160(1)S
2370(/*)S
(used)168 2496 A
(for)126 2706 A
(turning)294 2874 A
(integers)336 3210 A
(into)168 3588 A
(Booleans)336 3798 A
4176(*/)S
2430 V
(02912)210 648 A
(#define)294 1026 A
(FALSE)210 1362 A
2160(0)S
2370(/*)S
(used)168 2496 A
(for)126 2706 A
(turning)294 2874 A
(integers)336 3210 A
(into)168 3588 A
(Booleans)336 3798 A
4176(*/)S
2520 V
(02913)210 648 A
2610 V
(02914)210 648 A
(#define)294 1026 A
1362(HZ)S
2118(60)S
2370(/*)S
(clock)210 2496 A
(freq)168 2748 A
(\(software)378 2958 A
(settable)336 3378 A
3756(on)S
(IBM-PC\))294 3882 A
4218(*/)S
2700 V
(02915)210 648 A
(#define)294 1026 A
(BLOCK_SIZE)420 1362 A
(1024)168 2034 A
2370(/*)S
2496(#)S
(bytes)210 2580 A
2832(in)S
2958(a)S
(disk)168 3042 A
(block)210 3252 A
3504(*/)S
2790 V
(02916)210 648 A
(#define)294 1026 A
(SUPER_USER)420 1362 A
(\(uid_t\))294 1824 A
2160(0)S
2370(/*)S
(uid_t)210 2496 A
2748(of)S
(superuser)378 2874 A
3294(*/)S
2880 V
(02917)210 648 A
2970 V
(02918)210 648 A
(#define)294 1026 A
(MAJOR)210 1362 A
2160(8)S
2370(/*)S
(major)210 2496 A
(device)252 2748 A
3042(=)S
(\(dev>>MAJOR\))504 3126 A
3672(&)S
(0377)168 3756 A
3966(*/)S
3060 V
(02919)210 648 A
(#define)294 1026 A
(MINOR)210 1362 A
2160(0)S
2370(/*)S
(minor)210 2496 A
(device)252 2748 A
3042(=)S
(\(dev>>MINOR\))504 3126 A
3672(&)S
(0377)168 3756 A
3966(*/)S
3150 V
(02920)210 648 A
3240 V
(02921)210 648 A
(#define)294 1026 A
(NULL)168 1362 A
(\(\(void)252 1740 A
(*\)0\))168 2034 A
2370(/*)S
(null)168 2496 A
(pointer)294 2706 A
3042(*/)S
3330 V
(02922)210 648 A
(#define)294 1026 A
(CPVEC_NR)336 1362 A
2118(16)S
2370(/*)S
(max)126 2496 A
2664(#)S
2748(of)S
(entries)294 2874 A
3210(in)S
3336(a)S
(SYS_VCOPY)378 3420 A
(request)294 3840 A
4176(*/)S
3420 V
(02923)210 648 A
(#define)294 1026 A
(NR_IOREQS)378 1362 A
(MIN\(NR_BUFS,)504 2034 A
(64\))126 2580 A
3510 V
(02924)210 648 A
2370(/*)S
(maximum)294 2496 A
(number)252 2832 A
3126(of)S
(entries)294 3252 A
3588(in)S
3714(an)S
(iorequest)378 3840 A
4260(*/)S
3600 V
(02925)210 648 A
3690 V
(02926)210 648 A
(#define)294 1026 A
(NR_SEGS)294 1362 A
2160(3)S
2370(/*)S
2496(#)S
(segments)336 2580 A
(per)126 2958 A
(process)294 3126 A
3462(*/)S
3780 V
(02927)210 648 A
(#define)294 1026 A
1362(T)S
2160(0)S
2370(/*)S
(proc[i].mem_map[T])756 2496 A
3294(is)S
(for)126 3420 A
(text)168 3588 A
3798(*/)S
3870 V
(02928)210 648 A
(#define)294 1026 A
1362(D)S
2160(1)S
2370(/*)S
(proc[i].mem_map[D])756 2496 A
3294(is)S
(for)126 3420 A
(data)168 3588 A
3798(*/)S
3960 V
(02929)210 648 A
(#define)294 1026 A
1362(S)S
2160(2)S
2370(/*)S
(proc[i].mem_map[S])756 2496 A
3294(is)S
(for)126 3420 A
(stack)210 3588 A
3840(*/)S
4050 V
(02930)210 648 A
4140 V
(02931)210 648 A
1026(/*)S
(Process)294 1152 A
(numbers)294 1488 A
1824(of)S
(some)168 1950 A
(important)378 2160 A
(processes.)420 2580 A
3042(*/)S
4230 V
(02932)210 648 A
(#define)294 1026 A
(MM_PROC_NR)420 1362 A
2160(0)S
2370(/*)S
(process)294 2496 A
(number)252 2832 A
3126(of)S
(memory)252 3252 A
(manager)294 3546 A
3882(*/)S
4320 V
(02933)210 648 A
(#define)294 1026 A
(FS_PROC_NR)420 1362 A
2160(1)S
2370(/*)S
(process)294 2496 A
(number)252 2832 A
3126(of)S
(file)168 3252 A
(system)252 3462 A
3756(*/)S
4410 V
(02934)210 648 A
(#define)294 1026 A
(INET_PROC_NR)504 1362 A
2160(2)S
2370(/*)S
(process)294 2496 A
(number)252 2832 A
3126(of)S
(the)126 3252 A
(TCP/IP)252 3420 A
(server)252 3714 A
4008(*/)S
4500 V
(02935)210 648 A
(#define)294 1026 A
(INIT_PROC_NR)504 1362 A
(\(INET_PROC_NR)546 2034 A
2622(+)S
(ENABLE_NETWORKING\))756 2706 A
4590 V
(02936)210 648 A
2370(/*)S
(init)168 2496 A
2706(--)S
(the)126 2832 A
(process)294 3000 A
(that)168 3336 A
(goes)168 3546 A
(multiuser)378 3756 A
4176(*/)S
4680 V
(02937)210 648 A
(#define)294 1026 A
(LOW_USER)336 1362 A
(\(INET_PROC_NR)546 2034 A
2622(+)S
(ENABLE_NETWORKING\))756 2706 A
4770 V
(02938)210 648 A
2370(/*)S
(first)210 2496 A
(user)168 2748 A
(not)126 2958 A
(part)168 3126 A
3336(of)S
(operating)378 3462 A
(system)252 3882 A
4176(*/)S
4860 V
(02939)210 648 A
4950 V
(02940)210 648 A
1026(/*)S
(Miscellaneous)546 1152 A
1740(*/)S
5040 V
(02941)210 648 A
(#define)294 1026 A
(BYTE)168 1362 A
(0377)168 2034 A
2370(/*)S
(mask)168 2496 A
(for)126 2706 A
2874(8)S
(bits)168 2958 A
3168(*/)S
5130 V
(02942)210 648 A
(#define)294 1026 A
(READING)294 1362 A
2160(0)S
2370(/*)S
(copy)168 2496 A
(data)168 2706 A
2916(to)S
(user)168 3042 A
3252(*/)S
5220 V
(02943)210 648 A
(#define)294 1026 A
(WRITING)294 1362 A
2160(1)S
2370(/*)S
(copy)168 2496 A
(data)168 2706 A
(from)168 2916 A
(user)168 3126 A
3336(*/)S
5310 V
(02944)210 648 A
(#define)294 1026 A
(NO_NUM)252 1362 A
(0x8000)252 1950 A
2370(/*)S
(used)168 2496 A
2706(as)S
(numerical)378 2832 A
(argument)336 3252 A
3630(to)S
(panic\(\))294 3756 A
4092(*/)S
5400 V
(02945)210 648 A
(#define)294 1026 A
(NIL_PTR)294 1362 A
(\(char)210 1782 A
2034(*\))S
2160(0)S
2370(/*)S
(generally)378 2496 A
(useful)252 2916 A
(expression)420 3210 A
3672(*/)S
5490 V
(02946)210 648 A
(#define)294 1026 A
(HAVE_SCATTERED_IO)714 1362 A
2160(1)S
2370(/*)S
(scattered)378 2496 A
(I/O)126 2916 A
3084(is)S
(now)126 3210 A
(standard)336 3378 A
3756(*/)S
5580 V
(02947)210 648 A
5670 V
(02948)210 648 A
1026(/*)S
(Macros.)294 1152 A
1488(*/)S
5760 V
(02949)210 648 A
(#define)294 1026 A
(MAX\(a,)252 1362 A
1656(b\))S
(\(\(a\))168 1866 A
2076(>)S
(\(b\))126 2160 A
2328(?)S
(\(a\))126 2412 A
2580(:)S
(\(b\)\))168 2664 A
5850 V
(02950)210 648 A
(#define)294 1026 A
(MIN\(a,)252 1362 A
1656(b\))S
(\(\(a\))168 1866 A
2076(<)S
(\(b\))126 2160 A
2328(?)S
(\(a\))126 2412 A
2580(:)S
(\(b\)\))168 2664 A
5940 V
(02951)210 648 A
6030 V
(02952)210 648 A
1026(/*)S
(Number)252 1152 A
1446(of)S
(tasks.)252 1572 A
1866(*/)S
6120 V
(02953)210 648 A
(#define)294 1026 A
(NR_TASKS)336 1362 A
2034(\(9)S
2160(+)S
(ENABLE_WINI)462 2244 A
2748(+)S
(ENABLE_SCSI)462 2832 A
3336(+)S
(ENABLE_CDROM)504 3420 A
3966(\\)S
6210 V
(02954)210 648 A
2034(+)S
(ENABLE_NETWORKING)714 2118 A
2874(+)S
2958(2)S
3042(*)S
(ENABLE_AUDIO\))546 3126 A
8418 V
EP
%%Page: 35 35
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1939(File:)S
2172(include/minix/const.h)S
12 B
4308(35)S
900 V
7 LST
(02955)210 648 A
990 V
(02956)210 648 A
1026(/*)S
(Memory)252 1152 A
1446(is)S
(allocated)378 1572 A
1992(in)S
(clicks.)294 2118 A
2454(*/)S
1080 V
(02957)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
1170 V
(02958)210 648 A
(#define)294 1026 A
(CLICK_SIZE)420 1362 A
(256)126 2076 A
2370(/*)S
(unit)168 2496 A
2706(in)S
(which)210 2832 A
(memory)252 3084 A
3378(is)S
(allocated)378 3504 A
3924(*/)S
1260 V
(02959)210 648 A
(#define)294 1026 A
(CLICK_SHIFT)462 1362 A
2160(8)S
2370(/*)S
(log2)168 2496 A
2706(of)S
(CLICK_SIZE)420 2832 A
3294(*/)S
1350 V
(02960)210 648 A
(#endif)252 1026 A
1440 V
(02961)210 648 A
1530 V
(02962)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(SPARC\))252 1572 A
1866(||)S
(\(CHIP)210 1992 A
2244(==)S
(M68000\))294 2370 A
1620 V
(02963)210 648 A
(#define)294 1026 A
(CLICK_SIZE)420 1362 A
(4096)168 2034 A
2370(/*)S
(unit)168 2496 A
2706(in)S
(which)210 2832 A
(memory)252 3084 A
3378(is)S
(alocated)336 3504 A
3882(*/)S
1710 V
(02964)210 648 A
(#define)294 1026 A
(CLICK_SHIFT)462 1362 A
2118(12)S
2370(/*)S
(2log)168 2496 A
2706(of)S
(CLICK_SIZE)420 2832 A
3294(*/)S
1800 V
(02965)210 648 A
(#endif)252 1026 A
1890 V
(02966)210 648 A
1980 V
(02967)210 648 A
(#define)294 1026 A
(click_to_round_k\(n\))798 1362 A
2202(\\)S
2070 V
(02968)210 648 A
(\(\(unsigned\))462 1362 A
(\(\(\(\(unsigned)504 1866 A
(long\))210 2412 A
(\(n\))126 2664 A
2832(<<)S
(CLICK_SHIFT\))504 2958 A
3504(+)S
(512\))168 3588 A
3798(/)S
(1024\)\))252 3882 A
2160 V
(02969)210 648 A
(#if)126 1026 A
(CLICK_SIZE)420 1194 A
1656(<)S
(1024)168 1740 A
2250 V
(02970)210 648 A
(#define)294 1026 A
(k_to_click\(n\))546 1362 A
(\(\(n\))168 1950 A
2160(*)S
(\(1024)210 2244 A
2496(/)S
(CLICK_SIZE\)\))504 2580 A
2340 V
(02971)210 648 A
(#else)210 1026 A
2430 V
(02972)210 648 A
(#define)294 1026 A
(k_to_click\(n\))546 1362 A
(\(\(n\))168 1950 A
2160(/)S
(\(CLICK_SIZE)462 2244 A
2748(/)S
(1024\)\))252 2832 A
2520 V
(02973)210 648 A
(#endif)252 1026 A
2610 V
(02974)210 648 A
2700 V
(02975)210 648 A
(#define)294 1026 A
(ABS)126 1362 A
(-999)168 2034 A
2370(/*)S
(this)168 2496 A
(process)294 2706 A
(means)210 3042 A
(absolute)336 3294 A
(memory)252 3672 A
3966(*/)S
2790 V
(02976)210 648 A
2880 V
(02977)210 648 A
1026(/*)S
(Flag)168 1152 A
(bits)168 1362 A
(for)126 1572 A
(i_mode)252 1740 A
2034(in)S
(the)126 2160 A
(inode.)252 2328 A
2622(*/)S
2970 V
(02978)210 648 A
(#define)294 1026 A
(I_TYPE)252 1362 A
(0170000)294 2034 A
2370(/*)S
(this)168 2496 A
(field)210 2706 A
(gives)210 2958 A
(inode)210 3210 A
(type)168 3462 A
3672(*/)S
3060 V
(02979)210 648 A
(#define)294 1026 A
(I_REGULAR)378 1362 A
(0100000)294 2034 A
2370(/*)S
(regular)294 2496 A
(file,)210 2832 A
(not)126 3084 A
(dir)126 3252 A
3420(or)S
(special)294 3546 A
3882(*/)S
3150 V
(02980)210 648 A
(#define)294 1026 A
(I_BLOCK_SPECIAL)630 1362 A
(0060000)294 2034 A
2370(/*)S
(block)210 2496 A
(special)294 2748 A
(file)168 3084 A
3294(*/)S
3240 V
(02981)210 648 A
(#define)294 1026 A
(I_DIRECTORY)462 1362 A
(0040000)294 2034 A
2370(/*)S
(file)168 2496 A
2706(is)S
2832(a)S
(directory)378 2916 A
3336(*/)S
3330 V
(02982)210 648 A
(#define)294 1026 A
(I_CHAR_SPECIAL)588 1362 A
(0020000)294 2034 A
2370(/*)S
(character)378 2496 A
(special)294 2916 A
(file)168 3252 A
3462(*/)S
3420 V
(02983)210 648 A
(#define)294 1026 A
(I_NAMED_PIPE)504 1362 A
(0010000)294 2034 A
2370(/*)S
(named)210 2496 A
(pipe)168 2748 A
(\(FIFO\))252 2958 A
3252(*/)S
3510 V
(02984)210 648 A
(#define)294 1026 A
(I_SET_UID_BIT)546 1362 A
(0004000)294 2034 A
2370(/*)S
(set)126 2496 A
(effective)378 2664 A
(uid_t)210 3084 A
3336(on)S
(exec)168 3462 A
3672(*/)S
3600 V
(02985)210 648 A
(#define)294 1026 A
(I_SET_GID_BIT)546 1362 A
(0002000)294 2034 A
2370(/*)S
(set)126 2496 A
(effective)378 2664 A
(gid_t)210 3084 A
3336(on)S
(exec)168 3462 A
3672(*/)S
3690 V
(02986)210 648 A
(#define)294 1026 A
(ALL_MODES)378 1362 A
(0006777)294 2034 A
2370(/*)S
(all)126 2496 A
(bits)168 2664 A
(for)126 2874 A
(user,)210 3042 A
(group)210 3294 A
(and)126 3546 A
(others)252 3714 A
4008(*/)S
3780 V
(02987)210 648 A
(#define)294 1026 A
(RWX_MODES)378 1362 A
(0000777)294 2034 A
2370(/*)S
(mode)168 2496 A
(bits)168 2706 A
(for)126 2916 A
(RWX)126 3084 A
(only)168 3252 A
3462(*/)S
3870 V
(02988)210 648 A
(#define)294 1026 A
(R_BIT)210 1362 A
(0000004)294 2034 A
2370(/*)S
(Rwx)126 2496 A
(protection)420 2664 A
(bit)126 3126 A
3294(*/)S
3960 V
(02989)210 648 A
(#define)294 1026 A
(W_BIT)210 1362 A
(0000002)294 2034 A
2370(/*)S
(rWx)126 2496 A
(protection)420 2664 A
(bit)126 3126 A
3294(*/)S
4050 V
(02990)210 648 A
(#define)294 1026 A
(X_BIT)210 1362 A
(0000001)294 2034 A
2370(/*)S
(rwX)126 2496 A
(protection)420 2664 A
(bit)126 3126 A
3294(*/)S
4140 V
(02991)210 648 A
(#define)294 1026 A
(I_NOT_ALLOC)462 1362 A
(0000000)294 2034 A
2370(/*)S
(this)168 2496 A
(inode)210 2706 A
2958(is)S
(free)168 3084 A
3294(*/)S
4230 V
(02992)210 648 A
4320 V
(02993)210 648 A
1026(/*)S
(Some)168 1152 A
(limits.)294 1362 A
1698(*/)S
4410 V
(02994)210 648 A
(#define)294 1026 A
(MAX_BLOCK_NR)504 1362 A
(\(\(block_t\))420 1950 A
(077777777\))420 2412 A
3042(/*)S
(largest)294 3168 A
(block)210 3504 A
(number)252 3756 A
4050(*/)S
4500 V
(02995)210 648 A
(#define)294 1026 A
(HIGHEST_ZONE)504 1362 A
(\(\(zone_t\))378 1992 A
(077777777\))420 2412 A
3042(/*)S
(largest)294 3168 A
(zone)168 3504 A
(number)252 3714 A
4008(*/)S
4590 V
(02996)210 648 A
(#define)294 1026 A
(MAX_INODE_NR)504 1362 A
(\(\(ino_t\))336 2118 A
(0177777\))336 2496 A
3042(/*)S
(largest)294 3168 A
(inode)210 3504 A
(number)252 3756 A
4050(*/)S
4680 V
(02997)210 648 A
(#define)294 1026 A
(MAX_FILE_POS)504 1362 A
(\(\(off_t\))336 1908 A
(037777777777\))546 2286 A
3042(/*)S
(largest)294 3168 A
(legal)210 3504 A
(file)168 3756 A
(offset)252 3966 A
4260(*/)S
4770 V
(02998)210 648 A
4860 V
(02999)210 648 A
(#define)294 1026 A
(NO_BLOCK)336 1362 A
(\(\(block_t\))420 2286 A
2748(0\))S
3042(/*)S
(absence)294 3168 A
3504(of)S
3630(a)S
(block)210 3714 A
(number)252 3966 A
4260(*/)S
4950 V
(03000)210 648 A
(#define)294 1026 A
(NO_ENTRY)336 1362 A
(\(\(ino_t\))336 2370 A
2748(0\))S
3042(/*)S
(absence)294 3168 A
3504(of)S
3630(a)S
(dir)126 3714 A
(entry)210 3882 A
4134(*/)S
5040 V
(03001)210 648 A
(#define)294 1026 A
(NO_ZONE)294 1362 A
(\(\(zone_t\))378 2328 A
2748(0\))S
3042(/*)S
(absence)294 3168 A
3504(of)S
3630(a)S
(zone)168 3714 A
(number)252 3924 A
4218(*/)S
5130 V
(03002)210 648 A
(#define)294 1026 A
(NO_DEV)252 1362 A
(\(\(dev_t\))336 2370 A
2748(0\))S
3042(/*)S
(absence)294 3168 A
3504(of)S
3630(a)S
(device)252 3714 A
(numb)168 4008 A
4218(*/)S
8418 V
EP
%%Page: 36 36
BP
/slant 0 def
/height 0 def
630 V
12 B
648(36)S
11 R
1961(File:)S
2194(include/minix/type.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(include/minix/type.h)840 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(03100)210 648 A
(#ifndef)294 1026 A
(_TYPE_H)294 1362 A
1440 V
(03101)210 648 A
(#define)294 1026 A
(_TYPE_H)294 1362 A
1530 V
(03102)210 648 A
(#ifndef)294 1026 A
(_MINIX_TYPE_H)546 1362 A
1620 V
(03103)210 648 A
(#define)294 1026 A
(_MINIX_TYPE_H)546 1362 A
1710 V
(03104)210 648 A
1800 V
(03105)210 648 A
1026(/*)S
(Type)168 1152 A
(definitions.)504 1362 A
1908(*/)S
1890 V
(03106)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(vir_clicks;)462 1908 A
2412(/*)S
(virtual)294 2538 A
(addresses)378 2916 A
(and)126 3336 A
(lengths)294 3504 A
3840(in)S
(clicks)252 3966 A
4260(*/)S
1980 V
(03107)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(long)168 1740 A
(phys_bytes;/*)546 1950 A
(physical)336 2538 A
(addresses)378 2916 A
(and)126 3336 A
(lengths)294 3504 A
3840(in)S
(bytes)210 3966 A
4218(*/)S
2070 V
(03108)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(phys_clicks;/*)588 1908 A
(physical)336 2538 A
(addresses)378 2916 A
(and)126 3336 A
(lengths)294 3504 A
3840(in)S
(clicks)252 3966 A
4260(*/)S
2160 V
(03109)210 648 A
2250 V
(03110)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
2340 V
(03111)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(int)126 1740 A
(vir_bytes;)420 1908 A
2370(/*)S
(virtual)294 2496 A
(addresses)378 2832 A
(and)126 3252 A
(lengths)294 3420 A
3756(in)S
(bytes)210 3882 A
4134(*/)S
2430 V
(03112)210 648 A
(#endif)252 1026 A
2520 V
(03113)210 648 A
2610 V
(03114)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(M68000\))294 1572 A
2700 V
(03115)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(long)168 1740 A
(vir_bytes;/*)504 1950 A
(virtual)294 2496 A
(addresses)378 2832 A
(and)126 3252 A
(lengths)294 3420 A
3756(in)S
(bytes)210 3882 A
4134(*/)S
2790 V
(03116)210 648 A
(#endif)252 1026 A
2880 V
(03117)210 648 A
2970 V
(03118)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(SPARC\))252 1572 A
3060 V
(03119)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(long)168 1740 A
(vir_bytes;/*)504 1950 A
(virtual)294 2496 A
(addresses)378 2832 A
(and)126 3252 A
(lengths)294 3420 A
3756(in)S
(bytes)210 3882 A
4134(*/)S
3150 V
(03120)210 648 A
(#endif)252 1026 A
3240 V
(03121)210 648 A
3330 V
(03122)210 648 A
1026(/*)S
(Types)210 1152 A
(relating)336 1404 A
1782(to)S
(messages.)378 1908 A
2328(*/)S
3420 V
(03123)210 648 A
(#define)294 1026 A
1362(M1)S
2160(1)S
3510 V
(03124)210 648 A
(#define)294 1026 A
1362(M3)S
2160(3)S
3600 V
(03125)210 648 A
(#define)294 1026 A
1362(M4)S
2160(4)S
3690 V
(03126)210 648 A
(#define)294 1026 A
(M3_STRING)378 1362 A
2118(14)S
3780 V
(03127)210 648 A
3870 V
(03128)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
({int)168 1656 A
(m1i1,)210 1866 A
(m1i2,)210 2118 A
(m1i3;)210 2370 A
(char)168 2622 A
(*m1p1,)252 2832 A
(*m1p2,)252 3126 A
(*m1p3;})294 3420 A
(mess_1;)294 3756 A
3960 V
(03129)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
({int)168 1656 A
(m2i1,)210 1866 A
(m2i2,)210 2118 A
(m2i3;)210 2370 A
(long)168 2622 A
(m2l1,)210 2832 A
(m2l2;)210 3084 A
(char)168 3336 A
(*m2p1;})294 3546 A
(mess_2;)294 3882 A
4050 V
(03130)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
({int)168 1656 A
(m3i1,)210 1866 A
(m3i2;)210 2118 A
(char)168 2370 A
(*m3p1;)252 2580 A
(char)168 2874 A
(m3ca1[M3_STRING];})756 3084 A
(mess_3;)294 3882 A
4140 V
(03131)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
({long)210 1656 A
(m4l1,)210 1908 A
(m4l2,)210 2160 A
(m4l3,)210 2412 A
(m4l4,)210 2664 A
(m4l5;})252 2916 A
(mess_4;)294 3210 A
4230 V
(03132)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
({char)210 1656 A
(m5c1,)210 1908 A
(m5c2;)210 2160 A
(int)126 2412 A
(m5i1,)210 2580 A
(m5i2;)210 2832 A
(long)168 3084 A
(m5l1,)210 3294 A
(m5l2,)210 3546 A
(m5l3;}mess_5;)546 3798 A
4320 V
(03133)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
({int)168 1656 A
(m6i1,)210 1866 A
(m6i2,)210 2118 A
(m6i3;)210 2370 A
(long)168 2622 A
(m6l1;)210 2832 A
(sighandler_t)504 3084 A
(m6f1;})252 3630 A
(mess_6;)294 3924 A
4410 V
(03134)210 648 A
4500 V
(03135)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
1656({)S
4590 V
(03136)210 648 A
(int)126 1110 A
(m_source;)378 1278 A
2370(/*)S
(who)126 2496 A
(sent)168 2664 A
(the)126 2874 A
(message)294 3042 A
3378(*/)S
4680 V
(03137)210 648 A
(int)126 1110 A
(m_type;)294 1278 A
2370(/*)S
(what)168 2496 A
(kind)168 2706 A
2916(of)S
(message)294 3042 A
3378(is)S
3504(it)S
3630(*/)S
4770 V
(03138)210 648 A
(union)210 1110 A
1362({)S
4860 V
(03139)210 648 A
(mess_1)252 1362 A
(m_m1;)210 1656 A
4950 V
(03140)210 648 A
(mess_2)252 1362 A
(m_m2;)210 1656 A
5040 V
(03141)210 648 A
(mess_3)252 1362 A
(m_m3;)210 1656 A
5130 V
(03142)210 648 A
(mess_4)252 1362 A
(m_m4;)210 1656 A
5220 V
(03143)210 648 A
(mess_5)252 1362 A
(m_m5;)210 1656 A
5310 V
(03144)210 648 A
(mess_6)252 1362 A
(m_m6;)210 1656 A
5400 V
(03145)210 648 A
1110(})S
(m_u;)168 1194 A
5490 V
(03146)210 648 A
1026(})S
(message;)336 1110 A
5580 V
(03147)210 648 A
5670 V
(03148)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(defines)294 1740 A
(provide)294 2076 A
(names)210 2412 A
(for)126 2664 A
(useful)252 2832 A
(members.)336 3126 A
3504(*/)S
5760 V
(03149)210 648 A
(#define)294 1026 A
(m1_i1)210 1362 A
(m_u.m_m1.m1i1)546 1656 A
5850 V
(03150)210 648 A
(#define)294 1026 A
(m1_i2)210 1362 A
(m_u.m_m1.m1i2)546 1656 A
5940 V
(03151)210 648 A
(#define)294 1026 A
(m1_i3)210 1362 A
(m_u.m_m1.m1i3)546 1656 A
6030 V
(03152)210 648 A
(#define)294 1026 A
(m1_p1)210 1362 A
(m_u.m_m1.m1p1)546 1656 A
6120 V
(03153)210 648 A
(#define)294 1026 A
(m1_p2)210 1362 A
(m_u.m_m1.m1p2)546 1656 A
6210 V
(03154)210 648 A
(#define)294 1026 A
(m1_p3)210 1362 A
(m_u.m_m1.m1p3)546 1656 A
8418 V
EP
%%Page: 37 37
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1961(File:)S
2194(include/minix/type.h)S
12 B
4308(37)S
900 V
7 LST
(03155)210 648 A
990 V
(03156)210 648 A
(#define)294 1026 A
(m2_i1)210 1362 A
(m_u.m_m2.m2i1)546 1656 A
1080 V
(03157)210 648 A
(#define)294 1026 A
(m2_i2)210 1362 A
(m_u.m_m2.m2i2)546 1656 A
1170 V
(03158)210 648 A
(#define)294 1026 A
(m2_i3)210 1362 A
(m_u.m_m2.m2i3)546 1656 A
1260 V
(03159)210 648 A
(#define)294 1026 A
(m2_l1)210 1362 A
(m_u.m_m2.m2l1)546 1656 A
1350 V
(03160)210 648 A
(#define)294 1026 A
(m2_l2)210 1362 A
(m_u.m_m2.m2l2)546 1656 A
1440 V
(03161)210 648 A
(#define)294 1026 A
(m2_p1)210 1362 A
(m_u.m_m2.m2p1)546 1656 A
1530 V
(03162)210 648 A
1620 V
(03163)210 648 A
(#define)294 1026 A
(m3_i1)210 1362 A
(m_u.m_m3.m3i1)546 1656 A
1710 V
(03164)210 648 A
(#define)294 1026 A
(m3_i2)210 1362 A
(m_u.m_m3.m3i2)546 1656 A
1800 V
(03165)210 648 A
(#define)294 1026 A
(m3_p1)210 1362 A
(m_u.m_m3.m3p1)546 1656 A
1890 V
(03166)210 648 A
(#define)294 1026 A
(m3_ca1)252 1362 A
(m_u.m_m3.m3ca1)588 1656 A
1980 V
(03167)210 648 A
2070 V
(03168)210 648 A
(#define)294 1026 A
(m4_l1)210 1362 A
(m_u.m_m4.m4l1)546 1656 A
2160 V
(03169)210 648 A
(#define)294 1026 A
(m4_l2)210 1362 A
(m_u.m_m4.m4l2)546 1656 A
2250 V
(03170)210 648 A
(#define)294 1026 A
(m4_l3)210 1362 A
(m_u.m_m4.m4l3)546 1656 A
2340 V
(03171)210 648 A
(#define)294 1026 A
(m4_l4)210 1362 A
(m_u.m_m4.m4l4)546 1656 A
2430 V
(03172)210 648 A
(#define)294 1026 A
(m4_l5)210 1362 A
(m_u.m_m4.m4l5)546 1656 A
2520 V
(03173)210 648 A
2610 V
(03174)210 648 A
(#define)294 1026 A
(m5_c1)210 1362 A
(m_u.m_m5.m5c1)546 1656 A
2700 V
(03175)210 648 A
(#define)294 1026 A
(m5_c2)210 1362 A
(m_u.m_m5.m5c2)546 1656 A
2790 V
(03176)210 648 A
(#define)294 1026 A
(m5_i1)210 1362 A
(m_u.m_m5.m5i1)546 1656 A
2880 V
(03177)210 648 A
(#define)294 1026 A
(m5_i2)210 1362 A
(m_u.m_m5.m5i2)546 1656 A
2970 V
(03178)210 648 A
(#define)294 1026 A
(m5_l1)210 1362 A
(m_u.m_m5.m5l1)546 1656 A
3060 V
(03179)210 648 A
(#define)294 1026 A
(m5_l2)210 1362 A
(m_u.m_m5.m5l2)546 1656 A
3150 V
(03180)210 648 A
(#define)294 1026 A
(m5_l3)210 1362 A
(m_u.m_m5.m5l3)546 1656 A
3240 V
(03181)210 648 A
3330 V
(03182)210 648 A
(#define)294 1026 A
(m6_i1)210 1362 A
(m_u.m_m6.m6i1)546 1656 A
3420 V
(03183)210 648 A
(#define)294 1026 A
(m6_i2)210 1362 A
(m_u.m_m6.m6i2)546 1656 A
3510 V
(03184)210 648 A
(#define)294 1026 A
(m6_i3)210 1362 A
(m_u.m_m6.m6i3)546 1656 A
3600 V
(03185)210 648 A
(#define)294 1026 A
(m6_l1)210 1362 A
(m_u.m_m6.m6l1)546 1656 A
3690 V
(03186)210 648 A
(#define)294 1026 A
(m6_f1)210 1362 A
(m_u.m_m6.m6f1)546 1656 A
3780 V
(03187)210 648 A
3870 V
(03188)210 648 A
(struct)252 1026 A
(mem_map)294 1320 A
1656({)S
3960 V
(03189)210 648 A
(vir_clicks)420 1110 A
(mem_vir;)336 1572 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
3168(*/)S
4050 V
(03190)210 648 A
(phys_clicks)462 1110 A
(mem_phys;)378 1614 A
2370(/*)S
(physical)336 2496 A
(address)294 2874 A
3210(*/)S
4140 V
(03191)210 648 A
(vir_clicks)420 1110 A
(mem_len;)336 1572 A
2370(/*)S
(length)252 2496 A
2790(*/)S
4230 V
(03192)210 648 A
1026(};)S
4320 V
(03193)210 648 A
4410 V
(03194)210 648 A
(struct)252 1026 A
(iorequest_s)462 1320 A
1824({)S
4500 V
(03195)210 648 A
(long)168 1110 A
(io_position;)504 1320 A
2370(/*)S
(position)336 2496 A
2874(in)S
(device)252 3000 A
(file)168 3294 A
(\(really)294 3504 A
(off_t\))252 3840 A
4134(*/)S
4590 V
(03196)210 648 A
(char)168 1110 A
(*io_buf;)336 1320 A
2370(/*)S
(buffer)252 2496 A
2790(in)S
(user)168 2916 A
(space)210 3126 A
3378(*/)S
4680 V
(03197)210 648 A
(int)126 1110 A
(io_nbytes;)420 1278 A
2370(/*)S
(size)168 2496 A
2706(of)S
(request)294 2832 A
3168(*/)S
4770 V
(03198)210 648 A
(unsigned)336 1110 A
(short)210 1488 A
(io_request;)462 1740 A
2370(/*)S
(read,)210 2496 A
(write)210 2748 A
(\(optionally\))504 3000 A
3546(*/)S
4860 V
(03199)210 648 A
1026(};)S
4950 V
(03200)210 648 A
(#endif)252 1026 A
1320(/*)S
(_TYPE_H)294 1446 A
1782(*/)S
5040 V
(03201)210 648 A
5130 V
(03202)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
1656({)S
5220 V
(03203)210 648 A
(vir_bytes)378 1110 A
(iov_addr;)378 1530 A
2370(/*)S
(address)294 2496 A
2832(of)S
2958(an)S
(I/O)126 3084 A
(buffer)252 3252 A
3546(*/)S
5310 V
(03204)210 648 A
(vir_bytes)378 1110 A
(iov_size;)378 1530 A
2370(/*)S
(sizeof)252 2496 A
2790(an)S
(I/O)126 2916 A
(buffer)252 3084 A
3378(*/)S
5400 V
(03205)210 648 A
1026(})S
(iovec_t;)336 1110 A
5490 V
(03206)210 648 A
5580 V
(03207)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
1656({)S
5670 V
(03208)210 648 A
(vir_bytes)378 1110 A
(cpv_src;)336 1530 A
2370(/*)S
(src)126 2496 A
(address)294 2664 A
3000(of)S
(data)168 3126 A
3336(*/)S
5760 V
(03209)210 648 A
(vir_bytes)378 1110 A
(cpv_dst;)336 1530 A
2370(/*)S
(dst)126 2496 A
(address)294 2664 A
3000(of)S
(data)168 3126 A
3336(*/)S
5850 V
(03210)210 648 A
(vir_bytes)378 1110 A
(cpv_size;)378 1530 A
2370(/*)S
(size)168 2496 A
2706(of)S
(data)168 2832 A
3042(*/)S
5940 V
(03211)210 648 A
1026(})S
(cpvec_t;)336 1110 A
6030 V
(03212)210 648 A
6120 V
(03213)210 648 A
1026(/*)S
1152(MM)S
(passes)252 1278 A
(the)126 1572 A
(address)294 1740 A
2076(of)S
2202(a)S
(structure)378 2286 A
2706(of)S
(this)168 2832 A
(type)168 3042 A
3252(to)S
(KERNEL)252 3378 A
(when)168 3672 A
6210 V
(03214)210 648 A
1068(*)S
(do_sendsig\(\))504 1152 A
1698(is)S
(invoked)294 1824 A
2160(as)S
(part)168 2286 A
2496(of)S
(the)126 2622 A
(signal)252 2790 A
(catching)336 3084 A
(mechanism.)420 3462 A
8418 V
EP
%%Page: 38 38
BP
/slant 0 def
/height 0 def
630 V
12 B
648(38)S
11 R
1961(File:)S
2194(include/minix/type.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(03215)210 648 A
1068(*)S
(The)126 1152 A
(structure)378 1320 A
(contain)294 1740 A
(all)126 2076 A
(the)126 2244 A
(information)462 2412 A
(that)168 2916 A
(KERNEL)252 3126 A
(needs)210 3420 A
3672(to)S
(build)210 3798 A
990 V
(03216)210 648 A
1068(*)S
(the)126 1152 A
(signal)252 1320 A
(stack.)252 1614 A
1080 V
(03217)210 648 A
1068(*/)S
1170 V
(03218)210 648 A
(struct)252 1026 A
(sigmsg)252 1320 A
1614({)S
1260 V
(03219)210 648 A
(int)126 1110 A
(sm_signo;)378 1278 A
2370(/*)S
(signal)252 2496 A
(number)252 2790 A
(being)210 3084 A
(caught)252 3336 A
3630(*/)S
1350 V
(03220)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(sm_mask;)336 1698 A
2370(/*)S
(mask)168 2496 A
2706(to)S
(restore)294 2832 A
(when)168 3168 A
(handler)294 3378 A
(returns)294 3714 A
4050(*/)S
1440 V
(03221)210 648 A
(vir_bytes)378 1110 A
(sm_sighandler;)588 1530 A
2370(/*)S
(address)294 2496 A
2832(of)S
(handler)294 2958 A
3294(*/)S
1530 V
(03222)210 648 A
(vir_bytes)378 1110 A
(sm_sigreturn;)546 1530 A
2370(/*)S
(address)294 2496 A
2832(of)S
(_sigreturn)420 2958 A
3420(in)S
3546(C)S
(library)294 3630 A
3966(*/)S
1620 V
(03223)210 648 A
(vir_bytes)378 1110 A
(sm_stkptr;)420 1530 A
2370(/*)S
(user)168 2496 A
(stack)210 2706 A
(pointer)294 2958 A
3294(*/)S
1710 V
(03224)210 648 A
1026(};)S
1800 V
(03225)210 648 A
1890 V
(03226)210 648 A
(#define)294 1026 A
(MESS_SIZE)378 1362 A
(\(sizeof\(message\)\))714 1782 A
2706(/*)S
(might)210 2832 A
(need)168 3084 A
(usizeof)294 3294 A
(from)168 3630 A
3840(fs)S
(here)168 3966 A
4176(*/)S
1980 V
(03227)210 648 A
(#define)294 1026 A
(NIL_MESS)336 1362 A
(\(\(message)378 1740 A
2160(*\))S
2286(0\))S
2070 V
(03228)210 648 A
2160 V
(03229)210 648 A
(struct)252 1026 A
(psinfo)252 1320 A
1614({)S
2034(/*)S
(information)462 2160 A
(for)126 2664 A
(the)126 2832 A
(ps\(1\))210 3000 A
(program)294 3252 A
3588(*/)S
2250 V
(03230)210 648 A
(u16_t)210 1110 A
(nr_tasks,)378 1362 A
(nr_procs;)378 1782 A
2370(/*)S
(NR_TASKS)336 2496 A
(and)126 2874 A
(NR_PROCS)336 3042 A
(constants.)420 3420 A
3882(*/)S
2340 V
(03231)210 648 A
(vir_bytes)378 1110 A
(proc,)210 1530 A
(mproc,)252 1782 A
(fproc;)252 2076 A
2370(/*)S
(addresses)378 2496 A
2916(of)S
(the)126 3042 A
(main)168 3210 A
(process)294 3420 A
(tables.)294 3756 A
4092(*/)S
2430 V
(03232)210 648 A
1026(};)S
2520 V
(03233)210 648 A
2610 V
(03234)210 648 A
(#endif)252 1026 A
1320(/*)S
(_MINIX_TYPE_H)546 1446 A
2034(*/)S
3240 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3330 V
(include/minix/syslib.h)924 2034 A
3420 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3600 V
(03300)210 648 A
1026(/*)S
(Prototypes)420 1152 A
(for)126 1614 A
(system)252 1782 A
(library)294 2076 A
(functions.)420 2412 A
2874(*/)S
3690 V
(03301)210 648 A
3780 V
(03302)210 648 A
(#ifndef)294 1026 A
(_SYSLIB_H)378 1362 A
3870 V
(03303)210 648 A
(#define)294 1026 A
(_SYSLIB_H)378 1362 A
3960 V
(03304)210 648 A
4050 V
(03305)210 648 A
1026(/*)S
(Hide)168 1152 A
(names)210 1362 A
1614(to)S
(avoid)210 1740 A
(name)168 1992 A
(space)210 2202 A
(pollution.)420 2454 A
2916(*/)S
4140 V
(03306)210 648 A
(#define)294 1026 A
(sendrec)294 1362 A
(_sendrec)336 2034 A
4230 V
(03307)210 648 A
(#define)294 1026 A
(receive)294 1362 A
(_receive)336 2034 A
4320 V
(03308)210 648 A
(#define)294 1026 A
(send)168 1362 A
(_send)210 2034 A
4410 V
(03309)210 648 A
4500 V
(03310)210 648 A
1026(/*)S
(Minix)210 1152 A
(user+system)462 1404 A
(library.)336 1908 A
2286(*/)S
4590 V
(03311)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(printk,)294 1740 A
(\(char)210 2076 A
(*_fmt,)252 2328 A
(...\))168 2622 A
4050(\);)S
4680 V
(03312)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sendrec,)336 1698 A
(\(int)168 2076 A
(_src_dest,)420 2286 A
(message)294 2748 A
(*_m_ptr\))336 3084 A
4050(\);)S
4770 V
(03313)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(_taskcall,)420 1698 A
(\(int)168 2160 A
(_who,)210 2370 A
(int)126 2622 A
(_syscallnr,)462 2790 A
(message)294 3294 A
(*_msgptr\))378 3630 A
4050(\);)S
4860 V
(03314)210 648 A
4950 V
(03315)210 648 A
1026(/*)S
(Minix)210 1152 A
(system)252 1404 A
(library.)336 1698 A
2076(*/)S
5040 V
(03316)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(receive,)336 1698 A
(\(int)168 2076 A
(_src,)210 2286 A
(message)294 2538 A
(*_m_ptr\))336 2874 A
4050(\);)S
5130 V
(03317)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(send,)210 1698 A
(\(int)168 1950 A
(_dest,)252 2160 A
(message)294 2454 A
(*_m_ptr\))336 2790 A
4050(\);)S
5220 V
(03318)210 648 A
5310 V
(03319)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_abort,)420 1698 A
(\(int)168 2160 A
(_how,)210 2370 A
(...\))168 2622 A
4050(\);)S
5400 V
(03320)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_adjmap,)462 1698 A
(\(int)168 2202 A
(_proc,)252 2412 A
(struct)252 2706 A
(mem_map)294 3000 A
(*_ptr,)252 3336 A
5490 V
(03321)210 648 A
(vir_clicks)420 1698 A
(_data_clicks,)546 2160 A
(vir_clicks)420 2748 A
(_sp\))168 3210 A
4050(\);)S
5580 V
(03322)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_copy,)378 1698 A
(\(int)168 2118 A
(_src_proc,)420 2328 A
(int)126 2790 A
(_src_seg,)378 2958 A
(phys_bytes)420 3378 A
(_src_vir,)378 3840 A
5670 V
(03323)210 648 A
(int)126 1362 A
(_dst_proc,)420 1530 A
(int)126 1992 A
(_dst_seg,)378 2160 A
(phys_bytes)420 2580 A
(_dst_vir,)378 3042 A
(phys_bytes)420 3462 A
(_bytes\)\);)378 3924 A
5760 V
(03324)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_exec,)378 1698 A
(\(int)168 2118 A
(_proc,)252 2328 A
(char)168 2622 A
(*_ptr,)252 2832 A
(int)126 3126 A
(_traced,)336 3294 A
5850 V
(03325)210 648 A
(char)168 2370 A
(*_aout,)294 2580 A
(vir_bytes)378 2916 A
(_initpc\))336 3336 A
4050(\);)S
5940 V
(03326)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_execmap,)504 1698 A
(\(int)168 2244 A
(_proc,)252 2454 A
(struct)252 2748 A
(mem_map)294 3042 A
(*_ptr\))252 3378 A
4050(\);)S
6030 V
(03327)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_fork,)378 1698 A
(\(int)168 2118 A
(_parent,)336 2328 A
(int)126 2706 A
(_child,)294 2874 A
(int)126 3210 A
(_pid,)210 3378 A
6120 V
(03328)210 648 A
(phys_clicks)462 2706 A
(_shadow\))336 3210 A
4050(\);)S
6210 V
(03329)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_fresh,)420 1698 A
(\(int)168 2160 A
(_proc,)252 2370 A
(struct)252 2664 A
(mem_map)294 2958 A
(*_ptr,)252 3294 A
8418 V
EP
%%Page: 39 39
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1927(File:)S
2160(include/minix/syslib.h)S
12 B
4308(39)S
900 V
7 LST
(03330)210 648 A
(phys_clicks)462 1362 A
(_dc,)168 1866 A
(phys_clicks)462 2076 A
(*_basep,)336 2580 A
(phys_clicks)462 2958 A
(*_sizep\))336 3462 A
4050(\);)S
990 V
(03331)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_getsp,)420 1698 A
(\(int)168 2160 A
(_proc,)252 2370 A
(vir_bytes)378 2664 A
(*_newsp\))336 3084 A
4050(\);)S
1080 V
(03332)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_newmap,)462 1698 A
(\(int)168 2202 A
(_proc,)252 2412 A
(struct)252 2706 A
(mem_map)294 3000 A
(*_ptr\))252 3336 A
4050(\);)S
1170 V
(03333)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_getmap,)462 1698 A
(\(int)168 2202 A
(_proc,)252 2412 A
(struct)252 2706 A
(mem_map)294 3000 A
(*_ptr\))252 3336 A
4050(\);)S
1260 V
(03334)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_sendsig,)504 1698 A
(\(int)168 2244 A
(_proc,)252 2454 A
(struct)252 2748 A
(sigmsg)252 3042 A
(*_ptr\))252 3336 A
4050(\);)S
1350 V
(03335)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_oldsig,)462 1698 A
(\(int)168 2202 A
(_proc,)252 2412 A
(int)126 2706 A
(_sig,)210 2874 A
(sighandler_t)504 3126 A
(_sighandler\)\);)588 3672 A
1440 V
(03336)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_endsig,)462 1698 A
(\(int)168 2202 A
(_proc\))252 2412 A
4050(\);)S
1530 V
(03337)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_sigreturn,)588 1698 A
(\(int)168 2328 A
(_proc,)252 2538 A
(vir_bytes)378 2832 A
(_scp,)210 3252 A
(int)126 3504 A
(_flags\))294 3672 A
4050(\);)S
1620 V
(03338)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_trace,)420 1698 A
(\(int)168 2160 A
(_req,)210 2370 A
(int)126 2622 A
(_procnr,)336 2790 A
(long)168 3168 A
(_addr,)252 3378 A
(long)168 3672 A
(*_data_p\)\);)462 3882 A
1710 V
(03339)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_xit,)336 1698 A
(\(int)168 2076 A
(_parent,)336 2286 A
(int)126 2664 A
(_proc,)252 2832 A
(phys_clicks)462 3126 A
(*_basep,)336 3630 A
1800 V
(03340)210 648 A
(phys_clicks)462 3084 A
(*_sizep\)\);)420 3588 A
1890 V
(03341)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_kill,)378 1698 A
(\(int)168 2118 A
(_proc,)252 2328 A
(int)126 2622 A
(_sig\))210 2790 A
4050(\);)S
1980 V
(03342)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_times,)420 1698 A
(\(int)168 2160 A
(_proc,)252 2370 A
(clock_t)294 2664 A
(_ptr[5]\))336 3000 A
4050(\);)S
2070 V
(03343)210 648 A
2160 V
(03344)210 648 A
(#endif)252 1026 A
1320(/*)S
(_SYSLIB_H)378 1446 A
1866(*/)S
2790 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2880 V
(include/minix/callnr.h)924 2034 A
2970 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3150 V
(03400)210 648 A
(#define)294 1026 A
(NCALLS)252 1362 A
2118(77)S
2370(/*)S
(number)252 2496 A
2790(of)S
(system)252 2916 A
(calls)210 3210 A
(allowed)294 3462 A
3798(*/)S
3240 V
(03401)210 648 A
3330 V
(03402)210 648 A
(#define)294 1026 A
(EXIT)168 1362 A
2160(1)S
3420 V
(03403)210 648 A
(#define)294 1026 A
(FORK)168 1362 A
2160(2)S
3510 V
(03404)210 648 A
(#define)294 1026 A
(READ)168 1362 A
2160(3)S
3600 V
(03405)210 648 A
(#define)294 1026 A
(WRITE)210 1362 A
2160(4)S
3690 V
(03406)210 648 A
(#define)294 1026 A
(OPEN)168 1362 A
2160(5)S
3780 V
(03407)210 648 A
(#define)294 1026 A
(CLOSE)210 1362 A
2160(6)S
3870 V
(03408)210 648 A
(#define)294 1026 A
(WAIT)168 1362 A
2160(7)S
3960 V
(03409)210 648 A
(#define)294 1026 A
(CREAT)210 1362 A
2160(8)S
4050 V
(03410)210 648 A
(#define)294 1026 A
(LINK)168 1362 A
2160(9)S
4140 V
(03411)210 648 A
(#define)294 1026 A
(UNLINK)252 1362 A
2118(10)S
4230 V
(03412)210 648 A
(#define)294 1026 A
(WAITPID)294 1362 A
2118(11)S
4320 V
(03413)210 648 A
(#define)294 1026 A
(CHDIR)210 1362 A
2118(12)S
4410 V
(03414)210 648 A
(#define)294 1026 A
(TIME)168 1362 A
2118(13)S
4500 V
(03415)210 648 A
(#define)294 1026 A
(MKNOD)210 1362 A
2118(14)S
4590 V
(03416)210 648 A
(#define)294 1026 A
(CHMOD)210 1362 A
2118(15)S
4680 V
(03417)210 648 A
(#define)294 1026 A
(CHOWN)210 1362 A
2118(16)S
4770 V
(03418)210 648 A
(#define)294 1026 A
(BRK)126 1362 A
2118(17)S
4860 V
(03419)210 648 A
(#define)294 1026 A
(STAT)168 1362 A
2118(18)S
4950 V
(03420)210 648 A
(#define)294 1026 A
(LSEEK)210 1362 A
2118(19)S
5040 V
(03421)210 648 A
(#define)294 1026 A
(GETPID)252 1362 A
2118(20)S
5130 V
(03422)210 648 A
(#define)294 1026 A
(MOUNT)210 1362 A
2118(21)S
5220 V
(03423)210 648 A
(#define)294 1026 A
(UMOUNT)252 1362 A
2118(22)S
5310 V
(03424)210 648 A
(#define)294 1026 A
(SETUID)252 1362 A
2118(23)S
5400 V
(03425)210 648 A
(#define)294 1026 A
(GETUID)252 1362 A
2118(24)S
5490 V
(03426)210 648 A
(#define)294 1026 A
(STIME)210 1362 A
2118(25)S
5580 V
(03427)210 648 A
(#define)294 1026 A
(PTRACE)252 1362 A
2118(26)S
5670 V
(03428)210 648 A
(#define)294 1026 A
(ALARM)210 1362 A
2118(27)S
5760 V
(03429)210 648 A
(#define)294 1026 A
(FSTAT)210 1362 A
2118(28)S
5850 V
(03430)210 648 A
(#define)294 1026 A
(PAUSE)210 1362 A
2118(29)S
5940 V
(03431)210 648 A
(#define)294 1026 A
(UTIME)210 1362 A
2118(30)S
6030 V
(03432)210 648 A
(#define)294 1026 A
(ACCESS)252 1362 A
2118(33)S
6120 V
(03433)210 648 A
(#define)294 1026 A
(SYNC)168 1362 A
2118(36)S
6210 V
(03434)210 648 A
(#define)294 1026 A
(KILL)168 1362 A
2118(37)S
8418 V
EP
%%Page: 40 40
BP
/slant 0 def
/height 0 def
630 V
12 B
648(40)S
11 R
1929(File:)S
2162(include/minix/callnr.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(03435)210 648 A
(#define)294 1026 A
(RENAME)252 1362 A
2118(38)S
990 V
(03436)210 648 A
(#define)294 1026 A
(MKDIR)210 1362 A
2118(39)S
1080 V
(03437)210 648 A
(#define)294 1026 A
(RMDIR)210 1362 A
2118(40)S
1170 V
(03438)210 648 A
(#define)294 1026 A
(DUP)126 1362 A
2118(41)S
1260 V
(03439)210 648 A
(#define)294 1026 A
(PIPE)168 1362 A
2118(42)S
1350 V
(03440)210 648 A
(#define)294 1026 A
(TIMES)210 1362 A
2118(43)S
1440 V
(03441)210 648 A
(#define)294 1026 A
(SETGID)252 1362 A
2118(46)S
1530 V
(03442)210 648 A
(#define)294 1026 A
(GETGID)252 1362 A
2118(47)S
1620 V
(03443)210 648 A
(#define)294 1026 A
(SIGNAL)252 1362 A
2118(48)S
1710 V
(03444)210 648 A
(#define)294 1026 A
(IOCTL)210 1362 A
2118(54)S
1800 V
(03445)210 648 A
(#define)294 1026 A
(FCNTL)210 1362 A
2118(55)S
1890 V
(03446)210 648 A
(#define)294 1026 A
(EXEC)168 1362 A
2118(59)S
1980 V
(03447)210 648 A
(#define)294 1026 A
(UMASK)210 1362 A
2118(60)S
2070 V
(03448)210 648 A
(#define)294 1026 A
(CHROOT)252 1362 A
2118(61)S
2160 V
(03449)210 648 A
(#define)294 1026 A
(SETSID)252 1362 A
2118(62)S
2250 V
(03450)210 648 A
(#define)294 1026 A
(GETPGRP)294 1362 A
2118(63)S
2340 V
(03451)210 648 A
2430 V
(03452)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(are)126 1740 A
(not)126 1908 A
(system)252 2076 A
(calls,)252 2370 A
(but)126 2664 A
(are)126 2832 A
(processed)378 3000 A
(like)168 3420 A
(them.)210 3630 A
3882(*/)S
2520 V
(03453)210 648 A
(#define)294 1026 A
(KSIG)168 1362 A
2118(64)S
2370(/*)S
(kernel)252 2496 A
(detected)336 2790 A
3168(a)S
(signal)252 3252 A
3546(*/)S
2610 V
(03454)210 648 A
(#define)294 1026 A
(UNPAUSE)294 1362 A
2118(65)S
2370(/*)S
2496(to)S
2622(MM)S
2748(or)S
(FS:)126 2874 A
(check)210 3042 A
(for)126 3294 A
(EINTR)210 3462 A
3714(*/)S
2700 V
(03455)210 648 A
(#define)294 1026 A
(REVIVE)252 1362 A
2118(67)S
2370(/*)S
2496(to)S
(FS:)126 2622 A
(revive)252 2790 A
3084(a)S
(sleeping)336 3168 A
(process)294 3546 A
3882(*/)S
2790 V
(03456)210 648 A
(#define)294 1026 A
(TASK_REPLY)420 1362 A
2118(68)S
2370(/*)S
2496(to)S
(FS:)126 2622 A
(reply)210 2790 A
(code)168 3042 A
(from)168 3252 A
(tty)126 3462 A
(task)168 3630 A
3840(*/)S
2880 V
(03457)210 648 A
2970 V
(03458)210 648 A
1026(/*)S
(Posix)210 1152 A
(signal)252 1404 A
(handling.)378 1698 A
2118(*/)S
3060 V
(03459)210 648 A
(#define)294 1026 A
(SIGACTION)378 1362 A
2118(71)S
3150 V
(03460)210 648 A
(#define)294 1026 A
(SIGSUSPEND)420 1362 A
2118(72)S
3240 V
(03461)210 648 A
(#define)294 1026 A
(SIGPENDING)420 1362 A
2118(73)S
3330 V
(03462)210 648 A
(#define)294 1026 A
(SIGPROCMASK)462 1362 A
2118(74)S
3420 V
(03463)210 648 A
(#define)294 1026 A
(SIGRETURN)378 1362 A
2118(75)S
3510 V
(03464)210 648 A
3600 V
(03465)210 648 A
(#define)294 1026 A
(REBOOT)252 1362 A
2118(76)S
4140 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4230 V
(include/minix/com.h)798 2034 A
4320 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4500 V
(03500)210 648 A
1026(/*)S
(System)252 1152 A
(calls.)252 1446 A
1740(*/)S
4590 V
(03501)210 648 A
(#define)294 1026 A
(SEND)168 1362 A
2160(1)S
2370(/*)S
(function)336 2496 A
(code)168 2874 A
(for)126 3084 A
(sending)294 3252 A
(messages)336 3588 A
3966(*/)S
4680 V
(03502)210 648 A
(#define)294 1026 A
(RECEIVE)294 1362 A
2160(2)S
2370(/*)S
(function)336 2496 A
(code)168 2874 A
(for)126 3084 A
(receiving)378 3252 A
(messages)336 3672 A
4050(*/)S
4770 V
(03503)210 648 A
(#define)294 1026 A
(BOTH)168 1362 A
2160(3)S
2370(/*)S
(function)336 2496 A
(code)168 2874 A
(for)126 3084 A
(SEND)168 3252 A
3462(+)S
(RECEIVE)294 3546 A
3882(*/)S
4860 V
(03504)210 648 A
(#define)294 1026 A
(ANY)126 1362 A
(\(NR_PROCS+100\))588 1614 A
2370(/*)S
(receive\(ANY,)504 2496 A
(buf\))168 3042 A
(accepts)294 3252 A
(from)168 3588 A
(any)126 3798 A
(source)252 3966 A
4260(*/)S
4950 V
(03505)210 648 A
5040 V
(03506)210 648 A
1026(/*)S
(Task)168 1152 A
(numbers,)336 1362 A
(function)336 1740 A
(codes)210 2118 A
(and)126 2370 A
(reply)210 2538 A
(codes.)252 2790 A
3084(*/)S
5130 V
(03507)210 648 A
5220 V
(03508)210 648 A
1026(/*)S
(The)126 1152 A
(values)252 1320 A
1614(of)S
(several)294 1740 A
(task)168 2076 A
(numbers)294 2286 A
(depend)252 2622 A
2916(on)S
(whether)294 3042 A
(they)168 3378 A
3588(or)S
(other)210 3714 A
(tasks)210 3966 A
5310 V
(03509)210 648 A
1068(*)S
(are)126 1152 A
(enabled.)336 1320 A
(They)168 1740 A
(are)126 1950 A
(defined)294 2118 A
2454(as)S
(\(PREVIOUS_TASK)588 2580 A
3210(-)S
(ENABLE_TASK\))504 3294 A
3840(in)S
(general.)336 3966 A
5400 V
(03510)210 648 A
1068(*)S
(ENABLE_TASK)462 1152 A
1656(is)S
(either)252 1782 A
2076(0)S
2160(or)S
2286(1,)S
2412(so)S
2538(a)S
(task)168 2622 A
(either)252 2832 A
(gets)168 3126 A
3336(a)S
(new)126 3420 A
(number,)294 3588 A
3924(or)S
(gets)168 4050 A
5490 V
(03511)210 648 A
1068(*)S
(the)126 1152 A
(same)168 1320 A
(number)252 1530 A
1824(as)S
(the)126 1950 A
(previous)336 2118 A
(task)168 2496 A
(and)126 2706 A
2874(is)S
(further)294 3000 A
(unused.)294 3336 A
5580 V
(03512)210 648 A
1068(*)S
(The)126 1152 A
(TTY)126 1320 A
(task)168 1488 A
(must)168 1698 A
(always)252 1908 A
(have)168 2202 A
(the)126 2412 A
(most)168 2580 A
(negative)336 2790 A
(number)252 3168 A
3462(so)S
(that)168 3588 A
3798(it)S
3924(is)S
5670 V
(03513)210 648 A
1068(*)S
(initialized)462 1152 A
(first.)252 1656 A
(Many)168 1992 A
2202(of)S
(the)126 2328 A
(TTY)126 2496 A
(function)336 2664 A
(codes)210 3042 A
(are)126 3294 A
(shared)252 3462 A
(with)168 3756 A
(other)210 3966 A
5760 V
(03514)210 648 A
1068(*)S
(tasks.)252 1152 A
5850 V
(03515)210 648 A
1068(*/)S
5940 V
(03516)210 648 A
6030 V
(03517)210 648 A
(#define)294 1026 A
(TTY)126 1362 A
(\(DL_ETH)294 2034 A
2370(-)S
2454(1\))S
6120 V
(03518)210 648 A
2370(/*)S
(terminal)336 2496 A
(I/O)126 2874 A
(class)210 3042 A
3294(*/)S
6210 V
(03519)210 648 A
1026(#)S
(define)252 1362 A
(CANCEL)252 1656 A
2202(0)S
2370(/*)S
(general)294 2496 A
(req)126 2832 A
3000(to)S
(force)210 3126 A
3378(a)S
(task)168 3462 A
3672(to)S
(cancel)252 3798 A
4092(*/)S
8418 V
EP
%%Page: 41 41
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1961(File:)S
2194(include/minix/com.h)S
12 B
4308(41)S
900 V
7 LST
(03520)210 648 A
1026(#)S
(define)252 1362 A
(HARD_INT)336 1656 A
2202(2)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(all)126 3042 A
(hardware)336 3210 A
(interrupts)420 3588 A
4050(*/)S
990 V
(03521)210 648 A
1026(#)S
(define)252 1362 A
(DEV_READ)336 1656 A
2202(3)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(reading)294 3042 A
(from)168 3378 A
(tty)126 3588 A
3756(*/)S
1080 V
(03522)210 648 A
1026(#)S
(define)252 1362 A
(DEV_WRITE)378 1656 A
2202(4)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(writing)294 3042 A
3378(to)S
(tty)126 3504 A
3672(*/)S
1170 V
(03523)210 648 A
1026(#)S
(define)252 1362 A
(DEV_IOCTL)378 1656 A
2202(5)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(ioctl)210 3042 A
3294(*/)S
1260 V
(03524)210 648 A
1026(#)S
(define)252 1362 A
(DEV_OPEN)336 1656 A
2202(6)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(opening)294 3042 A
(tty)126 3378 A
3546(*/)S
1350 V
(03525)210 648 A
1026(#)S
(define)252 1362 A
(DEV_CLOSE)378 1656 A
2202(7)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(closing)294 3042 A
(tty)126 3378 A
3546(*/)S
1440 V
(03526)210 648 A
1026(#)S
(define)252 1362 A
(SCATTERED_IO)504 1656 A
2202(8)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(multiple)336 3042 A
(reads/writes)504 3420 A
3966(*/)S
1530 V
(03527)210 648 A
1026(#)S
(define)252 1362 A
(TTY_SETPGRP)462 1656 A
2202(9)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(setpgroup)378 3042 A
3462(*/)S
1620 V
(03528)210 648 A
1026(#)S
(define)252 1362 A
(TTY_EXIT)336 1656 A
2160(10)S
2370(/*)S
2496(a)S
(process)294 2580 A
(group)210 2916 A
(leader)252 3168 A
(has)126 3462 A
(exited)252 3630 A
3924(*/)S
1710 V
(03529)210 648 A
1026(#)S
(define)252 1362 A
(OPTIONAL_IO)462 1656 A
2160(16)S
2370(/*)S
(modifier)336 2496 A
2874(to)S
(DEV_*)210 3000 A
(codes)210 3252 A
(within)252 3504 A
(vector)252 3798 A
4092(*/)S
1800 V
(03530)210 648 A
1026(#)S
(define)252 1362 A
(SUSPEND)294 1656 A
(-998)168 2076 A
2370(/*)S
(used)168 2496 A
2706(in)S
(interrupts)420 2832 A
(when)168 3294 A
(tty)126 3504 A
(has)126 3672 A
3840(no)S
(data)168 3966 A
4176(*/)S
1890 V
(03531)210 648 A
1980 V
(03532)210 648 A
(#define)294 1026 A
(DL_ETH)252 1362 A
(\(CDROM)252 2034 A
2328(-)S
(ENABLE_NETWORKING\))756 2412 A
2070 V
(03533)210 648 A
2370(/*)S
(networking)420 2496 A
(task)168 2958 A
3168(*/)S
2160 V
(03534)210 648 A
2250 V
(03535)210 648 A
1026(/*)S
(Message)294 1152 A
(type)168 1488 A
(for)126 1698 A
(data)168 1866 A
(link)168 2076 A
(layer)210 2286 A
(reqests.)336 2538 A
2916(*/)S
2340 V
(03536)210 648 A
1026(#)S
(define)252 1362 A
(DL_WRITE)336 1656 A
2370(3)S
2430 V
(03537)210 648 A
1026(#)S
(define)252 1362 A
(DL_WRITEV)378 1656 A
2370(4)S
2520 V
(03538)210 648 A
1026(#)S
(define)252 1362 A
(DL_READ)294 1656 A
2370(5)S
2610 V
(03539)210 648 A
1026(#)S
(define)252 1362 A
(DL_READV)336 1656 A
2370(6)S
2700 V
(03540)210 648 A
1026(#)S
(define)252 1362 A
(DL_INIT)294 1656 A
2370(7)S
2790 V
(03541)210 648 A
1026(#)S
(define)252 1362 A
(DL_STOP)294 1656 A
2370(8)S
2880 V
(03542)210 648 A
1026(#)S
(define)252 1362 A
(DL_GETSTAT)420 1656 A
2370(9)S
2970 V
(03543)210 648 A
3060 V
(03544)210 648 A
1026(/*)S
(Message)294 1152 A
(type)168 1488 A
(for)126 1698 A
(data)168 1866 A
(link)168 2076 A
(layer)210 2286 A
(replies.)336 2538 A
2916(*/)S
3150 V
(03545)210 648 A
1026(#)S
(define)252 1362 A
(DL_INIT_REPLY)546 1656 A
2370(20)S
3240 V
(03546)210 648 A
1026(#)S
(define)252 1362 A
(DL_TASK_REPLY)546 1656 A
2370(21)S
3330 V
(03547)210 648 A
3420 V
(03548)210 648 A
1026(#)S
(define)252 1362 A
(DL_PORT)294 1656 A
(m2_i1)210 2370 A
3510 V
(03549)210 648 A
1026(#)S
(define)252 1362 A
(DL_PROC)294 1656 A
(m2_i2)210 2370 A
3600 V
(03550)210 648 A
1026(#)S
(define)252 1362 A
(DL_COUNT)336 1656 A
(m2_i3)210 2370 A
3690 V
(03551)210 648 A
1026(#)S
(define)252 1362 A
(DL_MODE)294 1656 A
(m2_l1)210 2370 A
3780 V
(03552)210 648 A
1026(#)S
(define)252 1362 A
(DL_CLCK)294 1656 A
(m2_l2)210 2370 A
3870 V
(03553)210 648 A
1026(#)S
(define)252 1362 A
(DL_ADDR)294 1656 A
(m2_p1)210 2370 A
3960 V
(03554)210 648 A
1026(#)S
(define)252 1362 A
(DL_STAT)294 1656 A
(m2_l1)210 2370 A
4050 V
(03555)210 648 A
4140 V
(03556)210 648 A
1026(/*)S
(Bits)168 1152 A
1362(in)S
('DL_STAT')378 1488 A
(field)210 1908 A
2160(of)S
2286(DL)S
(replies.)336 2412 A
2790(*/)S
4230 V
(03557)210 648 A
1026(#)S
(define)252 1362 A
(DL_PACK_SEND)504 1656 A
(0x01)168 2370 A
4320 V
(03558)210 648 A
1026(#)S
(define)252 1362 A
(DL_PACK_RECV)504 1656 A
(0x02)168 2370 A
4410 V
(03559)210 648 A
1026(#)S
(define)252 1362 A
(DL_READ_IP)420 1656 A
(0x04)168 2370 A
4500 V
(03560)210 648 A
4590 V
(03561)210 648 A
1026(/*)S
(Bits)168 1152 A
1362(in)S
('DL_MODE')378 1488 A
(field)210 1908 A
2160(of)S
2286(DL)S
(requests.)378 2412 A
2832(*/)S
4680 V
(03562)210 648 A
1026(#)S
(define)252 1362 A
(DL_NOMODE)378 1656 A
(0x0)126 2370 A
4770 V
(03563)210 648 A
1026(#)S
(define)252 1362 A
(DL_PROMISC_REQ)588 1656 A
(0x2)126 2370 A
4860 V
(03564)210 648 A
1026(#)S
(define)252 1362 A
(DL_MULTI_REQ)504 1656 A
(0x4)126 2370 A
4950 V
(03565)210 648 A
1026(#)S
(define)252 1362 A
(DL_BROAD_REQ)504 1656 A
(0x8)126 2370 A
5040 V
(03566)210 648 A
5130 V
(03567)210 648 A
1026(#)S
(define)252 1362 A
(NW_OPEN)294 1656 A
(DEV_OPEN)336 2370 A
5220 V
(03568)210 648 A
1026(#)S
(define)252 1362 A
(NW_CLOSE)336 1656 A
(DEV_CLOSE)378 2370 A
5310 V
(03569)210 648 A
1026(#)S
(define)252 1362 A
(NW_READ)294 1656 A
(DEV_READ)336 2370 A
5400 V
(03570)210 648 A
1026(#)S
(define)252 1362 A
(NW_WRITE)336 1656 A
(DEV_WRITE)378 2370 A
5490 V
(03571)210 648 A
1026(#)S
(define)252 1362 A
(NW_IOCTL)336 1656 A
(DEV_IOCTL)378 2370 A
5580 V
(03572)210 648 A
1026(#)S
(define)252 1362 A
(NW_CANCEL)378 1656 A
(CANCEL)252 2370 A
5670 V
(03573)210 648 A
5760 V
(03574)210 648 A
(#define)294 1026 A
(CDROM)210 1362 A
(\(AUDIO)252 2034 A
2328(-)S
(ENABLE_CDROM\))546 2412 A
5850 V
(03575)210 648 A
2370(/*)S
(cd-rom)252 2496 A
(device)252 2790 A
(task)168 3084 A
3294(*/)S
5940 V
(03576)210 648 A
6030 V
(03577)210 648 A
(#define)294 1026 A
(AUDIO)210 1362 A
(\(MIXER)252 2034 A
2328(-)S
(ENABLE_AUDIO\))546 2412 A
6120 V
(03578)210 648 A
(#define)294 1026 A
(MIXER)210 1362 A
(\(SCSI)210 2034 A
2286(-)S
(ENABLE_AUDIO\))546 2370 A
6210 V
(03579)210 648 A
2370(/*)S
(audio)210 2496 A
2748(&)S
(mixer)210 2832 A
(device)252 3084 A
(tasks)210 3378 A
3630(*/)S
8418 V
EP
%%Page: 42 42
BP
/slant 0 def
/height 0 def
630 V
12 B
648(42)S
11 R
1961(File:)S
2194(include/minix/com.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(03580)210 648 A
990 V
(03581)210 648 A
(#define)294 1026 A
(SCSI)168 1362 A
(\(WINCHESTER)462 2034 A
2538(-)S
(ENABLE_SCSI\))504 2622 A
1080 V
(03582)210 648 A
2370(/*)S
(scsi)168 2496 A
(device)252 2706 A
(task)168 3000 A
3210(*/)S
1170 V
(03583)210 648 A
1260 V
(03584)210 648 A
(#define)294 1026 A
(WINCHESTER)420 1362 A
(\(SYN_ALRM_TASK)588 2034 A
2664(-)S
(ENABLE_WINI\))504 2748 A
1350 V
(03585)210 648 A
2370(/*)S
(winchester)420 2496 A
(\(hard\))252 2958 A
(disk)168 3252 A
(class)210 3462 A
3714(*/)S
1440 V
(03586)210 648 A
1530 V
(03587)210 648 A
(#define)294 1026 A
(SYN_ALRM_TASK)546 1362 A
2118(-8)S
2370(/*)S
(task)168 2496 A
2706(to)S
(send)168 2832 A
(CLOCK_INT)378 3042 A
(messages)336 3462 A
3840(*/)S
1620 V
(03588)210 648 A
1710 V
(03589)210 648 A
(#define)294 1026 A
(IDLE)168 1362 A
2118(-7)S
2370(/*)S
(task)168 2496 A
2706(to)S
(run)126 2832 A
(when)168 3000 A
(there's)294 3210 A
(nothing)294 3546 A
3882(to)S
(run)126 4008 A
4176(*/)S
1800 V
(03590)210 648 A
1890 V
(03591)210 648 A
(#define)294 1026 A
(PRINTER)294 1362 A
2118(-6)S
2370(/*)S
(printer)294 2496 A
(I/O)126 2832 A
(class)210 3000 A
3252(*/)S
1980 V
(03592)210 648 A
2070 V
(03593)210 648 A
(#define)294 1026 A
(FLOPPY)252 1362 A
2118(-5)S
2370(/*)S
(floppy)252 2496 A
(disk)168 2790 A
(class)210 3000 A
3252(*/)S
2160 V
(03594)210 648 A
2250 V
(03595)210 648 A
(#define)294 1026 A
(MEM)126 1362 A
2118(-4)S
2370(/*)S
(/dev/ram,)378 2496 A
(/dev/\(k\)mem)462 2916 A
(and)126 3420 A
(/dev/null)378 3588 A
(class)210 4008 A
4260(*/)S
2340 V
(03596)210 648 A
1026(#)S
(define)252 1362 A
(NULL_MAJOR)420 1656 A
2160(1)S
2370(/*)S
(major)210 2496 A
(device)252 2748 A
(for)126 3042 A
(/dev/null)378 3210 A
3630(*/)S
2430 V
(03597)210 648 A
1026(#)S
(define)252 1362 A
(RAM_DEV)294 1656 A
2160(0)S
2370(/*)S
(minor)210 2496 A
(device)252 2748 A
(for)126 3042 A
(/dev/ram)336 3210 A
3588(*/)S
2520 V
(03598)210 648 A
1026(#)S
(define)252 1362 A
(MEM_DEV)294 1656 A
2160(1)S
2370(/*)S
(minor)210 2496 A
(device)252 2748 A
(for)126 3042 A
(/dev/mem)336 3210 A
3588(*/)S
2610 V
(03599)210 648 A
1026(#)S
(define)252 1362 A
(KMEM_DEV)336 1656 A
2160(2)S
2370(/*)S
(minor)210 2496 A
(device)252 2748 A
(for)126 3042 A
(/dev/kmem)378 3210 A
3630(*/)S
2700 V
(03600)210 648 A
1026(#)S
(define)252 1362 A
(NULL_DEV)336 1656 A
2160(3)S
2370(/*)S
(minor)210 2496 A
(device)252 2748 A
(for)126 3042 A
(/dev/null)378 3210 A
3630(*/)S
2790 V
(03601)210 648 A
2880 V
(03602)210 648 A
(#define)294 1026 A
(CLOCK)210 1362 A
2118(-3)S
2370(/*)S
(clock)210 2496 A
(class)210 2748 A
3000(*/)S
2970 V
(03603)210 648 A
1026(#)S
(define)252 1362 A
(SET_ALARM)378 1656 A
2160(1)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
2874(to)S
(CLOCK,)252 3000 A
(set)126 3294 A
3462(up)S
(alarm)210 3588 A
3840(*/)S
3060 V
(03604)210 648 A
1026(#)S
(define)252 1362 A
(GET_TIME)336 1656 A
2160(3)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
2874(to)S
(CLOCK,)252 3000 A
(get)126 3294 A
(real)168 3462 A
(time)168 3672 A
3882(*/)S
3150 V
(03605)210 648 A
1026(#)S
(define)252 1362 A
(SET_TIME)336 1656 A
2160(4)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
2874(to)S
(CLOCK,)252 3000 A
(set)126 3294 A
(real)168 3462 A
(time)168 3672 A
3882(*/)S
3240 V
(03606)210 648 A
1026(#)S
(define)252 1362 A
(GET_UPTIME)420 1656 A
2160(5)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
2874(to)S
(CLOCK,)252 3000 A
(get)126 3294 A
(uptime)252 3462 A
3756(*/)S
3330 V
(03607)210 648 A
1026(#)S
(define)252 1362 A
(SET_SYNC_AL)462 1656 A
2160(6)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
2874(to)S
(CLOCK,)252 3000 A
(set)126 3294 A
3462(up)S
(alarm)210 3588 A
(which)210 3840 A
4092(*/)S
3420 V
(03608)210 648 A
2370(/*)S
(times)210 2496 A
(out)126 2748 A
(with)168 2916 A
3126(a)S
(send)168 3210 A
3420(*/)S
3510 V
(03609)210 648 A
1026(#)S
(define)252 1362 A
(REAL_TIME)378 1656 A
2160(1)S
2370(/*)S
(reply)210 2496 A
(from)168 2748 A
(CLOCK:)252 2958 A
(here)168 3252 A
3462(is)S
(real)168 3588 A
(time)168 3798 A
4008(*/)S
3600 V
(03610)210 648 A
1026(#)S
(define)252 1362 A
(CLOCK_INT)378 1656 A
(HARD_INT)336 2160 A
3690 V
(03611)210 648 A
2370(/*)S
(this)168 2496 A
(code)168 2706 A
(will)168 2916 A
(only)168 3126 A
3336(be)S
(sent)168 3462 A
3672(by)S
3798(*/)S
3780 V
(03612)210 648 A
2370(/*)S
(SYN_ALRM_TASK)546 2496 A
3084(to)S
3210(a)S
(task)168 3294 A
(that)168 3504 A
(requested)378 3714 A
4134(a)S
4218(*/)S
3870 V
(03613)210 648 A
2370(/*)S
(synchronous)462 2496 A
(alarm)210 3000 A
3252(*/)S
3960 V
(03614)210 648 A
4050 V
(03615)210 648 A
(#define)294 1026 A
(SYSTASK)294 1362 A
2118(-2)S
2370(/*)S
(internal)336 2496 A
(functions)378 2874 A
3294(*/)S
4140 V
(03616)210 648 A
1026(#)S
(define)252 1362 A
(SYS_XIT)294 1656 A
2286(1)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_xit\(parent,)630 3042 A
(proc\))210 3714 A
3966(*/)S
4230 V
(03617)210 648 A
1026(#)S
(define)252 1362 A
(SYS_GETSP)378 1656 A
2286(2)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_sp\(proc,)504 3042 A
(&new_sp\))336 3588 A
3966(*/)S
4320 V
(03618)210 648 A
1026(#)S
(define)252 1362 A
(SYS_OLDSIG)420 1656 A
2286(3)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_oldsig\(proc,)672 3042 A
(sig\))168 3756 A
3966(*/)S
4410 V
(03619)210 648 A
1026(#)S
(define)252 1362 A
(SYS_FORK)336 1656 A
2286(4)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_fork\(parent,)672 3042 A
(child\))252 3756 A
4050(*/)S
4500 V
(03620)210 648 A
1026(#)S
(define)252 1362 A
(SYS_NEWMAP)420 1656 A
2286(5)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_newmap\(procno,)756 3042 A
(map_ptr\))336 3840 A
4218(*/)S
4590 V
(03621)210 648 A
1026(#)S
(define)252 1362 A
(SYS_COPY)336 1656 A
2286(6)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_copy\(ptr\))546 3042 A
3630(*/)S
4680 V
(03622)210 648 A
1026(#)S
(define)252 1362 A
(SYS_EXEC)336 1656 A
2286(7)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_exec\(procno,)672 3042 A
(new_sp\))294 3756 A
4092(*/)S
4770 V
(03623)210 648 A
1026(#)S
(define)252 1362 A
(SYS_TIMES)378 1656 A
2286(8)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_times\(procno,)714 3042 A
(bufptr\))294 3798 A
4134(*/)S
4860 V
(03624)210 648 A
1026(#)S
(define)252 1362 A
(SYS_ABORT)378 1656 A
2286(9)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_abort\(\))462 3042 A
3546(*/)S
4950 V
(03625)210 648 A
1026(#)S
(define)252 1362 A
(SYS_FRESH)378 1656 A
2244(10)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_fresh\(\))462 3042 A
(\(Atari)252 3588 A
(only\))210 3882 A
4134(*/)S
5040 V
(03626)210 648 A
1026(#)S
(define)252 1362 A
(SYS_KILL)336 1656 A
2244(11)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_kill\(proc,)588 3042 A
(sig\))168 3672 A
3882(*/)S
5130 V
(03627)210 648 A
1026(#)S
(define)252 1362 A
(SYS_GBOOT)378 1656 A
2244(12)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_gboot\(procno,)714 3042 A
(bootptr\))336 3798 A
4176(*/)S
5220 V
(03628)210 648 A
1026(#)S
(define)252 1362 A
(SYS_UMAP)336 1656 A
2244(13)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_umap\(procno,)672 3042 A
(etc\))168 3756 A
3966(*/)S
5310 V
(03629)210 648 A
1026(#)S
(define)252 1362 A
(SYS_MEM)294 1656 A
2244(14)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_mem\(\))378 3042 A
3462(*/)S
5400 V
(03630)210 648 A
1026(#)S
(define)252 1362 A
(SYS_TRACE)378 1656 A
2244(15)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_trace\(req,pid,addr,data\))1176 3042 A
4260(*/)S
5490 V
(03631)210 648 A
1026(#)S
(define)252 1362 A
(SYS_VCOPY)378 1656 A
2244(16)S
2370(/*)S
(fnc)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_vcopy\(src_proc,)798 3042 A
(dest_proc,)420 3882 A
5580 V
(03632)210 648 A
(vcopy_s,)336 2496 A
(vcopy_ptr\))420 2874 A
3336(*/)S
5670 V
(03633)210 648 A
1026(#)S
(define)252 1362 A
(SYS_SENDSIG)462 1656 A
2244(17)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_sendsig\(&sigmsg\))840 3042 A
3924(*/)S
5760 V
(03634)210 648 A
1026(#)S
(define)252 1362 A
(SYS_SIGRETURN)546 1656 A
2244(18)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_sigreturn\(&sigmsg\))924 3042 A
4008(*/)S
5850 V
(03635)210 648 A
1026(#)S
(define)252 1362 A
(SYS_ENDSIG)420 1656 A
2244(19)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_endsig\(procno\))756 3042 A
3840(*/)S
5940 V
(03636)210 648 A
1026(#)S
(define)252 1362 A
(SYS_GETMAP)420 1656 A
2244(20)S
2370(/*)S
(fcn)126 2496 A
(code)168 2664 A
(for)126 2874 A
(sys_getmap\(procno,)756 3042 A
(map_ptr\))336 3840 A
4218(*/)S
6030 V
(03637)210 648 A
6120 V
(03638)210 648 A
(#define)294 1026 A
(HARDWARE)336 1362 A
2118(-1)S
2370(/*)S
(used)168 2496 A
2706(as)S
(source)252 2832 A
3126(on)S
(interrupt)378 3252 A
(generated)378 3672 A
(msgs*/)252 4092 A
6210 V
(03639)210 648 A
8418 V
EP
%%Page: 43 43
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1961(File:)S
2194(include/minix/com.h)S
12 B
4308(43)S
900 V
7 LST
(03640)210 648 A
1026(/*)S
(Names)210 1152 A
1404(of)S
(message)294 1530 A
(fields)252 1866 A
(for)126 2160 A
(messages)336 2328 A
2706(to)S
(CLOCK)210 2832 A
(task.)210 3084 A
3336(*/)S
990 V
(03641)210 648 A
(#define)294 1026 A
(DELTA_TICKS)462 1362 A
(m6_l1)210 1992 A
2370(/*)S
(alarm)210 2496 A
(interval)336 2748 A
3126(in)S
(clock)210 3252 A
(ticks)210 3504 A
3756(*/)S
1080 V
(03642)210 648 A
(#define)294 1026 A
(FUNC_TO_CALL)504 1362 A
(m6_f1)210 1992 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(function)336 2958 A
3336(to)S
(call)168 3462 A
3672(*/)S
1170 V
(03643)210 648 A
(#define)294 1026 A
(NEW_TIME)336 1362 A
(m6_l1)210 1992 A
2370(/*)S
(value)210 2496 A
2748(to)S
(set)126 2874 A
(clock)210 3042 A
3294(to)S
(\(SET_TIME\))420 3420 A
3882(*/)S
1260 V
(03644)210 648 A
(#define)294 1026 A
(CLOCK_PROC_NR)546 1362 A
(m6_i1)210 1992 A
2370(/*)S
(which)210 2496 A
(proc)168 2748 A
(\(or)126 2958 A
(task\))210 3126 A
(wants)210 3378 A
(the)126 3630 A
(alarm?)252 3798 A
4092(*/)S
1350 V
(03645)210 648 A
(#define)294 1026 A
(SECONDS_LEFT)504 1362 A
(m6_l1)210 1992 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(seconds)294 2874 A
(were)168 3210 A
(remaining)378 3420 A
3840(*/)S
1440 V
(03646)210 648 A
1530 V
(03647)210 648 A
1026(/*)S
(Names)210 1152 A
1404(of)S
(message)294 1530 A
(fields)252 1866 A
(used)168 2160 A
(for)126 2370 A
(messages)336 2538 A
2916(to)S
(block)210 3042 A
(and)126 3294 A
(character)378 3462 A
(tasks.)252 3882 A
4176(*/)S
1620 V
(03648)210 648 A
(#define)294 1026 A
(DEVICE)252 1362 A
(m2_i1)210 1992 A
2370(/*)S
(major-minor)462 2496 A
(device)252 3000 A
3294(*/)S
1710 V
(03649)210 648 A
(#define)294 1026 A
(PROC_NR)294 1362 A
(m2_i2)210 1992 A
2370(/*)S
(which)210 2496 A
(\(proc\))252 2748 A
(wants)210 3042 A
(I/O?)168 3294 A
3504(*/)S
1800 V
(03650)210 648 A
(#define)294 1026 A
(COUNT)210 1362 A
(m2_i3)210 1992 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(bytes)210 2874 A
3126(to)S
(transfer)336 3252 A
3630(*/)S
1890 V
(03651)210 648 A
(#define)294 1026 A
(REQUEST)294 1362 A
(m2_i3)210 1992 A
2370(/*)S
(ioctl)210 2496 A
(request)294 2748 A
(code)168 3084 A
3294(*/)S
1980 V
(03652)210 648 A
(#define)294 1026 A
(POSITION)336 1362 A
(m2_l1)210 1992 A
2370(/*)S
(file)168 2496 A
(offset)252 2706 A
3000(*/)S
2070 V
(03653)210 648 A
(#define)294 1026 A
(ADDRESS)294 1362 A
(m2_p1)210 1992 A
2370(/*)S
(core)168 2496 A
(buffer)252 2706 A
(address)294 3000 A
3336(*/)S
2160 V
(03654)210 648 A
2250 V
(03655)210 648 A
1026(/*)S
(Names)210 1152 A
1404(of)S
(message)294 1530 A
(fields)252 1866 A
(for)126 2160 A
(messages)336 2328 A
2706(to)S
(TTY)126 2832 A
(task.)210 3000 A
3252(*/)S
2340 V
(03656)210 648 A
(#define)294 1026 A
(TTY_LINE)336 1362 A
(DEVICE)252 1992 A
2370(/*)S
(message)294 2496 A
(parameter:)420 2832 A
(terminal)336 3294 A
(line)168 3672 A
3882(*/)S
2430 V
(03657)210 648 A
(#define)294 1026 A
(TTY_REQUEST)462 1362 A
(COUNT)210 1992 A
2370(/*)S
(message)294 2496 A
(parameter:)420 2832 A
(ioctl)210 3294 A
(request)294 3546 A
(code)168 3882 A
4092(*/)S
2520 V
(03658)210 648 A
(#define)294 1026 A
(TTY_SPEK)336 1362 A
(POSITION)336 1992 A
2370(/*)S
(message)294 2496 A
(parameter:)420 2832 A
(ioctl)210 3294 A
(speed,)252 3546 A
(erasing)294 3840 A
4176(*/)S
2610 V
(03659)210 648 A
(#define)294 1026 A
(TTY_FLAGS)378 1362 A
(m2_l2)210 1992 A
2370(/*)S
(message)294 2496 A
(parameter:)420 2832 A
(ioctl)210 3294 A
(tty)126 3546 A
(mode)168 3714 A
3924(*/)S
2700 V
(03660)210 648 A
(#define)294 1026 A
(TTY_PGRP)336 1362 A
(m2_i3)210 1992 A
2370(/*)S
(message)294 2496 A
(parameter:)420 2832 A
(process)294 3294 A
(group)210 3630 A
3882(*/)S
2790 V
(03661)210 648 A
2880 V
(03662)210 648 A
1026(/*)S
(Names)210 1152 A
1404(of)S
(the)126 1530 A
(message)294 1698 A
(fields)252 2034 A
(for)126 2328 A
(QIC)126 2496 A
2664(02)S
(status)252 2790 A
(reply)210 3084 A
(from)168 3336 A
(tape)168 3546 A
(driver)252 3756 A
4050(*/)S
2970 V
(03663)210 648 A
(#define)294 1026 A
(TAPE_STAT0)420 1362 A
(m2_l1)210 2034 A
3060 V
(03664)210 648 A
(#define)294 1026 A
(TAPE_STAT1)420 1362 A
(m2_l2)210 2034 A
3150 V
(03665)210 648 A
3240 V
(03666)210 648 A
1026(/*)S
(Names)210 1152 A
1404(of)S
(messages)336 1530 A
(fields)252 1908 A
(used)168 2202 A
2412(in)S
(reply)210 2538 A
(messages)336 2790 A
(from)168 3168 A
(tasks.)252 3378 A
3672(*/)S
3330 V
(03667)210 648 A
(#define)294 1026 A
(REP_PROC_NR)462 1362 A
(m2_i1)210 1992 A
2370(/*)S
2496(#)S
2580(of)S
(proc)168 2706 A
2916(on)S
(whose)210 3042 A
(behalf)252 3294 A
(I/O)126 3588 A
(was)126 3756 A
(done)168 3924 A
4134(*/)S
3420 V
(03668)210 648 A
(#define)294 1026 A
(REP_STATUS)420 1362 A
(m2_i2)210 1992 A
2370(/*)S
(bytes)210 2496 A
(transferred)462 2748 A
3252(or)S
(error)210 3378 A
(number)252 3630 A
3924(*/)S
3510 V
(03669)210 648 A
3600 V
(03670)210 648 A
1026(/*)S
(Names)210 1152 A
1404(of)S
(fields)252 1530 A
(for)126 1824 A
(copy)168 1992 A
(message)294 2202 A
2538(to)S
(SYSTASK.)336 2664 A
3042(*/)S
3690 V
(03671)210 648 A
(#define)294 1026 A
(SRC_SPACE)378 1362 A
(m5_c1)210 1992 A
2370(/*)S
2496(T)S
2580(or)S
2706(D)S
(space)210 2790 A
(\(stack)252 3042 A
3336(is)S
(also)168 3462 A
3672(D\))S
3798(*/)S
3780 V
(03672)210 648 A
(#define)294 1026 A
(SRC_PROC_NR)462 1362 A
(m5_i1)210 1992 A
2370(/*)S
(process)294 2496 A
2832(to)S
(copy)168 2958 A
(from)168 3168 A
3378(*/)S
3870 V
(03673)210 648 A
(#define)294 1026 A
(SRC_BUFFER)420 1362 A
(m5_l1)210 1992 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
(where)210 3168 A
(data)168 3420 A
(come)168 3630 A
(from)168 3840 A
4050(*/)S
3960 V
(03674)210 648 A
(#define)294 1026 A
(DST_SPACE)378 1362 A
(m5_c2)210 1992 A
2370(/*)S
2496(T)S
2580(or)S
2706(D)S
(space)210 2790 A
(\(stack)252 3042 A
3336(is)S
(also)168 3462 A
3672(D\))S
3798(*/)S
4050 V
(03675)210 648 A
(#define)294 1026 A
(DST_PROC_NR)462 1362 A
(m5_i2)210 1992 A
2370(/*)S
(process)294 2496 A
2832(to)S
(copy)168 2958 A
3168(to)S
3294(*/)S
4140 V
(03676)210 648 A
(#define)294 1026 A
(DST_BUFFER)420 1362 A
(m5_l2)210 1992 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
(where)210 3168 A
(data)168 3420 A
3630(go)S
3756(to)S
3882(*/)S
4230 V
(03677)210 648 A
(#define)294 1026 A
(COPY_BYTES)420 1362 A
(m5_l3)210 1992 A
2370(/*)S
(number)252 2496 A
2790(of)S
(bytes)210 2916 A
3168(to)S
(copy)168 3294 A
3504(*/)S
4320 V
(03678)210 648 A
4410 V
(03679)210 648 A
1026(/*)S
(Field)210 1152 A
(names)210 1404 A
(for)126 1656 A
(accounting,)462 1824 A
(SYSTASK)294 2328 A
(and)126 2664 A
(miscellaneous.)588 2832 A
3462(*/)S
4500 V
(03680)210 648 A
(#define)294 1026 A
(USER_TIME)378 1362 A
(m4_l1)210 1992 A
2370(/*)S
(user)168 2496 A
(time)168 2706 A
(consumed)336 2916 A
3294(by)S
(process)294 3420 A
3756(*/)S
4590 V
(03681)210 648 A
(#define)294 1026 A
(SYSTEM_TIME)462 1362 A
(m4_l2)210 1992 A
2370(/*)S
(system)252 2496 A
(time)168 2790 A
(consumed)336 3000 A
3378(by)S
(process)294 3504 A
3840(*/)S
4680 V
(03682)210 648 A
(#define)294 1026 A
(CHILD_UTIME)462 1362 A
(m4_l3)210 1992 A
2370(/*)S
(user)168 2496 A
(time)168 2706 A
(consumed)336 2916 A
3294(by)S
(process')336 3420 A
(children)336 3798 A
4176(*/)S
4770 V
(03683)210 648 A
(#define)294 1026 A
(CHILD_STIME)462 1362 A
(m4_l4)210 1992 A
2370(/*)S
(sys)126 2496 A
(time)168 2664 A
(consumed)336 2874 A
3252(by)S
(process')336 3378 A
(children)336 3756 A
4134(*/)S
4860 V
(03684)210 648 A
(#define)294 1026 A
(BOOT_TICKS)420 1362 A
(m4_l5)210 1992 A
2370(/*)S
(number)252 2496 A
2790(of)S
(clock)210 2916 A
(ticks)210 3168 A
(since)210 3420 A
(boot)168 3672 A
(time)168 3882 A
4092(*/)S
4950 V
(03685)210 648 A
5040 V
(03686)210 648 A
(#define)294 1026 A
(PROC1)210 1362 A
(m1_i1)210 1992 A
2370(/*)S
(indicates)378 2496 A
2916(a)S
(process)294 3000 A
3336(*/)S
5130 V
(03687)210 648 A
(#define)294 1026 A
(PROC2)210 1362 A
(m1_i2)210 1992 A
2370(/*)S
(indicates)378 2496 A
2916(a)S
(process)294 3000 A
3336(*/)S
5220 V
(03688)210 648 A
(#define)294 1026 A
(PID)126 1362 A
(m1_i3)210 1992 A
2370(/*)S
(process)294 2496 A
2832(id)S
(passed)252 2958 A
(from)168 3252 A
3462(MM)S
3588(to)S
(kernel)252 3714 A
4008(*/)S
5310 V
(03689)210 648 A
(#define)294 1026 A
(STACK_PTR)378 1362 A
(m1_p1)210 1992 A
2370(/*)S
(used)168 2496 A
(for)126 2706 A
(stack)210 2874 A
(ptr)126 3126 A
3294(in)S
(sys_exec,)378 3420 A
(sys_getsp)378 3840 A
4260(*/)S
5400 V
(03690)210 648 A
(#define)294 1026 A
1362(PR)S
(m6_i1)210 1992 A
2370(/*)S
(process)294 2496 A
(number)252 2832 A
(for)126 3126 A
(sys_sig)294 3294 A
3630(*/)S
5490 V
(03691)210 648 A
(#define)294 1026 A
(SIGNUM)252 1362 A
(m6_i2)210 1992 A
2370(/*)S
(signal)252 2496 A
(number)252 2790 A
(for)126 3084 A
(sys_sig)294 3252 A
3588(*/)S
5580 V
(03692)210 648 A
(#define)294 1026 A
(FUNC)168 1362 A
(m6_f1)210 1992 A
2370(/*)S
(function)336 2496 A
(pointer)294 2874 A
(for)126 3210 A
(sys_sig)294 3378 A
3714(*/)S
5670 V
(03693)210 648 A
(#define)294 1026 A
(MEM_PTR)294 1362 A
(m1_p1)210 1992 A
2370(/*)S
(tells)210 2496 A
(where)210 2748 A
(memory)252 3000 A
(map)126 3294 A
3462(is)S
(for)126 3588 A
(sys_newmap)420 3756 A
4218(*/)S
5760 V
(03694)210 648 A
(#define)294 1026 A
(NAME_PTR)336 1362 A
(m1_p2)210 1992 A
2370(/*)S
(tells)210 2496 A
(where)210 2748 A
(program)294 3000 A
(name)168 3336 A
3546(is)S
(for)126 3672 A
(dmp)126 3840 A
4008(*/)S
5850 V
(03695)210 648 A
(#define)294 1026 A
(IP_PTR)252 1362 A
(m1_p3)210 1992 A
2370(/*)S
(initial)294 2496 A
(value)210 2832 A
(for)126 3084 A
3252(ip)S
(after)210 3378 A
(exec)168 3630 A
3840(*/)S
5940 V
(03696)210 648 A
(#define)294 1026 A
(SIG_PROC)336 1362 A
(m2_i1)210 1992 A
2370(/*)S
(process)294 2496 A
(number)252 2832 A
(for)126 3126 A
(inform)252 3294 A
3588(*/)S
6030 V
(03697)210 648 A
(#define)294 1026 A
(SIG_MAP)294 1362 A
(m2_l1)210 1992 A
2370(/*)S
(used)168 2496 A
2706(by)S
(kernel)252 2832 A
(for)126 3126 A
(passing)294 3294 A
(signal)252 3630 A
(bit)126 3924 A
(map)126 4092 A
4260(*/)S
6120 V
(03698)210 648 A
(#define)294 1026 A
(SIG_MSG_PTR)462 1362 A
(m1_i1)210 1992 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(info)168 2958 A
3168(to)S
(build)210 3294 A
(sig)126 3546 A
(catch)210 3714 A
(stack)210 3966 A
4218(*/)S
6210 V
(03699)210 648 A
(#define)294 1026 A
(SIG_CTXT_PTR)504 1362 A
(m1_p1)210 1992 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(info)168 2958 A
3168(to)S
(restore)294 3294 A
(signal)252 3630 A
(context)294 3924 A
4260(*/)S
8418 V
EP
%%Page: 44 44
BP
/slant 0 def
/height 0 def
630 V
12 B
648(44)S
11 R
1958(File:)S
(include/minix/boot.h)926 2191 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(include/minix/boot.h)840 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(03700)210 648 A
1026(/*)S
(boot.h)252 1152 A
1446(*/)S
1440 V
(03701)210 648 A
1530 V
(03702)210 648 A
(#ifndef)294 1026 A
(_BOOT_H)294 1362 A
1620 V
(03703)210 648 A
(#define)294 1026 A
(_BOOT_H)294 1362 A
1710 V
(03704)210 648 A
1800 V
(03705)210 648 A
1026(/*)S
(Redefine)336 1152 A
(root)168 1530 A
(and)126 1740 A
(root)168 1908 A
(image)210 2118 A
(devices)294 2370 A
2706(as)S
(variables.)420 2832 A
1890 V
(03706)210 648 A
1068(*)S
(This)168 1152 A
(keeps)210 1362 A
(the)126 1614 A
(diffs)210 1782 A
(small)210 2034 A
(but)126 2286 A
(may)126 2454 A
(cause)210 2622 A
(future)252 2874 A
(confusion.)420 3168 A
1980 V
(03707)210 648 A
1068(*/)S
2070 V
(03708)210 648 A
(#define)294 1026 A
(ROOT_DEV)336 1362 A
(\(boot_parameters.bp_rootdev\))1176 1824 A
2160 V
(03709)210 648 A
(#define)294 1026 A
(IMAGE_DEV)378 1362 A
(\(boot_parameters.bp_ramimagedev\))1344 1824 A
2250 V
(03710)210 648 A
2340 V
(03711)210 648 A
1026(/*)S
(Device)252 1152 A
(numbers)294 1446 A
1782(of)S
(RAM,)168 1908 A
(floppy)252 2118 A
(and)126 2412 A
(hard)168 2580 A
(disk)168 2790 A
(devices.)336 3000 A
2430 V
(03712)210 648 A
1068(*)S
(h/com.h)294 1152 A
(defines)294 1488 A
(RAM_DEV)294 1824 A
(but)126 2160 A
(only)168 2328 A
2538(as)S
(the)126 2664 A
(minor)210 2832 A
(number.)294 3084 A
2520 V
(03713)210 648 A
1068(*/)S
2610 V
(03714)210 648 A
(#define)294 1026 A
(DEV_FD0)294 1362 A
(0x200)210 1782 A
2700 V
(03715)210 648 A
(#define)294 1026 A
(DEV_HD0)294 1362 A
(0x300)210 1782 A
2790 V
(03716)210 648 A
(#define)294 1026 A
(DEV_RAM)294 1362 A
(0x100)210 1782 A
2880 V
(03717)210 648 A
(#define)294 1026 A
(DEV_SCSI)336 1362 A
(0x700)210 1782 A
2034(/*)S
(Atari)210 2160 A
2412(TT)S
(only)168 2538 A
2748(*/)S
2970 V
(03718)210 648 A
3060 V
(03719)210 648 A
1026(/*)S
(Structure)378 1152 A
1572(to)S
(hold)168 1698 A
(boot)168 1908 A
(parameters.)462 2118 A
2622(*/)S
3150 V
(03720)210 648 A
(struct)252 1026 A
(bparam_s)336 1320 A
3240 V
(03721)210 648 A
1026({)S
3330 V
(03722)210 648 A
(dev_t)210 1110 A
(bp_rootdev;)462 1362 A
3420 V
(03723)210 648 A
(dev_t)210 1110 A
(bp_ramimagedev;)630 1362 A
3510 V
(03724)210 648 A
(unsigned)336 1110 A
(short)210 1488 A
(bp_ramsize;)462 1740 A
3600 V
(03725)210 648 A
(unsigned)336 1110 A
(short)210 1488 A
(bp_processor;)546 1740 A
3690 V
(03726)210 648 A
1026(};)S
3780 V
(03727)210 648 A
3870 V
(03728)210 648 A
(extern)252 1026 A
(struct)252 1320 A
(bparam_s)336 1614 A
(boot_parameters;)672 1992 A
3960 V
(03729)210 648 A
(#endif)252 1026 A
1320(/*)S
(_BOOT_H)294 1446 A
1782(*/)S
4590 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4680 V
(include/minix/keymap.h)924 2034 A
4770 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4950 V
(03800)210 648 A
1026(/*)S
(keymap.h)336 1362 A
1740(-)S
(defines)294 1824 A
(for)126 2160 A
(keymapping)420 2328 A
(Author:)294 3378 A
(Marcus)252 3714 A
(Hampel)252 4008 A
5040 V
(03801)210 648 A
1068(*/)S
5130 V
(03802)210 648 A
(#ifndef)294 1026 A
(_SYS__KEYMAP_H)588 1362 A
5220 V
(03803)210 648 A
(#define)294 1026 A
(_SYS__KEYMAP_H)588 1362 A
5310 V
(03804)210 648 A
5400 V
(03805)210 648 A
(#define)294 1026 A
(C\(c\))168 1362 A
(\(\(c\))168 1698 A
1908(&)S
(0x1F\))210 1992 A
2370(/*)S
(Map)126 2496 A
2664(to)S
(control)294 2790 A
(code)168 3126 A
3714(*/)S
5490 V
(03806)210 648 A
(#define)294 1026 A
(A\(c\))168 1362 A
(\(\(c\))168 1698 A
1908(|)S
(0x80\))210 1992 A
2370(/*)S
(Set)126 2496 A
(eight)210 2664 A
(bit)126 2916 A
(\(ALT\))210 3084 A
3714(*/)S
5580 V
(03807)210 648 A
(#define)294 1026 A
(CA\(c\))210 1362 A
(A\(C\(c\)\))294 1698 A
2370(/*)S
(Control-Alt)462 2496 A
3714(*/)S
5670 V
(03808)210 648 A
(#define)294 1026 A
(L\(c\))168 1362 A
(\(\(c\))168 1698 A
1908(|)S
(HASCAPS\))336 1992 A
2370(/*)S
(Add)126 2496 A
("Caps)210 2664 A
(Lock)168 2916 A
(has)126 3126 A
(effect")294 3294 A
(attribute)378 3630 A
4050(*/)S
5760 V
(03809)210 648 A
5850 V
(03810)210 648 A
(#define)294 1026 A
(EXT)126 1362 A
(0x0100)252 1698 A
2370(/*)S
(Normal)252 2496 A
(function)336 2790 A
(keys)168 3168 A
3714(*/)S
5940 V
(03811)210 648 A
(#define)294 1026 A
(CTRL)168 1362 A
(0x0200)252 1698 A
2370(/*)S
(Control)294 2496 A
(key)126 2832 A
3714(*/)S
6030 V
(03812)210 648 A
(#define)294 1026 A
(SHIFT)210 1362 A
(0x0400)252 1698 A
2370(/*)S
(Shift)210 2496 A
(key)126 2748 A
3714(*/)S
6120 V
(03813)210 648 A
(#define)294 1026 A
(ALT)126 1362 A
(0x0800)252 1698 A
2370(/*)S
(Alternate)378 2496 A
(key)126 2916 A
3714(*/)S
6210 V
(03814)210 648 A
(#define)294 1026 A
(EXTKEY)252 1362 A
(0x1000)252 1698 A
2370(/*)S
(extended)336 2496 A
(keycode)294 2874 A
3714(*/)S
8418 V
EP
%%Page: 45 45
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1881(File:)S
2114(include/minix/keymap.h)S
12 B
4308(45)S
900 V
7 LST
(03815)210 648 A
(#define)294 1026 A
(HASCAPS)294 1362 A
(0x8000)252 1698 A
2370(/*)S
(Caps)168 2496 A
(Lock)168 2706 A
(has)126 2916 A
(effect)252 3084 A
3714(*/)S
990 V
(03816)210 648 A
1080 V
(03817)210 648 A
1026(/*)S
(Numeric)294 1152 A
(keypad)252 1488 A
1782(*/)S
1170 V
(03818)210 648 A
(#define)294 1026 A
(HOME)168 1362 A
(\(0x01)210 1698 A
1950(+)S
(EXT\))168 2034 A
1260 V
(03819)210 648 A
(#define)294 1026 A
(END)126 1362 A
(\(0x02)210 1698 A
1950(+)S
(EXT\))168 2034 A
1350 V
(03820)210 648 A
(#define)294 1026 A
1362(UP)S
(\(0x03)210 1698 A
1950(+)S
(EXT\))168 2034 A
1440 V
(03821)210 648 A
(#define)294 1026 A
(DOWN)168 1362 A
(\(0x04)210 1698 A
1950(+)S
(EXT\))168 2034 A
1530 V
(03822)210 648 A
(#define)294 1026 A
(LEFT)168 1362 A
(\(0x05)210 1698 A
1950(+)S
(EXT\))168 2034 A
1620 V
(03823)210 648 A
(#define)294 1026 A
(RIGHT)210 1362 A
(\(0x06)210 1698 A
1950(+)S
(EXT\))168 2034 A
1710 V
(03824)210 648 A
(#define)294 1026 A
(PGUP)168 1362 A
(\(0x07)210 1698 A
1950(+)S
(EXT\))168 2034 A
1800 V
(03825)210 648 A
(#define)294 1026 A
(PGDN)168 1362 A
(\(0x08)210 1698 A
1950(+)S
(EXT\))168 2034 A
1890 V
(03826)210 648 A
(#define)294 1026 A
(MID)126 1362 A
(\(0x09)210 1698 A
1950(+)S
(EXT\))168 2034 A
1980 V
(03827)210 648 A
(#define)294 1026 A
(NMIN)168 1362 A
(\(0x0A)210 1698 A
1950(+)S
(EXT\))168 2034 A
2070 V
(03828)210 648 A
(#define)294 1026 A
(PLUS)168 1362 A
(\(0x0B)210 1698 A
1950(+)S
(EXT\))168 2034 A
2160 V
(03829)210 648 A
(#define)294 1026 A
(INSRT)210 1362 A
(\(0x0C)210 1698 A
1950(+)S
(EXT\))168 2034 A
2250 V
(03830)210 648 A
2340 V
(03831)210 648 A
1026(/*)S
(Alt)126 1152 A
1320(+)S
(Numeric)294 1404 A
(keypad)252 1740 A
2034(*/)S
2430 V
(03832)210 648 A
(#define)294 1026 A
(AHOME)210 1362 A
(\(0x01)210 1698 A
1950(+)S
(ALT\))168 2034 A
2520 V
(03833)210 648 A
(#define)294 1026 A
(AEND)168 1362 A
(\(0x02)210 1698 A
1950(+)S
(ALT\))168 2034 A
2610 V
(03834)210 648 A
(#define)294 1026 A
(AUP)126 1362 A
(\(0x03)210 1698 A
1950(+)S
(ALT\))168 2034 A
2700 V
(03835)210 648 A
(#define)294 1026 A
(ADOWN)210 1362 A
(\(0x04)210 1698 A
1950(+)S
(ALT\))168 2034 A
2790 V
(03836)210 648 A
(#define)294 1026 A
(ALEFT)210 1362 A
(\(0x05)210 1698 A
1950(+)S
(ALT\))168 2034 A
2880 V
(03837)210 648 A
(#define)294 1026 A
(ARIGHT)252 1362 A
(\(0x06)210 1698 A
1950(+)S
(ALT\))168 2034 A
2970 V
(03838)210 648 A
(#define)294 1026 A
(APGUP)210 1362 A
(\(0x07)210 1698 A
1950(+)S
(ALT\))168 2034 A
3060 V
(03839)210 648 A
(#define)294 1026 A
(APGDN)210 1362 A
(\(0x08)210 1698 A
1950(+)S
(ALT\))168 2034 A
3150 V
(03840)210 648 A
(#define)294 1026 A
(AMID)168 1362 A
(\(0x09)210 1698 A
1950(+)S
(ALT\))168 2034 A
3240 V
(03841)210 648 A
(#define)294 1026 A
(ANMIN)210 1362 A
(\(0x0A)210 1698 A
1950(+)S
(ALT\))168 2034 A
3330 V
(03842)210 648 A
(#define)294 1026 A
(APLUS)210 1362 A
(\(0x0B)210 1698 A
1950(+)S
(ALT\))168 2034 A
3420 V
(03843)210 648 A
(#define)294 1026 A
(AINSRT)252 1362 A
(\(0x0C)210 1698 A
1950(+)S
(ALT\))168 2034 A
3510 V
(03844)210 648 A
3600 V
(03845)210 648 A
1026(/*)S
(Ctrl)168 1152 A
1362(+)S
(Numeric)294 1446 A
(keypad)252 1782 A
2076(*/)S
3690 V
(03846)210 648 A
(#define)294 1026 A
(CHOME)210 1362 A
(\(0x01)210 1698 A
1950(+)S
(CTRL\))210 2034 A
3780 V
(03847)210 648 A
(#define)294 1026 A
(CEND)168 1362 A
(\(0x02)210 1698 A
1950(+)S
(CTRL\))210 2034 A
3870 V
(03848)210 648 A
(#define)294 1026 A
(CUP)126 1362 A
(\(0x03)210 1698 A
1950(+)S
(CTRL\))210 2034 A
3960 V
(03849)210 648 A
(#define)294 1026 A
(CDOWN)210 1362 A
(\(0x04)210 1698 A
1950(+)S
(CTRL\))210 2034 A
4050 V
(03850)210 648 A
(#define)294 1026 A
(CLEFT)210 1362 A
(\(0x05)210 1698 A
1950(+)S
(CTRL\))210 2034 A
4140 V
(03851)210 648 A
(#define)294 1026 A
(CRIGHT)252 1362 A
(\(0x06)210 1698 A
1950(+)S
(CTRL\))210 2034 A
4230 V
(03852)210 648 A
(#define)294 1026 A
(CPGUP)210 1362 A
(\(0x07)210 1698 A
1950(+)S
(CTRL\))210 2034 A
4320 V
(03853)210 648 A
(#define)294 1026 A
(CPGDN)210 1362 A
(\(0x08)210 1698 A
1950(+)S
(CTRL\))210 2034 A
4410 V
(03854)210 648 A
(#define)294 1026 A
(CMID)168 1362 A
(\(0x09)210 1698 A
1950(+)S
(CTRL\))210 2034 A
4500 V
(03855)210 648 A
(#define)294 1026 A
(CNMIN)210 1362 A
(\(0x0A)210 1698 A
1950(+)S
(CTRL\))210 2034 A
4590 V
(03856)210 648 A
(#define)294 1026 A
(CPLUS)210 1362 A
(\(0x0B)210 1698 A
1950(+)S
(CTRL\))210 2034 A
4680 V
(03857)210 648 A
(#define)294 1026 A
(CINSRT)252 1362 A
(\(0x0C)210 1698 A
1950(+)S
(CTRL\))210 2034 A
4770 V
(03858)210 648 A
4860 V
(03859)210 648 A
1026(/*)S
(Lock)168 1152 A
(keys)168 1362 A
1572(*/)S
4950 V
(03860)210 648 A
(#define)294 1026 A
(CALOCK)252 1362 A
(\(0x0D)210 1698 A
1950(+)S
(EXT\))168 2034 A
2370(/*)S
(caps)168 2496 A
(lock)168 2706 A
3042(*/)S
5040 V
(03861)210 648 A
(#define)294 1026 A
(NLOCK)210 1362 A
(\(0x0E)210 1698 A
1950(+)S
(EXT\))168 2034 A
2370(/*)S
(number)252 2496 A
(lock)168 2790 A
3042(*/)S
5130 V
(03862)210 648 A
(#define)294 1026 A
(SLOCK)210 1362 A
(\(0x0F)210 1698 A
1950(+)S
(EXT\))168 2034 A
2370(/*)S
(scroll)252 2496 A
(lock)168 2790 A
3042(*/)S
5220 V
(03863)210 648 A
5310 V
(03864)210 648 A
1026(/*)S
(Function)336 1152 A
(keys)168 1530 A
1740(*/)S
5400 V
(03865)210 648 A
(#define)294 1026 A
1362(F1)S
(\(0x10)210 1698 A
1950(+)S
(EXT\))168 2034 A
5490 V
(03866)210 648 A
(#define)294 1026 A
1362(F2)S
(\(0x11)210 1698 A
1950(+)S
(EXT\))168 2034 A
5580 V
(03867)210 648 A
(#define)294 1026 A
1362(F3)S
(\(0x12)210 1698 A
1950(+)S
(EXT\))168 2034 A
5670 V
(03868)210 648 A
(#define)294 1026 A
1362(F4)S
(\(0x13)210 1698 A
1950(+)S
(EXT\))168 2034 A
5760 V
(03869)210 648 A
(#define)294 1026 A
1362(F5)S
(\(0x14)210 1698 A
1950(+)S
(EXT\))168 2034 A
5850 V
(03870)210 648 A
(#define)294 1026 A
1362(F6)S
(\(0x15)210 1698 A
1950(+)S
(EXT\))168 2034 A
5940 V
(03871)210 648 A
(#define)294 1026 A
1362(F7)S
(\(0x16)210 1698 A
1950(+)S
(EXT\))168 2034 A
6030 V
(03872)210 648 A
(#define)294 1026 A
1362(F8)S
(\(0x17)210 1698 A
1950(+)S
(EXT\))168 2034 A
6120 V
(03873)210 648 A
(#define)294 1026 A
1362(F9)S
(\(0x18)210 1698 A
1950(+)S
(EXT\))168 2034 A
6210 V
(03874)210 648 A
(#define)294 1026 A
(F10)126 1362 A
(\(0x19)210 1698 A
1950(+)S
(EXT\))168 2034 A
8418 V
EP
%%Page: 46 46
BP
/slant 0 def
/height 0 def
630 V
12 B
648(46)S
11 R
1881(File:)S
2114(include/minix/keymap.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(03875)210 648 A
(#define)294 1026 A
(F11)126 1362 A
(\(0x1A)210 1698 A
1950(+)S
(EXT\))168 2034 A
990 V
(03876)210 648 A
(#define)294 1026 A
(F12)126 1362 A
(\(0x1B)210 1698 A
1950(+)S
(EXT\))168 2034 A
1080 V
(03877)210 648 A
1170 V
(03878)210 648 A
1026(/*)S
(Alt+Fn)252 1152 A
1446(*/)S
1260 V
(03879)210 648 A
(#define)294 1026 A
(AF1)126 1362 A
(\(0x10)210 1698 A
1950(+)S
(ALT\))168 2034 A
1350 V
(03880)210 648 A
(#define)294 1026 A
(AF2)126 1362 A
(\(0x11)210 1698 A
1950(+)S
(ALT\))168 2034 A
1440 V
(03881)210 648 A
(#define)294 1026 A
(AF3)126 1362 A
(\(0x12)210 1698 A
1950(+)S
(ALT\))168 2034 A
1530 V
(03882)210 648 A
(#define)294 1026 A
(AF4)126 1362 A
(\(0x13)210 1698 A
1950(+)S
(ALT\))168 2034 A
1620 V
(03883)210 648 A
(#define)294 1026 A
(AF5)126 1362 A
(\(0x14)210 1698 A
1950(+)S
(ALT\))168 2034 A
1710 V
(03884)210 648 A
(#define)294 1026 A
(AF6)126 1362 A
(\(0x15)210 1698 A
1950(+)S
(ALT\))168 2034 A
1800 V
(03885)210 648 A
(#define)294 1026 A
(AF7)126 1362 A
(\(0x16)210 1698 A
1950(+)S
(ALT\))168 2034 A
1890 V
(03886)210 648 A
(#define)294 1026 A
(AF8)126 1362 A
(\(0x17)210 1698 A
1950(+)S
(ALT\))168 2034 A
1980 V
(03887)210 648 A
(#define)294 1026 A
(AF9)126 1362 A
(\(0x18)210 1698 A
1950(+)S
(ALT\))168 2034 A
2070 V
(03888)210 648 A
(#define)294 1026 A
(AF10)168 1362 A
(\(0x19)210 1698 A
1950(+)S
(ALT\))168 2034 A
2160 V
(03889)210 648 A
(#define)294 1026 A
(AF11)168 1362 A
(\(0x1A)210 1698 A
1950(+)S
(ALT\))168 2034 A
2250 V
(03890)210 648 A
(#define)294 1026 A
(AF12)168 1362 A
(\(0x1B)210 1698 A
1950(+)S
(ALT\))168 2034 A
2340 V
(03891)210 648 A
2430 V
(03892)210 648 A
1026(/*)S
(Ctrl+Fn)294 1152 A
1488(*/)S
2520 V
(03893)210 648 A
(#define)294 1026 A
(CF1)126 1362 A
(\(0x10)210 1698 A
1950(+)S
(CTRL\))210 2034 A
2610 V
(03894)210 648 A
(#define)294 1026 A
(CF2)126 1362 A
(\(0x11)210 1698 A
1950(+)S
(CTRL\))210 2034 A
2700 V
(03895)210 648 A
(#define)294 1026 A
(CF3)126 1362 A
(\(0x12)210 1698 A
1950(+)S
(CTRL\))210 2034 A
2790 V
(03896)210 648 A
(#define)294 1026 A
(CF4)126 1362 A
(\(0x13)210 1698 A
1950(+)S
(CTRL\))210 2034 A
2880 V
(03897)210 648 A
(#define)294 1026 A
(CF5)126 1362 A
(\(0x14)210 1698 A
1950(+)S
(CTRL\))210 2034 A
2970 V
(03898)210 648 A
(#define)294 1026 A
(CF6)126 1362 A
(\(0x15)210 1698 A
1950(+)S
(CTRL\))210 2034 A
3060 V
(03899)210 648 A
(#define)294 1026 A
(CF7)126 1362 A
(\(0x16)210 1698 A
1950(+)S
(CTRL\))210 2034 A
3150 V
(03900)210 648 A
(#define)294 1026 A
(CF8)126 1362 A
(\(0x17)210 1698 A
1950(+)S
(CTRL\))210 2034 A
3240 V
(03901)210 648 A
(#define)294 1026 A
(CF9)126 1362 A
(\(0x18)210 1698 A
1950(+)S
(CTRL\))210 2034 A
3330 V
(03902)210 648 A
(#define)294 1026 A
(CF10)168 1362 A
(\(0x19)210 1698 A
1950(+)S
(CTRL\))210 2034 A
3420 V
(03903)210 648 A
(#define)294 1026 A
(CF11)168 1362 A
(\(0x1A)210 1698 A
1950(+)S
(CTRL\))210 2034 A
3510 V
(03904)210 648 A
(#define)294 1026 A
(CF12)168 1362 A
(\(0x1B)210 1698 A
1950(+)S
(CTRL\))210 2034 A
3600 V
(03905)210 648 A
3690 V
(03906)210 648 A
1026(/*)S
(Shift+Fn)336 1152 A
1530(*/)S
3780 V
(03907)210 648 A
(#define)294 1026 A
(SF1)126 1362 A
(\(0x10)210 1698 A
1950(+)S
(SHIFT\))252 2034 A
3870 V
(03908)210 648 A
(#define)294 1026 A
(SF2)126 1362 A
(\(0x11)210 1698 A
1950(+)S
(SHIFT\))252 2034 A
3960 V
(03909)210 648 A
(#define)294 1026 A
(SF3)126 1362 A
(\(0x12)210 1698 A
1950(+)S
(SHIFT\))252 2034 A
4050 V
(03910)210 648 A
(#define)294 1026 A
(SF4)126 1362 A
(\(0x13)210 1698 A
1950(+)S
(SHIFT\))252 2034 A
4140 V
(03911)210 648 A
(#define)294 1026 A
(SF5)126 1362 A
(\(0x14)210 1698 A
1950(+)S
(SHIFT\))252 2034 A
4230 V
(03912)210 648 A
(#define)294 1026 A
(SF6)126 1362 A
(\(0x15)210 1698 A
1950(+)S
(SHIFT\))252 2034 A
4320 V
(03913)210 648 A
(#define)294 1026 A
(SF7)126 1362 A
(\(0x16)210 1698 A
1950(+)S
(SHIFT\))252 2034 A
4410 V
(03914)210 648 A
(#define)294 1026 A
(SF8)126 1362 A
(\(0x17)210 1698 A
1950(+)S
(SHIFT\))252 2034 A
4500 V
(03915)210 648 A
(#define)294 1026 A
(SF9)126 1362 A
(\(0x18)210 1698 A
1950(+)S
(SHIFT\))252 2034 A
4590 V
(03916)210 648 A
(#define)294 1026 A
(SF10)168 1362 A
(\(0x19)210 1698 A
1950(+)S
(SHIFT\))252 2034 A
4680 V
(03917)210 648 A
(#define)294 1026 A
(SF11)168 1362 A
(\(0x1A)210 1698 A
1950(+)S
(SHIFT\))252 2034 A
4770 V
(03918)210 648 A
(#define)294 1026 A
(SF12)168 1362 A
(\(0x1B)210 1698 A
1950(+)S
(SHIFT\))252 2034 A
4860 V
(03919)210 648 A
4950 V
(03920)210 648 A
1026(/*)S
(Alt+Shift+Fn)504 1152 A
1698(*/)S
5040 V
(03921)210 648 A
(#define)294 1026 A
(ASF1)168 1362 A
(\(0x10)210 1698 A
1950(+)S
(ALT)126 2034 A
2202(+)S
(SHIFT\))252 2286 A
5130 V
(03922)210 648 A
(#define)294 1026 A
(ASF2)168 1362 A
(\(0x11)210 1698 A
1950(+)S
(ALT)126 2034 A
2202(+)S
(SHIFT\))252 2286 A
5220 V
(03923)210 648 A
(#define)294 1026 A
(ASF3)168 1362 A
(\(0x12)210 1698 A
1950(+)S
(ALT)126 2034 A
2202(+)S
(SHIFT\))252 2286 A
5310 V
(03924)210 648 A
(#define)294 1026 A
(ASF4)168 1362 A
(\(0x13)210 1698 A
1950(+)S
(ALT)126 2034 A
2202(+)S
(SHIFT\))252 2286 A
5400 V
(03925)210 648 A
(#define)294 1026 A
(ASF5)168 1362 A
(\(0x14)210 1698 A
1950(+)S
(ALT)126 2034 A
2202(+)S
(SHIFT\))252 2286 A
5490 V
(03926)210 648 A
(#define)294 1026 A
(ASF6)168 1362 A
(\(0x15)210 1698 A
1950(+)S
(ALT)126 2034 A
2202(+)S
(SHIFT\))252 2286 A
5580 V
(03927)210 648 A
(#define)294 1026 A
(ASF7)168 1362 A
(\(0x16)210 1698 A
1950(+)S
(ALT)126 2034 A
2202(+)S
(SHIFT\))252 2286 A
5670 V
(03928)210 648 A
(#define)294 1026 A
(ASF8)168 1362 A
(\(0x17)210 1698 A
1950(+)S
(ALT)126 2034 A
2202(+)S
(SHIFT\))252 2286 A
5760 V
(03929)210 648 A
(#define)294 1026 A
(ASF9)168 1362 A
(\(0x18)210 1698 A
1950(+)S
(ALT)126 2034 A
2202(+)S
(SHIFT\))252 2286 A
5850 V
(03930)210 648 A
(#define)294 1026 A
(ASF10)210 1362 A
(\(0x19)210 1698 A
1950(+)S
(ALT)126 2034 A
2202(+)S
(SHIFT\))252 2286 A
5940 V
(03931)210 648 A
(#define)294 1026 A
(ASF11)210 1362 A
(\(0x1A)210 1698 A
1950(+)S
(ALT)126 2034 A
2202(+)S
(SHIFT\))252 2286 A
6030 V
(03932)210 648 A
(#define)294 1026 A
(ASF12)210 1362 A
(\(0x1B)210 1698 A
1950(+)S
(ALT)126 2034 A
2202(+)S
(SHIFT\))252 2286 A
6120 V
(03933)210 648 A
6210 V
(03934)210 648 A
(#define)294 1026 A
(MAP_COLS)336 1362 A
2034(6)S
2370(/*)S
(Number)252 2496 A
2790(of)S
(columns)294 2916 A
3252(in)S
(keymap)252 3378 A
3672(*/)S
8418 V
EP
%%Page: 47 47
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1881(File:)S
2114(include/minix/keymap.h)S
12 B
4308(47)S
900 V
7 LST
(03935)210 648 A
(#define)294 1026 A
(NR_SCAN_CODES)546 1362 A
(0x80)168 2034 A
2370(/*)S
(Number)252 2496 A
2790(of)S
(scan)168 2916 A
(codes)210 3126 A
(\(rows)210 3378 A
3630(in)S
(keymap\))294 3756 A
4092(*/)S
990 V
(03936)210 648 A
1080 V
(03937)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(short)210 1740 A
(keymap_t[NR_SCAN_CODES)924 1992 A
2958(*)S
(MAP_COLS];)420 3042 A
1170 V
(03938)210 648 A
1260 V
(03939)210 648 A
(#define)294 1026 A
(KEY_MAGIC)378 1362 A
("KMAZ")252 2034 A
2370(/*)S
(Magic)210 2496 A
(number)252 2748 A
3042(of)S
(keymap)252 3168 A
(file)168 3462 A
3672(*/)S
1350 V
(03940)210 648 A
1440 V
(03941)210 648 A
(#endif)252 1026 A
1320(/*)S
(_SYS__KEYMAP_H)588 1446 A
2076(*/)S
1890 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1980 V
(include/minix/partition.h)1050 2034 A
2070 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2250 V
(04000)210 648 A
1026(/*)S
(minix/partition.h)714 1362 A
(Author:)294 3378 A
(Kees)168 3714 A
3924(J.)S
(Bot)126 4050 A
2340 V
(04001)210 648 A
1068(*)S
3714(7)S
(Dec)126 3798 A
(1995)168 3966 A
2430 V
(04002)210 648 A
1068(*)S
(Place)210 1152 A
1404(of)S
1530(a)S
(partition)378 1614 A
2034(on)S
(disk)168 2160 A
(and)126 2370 A
(the)126 2538 A
(disk)168 2706 A
(geometry,)378 2916 A
2520 V
(04003)210 648 A
1068(*)S
(for)126 1152 A
(use)126 1320 A
(with)168 1488 A
(the)126 1698 A
(DIOCGETP)336 1866 A
(and)126 2244 A
(DIOCSETP)336 2412 A
(ioctl's.)336 2790 A
2610 V
(04004)210 648 A
1068(*/)S
2700 V
(04005)210 648 A
(#ifndef)294 1026 A
(_MINIX__PARTITION_H)798 1362 A
2790 V
(04006)210 648 A
(#define)294 1026 A
(_MINIX__PARTITION_H)798 1362 A
2880 V
(04007)210 648 A
2970 V
(04008)210 648 A
(struct)252 1026 A
(partition)378 1320 A
1740({)S
3060 V
(04009)210 648 A
(u32_t)210 1110 A
(base;)210 1362 A
2034(/*)S
(byte)168 2160 A
(offset)252 2370 A
2664(to)S
(the)126 2790 A
(partition)378 2958 A
(start)210 3378 A
3630(*/)S
3150 V
(04010)210 648 A
(u32_t)210 1110 A
(size;)210 1362 A
2034(/*)S
(number)252 2160 A
2454(of)S
(bytes)210 2580 A
2832(in)S
(the)126 2958 A
(partition)378 3126 A
3546(*/)S
3240 V
(04011)210 648 A
(unsigned)336 1110 A
(cylinders;)420 1488 A
2034(/*)S
(disk)168 2160 A
(geometry)336 2370 A
2748(*/)S
3330 V
(04012)210 648 A
(unsigned)336 1110 A
(heads;)252 1488 A
3420 V
(04013)210 648 A
(unsigned)336 1110 A
(sectors;)336 1488 A
3510 V
(04014)210 648 A
1026(};)S
3600 V
(04015)210 648 A
(#endif)252 1026 A
1320(/*)S
(_MINIX__PARTITION_H)798 1446 A
2286(*/)S
4140 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4230 V
(include/ibm/partition.h)966 2034 A
4320 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4500 V
(04100)210 648 A
1026(/*)S
(Description)462 1152 A
1656(of)S
(entry)210 1782 A
2034(in)S
(partition)378 2160 A
(table.)252 2580 A
2916(*/)S
4590 V
(04101)210 648 A
(#ifndef)294 1026 A
(_PARTITION_H)504 1362 A
4680 V
(04102)210 648 A
(#define)294 1026 A
(_PARTITION_H)504 1362 A
4770 V
(04103)210 648 A
4860 V
(04104)210 648 A
(struct)252 1026 A
(part_entry)420 1320 A
1782({)S
4950 V
(04105)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(bootind;)336 1698 A
2370(/*)S
(boot)168 2496 A
(indicator)378 2706 A
(0/ACTIVE_FLAG)546 3126 A
3756(*/)S
5040 V
(04106)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(start_head;)462 1698 A
2370(/*)S
(head)168 2496 A
(value)210 2706 A
(for)126 2958 A
(first)210 3126 A
(sector)252 3378 A
3756(*/)S
5130 V
(04107)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(start_sec;)420 1698 A
2370(/*)S
(sector)252 2496 A
(value)210 2790 A
3042(+)S
(cyl)126 3126 A
(bits)168 3294 A
(for)126 3504 A
(first)210 3672 A
(sector)252 3924 A
4218(*/)S
5220 V
(04108)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(start_cyl;)420 1698 A
2370(/*)S
(track)210 2496 A
(value)210 2748 A
(for)126 3000 A
(first)210 3168 A
(sector)252 3420 A
3756(*/)S
5310 V
(04109)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(sysind;)294 1698 A
2370(/*)S
(system)252 2496 A
(indicator)378 2790 A
3756(*/)S
5400 V
(04110)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(last_head;)420 1698 A
2370(/*)S
(head)168 2496 A
(value)210 2706 A
(for)126 2958 A
(last)168 3126 A
(sector)252 3336 A
3756(*/)S
5490 V
(04111)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(last_sec;)378 1698 A
2370(/*)S
(sector)252 2496 A
(value)210 2790 A
3042(+)S
(cyl)126 3126 A
(bits)168 3294 A
(for)126 3504 A
(last)168 3672 A
(sector)252 3882 A
4176(*/)S
5580 V
(04112)210 648 A
(unsigned)336 1110 A
(char)168 1488 A
(last_cyl;)378 1698 A
2370(/*)S
(track)210 2496 A
(value)210 2748 A
(for)126 3000 A
(last)168 3168 A
(sector)252 3378 A
3756(*/)S
5670 V
(04113)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(lowsec;)294 1698 A
2370(/*)S
(logical)294 2496 A
(first)210 2832 A
(sector)252 3084 A
3756(*/)S
5760 V
(04114)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(size;)210 1698 A
2370(/*)S
(size)168 2496 A
2706(of)S
(partition)378 2832 A
3252(in)S
(sectors)294 3378 A
3756(*/)S
5850 V
(04115)210 648 A
1026(};)S
5940 V
(04116)210 648 A
6030 V
(04117)210 648 A
(#define)294 1026 A
(ACTIVE_FLAG)462 1362 A
(0x80)168 2034 A
2370(/*)S
(value)210 2496 A
(for)126 2748 A
(active)252 2916 A
3210(in)S
(bootind)294 3336 A
(field)210 3672 A
(\(hd0\))210 3924 A
4176(*/)S
6120 V
(04118)210 648 A
(#define)294 1026 A
(NR_PARTITIONS)546 1362 A
2034(4)S
2370(/*)S
(number)252 2496 A
2790(of)S
(entries)294 2916 A
3252(in)S
(partition)378 3378 A
(table)210 3798 A
4050(*/)S
6210 V
(04119)210 648 A
(#define)294 1026 A
(PART_TABLE_OFF)588 1362 A
(0x1BE)210 2034 A
2370(/*)S
(offset)252 2496 A
2790(of)S
(partition)378 2916 A
(table)210 3336 A
3588(in)S
(boot)168 3714 A
(sector)252 3924 A
4218(*/)S
8418 V
EP
%%Page: 48 48
BP
/slant 0 def
/height 0 def
630 V
12 B
648(48)S
11 R
1911(File:)S
(include/ibm/partition.h)1020 2144 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(04120)210 648 A
990 V
(04121)210 648 A
1026(/*)S
(Partition)378 1152 A
(types.)252 1572 A
1866(*/)S
1080 V
(04122)210 648 A
(#define)294 1026 A
(MINIX_PART)420 1362 A
(0x81)168 2034 A
2370(/*)S
(Minix)210 2496 A
(partition)378 2748 A
(type)168 3168 A
3378(*/)S
1170 V
(04123)210 648 A
(#define)294 1026 A
(NO_PART)294 1362 A
(0x00)168 2034 A
2370(/*)S
(unused)252 2496 A
(entry)210 2790 A
3042(*/)S
1260 V
(04124)210 648 A
(#define)294 1026 A
(OLD_MINIX_PART)588 1362 A
(0x80)168 2034 A
2370(/*)S
(created)294 2496 A
(before)252 2832 A
(1.4b,)210 3126 A
(obsolete)336 3378 A
3756(*/)S
1350 V
(04125)210 648 A
(#define)294 1026 A
(EXT_PART)336 1362 A
(0x05)168 2034 A
2370(/*)S
(extended)336 2496 A
(partition)378 2874 A
3294(*/)S
1440 V
(04126)210 648 A
1530 V
(04127)210 648 A
(#endif)252 1026 A
1320(/*)S
(_PARTITION_H)504 1446 A
1992(*/)S
1890 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1980 V
(src/kernel/kernel.h)798 2034 A
2070 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2250 V
(04200)210 648 A
1026(/*)S
(This)168 1152 A
1362(is)S
(the)126 1488 A
(master)252 1656 A
(header)252 1950 A
(for)126 2244 A
(the)126 2412 A
(kernel.)294 2580 A
2958(It)S
(includes)336 3084 A
(some)168 3462 A
(other)210 3672 A
(files)210 3924 A
2340 V
(04201)210 648 A
1068(*)S
(and)126 1152 A
(defines)294 1320 A
(the)126 1656 A
(principal)378 1824 A
(constants.)420 2244 A
2430 V
(04202)210 648 A
1068(*/)S
2520 V
(04203)210 648 A
(#define)294 1026 A
(_POSIX_SOURCE)546 1362 A
2160(1)S
2370(/*)S
(tell)168 2496 A
(headers)294 2706 A
3042(to)S
(include)294 3168 A
(POSIX)210 3504 A
(stuff)210 3756 A
4008(*/)S
2610 V
(04204)210 648 A
(#define)294 1026 A
(_MINIX)252 1362 A
2160(1)S
2370(/*)S
(tell)168 2496 A
(headers)294 2706 A
3042(to)S
(include)294 3168 A
(MINIX)210 3504 A
(stuff)210 3756 A
4008(*/)S
2700 V
(04205)210 648 A
(#define)294 1026 A
(_SYSTEM)294 1362 A
2160(1)S
2370(/*)S
(tell)168 2496 A
(headers)294 2706 A
(that)168 3042 A
(this)168 3252 A
3462(is)S
(the)126 3588 A
(kernel)252 3756 A
4050(*/)S
2790 V
(04206)210 648 A
2880 V
(04207)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(are)126 1740 A
1908(so)S
(basic,)252 2034 A
(all)126 2328 A
(the)126 2496 A
(*.c)126 2664 A
(files)210 2832 A
(get)126 3084 A
(them)168 3252 A
(automatically.)588 3462 A
4092(*/)S
2970 V
(04208)210 648 A
(#include)336 1026 A
(<minix/config.h>)672 1404 A
2370(/*)S
(MUST)168 2496 A
2706(be)S
(first)210 2832 A
3084(*/)S
3060 V
(04209)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
2370(/*)S
(MUST)168 2496 A
2706(be)S
(second)252 2832 A
3126(*/)S
3150 V
(04210)210 648 A
(#include)336 1026 A
(<sys/types.h>)546 1404 A
3240 V
(04211)210 648 A
(#include)336 1026 A
(<minix/const.h>)630 1404 A
3330 V
(04212)210 648 A
(#include)336 1026 A
(<minix/type.h>)588 1404 A
3420 V
(04213)210 648 A
(#include)336 1026 A
(<minix/syslib.h>)672 1404 A
3510 V
(04214)210 648 A
3600 V
(04215)210 648 A
(#include)336 1026 A
(<string.h>)420 1404 A
3690 V
(04216)210 648 A
(#include)336 1026 A
(<limits.h>)420 1404 A
3780 V
(04217)210 648 A
(#include)336 1026 A
(<errno.h>)378 1404 A
3870 V
(04218)210 648 A
3960 V
(04219)210 648 A
(#include)336 1026 A
("const.h")378 1404 A
4050 V
(04220)210 648 A
(#include)336 1026 A
("type.h")336 1404 A
4140 V
(04221)210 648 A
(#include)336 1026 A
("proto.h")378 1404 A
4230 V
(04222)210 648 A
(#include)336 1026 A
("glo.h")294 1404 A
4590 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4680 V
(src/kernel/const.h)756 2034 A
4770 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4950 V
(04300)210 648 A
1026(/*)S
(General)294 1152 A
(constants)378 1488 A
(used)168 1908 A
2118(by)S
(the)126 2244 A
(kernel.)294 2412 A
2748(*/)S
5040 V
(04301)210 648 A
5130 V
(04302)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
5220 V
(04303)210 648 A
5310 V
(04304)210 648 A
(#define)294 1026 A
(K_STACK_BYTES)546 1362 A
(1024)168 2034 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(bytes)210 2874 A
(for)126 3126 A
(the)126 3294 A
(kernel)252 3462 A
(stack)210 3756 A
4008(*/)S
5400 V
(04305)210 648 A
5490 V
(04306)210 648 A
(#define)294 1026 A
(INIT_PSW)336 1362 A
(0x0200)252 1950 A
2370(/*)S
(initial)294 2496 A
(psw)126 2832 A
3000(*/)S
5580 V
(04307)210 648 A
(#define)294 1026 A
(INIT_TASK_PSW)546 1362 A
(0x1200)252 1950 A
2370(/*)S
(initial)294 2496 A
(psw)126 2832 A
(for)126 3000 A
(tasks)210 3168 A
(\(with)210 3420 A
(IOPL)168 3672 A
3882(1\))S
4008(*/)S
5670 V
(04308)210 648 A
(#define)294 1026 A
(TRACEBIT)336 1362 A
(0x100)210 1992 A
2370(/*)S
2496(OR)S
(this)168 2622 A
(with)168 2832 A
(psw)126 3042 A
3210(in)S
(proc[])252 3336 A
(for)126 3630 A
(tracing)294 3798 A
4134(*/)S
5760 V
(04309)210 648 A
(#define)294 1026 A
(SETPSW\(rp,)420 1362 A
(new\))168 1824 A
2034(/*)S
(permits)294 2160 A
(only)168 2496 A
(certain)294 2706 A
(bits)168 3042 A
3252(to)S
3378(be)S
(set)126 3504 A
3672(*/)S
3798(\\)S
5850 V
(04310)210 648 A
(\(\(rp\)->p_reg.psw)672 1362 A
2076(=)S
(\(rp\)->p_reg.psw)630 2160 A
2832(&)S
(\3040xCD5)252 2916 A
3210(|)S
(\(new\))210 3294 A
3546(&)S
(0xCD5\))252 3630 A
5940 V
(04311)210 648 A
6030 V
(04312)210 648 A
1026(/*)S
(Initial)294 1152 A
1488(sp)S
(for)126 1614 A
(mm,)126 1782 A
1950(fs)S
(and)126 2076 A
(init.)210 2244 A
6120 V
(04313)210 648 A
1068(*)S
1362(2)S
(bytes)210 1446 A
(for)126 1698 A
(short)210 1866 A
(jump)168 2118 A
6210 V
(04314)210 648 A
1068(*)S
1362(2)S
(bytes)210 1446 A
(unused)252 1698 A
8418 V
EP
%%Page: 49 49
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2028(File:)S
2261(src/kernel/const.h)S
12 B
4308(49)S
900 V
7 LST
(04315)210 648 A
1068(*)S
1362(3)S
(words)210 1446 A
(for)126 1698 A
(init_org[])420 1866 A
(used)168 2328 A
2538(by)S
2664(fs)S
(only)168 2790 A
990 V
(04316)210 648 A
1068(*)S
1362(3)S
(words)210 1446 A
(for)126 1698 A
(real)168 1866 A
(mode)168 2076 A
(debugger)336 2286 A
(trap)168 2664 A
(\(actually)378 2874 A
(needs)210 3294 A
3546(1)S
(more\))210 3630 A
1080 V
(04317)210 648 A
1068(*)S
1362(3)S
(words)210 1446 A
(for)126 1698 A
(save)168 1866 A
(and)126 2076 A
(restart)294 2244 A
(temporaries)462 2580 A
1170 V
(04318)210 648 A
1068(*)S
1362(3)S
(words)210 1446 A
(for)126 1698 A
(interrupt)378 1866 A
1260 V
(04319)210 648 A
1068(*)S
(Leave)210 1152 A
1404(no)S
(margin,)294 1530 A
1866(to)S
(flush)210 1992 A
(bugs)168 2244 A
(early.)252 2454 A
1350 V
(04320)210 648 A
1068(*/)S
1440 V
(04321)210 648 A
(#define)294 1026 A
(INIT_SP)294 1362 A
1698(\(2)S
1824(+)S
1908(2)S
1992(+)S
2076(3)S
2160(*)S
2244(2)S
2328(+)S
2412(3)S
2496(*)S
2580(2)S
2664(+)S
2748(3)S
2832(*)S
2916(2)S
3000(+)S
3084(3)S
3168(*)S
3252(2\))S
1530 V
(04322)210 648 A
1620 V
(04323)210 648 A
(#define)294 1026 A
(HCLICK_SHIFT)504 1362 A
2160(4)S
2370(/*)S
(log2)168 2496 A
2706(of)S
(HCLICK_SIZE)462 2832 A
3336(*/)S
1710 V
(04324)210 648 A
(#define)294 1026 A
(HCLICK_SIZE)462 1362 A
2118(16)S
2370(/*)S
(hardware)336 2496 A
(segment)294 2874 A
(conversion)420 3210 A
(magic)210 3672 A
3924(*/)S
1800 V
(04325)210 648 A
(#if)126 1026 A
(CLICK_SIZE)420 1194 A
1656(>=)S
(HCLICK_SIZE)462 1782 A
1890 V
(04326)210 648 A
(#define)294 1026 A
(click_to_hclick\(n\))756 1362 A
(\(\(n\))168 2160 A
2370(<<)S
(\(CLICK_SHIFT)504 2496 A
3042(-)S
(HCLICK_SHIFT\)\))588 3126 A
1980 V
(04327)210 648 A
(#else)210 1026 A
2070 V
(04328)210 648 A
(#define)294 1026 A
(click_to_hclick\(n\))756 1362 A
(\(\(n\))168 2160 A
2370(>>)S
(\(HCLICK_SHIFT)546 2496 A
3084(-)S
(CLICK_SHIFT\)\))546 3168 A
2160 V
(04329)210 648 A
(#endif)252 1026 A
2250 V
(04330)210 648 A
(#define)294 1026 A
(hclick_to_physb\(n\))756 1362 A
(\(\(phys_bytes\))546 2160 A
(\(n\))126 2748 A
2916(<<)S
(HCLICK_SHIFT\))546 3042 A
2340 V
(04331)210 648 A
(#define)294 1026 A
(physb_to_hclick\(n\))756 1362 A
(\(\(n\))168 2160 A
2370(>>)S
(HCLICK_SHIFT\))546 2496 A
2430 V
(04332)210 648 A
2520 V
(04333)210 648 A
1026(/*)S
(Interrupt)378 1152 A
(vectors)294 1572 A
(defined/reserved)672 1908 A
2622(by)S
(processor.)420 2748 A
3210(*/)S
2610 V
(04334)210 648 A
(#define)294 1026 A
(DIVIDE_VECTOR)546 1362 A
2160(0)S
2370(/*)S
(divide)252 2496 A
(error)210 2790 A
3042(*/)S
2700 V
(04335)210 648 A
(#define)294 1026 A
(DEBUG_VECTOR)504 1362 A
2160(1)S
2370(/*)S
(single)252 2496 A
(step)168 2790 A
(\(trace\))294 3000 A
3336(*/)S
2790 V
(04336)210 648 A
(#define)294 1026 A
(NMI_VECTOR)420 1362 A
2160(2)S
2370(/*)S
(non-maskable)504 2496 A
(interrupt)378 3042 A
3462(*/)S
2880 V
(04337)210 648 A
(#define)294 1026 A
(BREAKPOINT_VECTOR)714 1362 A
2160(3)S
2370(/*)S
(software)336 2496 A
(breakpoint)420 2874 A
3336(*/)S
2970 V
(04338)210 648 A
(#define)294 1026 A
(OVERFLOW_VECTOR)630 1362 A
2160(4)S
2370(/*)S
(from)168 2496 A
(INTO)168 2706 A
2916(*/)S
3060 V
(04339)210 648 A
3150 V
(04340)210 648 A
1026(/*)S
(Fixed)210 1152 A
(system)252 1404 A
(call)168 1698 A
(vector.)294 1908 A
2244(*/)S
3240 V
(04341)210 648 A
(#define)294 1026 A
(SYS_VECTOR)420 1362 A
2118(32)S
2370(/*)S
(system)252 2496 A
(calls)210 2790 A
(are)126 3042 A
(made)168 3210 A
(with)168 3420 A
(int)126 3630 A
(SYSVEC)252 3798 A
4092(*/)S
3330 V
(04342)210 648 A
(#define)294 1026 A
(SYS386_VECTOR)546 1362 A
2118(33)S
2370(/*)S
(except)252 2496 A
(386)126 2790 A
(system)252 2958 A
(calls)210 3252 A
(use)126 3504 A
(this)168 3672 A
3882(*/)S
3420 V
(04343)210 648 A
(#define)294 1026 A
(LEVEL0_VECTOR)546 1362 A
2118(34)S
2370(/*)S
(for)126 2496 A
(execution)378 2664 A
3084(of)S
3210(a)S
(function)336 3294 A
3672(at)S
(level)210 3798 A
4050(0)S
4134(*/)S
3510 V
(04344)210 648 A
3600 V
(04345)210 648 A
1026(/*)S
(Suitable)336 1152 A
(irq)126 1530 A
(bases)210 1698 A
(for)126 1950 A
(hardware)336 2118 A
(interrupts.)462 2496 A
(Reprogram)378 3042 A
(the)126 3462 A
(8259\(s\))294 3630 A
(from)168 3966 A
3690 V
(04346)210 648 A
1068(*)S
(the)126 1152 A
1320(PC)S
(BIOS)168 1446 A
(defaults)336 1656 A
(since)210 2034 A
(the)126 2286 A
(BIOS)168 2454 A
(doesn't)294 2664 A
(respect)294 3000 A
(all)126 3336 A
(the)126 3504 A
(processor's)462 3672 A
3780 V
(04347)210 648 A
1068(*)S
(reserved)336 1152 A
(vectors)294 1530 A
1866(\(0)S
1992(to)S
(31\).)168 2118 A
3870 V
(04348)210 648 A
1068(*/)S
3960 V
(04349)210 648 A
(#define)294 1026 A
(BIOS_IRQ0_VEC)546 1362 A
(0x08)168 2034 A
2370(/*)S
(base)168 2496 A
2706(of)S
(IRQ0-7)252 2832 A
(vectors)294 3126 A
(used)168 3462 A
3672(by)S
(BIOS)168 3798 A
4008(*/)S
4050 V
(04350)210 648 A
(#define)294 1026 A
(BIOS_IRQ8_VEC)546 1362 A
(0x70)168 2034 A
2370(/*)S
(base)168 2496 A
2706(of)S
(IRQ8-15)294 2832 A
(vectors)294 3168 A
(used)168 3504 A
3714(by)S
(BIOS)168 3840 A
4050(*/)S
4140 V
(04351)210 648 A
(#define)294 1026 A
(IRQ0_VECTOR)462 1362 A
(0x28)168 2034 A
2370(/*)S
(more)168 2496 A
2706(or)S
(less)168 2832 A
(arbitrary,)420 3042 A
(but)126 3504 A
3672(>)S
(SYS_VECTOR)420 3756 A
4218(*/)S
4230 V
(04352)210 648 A
(#define)294 1026 A
(IRQ8_VECTOR)462 1362 A
(0x30)168 2034 A
2370(/*)S
(together)336 2496 A
(for)126 2874 A
(simplicity)420 3042 A
3504(*/)S
4320 V
(04353)210 648 A
4410 V
(04354)210 648 A
1026(/*)S
(Hardware)336 1152 A
(interrupt)378 1530 A
(numbers.)336 1950 A
2328(*/)S
4500 V
(04355)210 648 A
(#define)294 1026 A
(NR_IRQ_VECTORS)588 1362 A
2118(16)S
4590 V
(04356)210 648 A
(#define)294 1026 A
(CLOCK_IRQ)378 1362 A
2160(0)S
4680 V
(04357)210 648 A
(#define)294 1026 A
(KEYBOARD_IRQ)504 1362 A
2160(1)S
4770 V
(04358)210 648 A
(#define)294 1026 A
(CASCADE_IRQ)462 1362 A
2160(2)S
2370(/*)S
(cascade)294 2496 A
(enable)252 2832 A
(for)126 3126 A
(2nd)126 3294 A
3462(AT)S
(controller)420 3588 A
4050(*/)S
4860 V
(04359)210 648 A
(#define)294 1026 A
(ETHER_IRQ)378 1362 A
2160(3)S
2370(/*)S
(default)294 2496 A
(ethernet)336 2832 A
(interrupt)378 3210 A
(vector)252 3630 A
3924(*/)S
4950 V
(04360)210 648 A
(#define)294 1026 A
(SECONDARY_IRQ)546 1362 A
2160(3)S
2370(/*)S
(RS232)210 2496 A
(interrupt)378 2748 A
(vector)252 3168 A
(for)126 3462 A
(port)168 3630 A
3840(2)S
3924(*/)S
5040 V
(04361)210 648 A
(#define)294 1026 A
(RS232_IRQ)378 1362 A
2160(4)S
2370(/*)S
(RS232)210 2496 A
(interrupt)378 2748 A
(vector)252 3168 A
(for)126 3462 A
(port)168 3630 A
3840(1)S
3924(*/)S
5130 V
(04362)210 648 A
(#define)294 1026 A
(XT_WINI_IRQ)462 1362 A
2160(5)S
2370(/*)S
2496(xt)S
(winchester)420 2622 A
3084(*/)S
5220 V
(04363)210 648 A
(#define)294 1026 A
(FLOPPY_IRQ)420 1362 A
2160(6)S
2370(/*)S
(floppy)252 2496 A
(disk)168 2790 A
3000(*/)S
5310 V
(04364)210 648 A
(#define)294 1026 A
(PRINTER_IRQ)462 1362 A
2160(7)S
5400 V
(04365)210 648 A
(#define)294 1026 A
(AT_WINI_IRQ)462 1362 A
2118(14)S
2370(/*)S
2496(at)S
(winchester)420 2622 A
3084(*/)S
5490 V
(04366)210 648 A
5580 V
(04367)210 648 A
1026(/*)S
(Interrupt)378 1152 A
(number)252 1572 A
1866(to)S
(hardware)336 1992 A
(vector.)294 2370 A
2706(*/)S
5670 V
(04368)210 648 A
(#define)294 1026 A
(BIOS_VECTOR\(irq\))672 1362 A
2370(\\)S
5760 V
(04369)210 648 A
(\(\(\(irq\))294 1362 A
1698(<)S
1782(8)S
1866(?)S
(BIOS_IRQ0_VEC)546 1950 A
2538(:)S
(BIOS_IRQ8_VEC\))588 2622 A
3252(+)S
(\(\(irq\))252 3336 A
3630(&)S
(0x07\)\))252 3714 A
5850 V
(04370)210 648 A
(#define)294 1026 A
(VECTOR\(irq\))462 1362 A
2034(\\)S
5940 V
(04371)210 648 A
(\(\(\(irq\))294 1362 A
1698(<)S
1782(8)S
1866(?)S
(IRQ0_VECTOR)462 1950 A
2454(:)S
(IRQ8_VECTOR\))504 2538 A
3084(+)S
(\(\(irq\))252 3168 A
3462(&)S
(0x07\)\))252 3546 A
6030 V
(04372)210 648 A
6120 V
(04373)210 648 A
1026(/*)S
(BIOS)168 1152 A
(hard)168 1362 A
(disk)168 1572 A
(parameter)378 1782 A
(vectors.)336 2202 A
2580(*/)S
6210 V
(04374)210 648 A
(#define)294 1026 A
(WINI_0_PARM_VEC)630 1362 A
(0x41)168 2034 A
8418 V
EP
%%Page: 50 50
BP
/slant 0 def
/height 0 def
630 V
12 B
648(50)S
11 R
2028(File:)S
2261(src/kernel/const.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(04375)210 648 A
(#define)294 1026 A
(WINI_1_PARM_VEC)630 1362 A
(0x46)168 2034 A
990 V
(04376)210 648 A
1080 V
(04377)210 648 A
1026(/*)S
(8259A)210 1152 A
(interrupt)378 1404 A
(controller)420 1824 A
(ports.)252 2286 A
2580(*/)S
1170 V
(04378)210 648 A
(#define)294 1026 A
(INT_CTL)294 1362 A
(0x20)168 2034 A
2370(/*)S
(I/O)126 2496 A
(port)168 2664 A
(for)126 2874 A
(interrupt)378 3042 A
(controller)420 3462 A
3924(*/)S
1260 V
(04379)210 648 A
(#define)294 1026 A
(INT_CTLMASK)462 1362 A
(0x21)168 2034 A
2370(/*)S
(setting)294 2496 A
(bits)168 2832 A
3042(in)S
(this)168 3168 A
(port)168 3378 A
(disables)336 3588 A
(ints)168 3966 A
4176(*/)S
1350 V
(04380)210 648 A
(#define)294 1026 A
(INT2_CTL)336 1362 A
(0xA0)168 2034 A
2370(/*)S
(I/O)126 2496 A
(port)168 2664 A
(for)126 2874 A
(second)252 3042 A
(interrupt)378 3336 A
(controller)420 3756 A
4218(*/)S
1440 V
(04381)210 648 A
(#define)294 1026 A
(INT2_CTLMASK)504 1362 A
(0xA1)168 2034 A
2370(/*)S
(setting)294 2496 A
(bits)168 2832 A
3042(in)S
(this)168 3168 A
(port)168 3378 A
(disables)336 3588 A
(ints)168 3966 A
4176(*/)S
1530 V
(04382)210 648 A
1620 V
(04383)210 648 A
1026(/*)S
(Magic)210 1152 A
(numbers)294 1404 A
(for)126 1740 A
(interrupt)378 1908 A
(controller.)462 2328 A
2832(*/)S
1710 V
(04384)210 648 A
(#define)294 1026 A
(ENABLE)252 1362 A
(0x20)168 2034 A
2370(/*)S
(code)168 2496 A
(used)168 2706 A
2916(to)S
(re-enable)378 3042 A
(after)210 3462 A
3714(an)S
(interrupt)378 3840 A
4260(*/)S
1800 V
(04385)210 648 A
1890 V
(04386)210 648 A
1026(/*)S
(Sizes)210 1152 A
1404(of)S
(memory)252 1530 A
(tables.)294 1824 A
2160(*/)S
1980 V
(04387)210 648 A
(#define)294 1026 A
(NR_MEMS)294 1362 A
2160(3)S
2370(/*)S
(number)252 2496 A
2790(of)S
(chunks)252 2916 A
3210(of)S
(memory)252 3336 A
3630(*/)S
2070 V
(04388)210 648 A
2160 V
(04389)210 648 A
1026(/*)S
(Miscellaneous)546 1152 A
(ports.)252 1740 A
2034(*/)S
2250 V
(04390)210 648 A
(#define)294 1026 A
(PCR)126 1362 A
(0x65)168 2034 A
2370(/*)S
(Planar)252 2496 A
(Control)294 2790 A
(Register)336 3126 A
3504(*/)S
2340 V
(04391)210 648 A
(#define)294 1026 A
(PORT_B)252 1362 A
(0x61)168 2034 A
2370(/*)S
(I/O)126 2496 A
(port)168 2664 A
(for)126 2874 A
(8255)168 3042 A
(port)168 3252 A
3462(B)S
(\(kbd,)210 3546 A
(beeper...\))420 3798 A
4260(*/)S
2430 V
(04392)210 648 A
(#define)294 1026 A
(TIMER0)252 1362 A
(0x40)168 2034 A
2370(/*)S
(I/O)126 2496 A
(port)168 2664 A
(for)126 2874 A
(timer)210 3042 A
(channel)294 3294 A
3630(0)S
3714(*/)S
2520 V
(04393)210 648 A
(#define)294 1026 A
(TIMER2)252 1362 A
(0x42)168 2034 A
2370(/*)S
(I/O)126 2496 A
(port)168 2664 A
(for)126 2874 A
(timer)210 3042 A
(channel)294 3294 A
3630(2)S
3714(*/)S
2610 V
(04394)210 648 A
(#define)294 1026 A
(TIMER_MODE)420 1362 A
(0x43)168 2034 A
2370(/*)S
(I/O)126 2496 A
(port)168 2664 A
(for)126 2874 A
(timer)210 3042 A
(mode)168 3294 A
(control)294 3504 A
3840(*/)S
2700 V
(04395)210 648 A
2790 V
(04396)210 648 A
(#endif)252 1026 A
1320(/*)S
(\(CHIP)210 1446 A
1698(==)S
(INTEL\))252 1824 A
2118(*/)S
2880 V
(04397)210 648 A
2970 V
(04398)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(M68000\))294 1572 A
3060 V
(04399)210 648 A
3150 V
(04400)210 648 A
(#define)294 1026 A
(K_STACK_BYTES)546 1362 A
(1024)168 2034 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(bytes)210 2874 A
(for)126 3126 A
(the)126 3294 A
(kernel)252 3462 A
(stack)210 3756 A
4008(*/)S
3240 V
(04401)210 648 A
3330 V
(04402)210 648 A
1026(/*)S
(Sizes)210 1152 A
1404(of)S
(memory)252 1530 A
(tables.)294 1824 A
2160(*/)S
3420 V
(04403)210 648 A
(#define)294 1026 A
(NR_MEMS)294 1362 A
2160(2)S
2370(/*)S
(number)252 2496 A
2790(of)S
(chunks)252 2916 A
3210(of)S
(memory)252 3336 A
3630(*/)S
3510 V
(04404)210 648 A
3600 V
(04405)210 648 A
1026(/*)S
(p_reg)210 1152 A
(contains:)378 1404 A
(d0-d7,)252 1824 A
(a0-a6,)252 2118 A
2496(in)S
(that)168 2622 A
(order.)252 2832 A
3126(*/)S
3690 V
(04406)210 648 A
(#define)294 1026 A
(NR_REGS)294 1362 A
2118(15)S
2370(/*)S
(number)252 2496 A
2790(of)S
(general)294 2916 A
(regs)168 3252 A
3462(in)S
(each)168 3588 A
(proc)168 3798 A
(slot)168 4008 A
4218(*/)S
3780 V
(04407)210 648 A
3870 V
(04408)210 648 A
(#define)294 1026 A
(TRACEBIT)336 1362 A
(0x8000)252 1950 A
2370(/*)S
2496(or)S
(this)168 2622 A
(with)168 2832 A
(psw)126 3042 A
3210(in)S
(proc[])252 3336 A
(for)126 3630 A
(tracing)294 3798 A
4134(*/)S
3960 V
(04409)210 648 A
(#define)294 1026 A
(SETPSW\(rp,)420 1362 A
(new\))168 1824 A
2370(/*)S
(permits)294 2496 A
(only)168 2832 A
(certain)294 3042 A
(bits)168 3378 A
3588(to)S
3714(be)S
(set)126 3840 A
4008(*/)S
4134(\\)S
4050 V
(04410)210 648 A
(\(\(rp\)->p_reg.psw)672 1362 A
2076(=)S
(\(rp\)->p_reg.psw)630 2160 A
2832(&)S
(\3040xFF)210 2916 A
3168(|)S
(\(new\))210 3252 A
3504(&)S
(0xFF\))210 3588 A
4140 V
(04411)210 648 A
4230 V
(04412)210 648 A
(#define)294 1026 A
(MEM_BYTES)378 1362 A
(0xffffffff)420 1824 A
2370(/*)S
(memory)252 2496 A
(size)168 2790 A
(for)126 3000 A
(/dev/mem)336 3168 A
3546(*/)S
4320 V
(04413)210 648 A
4410 V
(04414)210 648 A
(#ifdef)252 1026 A
(__ACK__)294 1320 A
4500 V
(04415)210 648 A
(#define)294 1026 A
(FSTRUCOPY)378 1362 A
4590 V
(04416)210 648 A
(#endif)252 1026 A
4680 V
(04417)210 648 A
4770 V
(04418)210 648 A
(#endif)252 1026 A
1320(/*)S
(\(CHIP)210 1446 A
1698(==)S
(M68000\))294 1824 A
2160(*/)S
4860 V
(04419)210 648 A
4950 V
(04420)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(items)210 1740 A
(pertain)294 1992 A
2328(to)S
(the)126 2454 A
(scheduling)420 2622 A
(queues.)294 3084 A
3420(*/)S
5040 V
(04421)210 648 A
(#define)294 1026 A
(TASK_Q)252 1362 A
2160(0)S
2370(/*)S
(ready)210 2496 A
(tasks)210 2748 A
(are)126 3000 A
(scheduled)378 3168 A
(via)126 3588 A
(queue)210 3756 A
4008(0)S
4092(*/)S
5130 V
(04422)210 648 A
(#define)294 1026 A
(SERVER_Q)336 1362 A
2160(1)S
2370(/*)S
(ready)210 2496 A
(servers)294 2748 A
(are)126 3084 A
(scheduled)378 3252 A
(via)126 3672 A
(queue)210 3840 A
4092(1)S
4176(*/)S
5220 V
(04423)210 648 A
(#define)294 1026 A
(USER_Q)252 1362 A
2160(2)S
2370(/*)S
(ready)210 2496 A
(users)210 2748 A
(are)126 3000 A
(scheduled)378 3168 A
(via)126 3588 A
(queue)210 3756 A
4008(2)S
4092(*/)S
5310 V
(04424)210 648 A
5400 V
(04425)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(ATARI\))252 1698 A
5490 V
(04426)210 648 A
(#define)294 1026 A
(SHADOW_Q)336 1362 A
2160(3)S
2370(/*)S
(runnable,)378 2496 A
(but)126 2916 A
(shadowed)336 3084 A
(processes)378 3462 A
3882(*/)S
5580 V
(04427)210 648 A
(#define)294 1026 A
1362(NQ)S
2160(4)S
2370(/*)S
2496(#)S
2580(of)S
(scheduling)420 2706 A
(queues)252 3168 A
3462(*/)S
5670 V
(04428)210 648 A
(#else)210 1026 A
5760 V
(04429)210 648 A
(#define)294 1026 A
1362(NQ)S
2160(3)S
2370(/*)S
2496(#)S
2580(of)S
(scheduling)420 2706 A
(queues)252 3168 A
3462(*/)S
5850 V
(04430)210 648 A
(#endif)252 1026 A
5940 V
(04431)210 648 A
6030 V
(04432)210 648 A
1026(/*)S
(Env_parse\(\))462 1152 A
(return)252 1656 A
(values.)294 1950 A
2286(*/)S
6120 V
(04433)210 648 A
(#define)294 1026 A
(EP_UNSET)336 1362 A
2034(0)S
2370(/*)S
(variable)336 2496 A
(not)126 2874 A
(set)126 3042 A
3210(*/)S
6210 V
(04434)210 648 A
(#define)294 1026 A
(EP_OFF)252 1362 A
2034(1)S
2370(/*)S
(var)126 2496 A
2664(=)S
(off)126 2748 A
2916(*/)S
8418 V
EP
%%Page: 51 51
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2028(File:)S
2261(src/kernel/const.h)S
12 B
4308(51)S
900 V
7 LST
(04435)210 648 A
(#define)294 1026 A
(EP_ON)210 1362 A
2034(2)S
2370(/*)S
(var)126 2496 A
2664(=)S
2748(on)S
(\(or)126 2874 A
(field)210 3042 A
(left)168 3294 A
(blank\))252 3504 A
3798(*/)S
990 V
(04436)210 648 A
(#define)294 1026 A
(EP_SET)252 1362 A
2034(3)S
2370(/*)S
(var)126 2496 A
2664(=)S
(1:2:3)210 2748 A
(\(nonblank)378 3000 A
(field\))252 3420 A
3714(*/)S
1080 V
(04437)210 648 A
1170 V
(04438)210 648 A
1026(/*)S
1152(To)S
(translate)378 1278 A
1698(an)S
(address)294 1824 A
2160(in)S
(kernel)252 2286 A
(space)210 2580 A
2832(to)S
2958(a)S
(physical)336 3042 A
(address.)336 3420 A
(This)168 3840 A
4050(is)S
1260 V
(04439)210 648 A
1068(*)S
(the)126 1152 A
(same)168 1320 A
1530(as)S
(umap\(proc_ptr,)588 1656 A
2286(D,)S
(vir,)168 2412 A
(sizeof\(*vir\)\),)588 2622 A
(but)126 3252 A
3420(a)S
(lot)126 3504 A
(less)168 3672 A
(costly.)294 3882 A
1350 V
(04440)210 648 A
1068(*/)S
1440 V
(04441)210 648 A
(#define)294 1026 A
(vir2phys\(vir\))546 1362 A
(\(data_base)420 2034 A
2496(+)S
(\(vir_bytes\))462 2580 A
(\(vir\)\))252 3084 A
1530 V
(04442)210 648 A
1620 V
(04443)210 648 A
(#define)294 1026 A
(printf)252 1362 A
(printk)252 1950 A
2370(/*)S
(the)126 2496 A
(kernel)252 2664 A
(really)252 2958 A
(uses)168 3252 A
(printk,)294 3462 A
(not)126 3798 A
(printf)252 3966 A
4260(*/)S
1890 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1980 V
(src/kernel/type.h)714 2034 A
2070 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2250 V
(04500)210 648 A
(#ifndef)294 1026 A
(TYPE_H)252 1362 A
2340 V
(04501)210 648 A
(#define)294 1026 A
(TYPE_H)252 1362 A
2430 V
(04502)210 648 A
2520 V
(04503)210 648 A
(typedef)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(task_t,)294 2076 A
(\(void\))252 2412 A
2706(\);)S
2610 V
(04504)210 648 A
(typedef)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(\(*rdwt_t\),)420 2034 A
(\(message)336 2496 A
(*m_ptr\))294 2874 A
3210(\);)S
2700 V
(04505)210 648 A
(typedef)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(\(*watchdog_t\),)588 2076 A
(\(void\))252 2706 A
3000(\);)S
2790 V
(04506)210 648 A
2880 V
(04507)210 648 A
(struct)252 1026 A
(tasktab)294 1320 A
1656({)S
2970 V
(04508)210 648 A
(task_t)252 1110 A
(*initial_pc;)504 1404 A
3060 V
(04509)210 648 A
(int)126 1110 A
(stksize;)336 1278 A
3150 V
(04510)210 648 A
(char)168 1110 A
(name[8];)336 1320 A
3240 V
(04511)210 648 A
1026(};)S
3330 V
(04512)210 648 A
3420 V
(04513)210 648 A
(struct)252 1026 A
(memory)252 1320 A
1614({)S
3510 V
(04514)210 648 A
(phys_clicks)462 1110 A
(base;)210 1614 A
3600 V
(04515)210 648 A
(phys_clicks)462 1110 A
(size;)210 1614 A
3690 V
(04516)210 648 A
1026(};)S
3780 V
(04517)210 648 A
3870 V
(04518)210 648 A
1026(/*)S
(Administration)588 1152 A
(for)126 1782 A
(clock)210 1950 A
(polling.)336 2202 A
2580(*/)S
3960 V
(04519)210 648 A
(struct)252 1026 A
(milli_state)462 1320 A
1824({)S
4050 V
(04520)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(accum_count;)504 1698 A
2370(/*)S
(accumulated)462 2496 A
(clock)210 3000 A
(ticks)210 3252 A
3504(*/)S
4140 V
(04521)210 648 A
(unsigned)336 1110 A
(prev_count;)462 1488 A
2370(/*)S
(previous)336 2496 A
(clock)210 2874 A
(value)210 3126 A
3378(*/)S
4230 V
(04522)210 648 A
1026(};)S
4320 V
(04523)210 648 A
4410 V
(04524)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
4500 V
(04525)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(port_t;)294 1740 A
4590 V
(04526)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(segm_t;)294 1740 A
4680 V
(04527)210 648 A
(typedef)294 1026 A
(unsigned)336 1362 A
(reg_t;)252 1740 A
2370(/*)S
(machine)294 2496 A
(register)336 2832 A
3210(*/)S
4770 V
(04528)210 648 A
4860 V
(04529)210 648 A
1026(/*)S
(The)126 1152 A
(stack)210 1320 A
(frame)210 1572 A
(layout)252 1824 A
2118(is)S
(determined)420 2244 A
2706(by)S
(the)126 2832 A
(software,)378 3000 A
(but)126 3420 A
(for)126 3588 A
(efficiency)420 3756 A
4950 V
(04530)210 648 A
1068(*)S
1152(it)S
1278(is)S
(laid)168 1404 A
(out)126 1614 A
1782(so)S
(the)126 1908 A
(assembly)336 2076 A
(code)168 2454 A
2664(to)S
(use)126 2790 A
2958(it)S
3084(is)S
3210(as)S
(simple)252 3336 A
3630(as)S
(possible.)378 3756 A
5040 V
(04531)210 648 A
1068(*)S
(80286)210 1152 A
(protected)378 1404 A
(mode)168 1824 A
(and)126 2034 A
(all)126 2202 A
(real)168 2370 A
(modes)210 2580 A
(use)126 2832 A
(the)126 3000 A
(same)168 3168 A
(frame,)252 3378 A
(built)210 3672 A
(with)168 3924 A
5130 V
(04532)210 648 A
1068(*)S
(16-bit)252 1152 A
(registers.)420 1446 A
(Real)168 1950 A
(mode)168 2160 A
(lacks)210 2370 A
2622(an)S
(automatic)378 2748 A
(stack)210 3168 A
(switch,)294 3420 A
3756(so)S
(little)252 3882 A
5220 V
(04533)210 648 A
1068(*)S
1152(is)S
(lost)168 1278 A
1488(by)S
(using)210 1614 A
(the)126 1866 A
(286)126 2034 A
(frame)210 2202 A
(for)126 2454 A
(it.)126 2622 A
(The)126 2832 A
(386)126 3000 A
(frame)210 3168 A
(differs)294 3420 A
(only)168 3756 A
3966(in)S
5310 V
(04534)210 648 A
1068(*)S
(having)252 1152 A
(32-bit)252 1446 A
(registers)378 1740 A
(and)126 2160 A
(more)168 2328 A
(segment)294 2538 A
(registers.)420 2874 A
(The)126 3378 A
(same)168 3546 A
(names)210 3756 A
(are)126 4008 A
5400 V
(04535)210 648 A
1068(*)S
(used)168 1152 A
(for)126 1362 A
(the)126 1530 A
(larger)252 1698 A
(registers)378 1992 A
2412(to)S
(avoid)210 2538 A
(differences)462 2790 A
3294(in)S
(the)126 3420 A
(code.)210 3588 A
5490 V
(04536)210 648 A
1068(*/)S
5580 V
(04537)210 648 A
(struct)252 1026 A
(stackframe_s)504 1320 A
1866({)S
2370(/*)S
(proc_ptr)336 2496 A
(points)252 2874 A
(here)168 3168 A
3378(*/)S
5670 V
(04538)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(4)S
5760 V
(04539)210 648 A
(u16_t)210 1110 A
(gs;)126 1362 A
2370(/*)S
(last)168 2496 A
(item)168 2706 A
(pushed)252 2916 A
3210(by)S
(save)168 3336 A
3546(*/)S
5850 V
(04540)210 648 A
(u16_t)210 1110 A
(fs;)126 1362 A
2370(/*)S
2538(\303)S
2622(*/)S
5940 V
(04541)210 648 A
(#endif)252 1026 A
6030 V
(04542)210 648 A
(u16_t)210 1110 A
(es;)126 1362 A
2370(/*)S
2538(|)S
2622(*/)S
6120 V
(04543)210 648 A
(u16_t)210 1110 A
(ds;)126 1362 A
2370(/*)S
2538(|)S
2622(*/)S
6210 V
(04544)210 648 A
(reg_t)210 1110 A
(di;)126 1362 A
2370(/*)S
2496(di)S
(through)294 2622 A
2958(cx)S
(are)126 3084 A
(not)126 3252 A
(accessed)336 3420 A
3798(in)S
3924(C)S
4008(*/)S
8418 V
EP
%%Page: 52 52
BP
/slant 0 def
/height 0 def
630 V
12 B
648(52)S
11 R
2049(File:)S
(src/kernel/type.h)744 2282 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(04545)210 648 A
(reg_t)210 1110 A
(si;)126 1362 A
2370(/*)S
(order)210 2496 A
2748(is)S
2874(to)S
(match)210 3000 A
(pusha/popa)420 3252 A
3714(*/)S
990 V
(04546)210 648 A
(reg_t)210 1110 A
(fp;)126 1362 A
2370(/*)S
2496(bp)S
2622(*/)S
1080 V
(04547)210 648 A
(reg_t)210 1110 A
(st;)126 1362 A
2370(/*)S
(hole)168 2496 A
(for)126 2706 A
(another)294 2874 A
(copy)168 3210 A
3420(of)S
3546(sp)S
3672(*/)S
1170 V
(04548)210 648 A
(reg_t)210 1110 A
(bx;)126 1362 A
2370(/*)S
2538(|)S
2622(*/)S
1260 V
(04549)210 648 A
(reg_t)210 1110 A
(dx;)126 1362 A
2370(/*)S
2538(|)S
2622(*/)S
1350 V
(04550)210 648 A
(reg_t)210 1110 A
(cx;)126 1362 A
2370(/*)S
2538(|)S
2622(*/)S
1440 V
(04551)210 648 A
(reg_t)210 1110 A
(retreg;)294 1362 A
2370(/*)S
2496(ax)S
(and)126 2622 A
(above)210 2790 A
(are)126 3042 A
(all)126 3210 A
(pushed)252 3378 A
3672(by)S
(save)168 3798 A
4008(*/)S
1530 V
(04552)210 648 A
(reg_t)210 1110 A
(retadr;)294 1362 A
2370(/*)S
(return)252 2496 A
(address)294 2790 A
(for)126 3126 A
(assembly)336 3294 A
(code)168 3672 A
(save\(\))252 3882 A
4176(*/)S
1620 V
(04553)210 648 A
(reg_t)210 1110 A
(pc;)126 1362 A
2370(/*)S
2538(\303)S
(last)168 2664 A
(item)168 2874 A
(pushed)252 3084 A
3378(by)S
(interrupt)378 3504 A
3924(*/)S
1710 V
(04554)210 648 A
(reg_t)210 1110 A
(cs;)126 1362 A
2370(/*)S
2538(|)S
2622(*/)S
1800 V
(04555)210 648 A
(reg_t)210 1110 A
(psw;)168 1362 A
2370(/*)S
2538(|)S
2622(*/)S
1890 V
(04556)210 648 A
(reg_t)210 1110 A
(sp;)126 1362 A
2370(/*)S
2538(|)S
2622(*/)S
1980 V
(04557)210 648 A
(reg_t)210 1110 A
(ss;)126 1362 A
2370(/*)S
(these)210 2496 A
(are)126 2748 A
(pushed)252 2916 A
3210(by)S
(CPU)126 3336 A
(during)252 3504 A
(interrupt)378 3798 A
4218(*/)S
2070 V
(04558)210 648 A
1026(};)S
2160 V
(04559)210 648 A
2250 V
(04560)210 648 A
(struct)252 1026 A
(segdesc_s)378 1320 A
1740({)S
2370(/*)S
(segment)294 2496 A
(descriptor)420 2832 A
(for)126 3294 A
(protected)378 3462 A
(mode)168 3882 A
4092(*/)S
2340 V
(04561)210 648 A
(u16_t)210 1110 A
(limit_low;)420 1362 A
2430 V
(04562)210 648 A
(u16_t)210 1110 A
(base_low;)378 1362 A
2520 V
(04563)210 648 A
(u8_t)168 1110 A
(base_middle;)504 1320 A
2610 V
(04564)210 648 A
(u8_t)168 1110 A
(access;)294 1320 A
2370(/*)S
(|P|DL|1|X|E|R|A|)672 2496 A
3210(*/)S
2700 V
(04565)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(4)S
2790 V
(04566)210 648 A
(u8_t)168 1110 A
(granularity;)504 1320 A
2370(/*)S
(|G|X|0|A|LIMT|)588 2496 A
3126(*/)S
2880 V
(04567)210 648 A
(u8_t)168 1110 A
(base_high;)420 1320 A
2970 V
(04568)210 648 A
(#else)210 1026 A
3060 V
(04569)210 648 A
(u16_t)210 1110 A
(reserved;)378 1362 A
3150 V
(04570)210 648 A
(#endif)252 1026 A
3240 V
(04571)210 648 A
1026(};)S
3330 V
(04572)210 648 A
3420 V
(04573)210 648 A
(typedef)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(\(*irq_handler_t\),)714 2034 A
(\(int)168 2790 A
(irq\))168 3000 A
3210(\);)S
3510 V
(04574)210 648 A
3600 V
(04575)210 648 A
(#endif)252 1026 A
1320(/*)S
(\(CHIP)210 1446 A
1698(==)S
(INTEL\))252 1824 A
2118(*/)S
3690 V
(04576)210 648 A
3780 V
(04577)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(M68000\))294 1572 A
3870 V
(04578)210 648 A
(typedef)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(\(*dmaint_t\),)504 2076 A
(\(void\))252 2622 A
2916(\);)S
3960 V
(04579)210 648 A
4050 V
(04580)210 648 A
(typedef)294 1026 A
(u32_t)210 1362 A
(reg_t;)252 1614 A
2370(/*)S
(machine)294 2496 A
(register)336 2832 A
3210(*/)S
4140 V
(04581)210 648 A
4230 V
(04582)210 648 A
1026(/*)S
(The)126 1152 A
(name)168 1320 A
(and)126 1530 A
(fields)252 1698 A
1992(of)S
(this)168 2118 A
(struct)252 2328 A
(were)168 2622 A
(chosen)252 2832 A
(for)126 3126 A
3294(PC)S
(compatibility.)588 3420 A
4050(*/)S
4320 V
(04583)210 648 A
(struct)252 1026 A
(stackframe_s)504 1320 A
1866({)S
4410 V
(04584)210 648 A
(reg_t)210 1110 A
(retreg;)294 1362 A
2370(/*)S
2496(d0)S
2622(*/)S
4500 V
(04585)210 648 A
(reg_t)210 1110 A
(d1;)126 1362 A
4590 V
(04586)210 648 A
(reg_t)210 1110 A
(d2;)126 1362 A
4680 V
(04587)210 648 A
(reg_t)210 1110 A
(d3;)126 1362 A
4770 V
(04588)210 648 A
(reg_t)210 1110 A
(d4;)126 1362 A
4860 V
(04589)210 648 A
(reg_t)210 1110 A
(d5;)126 1362 A
4950 V
(04590)210 648 A
(reg_t)210 1110 A
(d6;)126 1362 A
5040 V
(04591)210 648 A
(reg_t)210 1110 A
(d7;)126 1362 A
5130 V
(04592)210 648 A
(reg_t)210 1110 A
(a0;)126 1362 A
5220 V
(04593)210 648 A
(reg_t)210 1110 A
(a1;)126 1362 A
5310 V
(04594)210 648 A
(reg_t)210 1110 A
(a2;)126 1362 A
5400 V
(04595)210 648 A
(reg_t)210 1110 A
(a3;)126 1362 A
5490 V
(04596)210 648 A
(reg_t)210 1110 A
(a4;)126 1362 A
5580 V
(04597)210 648 A
(reg_t)210 1110 A
(a5;)126 1362 A
5670 V
(04598)210 648 A
(reg_t)210 1110 A
(fp;)126 1362 A
2370(/*)S
(also)168 2496 A
(known)210 2706 A
2958(as)S
3084(a6)S
3210(*/)S
5760 V
(04599)210 648 A
(reg_t)210 1110 A
(sp;)126 1362 A
2370(/*)S
(also)168 2496 A
(known)210 2706 A
2958(as)S
3084(a7)S
3210(*/)S
5850 V
(04600)210 648 A
(reg_t)210 1110 A
(pc;)126 1362 A
5940 V
(04601)210 648 A
(u16_t)210 1110 A
(psw;)168 1362 A
6030 V
(04602)210 648 A
(u16_t)210 1110 A
(dummy;)252 1362 A
2370(/*)S
(make)168 2496 A
(size)168 2706 A
(multiple)336 2916 A
3294(of)S
(reg_t)210 3420 A
(for)126 3672 A
(system.c)336 3840 A
4218(*/)S
6120 V
(04603)210 648 A
1026(};)S
6210 V
(04604)210 648 A
8418 V
EP
%%Page: 53 53
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2049(File:)S
(src/kernel/type.h)744 2282 A
12 B
4308(53)S
900 V
7 LST
(04605)210 648 A
(struct)252 1026 A
(fsave)210 1320 A
1572({)S
990 V
(04606)210 648 A
(struct)252 1110 A
(cpu_state)378 1404 A
1824({)S
1080 V
(04607)210 648 A
(u16_t)210 1362 A
(i_format;)378 1614 A
1170 V
(04608)210 648 A
(u32_t)210 1362 A
(i_addr;)294 1614 A
1260 V
(04609)210 648 A
(u16_t)210 1362 A
(i_state[4];)462 1614 A
1350 V
(04610)210 648 A
1110(})S
(cpu_state;)420 1194 A
1440 V
(04611)210 648 A
(struct)252 1110 A
(state_frame)462 1404 A
1908({)S
1530 V
(04612)210 648 A
(u8_t)168 1362 A
(frame_type;)462 1572 A
1620 V
(04613)210 648 A
(u8_t)168 1362 A
(frame_size;)462 1572 A
1710 V
(04614)210 648 A
(u16_t)210 1362 A
(reserved;)378 1614 A
1800 V
(04615)210 648 A
(u8_t)168 1362 A
(frame[212];)462 1572 A
1890 V
(04616)210 648 A
1110(})S
(state_frame;)504 1194 A
1980 V
(04617)210 648 A
(struct)252 1110 A
(fpp_model)378 1404 A
1824({)S
2070 V
(04618)210 648 A
(u32_t)210 1362 A
(fpcr;)210 1614 A
2160 V
(04619)210 648 A
(u32_t)210 1362 A
(fpsr;)210 1614 A
2250 V
(04620)210 648 A
(u32_t)210 1362 A
(fpiar;)252 1614 A
2340 V
(04621)210 648 A
(struct)252 1362 A
(fpN)126 1656 A
1824({)S
2430 V
(04622)210 648 A
(u32_t)210 1698 A
(high;)210 1950 A
2520 V
(04623)210 648 A
(u32_t)210 1698 A
(low;)168 1950 A
2610 V
(04624)210 648 A
(u32_t)210 1698 A
(mid;)168 1950 A
2700 V
(04625)210 648 A
1362(})S
(fpN[8];)294 1446 A
2790 V
(04626)210 648 A
1110(})S
(fpp_model;)420 1194 A
2880 V
(04627)210 648 A
1026(};)S
2970 V
(04628)210 648 A
(#endif)252 1026 A
1320(/*)S
(\(CHIP)210 1446 A
1698(==)S
(M68000\))294 1824 A
2160(*/)S
3060 V
(04629)210 648 A
3150 V
(04630)210 648 A
(#endif)252 1026 A
1320(/*)S
(TYPE_H)252 1446 A
1740(*/)S
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(src/kernel/proto.h)756 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(04700)210 648 A
1026(/*)S
(Function)336 1152 A
(prototypes.)462 1530 A
2034(*/)S
4140 V
(04701)210 648 A
4230 V
(04702)210 648 A
(#ifndef)294 1026 A
(PROTO_H)294 1362 A
4320 V
(04703)210 648 A
(#define)294 1026 A
(PROTO_H)294 1362 A
4410 V
(04704)210 648 A
4500 V
(04705)210 648 A
1026(/*)S
(Struct)252 1152 A
(declarations.)546 1446 A
2034(*/)S
4590 V
(04706)210 648 A
(struct)252 1026 A
(proc;)210 1320 A
4680 V
(04707)210 648 A
(struct)252 1026 A
(tty;)168 1320 A
4770 V
(04708)210 648 A
4860 V
(04709)210 648 A
1026(/*)S
(at_wini.c,)420 1152 A
(wini.c)252 1614 A
1908(*/)S
4950 V
(04710)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(winchester_task,)672 1740 A
(\(void\))252 2454 A
4050(\);)S
5040 V
(04711)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(at_winchester_task,)798 1740 A
(\(void\))252 2580 A
4050(\);)S
5130 V
(04712)210 648 A
5220 V
(04713)210 648 A
1026(/*)S
(clock.c)294 1152 A
1488(*/)S
5310 V
(04714)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(clock_task,)462 1740 A
(\(void\))252 2244 A
4050(\);)S
5400 V
(04715)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(clock_stop,)462 1740 A
(\(void\))252 2244 A
4050(\);)S
5490 V
(04716)210 648 A
(_PROTOTYPE\()462 1026 A
(clock_t)294 1530 A
(get_uptime,)462 1866 A
(\(void\))252 2370 A
4050(\);)S
5580 V
(04717)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(syn_alrm_task,)588 1740 A
(\(void\))252 2370 A
4050(\);)S
5670 V
(04718)210 648 A
5760 V
(04719)210 648 A
1026(/*)S
(dmp.c)210 1152 A
1404(*/)S
5850 V
(04720)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(map_dmp,)336 1740 A
(\(void\))252 2118 A
4050(\);)S
5940 V
(04721)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(p_dmp,)252 1740 A
(\(void\))252 2034 A
4050(\);)S
6030 V
(04722)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(reg_dmp,)336 1740 A
(\(struct)294 2118 A
(proc)168 2454 A
(*rp\))168 2664 A
4050(\);)S
6120 V
(04723)210 648 A
6210 V
(04724)210 648 A
1026(/*)S
(dp8390.c)336 1152 A
1530(*/)S
8418 V
EP
%%Page: 54 54
BP
/slant 0 def
/height 0 def
630 V
12 B
648(54)S
11 R
2028(File:)S
2261(src/kernel/proto.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(04725)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(dp8390_task,)504 1740 A
(\(void\))252 2286 A
4050(\);)S
990 V
(04726)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(dp_dump,)336 1740 A
(\(void\))252 2118 A
4050(\);)S
1080 V
(04727)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(dp8390_stop,)504 1740 A
(\(void\))252 2286 A
4050(\);)S
1170 V
(04728)210 648 A
1260 V
(04729)210 648 A
1026(/*)S
(floppy.c,)378 1152 A
(stfloppy.c)420 1572 A
2034(*/)S
1350 V
(04730)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(floppy_task,)504 1740 A
(\(void\))252 2286 A
4050(\);)S
1440 V
(04731)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(floppy_stop,)504 1740 A
(\(void\))252 2286 A
4050(\);)S
1530 V
(04732)210 648 A
1620 V
(04733)210 648 A
1026(/*)S
(main.c,)294 1152 A
(stmain.c)336 1488 A
1866(*/)S
1710 V
(04734)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(main,)210 1740 A
(\(void\))252 1992 A
4050(\);)S
1800 V
(04735)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(panic,)252 1740 A
(\(const)252 2034 A
(char)168 2328 A
(*s,)126 2538 A
(int)126 2706 A
2874(n\))S
4050(\);)S
1890 V
(04736)210 648 A
1980 V
(04737)210 648 A
1026(/*)S
(memory.c)336 1152 A
1530(*/)S
2070 V
(04738)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(mem_task,)378 1740 A
(\(void\))252 2160 A
4050(\);)S
2160 V
(04739)210 648 A
2250 V
(04740)210 648 A
1026(/*)S
(misc.c)252 1152 A
1446(*/)S
2340 V
(04741)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(env_parse,)420 1698 A
(\(char)210 2160 A
(*env,)210 2412 A
(char)168 2664 A
(*fmt,)210 2874 A
(int)126 3126 A
(field,)252 3294 A
2430 V
(04742)210 648 A
(long)168 2034 A
(*param,)294 2244 A
(long)168 2580 A
(min,)168 2790 A
(long)168 3000 A
(max\))168 3210 A
4050(\);)S
2520 V
(04743)210 648 A
2610 V
(04744)210 648 A
1026(/*)S
(printer.c,)420 1152 A
(stprint.c)378 1614 A
2034(*/)S
2700 V
(04745)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(printer_task,)546 1740 A
(\(void\))252 2328 A
4050(\);)S
2790 V
(04746)210 648 A
2880 V
(04747)210 648 A
1026(/*)S
(proc.c)252 1152 A
1446(*/)S
2970 V
(04748)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(interrupt,)420 1740 A
(\(int)168 2202 A
(task\))210 2412 A
4050(\);)S
3060 V
(04749)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(lock_mini_send,)630 1698 A
(\(struct)294 2370 A
(proc)168 2706 A
(*caller_ptr,)504 2916 A
3150 V
(04750)210 648 A
(int)126 1698 A
(dest,)210 1866 A
(message)294 2118 A
(*m_ptr\))294 2454 A
4050(\);)S
3240 V
(04751)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(lock_pick_proc,)630 1740 A
(\(void\))252 2412 A
4050(\);)S
3330 V
(04752)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(lock_ready,)462 1740 A
(\(struct)294 2244 A
(proc)168 2580 A
(*rp\))168 2790 A
4050(\);)S
3420 V
(04753)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(lock_sched,)462 1740 A
(\(void\))252 2244 A
4050(\);)S
3510 V
(04754)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(lock_unready,)546 1740 A
(\(struct)294 2328 A
(proc)168 2664 A
(*rp\))168 2874 A
4050(\);)S
3600 V
(04755)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(sys_call,)378 1698 A
(\(int)168 2118 A
(function,)378 2328 A
(int)126 2748 A
(src_dest,)378 2916 A
(message)294 3336 A
(*m_ptr\))294 3672 A
4050(\);)S
3690 V
(04756)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(unhold,)294 1740 A
(\(void\))252 2076 A
4050(\);)S
3780 V
(04757)210 648 A
3870 V
(04758)210 648 A
1026(/*)S
(rs232.c)294 1152 A
1488(*/)S
3960 V
(04759)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(rs_init,)336 1740 A
(\(struct)294 2118 A
(tty)126 2454 A
(*tp\))168 2622 A
4050(\);)S
4050 V
(04760)210 648 A
4140 V
(04761)210 648 A
1026(/*)S
(system.c)336 1152 A
1530(*/)S
4230 V
(04762)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(cause_sig,)420 1740 A
(\(int)168 2202 A
(proc_nr,)336 2412 A
(int)126 2790 A
(sig_nr\))294 2958 A
4050(\);)S
4320 V
(04763)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(inform,)294 1740 A
(\(void\))252 2076 A
4050(\);)S
4410 V
(04764)210 648 A
(_PROTOTYPE\()462 1026 A
(phys_bytes)420 1530 A
(numap,)252 1992 A
(\(int)168 2286 A
(proc_nr,)336 2496 A
(vir_bytes)378 2874 A
(vir_addr,)378 3294 A
4500 V
(04765)210 648 A
(vir_bytes)378 1698 A
(bytes\))252 2118 A
4050(\);)S
4590 V
(04766)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(sys_task,)378 1740 A
(\(void\))252 2160 A
4050(\);)S
4680 V
(04767)210 648 A
(_PROTOTYPE\()462 1026 A
(phys_bytes)420 1530 A
(umap,)210 1992 A
(\(struct)294 2244 A
(proc)168 2580 A
(*rp,)168 2790 A
(int)126 3000 A
(seg,)168 3168 A
(vir_bytes)378 3378 A
(vir_addr,)378 3798 A
4770 V
(04768)210 648 A
(vir_bytes)378 1698 A
(bytes\))252 2118 A
4050(\);)S
4860 V
(04769)210 648 A
4950 V
(04770)210 648 A
1026(/*)S
(tty.c)210 1152 A
1404(*/)S
5040 V
(04771)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(handle_events,)588 1740 A
(\(struct)294 2370 A
(tty)126 2706 A
(*tp\))168 2874 A
4050(\);)S
5130 V
(04772)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(sigchar,)336 1740 A
(\(struct)294 2118 A
(tty)126 2454 A
(*tp,)168 2622 A
(int)126 2832 A
(sig\))168 3000 A
4050(\);)S
5220 V
(04773)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(tty_task,)378 1740 A
(\(void\))252 2160 A
4050(\);)S
5310 V
(04774)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(in_process,)462 1698 A
(\(struct)294 2202 A
(tty)126 2538 A
(*tp,)168 2706 A
(char)168 2916 A
(*buf,)210 3126 A
(int)126 3378 A
(count\))252 3546 A
4050(\);)S
5400 V
(04775)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(out_process,)504 1740 A
(\(struct)294 2286 A
(tty)126 2622 A
(*tp,)168 2790 A
(char)168 3000 A
(*bstart,)336 3210 A
(char)168 3588 A
(*bpos,)252 3798 A
5490 V
(04776)210 648 A
(char)168 2370 A
(*bend,)252 2580 A
(int)126 2874 A
(*icount,)336 3042 A
(int)126 3420 A
(*ocount\))336 3588 A
4050(\);)S
5580 V
(04777)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(tty_wakeup,)462 1740 A
(\(clock_t)336 2244 A
(now\))168 2622 A
4050(\);)S
5670 V
(04778)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(tty_reply,)420 1740 A
(\(int)168 2202 A
(code,)210 2412 A
(int)126 2664 A
(replyee,)336 2832 A
(int)126 3210 A
(proc_nr,)336 3378 A
5760 V
(04779)210 648 A
(int)126 3378 A
(status\))294 3546 A
4050(\);)S
5850 V
(04780)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(tty_devnop,)462 1740 A
(\(struct)294 2244 A
(tty)126 2580 A
(*tp\))168 2748 A
4050(\);)S
5940 V
(04781)210 648 A
6030 V
(04782)210 648 A
1026(/*)S
(library)294 1152 A
1488(*/)S
6120 V
(04783)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(*memcpy,)336 1740 A
(\(void)210 2118 A
(*_s1,)210 2370 A
(const)210 2622 A
(void)168 2874 A
(*_s2,)210 3084 A
(size_t)252 3336 A
(_n\))126 3630 A
4050(\);)S
6210 V
(04784)210 648 A
8418 V
EP
%%Page: 55 55
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2028(File:)S
2261(src/kernel/proto.h)S
12 B
4308(55)S
900 V
7 LST
(04785)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
990 V
(04786)210 648 A
1080 V
(04787)210 648 A
1026(/*)S
(clock.c)294 1152 A
1488(*/)S
1170 V
(04788)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(milli_start,)504 1740 A
(\(struct)294 2286 A
(milli_state)462 2622 A
(*msp\))210 3126 A
4050(\);)S
1260 V
(04789)210 648 A
(_PROTOTYPE\()462 1026 A
(unsigned)336 1530 A
(milli_elapsed,)588 1908 A
(\(struct)294 2538 A
(milli_state)462 2874 A
(*msp\))210 3378 A
4050(\);)S
1350 V
(04790)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(milli_delay,)504 1740 A
(\(unsigned)378 2286 A
(millisec\))378 2706 A
4050(\);)S
1440 V
(04791)210 648 A
1530 V
(04792)210 648 A
1026(/*)S
(console.c)378 1152 A
1572(*/)S
1620 V
(04793)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(cons_stop,)420 1740 A
(\(void\))252 2202 A
4050(\);)S
1710 V
(04794)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(putk,)210 1740 A
(\(int)168 1992 A
2202(c\))S
4050(\);)S
1800 V
(04795)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(scr_init,)378 1740 A
(\(struct)294 2160 A
(tty)126 2496 A
(*tp\))168 2664 A
4050(\);)S
1890 V
(04796)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(toggle_scroll,)588 1740 A
(\(void\))252 2370 A
4050(\);)S
1980 V
(04797)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(con_loadfont,)546 1698 A
(\(phys_bytes)462 2286 A
(user_phys\))420 2790 A
4050(\);)S
2070 V
(04798)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(select_console,)630 1740 A
(\(int)168 2412 A
(cons_line\))420 2622 A
4050(\);)S
2160 V
(04799)210 648 A
2250 V
(04800)210 648 A
1026(/*)S
(cstart.c)336 1152 A
1530(*/)S
2340 V
(04801)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(cstart,)294 1740 A
(\(U16_t)252 2076 A
(cs,)126 2370 A
(U16_t)210 2538 A
(ds,)126 2790 A
(U16_t)210 2958 A
(mcs,)168 3210 A
(U16_t)210 3420 A
(mds,)168 3672 A
2430 V
(04802)210 648 A
(U16_t)210 2370 A
(parmoff,)336 2622 A
(U16_t)210 3000 A
(parmsize\))378 3252 A
4050(\);)S
2520 V
(04803)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*k_getenv,)420 1740 A
(\(char)210 2202 A
(*name\))252 2454 A
4050(\);)S
2610 V
(04804)210 648 A
2700 V
(04805)210 648 A
1026(/*)S
(exception.c)462 1152 A
1656(*/)S
2790 V
(04806)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(exception,)420 1740 A
(\(unsigned)378 2202 A
(vec_nr\))294 2622 A
4050(\);)S
2880 V
(04807)210 648 A
2970 V
(04808)210 648 A
1026(/*)S
(i8259.c)294 1152 A
1488(*/)S
3060 V
(04809)210 648 A
(_PROTOTYPE\()462 1026 A
(irq_handler_t)546 1530 A
(get_irq_handler,)672 2118 A
(\(int)168 2832 A
(irq\))168 3042 A
4050(\);)S
3150 V
(04810)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(put_irq_handler,)672 1740 A
(\(int)168 2454 A
(irq,)168 2664 A
(irq_handler_t)546 2874 A
(handler\))336 3462 A
4050(\);)S
3240 V
(04811)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(intr_init,)420 1740 A
(\(int)168 2202 A
(mine\))210 2412 A
4050(\);)S
3330 V
(04812)210 648 A
3420 V
(04813)210 648 A
1026(/*)S
(keyboard.c)420 1152 A
1614(*/)S
3510 V
(04814)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(kb_init,)336 1740 A
(\(struct)294 2118 A
(tty)126 2454 A
(*tp\))168 2622 A
4050(\);)S
3600 V
(04815)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(kbd_loadmap,)504 1698 A
(\(phys_bytes)462 2244 A
(user_phys\))420 2748 A
4050(\);)S
3690 V
(04816)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(wreboot,)336 1740 A
(\(int)168 2118 A
(how\))168 2328 A
4050(\);)S
3780 V
(04817)210 648 A
3870 V
(04818)210 648 A
1026(/*)S
(klib*.s)294 1152 A
1488(*/)S
3960 V
(04819)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(bios13,)294 1740 A
(\(void\))252 2076 A
4050(\);)S
4050 V
(04820)210 648 A
(_PROTOTYPE\()462 1026 A
(phys_bytes)420 1530 A
(check_mem,)420 1992 A
(\(phys_bytes)462 2454 A
(base,)210 2958 A
(phys_bytes)420 3210 A
(size\))210 3672 A
4050(\);)S
4140 V
(04821)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(cp_mess,)336 1740 A
(\(int)168 2118 A
(src,phys_clicks)630 2328 A
(src_clicks,vir_bytes)840 3000 A
(src_offset,)462 3882 A
4230 V
(04822)210 648 A
(phys_clicks)462 1698 A
(dst_clicks,)462 2202 A
(vir_bytes)378 2706 A
(dst_offset\))462 3126 A
4050(\);)S
4320 V
(04823)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(in_byte,)336 1698 A
(\(port_t)294 2076 A
(port\))210 2412 A
4050(\);)S
4410 V
(04824)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(in_word,)336 1698 A
(\(port_t)294 2076 A
(port\))210 2412 A
4050(\);)S
4500 V
(04825)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(lock,)210 1740 A
(\(void\))252 1992 A
4050(\);)S
4590 V
(04826)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(unlock,)294 1740 A
(\(void\))252 2076 A
4050(\);)S
4680 V
(04827)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(enable_irq,)462 1740 A
(\(unsigned)378 2244 A
(irq\))168 2664 A
4050(\);)S
4770 V
(04828)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(disable_irq,)504 1698 A
(\(unsigned)378 2244 A
(irq\))168 2664 A
4050(\);)S
4860 V
(04829)210 648 A
(_PROTOTYPE\()462 1026 A
(u16_t)210 1530 A
(mem_rdw,)336 1782 A
(\(segm_t)294 2160 A
(segm,)210 2496 A
(vir_bytes)378 2748 A
(offset\))294 3168 A
4050(\);)S
4950 V
(04830)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(out_byte,)378 1740 A
(\(port_t)294 2160 A
(port,)210 2496 A
(int)126 2748 A
(value\))252 2916 A
4050(\);)S
5040 V
(04831)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(out_word,)378 1740 A
(\(port_t)294 2160 A
(port,)210 2496 A
(int)126 2748 A
(value\))252 2916 A
4050(\);)S
5130 V
(04832)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(phys_copy,)420 1740 A
(\(phys_bytes)462 2202 A
(source,)294 2706 A
(phys_bytes)420 3042 A
(dest,)210 3504 A
5220 V
(04833)210 648 A
(phys_bytes)420 1698 A
(count\))252 2160 A
4050(\);)S
5310 V
(04834)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(port_read,)420 1740 A
(\(unsigned)378 2202 A
(port,)210 2622 A
(phys_bytes)420 2874 A
(destination,)504 3336 A
5400 V
(04835)210 648 A
(unsigned)336 1698 A
(bytcount\))378 2076 A
4050(\);)S
5490 V
(04836)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(port_read_byte,)630 1740 A
(\(unsigned)378 2412 A
(port,)210 2832 A
(phys_bytes)420 3084 A
(destination,)504 3546 A
5580 V
(04837)210 648 A
(unsigned)336 1698 A
(bytcount\))378 2076 A
4050(\);)S
5670 V
(04838)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(port_write,)462 1740 A
(\(unsigned)378 2244 A
(port,)210 2664 A
(phys_bytes)420 2916 A
(source,)294 3378 A
5760 V
(04839)210 648 A
(unsigned)336 1698 A
(bytcount\))378 2076 A
4050(\);)S
5850 V
(04840)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(port_write_byte,)672 1740 A
(\(unsigned)378 2454 A
(port,)210 2874 A
(phys_bytes)420 3126 A
(source,)294 3588 A
5940 V
(04841)210 648 A
(unsigned)336 1698 A
(bytcount\))378 2076 A
4050(\);)S
6030 V
(04842)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(reset,)252 1740 A
(\(void\))252 2034 A
4050(\);)S
6120 V
(04843)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(vid_vid_copy,)546 1740 A
(\(unsigned)378 2328 A
(src,)168 2748 A
(unsigned)336 2958 A
(dst,)168 3336 A
(unsigned)336 3546 A
(count\)\);)336 3924 A
6210 V
(04844)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(mem_vid_copy,)546 1740 A
(\(u16_t)252 2328 A
(*src,)210 2622 A
(unsigned)336 2874 A
(dst,)168 3252 A
(unsigned)336 3462 A
(count\)\);)336 3840 A
8418 V
EP
%%Page: 56 56
BP
/slant 0 def
/height 0 def
630 V
12 B
648(56)S
11 R
2028(File:)S
2261(src/kernel/proto.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(04845)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(level0,)294 1740 A
(\(void)210 2076 A
(\(*func\)\(void\)\))588 2328 A
4050(\);)S
990 V
(04846)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(monitor,)336 1740 A
(\(void\))252 2118 A
4050(\);)S
1080 V
(04847)210 648 A
1170 V
(04848)210 648 A
1026(/*)S
(misc.c)252 1152 A
1446(*/)S
1260 V
(04849)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(mem_init,)378 1740 A
(\(void\))252 2160 A
4050(\);)S
1350 V
(04850)210 648 A
1440 V
(04851)210 648 A
1026(/*)S
(mpx*.s)252 1152 A
1446(*/)S
1530 V
(04852)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(idle_task,)420 1740 A
(\(void\))252 2202 A
4050(\);)S
1620 V
(04853)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(restart,)336 1740 A
(\(void\))252 2118 A
4050(\);)S
1710 V
(04854)210 648 A
1800 V
(04855)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(are)126 1740 A
(never)210 1908 A
(called)252 2160 A
(from)168 2454 A
2664(C)S
(\(pure)210 2748 A
(asm)126 3000 A
(procs\).)294 3168 A
3504(*/)S
1890 V
(04856)210 648 A
1980 V
(04857)210 648 A
1026(/*)S
(Exception)378 1152 A
(handlers)336 1572 A
(\(real)210 1950 A
2202(or)S
(protected)378 2328 A
(mode\),)252 2748 A
3042(in)S
(numerical)378 3168 A
(order.)252 3588 A
3882(*/)S
2070 V
(04858)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 1236 A
(int00,)252 1740 A
(\(void\))252 2034 A
2328(\),)S
(_PROTOTYPE\()462 2454 A
(divide_error,)546 2958 A
(\(void\))252 3546 A
3840(\);)S
2160 V
(04859)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 1236 A
(int01,)252 1740 A
(\(void\))252 2034 A
2328(\),)S
(_PROTOTYPE\()462 2454 A
(single_step_exception,)924 2958 A
(\(void\))252 3924 A
4218(\);)S
2250 V
(04860)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 1236 A
(int02,)252 1740 A
(\(void\))252 2034 A
2328(\),)S
(_PROTOTYPE\()462 2454 A
(nmi,)168 2958 A
(\(void\))252 3168 A
3462(\);)S
2340 V
(04861)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 1236 A
(int03,)252 1740 A
(\(void\))252 2034 A
2328(\),)S
(_PROTOTYPE\()462 2454 A
(breakpoint_exception,)882 2958 A
(\(void\))252 3882 A
4176(\);)S
2430 V
(04862)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 1236 A
(int04,)252 1740 A
(\(void\))252 2034 A
2328(\),)S
(_PROTOTYPE\()462 2454 A
(overflow,)378 2958 A
(\(void\))252 3378 A
3672(\);)S
2520 V
(04863)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 1236 A
(int05,)252 1740 A
(\(void\))252 2034 A
2328(\),)S
(_PROTOTYPE\()462 2454 A
(bounds_check,)546 2958 A
(\(void\))252 3546 A
3840(\);)S
2610 V
(04864)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 1236 A
(int06,)252 1740 A
(\(void\))252 2034 A
2328(\),)S
(_PROTOTYPE\()462 2454 A
(inval_opcode,)546 2958 A
(\(void\))252 3546 A
3840(\);)S
2700 V
(04865)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 1236 A
(int07,)252 1740 A
(\(void\))252 2034 A
2328(\),)S
(_PROTOTYPE\()462 2454 A
(copr_not_available,)798 2958 A
(\(void\))252 3798 A
4092(\);)S
2790 V
(04866)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 2454 A
(double_fault,)546 2958 A
(\(void\))252 3546 A
3840(\);)S
2880 V
(04867)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 2454 A
(copr_seg_overrun,)714 2958 A
(\(void\))252 3714 A
4008(\);)S
2970 V
(04868)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 2454 A
(inval_tss,)420 2958 A
(\(void\))252 3420 A
3714(\);)S
3060 V
(04869)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 2454 A
(segment_not_present,)840 2958 A
(\(void\))252 3840 A
4134(\);)S
3150 V
(04870)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 2454 A
(stack_exception,)672 2958 A
(\(void\))252 3672 A
3966(\);)S
3240 V
(04871)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 2454 A
(general_protection,)798 2958 A
(\(void\))252 3798 A
4092(\);)S
3330 V
(04872)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 2454 A
(page_fault,)462 2958 A
(\(void\))252 3462 A
3756(\);)S
3420 V
(04873)210 648 A
(void)168 1026 A
(_PROTOTYPE\()462 2454 A
(copr_error,)462 2958 A
(\(void\))252 3462 A
3756(\);)S
3510 V
(04874)210 648 A
3600 V
(04875)210 648 A
1026(/*)S
(Hardware)336 1152 A
(interrupt)378 1530 A
(handlers.)378 1950 A
2370(*/)S
3690 V
(04876)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint00,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
3780 V
(04877)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint01,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
3870 V
(04878)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint02,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
3960 V
(04879)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint03,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
4050 V
(04880)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint04,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
4140 V
(04881)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint05,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
4230 V
(04882)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint06,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
4320 V
(04883)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint07,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
4410 V
(04884)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint08,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
4500 V
(04885)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint09,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
4590 V
(04886)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint10,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
4680 V
(04887)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint11,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
4770 V
(04888)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint12,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
4860 V
(04889)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint13,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
4950 V
(04890)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint14,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
5040 V
(04891)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(hwint15,)336 1740 A
(\(void\))252 2118 A
2412(\);)S
5130 V
(04892)210 648 A
5220 V
(04893)210 648 A
1026(/*)S
(Software)336 1152 A
(interrupt)378 1530 A
(handlers,)378 1950 A
2370(in)S
(numerical)378 2496 A
(order.)252 2916 A
3210(*/)S
5310 V
(04894)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(trp,)168 1740 A
(\(void\))252 1950 A
2244(\);)S
5400 V
(04895)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(s_call,)294 1740 A
(\(void\))252 2076 A
2370(\),)S
(_PROTOTYPE\()462 2496 A
(p_s_call,)378 3000 A
(\(void\))252 3420 A
3714(\);)S
5490 V
(04896)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(level0_call,)504 1740 A
(\(void\))252 2286 A
2580(\);)S
5580 V
(04897)210 648 A
5670 V
(04898)210 648 A
1026(/*)S
(printer.c)378 1152 A
1572(*/)S
5760 V
(04899)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(pr_restart,)462 1740 A
(\(void\))252 2244 A
4050(\);)S
5850 V
(04900)210 648 A
5940 V
(04901)210 648 A
1026(/*)S
(protect.c)378 1152 A
1572(*/)S
6030 V
(04902)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(prot_init,)420 1740 A
(\(void\))252 2202 A
4050(\);)S
6120 V
(04903)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(init_codeseg,)546 1740 A
(\(struct)294 2328 A
(segdesc_s)378 2664 A
(*segdp,)294 3084 A
(phys_bytes)420 3420 A
(base,)210 3882 A
6210 V
(04904)210 648 A
(phys_bytes)420 1698 A
(size,)210 2160 A
(int)126 2412 A
(privilege\))420 2580 A
4050(\);)S
8418 V
EP
%%Page: 57 57
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2028(File:)S
2261(src/kernel/proto.h)S
12 B
4308(57)S
900 V
7 LST
(04905)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(init_dataseg,)546 1740 A
(\(struct)294 2328 A
(segdesc_s)378 2664 A
(*segdp,)294 3084 A
(phys_bytes)420 3420 A
(base,)210 3882 A
990 V
(04906)210 648 A
(phys_bytes)420 1698 A
(size,)210 2160 A
(int)126 2412 A
(privilege\))420 2580 A
4050(\);)S
1080 V
(04907)210 648 A
(_PROTOTYPE\()462 1026 A
(phys_bytes)420 1530 A
(seg2phys,)378 1992 A
(\(U16_t)252 2412 A
(seg\))168 2706 A
4050(\);)S
1170 V
(04908)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(enable_iop,)462 1740 A
(\(struct)294 2244 A
(proc)168 2580 A
(*pp\))168 2790 A
4050(\);)S
1260 V
(04909)210 648 A
1350 V
(04910)210 648 A
1026(/*)S
(pty.c)210 1152 A
1404(*/)S
1440 V
(04911)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(do_pty,)294 1740 A
(\(struct)294 2076 A
(tty)126 2412 A
(*tp,)168 2580 A
(message)294 2790 A
(*m_ptr\))294 3126 A
4050(\);)S
1530 V
(04912)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(pty_init,)378 1740 A
(\(struct)294 2160 A
(tty)126 2496 A
(*tp\))168 2664 A
4050(\);)S
1620 V
(04913)210 648 A
1710 V
(04914)210 648 A
1026(/*)S
(system.c)336 1152 A
1530(*/)S
1800 V
(04915)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(alloc_segments,)630 1740 A
(\(struct)294 2412 A
(proc)168 2748 A
(*rp\))168 2958 A
4050(\);)S
1890 V
(04916)210 648 A
1980 V
(04917)210 648 A
(#endif)252 1026 A
1320(/*)S
(\(CHIP)210 1446 A
1698(==)S
(INTEL\))252 1824 A
2118(*/)S
2070 V
(04918)210 648 A
2160 V
(04919)210 648 A
(#endif)252 1026 A
1320(/*)S
(PROTO_H)294 1446 A
1782(*/)S
2790 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2880 V
(src/kernel/glo.h)672 2034 A
2970 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3150 V
(05000)210 648 A
1026(/*)S
(Global)252 1152 A
(variables)378 1446 A
(used)168 1866 A
2076(in)S
(the)126 2202 A
(kernel.)294 2370 A
2706(*/)S
3240 V
(05001)210 648 A
3330 V
(05002)210 648 A
1026(/*)S
(EXTERN)252 1152 A
1446(is)S
(defined)294 1572 A
1908(as)S
(extern)252 2034 A
(except)252 2328 A
2622(in)S
(table.c.)336 2748 A
3126(*/)S
3420 V
(05003)210 648 A
(#ifdef)252 1026 A
(_TABLE)252 1320 A
3510 V
(05004)210 648 A
(#undef)252 1026 A
(EXTERN)252 1320 A
3600 V
(05005)210 648 A
(#define)294 1026 A
(EXTERN)252 1362 A
3690 V
(05006)210 648 A
(#endif)252 1026 A
3780 V
(05007)210 648 A
3870 V
(05008)210 648 A
1026(/*)S
(Kernel)252 1152 A
(memory.)294 1446 A
1782(*/)S
3960 V
(05009)210 648 A
(EXTERN)252 1026 A
(phys_bytes)420 1320 A
(code_base;)420 1782 A
2370(/*)S
(base)168 2496 A
2706(of)S
(kernel)252 2832 A
(code)168 3126 A
3336(*/)S
4050 V
(05010)210 648 A
(EXTERN)252 1026 A
(phys_bytes)420 1320 A
(data_base;)420 1782 A
2370(/*)S
(base)168 2496 A
2706(of)S
(kernel)252 2832 A
(data)168 3126 A
3336(*/)S
4140 V
(05011)210 648 A
4230 V
(05012)210 648 A
1026(/*)S
(Low)126 1152 A
(level)210 1320 A
(interrupt)378 1572 A
(communications.)630 1992 A
2664(*/)S
4320 V
(05013)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(proc)168 1614 A
(*held_head;)462 1824 A
2370(/*)S
(head)168 2496 A
2706(of)S
(queue)210 2832 A
3084(of)S
(held-up)294 3210 A
(interrupts)420 3546 A
4008(*/)S
4410 V
(05014)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(proc)168 1614 A
(*held_tail;)462 1824 A
2370(/*)S
(tail)168 2496 A
2706(of)S
(queue)210 2832 A
3084(of)S
(held-up)294 3210 A
(interrupts)420 3546 A
4008(*/)S
4500 V
(05015)210 648 A
(EXTERN)252 1026 A
(unsigned)336 1320 A
(char)168 1698 A
(k_reenter;)420 1908 A
2370(/*)S
(kernel)252 2496 A
(reentry)294 2790 A
(count)210 3126 A
(\(entry)252 3378 A
(count)210 3672 A
(less)168 3924 A
(1\)*/)168 4134 A
4590 V
(05016)210 648 A
4680 V
(05017)210 648 A
1026(/*)S
(Process)294 1152 A
(table.)252 1488 A
(Here)168 1824 A
2034(to)S
(stop)168 2160 A
(too)126 2370 A
(many)168 2538 A
(things)252 2748 A
(having)252 3042 A
3336(to)S
(include)294 3462 A
(proc.h.)294 3798 A
4134(*/)S
4770 V
(05018)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(proc)168 1614 A
(*proc_ptr;)420 1824 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(currently)378 2958 A
(running)294 3378 A
(process)294 3714 A
4050(*/)S
4860 V
(05019)210 648 A
4950 V
(05020)210 648 A
1026(/*)S
(Signals.)336 1152 A
1530(*/)S
5040 V
(05021)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(sig_procs;)420 1488 A
2370(/*)S
(number)252 2496 A
2790(of)S
(procs)210 2916 A
(with)168 3168 A
(p_pending)378 3378 A
3798(!=)S
3924(0)S
4008(*/)S
5130 V
(05022)210 648 A
5220 V
(05023)210 648 A
1026(/*)S
(Memory)252 1152 A
(sizes.)252 1446 A
1740(*/)S
5310 V
(05024)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(memory)252 1614 A
(mem[NR_MEMS];)546 1908 A
2706(/*)S
(base)168 2832 A
(and)126 3042 A
(size)168 3210 A
3420(of)S
(chunks)252 3546 A
3840(of)S
(memory)252 3966 A
4260(*/)S
5400 V
(05025)210 648 A
(EXTERN)252 1026 A
(phys_clicks)462 1320 A
(tot_mem_size;)546 1824 A
2706(/*)S
(total)210 2832 A
(system)252 3084 A
(memory)252 3378 A
(size)168 3672 A
3882(*/)S
5490 V
(05026)210 648 A
5580 V
(05027)210 648 A
1026(/*)S
(Miscellaneous.)588 1152 A
1782(*/)S
5670 V
(05028)210 648 A
(extern)252 1026 A
(u16_t)210 1320 A
(sizes[];)336 1572 A
2370(/*)S
(table)210 2496 A
(filled)252 2748 A
3042(in)S
3168(by)S
(boot)168 3294 A
(monitor)294 3504 A
3840(*/)S
5760 V
(05029)210 648 A
(extern)252 1026 A
(struct)252 1320 A
(tasktab)294 1614 A
(tasktab[];/*)504 1950 A
(initialized)462 2496 A
3000(in)S
(table.c,)336 3126 A
3504(so)S
(extern)252 3630 A
(here)168 3924 A
4134(*/)S
5850 V
(05030)210 648 A
(extern)252 1026 A
(char)168 1320 A
(*t_stack[];)462 1530 A
2370(/*)S
(initialized)462 2496 A
3000(in)S
(table.c,)336 3126 A
3504(so)S
(extern)252 3630 A
(here)168 3924 A
4134(*/)S
5940 V
(05031)210 648 A
(EXTERN)252 1026 A
(unsigned)336 1320 A
(lost_ticks;)462 1698 A
2370(/*)S
(clock)210 2496 A
(ticks)210 2748 A
(counted)294 3000 A
(outside)294 3336 A
(the)126 3672 A
(clock)210 3840 A
(task)168 4092 A
4302(*/)S
6030 V
(05032)210 648 A
(EXTERN)252 1026 A
(clock_t)294 1320 A
(tty_timeout;)504 1656 A
2370(/*)S
(time)168 2496 A
2706(to)S
(wake)168 2832 A
3042(up)S
(the)126 3168 A
(TTY)126 3336 A
(task)168 3504 A
3714(*/)S
6120 V
(05033)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(current;)336 1488 A
2370(/*)S
(currently)378 2496 A
(visible)294 2916 A
(console)294 3252 A
3588(*/)S
6210 V
(05034)210 648 A
8418 V
EP
%%Page: 58 58
BP
/slant 0 def
/height 0 def
630 V
12 B
648(58)S
11 R
2074(File:)S
2307(src/kernel/glo.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(05035)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
990 V
(05036)210 648 A
1080 V
(05037)210 648 A
1026(/*)S
(Machine)294 1152 A
(type.)210 1488 A
1740(*/)S
1170 V
(05038)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(pc_at;)252 1488 A
2370(/*)S
(PC-AT)210 2496 A
(compatible)420 2748 A
(hardware)336 3210 A
(interface)378 3588 A
4008(*/)S
1260 V
(05039)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(ps_mca;)294 1488 A
2370(/*)S
(PS/2)168 2496 A
(with)168 2706 A
(Micro)210 2916 A
(Channel)294 3168 A
3504(*/)S
1350 V
(05040)210 648 A
(EXTERN)252 1026 A
(unsigned)336 1320 A
(int)126 1698 A
(processor;)420 1866 A
2370(/*)S
(86,)126 2496 A
(186,)168 2664 A
(286,)168 2874 A
(386,)168 3084 A
(...)126 3294 A
3462(*/)S
1440 V
(05041)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(2)S
1530 V
(05042)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(protected_mode;)630 1488 A
2370(/*)S
(nonzero)294 2496 A
2832(if)S
(running)294 2958 A
3294(in)S
(Intel)210 3420 A
(protected)378 3672 A
(mode*/)252 4092 A
1620 V
(05043)210 648 A
(#else)210 1026 A
1710 V
(05044)210 648 A
(#define)294 1026 A
(protected_mode)588 1362 A
2034(1)S
2370(/*)S
(386)126 2496 A
(mode)168 2664 A
(implies)294 2874 A
(protected)378 3210 A
(mode)168 3630 A
3840(*/)S
1800 V
(05045)210 648 A
(#endif)252 1026 A
1890 V
(05046)210 648 A
1980 V
(05047)210 648 A
1026(/*)S
(Video)210 1152 A
(card)168 1404 A
(types.)252 1614 A
1908(*/)S
2070 V
(05048)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(ega;)168 1488 A
2370(/*)S
(nonzero)294 2496 A
2832(if)S
(console)294 2958 A
3294(is)S
(EGA)126 3420 A
3588(or)S
(VGA)126 3714 A
3882(*/)S
2160 V
(05049)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(vga;)168 1488 A
2370(/*)S
(nonzero)294 2496 A
2832(if)S
(console)294 2958 A
3294(is)S
(VGA)126 3420 A
3588(*/)S
2250 V
(05050)210 648 A
2340 V
(05051)210 648 A
1026(/*)S
(Memory)252 1152 A
(sizes.)252 1446 A
1740(*/)S
2430 V
(05052)210 648 A
(EXTERN)252 1026 A
(unsigned)336 1320 A
(ext_memsize;)504 1698 A
2370(/*)S
(initialized)462 2496 A
3000(by)S
(assembler)378 3126 A
(startup)294 3546 A
(code)168 3882 A
4092(*/)S
2520 V
(05053)210 648 A
(EXTERN)252 1026 A
(unsigned)336 1320 A
(low_memsize;)504 1698 A
2610 V
(05054)210 648 A
2700 V
(05055)210 648 A
1026(/*)S
(Miscellaneous.)588 1152 A
1782(*/)S
2790 V
(05056)210 648 A
(EXTERN)252 1026 A
(irq_handler_t)546 1320 A
(irq_table[NR_IRQ_VECTORS];)1092 1908 A
2880 V
(05057)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(irq_use;)336 1488 A
2370(/*)S
(bit)126 2496 A
(map)126 2664 A
2832(of)S
(all)126 2958 A
(in-use)252 3126 A
(irq's)210 3420 A
3672(*/)S
2970 V
(05058)210 648 A
(EXTERN)252 1026 A
(reg_t)210 1320 A
(mon_ss,)294 1572 A
(mon_sp;)294 1908 A
2370(/*)S
(monitor)294 2496 A
(stack)210 2832 A
3084(*/)S
3060 V
(05059)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(mon_return;)462 1488 A
2370(/*)S
(true)168 2496 A
2706(if)S
(return)252 2832 A
3126(to)S
(the)126 3252 A
(monitor)294 3420 A
(possible)336 3756 A
4134(*/)S
3150 V
(05060)210 648 A
(EXTERN)252 1026 A
(phys_bytes)420 1320 A
(reboot_code;)504 1782 A
2370(/*)S
(program)294 2496 A
(for)126 2832 A
(the)126 3000 A
(boot)168 3168 A
(monitor)294 3378 A
3714(*/)S
3240 V
(05061)210 648 A
3330 V
(05062)210 648 A
1026(/*)S
(Variables)378 1152 A
(that)168 1572 A
(are)126 1782 A
(initialized)462 1950 A
(elsewhere)378 2454 A
(are)126 2874 A
(just)168 3042 A
(extern)252 3252 A
(here.)210 3546 A
3798(*/)S
3420 V
(05063)210 648 A
(extern)252 1026 A
(struct)252 1320 A
(segdesc_s)378 1614 A
(gdt[];)252 2034 A
2370(/*)S
(global)252 2496 A
(descriptor)420 2790 A
(table)210 3252 A
(for)126 3504 A
(protected)378 3672 A
(mode*/)252 4092 A
3510 V
(05064)210 648 A
3600 V
(05065)210 648 A
(EXTERN)252 1026 A
(_PROTOTYPE\()462 1320 A
(void)168 1824 A
(\(*level0_func\),)630 2034 A
(\(void\))252 2706 A
3000(\);)S
3690 V
(05066)210 648 A
(#endif)252 1026 A
1320(/*)S
(\(CHIP)210 1446 A
1698(==)S
(INTEL\))252 1824 A
2118(*/)S
3780 V
(05067)210 648 A
3870 V
(05068)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(M68000\))294 1572 A
3960 V
(05069)210 648 A
1026(/*)S
(Variables)378 1152 A
(that)168 1572 A
(are)126 1782 A
(initialized)462 1950 A
(elsewhere)378 2454 A
(are)126 2874 A
(just)168 3042 A
(extern)252 3252 A
(here.)210 3546 A
3798(*/)S
4050 V
(05070)210 648 A
(extern)252 1026 A
(int)126 1320 A
(keypad;)294 1488 A
2370(/*)S
(Flag)168 2496 A
(for)126 2706 A
(keypad)252 2874 A
(mode)168 3168 A
3378(*/)S
4140 V
(05071)210 648 A
(extern)252 1026 A
(int)126 1320 A
(app_mode;)378 1488 A
2370(/*)S
(Flag)168 2496 A
(for)126 2706 A
(arrow)210 2874 A
(key)126 3126 A
(application)462 3294 A
(mode)168 3798 A
4008(*/)S
4230 V
(05072)210 648 A
(extern)252 1026 A
(int)126 1320 A
(STdebKey;)378 1488 A
2370(/*)S
(nonzero)294 2496 A
2832(if)S
(ctl-alt-Fx)420 2958 A
(detected)336 3420 A
3798(*/)S
4320 V
(05073)210 648 A
(extern)252 1026 A
(struct)252 1320 A
(tty)126 1614 A
(*cur_cons;)420 1782 A
2370(/*)S
(virtual)294 2496 A
(cons)168 2832 A
(currently)378 3042 A
(displayed)378 3462 A
3882(*/)S
4410 V
(05074)210 648 A
(extern)252 1026 A
(unsigned)336 1320 A
(char)168 1698 A
(font8[];)336 1908 A
2370(/*)S
2496(8)S
(pixel)210 2580 A
(wide)168 2832 A
(font)168 3042 A
(table)210 3252 A
(\(initialized\))546 3504 A
4092(*/)S
4500 V
(05075)210 648 A
(extern)252 1026 A
(unsigned)336 1320 A
(char)168 1698 A
(font12[];)378 1908 A
2370(/*)S
2496(12)S
(pixel)210 2622 A
(wide)168 2874 A
(font)168 3084 A
(table)210 3294 A
(\(initialized\))546 3546 A
4134(*/)S
4590 V
(05076)210 648 A
(extern)252 1026 A
(unsigned)336 1320 A
(char)168 1698 A
(font16[];)378 1908 A
2370(/*)S
2496(16)S
(pixel)210 2622 A
(wide)168 2874 A
(font)168 3084 A
(table)210 3294 A
(\(initialized\))546 3546 A
4134(*/)S
4680 V
(05077)210 648 A
(extern)252 1026 A
(unsigned)336 1320 A
(short)210 1698 A
(resolution;)462 1950 A
2454(/*)S
(screen)252 2580 A
(res;)168 2874 A
(ST_RES_LOW..TT_RES_HIGH)966 3084 A
4092(*/)S
4770 V
(05078)210 648 A
(#endif)252 1026 A
5040 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5130 V
(src/kernel/proc.h)714 2034 A
5220 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5400 V
(05100)210 648 A
(#ifndef)294 1026 A
(PROC_H)252 1362 A
5490 V
(05101)210 648 A
(#define)294 1026 A
(PROC_H)252 1362 A
5580 V
(05102)210 648 A
5670 V
(05103)210 648 A
1026(/*)S
(Here)168 1152 A
1362(is)S
(the)126 1488 A
(declaration)462 1656 A
2160(of)S
(the)126 2286 A
(process)294 2454 A
(table.)252 2790 A
3126(It)S
(contains)336 3252 A
(the)126 3630 A
(process')336 3798 A
5760 V
(05104)210 648 A
1068(*)S
(registers,)420 1152 A
(memory)252 1614 A
(map,)168 1908 A
(accounting,)462 2118 A
(and)126 2622 A
(message)294 2790 A
(send/receive)504 3126 A
(information.)504 3672 A
5850 V
(05105)210 648 A
1068(*)S
(Many)168 1152 A
(assembly)336 1362 A
(code)168 1740 A
(routines)336 1950 A
(reference)378 2328 A
(fields)252 2748 A
3042(in)S
(it.)126 3168 A
(The)126 3378 A
(offsets)294 3546 A
3882(to)S
(these)210 4008 A
5940 V
(05106)210 648 A
1068(*)S
(fields)252 1152 A
(are)126 1446 A
(defined)294 1614 A
1950(in)S
(the)126 2076 A
(assembler)378 2244 A
(include)294 2664 A
(file)168 3000 A
(sconst.h.)378 3210 A
(When)168 3672 A
(changing)336 3882 A
6030 V
(05107)210 648 A
1068(*)S
('proc',)294 1152 A
1488(be)S
(sure)168 1614 A
1824(to)S
(change)252 1950 A
(sconst.h)336 2244 A
2622(to)S
(match.)252 2748 A
6120 V
(05108)210 648 A
1068(*/)S
6210 V
(05109)210 648 A
8418 V
EP
%%Page: 59 59
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2046(File:)S
2279(src/kernel/proc.h)S
12 B
4308(59)S
900 V
7 LST
(05110)210 648 A
(struct)252 1026 A
(proc)168 1320 A
1530({)S
990 V
(05111)210 648 A
(struct)252 1110 A
(stackframe_s)504 1404 A
(p_reg;)252 1950 A
2370(/*)S
(process')336 2496 A
(registers)378 2874 A
(saved)210 3294 A
3546(in)S
(stack)210 3672 A
(frame)210 3924 A
4176(*/)S
1080 V
(05112)210 648 A
1170 V
(05113)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
1260 V
(05114)210 648 A
(reg_t)210 1110 A
(p_ldt_sel;)420 1362 A
2370(/*)S
(selector)336 2496 A
2874(in)S
(gdt)126 3000 A
(giving)252 3168 A
(ldt)126 3462 A
(base)168 3630 A
(and)126 3840 A
(limit*/)294 4008 A
1350 V
(05115)210 648 A
(struct)252 1110 A
(segdesc_s)378 1404 A
(p_ldt[2];)378 1824 A
2370(/*)S
(local)210 2496 A
(descriptors)462 2748 A
(for)126 3252 A
(code)168 3420 A
(and)126 3630 A
(data)168 3798 A
4008(*/)S
1440 V
(05116)210 648 A
2370(/*)S
2496(2)S
2580(is)S
(LDT_SIZE)336 2706 A
3084(-)S
(avoid)210 3168 A
(include)294 3420 A
(protect.h)378 3756 A
4176(*/)S
1530 V
(05117)210 648 A
(#endif)252 1026 A
1320(/*)S
(\(CHIP)210 1446 A
1698(==)S
(INTEL\))252 1824 A
2118(*/)S
1620 V
(05118)210 648 A
1710 V
(05119)210 648 A
(reg_t)210 1110 A
(*p_stguard;)462 1362 A
2370(/*)S
(stack)210 2496 A
(guard)210 2748 A
(word)168 3000 A
3210(*/)S
1800 V
(05120)210 648 A
1890 V
(05121)210 648 A
(int)126 1110 A
(p_nr;)210 1278 A
2370(/*)S
(number)252 2496 A
2790(of)S
(this)168 2916 A
(process)294 3126 A
(\(for)168 3462 A
(fast)168 3672 A
(access\))294 3882 A
4218(*/)S
1980 V
(05122)210 648 A
2070 V
(05123)210 648 A
(int)126 1110 A
(p_int_blocked;)588 1278 A
2370(/*)S
(nonzero)294 2496 A
2832(if)S
(int)126 2958 A
(msg)126 3126 A
(blocked)294 3294 A
3630(by)S
(busy)168 3756 A
(task)168 3966 A
4176(*/)S
2160 V
(05124)210 648 A
(int)126 1110 A
(p_int_held;)462 1278 A
2370(/*)S
(nonzero)294 2496 A
2832(if)S
(int)126 2958 A
(msg)126 3126 A
(held)168 3294 A
3504(by)S
(busy)168 3630 A
(syscall)294 3840 A
4176(*/)S
2250 V
(05125)210 648 A
(struct)252 1110 A
(proc)168 1404 A
(*p_nextheld;)504 1614 A
2370(/*)S
(next)168 2496 A
2706(in)S
(chain)210 2832 A
3084(of)S
(held-up)294 3210 A
(int)126 3546 A
(processes)378 3714 A
4134(*/)S
2340 V
(05126)210 648 A
2430 V
(05127)210 648 A
(int)126 1110 A
(p_flags;)336 1278 A
2370(/*)S
(P_SLOT_FREE,)504 2496 A
(SENDING,)336 3042 A
(RECEIVING,)420 3420 A
(etc.)168 3882 A
4092(*/)S
2520 V
(05128)210 648 A
(struct)252 1110 A
(mem_map)294 1404 A
(p_map[NR_SEGS];/*)714 1740 A
(memory)252 2496 A
(map)126 2790 A
2958(*/)S
2610 V
(05129)210 648 A
(pid_t)210 1110 A
(p_pid;)252 1362 A
2370(/*)S
(process)294 2496 A
2832(id)S
(passed)252 2958 A
3252(in)S
(from)168 3378 A
3588(MM)S
3714(*/)S
2700 V
(05130)210 648 A
2790 V
(05131)210 648 A
(clock_t)294 1110 A
(user_time;)420 1446 A
2370(/*)S
(user)168 2496 A
(time)168 2706 A
2916(in)S
(ticks)210 3042 A
3294(*/)S
2880 V
(05132)210 648 A
(clock_t)294 1110 A
(sys_time;)378 1446 A
2370(/*)S
(sys)126 2496 A
(time)168 2664 A
2874(in)S
(ticks)210 3000 A
3252(*/)S
2970 V
(05133)210 648 A
(clock_t)294 1110 A
(child_utime;)504 1446 A
2370(/*)S
(cumulative)420 2496 A
(user)168 2958 A
(time)168 3168 A
3378(of)S
(children)336 3504 A
3882(*/)S
3060 V
(05134)210 648 A
(clock_t)294 1110 A
(child_stime;)504 1446 A
2370(/*)S
(cumulative)420 2496 A
(sys)126 2958 A
(time)168 3126 A
3336(of)S
(children)336 3462 A
3840(*/)S
3150 V
(05135)210 648 A
(clock_t)294 1110 A
(p_alarm;)336 1446 A
2370(/*)S
(time)168 2496 A
2706(of)S
(next)168 2832 A
(alarm)210 3042 A
3294(in)S
(ticks,)252 3420 A
3714(or)S
3840(0)S
3924(*/)S
3240 V
(05136)210 648 A
3330 V
(05137)210 648 A
(struct)252 1110 A
(proc)168 1404 A
(*p_callerq;)462 1614 A
2370(/*)S
(head)168 2496 A
2706(of)S
(list)168 2832 A
3042(of)S
(procs)210 3168 A
(wishing)294 3420 A
3756(to)S
(send)168 3882 A
4092(*/)S
3420 V
(05138)210 648 A
(struct)252 1110 A
(proc)168 1404 A
(*p_sendlink;)504 1614 A
2370(/*)S
(link)168 2496 A
2706(to)S
(next)168 2832 A
(proc)168 3042 A
(wishing)294 3252 A
3588(to)S
(send)168 3714 A
3924(*/)S
3510 V
(05139)210 648 A
(message)294 1110 A
(*p_messbuf;)462 1446 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
(buffer)252 3294 A
3588(*/)S
3600 V
(05140)210 648 A
(int)126 1110 A
(p_getfrom;)420 1278 A
2370(/*)S
(from)168 2496 A
(whom)168 2706 A
(does)168 2916 A
(process)294 3126 A
(want)168 3462 A
3672(to)S
(receive?)336 3798 A
4176(*/)S
3690 V
(05141)210 648 A
(int)126 1110 A
(p_sendto;)378 1278 A
3780 V
(05142)210 648 A
3870 V
(05143)210 648 A
(struct)252 1110 A
(proc)168 1404 A
(*p_nextready;)546 1614 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(next)168 2958 A
(ready)210 3168 A
(process)294 3420 A
3756(*/)S
3960 V
(05144)210 648 A
(sigset_t)336 1110 A
(p_pending;)420 1488 A
2370(/*)S
(bit)126 2496 A
(map)126 2664 A
(for)126 2832 A
(pending)294 3000 A
(signals)294 3336 A
3672(*/)S
4050 V
(05145)210 648 A
(unsigned)336 1110 A
(p_pendcount;)504 1488 A
2370(/*)S
(count)210 2496 A
2748(of)S
(pending)294 2874 A
(and)126 3210 A
(unfinished)420 3378 A
(signals)294 3840 A
4176(*/)S
4140 V
(05146)210 648 A
4230 V
(05147)210 648 A
(char)168 1110 A
(p_name[16];)462 1320 A
2370(/*)S
(name)168 2496 A
2706(of)S
(the)126 2832 A
(process)294 3000 A
3336(*/)S
4320 V
(05148)210 648 A
1026(};)S
4410 V
(05149)210 648 A
4500 V
(05150)210 648 A
1026(/*)S
(Guard)210 1152 A
(word)168 1404 A
(for)126 1614 A
(task)168 1782 A
(stacks.)294 1992 A
2328(*/)S
4590 V
(05151)210 648 A
(#define)294 1026 A
(STACK_GUARD)462 1362 A
(\(\(reg_t\))336 2034 A
(\(sizeof\(reg_t\))588 2412 A
3042(==)S
3168(2)S
3252(?)S
(0xBEEF)252 3336 A
3630(:)S
(0xDEADBEEF\)\))504 3714 A
4680 V
(05152)210 648 A
4770 V
(05153)210 648 A
1026(/*)S
(Bits)168 1152 A
(for)126 1362 A
(p_flags)294 1530 A
1866(in)S
(proc[].)294 1992 A
2370(A)S
(process)294 2454 A
2790(is)S
(runnable)336 2916 A
(iff)126 3294 A
(p_flags)294 3462 A
3798(==)S
3924(0.)S
4050(*/)S
4860 V
(05154)210 648 A
(#define)294 1026 A
(P_SLOT_FREE)462 1362 A
(001)126 2076 A
2370(/*)S
(set)126 2496 A
(when)168 2664 A
(slot)168 2874 A
3084(is)S
(not)126 3210 A
3378(in)S
(use)126 3504 A
3672(*/)S
4950 V
(05155)210 648 A
(#define)294 1026 A
(NO_MAP)252 1362 A
(002)126 2076 A
2370(/*)S
(keeps)210 2496 A
(unmapped)336 2748 A
(forked)252 3126 A
(child)210 3420 A
(from)168 3672 A
(running)294 3882 A
4218(*/)S
5040 V
(05156)210 648 A
(#define)294 1026 A
(SENDING)294 1362 A
(004)126 2076 A
2370(/*)S
(set)126 2496 A
(when)168 2664 A
(process)294 2874 A
(blocked)294 3210 A
(trying)252 3546 A
3840(to)S
(send)168 3966 A
4176(*/)S
5130 V
(05157)210 648 A
(#define)294 1026 A
(RECEIVING)378 1362 A
(010)126 2076 A
2370(/*)S
(set)126 2496 A
(when)168 2664 A
(process)294 2874 A
(blocked)294 3210 A
(trying)252 3546 A
3840(to)S
(recv)168 3966 A
4176(*/)S
5220 V
(05158)210 648 A
(#define)294 1026 A
(PENDING)294 1362 A
(020)126 2076 A
2370(/*)S
(set)126 2496 A
(when)168 2664 A
(inform\(\))336 2874 A
3252(of)S
(signal)252 3378 A
(pending)294 3672 A
4008(*/)S
5310 V
(05159)210 648 A
(#define)294 1026 A
(SIG_PENDING)462 1362 A
(040)126 2076 A
2370(/*)S
(keeps)210 2496 A
(to-be-signalled)630 2748 A
(proc)168 3420 A
(from)168 3630 A
(running)294 3840 A
4176(*/)S
5400 V
(05160)210 648 A
(#define)294 1026 A
(P_STOP)252 1362 A
(0100)168 2034 A
2370(/*)S
(set)126 2496 A
(when)168 2664 A
(process)294 2874 A
3210(is)S
(being)210 3336 A
(traced)252 3588 A
3882(*/)S
5490 V
(05161)210 648 A
5580 V
(05162)210 648 A
1026(/*)S
(Magic)210 1152 A
(process)294 1404 A
(table)210 1740 A
(addresses.)420 1992 A
2454(*/)S
5670 V
(05163)210 648 A
(#define)294 1026 A
(BEG_PROC_ADDR)546 1362 A
(\(&proc[0]\))420 1950 A
5760 V
(05164)210 648 A
(#define)294 1026 A
(END_PROC_ADDR)546 1362 A
(\(&proc[NR_TASKS)630 1950 A
2622(+)S
(NR_PROCS]\))420 2706 A
5850 V
(05165)210 648 A
(#define)294 1026 A
(END_TASK_ADDR)546 1362 A
(\(&proc[NR_TASKS]\))714 1950 A
5940 V
(05166)210 648 A
(#define)294 1026 A
(BEG_SERV_ADDR)546 1362 A
(\(&proc[NR_TASKS]\))714 1950 A
6030 V
(05167)210 648 A
(#define)294 1026 A
(BEG_USER_ADDR)546 1362 A
(\(&proc[NR_TASKS)630 1950 A
2622(+)S
(LOW_USER]\))420 2706 A
6120 V
(05168)210 648 A
6210 V
(05169)210 648 A
(#define)294 1026 A
(NIL_PROC)336 1362 A
(\(\(struct)336 2118 A
(proc)168 2496 A
2706(*\))S
2832(0\))S
8418 V
EP
%%Page: 60 60
BP
/slant 0 def
/height 0 def
630 V
12 B
648(60)S
11 R
2046(File:)S
2279(src/kernel/proc.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(05170)210 648 A
(#define)294 1026 A
(isidlehardware\(n\))714 1362 A
(\(\(n\))168 2118 A
2328(==)S
(IDLE)168 2454 A
2664(||)S
(\(n\))126 2790 A
2958(==)S
(HARDWARE\))378 3084 A
990 V
(05171)210 648 A
(#define)294 1026 A
(isokprocn\(n\))504 1362 A
(\(\(unsigned\))462 2118 A
(\(\(n\))168 2622 A
2832(+)S
(NR_TASKS\))378 2916 A
3336(<)S
(NR_PROCS)336 3420 A
3798(+)S
(NR_TASKS\))378 3882 A
1080 V
(05172)210 648 A
(#define)294 1026 A
(isoksrc_dest\(n\))630 1362 A
(\(isokprocn\(n\))546 2118 A
2706(||)S
(\(n\))126 2832 A
3000(==)S
(ANY\))168 3126 A
1170 V
(05173)210 648 A
(#define)294 1026 A
(isoksusern\(n\))546 1362 A
(\(\(unsigned\))462 2118 A
(\(n\))126 2622 A
2790(<)S
(NR_PROCS\))378 2874 A
1260 V
(05174)210 648 A
(#define)294 1026 A
(isokusern\(n\))504 1362 A
(\(\(unsigned\))462 2118 A
(\(\(n\))168 2622 A
2832(-)S
(LOW_USER\))378 2916 A
3336(<)S
(NR_PROCS)336 3420 A
3798(-)S
(LOW_USER\))378 3882 A
1350 V
(05175)210 648 A
(#define)294 1026 A
(isrxhardware\(n\))630 1362 A
(\(\(n\))168 2118 A
2328(==)S
(ANY)126 2454 A
2622(||)S
(\(n\))126 2748 A
2916(==)S
(HARDWARE\))378 3042 A
1440 V
(05176)210 648 A
(#define)294 1026 A
(issysentn\(n\))504 1362 A
(\(\(n\))168 2118 A
2328(==)S
(FS_PROC_NR)420 2454 A
2916(||)S
(\(n\))126 3042 A
3210(==)S
(MM_PROC_NR\))462 3336 A
1530 V
(05177)210 648 A
(#define)294 1026 A
(istaskp\(p\))420 1362 A
(\(\(p\))168 2118 A
2328(<)S
(END_TASK_ADDR)546 2412 A
3000(&&)S
(\(p\))126 3126 A
3294(!=)S
(proc_addr\(IDLE\)\))672 3420 A
1620 V
(05178)210 648 A
(#define)294 1026 A
(isuserp\(p\))420 1362 A
(\(\(p\))168 2118 A
2328(>=)S
(BEG_USER_ADDR\))588 2454 A
1710 V
(05179)210 648 A
(#define)294 1026 A
(proc_addr\(n\))504 1362 A
(\(pproc_addr)462 2118 A
2622(+)S
(NR_TASKS\)[\(n\)])588 2706 A
1800 V
(05180)210 648 A
(#define)294 1026 A
(cproc_addr\(n\))546 1362 A
(\(&\(proc)294 2118 A
2454(+)S
(NR_TASKS\)[\(n\)]\))630 2538 A
1890 V
(05181)210 648 A
(#define)294 1026 A
(proc_number\(p\))588 1362 A
(\(\(p\)->p_nr\))462 2118 A
1980 V
(05182)210 648 A
(#define)294 1026 A
(proc_vir2phys\(p,)672 1362 A
(vir\))168 2076 A
2286(\\)S
2070 V
(05183)210 648 A
(\(\(\(phys_bytes\)\(p\)->p_map[D].mem_phys)1512 2118 A
3672(<<)S
(CLICK_SHIFT\))504 3798 A
4344(\\)S
2160 V
(05184)210 648 A
3378(+)S
(\(vir_bytes\))462 3462 A
(\(vir\)\))252 3966 A
2250 V
(05185)210 648 A
2340 V
(05186)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(proc)168 1614 A
(proc[NR_TASKS)546 1824 A
2412(+)S
(NR_PROCS];)420 2496 A
3042(/*)S
(process)294 3168 A
(table)210 3504 A
3756(*/)S
2430 V
(05187)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(proc)168 1614 A
(*pproc_addr[NR_TASKS)840 1824 A
2706(+)S
(NR_PROCS];)420 2790 A
2520 V
(05188)210 648 A
1026(/*)S
(ptrs)168 1152 A
1362(to)S
(process)294 1488 A
(table)210 1824 A
(slots;)252 2076 A
(fast)168 2370 A
(because)294 2580 A
(now)126 2916 A
3084(a)S
(process)294 3168 A
(entry)210 3504 A
(can)126 3756 A
3924(be)S
(found)210 4050 A
2610 V
(05189)210 648 A
1152(by)S
(indexing)336 1278 A
(the)126 1656 A
(pproc_addr)420 1824 A
(array,)252 2286 A
(while)210 2580 A
(accessing)378 2832 A
3252(an)S
(element)294 3378 A
3714(i)S
(requires)336 3798 A
2700 V
(05190)210 648 A
1152(a)S
(multiplication)588 1236 A
(with)168 1866 A
(sizeof\(struct)546 2076 A
(proc\))210 2664 A
2916(to)S
(determine)378 3042 A
(the)126 3462 A
(address)294 3630 A
3966(*/)S
2790 V
(05191)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(proc)168 1614 A
(*bill_ptr;)420 1824 A
2370(/*)S
(ptr)126 2496 A
2664(to)S
(process)294 2790 A
3126(to)S
(bill)168 3252 A
(for)126 3462 A
(clock)210 3630 A
(ticks)210 3882 A
4134(*/)S
2880 V
(05192)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(proc)168 1614 A
(*rdy_head[NQ];)588 1824 A
2706(/*)S
(pointers)336 2832 A
3210(to)S
(ready)210 3336 A
(list)168 3588 A
(headers)294 3798 A
4134(*/)S
2970 V
(05193)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(proc)168 1614 A
(*rdy_tail[NQ];)588 1824 A
2706(/*)S
(pointers)336 2832 A
3210(to)S
(ready)210 3336 A
(list)168 3588 A
(tails)210 3798 A
4050(*/)S
3060 V
(05194)210 648 A
3150 V
(05195)210 648 A
(#endif)252 1026 A
1320(/*)S
(PROC_H)252 1446 A
1740(*/)S
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(src/kernel/protect.h)840 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(05200)210 648 A
1026(/*)S
(Constants)378 1152 A
(for)126 1572 A
(protected)378 1740 A
(mode.)210 2160 A
2412(*/)S
4140 V
(05201)210 648 A
4230 V
(05202)210 648 A
1026(/*)S
(Table)210 1152 A
(sizes.)252 1404 A
1698(*/)S
4320 V
(05203)210 648 A
(#define)294 1026 A
(GDT_SIZE)336 1362 A
(\(FIRST_LDT_INDEX)672 1740 A
2454(+)S
(NR_TASKS)336 2538 A
2916(+)S
(NR_PROCS\))378 3000 A
3420(/*)S
(spec.)210 3546 A
(and)126 3798 A
(LDT's)210 3966 A
4218(*/)S
4410 V
(05204)210 648 A
(#define)294 1026 A
(IDT_SIZE)336 1362 A
(\(IRQ8_VECTOR)504 1740 A
2286(+)S
2370(8\))S
2706(/*)S
(only)168 2832 A
3042(up)S
3168(to)S
(the)126 3294 A
(highest)294 3462 A
(vector)252 3798 A
4092(*/)S
4500 V
(05205)210 648 A
(#define)294 1026 A
(LDT_SIZE)336 1362 A
2076(2)S
2370(/*)S
(contains)336 2496 A
2874(CS)S
(and)126 3000 A
3168(DS)S
(only)168 3294 A
3504(*/)S
4590 V
(05206)210 648 A
4680 V
(05207)210 648 A
1026(/*)S
(Fixed)210 1152 A
(global)252 1404 A
(descriptors.)504 1698 A
2286(1)S
2370(to)S
2496(7)S
(are)126 2580 A
(prescribed)420 2748 A
3210(by)S
(the)126 3336 A
(BIOS.)210 3504 A
3756(*/)S
4770 V
(05208)210 648 A
(#define)294 1026 A
(GDT_INDEX)378 1362 A
2076(1)S
2370(/*)S
(GDT)126 2496 A
(descriptor)420 2664 A
3126(*/)S
4860 V
(05209)210 648 A
(#define)294 1026 A
(IDT_INDEX)378 1362 A
2076(2)S
2370(/*)S
(IDT)126 2496 A
(descriptor)420 2664 A
3126(*/)S
4950 V
(05210)210 648 A
(#define)294 1026 A
(DS_INDEX)336 1362 A
2076(3)S
2370(/*)S
(kernel)252 2496 A
2790(DS)S
2916(*/)S
5040 V
(05211)210 648 A
(#define)294 1026 A
(ES_INDEX)336 1362 A
2076(4)S
2370(/*)S
(kernel)252 2496 A
2790(ES)S
(\(386:)210 2916 A
(flag)168 3168 A
3378(4)S
3462(Gb)S
3588(at)S
(startup\))336 3714 A
4092(*/)S
5130 V
(05212)210 648 A
(#define)294 1026 A
(SS_INDEX)336 1362 A
2076(5)S
2370(/*)S
(kernel)252 2496 A
2790(SS)S
(\(386:)210 2916 A
(monitor)294 3168 A
3504(SS)S
3630(at)S
(startup\))336 3756 A
4134(*/)S
5220 V
(05213)210 648 A
(#define)294 1026 A
(CS_INDEX)336 1362 A
2076(6)S
2370(/*)S
(kernel)252 2496 A
2790(CS)S
2916(*/)S
5310 V
(05214)210 648 A
(#define)294 1026 A
(MON_CS_INDEX)504 1362 A
2076(7)S
2370(/*)S
(temp)168 2496 A
(for)126 2706 A
(BIOS)168 2874 A
(\(386:)210 3084 A
(monitor)294 3336 A
3672(CS)S
3798(at)S
(startup\))336 3924 A
4302(*/)S
5400 V
(05215)210 648 A
(#define)294 1026 A
(TSS_INDEX)378 1362 A
2076(8)S
2370(/*)S
(kernel)252 2496 A
(TSS)126 2790 A
2958(*/)S
5490 V
(05216)210 648 A
(#define)294 1026 A
(DS_286_INDEX)504 1362 A
2076(9)S
2370(/*)S
(scratch)294 2496 A
(16-bit)252 2832 A
(source)252 3126 A
(segment)294 3420 A
3756(*/)S
5580 V
(05217)210 648 A
(#define)294 1026 A
(ES_286_INDEX)504 1362 A
2034(10)S
2370(/*)S
(scratch)294 2496 A
(16-bit)252 2832 A
(destination)462 3126 A
(segment)294 3630 A
3966(*/)S
5670 V
(05218)210 648 A
(#define)294 1026 A
(VIDEO_INDEX)462 1362 A
2034(11)S
2370(/*)S
(video)210 2496 A
(memory)252 2748 A
(segment)294 3042 A
3378(*/)S
5760 V
(05219)210 648 A
(#define)294 1026 A
(DP_ETH0_INDEX)546 1362 A
2034(12)S
2370(/*)S
(Western)294 2496 A
(Digital)294 2832 A
(Etherplus)378 3168 A
(buffer)252 3588 A
3882(*/)S
5850 V
(05220)210 648 A
(#define)294 1026 A
(DP_ETH1_INDEX)546 1362 A
2034(13)S
2370(/*)S
(Western)294 2496 A
(Digital)294 2832 A
(Etherplus)378 3168 A
(buffer)252 3588 A
3882(*/)S
5940 V
(05221)210 648 A
(#define)294 1026 A
(FIRST_LDT_INDEX)630 1362 A
2034(14)S
2370(/*)S
(rest)168 2496 A
2706(of)S
(descriptors)462 2832 A
(are)126 3336 A
(LDT's)210 3504 A
3756(*/)S
6030 V
(05222)210 648 A
6120 V
(05223)210 648 A
(#define)294 1026 A
(GDT_SELECTOR)504 1362 A
(0x08)168 2118 A
2370(/*)S
(\(GDT_INDEX)420 2496 A
2958(*)S
(DESC_SIZE\))420 3042 A
(bad)126 3504 A
(for)126 3672 A
(asld)168 3840 A
4050(*/)S
6210 V
(05224)210 648 A
(#define)294 1026 A
(IDT_SELECTOR)504 1362 A
(0x10)168 2118 A
2370(/*)S
(\(IDT_INDEX)420 2496 A
2958(*)S
(DESC_SIZE\))420 3042 A
3504(*/)S
8418 V
EP
%%Page: 61 61
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1990(File:)S
2223(src/kernel/protect.h)S
12 B
4308(61)S
900 V
7 LST
(05225)210 648 A
(#define)294 1026 A
(DS_SELECTOR)462 1362 A
(0x18)168 2118 A
2370(/*)S
(\(DS_INDEX)378 2496 A
2916(*)S
(DESC_SIZE\))420 3000 A
3462(*/)S
990 V
(05226)210 648 A
(#define)294 1026 A
(ES_SELECTOR)462 1362 A
(0x20)168 2118 A
2370(/*)S
(\(ES_INDEX)378 2496 A
2916(*)S
(DESC_SIZE\))420 3000 A
3462(*/)S
1080 V
(05227)210 648 A
(#define)294 1026 A
(FLAT_DS_SELECTOR)672 1362 A
(0x21)168 2118 A
2370(/*)S
(less)168 2496 A
(privileged)420 2706 A
3168(ES)S
3294(*/)S
1170 V
(05228)210 648 A
(#define)294 1026 A
(SS_SELECTOR)462 1362 A
(0x28)168 2118 A
2370(/*)S
(\(SS_INDEX)378 2496 A
2916(*)S
(DESC_SIZE\))420 3000 A
3462(*/)S
1260 V
(05229)210 648 A
(#define)294 1026 A
(CS_SELECTOR)462 1362 A
(0x30)168 2118 A
2370(/*)S
(\(CS_INDEX)378 2496 A
2916(*)S
(DESC_SIZE\))420 3000 A
3462(*/)S
1350 V
(05230)210 648 A
(#define)294 1026 A
(MON_CS_SELECTOR)630 1362 A
(0x38)168 2118 A
2370(/*)S
(\(MON_CS_INDEX)546 2496 A
3084(*)S
(DESC_SIZE\))420 3168 A
3630(*/)S
1440 V
(05231)210 648 A
(#define)294 1026 A
(TSS_SELECTOR)504 1362 A
(0x40)168 2118 A
2370(/*)S
(\(TSS_INDEX)420 2496 A
2958(*)S
(DESC_SIZE\))420 3042 A
3504(*/)S
1530 V
(05232)210 648 A
(#define)294 1026 A
(DS_286_SELECTOR)630 1362 A
(0x49)168 2118 A
2370(/*)S
(\(DS_286_INDEX)546 2496 A
3084(*)S
(DESC_SIZE)378 3168 A
3588(+)S
3672(1\))S
3798(*/)S
1620 V
(05233)210 648 A
(#define)294 1026 A
(ES_286_SELECTOR)630 1362 A
(0x51)168 2118 A
2370(/*)S
(\(ES_286_INDEX)546 2496 A
3084(*)S
(DESC_SIZE)378 3168 A
3588(+)S
3672(1\))S
3798(*/)S
1710 V
(05234)210 648 A
(#define)294 1026 A
(VIDEO_SELECTOR)588 1362 A
(0x59)168 2118 A
2370(/*)S
(\(VIDEO_INDEX)504 2496 A
3042(*)S
(DESC_SIZE)378 3126 A
3546(+)S
3630(1\))S
3756(*/)S
1800 V
(05235)210 648 A
(#define)294 1026 A
(DP_ETH0_SELECTOR)672 1362 A
(0x61)168 2118 A
2370(/*)S
(\(DP_ETH0_INDEX)588 2496 A
3126(*)S
(DESC_SIZE\))420 3210 A
3672(*/)S
1890 V
(05236)210 648 A
(#define)294 1026 A
(DP_ETH1_SELECTOR)672 1362 A
(0x69)168 2118 A
2370(/*)S
(\(DP_ETH1_INDEX)588 2496 A
3126(*)S
(DESC_SIZE\))420 3210 A
3672(*/)S
1980 V
(05237)210 648 A
2070 V
(05238)210 648 A
1026(/*)S
(Fixed)210 1152 A
(local)210 1404 A
(descriptors.)504 1656 A
2202(*/)S
2160 V
(05239)210 648 A
(#define)294 1026 A
(CS_LDT_INDEX)504 1362 A
2076(0)S
2370(/*)S
(process)294 2496 A
2832(CS)S
2958(*/)S
2250 V
(05240)210 648 A
(#define)294 1026 A
(DS_LDT_INDEX)504 1362 A
2076(1)S
2370(/*)S
(process)294 2496 A
(DS=ES=FS=GS=SS)588 2832 A
3462(*/)S
2340 V
(05241)210 648 A
2430 V
(05242)210 648 A
1026(/*)S
(Privileges.)462 1152 A
1656(*/)S
2520 V
(05243)210 648 A
(#define)294 1026 A
(INTR_PRIVILEGE)588 1362 A
2076(0)S
2370(/*)S
(kernel)252 2496 A
(and)126 2790 A
(interrupt)378 2958 A
(handlers)336 3378 A
3756(*/)S
2610 V
(05244)210 648 A
(#define)294 1026 A
(TASK_PRIVILEGE)588 1362 A
2076(1)S
2700 V
(05245)210 648 A
(#define)294 1026 A
(USER_PRIVILEGE)588 1362 A
2076(3)S
2790 V
(05246)210 648 A
2880 V
(05247)210 648 A
1026(/*)S
(286)126 1152 A
(hardware)336 1320 A
(constants.)420 1698 A
2160(*/)S
2970 V
(05248)210 648 A
3060 V
(05249)210 648 A
1026(/*)S
(Exception)378 1152 A
(vector)252 1572 A
(numbers.)336 1866 A
2244(*/)S
3150 V
(05250)210 648 A
(#define)294 1026 A
(BOUNDS_VECTOR)546 1362 A
2202(5)S
2370(/*)S
(bounds)252 2496 A
(check)210 2790 A
(failed)252 3042 A
3336(*/)S
3240 V
(05251)210 648 A
(#define)294 1026 A
(INVAL_OP_VECTOR)630 1362 A
2202(6)S
2370(/*)S
(invalid)294 2496 A
(opcode)252 2832 A
3126(*/)S
3330 V
(05252)210 648 A
(#define)294 1026 A
(COPROC_NOT_VECTOR)714 1362 A
2202(7)S
2370(/*)S
(coprocessor)462 2496 A
(not)126 3000 A
(available)378 3168 A
3588(*/)S
3420 V
(05253)210 648 A
(#define)294 1026 A
(DOUBLE_FAULT_VECTOR)798 1362 A
2202(8)S
3510 V
(05254)210 648 A
(#define)294 1026 A
(COPROC_SEG_VECTOR)714 1362 A
2202(9)S
2370(/*)S
(coprocessor)462 2496 A
(segment)294 3000 A
(overrun)294 3336 A
3672(*/)S
3600 V
(05255)210 648 A
(#define)294 1026 A
(INVAL_TSS_VECTOR)672 1362 A
2160(10)S
2370(/*)S
(invalid)294 2496 A
(TSS)126 2832 A
3000(*/)S
3690 V
(05256)210 648 A
(#define)294 1026 A
(SEG_NOT_VECTOR)588 1362 A
2160(11)S
2370(/*)S
(segment)294 2496 A
(not)126 2832 A
(present)294 3000 A
3336(*/)S
3780 V
(05257)210 648 A
(#define)294 1026 A
(STACK_FAULT_VECTOR)756 1362 A
2160(12)S
2370(/*)S
(stack)210 2496 A
(exception)378 2748 A
3168(*/)S
3870 V
(05258)210 648 A
(#define)294 1026 A
(PROTECTION_VECTOR)714 1362 A
2160(13)S
2370(/*)S
(general)294 2496 A
(protection)420 2832 A
3294(*/)S
3960 V
(05259)210 648 A
4050 V
(05260)210 648 A
1026(/*)S
(Selector)336 1152 A
(bits.)210 1530 A
1782(*/)S
4140 V
(05261)210 648 A
(#define)294 1026 A
1362(TI)S
(0x04)168 1950 A
2370(/*)S
(table)210 2496 A
(indicator)378 2748 A
3168(*/)S
4230 V
(05262)210 648 A
(#define)294 1026 A
(RPL)126 1362 A
(0x03)168 1950 A
2370(/*)S
(requester)378 2496 A
(privilege)378 2916 A
(level)210 3336 A
3588(*/)S
4320 V
(05263)210 648 A
4410 V
(05264)210 648 A
1026(/*)S
(Descriptor)420 1152 A
(structure)378 1614 A
(offsets.)336 2034 A
2412(*/)S
4500 V
(05265)210 648 A
(#define)294 1026 A
(DESC_BASE)378 1362 A
2076(2)S
2370(/*)S
2496(to)S
(base_low)336 2622 A
3000(*/)S
4590 V
(05266)210 648 A
(#define)294 1026 A
(DESC_BASE_MIDDLE)672 1362 A
2076(4)S
2370(/*)S
2496(to)S
(base_middle)462 2622 A
3126(*/)S
4680 V
(05267)210 648 A
(#define)294 1026 A
(DESC_ACCESS)462 1362 A
2076(5)S
2370(/*)S
2496(to)S
(access)252 2622 A
(byte)168 2916 A
3126(*/)S
4770 V
(05268)210 648 A
(#define)294 1026 A
(DESC_SIZE)378 1362 A
2076(8)S
2370(/*)S
(sizeof)252 2496 A
(\(struct)294 2790 A
(segdesc_s\))420 3126 A
3588(*/)S
4860 V
(05269)210 648 A
4950 V
(05270)210 648 A
1026(/*)S
(Segment)294 1152 A
(sizes.)252 1488 A
1782(*/)S
5040 V
(05271)210 648 A
(#define)294 1026 A
(MAX_286_SEG_SIZE)672 1362 A
(0x10000L)336 2076 A
5130 V
(05272)210 648 A
5220 V
(05273)210 648 A
1026(/*)S
(Base)168 1152 A
(and)126 1362 A
(limit)210 1530 A
(sizes)210 1782 A
(and)126 2034 A
(shifts.)294 2202 A
2538(*/)S
5310 V
(05274)210 648 A
(#define)294 1026 A
(BASE_MIDDLE_SHIFT)714 1362 A
2202(16)S
2370(/*)S
(shift)210 2496 A
(for)126 2748 A
(base)168 2916 A
(-->)126 3126 A
(base_middle)462 3294 A
3798(*/)S
5400 V
(05275)210 648 A
5490 V
(05276)210 648 A
1026(/*)S
(Access-byte)462 1152 A
(and)126 1656 A
(type-byte)378 1824 A
(bits.)210 2244 A
2496(*/)S
5580 V
(05277)210 648 A
(#define)294 1026 A
(PRESENT)294 1362 A
(0x80)168 1950 A
2370(/*)S
(set)126 2496 A
(for)126 2664 A
(descriptor)420 2832 A
(present)294 3294 A
3630(*/)S
5670 V
(05278)210 648 A
(#define)294 1026 A
(DPL)126 1362 A
(0x60)168 1950 A
2370(/*)S
(descriptor)420 2496 A
(privilege)378 2958 A
(level)210 3378 A
(mask)168 3630 A
3840(*/)S
5760 V
(05279)210 648 A
(#define)294 1026 A
(DPL_SHIFT)378 1362 A
2076(5)S
5850 V
(05280)210 648 A
(#define)294 1026 A
(SEGMENT)294 1362 A
(0x10)168 1950 A
2370(/*)S
(set)126 2496 A
(for)126 2664 A
(segment-type)504 2832 A
(descriptors)462 3378 A
3882(*/)S
5940 V
(05281)210 648 A
6030 V
(05282)210 648 A
1026(/*)S
(Access-byte)462 1152 A
(bits.)210 1656 A
1908(*/)S
6120 V
(05283)210 648 A
(#define)294 1026 A
(EXECUTABLE)420 1362 A
(0x08)168 1950 A
2370(/*)S
(set)126 2496 A
(for)126 2664 A
(executable)420 2832 A
(segment)294 3294 A
3630(*/)S
6210 V
(05284)210 648 A
(#define)294 1026 A
(CONFORMING)420 1362 A
(0x04)168 1950 A
2370(/*)S
(set)126 2496 A
(for)126 2664 A
(conforming)420 2832 A
(segment)294 3294 A
3630(if)S
(executable)420 3756 A
4218(*/)S
8418 V
EP
%%Page: 62 62
BP
/slant 0 def
/height 0 def
630 V
12 B
648(62)S
11 R
1990(File:)S
2223(src/kernel/protect.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(05285)210 648 A
(#define)294 1026 A
(EXPAND_DOWN)462 1362 A
(0x04)168 1950 A
2370(/*)S
(set)126 2496 A
(for)126 2664 A
(expand-down)462 2832 A
(segment)294 3336 A
3672(if)S
(!executable*/)546 3798 A
990 V
(05286)210 648 A
(#define)294 1026 A
(READABLE)336 1362 A
(0x02)168 1950 A
2370(/*)S
(set)126 2496 A
(for)126 2664 A
(readable)336 2832 A
(segment)294 3210 A
3546(if)S
(executable)420 3672 A
4134(*/)S
1080 V
(05287)210 648 A
(#define)294 1026 A
(WRITEABLE)378 1362 A
(0x02)168 1950 A
2370(/*)S
(set)126 2496 A
(for)126 2664 A
(writeable)378 2832 A
(segment)294 3252 A
3588(if)S
(!executable)462 3714 A
4218(*/)S
1170 V
(05288)210 648 A
(#define)294 1026 A
(TSS_BUSY)336 1362 A
(0x02)168 1950 A
2370(/*)S
(set)126 2496 A
2664(if)S
(TSS)126 2790 A
(descriptor)420 2958 A
3420(is)S
(busy)168 3546 A
3756(*/)S
1260 V
(05289)210 648 A
(#define)294 1026 A
(ACCESSED)336 1362 A
(0x01)168 1950 A
2370(/*)S
(set)126 2496 A
2664(if)S
(segment)294 2790 A
(accessed)336 3126 A
3504(*/)S
1350 V
(05290)210 648 A
1440 V
(05291)210 648 A
1026(/*)S
(Special)294 1152 A
(descriptor)420 1488 A
(types.)252 1950 A
2244(*/)S
1530 V
(05292)210 648 A
(#define)294 1026 A
(AVL_286_TSS)462 1362 A
2076(1)S
2370(/*)S
(available)378 2496 A
(286)126 2916 A
(TSS)126 3084 A
3252(*/)S
1620 V
(05293)210 648 A
(#define)294 1026 A
(LDT)126 1362 A
2076(2)S
2370(/*)S
(local)210 2496 A
(descriptor)420 2748 A
(table)210 3210 A
3462(*/)S
1710 V
(05294)210 648 A
(#define)294 1026 A
(BUSY_286_TSS)504 1362 A
2076(3)S
2370(/*)S
(set)126 2496 A
(transparently)546 2664 A
3252(to)S
(the)126 3378 A
(software)336 3546 A
3924(*/)S
1800 V
(05295)210 648 A
(#define)294 1026 A
(CALL_286_GATE)546 1362 A
2076(4)S
2370(/*)S
(not)126 2496 A
(used)168 2664 A
2874(*/)S
1890 V
(05296)210 648 A
(#define)294 1026 A
(TASK_GATE)378 1362 A
2076(5)S
2370(/*)S
(only)168 2496 A
(used)168 2706 A
2916(by)S
(debugger)336 3042 A
3420(*/)S
1980 V
(05297)210 648 A
(#define)294 1026 A
(INT_286_GATE)504 1362 A
2076(6)S
2370(/*)S
(interrupt)378 2496 A
(gate,)210 2916 A
(used)168 3168 A
(for)126 3378 A
(all)126 3546 A
(vectors)294 3714 A
4050(*/)S
2070 V
(05298)210 648 A
(#define)294 1026 A
(TRAP_286_GATE)546 1362 A
2076(7)S
2370(/*)S
(not)126 2496 A
(used)168 2664 A
2874(*/)S
2160 V
(05299)210 648 A
2250 V
(05300)210 648 A
1026(/*)S
(Extra)210 1152 A
(386)126 1404 A
(hardware)336 1572 A
(constants.)420 1950 A
2412(*/)S
2340 V
(05301)210 648 A
2430 V
(05302)210 648 A
1026(/*)S
(Exception)378 1152 A
(vector)252 1572 A
(numbers.)336 1866 A
2244(*/)S
2520 V
(05303)210 648 A
(#define)294 1026 A
(PAGE_FAULT_VECTOR)714 1362 A
2202(14)S
2610 V
(05304)210 648 A
(#define)294 1026 A
(COPROC_ERR_VECTOR)714 1362 A
2202(16)S
2370(/*)S
(coprocessor)462 2496 A
(error)210 3000 A
3252(*/)S
2700 V
(05305)210 648 A
2790 V
(05306)210 648 A
1026(/*)S
(Descriptor)420 1152 A
(structure)378 1614 A
(offsets.)336 2034 A
2412(*/)S
2880 V
(05307)210 648 A
(#define)294 1026 A
(DESC_GRANULARITY)672 1362 A
2244(6)S
2370(/*)S
2496(to)S
(granularity)462 2622 A
(byte)168 3126 A
3336(*/)S
2970 V
(05308)210 648 A
(#define)294 1026 A
(DESC_BASE_HIGH)588 1362 A
2244(7)S
2370(/*)S
2496(to)S
(base_high)378 2622 A
3042(*/)S
3060 V
(05309)210 648 A
3150 V
(05310)210 648 A
1026(/*)S
(Base)168 1152 A
(and)126 1362 A
(limit)210 1530 A
(sizes)210 1782 A
(and)126 2034 A
(shifts.)294 2202 A
2538(*/)S
3240 V
(05311)210 648 A
(#define)294 1026 A
(BASE_HIGH_SHIFT)630 1362 A
2202(24)S
2370(/*)S
(shift)210 2496 A
(for)126 2748 A
(base)168 2916 A
(-->)126 3126 A
(base_high)378 3294 A
3714(*/)S
3330 V
(05312)210 648 A
(#define)294 1026 A
(BYTE_GRAN_MAX)546 1362 A
(0xFFFFFL)336 2034 A
2496(/*)S
(maximum)294 2622 A
(size)168 2958 A
(for)126 3168 A
(byte)168 3336 A
(granular)336 3546 A
(segment)294 3924 A
4260(*/)S
3420 V
(05313)210 648 A
(#define)294 1026 A
(GRANULARITY_SHIFT)714 1362 A
2202(16)S
2370(/*)S
(shift)210 2496 A
(for)126 2748 A
(limit)210 2916 A
(-->)126 3168 A
(granularity)462 3336 A
3840(*/)S
3510 V
(05314)210 648 A
(#define)294 1026 A
(OFFSET_HIGH_SHIFT)714 1362 A
2202(16)S
2370(/*)S
(shift)210 2496 A
(for)126 2748 A
(\(gate\))252 2916 A
(offset)252 3210 A
(-->)126 3504 A
(offset_high)462 3672 A
4176(*/)S
3600 V
(05315)210 648 A
(#define)294 1026 A
(PAGE_GRAN_SHIFT)630 1362 A
2202(12)S
2370(/*)S
(extra)210 2496 A
(shift)210 2748 A
(for)126 3000 A
(page)168 3168 A
(granular)336 3378 A
(limits)252 3756 A
4050(*/)S
3690 V
(05316)210 648 A
3780 V
(05317)210 648 A
1026(/*)S
(Type-byte)378 1152 A
(bits.)210 1572 A
1824(*/)S
3870 V
(05318)210 648 A
(#define)294 1026 A
(DESC_386_BIT)504 1362 A
(0x08)168 2118 A
2370(/*)S
(386)126 2496 A
(types)210 2664 A
(are)126 2916 A
(obtained)336 3084 A
3462(by)S
(ORing)210 3588 A
(with)168 3840 A
(this)168 4050 A
4260(*/)S
3960 V
(05319)210 648 A
2370(/*)S
(LDT's)210 2496 A
(and)126 2748 A
(TASK_GATE's)462 2916 A
(don't)210 3420 A
(need)168 3672 A
3882(it)S
4008(*/)S
4050 V
(05320)210 648 A
4140 V
(05321)210 648 A
1026(/*)S
(Granularity)462 1152 A
(byte.)210 1656 A
1908(*/)S
4230 V
(05322)210 648 A
(#define)294 1026 A
(GRANULAR)336 1362 A
(0x80)168 2118 A
2370(/*)S
(set)126 2496 A
(for)126 2664 A
2832(4K)S
(granularilty)504 2958 A
3504(*/)S
4320 V
(05323)210 648 A
(#define)294 1026 A
(DEFAULT)294 1362 A
(0x40)168 2118 A
2370(/*)S
(set)126 2496 A
(for)126 2664 A
(32-bit)252 2832 A
(defaults)336 3126 A
(\(executable)462 3504 A
(seg\))168 4008 A
4218(*/)S
4410 V
(05324)210 648 A
(#define)294 1026 A
(BIG)126 1362 A
(0x40)168 2118 A
2370(/*)S
(set)126 2496 A
(for)126 2664 A
("BIG")210 2832 A
(\(expand-down)504 3084 A
(seg\))168 3630 A
3840(*/)S
4500 V
(05325)210 648 A
(#define)294 1026 A
(AVL)126 1362 A
(0x10)168 2118 A
2370(/*)S
2496(0)S
(for)126 2580 A
(available)378 2748 A
3168(*/)S
4590 V
(05326)210 648 A
(#define)294 1026 A
(LIMIT_HIGH)420 1362 A
(0x0F)168 2118 A
2370(/*)S
(mask)168 2496 A
(for)126 2706 A
(high)168 2874 A
(bits)168 3084 A
3294(of)S
(limit)210 3420 A
3672(*/)S
5040 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5130 V
(src/kernel/sconst.h)798 2034 A
5220 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5400 V
(05400)210 648 A
1026(!)S
(Miscellaneous)546 1110 A
(constants)378 1698 A
(used)168 2118 A
2328(in)S
(assembler)378 2454 A
(code.)210 2874 A
5490 V
(05401)210 648 A
1026(W)S
1698(=)S
(_WORD_SIZE)420 2034 A
2706(!)S
(Machine)294 2790 A
(word)168 3126 A
(size.)210 3336 A
5580 V
(05402)210 648 A
5670 V
(05403)210 648 A
1026(!)S
(Offsets)294 1110 A
1446(in)S
(struct)252 1572 A
(proc.)210 1866 A
(They)168 2118 A
(MUST)168 2328 A
(match)210 2538 A
(proc.h.)294 2790 A
5760 V
(05404)210 648 A
(P_STACKBASE)462 1026 A
1698(=)S
2034(0)S
5850 V
(05405)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(2)S
5940 V
(05406)210 648 A
(ESREG)210 1026 A
1698(=)S
(P_STACKBASE)462 2034 A
6030 V
(05407)210 648 A
(#else)210 1026 A
6120 V
(05408)210 648 A
(GSREG)210 1026 A
1698(=)S
(P_STACKBASE)462 2034 A
6210 V
(05409)210 648 A
(FSREG)210 1026 A
1698(=)S
(GSREG)210 2034 A
2286(+)S
2370(2)S
2706(!)S
(386)126 2790 A
(introduces)420 2958 A
3420(FS)S
(and)126 3546 A
3714(GS)S
(segments)336 3840 A
8418 V
EP
%%Page: 63 63
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2006(File:)S
2239(src/kernel/sconst.h)S
12 B
4308(63)S
900 V
7 LST
(05410)210 648 A
(ESREG)210 1026 A
1698(=)S
(FSREG)210 2034 A
2286(+)S
2370(2)S
990 V
(05411)210 648 A
(#endif)252 1026 A
1080 V
(05412)210 648 A
(DSREG)210 1026 A
1698(=)S
(ESREG)210 2034 A
2286(+)S
2370(2)S
1170 V
(05413)210 648 A
(DIREG)210 1026 A
1698(=)S
(DSREG)210 2034 A
2286(+)S
2370(2)S
1260 V
(05414)210 648 A
(SIREG)210 1026 A
1698(=)S
(DIREG)210 2034 A
2286(+)S
2370(W)S
1350 V
(05415)210 648 A
(BPREG)210 1026 A
1698(=)S
(SIREG)210 2034 A
2286(+)S
2370(W)S
1440 V
(05416)210 648 A
(STREG)210 1026 A
1698(=)S
(BPREG)210 2034 A
2286(+)S
2370(W)S
2706(!)S
(hole)168 2790 A
(for)126 3000 A
(another)294 3168 A
3504(SP)S
1530 V
(05417)210 648 A
(BXREG)210 1026 A
1698(=)S
(STREG)210 2034 A
2286(+)S
2370(W)S
1620 V
(05418)210 648 A
(DXREG)210 1026 A
1698(=)S
(BXREG)210 2034 A
2286(+)S
2370(W)S
1710 V
(05419)210 648 A
(CXREG)210 1026 A
1698(=)S
(DXREG)210 2034 A
2286(+)S
2370(W)S
1800 V
(05420)210 648 A
(AXREG)210 1026 A
1698(=)S
(CXREG)210 2034 A
2286(+)S
2370(W)S
1890 V
(05421)210 648 A
(RETADR)252 1026 A
1698(=)S
(AXREG)210 2034 A
2286(+)S
2370(W)S
2706(!)S
(return)252 2790 A
(address)294 3084 A
(for)126 3420 A
(save\(\))252 3588 A
(call)168 3882 A
1980 V
(05422)210 648 A
(PCREG)210 1026 A
1698(=)S
(RETADR)252 2034 A
2328(+)S
2412(W)S
2070 V
(05423)210 648 A
(CSREG)210 1026 A
1698(=)S
(PCREG)210 2034 A
2286(+)S
2370(W)S
2160 V
(05424)210 648 A
(PSWREG)252 1026 A
1698(=)S
(CSREG)210 2034 A
2286(+)S
2370(W)S
2250 V
(05425)210 648 A
(SPREG)210 1026 A
1698(=)S
(PSWREG)252 2034 A
2328(+)S
2412(W)S
2340 V
(05426)210 648 A
(SSREG)210 1026 A
1698(=)S
(SPREG)210 2034 A
2286(+)S
2370(W)S
2430 V
(05427)210 648 A
(P_STACKTOP)420 1026 A
1698(=)S
(SSREG)210 2034 A
2286(+)S
2370(W)S
2520 V
(05428)210 648 A
(P_LDT_SEL)378 1026 A
1698(=)S
(P_STACKTOP)420 2034 A
2610 V
(05429)210 648 A
(P_LDT)210 1026 A
1698(=)S
(P_LDT_SEL)378 2034 A
2454(+)S
2538(W)S
2700 V
(05430)210 648 A
2790 V
(05431)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(2)S
2880 V
(05432)210 648 A
(Msize)210 1026 A
1698(=)S
2034(12)S
2706(!)S
(size)168 2790 A
3000(of)S
3126(a)S
(message)294 3210 A
3546(in)S
(16-bit)252 3672 A
(words)210 3966 A
2970 V
(05433)210 648 A
(#else)210 1026 A
3060 V
(05434)210 648 A
(Msize)210 1026 A
1698(=)S
2034(9)S
2706(!)S
(size)168 2790 A
3000(of)S
3126(a)S
(message)294 3210 A
3546(in)S
(32-bit)252 3672 A
(words)210 3966 A
3150 V
(05435)210 648 A
(#endif)252 1026 A
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(src/kernel/assert.h)798 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(05500)210 648 A
1026(/*)S
4140 V
(05501)210 648 A
(assert.h)336 1026 A
4230 V
(05502)210 648 A
1026(*/)S
4320 V
(05503)210 648 A
(#ifndef)294 1026 A
(ASSERT_H)336 1362 A
4410 V
(05504)210 648 A
(#define)294 1026 A
(ASSERT_H)336 1362 A
4500 V
(05505)210 648 A
4590 V
(05506)210 648 A
(#if)126 1026 A
(DEBUG)210 1194 A
4680 V
(05507)210 648 A
4770 V
(05508)210 648 A
(#define)294 1026 A
(INIT_ASSERT)462 1362 A
(static)252 2034 A
(char)168 2328 A
(*assert_file=)546 2538 A
(__FILE__;)378 3126 A
4860 V
(05509)210 648 A
4950 V
(05510)210 648 A
(void)168 1026 A
(bad_assertion\(char)756 1236 A
(*file,)252 2034 A
(int)126 2328 A
(line,)210 2496 A
(char)168 2748 A
(*what\);)294 2958 A
5040 V
(05511)210 648 A
(void)168 1026 A
(bad_compare\(char)672 1236 A
(*file,)252 1950 A
(int)126 2244 A
(line,)210 2412 A
(int)126 2664 A
(lhs,)168 2832 A
(char)168 3042 A
(*what,)252 3252 A
(int)126 3546 A
(rhs\);)210 3714 A
5130 V
(05512)210 648 A
5220 V
(05513)210 648 A
(#define)294 1026 A
(assert\(x\))378 1362 A
(\(!\(x\))210 2034 A
2286(?)S
(bad_assertion\(assert_file,)1092 2370 A
(__LINE__,)378 3504 A
(#x\))126 3924 A
4092(\\)S
5310 V
(05514)210 648 A
3714(:)S
(\(void\))252 3798 A
4092(0\))S
5400 V
(05515)210 648 A
(#define)294 1026 A
(compare\(a,t,b\))588 1362 A
(\(!\(\(a\))252 2034 A
2328(t)S
(\(b\)\))168 2412 A
2622(?)S
(bad_compare\(assert_file,)1008 2706 A
(__LINE__,)378 3756 A
4176(\\)S
5490 V
(05516)210 648 A
(\(a\),)168 2370 A
2580(#a)S
2706(")S
2790(")S
2874(#t)S
3000(")S
3084(")S
(#b,)126 3168 A
(\(b\)\))168 3336 A
3546(:)S
(\(void\))252 3630 A
3924(0\))S
5580 V
(05517)210 648 A
(#else)210 1026 A
1278(/*)S
(!DEBUG)252 1404 A
1698(*/)S
5670 V
(05518)210 648 A
5760 V
(05519)210 648 A
(#define)294 1026 A
(INIT_ASSERT)462 1362 A
2034(/*)S
(nothing)294 2160 A
2496(*/)S
5850 V
(05520)210 648 A
5940 V
(05521)210 648 A
(#define)294 1026 A
(assert\(x\))378 1362 A
(\(void\)0)294 2034 A
6030 V
(05522)210 648 A
(#define)294 1026 A
(compare\(a,t,b\))588 1362 A
(\(void\)0)294 2034 A
6120 V
(05523)210 648 A
6210 V
(05524)210 648 A
(#endif)252 1026 A
1320(/*)S
(!DEBUG)252 1446 A
1740(*/)S
8418 V
EP
%%Page: 64 64
BP
/slant 0 def
/height 0 def
630 V
12 B
648(64)S
11 R
2018(File:)S
2251(src/kernel/assert.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(05525)210 648 A
990 V
(05526)210 648 A
(#endif)252 1026 A
1320(/*)S
(ASSERT_H)336 1446 A
1824(*/)S
1440 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1530 V
(src/kernel/table.c)756 2034 A
1620 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1800 V
(05600)210 648 A
1026(/*)S
(The)126 1152 A
(object)252 1320 A
(file)168 1614 A
1824(of)S
("table.c")378 1950 A
(contains)336 2370 A
(all)126 2748 A
(the)126 2916 A
(data.)210 3084 A
3378(In)S
(the)126 3504 A
(*.h)126 3672 A
(files,)252 3840 A
1890 V
(05601)210 648 A
1068(*)S
(declared)336 1152 A
(variables)378 1530 A
(appear)252 1950 A
(with)168 2244 A
(EXTERN)252 2454 A
2748(in)S
(front)210 2874 A
3126(of)S
(them,)210 3252 A
3504(as)S
3630(in)S
1980 V
(05602)210 648 A
1068(*)S
2070 V
(05603)210 648 A
1068(*)S
(EXTERN)252 1278 A
(int)126 1572 A
1740(x;)S
2160 V
(05604)210 648 A
1068(*)S
2250 V
(05605)210 648 A
1068(*)S
(Normally)336 1152 A
(EXTERN)252 1530 A
1824(is)S
(defined)294 1950 A
2286(as)S
(extern,)294 2412 A
2748(so)S
(when)168 2874 A
(they)168 3084 A
(are)126 3294 A
(included)336 3462 A
3840(in)S
(another)294 3966 A
2340 V
(05606)210 648 A
1068(*)S
(file,)210 1152 A
1404(no)S
(storage)294 1530 A
1866(is)S
(allocated.)420 1992 A
2496(If)S
(the)126 2622 A
(EXTERN)252 2790 A
(were)168 3084 A
(not)126 3294 A
(present,)336 3462 A
(but)126 3840 A
(just)168 4008 A
2430 V
(05607)210 648 A
1068(*)S
(say,)168 1152 A
2520 V
(05608)210 648 A
1068(*)S
2610 V
(05609)210 648 A
1068(*)S
(int)126 1278 A
1446(x;)S
2700 V
(05610)210 648 A
1068(*)S
2790 V
(05611)210 648 A
1068(*)S
(then)168 1152 A
(including)378 1362 A
(this)168 1782 A
(file)168 1992 A
2202(in)S
(several)294 2328 A
(source)252 2664 A
(files)210 2958 A
(would)210 3210 A
(cause)210 3462 A
('x')126 3714 A
3882(to)S
4008(be)S
2880 V
(05612)210 648 A
1068(*)S
(declared)336 1152 A
(several)294 1530 A
(times.)252 1866 A
(While)210 2202 A
(some)168 2454 A
(linkers)294 2664 A
(accept)252 3000 A
(this,)210 3294 A
(others)252 3546 A
3840(do)S
(not,)168 3966 A
2970 V
(05613)210 648 A
1068(*)S
1152(so)S
(they)168 1278 A
(are)126 1488 A
(declared)336 1656 A
(extern)252 2034 A
(when)168 2328 A
(included)336 2538 A
(normally.)378 2916 A
(However,)336 3378 A
3756(it)S
(must)168 3882 A
3060 V
(05614)210 648 A
1068(*)S
1152(be)S
(declared)336 1278 A
(for)126 1656 A
(real)168 1824 A
(somewhere.)420 2034 A
(That)168 2538 A
2748(is)S
(done)168 2874 A
(here,)210 3084 A
3336(by)S
(redefining)420 3462 A
3150 V
(05615)210 648 A
1068(*)S
(EXTERN)252 1152 A
1446(as)S
(the)126 1572 A
(null)168 1740 A
(string,)294 1950 A
2286(so)S
(the)126 2412 A
(inclusion)378 2580 A
3000(of)S
(all)126 3126 A
(the)126 3294 A
(*.h)126 3462 A
(files)210 3630 A
3882(in)S
3240 V
(05616)210 648 A
1068(*)S
(table.c)294 1152 A
(actually)336 1488 A
(generates)378 1866 A
(storage)294 2286 A
(for)126 2622 A
(them.)210 2790 A
(All)126 3084 A
(the)126 3252 A
(initialized)462 3420 A
3330 V
(05617)210 648 A
1068(*)S
(variables)378 1152 A
(are)126 1572 A
(also)168 1740 A
(declared)336 1950 A
(here,)210 2328 A
(since)210 2580 A
3420 V
(05618)210 648 A
1068(*)S
3510 V
(05619)210 648 A
1068(*)S
(extern)252 1152 A
(int)126 1446 A
1614(x)S
1698(=)S
1782(4;)S
3600 V
(05620)210 648 A
1068(*)S
3690 V
(05621)210 648 A
1068(*)S
1152(is)S
(not)126 1278 A
(allowed.)336 1446 A
1866(If)S
(such)168 1992 A
(variables)378 2202 A
(are)126 2622 A
(shared,)294 2790 A
(they)168 3126 A
(must)168 3336 A
(also)168 3546 A
3756(be)S
(declared)336 3882 A
3780 V
(05622)210 648 A
1068(*)S
1152(in)S
(one)126 1278 A
1446(of)S
(the)126 1572 A
(*.h)126 1740 A
(files)210 1908 A
(without)294 2160 A
(the)126 2496 A
(initialization.)630 2664 A
3870 V
(05623)210 648 A
1068(*/)S
3960 V
(05624)210 648 A
4050 V
(05625)210 648 A
(#define)294 1026 A
(_TABLE)252 1362 A
4140 V
(05626)210 648 A
4230 V
(05627)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
4320 V
(05628)210 648 A
(#include)336 1026 A
(<termios.h>)462 1404 A
4410 V
(05629)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
4500 V
(05630)210 648 A
(#include)336 1026 A
("proc.h")336 1404 A
4590 V
(05631)210 648 A
(#include)336 1026 A
("tty.h")294 1404 A
4680 V
(05632)210 648 A
4770 V
(05633)210 648 A
1026(/*)S
(The)126 1152 A
(startup)294 1320 A
(routine)294 1656 A
1992(of)S
(each)168 2118 A
(task)168 2328 A
2538(is)S
(given)210 2664 A
(below,)252 2916 A
(from)168 3210 A
(-NR_TASKS)378 3420 A
(upwards.)336 3840 A
4860 V
(05634)210 648 A
1068(*)S
(The)126 1152 A
(order)210 1320 A
1572(of)S
(the)126 1698 A
(names)210 1866 A
(here)168 2118 A
(MUST)168 2328 A
(agree)210 2538 A
(with)168 2790 A
(the)126 3000 A
(numerical)378 3168 A
(values)252 3588 A
(assigned)336 3882 A
4260(to)S
4950 V
(05635)210 648 A
1068(*)S
(the)126 1152 A
(tasks)210 1320 A
1572(in)S
(<minix/com.h>.)588 1698 A
5040 V
(05636)210 648 A
1068(*/)S
5130 V
(05637)210 648 A
(#define)294 1026 A
(SMALL_STACK)462 1362 A
(\(128)168 2034 A
2244(*)S
(sizeof\(char)462 2328 A
(*\)\))126 2832 A
5220 V
(05638)210 648 A
5310 V
(05639)210 648 A
(#define)294 1026 A
(TTY_STACK)378 1362 A
2034(\(3)S
2160(*)S
(SMALL_STACK\))504 2244 A
5400 V
(05640)210 648 A
(#define)294 1026 A
(SYN_ALRM_STACK)588 1362 A
(SMALL_STACK)462 2034 A
5490 V
(05641)210 648 A
5580 V
(05642)210 648 A
(#define)294 1026 A
(DP8390_STACK)504 1362 A
(\(SMALL_STACK)504 2034 A
2580(*)S
(ENABLE_NETWORKING\))756 2664 A
5670 V
(05643)210 648 A
5760 V
(05644)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
5850 V
(05645)210 648 A
(#define)294 1026 A
(IDLE_STACK)420 1362 A
(\(\(3+3+4\))336 2034 A
2412(*)S
(sizeof\(char)462 2496 A
(*\)\))126 3000 A
3210(/*)S
3336(3)S
(intr,)210 3420 A
3672(3)S
(temps,)252 3756 A
4050(4)S
4134(db)S
4260(*/)S
5940 V
(05646)210 648 A
(#else)210 1026 A
6030 V
(05647)210 648 A
(#define)294 1026 A
(IDLE_STACK)420 1362 A
(SMALL_STACK)462 2034 A
6120 V
(05648)210 648 A
(#endif)252 1026 A
6210 V
(05649)210 648 A
8418 V
EP
%%Page: 65 65
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2039(File:)S
(src/kernel/table.c)765 2272 A
12 B
4308(65)S
900 V
7 LST
(05650)210 648 A
(#define)294 1026 A
(PRINTER_STACK)546 1362 A
(SMALL_STACK)462 2034 A
990 V
(05651)210 648 A
1080 V
(05652)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
1170 V
(05653)210 648 A
(#define)294 1026 A
(WINCH_STACK)462 1362 A
2034(\(2)S
2160(*)S
(SMALL_STACK)462 2244 A
2748(*)S
(ENABLE_WINI\))504 2832 A
1260 V
(05654)210 648 A
(#else)210 1026 A
1350 V
(05655)210 648 A
(#define)294 1026 A
(WINCH_STACK)462 1362 A
2034(\(3)S
2160(*)S
(SMALL_STACK)462 2244 A
2748(*)S
(ENABLE_WINI\))504 2832 A
1440 V
(05656)210 648 A
(#endif)252 1026 A
1530 V
(05657)210 648 A
1620 V
(05658)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(ATARI\))252 1698 A
1710 V
(05659)210 648 A
(#define)294 1026 A
(SCSI_STACK)420 1362 A
2034(\(3)S
2160(*)S
(SMALL_STACK\))504 2244 A
1800 V
(05660)210 648 A
(#endif)252 1026 A
1890 V
(05661)210 648 A
1980 V
(05662)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(IBM_PC\))294 1698 A
2070 V
(05663)210 648 A
(#define)294 1026 A
(SCSI_STACK)420 1362 A
2034(\(2)S
2160(*)S
(SMALL_STACK)462 2244 A
2748(*)S
(ENABLE_SCSI\))504 2832 A
2160 V
(05664)210 648 A
(#endif)252 1026 A
2250 V
(05665)210 648 A
2340 V
(05666)210 648 A
(#define)294 1026 A
(CDROM_STACK)462 1362 A
2034(\(4)S
2160(*)S
(SMALL_STACK)462 2244 A
2748(*)S
(ENABLE_CDROM\))546 2832 A
2430 V
(05667)210 648 A
(#define)294 1026 A
(AUDIO_STACK)462 1362 A
2034(\(4)S
2160(*)S
(SMALL_STACK)462 2244 A
2748(*)S
(ENABLE_AUDIO\))546 2832 A
2520 V
(05668)210 648 A
(#define)294 1026 A
(MIXER_STACK)462 1362 A
2034(\(4)S
2160(*)S
(SMALL_STACK)462 2244 A
2748(*)S
(ENABLE_AUDIO\))546 2832 A
2610 V
(05669)210 648 A
2700 V
(05670)210 648 A
(#define)294 1026 A
(FLOP_STACK)420 1362 A
2034(\(3)S
2160(*)S
(SMALL_STACK\))504 2244 A
2790 V
(05671)210 648 A
(#define)294 1026 A
(MEM_STACK)378 1362 A
(SMALL_STACK)462 2034 A
2880 V
(05672)210 648 A
(#define)294 1026 A
(CLOCK_STACK)462 1362 A
(SMALL_STACK)462 2034 A
2970 V
(05673)210 648 A
(#define)294 1026 A
(SYS_STACK)378 1362 A
(SMALL_STACK)462 2034 A
3060 V
(05674)210 648 A
(#define)294 1026 A
(HARDWARE_STACK)588 1362 A
2034(0)S
2706(/*)S
(dummy)210 2832 A
(task,)210 3084 A
(uses)168 3336 A
(kernel)252 3546 A
(stack)210 3840 A
4092(*/)S
3150 V
(05675)210 648 A
3240 V
(05676)210 648 A
3330 V
(05677)210 648 A
(#define)294 1026 A
(TOT_STACK_SPACE)630 1362 A
(\(TTY_STACK)420 2370 A
2832(+)S
(DP8390_STACK)504 2916 A
3462(+)S
(SCSI_STACK)420 3546 A
4008(+)S
4092(\\)S
3420 V
(05678)210 648 A
(SYN_ALRM_STACK)588 1362 A
1992(+)S
(IDLE_STACK)420 2076 A
2538(+)S
(HARDWARE_STACK)588 2622 A
3252(+)S
(PRINTER_STACK)546 3336 A
3924(+)S
4008(\\)S
3510 V
(05679)210 648 A
(WINCH_STACK)462 1362 A
1866(+)S
(FLOP_STACK)420 1950 A
2412(+)S
(MEM_STACK)378 2496 A
2916(+)S
(CLOCK_STACK)462 3000 A
3504(+)S
(SYS_STACK)378 3588 A
4008(+)S
4092(\\)S
3600 V
(05680)210 648 A
(CDROM_STACK)462 1362 A
1866(+)S
(AUDIO_STACK)462 1950 A
2454(+)S
(MIXER_STACK\))504 2538 A
3690 V
(05681)210 648 A
3780 V
(05682)210 648 A
3870 V
(05683)210 648 A
1026(/*)S
(SCSI,)210 1152 A
(CDROM)210 1404 A
(and)126 1656 A
(AUDIO)210 1824 A
(may)126 2076 A
2244(in)S
(the)126 2370 A
(future)252 2538 A
(have)168 2832 A
(different)378 3042 A
(choices)294 3462 A
(like)168 3798 A
3960 V
(05684)210 648 A
1068(*)S
(WINCHESTER,)462 1152 A
(but)126 1656 A
(for)126 1824 A
(now)126 1992 A
(the)126 2160 A
(choice)252 2328 A
2622(is)S
(fixed.)252 2748 A
4050 V
(05685)210 648 A
1068(*/)S
4140 V
(05686)210 648 A
(#define)294 1026 A
(scsi_task)378 1362 A
(aha_scsi_task)546 2034 A
4230 V
(05687)210 648 A
(#define)294 1026 A
(cdrom_task)420 1362 A
(mcd_task)336 2034 A
4320 V
(05688)210 648 A
(#define)294 1026 A
(audio_task)420 1362 A
(dsp_task)336 2034 A
4410 V
(05689)210 648 A
4500 V
(05690)210 648 A
4590 V
(05691)210 648 A
1026(/*)S
4680 V
(05692)210 648 A
1068(*)S
(Some)168 1152 A
(notes)210 1362 A
(about)210 1614 A
(the)126 1866 A
(following)378 2034 A
(table:)252 2454 A
4770 V
(05693)210 648 A
1068(*)S
1194(1\))S
(The)126 1320 A
(tty_task)336 1488 A
(should)252 1866 A
(always)252 2160 A
2454(be)S
(first)210 2580 A
2832(so)S
(that)168 2958 A
(other)210 3168 A
(tasks)210 3420 A
(can)126 3672 A
(use)126 3840 A
(printf)252 4008 A
4860 V
(05694)210 648 A
1068(*)S
1320(if)S
(their)210 1446 A
(initialisation)588 1698 A
(has)126 2328 A
(problems.)378 2496 A
4950 V
(05695)210 648 A
1068(*)S
1194(2\))S
1320(If)S
(you)126 1446 A
(add)126 1614 A
1782(a)S
(new)126 1866 A
(kernel)252 2034 A
(task,)210 2328 A
(add)126 2580 A
2748(it)S
(before)252 2874 A
(the)126 3168 A
(printer)294 3336 A
(task.)210 3672 A
5040 V
(05696)210 648 A
1068(*)S
1194(3\))S
(The)126 1320 A
(task)168 1488 A
(name)168 1698 A
1908(is)S
(used)168 2034 A
(for)126 2244 A
(the)126 2412 A
(process)294 2580 A
(name)168 2916 A
(\(p_name\).)378 3126 A
5130 V
(05697)210 648 A
1068(*/)S
5220 V
(05698)210 648 A
5310 V
(05699)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(tasktab)294 1614 A
(tasktab[])378 1950 A
2370(=)S
2454({)S
5400 V
(05700)210 648 A
1362({)S
(tty_task,)378 1446 A
(TTY_STACK,)420 2370 A
("TTY")210 3042 A
3714(},)S
5490 V
(05701)210 648 A
(#if)126 1026 A
(ENABLE_NETWORKING)714 1194 A
5580 V
(05702)210 648 A
1362({)S
(dp8390_task,)504 1446 A
(DP8390_STACK,)546 2370 A
("DP8390")336 3042 A
3714(},)S
5670 V
(05703)210 648 A
(#endif)252 1026 A
5760 V
(05704)210 648 A
(#if)126 1026 A
(ENABLE_CDROM)504 1194 A
5850 V
(05705)210 648 A
1362({)S
(cdrom_task,)462 1446 A
(CDROM_STACK,)504 2370 A
("CDROM")294 3042 A
3714(},)S
5940 V
(05706)210 648 A
(#endif)252 1026 A
6030 V
(05707)210 648 A
(#if)126 1026 A
(ENABLE_AUDIO)504 1194 A
6120 V
(05708)210 648 A
1362({)S
(audio_task,)462 1446 A
(AUDIO_STACK,)504 2370 A
("AUDIO")294 3042 A
3714(},)S
6210 V
(05709)210 648 A
1362({)S
(mixer_task,)462 1446 A
(MIXER_STACK,)504 2370 A
("MIXER")294 3042 A
3714(},)S
8418 V
EP
%%Page: 66 66
BP
/slant 0 def
/height 0 def
630 V
12 B
648(66)S
11 R
2039(File:)S
(src/kernel/table.c)765 2272 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(05710)210 648 A
(#endif)252 1026 A
990 V
(05711)210 648 A
(#if)126 1026 A
(ENABLE_SCSI)462 1194 A
1080 V
(05712)210 648 A
1362({)S
(scsi_task,)420 1446 A
(SCSI_STACK,)462 2370 A
("SCSI")252 3042 A
3714(},)S
1170 V
(05713)210 648 A
(#endif)252 1026 A
1260 V
(05714)210 648 A
(#if)126 1026 A
(ENABLE_WINI)462 1194 A
1350 V
(05715)210 648 A
1362({)S
(winchester_task,)672 1446 A
(WINCH_STACK,)504 2370 A
("WINCH")294 3042 A
3714(},)S
1440 V
(05716)210 648 A
(#endif)252 1026 A
1530 V
(05717)210 648 A
1362({)S
(syn_alrm_task,)588 1446 A
(SYN_ALRM_STACK,)630 2370 A
("SYN_AL")336 3042 A
3714(},)S
1620 V
(05718)210 648 A
1362({)S
(idle_task,)420 1446 A
(IDLE_STACK,)462 2370 A
("IDLE")252 3042 A
3714(},)S
1710 V
(05719)210 648 A
1362({)S
(printer_task,)546 1446 A
(PRINTER_STACK,)588 2370 A
("PRINTER")378 3042 A
3714(},)S
1800 V
(05720)210 648 A
1362({)S
(floppy_task,)504 1446 A
(FLOP_STACK,)462 2370 A
("FLOPPY")336 3042 A
3714(},)S
1890 V
(05721)210 648 A
1362({)S
(mem_task,)378 1446 A
(MEM_STACK,)420 2370 A
("MEMORY")336 3042 A
3714(},)S
1980 V
(05722)210 648 A
1362({)S
(clock_task,)462 1446 A
(CLOCK_STACK,)504 2370 A
("CLOCK")294 3042 A
3714(},)S
2070 V
(05723)210 648 A
1362({)S
(sys_task,)378 1446 A
(SYS_STACK,)420 2370 A
("SYS")210 3042 A
3714(},)S
2160 V
(05724)210 648 A
1362({)S
1446(0,)S
(HARDWARE_STACK,)630 2370 A
("HARDWAR")378 3042 A
3714(},)S
2250 V
(05725)210 648 A
1362({)S
1446(0,)S
2370(0,)S
("MM")168 3042 A
3714(},)S
2340 V
(05726)210 648 A
1362({)S
1446(0,)S
2370(0,)S
("FS")168 3042 A
3714(},)S
2430 V
(05727)210 648 A
(#if)126 1026 A
(ENABLE_NETWORKING)714 1194 A
2520 V
(05728)210 648 A
1362({)S
1446(0,)S
2370(0,)S
("INET")252 3042 A
3714(},)S
2610 V
(05729)210 648 A
(#endif)252 1026 A
2700 V
(05730)210 648 A
1362({)S
1446(0,)S
2370(0,)S
("INIT")252 3042 A
3714(},)S
2790 V
(05731)210 648 A
1026(};)S
2880 V
(05732)210 648 A
2970 V
(05733)210 648 A
1026(/*)S
(Stack)210 1152 A
(space)210 1404 A
(for)126 1656 A
(all)126 1824 A
(the)126 1992 A
(task)168 2160 A
(stacks.)294 2370 A
(\(Declared)378 2748 A
3168(as)S
(\(char)210 3294 A
3546(*\))S
3672(to)S
(align)210 3798 A
(it.\))168 4050 A
4260(*/)S
3060 V
(05734)210 648 A
(PUBLIC)252 1026 A
(char)168 1320 A
(*t_stack[TOT_STACK_SPACE)1008 1530 A
2580(/)S
(sizeof\(char)462 2664 A
(*\)];)168 3168 A
3150 V
(05735)210 648 A
3240 V
(05736)210 648 A
1026(/*)S
3330 V
(05737)210 648 A
1068(*)S
(The)126 1152 A
(number)252 1320 A
1614(of)S
(kernel)252 1740 A
(tasks)210 2034 A
(must)168 2286 A
2496(be)S
(the)126 2622 A
(same)168 2790 A
3000(as)S
(NR_TASKS.)378 3126 A
3420 V
(05738)210 648 A
1068(*)S
1152(If)S
(NR_TASKS)336 1278 A
1656(is)S
(not)126 1782 A
(correct)294 1950 A
(then)168 2286 A
(you)126 2496 A
(will)168 2664 A
(get)126 2874 A
(the)126 3042 A
(compile)294 3210 A
(error:)252 3546 A
3510 V
(05739)210 648 A
1068(*)S
("array)252 1236 A
(size)168 1530 A
1740(is)S
(negative")378 1866 A
3600 V
(05740)210 648 A
1068(*/)S
3690 V
(05741)210 648 A
3780 V
(05742)210 648 A
(#define)294 1026 A
(NKT)126 1362 A
(\(sizeof)294 1530 A
(tasktab)294 1866 A
2202(/)S
(sizeof)252 2286 A
(\(struct)294 2580 A
(tasktab\))336 2916 A
3294(-)S
(\(INIT_PROC_NR)546 3378 A
3966(+)S
(1\)\))126 4050 A
3870 V
(05743)210 648 A
3960 V
(05744)210 648 A
(extern)252 1026 A
(int)126 1320 A
(dummy_tasktab_check[NR_TASKS)1176 1488 A
2706(==)S
(NKT)126 2832 A
3000(?)S
3084(1)S
3168(:)S
(-1];)168 3252 A
4590 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4680 V
(src/kernel/mpx.s)672 2034 A
4770 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4950 V
(05800)210 648 A
1026(#)S
5040 V
(05801)210 648 A
1026(!)S
(Chooses)294 1110 A
(between)294 1446 A
(the)126 1782 A
(8086)168 1950 A
(and)126 2160 A
(386)126 2328 A
(versions)336 2496 A
2874(of)S
(the)126 3000 A
(Minix)210 3168 A
(startup)294 3420 A
(code.)210 3756 A
5130 V
(05802)210 648 A
5220 V
(05803)210 648 A
(#include)336 1026 A
(<minix/config.h>)672 1404 A
5310 V
(05804)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(2)S
5400 V
(05805)210 648 A
(#include)336 1026 A
("mpx88.s")378 1404 A
5490 V
(05806)210 648 A
(#else)210 1026 A
5580 V
(05807)210 648 A
(#include)336 1026 A
("mpx386.s")420 1404 A
5670 V
(05808)210 648 A
(#endif)252 1026 A
8418 V
EP
%%Page: 67 67
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1970(File:)S
(src/kernel/mpx386.s)902 2203 A
12 B
4308(67)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/kernel/mpx386.s)798 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(05900)210 648 A
1026(#)S
1440 V
(05901)210 648 A
1026(!)S
(This)168 1110 A
(file)168 1320 A
(contains)336 1530 A
(the)126 1908 A
(assembler)378 2076 A
(startup)294 2496 A
(code)168 2832 A
(for)126 3042 A
(Minix)210 3210 A
(and)126 3462 A
(the)126 3630 A
(32-bit)252 3798 A
1530 V
(05902)210 648 A
1026(!)S
(interrupt)378 1110 A
(handlers.)378 1530 A
1992(It)S
(cooperates)420 2118 A
(with)168 2580 A
(start.c)294 2790 A
3126(to)S
(set)126 3252 A
3420(up)S
3546(a)S
(good)168 3630 A
1620 V
(05903)210 648 A
1026(!)S
(environment)462 1110 A
(for)126 1614 A
(main\(\).)294 1782 A
1710 V
(05904)210 648 A
1800 V
(05905)210 648 A
1026(!)S
(This)168 1110 A
(file)168 1320 A
1530(is)S
(part)168 1656 A
1866(of)S
(the)126 1992 A
(lowest)252 2160 A
(layer)210 2454 A
2706(of)S
(the)126 2832 A
(MINIX)210 3000 A
(kernel.)294 3252 A
(The)126 3630 A
(other)210 3798 A
(part)168 4050 A
1890 V
(05906)210 648 A
1026(!)S
1110(is)S
("proc.c".)378 1236 A
(The)126 1698 A
(lowest)252 1866 A
(layer)210 2160 A
(does)168 2412 A
(process)294 2622 A
(switching)378 2958 A
(and)126 3378 A
(message)294 3546 A
(handling.)378 3882 A
1980 V
(05907)210 648 A
2070 V
(05908)210 648 A
1026(!)S
(Every)210 1110 A
(transition)420 1362 A
1824(to)S
(the)126 1950 A
(kernel)252 2118 A
(goes)168 2412 A
(through)294 2622 A
(this)168 2958 A
(file.)210 3168 A
(Transitions)462 3462 A
(are)126 3966 A
2160 V
(05909)210 648 A
1026(!)S
(caused)252 1110 A
1404(by)S
(sending/receiving)714 1530 A
(messages)336 2286 A
(and)126 2664 A
2832(by)S
(most)168 2958 A
(interrupts.)462 3168 A
(\(RS232)252 3714 A
2250 V
(05910)210 648 A
1026(!)S
(interrupts)420 1110 A
(may)126 1572 A
1740(be)S
(handled)294 1866 A
2202(in)S
(the)126 2328 A
(file)168 2496 A
("rs2.s")294 2706 A
(and)126 3042 A
(then)168 3210 A
(they)168 3420 A
(rarely)252 3630 A
(enter)210 3924 A
2340 V
(05911)210 648 A
1026(!)S
(the)126 1110 A
(kernel.\))336 1278 A
2430 V
(05912)210 648 A
2520 V
(05913)210 648 A
1026(!)S
(Transitions)462 1110 A
1614(to)S
(the)126 1740 A
(kernel)252 1908 A
(may)126 2202 A
2370(be)S
(nested.)294 2496 A
(The)126 2874 A
(initial)294 3042 A
(entry)210 3378 A
(may)126 3630 A
3798(be)S
(with)168 3924 A
4134(a)S
2610 V
(05914)210 648 A
1026(!)S
(system)252 1110 A
(call,)210 1404 A
(exception)378 1656 A
2076(or)S
(hardware)336 2202 A
(interrupt;)420 2580 A
(reentries)378 3042 A
(may)126 3462 A
(only)168 3630 A
3840(be)S
(made)168 3966 A
2700 V
(05915)210 648 A
1026(!)S
1110(by)S
(hardware)336 1236 A
(interrupts.)462 1614 A
(The)126 2160 A
(count)210 2328 A
2580(of)S
(reentries)378 2706 A
3126(is)S
(kept)168 3252 A
3462(in)S
("k_reenter".)504 3588 A
2790 V
(05916)210 648 A
1026(!)S
1110(It)S
1236(is)S
(important)378 1362 A
(for)126 1782 A
(deciding)336 1950 A
(whether)294 2328 A
2664(to)S
(switch)252 2790 A
3084(to)S
(the)126 3210 A
(kernel)252 3378 A
(stack)210 3672 A
(and)126 3924 A
2880 V
(05917)210 648 A
1026(!)S
(for)126 1110 A
(protecting)420 1278 A
(the)126 1740 A
(message)294 1908 A
(passing)294 2244 A
(code)168 2580 A
2790(in)S
("proc.c".)378 2916 A
2970 V
(05918)210 648 A
3060 V
(05919)210 648 A
1026(!)S
(For)126 1110 A
(the)126 1278 A
(message)294 1446 A
(passing)294 1782 A
(trap,)210 2118 A
(most)168 2370 A
2580(of)S
(the)126 2706 A
(machine)294 2874 A
(state)210 3210 A
3462(is)S
(saved)210 3588 A
3840(in)S
(the)126 3966 A
3150 V
(05920)210 648 A
1026(!)S
(proc)168 1110 A
(table.)252 1320 A
(\(Some)210 1656 A
1908(of)S
(the)126 2034 A
(registers)378 2202 A
(need)168 2622 A
(not)126 2832 A
3000(be)S
(saved.\))294 3126 A
(Then)168 3504 A
(the)126 3714 A
(stack)210 3882 A
4134(is)S
3240 V
(05921)210 648 A
1026(!)S
(switched)336 1110 A
1488(to)S
("k_stack",)420 1614 A
(and)126 2076 A
(interrupts)420 2244 A
(are)126 2706 A
(reenabled.)420 2874 A
(Finally,)336 3378 A
(the)126 3756 A
(system)252 3924 A
3330 V
(05922)210 648 A
1026(!)S
(call)168 1110 A
(handler)294 1320 A
(\(in)126 1656 A
1824(C\))S
1950(is)S
(called.)294 2076 A
(When)168 2454 A
2664(it)S
(returns,)336 2790 A
(interrupts)420 3168 A
(are)126 3630 A
(disabled)336 3798 A
3420 V
(05923)210 648 A
1026(!)S
(again)210 1110 A
(and)126 1362 A
(the)126 1530 A
(code)168 1698 A
(falls)210 1908 A
(into)168 2160 A
(the)126 2370 A
(restart)294 2538 A
(routine,)336 2874 A
3252(to)S
(finish)252 3378 A
(off)126 3672 A
(held-up)294 3840 A
3510 V
(05924)210 648 A
1026(!)S
(interrupts)420 1110 A
(and)126 1572 A
(run)126 1740 A
(the)126 1908 A
(process)294 2076 A
2412(or)S
(task)168 2538 A
(whose)210 2748 A
(pointer)294 3000 A
3336(is)S
3462(in)S
("proc_ptr".)462 3588 A
3600 V
(05925)210 648 A
3690 V
(05926)210 648 A
1026(!)S
(Hardware)336 1110 A
(interrupt)378 1488 A
(handlers)336 1908 A
2286(do)S
(the)126 2412 A
(same,)210 2580 A
(except)252 2832 A
(\(1\))126 3168 A
(The)126 3336 A
(entire)252 3504 A
(state)210 3798 A
(must)168 4050 A
3780 V
(05927)210 648 A
1026(!)S
1110(be)S
(saved.)252 1236 A
(\(2\))126 1572 A
(There)210 1740 A
(are)126 1992 A
(too)126 2160 A
(many)168 2328 A
(handlers)336 2538 A
2916(to)S
3042(do)S
(this)168 3168 A
(inline,)294 3378 A
3714(so)S
(the)126 3840 A
(save)168 4008 A
3870 V
(05928)210 648 A
1026(!)S
(routine)294 1110 A
1446(is)S
(called.)294 1572 A
1950(A)S
(few)126 2034 A
(cycles)252 2202 A
(are)126 2496 A
(saved)210 2664 A
2916(by)S
(pushing)294 3042 A
(the)126 3378 A
(address)294 3546 A
3882(of)S
(the)126 4008 A
3960 V
(05929)210 648 A
1026(!)S
(appropiate)420 1110 A
(restart)294 1572 A
(routine)294 1908 A
(for)126 2244 A
2412(a)S
(return)252 2496 A
(later.)252 2790 A
(\(3\))126 3126 A
3294(A)S
(stack)210 3378 A
(switch)252 3630 A
3924(is)S
4050 V
(05930)210 648 A
1026(!)S
(avoided)294 1110 A
(when)168 1446 A
(the)126 1656 A
(stack)210 1824 A
2076(is)S
(already)294 2202 A
(switched.)378 2538 A
(\(4\))126 3000 A
(The)126 3168 A
(\(master\))336 3336 A
(8259)168 3714 A
(interrupt)378 3924 A
4140 V
(05931)210 648 A
1026(!)S
(controller)420 1110 A
1572(is)S
(reenabled)378 1698 A
(centrally)378 2118 A
2538(in)S
(save\(\).)294 2664 A
(\(5\))126 3042 A
(Each)168 3210 A
(interrupt)378 3420 A
(handler)294 3840 A
4230 V
(05932)210 648 A
1026(!)S
(masks)210 1110 A
(its)126 1362 A
(interrupt)378 1530 A
(line)168 1950 A
(using)210 2160 A
(the)126 2412 A
(8259)168 2580 A
(before)252 2790 A
(enabling)336 3084 A
(\(other)252 3462 A
(unmasked\))378 3756 A
4320 V
(05933)210 648 A
1026(!)S
(interrupts,)462 1110 A
(and)126 1614 A
(unmasks)294 1782 A
2118(it)S
(after)210 2244 A
(servicing)378 2496 A
(the)126 2916 A
(interrupt.)420 3084 A
(This)168 3588 A
(limits)252 3798 A
(the)126 4092 A
4410 V
(05934)210 648 A
1026(!)S
(nest)168 1110 A
(level)210 1320 A
1572(to)S
(the)126 1698 A
(number)252 1866 A
2160(of)S
(lines)210 2286 A
(and)126 2538 A
(protects)336 2706 A
(the)126 3084 A
(handler)294 3252 A
(from)168 3588 A
(itself.)294 3798 A
4500 V
(05935)210 648 A
4590 V
(05936)210 648 A
1026(!)S
(For)126 1110 A
(communication)546 1278 A
(with)168 1866 A
(the)126 2076 A
(boot)168 2244 A
(monitor)294 2454 A
2790(at)S
(startup)294 2916 A
(time)168 3252 A
(some)168 3462 A
(constant)336 3672 A
4680 V
(05937)210 648 A
1026(!)S
(data)168 1110 A
(are)126 1320 A
(compiled)336 1488 A
(into)168 1866 A
(the)126 2076 A
(beginning)378 2244 A
2664(of)S
(the)126 2790 A
(text)168 2958 A
(segment.)336 3168 A
(This)168 3546 A
(facilitates)462 3756 A
4770 V
(05938)210 648 A
1026(!)S
(reading)294 1110 A
(the)126 1446 A
(data)168 1614 A
1824(at)S
(the)126 1950 A
(start)210 2118 A
2370(of)S
(the)126 2496 A
(boot)168 2664 A
(process,)336 2874 A
(since)210 3252 A
(only)168 3504 A
(the)126 3714 A
(first)210 3882 A
4860 V
(05939)210 648 A
1026(!)S
(sector)252 1110 A
1404(of)S
(the)126 1530 A
(file)168 1698 A
(needs)210 1908 A
2160(to)S
2286(be)S
(read.)210 2412 A
4950 V
(05940)210 648 A
5040 V
(05941)210 648 A
1026(!)S
(Some)168 1110 A
(data)168 1320 A
(storage)294 1530 A
1866(is)S
(also)168 1992 A
(allocated)378 2202 A
2622(at)S
(the)126 2748 A
(end)126 2916 A
3084(of)S
(this)168 3210 A
(file.)210 3420 A
(This)168 3672 A
(data)168 3882 A
5130 V
(05942)210 648 A
1026(!)S
(will)168 1110 A
1320(be)S
1446(at)S
(the)126 1572 A
(start)210 1740 A
1992(of)S
(the)126 2118 A
(data)168 2286 A
(segment)294 2496 A
2832(of)S
(the)126 2958 A
(kernel)252 3126 A
(and)126 3420 A
(will)168 3588 A
3798(be)S
(read)168 3924 A
5220 V
(05943)210 648 A
1026(!)S
(and)126 1110 A
(modified)336 1278 A
1656(by)S
(the)126 1782 A
(boot)168 1950 A
(monitor)294 2160 A
(before)252 2496 A
(the)126 2790 A
(kernel)252 2958 A
(starts.)294 3252 A
5310 V
(05944)210 648 A
5400 V
(05945)210 648 A
1026(!)S
(sections)336 1110 A
5490 V
(05946)210 648 A
5580 V
(05947)210 648 A
(.sect)210 1026 A
(.text)210 1278 A
5670 V
(05948)210 648 A
(begtext:)336 1026 A
5760 V
(05949)210 648 A
(.sect)210 1026 A
(.rom)168 1278 A
5850 V
(05950)210 648 A
(begrom:)294 1026 A
5940 V
(05951)210 648 A
(.sect)210 1026 A
(.data)210 1278 A
6030 V
(05952)210 648 A
(begdata:)336 1026 A
6120 V
(05953)210 648 A
(.sect)210 1026 A
(.bss)168 1278 A
6210 V
(05954)210 648 A
(begbss:)294 1026 A
8418 V
EP
%%Page: 68 68
BP
/slant 0 def
/height 0 def
630 V
12 B
648(68)S
11 R
1970(File:)S
(src/kernel/mpx386.s)902 2203 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(05955)210 648 A
990 V
(05956)210 648 A
(#include)336 1026 A
(<minix/config.h>)672 1404 A
1080 V
(05957)210 648 A
(#include)336 1026 A
(<minix/const.h>)630 1404 A
1170 V
(05958)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
1260 V
(05959)210 648 A
(#include)336 1026 A
("const.h")378 1404 A
1350 V
(05960)210 648 A
(#include)336 1026 A
("protect.h")462 1404 A
1440 V
(05961)210 648 A
(#include)336 1026 A
("sconst.h")420 1404 A
1530 V
(05962)210 648 A
1620 V
(05963)210 648 A
1026(/*)S
(Selected)336 1152 A
(386)126 1530 A
(tss)126 1698 A
(offsets.)336 1866 A
2244(*/)S
1710 V
(05964)210 648 A
(#define)294 1026 A
(TSS3_S_SP0)420 1362 A
2034(4)S
1800 V
(05965)210 648 A
1890 V
(05966)210 648 A
1026(!)S
(Exported)336 1110 A
(functions)378 1488 A
1980 V
(05967)210 648 A
1026(!)S
(Note:)210 1110 A
1362(in)S
(assembly)336 1488 A
(language)336 1866 A
(the)126 2244 A
(.define)294 2412 A
(statement)378 2748 A
(applied)294 3168 A
3504(to)S
3630(a)S
(function)336 3714 A
(name)168 4092 A
2070 V
(05968)210 648 A
1026(!)S
1110(is)S
(loosely)294 1236 A
(equivalent)420 1572 A
2034(to)S
2160(a)S
(prototype)378 2244 A
2664(in)S
2790(C)S
(code)168 2874 A
3084(--)S
3210(it)S
(makes)210 3336 A
3588(it)S
(possible)336 3714 A
4092(to)S
2160 V
(05969)210 648 A
1026(!)S
(link)168 1110 A
1320(to)S
1446(an)S
(entity)252 1572 A
(declared)336 1866 A
2244(in)S
(the)126 2370 A
(assembly)336 2538 A
(code)168 2916 A
(but)126 3126 A
(does)168 3294 A
(not)126 3504 A
(create)252 3672 A
2250 V
(05970)210 648 A
1026(!)S
(the)126 1110 A
(entity.)294 1278 A
2340 V
(05971)210 648 A
2430 V
(05972)210 648 A
(.define)294 1026 A
(_idle_task)420 1362 A
2520 V
(05973)210 648 A
(.define)294 1026 A
(_restart)336 1362 A
2610 V
(05974)210 648 A
(.define)294 1026 A
(save)168 1362 A
2700 V
(05975)210 648 A
2790 V
(05976)210 648 A
(.define)294 1026 A
(_divide_error)546 1362 A
2880 V
(05977)210 648 A
(.define)294 1026 A
(_single_step_exception)924 1362 A
2970 V
(05978)210 648 A
(.define)294 1026 A
(_nmi)168 1362 A
3060 V
(05979)210 648 A
(.define)294 1026 A
(_breakpoint_exception)882 1362 A
3150 V
(05980)210 648 A
(.define)294 1026 A
(_overflow)378 1362 A
3240 V
(05981)210 648 A
(.define)294 1026 A
(_bounds_check)546 1362 A
3330 V
(05982)210 648 A
(.define)294 1026 A
(_inval_opcode)546 1362 A
3420 V
(05983)210 648 A
(.define)294 1026 A
(_copr_not_available)798 1362 A
3510 V
(05984)210 648 A
(.define)294 1026 A
(_double_fault)546 1362 A
3600 V
(05985)210 648 A
(.define)294 1026 A
(_copr_seg_overrun)714 1362 A
3690 V
(05986)210 648 A
(.define)294 1026 A
(_inval_tss)420 1362 A
3780 V
(05987)210 648 A
(.define)294 1026 A
(_segment_not_present)840 1362 A
3870 V
(05988)210 648 A
(.define)294 1026 A
(_stack_exception)672 1362 A
3960 V
(05989)210 648 A
(.define)294 1026 A
(_general_protection)798 1362 A
4050 V
(05990)210 648 A
(.define)294 1026 A
(_page_fault)462 1362 A
4140 V
(05991)210 648 A
(.define)294 1026 A
(_copr_error)462 1362 A
4230 V
(05992)210 648 A
4320 V
(05993)210 648 A
(.define)294 1026 A
(_hwint00)336 1362 A
2034(!)S
(handlers)336 2118 A
(for)126 2496 A
(hardware)336 2664 A
(interrupts)420 3042 A
4410 V
(05994)210 648 A
(.define)294 1026 A
(_hwint01)336 1362 A
4500 V
(05995)210 648 A
(.define)294 1026 A
(_hwint02)336 1362 A
4590 V
(05996)210 648 A
(.define)294 1026 A
(_hwint03)336 1362 A
4680 V
(05997)210 648 A
(.define)294 1026 A
(_hwint04)336 1362 A
4770 V
(05998)210 648 A
(.define)294 1026 A
(_hwint05)336 1362 A
4860 V
(05999)210 648 A
(.define)294 1026 A
(_hwint06)336 1362 A
4950 V
(06000)210 648 A
(.define)294 1026 A
(_hwint07)336 1362 A
5040 V
(06001)210 648 A
(.define)294 1026 A
(_hwint08)336 1362 A
5130 V
(06002)210 648 A
(.define)294 1026 A
(_hwint09)336 1362 A
5220 V
(06003)210 648 A
(.define)294 1026 A
(_hwint10)336 1362 A
5310 V
(06004)210 648 A
(.define)294 1026 A
(_hwint11)336 1362 A
5400 V
(06005)210 648 A
(.define)294 1026 A
(_hwint12)336 1362 A
5490 V
(06006)210 648 A
(.define)294 1026 A
(_hwint13)336 1362 A
5580 V
(06007)210 648 A
(.define)294 1026 A
(_hwint14)336 1362 A
5670 V
(06008)210 648 A
(.define)294 1026 A
(_hwint15)336 1362 A
5760 V
(06009)210 648 A
5850 V
(06010)210 648 A
(.define)294 1026 A
(_s_call)294 1362 A
5940 V
(06011)210 648 A
(.define)294 1026 A
(_p_s_call)378 1362 A
6030 V
(06012)210 648 A
(.define)294 1026 A
(_level0_call)504 1362 A
6120 V
(06013)210 648 A
6210 V
(06014)210 648 A
1026(!)S
(Imported)336 1110 A
(functions.)420 1488 A
8418 V
EP
%%Page: 69 69
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1970(File:)S
(src/kernel/mpx386.s)902 2203 A
12 B
4308(69)S
900 V
7 LST
(06015)210 648 A
990 V
(06016)210 648 A
(.extern)294 1026 A
(_cstart)294 1362 A
1080 V
(06017)210 648 A
(.extern)294 1026 A
(_main)210 1362 A
1170 V
(06018)210 648 A
(.extern)294 1026 A
(_exception)420 1362 A
1260 V
(06019)210 648 A
(.extern)294 1026 A
(_interrupt)420 1362 A
1350 V
(06020)210 648 A
(.extern)294 1026 A
(_sys_call)378 1362 A
1440 V
(06021)210 648 A
(.extern)294 1026 A
(_unhold)294 1362 A
1530 V
(06022)210 648 A
1620 V
(06023)210 648 A
1026(!)S
(Exported)336 1110 A
(variables.)420 1488 A
1710 V
(06024)210 648 A
1026(!)S
(Note:)210 1110 A
(when)168 1362 A
(used)168 1572 A
(with)168 1782 A
1992(a)S
(variable)336 2076 A
(the)126 2454 A
(.define)294 2622 A
(does)168 2958 A
(not)126 3168 A
(reserve)294 3336 A
(storage,)336 3672 A
1800 V
(06025)210 648 A
1026(!)S
1110(it)S
(makes)210 1236 A
(the)126 1488 A
(name)168 1656 A
(externally)420 1866 A
(visible)294 2328 A
2664(so)S
2790(it)S
(may)126 2916 A
3084(be)S
(linked)252 3210 A
(to.)126 3504 A
1890 V
(06026)210 648 A
1980 V
(06027)210 648 A
(.define)294 1026 A
(begbss)252 1362 A
2070 V
(06028)210 648 A
(.define)294 1026 A
(begdata)294 1362 A
2160 V
(06029)210 648 A
(.define)294 1026 A
(_sizes)252 1362 A
2250 V
(06030)210 648 A
2340 V
(06031)210 648 A
1026(!)S
(Imported)336 1110 A
(variables.)420 1488 A
2430 V
(06032)210 648 A
2520 V
(06033)210 648 A
(.extern)294 1026 A
(_gdt)168 1362 A
2610 V
(06034)210 648 A
(.extern)294 1026 A
(_code_base)420 1362 A
2700 V
(06035)210 648 A
(.extern)294 1026 A
(_data_base)420 1362 A
2790 V
(06036)210 648 A
(.extern)294 1026 A
(_held_head)420 1362 A
2880 V
(06037)210 648 A
(.extern)294 1026 A
(_k_reenter)420 1362 A
2970 V
(06038)210 648 A
(.extern)294 1026 A
(_pc_at)252 1362 A
3060 V
(06039)210 648 A
(.extern)294 1026 A
(_proc_ptr)378 1362 A
3150 V
(06040)210 648 A
(.extern)294 1026 A
(_ps_mca)294 1362 A
3240 V
(06041)210 648 A
(.extern)294 1026 A
(_tss)168 1362 A
3330 V
(06042)210 648 A
(.extern)294 1026 A
(_level0_func)504 1362 A
3420 V
(06043)210 648 A
(.extern)294 1026 A
(_mon_sp)294 1362 A
3510 V
(06044)210 648 A
(.extern)294 1026 A
(_mon_return)462 1362 A
3600 V
(06045)210 648 A
(.extern)294 1026 A
(_reboot_code)504 1362 A
3690 V
(06046)210 648 A
3780 V
(06047)210 648 A
(.sect)210 1026 A
(.text)210 1278 A
3870 V
(06048)210 648 A
(!*===========================================================================*)3276 1026 A
3960 V
(06049)210 648 A
1026(!*)S
(MINIX)210 2370 A
4260(*)S
4050 V
(06050)210 648 A
(!*===========================================================================*)3276 1026 A
4140 V
(06051)210 648 A
(MINIX:)252 1026 A
2370(!)S
(this)168 2454 A
2664(is)S
(the)126 2790 A
(entry)210 2958 A
(point)210 3210 A
(for)126 3462 A
(the)126 3630 A
(MINIX)210 3798 A
(kernel)252 4050 A
4230 V
(06052)210 648 A
(jmp)126 1362 A
(over_flags)420 1698 A
2370(!)S
(skip)168 2454 A
(over)168 2664 A
(the)126 2874 A
(next)168 3042 A
(few)126 3252 A
(bytes)210 3420 A
4320 V
(06053)210 648 A
(.data2)252 1362 A
(CLICK_SHIFT)462 1698 A
2370(!)S
(for)126 2454 A
(the)126 2622 A
(monitor:)336 2790 A
(memory)252 3168 A
(granularity)462 3462 A
4410 V
(06054)210 648 A
(flags:)252 1026 A
4500 V
(06055)210 648 A
(.data2)252 1362 A
(0x002D)252 1698 A
2370(!)S
(boot)168 2454 A
(monitor)294 2664 A
(flags:)252 3000 A
4590 V
(06056)210 648 A
2370(!)S
(call)168 2706 A
2916(in)S
(386)126 3042 A
(mode,)210 3210 A
(make)168 3462 A
(stack,)252 3672 A
4680 V
(06057)210 648 A
2370(!)S
(load)168 2706 A
(high,)210 2916 A
(will)168 3168 A
(return)252 3378 A
4770 V
(06058)210 648 A
(nop)126 1362 A
2370(!)S
(extra)210 2454 A
(byte)168 2706 A
2916(to)S
(sync)168 3042 A
3252(up)S
(disassembler)504 3378 A
4860 V
(06059)210 648 A
(over_flags:)462 1026 A
4950 V
(06060)210 648 A
5040 V
(06061)210 648 A
1026(!)S
(Set)126 1110 A
1278(up)S
1404(a)S
1488(C)S
(stack)210 1572 A
(frame)210 1824 A
2076(on)S
(the)126 2202 A
(monitor)294 2370 A
(stack.)252 2706 A
(\(The)168 3042 A
(monitor)294 3252 A
(sets)168 3588 A
3798(cs)S
(and)126 3924 A
4092(ds)S
5130 V
(06062)210 648 A
1026(!)S
(right.)252 1110 A
(The)126 1446 A
1614(ss)S
(descriptor)420 1740 A
(still)210 2202 A
(references)420 2454 A
(the)126 2916 A
(monitor)294 3084 A
(data)168 3420 A
(segment.\))378 3630 A
5220 V
(06063)210 648 A
(movzx)210 1362 A
(esp,)168 1698 A
1908(sp)S
2370(!)S
(monitor)294 2454 A
(stack)210 2790 A
3042(is)S
3168(a)S
3252(16)S
(bit)126 3378 A
(stack)210 3546 A
5310 V
(06064)210 648 A
(push)168 1362 A
(ebp)126 1698 A
5400 V
(06065)210 648 A
(mov)126 1362 A
(ebp,)168 1698 A
(esp)126 1908 A
5490 V
(06066)210 648 A
(push)168 1362 A
(esi)126 1698 A
5580 V
(06067)210 648 A
(push)168 1362 A
(edi)126 1698 A
5670 V
(06068)210 648 A
(cmp)126 1362 A
(4\(ebp\),)294 1698 A
2034(0)S
2370(!)S
(nonzero)294 2454 A
2790(if)S
(return)252 2916 A
(possible)336 3210 A
5760 V
(06069)210 648 A
1362(jz)S
(noret)210 1698 A
5850 V
(06070)210 648 A
(inc)126 1362 A
(\(_mon_return\))546 1698 A
5940 V
(06071)210 648 A
(noret:)252 1026 A
(mov)126 1362 A
(\(_mon_sp\),)420 1698 A
(esp)126 2160 A
2370(!)S
(save)168 2454 A
(stack)210 2664 A
(pointer)294 2916 A
(for)126 3252 A
(later)210 3420 A
(return)252 3672 A
6030 V
(06072)210 648 A
6120 V
(06073)210 648 A
1026(!)S
(Copy)168 1110 A
(the)126 1320 A
(monitor)294 1488 A
(global)252 1824 A
(descriptor)420 2118 A
(table)210 2580 A
2832(to)S
(the)126 2958 A
(address)294 3126 A
(space)210 3462 A
3714(of)S
(kernel)252 3840 A
(and)126 4134 A
6210 V
(06074)210 648 A
1026(!)S
(switch)252 1110 A
(over)168 1404 A
1614(to)S
(it.)126 1740 A
(Prot_init\(\))462 1950 A
(can)126 2454 A
(then)168 2622 A
(update)252 2832 A
3126(it)S
(with)168 3252 A
(immediate)378 3462 A
(effect.)294 3882 A
8418 V
EP
%%Page: 70 70
BP
/slant 0 def
/height 0 def
630 V
12 B
648(70)S
11 R
1970(File:)S
(src/kernel/mpx386.s)902 2203 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(06075)210 648 A
990 V
(06076)210 648 A
(sgdt)168 1362 A
(\(_gdt+GDT_SELECTOR\))798 1698 A
3042(!)S
(get)126 3126 A
(the)126 3294 A
(monitor)294 3462 A
(gdtr)168 3798 A
1080 V
(06077)210 648 A
(mov)126 1362 A
(esi,)168 1698 A
(\(_gdt+GDT_SELECTOR+2\))882 1908 A
3042(!)S
(absolute)336 3126 A
(address)294 3504 A
3840(of)S
(GDT)126 3966 A
1170 V
(06078)210 648 A
(mov)126 1362 A
(ebx,)168 1698 A
(_gdt)168 1908 A
3042(!)S
(address)294 3126 A
3462(of)S
(kernel)252 3588 A
(GDT)126 3882 A
1260 V
(06079)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(8*8)126 1908 A
3042(!)S
(copying)294 3126 A
(eight)210 3462 A
(descriptors)462 3714 A
1350 V
(06080)210 648 A
(copygdt:)336 1026 A
1440 V
(06081)210 648 A
(eseg)168 1068 A
(movb)168 1362 A
(al,)126 1698 A
(\(esi\))210 1866 A
1530 V
(06082)210 648 A
(movb)168 1362 A
(\(ebx\),)252 1698 A
1992(al)S
1620 V
(06083)210 648 A
(inc)126 1362 A
(esi)126 1698 A
1710 V
(06084)210 648 A
(inc)126 1362 A
(ebx)126 1698 A
1800 V
(06085)210 648 A
(loop)168 1362 A
(copygdt)294 1698 A
1890 V
(06086)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(\(_gdt+DS_SELECTOR+2\))840 1908 A
3042(!)S
(base)168 3126 A
3336(of)S
(kernel)252 3462 A
(data)168 3756 A
1980 V
(06087)210 648 A
(and)126 1362 A
(eax,)168 1698 A
(0x00FFFFFF)420 1908 A
3042(!)S
(only)168 3126 A
3336(24)S
(bits)168 3462 A
2070 V
(06088)210 648 A
(add)126 1362 A
(eax,)168 1698 A
(_gdt)168 1908 A
3042(!)S
(eax)126 3126 A
3294(=)S
(vir2phys\(gdt\))546 3378 A
2160 V
(06089)210 648 A
(mov)126 1362 A
(\(_gdt+GDT_SELECTOR+2\),)924 1698 A
(eax)126 2664 A
3042(!)S
(set)126 3126 A
(base)168 3294 A
3504(of)S
(GDT)126 3630 A
2250 V
(06090)210 648 A
(lgdt)168 1362 A
(\(_gdt+GDT_SELECTOR\))798 1698 A
3042(!)S
(switch)252 3126 A
(over)168 3420 A
3630(to)S
(kernel)252 3756 A
(GDT)126 4050 A
2340 V
(06091)210 648 A
2430 V
(06092)210 648 A
1026(!)S
(Locate)252 1110 A
(boot)168 1404 A
(parameters,)462 1614 A
(set)126 2118 A
2286(up)S
(kernel)252 2412 A
(segment)294 2706 A
(registers)378 3042 A
(and)126 3462 A
(stack.)252 3630 A
2520 V
(06093)210 648 A
(mov)126 1362 A
(ebx,)168 1698 A
(8\(ebp\))252 1908 A
2370(!)S
(boot)168 2454 A
(parameters)420 2664 A
(offset)252 3126 A
2610 V
(06094)210 648 A
(mov)126 1362 A
(edx,)168 1698 A
(12\(ebp\))294 1908 A
2370(!)S
(boot)168 2454 A
(parameters)420 2664 A
(length)252 3126 A
2700 V
(06095)210 648 A
(mov)126 1362 A
(ax,)126 1698 A
1866(ds)S
2370(!)S
(kernel)252 2454 A
(data)168 2748 A
2790 V
(06096)210 648 A
(mov)126 1362 A
(es,)126 1698 A
1866(ax)S
2880 V
(06097)210 648 A
(mov)126 1362 A
(fs,)126 1698 A
1866(ax)S
2970 V
(06098)210 648 A
(mov)126 1362 A
(gs,)126 1698 A
1866(ax)S
3060 V
(06099)210 648 A
(mov)126 1362 A
(ss,)126 1698 A
1866(ax)S
3150 V
(06100)210 648 A
(mov)126 1362 A
(esp,)168 1698 A
(k_stktop)336 1908 A
2370(!)S
(set)126 2454 A
2622(sp)S
2748(to)S
(point)210 2874 A
3126(to)S
(the)126 3252 A
(top)126 3420 A
3588(of)S
(kernel)252 3714 A
(stack)210 4008 A
3240 V
(06101)210 648 A
3330 V
(06102)210 648 A
1026(!)S
(Call)168 1110 A
1320(C)S
(startup)294 1404 A
(code)168 1740 A
1950(to)S
(set)126 2076 A
2244(up)S
2370(a)S
(proper)252 2454 A
(environment)462 2748 A
3252(to)S
(run)126 3378 A
(main\(\).)294 3546 A
3420 V
(06103)210 648 A
(push)168 1362 A
(edx)126 1698 A
3510 V
(06104)210 648 A
(push)168 1362 A
(ebx)126 1698 A
3600 V
(06105)210 648 A
(push)168 1362 A
(SS_SELECTOR)462 1698 A
3690 V
(06106)210 648 A
(push)168 1362 A
(MON_CS_SELECTOR)630 1698 A
3780 V
(06107)210 648 A
(push)168 1362 A
(DS_SELECTOR)462 1698 A
3870 V
(06108)210 648 A
(push)168 1362 A
(CS_SELECTOR)462 1698 A
3960 V
(06109)210 648 A
(call)168 1362 A
(_cstart)294 1698 A
2370(!)S
(cstart\(cs,)420 2454 A
(ds,)126 2916 A
(mcs,)168 3084 A
(mds,)168 3294 A
(parmoff,)336 3504 A
(parmlen\))336 3882 A
4050 V
(06110)210 648 A
(add)126 1362 A
(esp,)168 1698 A
(6*4)126 1908 A
4140 V
(06111)210 648 A
4230 V
(06112)210 648 A
1026(!)S
(Reload)252 1110 A
(gdtr,)210 1404 A
(idtr)168 1656 A
(and)126 1866 A
(the)126 2034 A
(segment)294 2202 A
(registers)378 2538 A
2958(to)S
(global)252 3084 A
(descriptor)420 3378 A
(table)210 3840 A
(set)126 4092 A
4320 V
(06113)210 648 A
1026(!)S
1110(up)S
1236(by)S
(prot_init\(\).)504 1362 A
4410 V
(06114)210 648 A
4500 V
(06115)210 648 A
(lgdt)168 1362 A
(\(_gdt+GDT_SELECTOR\))798 1698 A
4590 V
(06116)210 648 A
(lidt)168 1362 A
(\(_gdt+IDT_SELECTOR\))798 1698 A
4680 V
(06117)210 648 A
4770 V
(06118)210 648 A
(jmpf)168 1362 A
(CS_SELECTOR:csinit)756 1698 A
4860 V
(06119)210 648 A
(csinit:)294 1026 A
4950 V
(06120)210 648 A
(o16)126 1194 A
(mov)126 1362 A
(ax,)126 1698 A
(DS_SELECTOR)462 1866 A
5040 V
(06121)210 648 A
(mov)126 1362 A
(ds,)126 1698 A
1866(ax)S
5130 V
(06122)210 648 A
(mov)126 1362 A
(es,)126 1698 A
1866(ax)S
5220 V
(06123)210 648 A
(mov)126 1362 A
(fs,)126 1698 A
1866(ax)S
5310 V
(06124)210 648 A
(mov)126 1362 A
(gs,)126 1698 A
1866(ax)S
5400 V
(06125)210 648 A
(mov)126 1362 A
(ss,)126 1698 A
1866(ax)S
5490 V
(06126)210 648 A
(o16)126 1194 A
(mov)126 1362 A
(ax,)126 1698 A
(TSS_SELECTOR)504 1866 A
2706(!)S
2790(no)S
(other)210 2916 A
(TSS)126 3168 A
3336(is)S
(used)168 3462 A
5580 V
(06127)210 648 A
(ltr)126 1362 A
1698(ax)S
5670 V
(06128)210 648 A
(push)168 1362 A
1698(0)S
2706(!)S
(set)126 2790 A
(flags)210 2958 A
3210(to)S
(known)210 3336 A
(good)168 3588 A
(state)210 3798 A
5760 V
(06129)210 648 A
(popf)168 1362 A
2706(!)S
(esp,)168 2790 A
(clear)210 3000 A
(nested)252 3252 A
(task)168 3546 A
(and)126 3756 A
(int)126 3924 A
(enable)252 4092 A
5850 V
(06130)210 648 A
5940 V
(06131)210 648 A
(jmp)126 1362 A
(_main)210 1698 A
2706(!)S
(main\(\))252 2790 A
6030 V
(06132)210 648 A
6120 V
(06133)210 648 A
6210 V
(06134)210 648 A
(!*===========================================================================*)3276 1026 A
8418 V
EP
%%Page: 71 71
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1970(File:)S
(src/kernel/mpx386.s)902 2203 A
12 B
4308(71)S
900 V
7 LST
(06135)210 648 A
1026(!*)S
(interrupt)378 2370 A
(handlers)336 2790 A
4260(*)S
990 V
(06136)210 648 A
1026(!*)S
(interrupt)378 1698 A
(handlers)336 2118 A
(for)126 2496 A
(386)126 2664 A
(32-bit)252 2832 A
(protected)378 3126 A
(mode)168 3546 A
4260(*)S
1080 V
(06137)210 648 A
(!*===========================================================================*)3276 1026 A
1170 V
(06138)210 648 A
1260 V
(06139)210 648 A
(!*===========================================================================*)3276 1026 A
1350 V
(06140)210 648 A
1026(!*)S
(hwint00)294 2370 A
2706(-)S
2790(07)S
4260(*)S
1440 V
(06141)210 648 A
(!*===========================================================================*)3276 1026 A
1530 V
(06142)210 648 A
1026(!)S
(Note)168 1110 A
(this)168 1320 A
1530(is)S
1656(a)S
(macro,)252 1740 A
2034(it)S
(looks)210 2160 A
(like)168 2412 A
2622(a)S
(subroutine.)462 2706 A
1620 V
(06143)210 648 A
(#define)294 1026 A
(hwint_master\(irq\))714 1362 A
2370(\\)S
1710 V
(06144)210 648 A
(call)168 1362 A
(save)168 1698 A
2706(/*)S
(save)168 2832 A
(interrupted)462 3042 A
(process)294 3546 A
(state)210 3882 A
(*/;\\)168 4134 A
1800 V
(06145)210 648 A
(inb)126 1362 A
(INT_CTLMASK)462 1698 A
4218(;\\)S
1890 V
(06146)210 648 A
(orb)126 1362 A
(al,)126 1698 A
([1<<irq])336 1866 A
4218(;\\)S
1980 V
(06147)210 648 A
(outb)168 1362 A
(INT_CTLMASK)462 1698 A
2706(/*)S
(disable)294 2832 A
(the)126 3168 A
(irq)126 3336 A
(*/;\\)168 4134 A
2070 V
(06148)210 648 A
(movb)168 1362 A
(al,)126 1698 A
(ENABLE)252 1866 A
4218(;\\)S
2160 V
(06149)210 648 A
(outb)168 1362 A
(INT_CTL)294 1698 A
2706(/*)S
(reenable)336 2832 A
(master)252 3210 A
(8259)168 3504 A
(*/;\\)168 4134 A
2250 V
(06150)210 648 A
(sti)126 1362 A
2706(/*)S
(enable)252 2832 A
(interrupts)420 3126 A
(*/;\\)168 4134 A
2340 V
(06151)210 648 A
(push)168 1362 A
(irq)126 1698 A
2706(/*)S
(irq)126 2832 A
(*/;\\)168 4134 A
2430 V
(06152)210 648 A
(call)168 1362 A
(\(_irq_table)462 1698 A
2202(+)S
(4*irq\))252 2286 A
2706(/*)S
(eax)126 2832 A
3000(=)S
(\(*irq_table[irq]\)\(irq\))924 3084 A
(*/;\\)168 4134 A
2520 V
(06153)210 648 A
(pop)126 1362 A
(ecx)126 1698 A
4218(;\\)S
2610 V
(06154)210 648 A
(cli)126 1362 A
2706(/*)S
(disable)294 2832 A
(interrupts)420 3168 A
(*/;\\)168 4134 A
2700 V
(06155)210 648 A
(test)168 1362 A
(eax,)168 1698 A
(eax)126 1908 A
2706(/*)S
(need)168 2832 A
3042(to)S
(reenable)336 3168 A
(irq?)168 3546 A
(*/;\\)168 4134 A
2790 V
(06156)210 648 A
1362(jz)S
1698(0f)S
4218(;\\)S
2880 V
(06157)210 648 A
(inb)126 1362 A
(INT_CTLMASK)462 1698 A
4218(;\\)S
2970 V
(06158)210 648 A
(andb)168 1362 A
(al,)126 1698 A
(\304[1<<irq])378 1866 A
4218(;\\)S
3060 V
(06159)210 648 A
(outb)168 1362 A
(INT_CTLMASK)462 1698 A
2706(/*)S
(enable)252 2832 A
(the)126 3126 A
(irq)126 3294 A
(*/;\\)168 4134 A
3150 V
(06160)210 648 A
1026(0:)S
(ret)126 1362 A
2706(/*)S
(restart)294 2832 A
(\(another\))378 3168 A
(process)294 3588 A
4134(*/)S
3240 V
(06161)210 648 A
3330 V
(06162)210 648 A
1026(!)S
(Each)168 1110 A
1320(of)S
(these)210 1446 A
(entry)210 1698 A
(points)252 1950 A
2244(is)S
2370(an)S
(expansion)378 2496 A
2916(of)S
(the)126 3042 A
(hwint_master)504 3210 A
(macro)210 3756 A
3420 V
(06163)210 648 A
(.align)252 1362 A
1698(16)S
3510 V
(06164)210 648 A
(_hwint00:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(0)S
(\(the)168 3294 A
(clock\).)294 3504 A
3600 V
(06165)210 648 A
(hwint_master\(0\))630 1362 A
3690 V
(06166)210 648 A
3780 V
(06167)210 648 A
(.align)252 1362 A
1698(16)S
3870 V
(06168)210 648 A
(_hwint01:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(1)S
(\(keyboard\))420 3294 A
3960 V
(06169)210 648 A
(hwint_master\(1\))630 1362 A
4050 V
(06170)210 648 A
4140 V
(06171)210 648 A
(.align)252 1362 A
1698(16)S
4230 V
(06172)210 648 A
(_hwint02:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(2)S
(\(cascade!\))420 3294 A
4320 V
(06173)210 648 A
(hwint_master\(2\))630 1362 A
4410 V
(06174)210 648 A
4500 V
(06175)210 648 A
(.align)252 1362 A
1698(16)S
4590 V
(06176)210 648 A
(_hwint03:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(3)S
(\(second)294 3294 A
(serial\))294 3630 A
4680 V
(06177)210 648 A
(hwint_master\(3\))630 1362 A
4770 V
(06178)210 648 A
4860 V
(06179)210 648 A
(.align)252 1362 A
1698(16)S
4950 V
(06180)210 648 A
(_hwint04:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(4)S
(\(first)252 3294 A
(serial\))294 3588 A
5040 V
(06181)210 648 A
(hwint_master\(4\))630 1362 A
5130 V
(06182)210 648 A
5220 V
(06183)210 648 A
(.align)252 1362 A
1698(16)S
5310 V
(06184)210 648 A
(_hwint05:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(5)S
(\(XT)126 3294 A
(winchester\))462 3462 A
5400 V
(06185)210 648 A
(hwint_master\(5\))630 1362 A
5490 V
(06186)210 648 A
5580 V
(06187)210 648 A
(.align)252 1362 A
1698(16)S
5670 V
(06188)210 648 A
(_hwint06:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(6)S
(\(floppy\))336 3294 A
5760 V
(06189)210 648 A
(hwint_master\(6\))630 1362 A
5850 V
(06190)210 648 A
5940 V
(06191)210 648 A
(.align)252 1362 A
1698(16)S
6030 V
(06192)210 648 A
(_hwint07:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(7)S
(\(printer\))378 3294 A
6120 V
(06193)210 648 A
(hwint_master\(7\))630 1362 A
6210 V
(06194)210 648 A
8418 V
EP
%%Page: 72 72
BP
/slant 0 def
/height 0 def
630 V
12 B
648(72)S
11 R
1970(File:)S
(src/kernel/mpx386.s)902 2203 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(06195)210 648 A
(!*===========================================================================*)3276 1026 A
990 V
(06196)210 648 A
1026(!*)S
(hwint08)294 2370 A
2706(-)S
2790(15)S
4260(*)S
1080 V
(06197)210 648 A
(!*===========================================================================*)3276 1026 A
1170 V
(06198)210 648 A
1026(!)S
(Note)168 1110 A
(this)168 1320 A
1530(is)S
1656(a)S
(macro,)252 1740 A
2034(it)S
(looks)210 2160 A
(like)168 2412 A
2622(a)S
(subroutine.)462 2706 A
1260 V
(06199)210 648 A
(#define)294 1026 A
(hwint_slave\(irq\))672 1362 A
2370(\\)S
1350 V
(06200)210 648 A
(call)168 1362 A
(save)168 1698 A
2706(/*)S
(save)168 2832 A
(interrupted)462 3042 A
(process)294 3546 A
(state)210 3882 A
(*/;\\)168 4134 A
1440 V
(06201)210 648 A
(inb)126 1362 A
(INT2_CTLMASK)504 1698 A
4218(;\\)S
1530 V
(06202)210 648 A
(orb)126 1362 A
(al,)126 1698 A
([1<<[irq-8]])504 1866 A
4218(;\\)S
1620 V
(06203)210 648 A
(outb)168 1362 A
(INT2_CTLMASK)504 1698 A
2706(/*)S
(disable)294 2832 A
(the)126 3168 A
(irq)126 3336 A
(*/;\\)168 4134 A
1710 V
(06204)210 648 A
(movb)168 1362 A
(al,)126 1698 A
(ENABLE)252 1866 A
4218(;\\)S
1800 V
(06205)210 648 A
(outb)168 1362 A
(INT_CTL)294 1698 A
2706(/*)S
(reenable)336 2832 A
(master)252 3210 A
(8259)168 3504 A
(*/;\\)168 4134 A
1890 V
(06206)210 648 A
(jmp)126 1362 A
(.+2)126 1698 A
2706(/*)S
(delay)210 2832 A
(*/;\\)168 4134 A
1980 V
(06207)210 648 A
(outb)168 1362 A
(INT2_CTL)336 1698 A
2706(/*)S
(reenable)336 2832 A
(slave)210 3210 A
(8259)168 3462 A
(*/;\\)168 4134 A
2070 V
(06208)210 648 A
(sti)126 1362 A
2706(/*)S
(enable)252 2832 A
(interrupts)420 3126 A
(*/;\\)168 4134 A
2160 V
(06209)210 648 A
(push)168 1362 A
(irq)126 1698 A
2706(/*)S
(irq)126 2832 A
(*/;\\)168 4134 A
2250 V
(06210)210 648 A
(call)168 1362 A
(\(_irq_table)462 1698 A
2202(+)S
(4*irq\))252 2286 A
2706(/*)S
(eax)126 2832 A
3000(=)S
(\(*irq_table[irq]\)\(irq\))924 3084 A
(*/;\\)168 4134 A
2340 V
(06211)210 648 A
(pop)126 1362 A
(ecx)126 1698 A
4218(;\\)S
2430 V
(06212)210 648 A
(cli)126 1362 A
2706(/*)S
(disable)294 2832 A
(interrupts)420 3168 A
(*/;\\)168 4134 A
2520 V
(06213)210 648 A
(test)168 1362 A
(eax,)168 1698 A
(eax)126 1908 A
2706(/*)S
(need)168 2832 A
3042(to)S
(reenable)336 3168 A
(irq?)168 3546 A
(*/;\\)168 4134 A
2610 V
(06214)210 648 A
1362(jz)S
1698(0f)S
4218(;\\)S
2700 V
(06215)210 648 A
(inb)126 1362 A
(INT2_CTLMASK)504 1698 A
4218(;\\)S
2790 V
(06216)210 648 A
(andb)168 1362 A
(al,)126 1698 A
(\304[1<<[irq-8]])546 1866 A
4218(;\\)S
2880 V
(06217)210 648 A
(outb)168 1362 A
(INT2_CTLMASK)504 1698 A
2706(/*)S
(enable)252 2832 A
(the)126 3126 A
(irq)126 3294 A
(*/;\\)168 4134 A
2970 V
(06218)210 648 A
1026(0:)S
(ret)126 1362 A
2706(/*)S
(restart)294 2832 A
(\(another\))378 3168 A
(process)294 3588 A
4134(*/)S
3060 V
(06219)210 648 A
3150 V
(06220)210 648 A
1026(!)S
(Each)168 1110 A
1320(of)S
(these)210 1446 A
(entry)210 1698 A
(points)252 1950 A
2244(is)S
2370(an)S
(expansion)378 2496 A
2916(of)S
(the)126 3042 A
(hwint_slave)462 3210 A
(macro)210 3714 A
3240 V
(06221)210 648 A
(.align)252 1362 A
1698(16)S
3330 V
(06222)210 648 A
(_hwint08:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(8)S
(\(realtime)378 3294 A
(clock\))252 3714 A
3420 V
(06223)210 648 A
(hwint_slave\(8\))588 1362 A
3510 V
(06224)210 648 A
3600 V
(06225)210 648 A
(.align)252 1362 A
1698(16)S
3690 V
(06226)210 648 A
(_hwint09:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(9)S
(\(irq)168 3294 A
3504(2)S
(redirected\))462 3588 A
3780 V
(06227)210 648 A
(hwint_slave\(9\))588 1362 A
3870 V
(06228)210 648 A
3960 V
(06229)210 648 A
(.align)252 1362 A
1698(16)S
4050 V
(06230)210 648 A
(_hwint10:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(10)S
4140 V
(06231)210 648 A
(hwint_slave\(10\))630 1362 A
4230 V
(06232)210 648 A
4320 V
(06233)210 648 A
(.align)252 1362 A
1698(16)S
4410 V
(06234)210 648 A
(_hwint11:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(11)S
4500 V
(06235)210 648 A
(hwint_slave\(11\))630 1362 A
4590 V
(06236)210 648 A
4680 V
(06237)210 648 A
(.align)252 1362 A
1698(16)S
4770 V
(06238)210 648 A
(_hwint12:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(12)S
4860 V
(06239)210 648 A
(hwint_slave\(12\))630 1362 A
4950 V
(06240)210 648 A
5040 V
(06241)210 648 A
(.align)252 1362 A
1698(16)S
5130 V
(06242)210 648 A
(_hwint13:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(13)S
(\(FPU)168 3336 A
(exception\))420 3546 A
5220 V
(06243)210 648 A
(hwint_slave\(13\))630 1362 A
5310 V
(06244)210 648 A
5400 V
(06245)210 648 A
(.align)252 1362 A
1698(16)S
5490 V
(06246)210 648 A
(_hwint14:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(14)S
(\(AT)126 3336 A
(winchester\))462 3504 A
5580 V
(06247)210 648 A
(hwint_slave\(14\))630 1362 A
5670 V
(06248)210 648 A
5760 V
(06249)210 648 A
(.align)252 1362 A
1698(16)S
5850 V
(06250)210 648 A
(_hwint15:)378 1026 A
2034(!)S
(Interrupt)378 2118 A
(routine)294 2538 A
(for)126 2874 A
(irq)126 3042 A
3210(15)S
5940 V
(06251)210 648 A
(hwint_slave\(15\))630 1362 A
6030 V
(06252)210 648 A
6120 V
(06253)210 648 A
(!*===========================================================================*)3276 1026 A
6210 V
(06254)210 648 A
1026(!*)S
(save)168 2370 A
4260(*)S
8418 V
EP
%%Page: 73 73
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1970(File:)S
(src/kernel/mpx386.s)902 2203 A
12 B
4308(73)S
900 V
7 LST
(06255)210 648 A
(!*===========================================================================*)3276 1026 A
990 V
(06256)210 648 A
1026(!)S
(Save)168 1110 A
(for)126 1320 A
(protected)378 1488 A
(mode.)210 1908 A
1080 V
(06257)210 648 A
1026(!)S
(This)168 1110 A
1320(is)S
(much)168 1446 A
(simpler)294 1656 A
(than)168 1992 A
(for)126 2202 A
(8086)168 2370 A
(mode,)210 2580 A
(because)294 2832 A
(the)126 3168 A
(stack)210 3336 A
(already)294 3588 A
(points)252 3924 A
1170 V
(06258)210 648 A
1026(!)S
(into)168 1110 A
(the)126 1320 A
(process)294 1488 A
(table,)252 1824 A
2118(or)S
(has)126 2244 A
(already)294 2412 A
(been)168 2748 A
(switched)336 2958 A
3336(to)S
(the)126 3462 A
(kernel)252 3630 A
(stack.)252 3924 A
1260 V
(06259)210 648 A
1350 V
(06260)210 648 A
(.align)252 1362 A
1698(16)S
1440 V
(06261)210 648 A
(save:)210 1026 A
1530 V
(06262)210 648 A
(cld)126 1362 A
2370(!)S
(set)126 2454 A
(direction)378 2622 A
(flag)168 3042 A
3252(to)S
3378(a)S
(known)210 3462 A
(value)210 3714 A
1620 V
(06263)210 648 A
(pushad)252 1362 A
2370(!)S
(save)168 2454 A
("general")378 2664 A
(registers)378 3084 A
1710 V
(06264)210 648 A
(o16)126 1194 A
(push)168 1362 A
1698(ds)S
2370(!)S
(save)168 2454 A
2664(ds)S
1800 V
(06265)210 648 A
(o16)126 1194 A
(push)168 1362 A
1698(es)S
2370(!)S
(save)168 2454 A
2664(es)S
1890 V
(06266)210 648 A
(o16)126 1194 A
(push)168 1362 A
1698(fs)S
2370(!)S
(save)168 2454 A
2664(fs)S
1980 V
(06267)210 648 A
(o16)126 1194 A
(push)168 1362 A
1698(gs)S
2370(!)S
(save)168 2454 A
2664(gs)S
2070 V
(06268)210 648 A
(mov)126 1362 A
(dx,)126 1698 A
1866(ss)S
2370(!)S
2454(ss)S
2580(is)S
(kernel)252 2706 A
(data)168 3000 A
(segment)294 3210 A
2160 V
(06269)210 648 A
(mov)126 1362 A
(ds,)126 1698 A
1866(dx)S
2370(!)S
(load)168 2454 A
(rest)168 2664 A
2874(of)S
(kernel)252 3000 A
(segments)336 3294 A
2250 V
(06270)210 648 A
(mov)126 1362 A
(es,)126 1698 A
1866(dx)S
2370(!)S
(kernel)252 2454 A
(does)168 2748 A
(not)126 2958 A
(use)126 3126 A
(fs,)126 3294 A
3462(gs)S
2340 V
(06271)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(esp)126 1908 A
2370(!)S
(prepare)294 2454 A
2790(to)S
(return)252 2916 A
2430 V
(06272)210 648 A
(incb)168 1362 A
(\(_k_reenter\))504 1698 A
2370(!)S
(from)168 2454 A
2664(-1)S
2790(if)S
(not)126 2916 A
(reentering)420 3084 A
2520 V
(06273)210 648 A
(jnz)126 1362 A
(set_restart1)504 1698 A
2370(!)S
(stack)210 2454 A
2706(is)S
(already)294 2832 A
(kernel)252 3168 A
(stack)210 3462 A
2610 V
(06274)210 648 A
(mov)126 1362 A
(esp,)168 1698 A
(k_stktop)336 1908 A
2700 V
(06275)210 648 A
(push)168 1362 A
(_restart)336 1698 A
2370(!)S
(build)210 2454 A
(return)252 2706 A
(address)294 3000 A
(for)126 3336 A
(int)126 3504 A
(handler)294 3672 A
2790 V
(06276)210 648 A
(xor)126 1362 A
(ebp,)168 1698 A
(ebp)126 1908 A
2370(!)S
(for)126 2454 A
(stacktrace)420 2622 A
2880 V
(06277)210 648 A
(jmp)126 1362 A
(RETADR-P_STACKBASE\(eax\))966 1698 A
2970 V
(06278)210 648 A
3060 V
(06279)210 648 A
(.align)252 1362 A
1698(4)S
3150 V
(06280)210 648 A
(set_restart1:)546 1026 A
3240 V
(06281)210 648 A
(push)168 1362 A
(restart1)336 1698 A
3330 V
(06282)210 648 A
(jmp)126 1362 A
(RETADR-P_STACKBASE\(eax\))966 1698 A
3420 V
(06283)210 648 A
3510 V
(06284)210 648 A
(!*===========================================================================*)3276 1026 A
3600 V
(06285)210 648 A
1026(!*)S
(_s_call)294 2370 A
4260(*)S
3690 V
(06286)210 648 A
(!*===========================================================================*)3276 1026 A
3780 V
(06287)210 648 A
(.align)252 1362 A
1698(16)S
3870 V
(06288)210 648 A
(_s_call:)336 1026 A
3960 V
(06289)210 648 A
(_p_s_call:)420 1026 A
4050 V
(06290)210 648 A
(cld)126 1362 A
2370(!)S
(set)126 2454 A
(direction)378 2622 A
(flag)168 3042 A
3252(to)S
3378(a)S
(known)210 3462 A
(value)210 3714 A
4140 V
(06291)210 648 A
(sub)126 1362 A
(esp,)168 1698 A
(6*4)126 1908 A
2370(!)S
(skip)168 2454 A
(RETADR,)294 2664 A
(eax,)168 3000 A
(ecx,)168 3210 A
(edx,)168 3420 A
(ebx,)168 3630 A
(est)126 3840 A
4230 V
(06292)210 648 A
(push)168 1362 A
(ebp)126 1698 A
2370(!)S
(stack)210 2454 A
(already)294 2706 A
(points)252 3042 A
(into)168 3336 A
(proc)168 3546 A
(table)210 3756 A
4320 V
(06293)210 648 A
(push)168 1362 A
(esi)126 1698 A
4410 V
(06294)210 648 A
(push)168 1362 A
(edi)126 1698 A
4500 V
(06295)210 648 A
(o16)126 1194 A
(push)168 1362 A
1698(ds)S
4590 V
(06296)210 648 A
(o16)126 1194 A
(push)168 1362 A
1698(es)S
4680 V
(06297)210 648 A
(o16)126 1194 A
(push)168 1362 A
1698(fs)S
4770 V
(06298)210 648 A
(o16)126 1194 A
(push)168 1362 A
1698(gs)S
4860 V
(06299)210 648 A
(mov)126 1362 A
(dx,)126 1698 A
1866(ss)S
4950 V
(06300)210 648 A
(mov)126 1362 A
(ds,)126 1698 A
1866(dx)S
5040 V
(06301)210 648 A
(mov)126 1362 A
(es,)126 1698 A
1866(dx)S
5130 V
(06302)210 648 A
(incb)168 1362 A
(\(_k_reenter\))504 1698 A
5220 V
(06303)210 648 A
(mov)126 1362 A
(esi,)168 1698 A
(esp)126 1908 A
2370(!)S
(assumes)294 2454 A
(P_STACKBASE)462 2790 A
3294(==)S
3420(0)S
5310 V
(06304)210 648 A
(mov)126 1362 A
(esp,)168 1698 A
(k_stktop)336 1908 A
5400 V
(06305)210 648 A
(xor)126 1362 A
(ebp,)168 1698 A
(ebp)126 1908 A
2370(!)S
(for)126 2454 A
(stacktrace)420 2622 A
5490 V
(06306)210 648 A
2370(!)S
(end)126 2454 A
2622(of)S
(inline)252 2748 A
(save)168 3042 A
5580 V
(06307)210 648 A
(sti)126 1362 A
2370(!)S
(allow)210 2454 A
(SWITCHER)336 2706 A
3084(to)S
3210(be)S
(interrupted)462 3336 A
5670 V
(06308)210 648 A
2370(!)S
(now)126 2454 A
(set)126 2622 A
2790(up)S
(parameters)420 2916 A
(for)126 3378 A
(sys_call\(\))420 3546 A
5760 V
(06309)210 648 A
(push)168 1362 A
(ebx)126 1698 A
2370(!)S
(pointer)294 2454 A
2790(to)S
(user)168 2916 A
(message)294 3126 A
5850 V
(06310)210 648 A
(push)168 1362 A
(eax)126 1698 A
2370(!)S
(src/dest)336 2454 A
5940 V
(06311)210 648 A
(push)168 1362 A
(ecx)126 1698 A
2370(!)S
(SEND/RECEIVE/BOTH)714 2454 A
6030 V
(06312)210 648 A
(call)168 1362 A
(_sys_call)378 1698 A
2370(!)S
(sys_call\(function,)756 2454 A
(src_dest,)378 3252 A
(m_ptr\))252 3672 A
6120 V
(06313)210 648 A
2370(!)S
(caller)252 2454 A
2748(is)S
(now)126 2874 A
(explicitly)420 3042 A
3504(in)S
(proc_ptr)336 3630 A
6210 V
(06314)210 648 A
(mov)126 1362 A
(AXREG\(esi\),)462 1698 A
(eax)126 2202 A
2370(!)S
(sys_call)336 2454 A
(MUST)168 2832 A
(PRESERVE)336 3042 A
3420(si)S
8418 V
EP
%%Page: 74 74
BP
/slant 0 def
/height 0 def
630 V
12 B
648(74)S
11 R
1970(File:)S
(src/kernel/mpx386.s)902 2203 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(06315)210 648 A
(cli)126 1362 A
2370(!)S
(disable)294 2454 A
(interrupts)420 2790 A
990 V
(06316)210 648 A
1080 V
(06317)210 648 A
1026(!)S
(Fall)168 1110 A
(into)168 1320 A
(code)168 1530 A
1740(to)S
(restart)294 1866 A
(proc/task)378 2202 A
(running.)336 2622 A
1170 V
(06318)210 648 A
1260 V
(06319)210 648 A
(!*===========================================================================*)3276 1026 A
1350 V
(06320)210 648 A
1026(!*)S
(restart)294 2370 A
4260(*)S
1440 V
(06321)210 648 A
(!*===========================================================================*)3276 1026 A
1530 V
(06322)210 648 A
(_restart:)378 1026 A
1620 V
(06323)210 648 A
1710 V
(06324)210 648 A
1026(!)S
(Flush)210 1110 A
(any)126 1362 A
(held-up)294 1530 A
(interrupts.)462 1866 A
1800 V
(06325)210 648 A
1026(!)S
(This)168 1110 A
(reenables)378 1320 A
(interrupts,)462 1740 A
2244(so)S
(the)126 2370 A
(current)294 2538 A
(interrupt)378 2874 A
(handler)294 3294 A
(may)126 3630 A
(reenter.)336 3798 A
1890 V
(06326)210 648 A
1026(!)S
(This)168 1110 A
(does)168 1320 A
(not)126 1530 A
(matter,)294 1698 A
(because)294 2034 A
(the)126 2370 A
(current)294 2538 A
(handler)294 2874 A
3210(is)S
(about)210 3336 A
3588(to)S
(exit)168 3714 A
(and)126 3924 A
4092(no)S
1980 V
(06327)210 648 A
1026(!)S
(other)210 1110 A
(handlers)336 1362 A
(can)126 1740 A
(reenter)294 1908 A
(since)210 2244 A
(flushing)336 2496 A
2874(is)S
(only)168 3000 A
(done)168 3210 A
(when)168 3420 A
(k_reenter)378 3630 A
4050(==)S
4176(0.)S
2070 V
(06328)210 648 A
2160 V
(06329)210 648 A
(cmp)126 1362 A
(\(_held_head\),)546 1698 A
2286(0)S
2370(!)S
2454(do)S
(fast)168 2580 A
(test)168 2790 A
3000(to)S
(usually)294 3126 A
(avoid)210 3462 A
(function)336 3714 A
(call)168 4092 A
2250 V
(06330)210 648 A
1362(jz)S
(over_call_unhold)672 1698 A
2340 V
(06331)210 648 A
(call)168 1362 A
(_unhold)294 1698 A
2370(!)S
(this)168 2454 A
2664(is)S
(rare)168 2790 A
3000(so)S
(overhead)336 3126 A
(acceptable)420 3504 A
2430 V
(06332)210 648 A
(over_call_unhold:)714 1026 A
2520 V
(06333)210 648 A
(mov)126 1362 A
(esp,)168 1698 A
(\(_proc_ptr\))462 1908 A
2706(!)S
(will)168 2790 A
(assume)252 3000 A
(P_STACKBASE)462 3294 A
3798(==)S
3924(0)S
2610 V
(06334)210 648 A
(lldt)168 1362 A
(P_LDT_SEL\(esp\))588 1698 A
2706(!)S
(enable)252 2790 A
(segment)294 3084 A
(descriptors)462 3420 A
(for)126 3924 A
(task)168 4092 A
2700 V
(06335)210 648 A
(lea)126 1362 A
(eax,)168 1698 A
(P_STACKTOP\(esp\))630 1908 A
2706(!)S
(arrange)294 2790 A
(for)126 3126 A
(next)168 3294 A
(interrupt)378 3504 A
2790 V
(06336)210 648 A
(mov)126 1362 A
(\(_tss+TSS3_S_SP0\),)756 1698 A
(eax)126 2496 A
2706(!)S
2790(to)S
(save)168 2916 A
(state)210 3126 A
3378(in)S
(process)294 3504 A
(table)210 3840 A
2880 V
(06337)210 648 A
(restart1:)378 1026 A
2970 V
(06338)210 648 A
(decb)168 1362 A
(\(_k_reenter\))504 1698 A
3060 V
(06339)210 648 A
(o16)126 1194 A
(pop)126 1362 A
1698(gs)S
3150 V
(06340)210 648 A
(o16)126 1194 A
(pop)126 1362 A
1698(fs)S
3240 V
(06341)210 648 A
(o16)126 1194 A
(pop)126 1362 A
1698(es)S
3330 V
(06342)210 648 A
(o16)126 1194 A
(pop)126 1362 A
1698(ds)S
3420 V
(06343)210 648 A
(popad)210 1362 A
3510 V
(06344)210 648 A
(add)126 1362 A
(esp,)168 1698 A
1908(4)S
2370(!)S
(skip)168 2454 A
(return)252 2664 A
(adr)126 2958 A
3600 V
(06345)210 648 A
(iretd)210 1362 A
2370(!)S
(continue)336 2454 A
(process)294 2832 A
3690 V
(06346)210 648 A
3780 V
(06347)210 648 A
(!*===========================================================================*)3276 1026 A
3870 V
(06348)210 648 A
1026(!*)S
(exception)378 2370 A
(handlers)336 2790 A
4260(*)S
3960 V
(06349)210 648 A
(!*===========================================================================*)3276 1026 A
4050 V
(06350)210 648 A
(_divide_error:)588 1026 A
4140 V
(06351)210 648 A
(push)168 1362 A
(DIVIDE_VECTOR)546 1698 A
4230 V
(06352)210 648 A
(jmp)126 1362 A
(exception)378 1698 A
4320 V
(06353)210 648 A
4410 V
(06354)210 648 A
(_single_step_exception:)966 1026 A
4500 V
(06355)210 648 A
(push)168 1362 A
(DEBUG_VECTOR)504 1698 A
4590 V
(06356)210 648 A
(jmp)126 1362 A
(exception)378 1698 A
4680 V
(06357)210 648 A
4770 V
(06358)210 648 A
(_nmi:)210 1026 A
4860 V
(06359)210 648 A
(push)168 1362 A
(NMI_VECTOR)420 1698 A
4950 V
(06360)210 648 A
(jmp)126 1362 A
(exception)378 1698 A
5040 V
(06361)210 648 A
5130 V
(06362)210 648 A
(_breakpoint_exception:)924 1026 A
5220 V
(06363)210 648 A
(push)168 1362 A
(BREAKPOINT_VECTOR)714 1698 A
5310 V
(06364)210 648 A
(jmp)126 1362 A
(exception)378 1698 A
5400 V
(06365)210 648 A
5490 V
(06366)210 648 A
(_overflow:)420 1026 A
5580 V
(06367)210 648 A
(push)168 1362 A
(OVERFLOW_VECTOR)630 1698 A
5670 V
(06368)210 648 A
(jmp)126 1362 A
(exception)378 1698 A
5760 V
(06369)210 648 A
5850 V
(06370)210 648 A
(_bounds_check:)588 1026 A
5940 V
(06371)210 648 A
(push)168 1362 A
(BOUNDS_VECTOR)546 1698 A
6030 V
(06372)210 648 A
(jmp)126 1362 A
(exception)378 1698 A
6120 V
(06373)210 648 A
6210 V
(06374)210 648 A
(_inval_opcode:)588 1026 A
8418 V
EP
%%Page: 75 75
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1970(File:)S
(src/kernel/mpx386.s)902 2203 A
12 B
4308(75)S
900 V
7 LST
(06375)210 648 A
(push)168 1362 A
(INVAL_OP_VECTOR)630 1698 A
990 V
(06376)210 648 A
(jmp)126 1362 A
(exception)378 1698 A
1080 V
(06377)210 648 A
1170 V
(06378)210 648 A
(_copr_not_available:)840 1026 A
1260 V
(06379)210 648 A
(push)168 1362 A
(COPROC_NOT_VECTOR)714 1698 A
1350 V
(06380)210 648 A
(jmp)126 1362 A
(exception)378 1698 A
1440 V
(06381)210 648 A
1530 V
(06382)210 648 A
(_double_fault:)588 1026 A
1620 V
(06383)210 648 A
(push)168 1362 A
(DOUBLE_FAULT_VECTOR)798 1698 A
1710 V
(06384)210 648 A
(jmp)126 1362 A
(errexception)504 1698 A
1800 V
(06385)210 648 A
1890 V
(06386)210 648 A
(_copr_seg_overrun:)756 1026 A
1980 V
(06387)210 648 A
(push)168 1362 A
(COPROC_SEG_VECTOR)714 1698 A
2070 V
(06388)210 648 A
(jmp)126 1362 A
(exception)378 1698 A
2160 V
(06389)210 648 A
2250 V
(06390)210 648 A
(_inval_tss:)462 1026 A
2340 V
(06391)210 648 A
(push)168 1362 A
(INVAL_TSS_VECTOR)672 1698 A
2430 V
(06392)210 648 A
(jmp)126 1362 A
(errexception)504 1698 A
2520 V
(06393)210 648 A
2610 V
(06394)210 648 A
(_segment_not_present:)882 1026 A
2700 V
(06395)210 648 A
(push)168 1362 A
(SEG_NOT_VECTOR)588 1698 A
2790 V
(06396)210 648 A
(jmp)126 1362 A
(errexception)504 1698 A
2880 V
(06397)210 648 A
2970 V
(06398)210 648 A
(_stack_exception:)714 1026 A
3060 V
(06399)210 648 A
(push)168 1362 A
(STACK_FAULT_VECTOR)756 1698 A
3150 V
(06400)210 648 A
(jmp)126 1362 A
(errexception)504 1698 A
3240 V
(06401)210 648 A
3330 V
(06402)210 648 A
(_general_protection:)840 1026 A
3420 V
(06403)210 648 A
(push)168 1362 A
(PROTECTION_VECTOR)714 1698 A
3510 V
(06404)210 648 A
(jmp)126 1362 A
(errexception)504 1698 A
3600 V
(06405)210 648 A
3690 V
(06406)210 648 A
(_page_fault:)504 1026 A
3780 V
(06407)210 648 A
(push)168 1362 A
(PAGE_FAULT_VECTOR)714 1698 A
3870 V
(06408)210 648 A
(jmp)126 1362 A
(errexception)504 1698 A
3960 V
(06409)210 648 A
4050 V
(06410)210 648 A
(_copr_error:)504 1026 A
4140 V
(06411)210 648 A
(push)168 1362 A
(COPROC_ERR_VECTOR)714 1698 A
4230 V
(06412)210 648 A
(jmp)126 1362 A
(exception)378 1698 A
4320 V
(06413)210 648 A
4410 V
(06414)210 648 A
(!*===========================================================================*)3276 1026 A
4500 V
(06415)210 648 A
1026(!*)S
(exception)378 2370 A
4260(*)S
4590 V
(06416)210 648 A
(!*===========================================================================*)3276 1026 A
4680 V
(06417)210 648 A
1026(!)S
(This)168 1110 A
1320(is)S
(called)252 1446 A
(for)126 1740 A
(all)126 1908 A
(exceptions)420 2076 A
(which)210 2538 A
2790(do)S
(not)126 2916 A
(push)168 3084 A
3294(an)S
(error)210 3420 A
(code.)210 3672 A
4770 V
(06418)210 648 A
4860 V
(06419)210 648 A
(.align)252 1362 A
1698(16)S
4950 V
(06420)210 648 A
(exception:)420 1026 A
5040 V
(06421)210 648 A
(sseg)168 1068 A
(mov)126 1362 A
(\(trap_errno\),)546 1698 A
2286(0)S
2706(!)S
(clear)210 2790 A
(trap_errno)420 3042 A
5130 V
(06422)210 648 A
(sseg)168 1068 A
(pop)126 1362 A
(\(ex_number\))462 1698 A
5220 V
(06423)210 648 A
(jmp)126 1362 A
(exception1)420 1698 A
5310 V
(06424)210 648 A
5400 V
(06425)210 648 A
(!*===========================================================================*)3276 1026 A
5490 V
(06426)210 648 A
1026(!*)S
(errexception)504 2370 A
4260(*)S
5580 V
(06427)210 648 A
(!*===========================================================================*)3276 1026 A
5670 V
(06428)210 648 A
1026(!)S
(This)168 1110 A
1320(is)S
(called)252 1446 A
(for)126 1740 A
(all)126 1908 A
(exceptions)420 2076 A
(which)210 2538 A
(push)168 2790 A
3000(an)S
(error)210 3126 A
(code.)210 3378 A
5760 V
(06429)210 648 A
5850 V
(06430)210 648 A
(.align)252 1362 A
1698(16)S
5940 V
(06431)210 648 A
(errexception:)546 1026 A
6030 V
(06432)210 648 A
(sseg)168 1068 A
(pop)126 1362 A
(\(ex_number\))462 1698 A
6120 V
(06433)210 648 A
(sseg)168 1068 A
(pop)126 1362 A
(\(trap_errno\))504 1698 A
6210 V
(06434)210 648 A
(exception1:)462 1026 A
2706(!)S
(Common)252 2790 A
(for)126 3084 A
(all)126 3252 A
(exceptions.)462 3420 A
8418 V
EP
%%Page: 76 76
BP
/slant 0 def
/height 0 def
630 V
12 B
648(76)S
11 R
1970(File:)S
(src/kernel/mpx386.s)902 2203 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(06435)210 648 A
(push)168 1362 A
(eax)126 1698 A
2706(!)S
(eax)126 2790 A
2958(is)S
(scratch)294 3084 A
(register)336 3420 A
990 V
(06436)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(0+4\(esp\))336 1908 A
2706(!)S
(old)126 2790 A
(eip)126 2958 A
1080 V
(06437)210 648 A
(sseg)168 1068 A
(mov)126 1362 A
(\(old_eip\),)420 1698 A
(eax)126 2160 A
1170 V
(06438)210 648 A
(movzx)210 1362 A
(eax,)168 1698 A
(4+4\(esp\))336 1908 A
2706(!)S
(old)126 2790 A
2958(cs)S
1260 V
(06439)210 648 A
(sseg)168 1068 A
(mov)126 1362 A
(\(old_cs\),)378 1698 A
(eax)126 2118 A
1350 V
(06440)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(8+4\(esp\))336 1908 A
2706(!)S
(old)126 2790 A
(eflags)252 2958 A
1440 V
(06441)210 648 A
(sseg)168 1068 A
(mov)126 1362 A
(\(old_eflags\),)546 1698 A
(eax)126 2286 A
1530 V
(06442)210 648 A
(pop)126 1362 A
(eax)126 1698 A
1620 V
(06443)210 648 A
(call)168 1362 A
(save)168 1698 A
1710 V
(06444)210 648 A
(push)168 1362 A
(\(old_eflags\))504 1698 A
1800 V
(06445)210 648 A
(push)168 1362 A
(\(old_cs\))336 1698 A
1890 V
(06446)210 648 A
(push)168 1362 A
(\(old_eip\))378 1698 A
1980 V
(06447)210 648 A
(push)168 1362 A
(\(trap_errno\))504 1698 A
2070 V
(06448)210 648 A
(push)168 1362 A
(\(ex_number\))462 1698 A
2160 V
(06449)210 648 A
(call)168 1362 A
(_exception)420 1698 A
2706(!)S
(\(ex_number,)462 2790 A
(trap_errno,)462 3294 A
(old_eip,)336 3798 A
2250 V
(06450)210 648 A
2706(!)S
(old_cs,)294 3042 A
(old_eflags\))462 3378 A
2340 V
(06451)210 648 A
(add)126 1362 A
(esp,)168 1698 A
(5*4)126 1908 A
2430 V
(06452)210 648 A
(cli)126 1362 A
2520 V
(06453)210 648 A
(ret)126 1362 A
2610 V
(06454)210 648 A
2700 V
(06455)210 648 A
(!*===========================================================================*)3276 1026 A
2790 V
(06456)210 648 A
1026(!*)S
(level0_call)462 2370 A
4260(*)S
2880 V
(06457)210 648 A
(!*===========================================================================*)3276 1026 A
2970 V
(06458)210 648 A
(_level0_call:)546 1026 A
3060 V
(06459)210 648 A
(call)168 1362 A
(save)168 1698 A
3150 V
(06460)210 648 A
(jmp)126 1362 A
(\(_level0_func\))588 1698 A
3240 V
(06461)210 648 A
3330 V
(06462)210 648 A
(!*===========================================================================*)3276 1026 A
3420 V
(06463)210 648 A
1026(!*)S
(idle_task)378 2370 A
4260(*)S
3510 V
(06464)210 648 A
(!*===========================================================================*)3276 1026 A
3600 V
(06465)210 648 A
(_idle_task:)462 1026 A
2370(!)S
(executed)336 2454 A
(when)168 2832 A
(there)210 3042 A
3294(is)S
3420(no)S
(work)168 3546 A
3690 V
(06466)210 648 A
(jmp)126 1362 A
(_idle_task)420 1698 A
2370(!)S
2454(a)S
("hlt")210 2538 A
(before)252 2790 A
(this)168 3084 A
(fails)210 3294 A
3546(in)S
(protected)378 3672 A
(mode)168 4092 A
3780 V
(06467)210 648 A
3870 V
(06468)210 648 A
(!*===========================================================================*)3276 1026 A
3960 V
(06469)210 648 A
1026(!*)S
(data)168 2370 A
4260(*)S
4050 V
(06470)210 648 A
(!*===========================================================================*)3276 1026 A
4140 V
(06471)210 648 A
1026(!)S
(These)210 1110 A
(declarations)504 1362 A
(assure)252 1908 A
(that)168 2202 A
(storage)294 2412 A
(will)168 2748 A
2958(be)S
(allocated)378 3084 A
3504(at)S
(the)126 3630 A
(very)168 3798 A
4230 V
(06472)210 648 A
1026(!)S
(beginning)378 1110 A
1530(of)S
(the)126 1656 A
(kernel)252 1824 A
(data)168 2118 A
(section,)336 2328 A
2706(so)S
(the)126 2832 A
(boot)168 3000 A
(monitor)294 3210 A
(can)126 3546 A
3714(be)S
(easily)252 3840 A
4320 V
(06473)210 648 A
1026(!)S
(told)168 1110 A
(how)126 1320 A
1488(to)S
(patch)210 1614 A
(these)210 1866 A
(locations.)420 2118 A
(Note)168 2580 A
(that)168 2790 A
(the)126 3000 A
(magic)210 3168 A
(number)252 3420 A
3714(is)S
(put)126 3840 A
4410 V
(06474)210 648 A
1026(!)S
(here)168 1110 A
1320(by)S
(the)126 1446 A
(compiler,)378 1614 A
(but)126 2034 A
(will)168 2202 A
2412(be)S
(read)168 2538 A
(by,)126 2748 A
(and)126 2916 A
(then)168 3084 A
(overwritten)462 3294 A
(by,)126 3798 A
4500 V
(06475)210 648 A
1026(!)S
(the)126 1110 A
(boot)168 1278 A
(monitor.)336 1488 A
(When)168 1866 A
(the)126 2076 A
(kernel)252 2244 A
(starts)252 2538 A
(the)126 2832 A
(sizes)210 3000 A
(array)210 3252 A
(will)168 3504 A
3714(be)S
4590 V
(06476)210 648 A
1026(!)S
(found)210 1110 A
(here,)210 1362 A
1614(as)S
1740(if)S
1866(it)S
(had)126 1992 A
(been)168 2160 A
(initialized)462 2370 A
2874(by)S
(the)126 3000 A
(compiler.)378 3168 A
4680 V
(06477)210 648 A
4770 V
(06478)210 648 A
(.sect)210 1026 A
(.rom)168 1278 A
1698(!)S
(Before)252 1782 A
(the)126 2076 A
(string)252 2244 A
(table)210 2538 A
(please)252 2790 A
4860 V
(06479)210 648 A
(_sizes:)294 1026 A
2370(!)S
(sizes)210 2454 A
2706(of)S
(kernel,)294 2832 A
(mm,)126 3168 A
3336(fs)S
(filled)252 3462 A
3756(in)S
3882(by)S
(boot)168 4008 A
4950 V
(06480)210 648 A
(.data2)252 1362 A
(0x526F)252 1698 A
2370(!)S
(this)168 2454 A
(must)168 2664 A
2874(be)S
(the)126 3000 A
(first)210 3168 A
(data)168 3420 A
(entry)210 3630 A
(\(magic)252 3882 A
4176(#\))S
5040 V
(06481)210 648 A
(.space)252 1362 A
(16*2*2-2)336 1698 A
2370(!)S
(monitor)294 2454 A
(uses)168 2790 A
(previous)336 3000 A
(word)168 3378 A
(and)126 3588 A
(this)168 3756 A
(space)210 3966 A
5130 V
(06482)210 648 A
2370(!)S
(extra)210 2454 A
(space)210 2706 A
(allows)252 2958 A
(for)126 3252 A
(additional)420 3420 A
(servers)294 3882 A
5220 V
(06483)210 648 A
(.sect)210 1026 A
(.bss)168 1278 A
5310 V
(06484)210 648 A
(k_stack:)336 1026 A
5400 V
(06485)210 648 A
(.space)252 1362 A
(K_STACK_BYTES)546 1698 A
2370(!)S
(kernel)252 2454 A
(stack)210 2748 A
5490 V
(06486)210 648 A
(k_stktop:)378 1026 A
2370(!)S
(top)126 2454 A
2622(of)S
(kernel)252 2748 A
(stack)210 3042 A
5580 V
(06487)210 648 A
(.comm)210 1362 A
(ex_number,)420 1698 A
2160(4)S
5670 V
(06488)210 648 A
(.comm)210 1362 A
(trap_errno,)462 1698 A
2202(4)S
5760 V
(06489)210 648 A
(.comm)210 1362 A
(old_eip,)336 1698 A
2076(4)S
5850 V
(06490)210 648 A
(.comm)210 1362 A
(old_cs,)294 1698 A
2034(4)S
5940 V
(06491)210 648 A
(.comm)210 1362 A
(old_eflags,)462 1698 A
2202(4)S
8418 V
EP
%%Page: 77 77
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2051(File:)S
2284(src/kernel/start.c)S
12 B
4308(77)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/kernel/start.c)756 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(06500)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
2118(C)S
(startup)294 2202 A
(code)168 2538 A
(for)126 2748 A
(Minix)210 2916 A
3168(on)S
(Intel)210 3294 A
(processors.)462 3546 A
1440 V
(06501)210 648 A
1068(*)S
1152(It)S
(cooperates)420 1278 A
(with)168 1740 A
(mpx.s)210 1950 A
2202(to)S
(set)126 2328 A
2496(up)S
2622(a)S
(good)168 2706 A
(environment)462 2916 A
(for)126 3420 A
(main\(\).)294 3588 A
1530 V
(06502)210 648 A
1068(*)S
1620 V
(06503)210 648 A
1068(*)S
(This)168 1152 A
(code)168 1362 A
(runs)168 1572 A
1782(in)S
(real)168 1908 A
(mode)168 2118 A
(for)126 2328 A
2496(a)S
2580(16)S
(bit)126 2706 A
(kernel)252 2874 A
(and)126 3168 A
(may)126 3336 A
(have)168 3504 A
3714(to)S
(switch)252 3840 A
1710 V
(06504)210 648 A
1068(*)S
1152(to)S
(protected)378 1278 A
(mode)168 1698 A
(for)126 1908 A
2076(a)S
(286.)168 2160 A
1800 V
(06505)210 648 A
1068(*)S
1890 V
(06506)210 648 A
1068(*)S
(For)126 1152 A
1320(a)S
1404(32)S
(bit)126 1530 A
(kernel)252 1698 A
(this)168 1992 A
(already)294 2202 A
(runs)168 2538 A
2748(in)S
(protected)378 2874 A
(mode,)210 3294 A
(but)126 3546 A
(the)126 3714 A
(selectors)378 3882 A
1980 V
(06507)210 648 A
1068(*)S
(are)126 1152 A
(still)210 1320 A
(those)210 1572 A
(given)210 1824 A
2076(by)S
(the)126 2202 A
(BIOS)168 2370 A
(with)168 2580 A
(interrupts)420 2790 A
(disabled,)378 3252 A
3672(so)S
(the)126 3798 A
2070 V
(06508)210 648 A
1068(*)S
(descriptors)462 1152 A
(need)168 1656 A
1866(to)S
1992(be)S
(reloaded)336 2118 A
(and)126 2496 A
(interrupt)378 2664 A
(descriptors)462 3084 A
(made.)210 3588 A
2160 V
(06509)210 648 A
1068(*/)S
2250 V
(06510)210 648 A
2340 V
(06511)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
2430 V
(06512)210 648 A
(#include)336 1026 A
(<stdlib.h>)420 1404 A
2520 V
(06513)210 648 A
(#include)336 1026 A
(<minix/boot.h>)588 1404 A
2610 V
(06514)210 648 A
(#include)336 1026 A
("protect.h")462 1404 A
2700 V
(06515)210 648 A
2790 V
(06516)210 648 A
(PRIVATE)294 1026 A
(char)168 1362 A
(k_environ[256];)630 1572 A
2370(/*)S
(environment)462 2496 A
(strings)294 3000 A
(passed)252 3336 A
3630(by)S
(loader)252 3756 A
4050(*/)S
2880 V
(06517)210 648 A
2970 V
(06518)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(k_atoi,)294 2034 A
(\(char)210 2370 A
(*s\))126 2622 A
2790(\);)S
3060 V
(06519)210 648 A
3150 V
(06520)210 648 A
3240 V
(06521)210 648 A
(/*==========================================================================*)3234 1026 A
3330 V
(06522)210 648 A
1068(*)S
(cstart)252 2370 A
4218(*)S
3420 V
(06523)210 648 A
(*==========================================================================*/)3234 1068 A
3510 V
(06524)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(cstart\(cs,)420 1530 A
(ds,)126 1992 A
(mcs,)168 2160 A
(mds,)168 2370 A
(parmoff,)336 2580 A
(parmsize\))378 2958 A
3600 V
(06525)210 648 A
(U16_t)210 1026 A
(cs,)126 1278 A
(ds;)126 1446 A
2370(/*)S
(Kernel)252 2496 A
(code)168 2790 A
(and)126 3000 A
(data)168 3168 A
(segment)294 3378 A
3714(*/)S
3690 V
(06526)210 648 A
(U16_t)210 1026 A
(mcs,)168 1278 A
(mds;)168 1488 A
2370(/*)S
(Monitor)294 2496 A
(code)168 2832 A
(and)126 3042 A
(data)168 3210 A
(segment)294 3420 A
3756(*/)S
3780 V
(06527)210 648 A
(U16_t)210 1026 A
(parmoff,)336 1278 A
(parmsize;)378 1656 A
2370(/*)S
(boot)168 2496 A
(parameters)420 2706 A
(offset)252 3168 A
(and)126 3462 A
(length)252 3630 A
3924(*/)S
3870 V
(06528)210 648 A
1026({)S
3960 V
(06529)210 648 A
1026(/*)S
(Perform)294 1152 A
(system)252 1488 A
(initializations)630 1782 A
(prior)210 2454 A
2706(to)S
(calling)294 2832 A
(main\(\).)294 3168 A
3504(*/)S
4050 V
(06530)210 648 A
4140 V
(06531)210 648 A
(register)336 1110 A
(char)168 1488 A
(*envp;)252 1698 A
4230 V
(06532)210 648 A
(phys_bytes)420 1110 A
(mcode_base,)462 1572 A
(mdata_base;)462 2076 A
4320 V
(06533)210 648 A
(unsigned)336 1110 A
(mon_start;)420 1488 A
4410 V
(06534)210 648 A
4500 V
(06535)210 648 A
1110(/*)S
(Record)252 1236 A
(where)210 1530 A
(the)126 1782 A
(kernel)252 1950 A
(and)126 2244 A
(the)126 2412 A
(monitor)294 2580 A
(are.)168 2916 A
3126(*/)S
4590 V
(06536)210 648 A
(code_base)378 1110 A
1530(=)S
(seg2phys\(cs\);)546 1614 A
4680 V
(06537)210 648 A
(data_base)378 1110 A
1530(=)S
(seg2phys\(ds\);)546 1614 A
4770 V
(06538)210 648 A
(mcode_base)420 1110 A
1572(=)S
(seg2phys\(mcs\);)588 1656 A
4860 V
(06539)210 648 A
(mdata_base)420 1110 A
1572(=)S
(seg2phys\(mds\);)588 1656 A
4950 V
(06540)210 648 A
5040 V
(06541)210 648 A
1110(/*)S
(Initialize)420 1236 A
(protected)378 1698 A
(mode)168 2118 A
(descriptors.)504 2328 A
2874(*/)S
5130 V
(06542)210 648 A
(prot_init\(\);)504 1110 A
5220 V
(06543)210 648 A
5310 V
(06544)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(boot)168 1614 A
(parameters)420 1824 A
2286(to)S
(kernel)252 2412 A
(memory.)294 2706 A
3042(*/)S
5400 V
(06545)210 648 A
1110(if)S
(\(parmsize)378 1236 A
1656(>)S
(sizeof)252 1740 A
(k_environ)378 2034 A
2454(-)S
2538(2\))S
(parmsize)336 2664 A
3042(=)S
(sizeof)252 3126 A
(k_environ)378 3420 A
3840(-)S
3924(2;)S
5490 V
(06546)210 648 A
(phys_copy\(mdata_base)840 1110 A
1992(+)S
(parmoff,)336 2076 A
(vir2phys\(k_environ\),)840 2454 A
(\(phys_bytes\))504 3336 A
(parmsize\);)420 3882 A
5580 V
(06547)210 648 A
5670 V
(06548)210 648 A
1110(/*)S
(Convert)294 1236 A
(important)378 1572 A
(boot)168 1992 A
(environment)462 2202 A
(variables.)420 2706 A
3168(*/)S
5760 V
(06549)210 648 A
(boot_parameters.bp_rootdev)1092 1110 A
2244(=)S
(k_atoi\(k_getenv\("rootdev"\)\);)1176 2328 A
5850 V
(06550)210 648 A
(boot_parameters.bp_ramimagedev)1260 1110 A
2412(=)S
(k_atoi\(k_getenv\("ramimagedev"\)\);)1344 2496 A
5940 V
(06551)210 648 A
(boot_parameters.bp_ramsize)1092 1110 A
2244(=)S
(k_atoi\(k_getenv\("ramsize"\)\);)1176 2328 A
6030 V
(06552)210 648 A
(boot_parameters.bp_processor)1176 1110 A
2328(=)S
(k_atoi\(k_getenv\("processor"\)\);)1260 2412 A
6120 V
(06553)210 648 A
6210 V
(06554)210 648 A
1110(/*)S
(Type)168 1236 A
1446(of)S
(VDU:)168 1572 A
1782(*/)S
8418 V
EP
%%Page: 78 78
BP
/slant 0 def
/height 0 def
630 V
12 B
648(78)S
11 R
2051(File:)S
2284(src/kernel/start.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(06555)210 648 A
(envp)168 1110 A
1320(=)S
(k_getenv\("video"\);)756 1404 A
990 V
(06556)210 648 A
1110(if)S
(\(strcmp\(envp,)546 1236 A
("ega"\))252 1824 A
2118(==)S
2244(0\))S
(ega)126 2370 A
2538(=)S
(TRUE;)210 2622 A
1080 V
(06557)210 648 A
1110(if)S
(\(strcmp\(envp,)546 1236 A
("vga"\))252 1824 A
2118(==)S
2244(0\))S
(vga)126 2370 A
2538(=)S
(ega)126 2622 A
2790(=)S
(TRUE;)210 2874 A
1170 V
(06558)210 648 A
1260 V
(06559)210 648 A
1110(/*)S
(Memory)252 1236 A
(sizes:)252 1530 A
1824(*/)S
1350 V
(06560)210 648 A
(low_memsize)462 1110 A
1614(=)S
(k_atoi\(k_getenv\("memsize"\)\);)1176 1698 A
1440 V
(06561)210 648 A
(ext_memsize)462 1110 A
1614(=)S
(k_atoi\(k_getenv\("emssize"\)\);)1176 1698 A
1530 V
(06562)210 648 A
1620 V
(06563)210 648 A
1110(/*)S
(Processor?)420 1236 A
1698(*/)S
1710 V
(06564)210 648 A
(processor)378 1110 A
1530(=)S
(boot_parameters.bp_processor;)1218 1614 A
3042(/*)S
(86,)126 3168 A
(186,)168 3336 A
(286,)168 3546 A
(386,)168 3756 A
(...)126 3966 A
4134(*/)S
1800 V
(06565)210 648 A
1890 V
(06566)210 648 A
1110(/*)S
(XT,)126 1236 A
1404(AT)S
1530(or)S
(MCA)126 1656 A
(bus?)168 1824 A
2034(*/)S
1980 V
(06567)210 648 A
(envp)168 1110 A
1320(=)S
(k_getenv\("bus"\);)672 1404 A
2070 V
(06568)210 648 A
1110(if)S
(\(envp)210 1236 A
1488(==)S
(NIL_PTR)294 1614 A
1950(||)S
(strcmp\(envp,)504 2076 A
("at"\))210 2622 A
2874(==)S
3000(0\))S
3126({)S
2160 V
(06569)210 648 A
(pc_at)210 1362 A
1614(=)S
(TRUE;)210 1698 A
2250 V
(06570)210 648 A
1110(})S
(else)168 1194 A
2340 V
(06571)210 648 A
1110(if)S
(\(strcmp\(envp,)546 1236 A
("mca"\))252 1824 A
2118(==)S
2244(0\))S
2370({)S
2430 V
(06572)210 648 A
(pc_at)210 1362 A
1614(=)S
(ps_mca)252 1698 A
1992(=)S
(TRUE;)210 2076 A
2520 V
(06573)210 648 A
1110(})S
2610 V
(06574)210 648 A
2700 V
(06575)210 648 A
1110(/*)S
(Decide)252 1236 A
1530(if)S
(mode)168 1656 A
1866(is)S
(protected.)420 1992 A
2454(*/)S
2790 V
(06576)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(2)S
2880 V
(06577)210 648 A
(protected_mode)588 1110 A
1740(=)S
(processor)378 1824 A
2244(>=)S
(286;)168 2370 A
2970 V
(06578)210 648 A
(#endif)252 1026 A
3060 V
(06579)210 648 A
3150 V
(06580)210 648 A
1110(/*)S
1236(Is)S
(there)210 1362 A
1614(a)S
(monitor)294 1698 A
2034(to)S
(return)252 2160 A
(to?)126 2454 A
2664(If)S
2790(so)S
(then)168 2916 A
(keep)168 3126 A
3336(it)S
(safe.)210 3462 A
3714(*/)S
3240 V
(06581)210 648 A
1110(if)S
(\(!protected_mode\))714 1236 A
(mon_return)420 1992 A
2454(=)S
2538(0;)S
3330 V
(06582)210 648 A
(mon_start)378 1110 A
1530(=)S
(mcode_base)420 1614 A
2076(/)S
(1024;)210 2160 A
3420 V
(06583)210 648 A
1110(if)S
(\(mon_return)462 1236 A
1740(&&)S
(low_memsize)462 1866 A
2370(>)S
(mon_start\))420 2454 A
(low_memsize)462 2916 A
3420(=)S
(mon_start;)420 3504 A
3510 V
(06584)210 648 A
3600 V
(06585)210 648 A
1110(/*)S
(Return)252 1236 A
1530(to)S
(assembler)378 1656 A
(code)168 2076 A
2286(to)S
(switch)252 2412 A
2706(to)S
(protected)378 2832 A
(mode)168 3252 A
(\(if)126 3462 A
(286\),)210 3630 A
(reload)252 3882 A
3690 V
(06586)210 648 A
1152(*)S
(selectors)378 1236 A
(and)126 1656 A
(call)168 1824 A
(main\(\).)294 2034 A
3780 V
(06587)210 648 A
1152(*/)S
3870 V
(06588)210 648 A
1026(})S
4140 V
(06591)210 648 A
(/*==========================================================================*)3234 1026 A
4230 V
(06592)210 648 A
1068(*)S
(k_atoi)252 2370 A
4218(*)S
4320 V
(06593)210 648 A
(*==========================================================================*/)3234 1068 A
4410 V
(06594)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(k_atoi\(s\))378 1530 A
4500 V
(06595)210 648 A
(register)336 1026 A
(char)168 1404 A
(*s;)126 1614 A
4590 V
(06596)210 648 A
1026({)S
4680 V
(06597)210 648 A
1026(/*)S
(Convert)294 1152 A
(string)252 1488 A
1782(to)S
(integer.)336 1908 A
2286(*/)S
4770 V
(06598)210 648 A
4860 V
(06599)210 648 A
(return)252 1110 A
(strtol\(s,)378 1404 A
(\(char)210 1824 A
(**\))126 2076 A
(NULL,)210 2244 A
(10\);)168 2496 A
4950 V
(06600)210 648 A
1026(})S
5220 V
(06603)210 648 A
(/*==========================================================================*)3234 1026 A
5310 V
(06604)210 648 A
1068(*)S
(k_getenv)336 2370 A
4218(*)S
5400 V
(06605)210 648 A
(*==========================================================================*/)3234 1068 A
5490 V
(06606)210 648 A
(PUBLIC)252 1026 A
(char)168 1320 A
(*k_getenv\(name\))630 1530 A
5580 V
(06607)210 648 A
(char)168 1026 A
(*name;)252 1236 A
5670 V
(06608)210 648 A
1026({)S
5760 V
(06609)210 648 A
1026(/*)S
(Get)126 1152 A
(environment)462 1320 A
(value)210 1824 A
2076(-)S
(kernel)252 2160 A
(version)294 2454 A
2790(of)S
(getenv)252 2916 A
3210(to)S
(avoid)210 3336 A
(setting)294 3588 A
3924(up)S
(the)126 4050 A
5850 V
(06610)210 648 A
1068(*)S
(usual)210 1152 A
(environment)462 1404 A
(array.)252 1908 A
5940 V
(06611)210 648 A
1068(*/)S
6030 V
(06612)210 648 A
6120 V
(06613)210 648 A
(register)336 1110 A
(char)168 1488 A
(*namep;)294 1698 A
6210 V
(06614)210 648 A
(register)336 1110 A
(char)168 1488 A
(*envp;)252 1698 A
8418 V
EP
%%Page: 79 79
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2051(File:)S
2284(src/kernel/start.c)S
12 B
4308(79)S
900 V
7 LST
(06615)210 648 A
990 V
(06616)210 648 A
(for)126 1110 A
(\(envp)210 1278 A
1530(=)S
(k_environ;)420 1614 A
(*envp)210 2076 A
2328(!=)S
(0;\))126 2454 A
2622({)S
1080 V
(06617)210 648 A
(for)126 1362 A
(\(namep)252 1530 A
1824(=)S
(name;)210 1908 A
(*namep)252 2160 A
2454(!=)S
2580(0)S
2664(&&)S
(*namep)252 2790 A
3084(==)S
(*envp;)252 3210 A
(namep++,)336 3504 A
(envp++\))294 3882 A
1170 V
(06618)210 648 A
1698(;)S
1260 V
(06619)210 648 A
1362(if)S
(\(*namep)294 1488 A
1824(==)S
('\\0')168 1950 A
2160(&&)S
(*envp)210 2286 A
2538(==)S
('='\))168 2664 A
(return\(envp)462 2874 A
3378(+)S
(1\);)126 3462 A
1350 V
(06620)210 648 A
(while)210 1362 A
(\(*envp++)336 1614 A
1992(!=)S
2118(0\))S
1440 V
(06621)210 648 A
1698(;)S
1530 V
(06622)210 648 A
1110(})S
1620 V
(06623)210 648 A
(return\(NIL_PTR\);)672 1110 A
1710 V
(06624)210 648 A
1026(})S
2340 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2430 V
(src/kernel/main.c)714 2034 A
2520 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2700 V
(06700)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(main)168 2118 A
(program)294 2328 A
2664(of)S
(MINIX.)252 2790 A
(The)126 3126 A
(routine)294 3294 A
(main\(\))252 3630 A
2790 V
(06701)210 648 A
1068(*)S
(initializes)462 1152 A
(the)126 1656 A
(system)252 1824 A
(and)126 2118 A
(starts)252 2286 A
(the)126 2580 A
(ball)168 2748 A
(rolling)294 2958 A
3294(by)S
(setting)294 3420 A
3756(up)S
(the)126 3882 A
(proc)168 4050 A
2880 V
(06702)210 648 A
1068(*)S
(table,)252 1152 A
(interrupt)378 1446 A
(vectors,)336 1866 A
(and)126 2244 A
(scheduling)420 2412 A
(each)168 2874 A
(task)168 3084 A
3294(to)S
(run)126 3420 A
3588(to)S
(initialize)420 3714 A
2970 V
(06703)210 648 A
1068(*)S
(itself.)294 1152 A
3060 V
(06704)210 648 A
1068(*)S
3150 V
(06705)210 648 A
1068(*)S
(The)126 1152 A
(entries)294 1320 A
(into)168 1656 A
(this)168 1866 A
(file)168 2076 A
(are:)168 2286 A
3240 V
(06706)210 648 A
1068(*)S
(main:)210 1236 A
(MINIX)210 2034 A
(main)168 2286 A
(program)294 2496 A
3330 V
(06707)210 648 A
1068(*)S
(panic:)252 1236 A
(abort)210 2034 A
(MINIX)210 2286 A
(due)126 2538 A
2706(to)S
2832(a)S
(fatal)210 2916 A
(error)210 3168 A
3420 V
(06708)210 648 A
1068(*/)S
3510 V
(06709)210 648 A
3600 V
(06710)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
3690 V
(06711)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
3780 V
(06712)210 648 A
(#include)336 1026 A
(<unistd.h>)420 1404 A
3870 V
(06713)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
3960 V
(06714)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
4050 V
(06715)210 648 A
(#include)336 1026 A
("proc.h")336 1404 A
4140 V
(06716)210 648 A
4230 V
(06717)210 648 A
4320 V
(06718)210 648 A
(/*===========================================================================*)3276 1026 A
4410 V
(06719)210 648 A
1068(*)S
(main)168 2580 A
4260(*)S
4500 V
(06720)210 648 A
(*===========================================================================*/)3276 1068 A
4590 V
(06721)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(main\(\))252 1530 A
4680 V
(06722)210 648 A
1026({)S
4770 V
(06723)210 648 A
1026(/*)S
(Start)210 1152 A
(the)126 1404 A
(ball)168 1572 A
(rolling.)336 1782 A
2160(*/)S
4860 V
(06724)210 648 A
4950 V
(06725)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
5040 V
(06726)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(t;)S
5130 V
(06727)210 648 A
(int)126 1110 A
(sizeindex;)420 1278 A
5220 V
(06728)210 648 A
(phys_clicks)462 1110 A
(text_base;)420 1614 A
5310 V
(06729)210 648 A
(vir_clicks)420 1110 A
(text_clicks;)504 1572 A
5400 V
(06730)210 648 A
(vir_clicks)420 1110 A
(data_clicks;)504 1572 A
5490 V
(06731)210 648 A
(phys_bytes)420 1110 A
(phys_b;)294 1572 A
5580 V
(06732)210 648 A
(reg_t)210 1110 A
(ktsb;)210 1362 A
2370(/*)S
(kernel)252 2496 A
(task)168 2790 A
(stack)210 3000 A
(base)168 3252 A
3462(*/)S
5670 V
(06733)210 648 A
(struct)252 1110 A
(memory)252 1404 A
(*memp;)252 1698 A
5760 V
(06734)210 648 A
(struct)252 1110 A
(tasktab)294 1404 A
(*ttp;)210 1740 A
5850 V
(06735)210 648 A
5940 V
(06736)210 648 A
1110(/*)S
(Initialize)420 1236 A
(the)126 1698 A
(interrupt)378 1866 A
(controller.)462 2286 A
2790(*/)S
6030 V
(06737)210 648 A
(intr_init\(1\);)546 1110 A
6120 V
(06738)210 648 A
6210 V
(06739)210 648 A
1110(/*)S
(Interpret)378 1236 A
(memory)252 1656 A
(sizes.)252 1950 A
2244(*/)S
8418 V
EP
%%Page: 80 80
BP
/slant 0 def
/height 0 def
630 V
12 B
648(80)S
11 R
2036(File:)S
2269(src/kernel/main.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(06740)210 648 A
(mem_init\(\);)462 1110 A
990 V
(06741)210 648 A
1080 V
(06742)210 648 A
1110(/*)S
(Clear)210 1236 A
(the)126 1488 A
(process)294 1656 A
(table.)252 1992 A
1170 V
(06743)210 648 A
1152(*)S
(Set)126 1236 A
1404(up)S
(mappings)336 1530 A
(for)126 1908 A
(proc_addr\(\))462 2076 A
(and)126 2580 A
(proc_number\(\))546 2748 A
(macros.)294 3336 A
1260 V
(06744)210 648 A
1152(*/)S
1350 V
(06745)210 648 A
(for)126 1110 A
(\(rp)126 1278 A
1446(=)S
(BEG_PROC_ADDR,)588 1530 A
2160(t)S
2244(=)S
(-NR_TASKS;)420 2328 A
2790(rp)S
2916(<)S
(END_PROC_ADDR;)588 3000 A
(++rp,)210 3630 A
(++t\))168 3882 A
4092({)S
1440 V
(06746)210 648 A
(rp->p_flags)462 1362 A
1866(=)S
(P_SLOT_FREE;)504 1950 A
1530 V
(06747)210 648 A
(rp->p_nr)336 1362 A
1740(=)S
1824(t;)S
2370(/*)S
(proc)168 2496 A
(number)252 2706 A
(from)168 3000 A
(ptr)126 3210 A
3378(*/)S
1620 V
(06748)210 648 A
(\(pproc_addr)462 1362 A
1866(+)S
(NR_TASKS\)[t])504 1950 A
2496(=)S
(rp;)126 2580 A
3042(/*)S
(proc)168 3168 A
(ptr)126 3378 A
(from)168 3546 A
(number)252 3756 A
4050(*/)S
1710 V
(06749)210 648 A
1110(})S
1800 V
(06750)210 648 A
1890 V
(06751)210 648 A
1110(/*)S
(Set)126 1236 A
1404(up)S
(proc)168 1530 A
(table)210 1740 A
(entries)294 1992 A
(for)126 2328 A
(tasks)210 2496 A
(and)126 2748 A
(servers.)336 2916 A
(The)126 3336 A
(stacks)252 3504 A
3798(of)S
(the)126 3924 A
1980 V
(06752)210 648 A
1152(*)S
(kernel)252 1236 A
(tasks)210 1530 A
(are)126 1782 A
(initialized)462 1950 A
2454(to)S
2580(an)S
(array)210 2706 A
2958(in)S
(data)168 3084 A
(space.)252 3294 A
(The)126 3630 A
(stacks)252 3798 A
2070 V
(06753)210 648 A
1152(*)S
1236(of)S
(the)126 1362 A
(servers)294 1530 A
(have)168 1866 A
(been)168 2076 A
(added)210 2286 A
2538(to)S
(the)126 2664 A
(data)168 2832 A
(segment)294 3042 A
3378(by)S
(the)126 3504 A
(monitor,)336 3672 A
4050(so)S
2160 V
(06754)210 648 A
1152(*)S
(the)126 1236 A
(stack)210 1404 A
(pointer)294 1656 A
1992(is)S
(set)126 2118 A
2286(to)S
(the)126 2412 A
(end)126 2580 A
2748(of)S
(the)126 2874 A
(data)168 3042 A
(segment.)336 3252 A
(All)126 3672 A
(the)126 3840 A
2250 V
(06755)210 648 A
1152(*)S
(processes)378 1236 A
(are)126 1656 A
1824(in)S
(low)126 1950 A
(memory)252 2118 A
2412(on)S
(the)126 2538 A
(8086.)210 2706 A
3000(On)S
(the)126 3126 A
(386)126 3294 A
(only)168 3462 A
(the)126 3672 A
(kernel)252 3840 A
2340 V
(06756)210 648 A
1152(*)S
1236(is)S
1362(in)S
(low)126 1488 A
(memory,)294 1656 A
(the)126 1992 A
(rest)168 2160 A
2370(if)S
(loaded)252 2496 A
2790(in)S
(extended)336 2916 A
(memory.)294 3294 A
2430 V
(06757)210 648 A
1152(*/)S
2520 V
(06758)210 648 A
2610 V
(06759)210 648 A
1110(/*)S
(Task)168 1236 A
(stacks.)294 1446 A
1782(*/)S
2700 V
(06760)210 648 A
(ktsb)168 1110 A
1320(=)S
(\(reg_t\))294 1404 A
(t_stack;)336 1740 A
2790 V
(06761)210 648 A
2880 V
(06762)210 648 A
(for)126 1110 A
1278(\(t)S
1404(=)S
(-NR_TASKS;)420 1488 A
1950(t)S
2034(<=)S
(LOW_USER;)378 2160 A
(++t\))168 2580 A
2790({)S
2970 V
(06763)210 648 A
1362(rp)S
1488(=)S
(proc_addr\(t\);)546 1572 A
3042(/*)S
(t's)126 3168 A
(process)294 3336 A
(slot)168 3672 A
3882(*/)S
3060 V
(06764)210 648 A
(ttp)126 1362 A
1530(=)S
(&tasktab[t)420 1614 A
2076(+)S
(NR_TASKS];)420 2160 A
3042(/*)S
(t's)126 3168 A
(task)168 3336 A
(attributes)420 3546 A
4008(*/)S
3150 V
(06765)210 648 A
(strcpy\(rp->p_name,)756 1362 A
(ttp->name\);)462 2160 A
3240 V
(06766)210 648 A
1362(if)S
1488(\(t)S
1614(<)S
1698(0\))S
1824({)S
3330 V
(06767)210 648 A
1698(if)S
(\(ttp->stksize)546 1824 A
2412(>)S
2496(0\))S
2622({)S
3420 V
(06768)210 648 A
(rp->p_stguard)546 2034 A
2622(=)S
(\(reg_t)252 2706 A
3000(*\))S
(ktsb;)210 3126 A
3510 V
(06769)210 648 A
(*rp->p_stguard)588 2034 A
2664(=)S
(STACK_GUARD;)504 2748 A
3600 V
(06770)210 648 A
1698(})S
3690 V
(06771)210 648 A
(ktsb)168 1698 A
1908(+=)S
(ttp->stksize;)546 2034 A
3780 V
(06772)210 648 A
(rp->p_reg.sp)504 1698 A
2244(=)S
(ktsb;)210 2328 A
3870 V
(06773)210 648 A
(text_base)378 1698 A
2118(=)S
(code_base)378 2202 A
2622(>>)S
(CLICK_SHIFT;)504 2748 A
3960 V
(06774)210 648 A
2706(/*)S
(tasks)210 2832 A
(are)126 3084 A
(all)126 3252 A
3420(in)S
(the)126 3546 A
(kernel)252 3714 A
4008(*/)S
4050 V
(06775)210 648 A
(sizeindex)378 1698 A
2118(=)S
2202(0;)S
2706(/*)S
(and)126 2832 A
(use)126 3000 A
(the)126 3168 A
(full)168 3336 A
(kernel)252 3546 A
(sizes)210 3840 A
4092(*/)S
4140 V
(06776)210 648 A
(memp)168 1698 A
1908(=)S
(&mem[0];)336 1992 A
2706(/*)S
(remove)252 2832 A
(from)168 3126 A
(this)168 3336 A
(memory)252 3546 A
(chunk)210 3840 A
4092(*/)S
4230 V
(06777)210 648 A
1362(})S
(else)168 1446 A
1656({)S
4320 V
(06778)210 648 A
(sizeindex)378 1698 A
2118(=)S
2202(2)S
2286(*)S
2370(t)S
2454(+)S
2538(2;)S
2706(/*)S
(MM,)126 2832 A
(FS,)126 3000 A
(INIT)168 3168 A
(have)168 3378 A
(their)210 3588 A
(own)126 3840 A
(sizes)210 4008 A
4260(*/)S
4410 V
(06779)210 648 A
1362(})S
4500 V
(06780)210 648 A
(rp->p_reg.pc)504 1362 A
1908(=)S
(\(reg_t\))294 1992 A
(ttp->initial_pc;)672 2328 A
4590 V
(06781)210 648 A
(rp->p_reg.psw)546 1362 A
1950(=)S
(istaskp\(rp\))462 2034 A
2538(?)S
(INIT_TASK_PSW)546 2622 A
3210(:)S
(INIT_PSW;)378 3294 A
4680 V
(06782)210 648 A
4770 V
(06783)210 648 A
(text_clicks)462 1362 A
1866(=)S
(sizes[sizeindex];)714 1950 A
4860 V
(06784)210 648 A
(data_clicks)462 1362 A
1866(=)S
(sizes[sizeindex)630 1950 A
2622(+)S
(1];)126 2706 A
4950 V
(06785)210 648 A
(rp->p_map[T].mem_phys)882 1362 A
2286(=)S
(text_base;)420 2370 A
5040 V
(06786)210 648 A
(rp->p_map[T].mem_len)840 1362 A
2286(=)S
(text_clicks;)504 2370 A
5130 V
(06787)210 648 A
(rp->p_map[D].mem_phys)882 1362 A
2286(=)S
(text_base)378 2370 A
2790(+)S
(text_clicks;)504 2874 A
5220 V
(06788)210 648 A
(rp->p_map[D].mem_len)840 1362 A
2286(=)S
(data_clicks;)504 2370 A
5310 V
(06789)210 648 A
(rp->p_map[S].mem_phys)882 1362 A
2286(=)S
(text_base)378 2370 A
2790(+)S
(text_clicks)462 2874 A
3378(+)S
(data_clicks;)504 3462 A
5400 V
(06790)210 648 A
(rp->p_map[S].mem_vir)840 1362 A
2286(=)S
(data_clicks;)504 2370 A
3042(/*)S
(empty)210 3168 A
3420(-)S
(stack)210 3504 A
3756(is)S
3882(in)S
(data)168 4008 A
4218(*/)S
5490 V
(06791)210 648 A
(text_base)378 1362 A
1782(+=)S
(text_clicks)462 1908 A
2412(+)S
(data_clicks;)504 2496 A
3042(/*)S
(ready)210 3168 A
(for)126 3420 A
(next,)210 3588 A
3840(if)S
(server)252 3966 A
4260(*/)S
5580 V
(06792)210 648 A
(memp->size)420 1362 A
1824(-=)S
(\(text_base)420 1950 A
2412(-)S
(memp->base\);)504 2496 A
5670 V
(06793)210 648 A
(memp->base)420 1362 A
1824(=)S
(text_base;)420 1908 A
3042(/*)S
(memory)252 3168 A
3462(no)S
(longer)252 3588 A
(free)168 3882 A
4092(*/)S
5760 V
(06794)210 648 A
5850 V
(06795)210 648 A
1362(if)S
1488(\(t)S
1614(>=)S
1740(0\))S
1866({)S
5940 V
(06796)210 648 A
1698(/*)S
(Initialize)420 1824 A
(the)126 2286 A
(server)252 2454 A
(stack)210 2748 A
(pointer.)336 3000 A
(Take)168 3420 A
3630(it)S
(down)168 3756 A
(one)126 3966 A
(word)168 4134 A
6030 V
(06797)210 648 A
1740(*)S
1824(to)S
(give)168 1950 A
(crtso.s)294 2160 A
(something)378 2496 A
2916(to)S
(use)126 3042 A
3210(as)S
("argc".)294 3336 A
6120 V
(06798)210 648 A
1740(*/)S
6210 V
(06799)210 648 A
(rp->p_reg.sp)504 1698 A
2244(=)S
(\(rp->p_map[S].mem_vir)882 2328 A
3252(+)S
8418 V
EP
%%Page: 81 81
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2036(File:)S
2269(src/kernel/main.c)S
12 B
4308(81)S
900 V
7 LST
(06800)210 648 A
(rp->p_map[S].mem_len\))882 2370 A
3294(<<)S
(CLICK_SHIFT;)504 3420 A
990 V
(06801)210 648 A
(rp->p_reg.sp)504 1698 A
2244(-=)S
(sizeof\(reg_t\);)588 2370 A
1080 V
(06802)210 648 A
1362(})S
1170 V
(06803)210 648 A
1260 V
(06804)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(4)S
1350 V
(06805)210 648 A
1362(/*)S
(Servers)294 1488 A
(are)126 1824 A
(loaded)252 1992 A
2286(in)S
(extended)336 2412 A
(memory)252 2790 A
3084(if)S
3210(in)S
(386)126 3336 A
(mode.)210 3504 A
3756(*/)S
1440 V
(06806)210 648 A
1362(if)S
1488(\(t)S
1614(<)S
1698(0\))S
1824({)S
1530 V
(06807)210 648 A
(memp)168 1698 A
1908(=)S
(&mem[1];)336 1992 A
1620 V
(06808)210 648 A
(text_base)378 1698 A
2118(=)S
(0x100000)336 2202 A
2580(>>)S
(CLICK_SHIFT;)504 2706 A
1710 V
(06809)210 648 A
1362(})S
1800 V
(06810)210 648 A
(#endif)252 1026 A
1890 V
(06811)210 648 A
1362(if)S
(\(!isidlehardware\(t\)\))840 1488 A
(lock_ready\(rp\);)630 2370 A
3042(/*)S
(IDLE,)210 3168 A
(HARDWARE)336 3420 A
(neveready)378 3798 A
4218(*/)S
1980 V
(06812)210 648 A
(rp->p_flags)462 1362 A
1866(=)S
1950(0;)S
2070 V
(06813)210 648 A
2160 V
(06814)210 648 A
(alloc_segments\(rp\);)798 1362 A
2250 V
(06815)210 648 A
1110(})S
2340 V
(06816)210 648 A
2430 V
(06817)210 648 A
(proc[NR_TASKS+INIT_PROC_NR].p_pid)1386 1110 A
2538(=)S
(1;/*)168 2622 A
(INIT)168 2832 A
3042(of)S
(course)252 3168 A
(has)126 3462 A
(pid)126 3630 A
3798(1)S
3882(*/)S
2520 V
(06818)210 648 A
(bill_ptr)336 1110 A
1488(=)S
(proc_addr\(IDLE\);)672 1572 A
2706(/*)S
2832(it)S
(has)126 2958 A
3126(to)S
(point)210 3252 A
(somewhere)378 3504 A
3924(*/)S
2610 V
(06819)210 648 A
(lock_pick_proc\(\);)714 1110 A
2700 V
(06820)210 648 A
2790 V
(06821)210 648 A
1110(/*)S
(Now)126 1236 A
1404(go)S
1530(to)S
(the)126 1656 A
(assembly)336 1824 A
(code)168 2202 A
2412(to)S
(start)210 2538 A
(running)294 2790 A
(the)126 3126 A
(current)294 3294 A
(process.)336 3630 A
4008(*/)S
2880 V
(06822)210 648 A
(restart\(\);)420 1110 A
2970 V
(06823)210 648 A
1026(})S
3240 V
(06826)210 648 A
(/*===========================================================================*)3276 1026 A
3330 V
(06827)210 648 A
1068(*)S
(panic)210 2580 A
4260(*)S
3420 V
(06828)210 648 A
(*===========================================================================*/)3276 1068 A
3510 V
(06829)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(panic\(s,n\))420 1530 A
3600 V
(06830)210 648 A
(_CONST)252 1026 A
(char)168 1320 A
(*s;)126 1530 A
3690 V
(06831)210 648 A
(int)126 1026 A
1194(n;)S
3780 V
(06832)210 648 A
1026({)S
3870 V
(06833)210 648 A
1026(/*)S
(The)126 1152 A
(system)252 1320 A
(has)126 1614 A
(run)126 1782 A
(aground)294 1950 A
2286(of)S
2412(a)S
(fatal)210 2496 A
(error.)252 2748 A
(Terminate)378 3084 A
(execution.)420 3504 A
3960 V
(06834)210 648 A
1068(*)S
1152(If)S
(the)126 1278 A
(panic)210 1446 A
(originated)420 1698 A
2160(in)S
2286(MM)S
2412(or)S
(FS,)126 2538 A
(the)126 2706 A
(string)252 2874 A
(will)168 3168 A
3378(be)S
(empty)210 3504 A
(and)126 3756 A
(the)126 3924 A
4050 V
(06835)210 648 A
1068(*)S
(file)168 1152 A
(system)252 1362 A
(already)294 1656 A
(syncked.)336 1992 A
2412(If)S
(the)126 2538 A
(panic)210 2706 A
(originates)420 2958 A
3420(in)S
(the)126 3546 A
(kernel,)294 3714 A
4050(we)S
(are)126 4176 A
4140 V
(06836)210 648 A
1068(*)S
(kind)168 1152 A
1362(of)S
(stuck.)252 1488 A
4230 V
(06837)210 648 A
1068(*/)S
4320 V
(06838)210 648 A
4410 V
(06839)210 648 A
1110(if)S
(\(*s)126 1236 A
1404(!=)S
1530(0\))S
1656({)S
4500 V
(06840)210 648 A
(printf\("\\nKernel)672 1362 A
(panic:)252 2076 A
(%s",s\);)294 2370 A
4590 V
(06841)210 648 A
1362(if)S
1488(\(n)S
1614(!=)S
(NO_NUM\))294 1740 A
(printf\(")336 2076 A
(%d",)168 2454 A
(n\);)126 2664 A
4680 V
(06842)210 648 A
(printf\("\\n"\);)546 1362 A
4770 V
(06843)210 648 A
1110(})S
4860 V
(06844)210 648 A
(wreboot\(RBT_PANIC\);)798 1110 A
4950 V
(06845)210 648 A
1026(})S
8418 V
EP
%%Page: 82 82
BP
/slant 0 def
/height 0 def
630 V
12 B
648(82)S
11 R
2049(File:)S
2282(src/kernel/proc.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/kernel/proc.c)714 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(06900)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(essentially)462 1950 A
(all)126 2454 A
2622(of)S
(the)126 2748 A
(process)294 2916 A
(and)126 3252 A
(message)294 3420 A
(handling.)378 3756 A
1440 V
(06901)210 648 A
1068(*)S
1152(It)S
(has)126 1278 A
(two)126 1446 A
(main)168 1614 A
(entry)210 1824 A
(points)252 2076 A
(from)168 2370 A
(the)126 2580 A
(outside:)336 2748 A
1530 V
(06902)210 648 A
1068(*)S
1620 V
(06903)210 648 A
1068(*)S
(sys_call:)378 1236 A
(called)252 1740 A
(when)168 2034 A
2244(a)S
(process)294 2328 A
2664(or)S
(task)168 2790 A
(does)168 3000 A
(SEND,)210 3210 A
(RECEIVE)294 3462 A
3798(or)S
(SENDREC)294 3924 A
1710 V
(06904)210 648 A
1068(*)S
(interrupt:)420 1236 A
(called)252 1698 A
1992(by)S
(interrupt)378 2118 A
(routines)336 2538 A
2916(to)S
(send)168 3042 A
3252(a)S
(message)294 3336 A
3672(to)S
(task)168 3798 A
1800 V
(06905)210 648 A
1068(*)S
1890 V
(06906)210 648 A
1068(*)S
1152(It)S
(also)168 1278 A
(has)126 1488 A
(several)294 1656 A
(minor)210 1992 A
(entry)210 2244 A
(points:)294 2496 A
1980 V
(06907)210 648 A
1068(*)S
2070 V
(06908)210 648 A
1068(*)S
(lock_ready:)462 1236 A
(put)126 1950 A
2118(a)S
(process)294 2202 A
2538(on)S
(one)126 2664 A
2832(of)S
(the)126 2958 A
(ready)210 3126 A
(queues)252 3378 A
3672(so)S
3798(it)S
(can)126 3924 A
4092(be)S
(run)126 4218 A
2160 V
(06909)210 648 A
1068(*)S
(lock_unready:)546 1236 A
(remove)252 1950 A
2244(a)S
(process)294 2328 A
(from)168 2664 A
(the)126 2874 A
(ready)210 3042 A
(queues)252 3294 A
2250 V
(06910)210 648 A
1068(*)S
(lock_sched:)462 1236 A
1950(a)S
(process)294 2034 A
(has)126 2370 A
(run)126 2538 A
(too)126 2706 A
(long;)210 2874 A
(schedule)336 3126 A
(another)294 3504 A
(one)126 3840 A
2340 V
(06911)210 648 A
1068(*)S
(lock_mini_send:)630 1236 A
(send)168 1950 A
2160(a)S
(message)294 2244 A
(\(used)210 2580 A
2832(by)S
(interrupt)378 2958 A
(signals,)336 3378 A
(etc.\))210 3756 A
2430 V
(06912)210 648 A
1068(*)S
(lock_pick_proc:)630 1236 A
(pick)168 1950 A
2160(a)S
(process)294 2244 A
2580(to)S
(run)126 2706 A
(\(used)210 2874 A
3126(by)S
(system)252 3252 A
(initialization\))630 3546 A
2520 V
(06913)210 648 A
1068(*)S
(unhold:)294 1236 A
(repeat)252 1950 A
(all)126 2244 A
(held-up)294 2412 A
(interrupts)420 2748 A
2610 V
(06914)210 648 A
1068(*/)S
2700 V
(06915)210 648 A
2790 V
(06916)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
2880 V
(06917)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
2970 V
(06918)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
3060 V
(06919)210 648 A
(#include)336 1026 A
("proc.h")336 1404 A
3150 V
(06920)210 648 A
3240 V
(06921)210 648 A
(PRIVATE)294 1026 A
(unsigned)336 1362 A
(char)168 1740 A
(switching;)420 1950 A
2706(/*)S
(nonzero)294 2832 A
3168(to)S
(inhibit)294 3294 A
(interrupt\(\))462 3630 A
4134(*/)S
3330 V
(06922)210 648 A
3420 V
(06923)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(mini_send,)420 2034 A
(\(struct)294 2496 A
(proc)168 2832 A
(*caller_ptr,)504 3042 A
(int)126 3588 A
(dest,)210 3756 A
3510 V
(06924)210 648 A
(message)294 1698 A
(*m_ptr\))294 2034 A
2370(\);)S
3600 V
(06925)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(mini_rec,)378 2034 A
(\(struct)294 2454 A
(proc)168 2790 A
(*caller_ptr,)504 3000 A
(int)126 3546 A
(src,)168 3714 A
3690 V
(06926)210 648 A
(message)294 1698 A
(*m_ptr\))294 2034 A
2370(\);)S
3780 V
(06927)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(ready,)252 2076 A
(\(struct)294 2370 A
(proc)168 2706 A
(*rp\))168 2916 A
3126(\);)S
3870 V
(06928)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(sched,)252 2076 A
(\(void\))252 2370 A
2664(\);)S
3960 V
(06929)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(unready,)336 2076 A
(\(struct)294 2454 A
(proc)168 2790 A
(*rp\))168 3000 A
3210(\);)S
4050 V
(06930)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(pick_proc,)420 2076 A
(\(void\))252 2538 A
2832(\);)S
4140 V
(06931)210 648 A
4230 V
(06932)210 648 A
(#define)294 1026 A
(CopyMess\(s,sp,sm,dp,dm\))966 1362 A
2370(\\)S
4320 V
(06933)210 648 A
(cp_mess\(s,)420 1362 A
(\(sp\)->p_map[D].mem_phys,)1008 1824 A
(\(vir_bytes\)sm,)588 2874 A
(\(dp\)->p_map[D].mem_phys,)1008 3504 A
(\(vir_bytes\)dm\))588 4554 A
4410 V
(06934)210 648 A
4500 V
(06935)210 648 A
(/*===========================================================================*)3276 1026 A
4590 V
(06936)210 648 A
1068(*)S
(interrupt)378 2370 A
4260(*)S
4680 V
(06937)210 648 A
(*===========================================================================*/)3276 1068 A
4770 V
(06938)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(interrupt\(task\))630 1530 A
4860 V
(06939)210 648 A
(int)126 1026 A
(task;)210 1194 A
2370(/*)S
(number)252 2496 A
2790(of)S
(task)168 2916 A
3126(to)S
3252(be)S
(started)294 3378 A
3714(*/)S
4950 V
(06940)210 648 A
1026({)S
5040 V
(06941)210 648 A
1026(/*)S
1152(An)S
(interrupt)378 1278 A
(has)126 1698 A
(occurred.)378 1866 A
(Schedule)336 2328 A
(the)126 2706 A
(task)168 2874 A
(that)168 3084 A
(handles)294 3294 A
(it.)126 3630 A
3798(*/)S
5130 V
(06942)210 648 A
5220 V
(06943)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(task's)252 2958 A
(proc)168 3252 A
(entry)210 3462 A
3714(*/)S
5310 V
(06944)210 648 A
5400 V
(06945)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(task\);)672 1320 A
5490 V
(06946)210 648 A
5580 V
(06947)210 648 A
1110(/*)S
1236(If)S
(this)168 1362 A
(call)168 1572 A
(would)210 1782 A
(compete)294 2034 A
(with)168 2370 A
(other)210 2580 A
(process-switching)714 2832 A
(functions,)420 3588 A
(put)126 4050 A
5670 V
(06948)210 648 A
1152(*)S
1236(it)S
1362(on)S
(the)126 1488 A
('held')252 1656 A
(queue)210 1950 A
2202(to)S
2328(be)S
(flushed)294 2454 A
2790(at)S
(the)126 2916 A
(next)168 3084 A
(non-competing)546 3294 A
(restart\(\).)420 3882 A
5760 V
(06949)210 648 A
1152(*)S
(The)126 1236 A
(competing)378 1404 A
(conditions)420 1824 A
(are:)168 2286 A
5850 V
(06950)210 648 A
1152(*)S
(\(1\))126 1236 A
(k_reenter)378 1404 A
1824(==)S
(\(typeof)294 1950 A
(k_reenter\))420 2286 A
(-1:)126 2748 A
5940 V
(06951)210 648 A
1152(*)S
(Call)168 1404 A
(from)168 1614 A
(the)126 1824 A
(task)168 1992 A
(level,)252 2202 A
(typically)378 2496 A
(from)168 2916 A
3126(an)S
(output)252 3252 A
(interrupt)378 3546 A
6030 V
(06952)210 648 A
1152(*)S
(routine.)336 1404 A
1824(An)S
(interrupt)378 1950 A
(handler)294 2370 A
(might)210 2706 A
(reenter)294 2958 A
(interrupt\(\).)504 3294 A
(Rare,)210 3882 A
6120 V
(06953)210 648 A
1152(*)S
1404(so)S
(not)126 1530 A
(worth)210 1698 A
(special)294 1950 A
(treatment.)420 2286 A
6210 V
(06954)210 648 A
1152(*)S
(\(2\))126 1236 A
(k_reenter)378 1404 A
1824(>)S
1908(0:)S
8418 V
EP
%%Page: 83 83
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2049(File:)S
2282(src/kernel/proc.c)S
12 B
4308(83)S
900 V
7 LST
(06955)210 648 A
1152(*)S
(Call)168 1404 A
(from)168 1614 A
1824(a)S
(nested)252 1908 A
(interrupt)378 2202 A
(handler.)336 2622 A
3042(A)S
(previous)336 3126 A
(interrupt)378 3504 A
(handler)294 3924 A
990 V
(06956)210 648 A
1152(*)S
(might)210 1404 A
1656(be)S
(inside)252 1782 A
(interrupt\(\))462 2076 A
2580(or)S
(sys_call\(\).)462 2706 A
1080 V
(06957)210 648 A
1152(*)S
(\(3\))126 1236 A
(switching)378 1404 A
1824(!=)S
1950(0:)S
1170 V
(06958)210 648 A
1152(*)S
(Some)168 1404 A
(process-switching)714 1614 A
(function)336 2370 A
(other)210 2748 A
(than)168 3000 A
(interrupt\(\))462 3210 A
3714(is)S
(being)210 3840 A
1260 V
(06959)210 648 A
1152(*)S
(called)252 1404 A
(from)168 1698 A
(the)126 1908 A
(task)168 2076 A
(level,)252 2286 A
(typically)378 2580 A
(sched\(\))294 3000 A
(from)168 3336 A
(CLOCK.)252 3546 A
3882(An)S
1350 V
(06960)210 648 A
1152(*)S
(interrupt)378 1404 A
(handler)294 1824 A
(might)210 2160 A
(call)168 2412 A
(interrupt)378 2622 A
(and)126 3042 A
(pass)168 3210 A
(the)126 3420 A
(k_reenter)378 3588 A
(test.)210 4008 A
1440 V
(06961)210 648 A
1152(*/)S
1530 V
(06962)210 648 A
1110(if)S
(\(k_reenter)420 1236 A
1698(!=)S
1824(0)S
1908(||)S
(switching\))420 2034 A
2496({)S
1620 V
(06963)210 648 A
(lock\(\);)294 1362 A
1710 V
(06964)210 648 A
1362(if)S
(\(!rp->p_int_held\))714 1488 A
2244({)S
1800 V
(06965)210 648 A
(rp->p_int_held)588 1698 A
2328(=)S
(TRUE;)210 2412 A
1890 V
(06966)210 648 A
1698(if)S
(\(held_head)420 1824 A
2286(!=)S
(NIL_PROC\))378 2412 A
1980 V
(06967)210 648 A
(held_tail->p_nextheld)882 2034 A
2958(=)S
(rp;)126 3042 A
2070 V
(06968)210 648 A
(else)168 1698 A
2160 V
(06969)210 648 A
(held_head)378 2034 A
2454(=)S
(rp;)126 2538 A
2250 V
(06970)210 648 A
(held_tail)378 1698 A
2118(=)S
(rp;)126 2202 A
2340 V
(06971)210 648 A
(rp->p_nextheld)588 1698 A
2328(=)S
(NIL_PROC;)378 2412 A
2430 V
(06972)210 648 A
1362(})S
2520 V
(06973)210 648 A
(unlock\(\);)378 1362 A
2610 V
(06974)210 648 A
(return;)294 1362 A
2700 V
(06975)210 648 A
1110(})S
2790 V
(06976)210 648 A
2880 V
(06977)210 648 A
1110(/*)S
1236(If)S
(task)168 1362 A
1572(is)S
(not)126 1698 A
(waiting)294 1866 A
(for)126 2202 A
2370(an)S
(interrupt,)420 2496 A
(record)252 2958 A
(the)126 3252 A
(blockage.)378 3420 A
3840(*/)S
2970 V
(06978)210 648 A
1110(if)S
1236(\()S
(\(rp->p_flags)504 1320 A
1866(&)S
(\(RECEIVING)420 1950 A
2412(|)S
(SENDING\)\))378 2496 A
2916(!=)S
(RECEIVING)378 3042 A
3462(||)S
3060 V
(06979)210 648 A
(!isrxhardware\(rp->p_getfrom\)\))1218 1278 A
2538({)S
3150 V
(06980)210 648 A
(rp->p_int_blocked)714 1362 A
2118(=)S
(TRUE;)210 2202 A
3240 V
(06981)210 648 A
(return;)294 1362 A
3330 V
(06982)210 648 A
1110(})S
3420 V
(06983)210 648 A
3510 V
(06984)210 648 A
1110(/*)S
(Destination)462 1236 A
1740(is)S
(waiting)294 1866 A
(for)126 2202 A
2370(an)S
(interrupt.)420 2496 A
3600 V
(06985)210 648 A
1152(*)S
(Send)168 1236 A
1446(it)S
1572(a)S
(message)294 1656 A
(with)168 1992 A
(source)252 2202 A
(HARDWARE)336 2496 A
(and)126 2874 A
(type)168 3042 A
(HARD_INT.)378 3252 A
3690 V
(06986)210 648 A
1152(*)S
1236(No)S
(more)168 1362 A
(information)462 1572 A
(can)126 2076 A
2244(be)S
(reliably)336 2370 A
(provided)336 2748 A
(since)210 3126 A
(interrupt)378 3378 A
(messages)336 3798 A
3780 V
(06987)210 648 A
1152(*)S
(are)126 1236 A
(not)126 1404 A
(queued.)294 1572 A
3870 V
(06988)210 648 A
1152(*/)S
3960 V
(06989)210 648 A
(rp->p_messbuf->m_source)966 1110 A
2118(=)S
(HARDWARE;)378 2202 A
4050 V
(06990)210 648 A
(rp->p_messbuf->m_type)882 1110 A
2034(=)S
(HARD_INT;)378 2118 A
4140 V
(06991)210 648 A
(rp->p_flags)462 1110 A
1614(&=)S
(\304RECEIVING;)462 1740 A
4230 V
(06992)210 648 A
(rp->p_int_blocked)714 1110 A
1866(=)S
(FALSE;)252 1950 A
4320 V
(06993)210 648 A
4410 V
(06994)210 648 A
1152(/*)S
(Make)168 1278 A
1488(rp)S
(ready)210 1614 A
(and)126 1866 A
(run)126 2034 A
2202(it)S
(unless)252 2328 A
2622(a)S
(task)168 2706 A
2916(is)S
(already)294 3042 A
(running.)336 3378 A
(This)168 3798 A
4008(is)S
4500 V
(06995)210 648 A
1194(*)S
(ready\(rp\))378 1278 A
(in-line)294 1698 A
(for)126 2034 A
(speed.)252 2202 A
4590 V
(06996)210 648 A
1194(*/)S
4680 V
(06997)210 648 A
1110(if)S
(\(rdy_head[TASK_Q])714 1236 A
1992(!=)S
(NIL_PROC\))378 2118 A
4770 V
(06998)210 648 A
(rdy_tail[TASK_Q]->p_nextready)1218 1362 A
2622(=)S
(rp;)126 2706 A
4860 V
(06999)210 648 A
(else)168 1110 A
4950 V
(07000)210 648 A
(proc_ptr)336 1362 A
1740(=)S
(rdy_head[TASK_Q])672 1824 A
2538(=)S
(rp;)126 2622 A
5040 V
(07001)210 648 A
(rdy_tail[TASK_Q])672 1110 A
1824(=)S
(rp;)126 1908 A
5130 V
(07002)210 648 A
(rp->p_nextready)630 1110 A
1782(=)S
(NIL_PROC;)378 1866 A
5220 V
(07003)210 648 A
1026(})S
5400 V
(07005)210 648 A
(/*===========================================================================*)3276 1026 A
5490 V
(07006)210 648 A
1068(*)S
(sys_call)336 2370 A
4260(*)S
5580 V
(07007)210 648 A
(*===========================================================================*/)3276 1068 A
5670 V
(07008)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(sys_call\(function,)756 1488 A
(src_dest,)378 2286 A
(m_ptr\))252 2706 A
5760 V
(07009)210 648 A
(int)126 1026 A
(function;)378 1194 A
2370(/*)S
(SEND,)210 2496 A
(RECEIVE,)336 2748 A
3126(or)S
(BOTH)168 3252 A
3462(*/)S
5850 V
(07010)210 648 A
(int)126 1026 A
(src_dest;)378 1194 A
2370(/*)S
(source)252 2496 A
2790(to)S
(receive)294 2916 A
(from)168 3252 A
3462(or)S
(dest)168 3588 A
3798(to)S
(send)168 3924 A
4134(to)S
4260(*/)S
5940 V
(07011)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
3294(*/)S
6030 V
(07012)210 648 A
1026({)S
6120 V
(07013)210 648 A
1026(/*)S
(The)126 1152 A
(only)168 1320 A
(system)252 1530 A
(calls)210 1824 A
(that)168 2076 A
(exist)210 2286 A
2538(in)S
(MINIX)210 2664 A
(are)126 2916 A
(sending)294 3084 A
(and)126 3420 A
(receiving)378 3588 A
6210 V
(07014)210 648 A
1068(*)S
(messages.)378 1152 A
(These)210 1614 A
(are)126 1866 A
(done)168 2034 A
2244(by)S
(trapping)336 2370 A
2748(to)S
(the)126 2874 A
(kernel)252 3042 A
(with)168 3336 A
3546(an)S
(INT)126 3672 A
(instruction.)504 3840 A
8418 V
EP
%%Page: 84 84
BP
/slant 0 def
/height 0 def
630 V
12 B
648(84)S
11 R
2049(File:)S
2282(src/kernel/proc.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(07015)210 648 A
1068(*)S
(The)126 1152 A
(trap)168 1320 A
1530(is)S
(caught)252 1656 A
(and)126 1950 A
(sys_call\(\))420 2118 A
2580(is)S
(called)252 2706 A
3000(to)S
(send)168 3126 A
3336(or)S
(receive)294 3462 A
3798(a)S
(message)294 3882 A
990 V
(07016)210 648 A
1068(*)S
(\(or)126 1152 A
(both\).)252 1320 A
(The)126 1614 A
(caller)252 1782 A
2076(is)S
(always)252 2202 A
(given)210 2496 A
2748(by)S
(proc_ptr.)378 2874 A
1080 V
(07017)210 648 A
1068(*/)S
1170 V
(07018)210 648 A
1260 V
(07019)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
1350 V
(07020)210 648 A
(int)126 1110 A
1278(n;)S
1440 V
(07021)210 648 A
1530 V
(07022)210 648 A
1110(/*)S
(Check)210 1236 A
(for)126 1488 A
(bad)126 1656 A
(system)252 1824 A
(call)168 2118 A
(parameters.)462 2328 A
2832(*/)S
1620 V
(07023)210 648 A
1110(if)S
(\(!isoksrc_dest\(src_dest\)\))1050 1236 A
(return\(E_BAD_SRC\);)756 2328 A
1710 V
(07024)210 648 A
1110(rp)S
1236(=)S
(proc_ptr;)378 1320 A
1800 V
(07025)210 648 A
1890 V
(07026)210 648 A
1110(if)S
(\(isuserp\(rp\))504 1236 A
1782(&&)S
(function)336 1908 A
2286(!=)S
(BOTH\))210 2412 A
(return\(E_NO_PERM\);)756 2664 A
1980 V
(07027)210 648 A
2070 V
(07028)210 648 A
1110(/*)S
(The)126 1236 A
(parameters)420 1404 A
(are)126 1866 A
(ok.)126 2034 A
2202(Do)S
(the)126 2328 A
(call.)210 2496 A
2748(*/)S
2160 V
(07029)210 648 A
1110(if)S
(\(function)378 1236 A
1656(&)S
(SEND\))210 1740 A
1992({)S
2250 V
(07030)210 648 A
1362(/*)S
(Function)336 1488 A
1866(=)S
(SEND)168 1950 A
2160(or)S
(BOTH.)210 2286 A
2538(*/)S
2340 V
(07031)210 648 A
1362(n)S
1446(=)S
(mini_send\(rp,)546 1530 A
(src_dest,)378 2118 A
(m_ptr\);)294 2538 A
2430 V
(07032)210 648 A
1362(if)S
(\(function)378 1488 A
1908(==)S
(SEND)168 2034 A
2244(||)S
2370(n)S
2454(!=)S
(OK\))126 2580 A
2520 V
(07033)210 648 A
(return\(n\);)420 1698 A
2370(/*)S
(done,)210 2496 A
2748(or)S
(SEND)168 2874 A
(failed)252 3084 A
3378(*/)S
2610 V
(07034)210 648 A
1110(})S
2700 V
(07035)210 648 A
2790 V
(07036)210 648 A
1110(/*)S
(Function)336 1236 A
1614(=)S
(RECEIVE)294 1698 A
2034(or)S
(BOTH.)210 2160 A
2880 V
(07037)210 648 A
1152(*)S
1236(We)S
(have)168 1362 A
(checked)294 1572 A
(user)168 1908 A
(calls)210 2118 A
(are)126 2370 A
(BOTH,)210 2538 A
(and)126 2790 A
(trust)210 2958 A
('function')420 3210 A
(otherwise.)420 3672 A
2970 V
(07038)210 648 A
1152(*/)S
3060 V
(07039)210 648 A
(return\(mini_rec\(rp,)798 1110 A
(src_dest,)378 1950 A
(m_ptr\)\);)336 2370 A
3150 V
(07040)210 648 A
1026(})S
3330 V
(07042)210 648 A
(/*===========================================================================*)3276 1026 A
3420 V
(07043)210 648 A
1068(*)S
(mini_send)378 2370 A
4260(*)S
3510 V
(07044)210 648 A
(*===========================================================================*/)3276 1068 A
3600 V
(07045)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(mini_send\(caller_ptr,)882 1530 A
(dest,)210 2454 A
(m_ptr\))252 2706 A
3690 V
(07046)210 648 A
(register)336 1026 A
(struct)252 1404 A
(proc)168 1698 A
(*caller_ptr;)504 1908 A
2706(/*)S
(who)126 2832 A
3000(is)S
(trying)252 3126 A
3420(to)S
(send)168 3546 A
3756(a)S
(message?)336 3840 A
4218(*/)S
3780 V
(07047)210 648 A
(int)126 1026 A
(dest;)210 1194 A
2370(/*)S
2496(to)S
(whom)168 2622 A
2832(is)S
(message)294 2958 A
(being)210 3294 A
(sent?)210 3546 A
3798(*/)S
3870 V
(07048)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
(buffer)252 3294 A
3588(*/)S
3960 V
(07049)210 648 A
1026({)S
4050 V
(07050)210 648 A
1026(/*)S
(Send)168 1152 A
1362(a)S
(message)294 1446 A
(from)168 1782 A
('caller_ptr')504 1992 A
2538(to)S
('dest'.)294 2664 A
3000(If)S
('dest')252 3126 A
3420(is)S
(blocked)294 3546 A
(waiting)294 3882 A
4140 V
(07051)210 648 A
1068(*)S
(for)126 1152 A
(this)168 1320 A
(message,)336 1530 A
(copy)168 1908 A
(the)126 2118 A
(message)294 2286 A
2622(to)S
2748(it)S
(and)126 2874 A
(unblock)294 3042 A
('dest'.)294 3378 A
3714(If)S
('dest')252 3840 A
4134(is)S
4230 V
(07052)210 648 A
1068(*)S
(not)126 1152 A
(waiting)294 1320 A
1656(at)S
(all,)168 1782 A
1992(or)S
2118(is)S
(waiting)294 2244 A
(for)126 2580 A
(another)294 2748 A
(source,)294 3084 A
(queue)210 3420 A
('caller_ptr'.)546 3672 A
4320 V
(07053)210 648 A
1068(*/)S
4410 V
(07054)210 648 A
4500 V
(07055)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*dest_ptr,)420 1992 A
(*next_ptr;)420 2454 A
4590 V
(07056)210 648 A
(vir_bytes)378 1110 A
(vb;)126 1530 A
2370(/*)S
(message)294 2496 A
(buffer)252 2832 A
(pointer)294 3126 A
3462(as)S
(vir_bytes)378 3588 A
4008(*/)S
4680 V
(07057)210 648 A
(vir_clicks)420 1110 A
(vlo,)168 1572 A
(vhi;)168 1782 A
2370(/*)S
(virtual)294 2496 A
(clicks)252 2832 A
(containing)420 3126 A
(message)294 3588 A
3924(to)S
(send)168 4050 A
4260(*/)S
4770 V
(07058)210 648 A
4860 V
(07059)210 648 A
1110(/*)S
(User)168 1236 A
(processes)378 1446 A
(are)126 1866 A
(only)168 2034 A
(allowed)294 2244 A
2580(to)S
(send)168 2706 A
2916(to)S
3042(FS)S
(and)126 3168 A
(MM.)126 3336 A
(Check)210 3546 A
(for)126 3798 A
(this.)210 3966 A
4218(*/)S
4950 V
(07060)210 648 A
1110(if)S
(\(isuserp\(caller_ptr\))840 1236 A
2118(&&)S
(!issysentn\(dest\)\))714 2244 A
(return\(E_BAD_DEST\);)798 3000 A
5040 V
(07061)210 648 A
(dest_ptr)336 1110 A
1488(=)S
(proc_addr\(dest\);)672 1572 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(destination's)546 2958 A
(proc)168 3546 A
(entry)210 3756 A
4008(*/)S
5130 V
(07062)210 648 A
1110(if)S
(\(dest_ptr->p_flags)756 1236 A
2034(&)S
(P_SLOT_FREE\))504 2118 A
(return\(E_BAD_DEST\);)798 2664 A
3714(/*)S
(dead)168 3840 A
(dest)168 4050 A
4260(*/)S
5220 V
(07063)210 648 A
5310 V
(07064)210 648 A
1110(/*)S
(This)168 1236 A
(check)210 1446 A
(allows)252 1698 A
1992(a)S
(message)294 2076 A
2412(to)S
2538(be)S
(anywhere)336 2664 A
3042(in)S
(data)168 3168 A
3378(or)S
(stack)210 3504 A
3756(or)S
(gap.)168 3882 A
5400 V
(07065)210 648 A
1152(*)S
1236(It)S
(will)168 1362 A
(have)168 1572 A
1782(to)S
1908(be)S
(made)168 2034 A
(more)168 2244 A
(elaborate)378 2454 A
(later)210 2874 A
(for)126 3126 A
(machines)336 3294 A
(which)210 3672 A
5490 V
(07066)210 648 A
1152(*)S
(don't)210 1236 A
(have)168 1488 A
(the)126 1698 A
(gap)126 1866 A
(mapped.)294 2034 A
5580 V
(07067)210 648 A
1152(*/)S
5670 V
(07068)210 648 A
1110(vb)S
1236(=)S
(\(vir_bytes\))462 1320 A
(m_ptr;)252 1824 A
5760 V
(07069)210 648 A
(vlo)126 1110 A
1278(=)S
1362(vb)S
1488(>>)S
(CLICK_SHIFT;)504 1614 A
2370(/*)S
(vir)126 2496 A
(click)210 2664 A
(for)126 2916 A
(bottom)252 3084 A
3378(of)S
(message)294 3504 A
3840(*/)S
5850 V
(07070)210 648 A
(vhi)126 1110 A
1278(=)S
(\(vb)126 1362 A
1530(+)S
(MESS_SIZE)378 1614 A
2034(-)S
2118(1\))S
2244(>>)S
(CLICK_SHIFT;)504 2370 A
3042(/*)S
(vir)126 3168 A
(click)210 3336 A
(for)126 3588 A
(top)126 3756 A
3924(of)S
(msg)126 4050 A
4218(*/)S
5940 V
(07071)210 648 A
1110(if)S
(\(vlo)168 1236 A
1446(<)S
(caller_ptr->p_map[D].mem_vir)1176 1530 A
2748(||)S
(vlo)126 2874 A
3042(>)S
(vhi)126 3126 A
3294(||)S
6030 V
(07072)210 648 A
(vhi)126 1278 A
1446(>=)S
(caller_ptr->p_map[S].mem_vir)1176 1572 A
2790(+)S
(caller_ptr->p_map[S].mem_len\))1218 2874 A
6120 V
(07073)210 648 A
(return\(EFAULT\);)630 1362 A
6210 V
(07074)210 648 A
8418 V
EP
%%Page: 85 85
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2049(File:)S
2282(src/kernel/proc.c)S
12 B
4308(85)S
900 V
7 LST
(07075)210 648 A
1110(/*)S
(Check)210 1236 A
(for)126 1488 A
(deadlock)336 1656 A
2034(by)S
('caller_ptr')504 2160 A
(and)126 2706 A
('dest')252 2874 A
(sending)294 3168 A
3504(to)S
(each)168 3630 A
(other.)252 3840 A
4134(*/)S
990 V
(07076)210 648 A
1110(if)S
(\(dest_ptr->p_flags)756 1236 A
2034(&)S
(SENDING\))336 2118 A
2496({)S
1080 V
(07077)210 648 A
(next_ptr)336 1362 A
1740(=)S
(proc_addr\(dest_ptr->p_sendto\);)1260 1824 A
1170 V
(07078)210 648 A
(while)210 1362 A
(\(TRUE\))252 1614 A
1908({)S
1260 V
(07079)210 648 A
1698(if)S
(\(next_ptr)378 1824 A
2244(==)S
(caller_ptr\))462 2370 A
(return\(ELOCKED\);)672 2874 A
1350 V
(07080)210 648 A
1698(if)S
(\(next_ptr->p_flags)756 1824 A
2622(&)S
(SENDING\))336 2706 A
1440 V
(07081)210 648 A
(next_ptr)336 2034 A
2412(=)S
(proc_addr\(next_ptr->p_sendto\);)1260 2496 A
1530 V
(07082)210 648 A
(else)168 1698 A
1620 V
(07083)210 648 A
(break;)252 2034 A
1710 V
(07084)210 648 A
1362(})S
1800 V
(07085)210 648 A
1110(})S
1890 V
(07086)210 648 A
1980 V
(07087)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
('dest')252 1908 A
2202(is)S
(blocked)294 2328 A
(waiting)294 2664 A
(for)126 3000 A
(this)168 3168 A
(message.)336 3378 A
3756(*/)S
2070 V
(07088)210 648 A
1110(if)S
1236(\()S
(\(dest_ptr->p_flags)756 1320 A
2118(&)S
(\(RECEIVING)420 2202 A
2664(|)S
(SENDING\)\))378 2748 A
3168(==)S
(RECEIVING)378 3294 A
3714(&&)S
2160 V
(07089)210 648 A
(\(dest_ptr->p_getfrom)840 1320 A
2202(==)S
(ANY)126 2328 A
2496(||)S
2250 V
(07090)210 648 A
(dest_ptr->p_getfrom)798 1362 A
2202(==)S
(proc_number\(caller_ptr\)\)\))1050 2328 A
3420({)S
2340 V
(07091)210 648 A
1362(/*)S
(Destination)462 1488 A
1992(is)S
(indeed)252 2118 A
(waiting)294 2412 A
(for)126 2748 A
(this)168 2916 A
(message.)336 3126 A
3504(*/)S
2430 V
(07092)210 648 A
(CopyMess\(proc_number\(caller_ptr\),)1386 1362 A
(caller_ptr,)462 2790 A
(m_ptr,)252 3294 A
(dest_ptr,)378 3588 A
2520 V
(07093)210 648 A
(dest_ptr->p_messbuf\);)882 1740 A
2610 V
(07094)210 648 A
(dest_ptr->p_flags)714 1362 A
2118(&=)S
(\304RECEIVING;)462 2244 A
3042(/*)S
(deblock)294 3168 A
(destination)462 3504 A
4008(*/)S
2700 V
(07095)210 648 A
1362(if)S
(\(dest_ptr->p_flags)756 1488 A
2286(==)S
2412(0\))S
(ready\(dest_ptr\);)672 2538 A
2790 V
(07096)210 648 A
1110(})S
(else)168 1194 A
1404({)S
2880 V
(07097)210 648 A
1362(/*)S
(Destination)462 1488 A
1992(is)S
(not)126 2118 A
(waiting.)336 2286 A
(Block)210 2706 A
(and)126 2958 A
(queue)210 3126 A
(caller.)294 3378 A
3714(*/)S
2970 V
(07098)210 648 A
(caller_ptr->p_messbuf)882 1362 A
2286(=)S
(m_ptr;)252 2370 A
3060 V
(07099)210 648 A
1362(if)S
(\(caller_ptr->p_flags)840 1488 A
2370(==)S
2496(0\))S
(unready\(caller_ptr\);)840 2622 A
3150 V
(07100)210 648 A
(caller_ptr->p_flags)798 1362 A
2202(|=)S
(SENDING;)336 2328 A
3240 V
(07101)210 648 A
(caller_ptr->p_sendto=)882 1362 A
(dest;)210 2286 A
3330 V
(07102)210 648 A
3420 V
(07103)210 648 A
1362(/*)S
(Process)294 1488 A
1824(is)S
(now)126 1950 A
(blocked.)336 2118 A
(Put)126 2538 A
2706(in)S
2832(on)S
(the)126 2958 A
(destination's)546 3126 A
(queue.)252 3714 A
4008(*/)S
3510 V
(07104)210 648 A
1362(if)S
1488(\()S
(\(next_ptr)378 1572 A
1992(=)S
(dest_ptr->p_callerq\))840 2076 A
2958(==)S
(NIL_PROC\))378 3084 A
3600 V
(07105)210 648 A
(dest_ptr->p_callerq)798 1698 A
2538(=)S
(caller_ptr;)462 2622 A
3690 V
(07106)210 648 A
(else)168 1362 A
1572({)S
3780 V
(07107)210 648 A
(while)210 1698 A
(\(next_ptr->p_sendlink)882 1950 A
2874(!=)S
(NIL_PROC\))378 3000 A
3870 V
(07108)210 648 A
(next_ptr)336 2034 A
2412(=)S
(next_ptr->p_sendlink;)882 2496 A
3960 V
(07109)210 648 A
(next_ptr->p_sendlink)840 1698 A
2580(=)S
(caller_ptr;)462 2664 A
4050 V
(07110)210 648 A
1362(})S
4140 V
(07111)210 648 A
(caller_ptr->p_sendlink)924 1362 A
2328(=)S
(NIL_PROC;)378 2412 A
4230 V
(07112)210 648 A
1110(})S
4320 V
(07113)210 648 A
(return\(OK\);)462 1110 A
4410 V
(07114)210 648 A
1026(})S
4590 V
(07116)210 648 A
(/*===========================================================================*)3276 1026 A
4680 V
(07117)210 648 A
1068(*)S
(mini_rec)336 2370 A
4260(*)S
4770 V
(07118)210 648 A
(*===========================================================================*/)3276 1068 A
4860 V
(07119)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(mini_rec\(caller_ptr,)840 1530 A
(src,)168 2412 A
(m_ptr\))252 2622 A
4950 V
(07120)210 648 A
(register)336 1026 A
(struct)252 1404 A
(proc)168 1698 A
(*caller_ptr;)504 1908 A
2706(/*)S
(process)294 2832 A
(trying)252 3168 A
3462(to)S
(get)126 3588 A
(message)294 3756 A
4092(*/)S
5040 V
(07121)210 648 A
(int)126 1026 A
(src;)168 1194 A
2370(/*)S
(which)210 2496 A
(message)294 2748 A
(source)252 3084 A
3378(is)S
(wanted)252 3504 A
(\(or)126 3798 A
(ANY\))168 3966 A
4176(*/)S
5130 V
(07122)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
(buffer)252 3294 A
3588(*/)S
5220 V
(07123)210 648 A
1026({)S
5310 V
(07124)210 648 A
1026(/*)S
1152(A)S
(process)294 1236 A
1572(or)S
(task)168 1698 A
(wants)210 1908 A
2160(to)S
(get)126 2286 A
2454(a)S
(message.)336 2538 A
2958(If)S
(one)126 3084 A
3252(is)S
(already)294 3378 A
(queued,)294 3714 A
5400 V
(07125)210 648 A
1068(*)S
(acquire)294 1152 A
1488(it)S
(and)126 1614 A
(deblock)294 1782 A
(the)126 2118 A
(sender.)294 2286 A
2664(If)S
2790(no)S
(message)294 2916 A
(from)168 3252 A
(the)126 3462 A
(desired)294 3630 A
(source)252 3966 A
5490 V
(07126)210 648 A
1068(*)S
1152(is)S
(available,)420 1278 A
(block)210 1740 A
(the)126 1992 A
(caller.)294 2160 A
2538(No)S
(need)168 2664 A
2874(to)S
(check)210 3000 A
(parameters)420 3252 A
(for)126 3714 A
(validity.)378 3882 A
5580 V
(07127)210 648 A
1068(*)S
(Users)210 1152 A
(calls)210 1404 A
(are)126 1656 A
(always)252 1824 A
(sendrec\(\),)420 2118 A
(and)126 2580 A
(mini_send\(\))462 2748 A
(has)126 3252 A
(checked)294 3420 A
(already.)336 3756 A
5670 V
(07128)210 648 A
1068(*)S
(Calls)210 1152 A
(from)168 1404 A
(the)126 1614 A
(tasks,)252 1782 A
(MM,)126 2076 A
(and)126 2244 A
2412(FS)S
(are)126 2538 A
(trusted.)336 2706 A
5760 V
(07129)210 648 A
1068(*/)S
5850 V
(07130)210 648 A
5940 V
(07131)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*sender_ptr;)504 1992 A
6030 V
(07132)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*previous_ptr;)588 1992 A
6120 V
(07133)210 648 A
6210 V
(07134)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
1908(a)S
(message)294 1992 A
(from)168 2328 A
(desired)294 2538 A
(source)252 2874 A
3168(is)S
(already)294 3294 A
(available.)420 3630 A
4092(*/)S
8418 V
EP
%%Page: 86 86
BP
/slant 0 def
/height 0 def
630 V
12 B
648(86)S
11 R
2049(File:)S
2282(src/kernel/proc.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(07135)210 648 A
1110(if)S
(\(!\(caller_ptr->p_flags)924 1236 A
2202(&)S
(SENDING\)\))378 2286 A
2706({)S
990 V
(07136)210 648 A
1362(/*)S
(Check)210 1488 A
(caller)252 1740 A
(queue.)252 2034 A
2328(*/)S
1080 V
(07137)210 648 A
(for)126 1194 A
(\(sender_ptr)462 1362 A
1866(=)S
(caller_ptr->p_callerq;)924 1950 A
(sender_ptr)420 2916 A
3378(!=)S
(NIL_PROC;)378 3504 A
1170 V
(07138)210 648 A
(previous_ptr)504 1404 A
1950(=)S
(sender_ptr,)462 2034 A
(sender_ptr)420 2538 A
3000(=)S
(sender_ptr->p_sendlink\))966 3084 A
4092({)S
1260 V
(07139)210 648 A
1362(if)S
(\(src)168 1488 A
1698(==)S
(ANY)126 1824 A
1992(||)S
(src)126 2118 A
2286(==)S
(proc_number\(sender_ptr\)\))1008 2412 A
3462({)S
1350 V
(07140)210 648 A
1698(/*)S
1824(An)S
(acceptable)420 1950 A
(message)294 2412 A
(has)126 2748 A
(been)168 2916 A
(found.)252 3126 A
3420(*/)S
1440 V
(07141)210 648 A
(CopyMess\(proc_number\(sender_ptr\),)1386 1698 A
(sender_ptr,)462 3126 A
1530 V
(07142)210 648 A
(sender_ptr->p_messbuf,)924 2076 A
(caller_ptr,)462 3042 A
(m_ptr\);)294 3546 A
1620 V
(07143)210 648 A
1698(if)S
(\(sender_ptr)462 1824 A
2328(==)S
(caller_ptr->p_callerq\))924 2454 A
1710 V
(07144)210 648 A
(caller_ptr->p_callerq)882 2034 A
2958(=)S
(sender_ptr->p_sendlink;)966 3042 A
1800 V
(07145)210 648 A
(else)168 1698 A
1890 V
(07146)210 648 A
(previous_ptr->p_sendlink)1008 2034 A
3084(=)S
(sender_ptr->p_sendlink;)966 3168 A
1980 V
(07147)210 648 A
1698(if)S
(\(\(sender_ptr->p_flags)882 1824 A
2748(&=)S
(\304SENDING\))378 2874 A
3294(==)S
3420(0\))S
2070 V
(07148)210 648 A
(ready\(sender_ptr\);)756 2034 A
3042(/*)S
(deblock)294 3168 A
(sender)252 3504 A
3798(*/)S
2160 V
(07149)210 648 A
(return\(OK\);)462 1698 A
2250 V
(07150)210 648 A
1362(})S
2340 V
(07151)210 648 A
1194(})S
2430 V
(07152)210 648 A
2520 V
(07153)210 648 A
1194(/*)S
(Check)210 1320 A
(for)126 1572 A
(blocked)294 1740 A
(interrupt.)420 2076 A
2538(*/)S
2610 V
(07154)210 648 A
1194(if)S
(\(caller_ptr->p_int_blocked)1092 1320 A
2454(&&)S
(isrxhardware\(src\)\))756 2580 A
3378({)S
2700 V
(07155)210 648 A
(m_ptr->m_source)630 1362 A
2034(=)S
(HARDWARE;)378 2118 A
2790 V
(07156)210 648 A
(m_ptr->m_type)546 1362 A
1950(=)S
(HARD_INT;)378 2034 A
2880 V
(07157)210 648 A
(caller_ptr->p_int_blocked)1050 1362 A
2454(=)S
(FALSE;)252 2538 A
2970 V
(07158)210 648 A
(return\(OK\);)462 1362 A
3060 V
(07159)210 648 A
1194(})S
3150 V
(07160)210 648 A
1110(})S
3240 V
(07161)210 648 A
3330 V
(07162)210 648 A
1110(/*)S
1236(No)S
(suitable)336 1362 A
(message)294 1740 A
2076(is)S
(available.)420 2202 A
(Block)210 2706 A
(the)126 2958 A
(process)294 3126 A
(trying)252 3462 A
3756(to)S
(receive.)336 3882 A
4260(*/)S
3420 V
(07163)210 648 A
(caller_ptr->p_getfrom)882 1110 A
2034(=)S
(src;)168 2118 A
3510 V
(07164)210 648 A
(caller_ptr->p_messbuf)882 1110 A
2034(=)S
(m_ptr;)252 2118 A
3600 V
(07165)210 648 A
1110(if)S
(\(caller_ptr->p_flags)840 1236 A
2118(==)S
2244(0\))S
(unready\(caller_ptr\);)840 2370 A
3690 V
(07166)210 648 A
(caller_ptr->p_flags)798 1110 A
1950(|=)S
(RECEIVING;)420 2076 A
3780 V
(07167)210 648 A
3870 V
(07168)210 648 A
1110(/*)S
1236(If)S
1362(MM)S
(has)126 1488 A
(just)168 1656 A
(blocked)294 1866 A
(and)126 2202 A
(there)210 2370 A
(are)126 2622 A
(kernel)252 2790 A
(signals)294 3084 A
(pending,)336 3420 A
(now)126 3798 A
3966(is)S
(the)126 4092 A
3960 V
(07169)210 648 A
1152(*)S
(time)168 1236 A
1446(to)S
(tell)168 1572 A
1782(MM)S
(about)210 1908 A
(them,)210 2160 A
(since)210 2412 A
2664(it)S
(will)168 2790 A
3000(be)S
(able)168 3126 A
3336(to)S
(accept)252 3462 A
(the)126 3756 A
(message.)336 3924 A
4050 V
(07170)210 648 A
1152(*/)S
4140 V
(07171)210 648 A
1110(if)S
(\(sig_procs)420 1236 A
1698(>)S
1782(0)S
1866(&&)S
(proc_number\(caller_ptr\))966 1992 A
3000(==)S
(MM_PROC_NR)420 3126 A
3588(&&)S
(src)126 3714 A
3882(==)S
(ANY\))168 4008 A
4230 V
(07172)210 648 A
(inform\(\);)378 1362 A
4320 V
(07173)210 648 A
(return\(OK\);)462 1110 A
4410 V
(07174)210 648 A
1026(})S
4590 V
(07176)210 648 A
(/*===========================================================================*)3276 1026 A
4680 V
(07177)210 648 A
1068(*)S
(pick_proc)378 2370 A
4260(*)S
4770 V
(07178)210 648 A
(*===========================================================================*/)3276 1068 A
4860 V
(07179)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(pick_proc\(\))462 1572 A
4950 V
(07180)210 648 A
1026({)S
5040 V
(07181)210 648 A
1026(/*)S
(Decide)252 1152 A
(who)126 1446 A
1614(to)S
(run)126 1740 A
(now.)168 1908 A
2160(A)S
(new)126 2244 A
(process)294 2412 A
2748(is)S
(selected)336 2874 A
3252(by)S
(setting)294 3378 A
('proc_ptr'.)462 3714 A
5130 V
(07182)210 648 A
1068(*)S
(When)168 1152 A
1362(a)S
(fresh)210 1446 A
(user)168 1698 A
(\(or)126 1908 A
(idle\))210 2076 A
(process)294 2328 A
2664(is)S
(selected,)378 2790 A
(record)252 3210 A
3504(it)S
3630(in)S
('bill_ptr',)462 3756 A
5220 V
(07183)210 648 A
1068(*)S
1152(so)S
(the)126 1278 A
(clock)210 1446 A
(task)168 1698 A
(can)126 1908 A
(tell)168 2076 A
(who)126 2286 A
2454(to)S
(bill)168 2580 A
(for)126 2790 A
(system)252 2958 A
(time.)210 3252 A
5310 V
(07184)210 648 A
1068(*/)S
5400 V
(07185)210 648 A
5490 V
(07186)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
2370(/*)S
(process)294 2496 A
2832(to)S
(run)126 2958 A
3126(*/)S
5580 V
(07187)210 648 A
5670 V
(07188)210 648 A
1110(if)S
1236(\()S
(\(rp)126 1320 A
1488(=)S
(rdy_head[TASK_Q]\))714 1572 A
2328(!=)S
(NIL_PROC\))378 2454 A
2874({)S
5760 V
(07189)210 648 A
(proc_ptr)336 1362 A
1740(=)S
(rp;)126 1824 A
5850 V
(07190)210 648 A
(return;)294 1362 A
5940 V
(07191)210 648 A
1110(})S
6030 V
(07192)210 648 A
1110(if)S
1236(\()S
(\(rp)126 1320 A
1488(=)S
(rdy_head[SERVER_Q]\))798 1572 A
2412(!=)S
(NIL_PROC\))378 2538 A
2958({)S
6120 V
(07193)210 648 A
(proc_ptr)336 1362 A
1740(=)S
(rp;)126 1824 A
6210 V
(07194)210 648 A
(return;)294 1362 A
8418 V
EP
%%Page: 87 87
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2049(File:)S
2282(src/kernel/proc.c)S
12 B
4308(87)S
900 V
7 LST
(07195)210 648 A
1110(})S
990 V
(07196)210 648 A
1110(if)S
1236(\()S
(\(rp)126 1320 A
1488(=)S
(rdy_head[USER_Q]\))714 1572 A
2328(!=)S
(NIL_PROC\))378 2454 A
2874({)S
1080 V
(07197)210 648 A
(proc_ptr)336 1362 A
1740(=)S
(rp;)126 1824 A
1170 V
(07198)210 648 A
(bill_ptr)336 1362 A
1740(=)S
(rp;)126 1824 A
1260 V
(07199)210 648 A
(return;)294 1362 A
1350 V
(07200)210 648 A
1110(})S
1440 V
(07201)210 648 A
1110(/*)S
1236(No)S
(one)126 1362 A
1530(is)S
(ready.)252 1656 A
(Run)126 1992 A
(the)126 2160 A
(idle)168 2328 A
(task.)210 2538 A
(The)126 2832 A
(idle)168 3000 A
(task)168 3210 A
(might)210 3420 A
3672(be)S
(made)168 3798 A
4008(an)S
1530 V
(07202)210 648 A
1152(*)S
(always-ready)504 1236 A
(user)168 1782 A
(task)168 1992 A
2202(to)S
(avoid)210 2328 A
(this)168 2580 A
(special)294 2790 A
(case.)210 3126 A
1620 V
(07203)210 648 A
1152(*/)S
1710 V
(07204)210 648 A
(bill_ptr)336 1110 A
1488(=)S
(proc_ptr)336 1572 A
1950(=)S
(proc_addr\(IDLE\);)672 2034 A
1800 V
(07205)210 648 A
1026(})S
1980 V
(07207)210 648 A
(/*===========================================================================*)3276 1026 A
2070 V
(07208)210 648 A
1068(*)S
(ready)210 2370 A
4260(*)S
2160 V
(07209)210 648 A
(*===========================================================================*/)3276 1068 A
2250 V
(07210)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(ready\(rp\))378 1572 A
2340 V
(07211)210 648 A
(register)336 1026 A
(struct)252 1404 A
(proc)168 1698 A
(*rp;)168 1908 A
2370(/*)S
(this)168 2496 A
(process)294 2706 A
3042(is)S
(now)126 3168 A
(runnable)336 3336 A
3714(*/)S
2430 V
(07212)210 648 A
1026({)S
2520 V
(07213)210 648 A
1026(/*)S
(Add)126 1152 A
('rp')168 1320 A
1530(to)S
(the)126 1656 A
(end)126 1824 A
1992(of)S
(one)126 2118 A
2286(of)S
(the)126 2412 A
(queues)252 2580 A
2874(of)S
(runnable)336 3000 A
(processes.)420 3378 A
(Three)210 3840 A
2610 V
(07214)210 648 A
1068(*)S
(queues)252 1152 A
(are)126 1446 A
(maintained:)462 1614 A
2700 V
(07215)210 648 A
1068(*)S
(TASK_Q)252 1236 A
1614(-)S
(\(highest)336 1698 A
(priority\))378 2076 A
(for)126 2496 A
(runnable)336 2664 A
(tasks)210 3042 A
2790 V
(07216)210 648 A
1068(*)S
(SERVER_Q)336 1236 A
1614(-)S
(\(middle)294 1698 A
(priority\))378 2034 A
(for)126 2454 A
2622(MM)S
(and)126 2748 A
2916(FS)S
(only)168 3042 A
2880 V
(07217)210 648 A
1068(*)S
(USER_Q)252 1236 A
1614(-)S
(\(lowest)294 1698 A
(priority\))378 2034 A
(for)126 2454 A
(user)168 2622 A
(processes)378 2832 A
2970 V
(07218)210 648 A
1068(*/)S
3060 V
(07219)210 648 A
3150 V
(07220)210 648 A
1110(if)S
(\(istaskp\(rp\)\))546 1236 A
1824({)S
3240 V
(07221)210 648 A
1362(if)S
(\(rdy_head[TASK_Q])714 1488 A
2244(!=)S
(NIL_PROC\))378 2370 A
3330 V
(07222)210 648 A
1698(/*)S
(Add)126 1824 A
1992(to)S
(tail)168 2118 A
2328(of)S
(nonempty)336 2454 A
(queue.)252 2832 A
3126(*/)S
3420 V
(07223)210 648 A
(rdy_tail[TASK_Q]->p_nextready)1218 1698 A
2958(=)S
(rp;)126 3042 A
3510 V
(07224)210 648 A
(else)168 1362 A
1572({)S
3600 V
(07225)210 648 A
(proc_ptr)336 1698 A
2076(=)S
2706(/*)S
(run)126 2832 A
(fresh)210 3000 A
(task)168 3252 A
(next)168 3462 A
3672(*/)S
3690 V
(07226)210 648 A
(rdy_head[TASK_Q])672 1698 A
2412(=)S
(rp;)126 2496 A
2706(/*)S
(add)126 2832 A
3000(to)S
(empty)210 3126 A
(queue)210 3378 A
3630(*/)S
3780 V
(07227)210 648 A
1362(})S
3870 V
(07228)210 648 A
(rdy_tail[TASK_Q])672 1362 A
2076(=)S
(rp;)126 2160 A
3960 V
(07229)210 648 A
(rp->p_nextready)630 1362 A
2034(=)S
(NIL_PROC;)378 2118 A
2706(/*)S
(new)126 2832 A
(entry)210 3000 A
(has)126 3252 A
3420(no)S
(successor)378 3546 A
3966(*/)S
4050 V
(07230)210 648 A
(return;)294 1362 A
4140 V
(07231)210 648 A
1110(})S
4230 V
(07232)210 648 A
1110(if)S
(\(!isuserp\(rp\)\))588 1236 A
1866({)S
2370(/*)S
(others)252 2496 A
(are)126 2790 A
(similar)294 2958 A
3294(*/)S
4320 V
(07233)210 648 A
1362(if)S
(\(rdy_head[SERVER_Q])798 1488 A
2328(!=)S
(NIL_PROC\))378 2454 A
4410 V
(07234)210 648 A
(rdy_tail[SERVER_Q]->p_nextready)1302 1698 A
3042(=)S
(rp;)126 3126 A
4500 V
(07235)210 648 A
(else)168 1362 A
4590 V
(07236)210 648 A
(rdy_head[SERVER_Q])756 1698 A
2496(=)S
(rp;)126 2580 A
4680 V
(07237)210 648 A
(rdy_tail[SERVER_Q])756 1362 A
2160(=)S
(rp;)126 2244 A
4770 V
(07238)210 648 A
(rp->p_nextready)630 1362 A
2034(=)S
(NIL_PROC;)378 2118 A
4860 V
(07239)210 648 A
(return;)294 1362 A
4950 V
(07240)210 648 A
1110(})S
5040 V
(07241)210 648 A
1110(if)S
(\(rdy_head[USER_Q])714 1236 A
1992(==)S
(NIL_PROC\))378 2118 A
5130 V
(07242)210 648 A
(rdy_tail[USER_Q])672 1362 A
2076(=)S
(rp;)126 2160 A
5220 V
(07243)210 648 A
(rp->p_nextready)630 1110 A
1782(=)S
(rdy_head[USER_Q];)714 1866 A
5310 V
(07244)210 648 A
(rdy_head[USER_Q])672 1110 A
1824(=)S
(rp;)126 1908 A
5400 V
(07245)210 648 A
1026(/*)S
5490 V
(07246)210 648 A
1110(if)S
(\(rdy_head[USER_Q])714 1236 A
1992(!=)S
(NIL_PROC\))378 2118 A
5580 V
(07247)210 648 A
(rdy_tail[USER_Q]->p_nextready)1218 1362 A
2622(=)S
(rp;)126 2706 A
5670 V
(07248)210 648 A
(else)168 1110 A
5760 V
(07249)210 648 A
(rdy_head[USER_Q])672 1362 A
2076(=)S
(rp;)126 2160 A
5850 V
(07250)210 648 A
(rdy_tail[USER_Q])672 1110 A
1824(=)S
(rp;)126 1908 A
5940 V
(07251)210 648 A
(rp->p_nextready)630 1110 A
1782(=)S
(NIL_PROC;)378 1866 A
6030 V
(07252)210 648 A
1026(*/)S
6120 V
(07253)210 648 A
1026(})S
8418 V
EP
%%Page: 88 88
BP
/slant 0 def
/height 0 def
630 V
12 B
648(88)S
11 R
2049(File:)S
2282(src/kernel/proc.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(07255)210 648 A
(/*===========================================================================*)3276 1026 A
990 V
(07256)210 648 A
1068(*)S
(unready)294 2370 A
4260(*)S
1080 V
(07257)210 648 A
(*===========================================================================*/)3276 1068 A
1170 V
(07258)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(unready\(rp\))462 1572 A
1260 V
(07259)210 648 A
(register)336 1026 A
(struct)252 1404 A
(proc)168 1698 A
(*rp;)168 1908 A
2370(/*)S
(this)168 2496 A
(process)294 2706 A
3042(is)S
3168(no)S
(longer)252 3294 A
(runnable)336 3588 A
3966(*/)S
1350 V
(07260)210 648 A
1026({)S
1440 V
(07261)210 648 A
1026(/*)S
1152(A)S
(process)294 1236 A
(has)126 1572 A
(blocked.)336 1740 A
2118(*/)S
1530 V
(07262)210 648 A
1620 V
(07263)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*xp;)168 1992 A
1710 V
(07264)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(**qtail;)336 1992 A
2412(/*)S
(TASK_Q,)294 2538 A
(SERVER_Q,)378 2874 A
3294(or)S
(USER_Q)252 3420 A
(rdy_tail)336 3714 A
4092(*/)S
1800 V
(07265)210 648 A
1890 V
(07266)210 648 A
1110(if)S
(\(istaskp\(rp\)\))546 1236 A
1824({)S
1980 V
(07267)210 648 A
1362(/*)S
(task)168 1488 A
(stack)210 1698 A
(still)210 1950 A
(ok?)126 2202 A
2370(*/)S
2070 V
(07268)210 648 A
1362(if)S
(\(*rp->p_stguard)630 1488 A
2160(!=)S
(STACK_GUARD\))504 2286 A
2160 V
(07269)210 648 A
(panic\("stack)504 1698 A
(overrun)294 2244 A
2580(by)S
(task",)252 2706 A
(proc_number\(rp\)\);)714 3000 A
2250 V
(07270)210 648 A
2340 V
(07271)210 648 A
1362(if)S
1488(\()S
(\(xp)126 1572 A
1740(=)S
(rdy_head[TASK_Q]\))714 1824 A
2580(==)S
(NIL_PROC\))378 2706 A
(return;)294 3126 A
2430 V
(07272)210 648 A
1362(if)S
(\(xp)126 1488 A
1656(==)S
(rp\))126 1782 A
1950({)S
2520 V
(07273)210 648 A
1698(/*)S
(Remove)252 1824 A
(head)168 2118 A
2328(of)S
(queue)210 2454 A
2706(*/)S
2610 V
(07274)210 648 A
(rdy_head[TASK_Q])672 1698 A
2412(=)S
(xp->p_nextready;)672 2496 A
2700 V
(07275)210 648 A
1698(if)S
(\(rp)126 1824 A
1992(==)S
(proc_ptr\))378 2118 A
(pick_proc\(\);)504 2538 A
2790 V
(07276)210 648 A
(return;)294 1698 A
2880 V
(07277)210 648 A
1362(})S
2970 V
(07278)210 648 A
(qtail)210 1362 A
1614(=)S
(&rdy_tail[TASK_Q];)756 1698 A
3060 V
(07279)210 648 A
1110(})S
3150 V
(07280)210 648 A
(else)168 1110 A
1320(if)S
(\(!isuserp\(rp\)\))588 1446 A
2076({)S
3240 V
(07281)210 648 A
1362(if)S
1488(\()S
(\(xp)126 1572 A
1740(=)S
(rdy_head[SERVER_Q]\))798 1824 A
2664(==)S
(NIL_PROC\))378 2790 A
(return;)294 3210 A
3330 V
(07282)210 648 A
1362(if)S
(\(xp)126 1488 A
1656(==)S
(rp\))126 1782 A
1950({)S
3420 V
(07283)210 648 A
(rdy_head[SERVER_Q])756 1698 A
2496(=)S
(xp->p_nextready;)672 2580 A
3510 V
(07284)210 648 A
(pick_proc\(\);)504 1698 A
3600 V
(07285)210 648 A
(return;)294 1698 A
3690 V
(07286)210 648 A
1362(})S
3780 V
(07287)210 648 A
(qtail)210 1362 A
1614(=)S
(&rdy_tail[SERVER_Q];)840 1698 A
3870 V
(07288)210 648 A
1110(})S
(else)168 1194 A
3960 V
(07289)210 648 A
1110({)S
4050 V
(07290)210 648 A
1362(if)S
1488(\()S
(\(xp)126 1572 A
1740(=)S
(rdy_head[USER_Q]\))714 1824 A
2580(==)S
(NIL_PROC\))378 2706 A
(return;)294 3126 A
4140 V
(07291)210 648 A
1362(if)S
(\(xp)126 1488 A
1656(==)S
(rp\))126 1782 A
1950({)S
4230 V
(07292)210 648 A
(rdy_head[USER_Q])672 1698 A
2412(=)S
(xp->p_nextready;)672 2496 A
4320 V
(07293)210 648 A
(pick_proc\(\);)504 1698 A
4410 V
(07294)210 648 A
(return;)294 1698 A
4500 V
(07295)210 648 A
1362(})S
4590 V
(07296)210 648 A
(qtail)210 1362 A
1614(=)S
(&rdy_tail[USER_Q];)756 1698 A
4680 V
(07297)210 648 A
1110(})S
4770 V
(07298)210 648 A
4860 V
(07299)210 648 A
1110(/*)S
(Search)252 1236 A
(body)168 1530 A
1740(of)S
(queue.)252 1866 A
2202(A)S
(process)294 2286 A
(can)126 2622 A
2790(be)S
(made)168 2916 A
(unready)294 3126 A
(even)168 3462 A
3672(if)S
3798(it)S
3924(is)S
4950 V
(07300)210 648 A
1152(*)S
(not)126 1236 A
(running)294 1404 A
1740(by)S
(being)210 1866 A
(sent)168 2118 A
2328(a)S
(signal)252 2412 A
(that)168 2706 A
(kills)210 2916 A
(it.)126 3168 A
5040 V
(07301)210 648 A
1152(*/)S
5130 V
(07302)210 648 A
(while)210 1110 A
(\(xp->p_nextready)672 1362 A
2076(!=)S
(rp\))126 2202 A
5220 V
(07303)210 648 A
1362(if)S
1488(\()S
(\(xp)126 1572 A
1740(=)S
(xp->p_nextready\))672 1824 A
2538(==)S
(NIL_PROC\))378 2664 A
(return;)294 3084 A
5310 V
(07304)210 648 A
(xp->p_nextready)630 1110 A
1782(=)S
(xp->p_nextready->p_nextready;)1218 1866 A
5400 V
(07305)210 648 A
1110(if)S
(\(*qtail)294 1236 A
1572(==)S
(rp\))126 1698 A
(*qtail)252 1866 A
2160(=)S
(xp;)126 2244 A
5490 V
(07306)210 648 A
1026(})S
5670 V
(07308)210 648 A
(/*===========================================================================*)3276 1026 A
5760 V
(07309)210 648 A
1068(*)S
(sched)210 2370 A
4260(*)S
5850 V
(07310)210 648 A
(*===========================================================================*/)3276 1068 A
5940 V
(07311)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(sched\(\))294 1572 A
6030 V
(07312)210 648 A
1026({)S
6120 V
(07313)210 648 A
1026(/*)S
(The)126 1152 A
(current)294 1320 A
(process)294 1656 A
(has)126 1992 A
(run)126 2160 A
(too)126 2328 A
(long.)210 2496 A
2790(If)S
(another)294 2916 A
(low)126 3252 A
(priority)336 3420 A
(\(user\))252 3798 A
6210 V
(07314)210 648 A
1068(*)S
(process)294 1152 A
1488(is)S
(runnable,)378 1614 A
(put)126 2034 A
(the)126 2202 A
(current)294 2370 A
(process)294 2706 A
3042(on)S
(the)126 3168 A
(end)126 3336 A
3504(of)S
(the)126 3630 A
(user)168 3798 A
(queue,)252 4008 A
8418 V
EP
%%Page: 89 89
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2049(File:)S
2282(src/kernel/proc.c)S
12 B
4308(89)S
900 V
7 LST
(07315)210 648 A
1068(*)S
(possibly)336 1152 A
(promoting)378 1530 A
(another)294 1950 A
(user)168 2286 A
2496(to)S
(head)168 2622 A
2832(of)S
(the)126 2958 A
(queue.)252 3126 A
990 V
(07316)210 648 A
1068(*/)S
1080 V
(07317)210 648 A
1170 V
(07318)210 648 A
1110(if)S
(\(rdy_head[USER_Q])714 1236 A
1992(==)S
(NIL_PROC\))378 2118 A
(return;)294 2538 A
1260 V
(07319)210 648 A
1350 V
(07320)210 648 A
1110(/*)S
(One)126 1236 A
1404(or)S
(more)168 1530 A
(user)168 1740 A
(processes)378 1950 A
(queued.)294 2370 A
2706(*/)S
1440 V
(07321)210 648 A
(rdy_tail[USER_Q]->p_nextready)1218 1110 A
2370(=)S
(rdy_head[USER_Q];)714 2454 A
1530 V
(07322)210 648 A
(rdy_tail[USER_Q])672 1110 A
1824(=)S
(rdy_head[USER_Q];)714 1908 A
1620 V
(07323)210 648 A
(rdy_head[USER_Q])672 1110 A
1824(=)S
(rdy_head[USER_Q]->p_nextready;)1260 1908 A
1710 V
(07324)210 648 A
(rdy_tail[USER_Q]->p_nextready)1218 1110 A
2370(=)S
(NIL_PROC;)378 2454 A
1800 V
(07325)210 648 A
(pick_proc\(\);)504 1110 A
1890 V
(07326)210 648 A
1026(})S
2070 V
(07328)210 648 A
(/*==========================================================================*)3234 1026 A
2160 V
(07329)210 648 A
1068(*)S
(lock_mini_send)588 2370 A
4218(*)S
2250 V
(07330)210 648 A
(*==========================================================================*/)3234 1068 A
2340 V
(07331)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(lock_mini_send\(caller_ptr,)1092 1488 A
(dest,)210 2622 A
(m_ptr\))252 2874 A
2430 V
(07332)210 648 A
(struct)252 1026 A
(proc)168 1320 A
(*caller_ptr;)504 1530 A
2370(/*)S
(who)126 2496 A
2664(is)S
(trying)252 2790 A
3084(to)S
(send)168 3210 A
3420(a)S
(message?)336 3504 A
3882(*/)S
2520 V
(07333)210 648 A
(int)126 1026 A
(dest;)210 1194 A
2370(/*)S
2496(to)S
(whom)168 2622 A
2832(is)S
(message)294 2958 A
(being)210 3294 A
(sent?)210 3546 A
3798(*/)S
2610 V
(07334)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
(buffer)252 3294 A
3588(*/)S
2700 V
(07335)210 648 A
1026({)S
2790 V
(07336)210 648 A
1026(/*)S
(Safe)168 1152 A
(gateway)294 1362 A
1698(to)S
(mini_send\(\))462 1824 A
(for)126 2328 A
(tasks.)252 2496 A
2790(*/)S
2880 V
(07337)210 648 A
2970 V
(07338)210 648 A
(int)126 1110 A
(result;)294 1278 A
3060 V
(07339)210 648 A
3150 V
(07340)210 648 A
(switching)378 1110 A
1530(=)S
(TRUE;)210 1614 A
3240 V
(07341)210 648 A
(result)252 1110 A
1404(=)S
(mini_send\(caller_ptr,)882 1488 A
(dest,)210 2412 A
(m_ptr\);)294 2664 A
3330 V
(07342)210 648 A
(switching)378 1110 A
1530(=)S
(FALSE;)252 1614 A
3420 V
(07343)210 648 A
(return\(result\);)630 1110 A
3510 V
(07344)210 648 A
1026(})S
3690 V
(07346)210 648 A
(/*==========================================================================*)3234 1026 A
3780 V
(07347)210 648 A
1068(*)S
(lock_pick_proc)588 2370 A
4218(*)S
3870 V
(07348)210 648 A
(*==========================================================================*/)3234 1068 A
3960 V
(07349)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(lock_pick_proc\(\))672 1530 A
4050 V
(07350)210 648 A
1026({)S
4140 V
(07351)210 648 A
1026(/*)S
(Safe)168 1152 A
(gateway)294 1362 A
1698(to)S
(pick_proc\(\))462 1824 A
(for)126 2328 A
(tasks.)252 2496 A
2790(*/)S
4230 V
(07352)210 648 A
4320 V
(07353)210 648 A
(switching)378 1110 A
1530(=)S
(TRUE;)210 1614 A
4410 V
(07354)210 648 A
(pick_proc\(\);)504 1110 A
4500 V
(07355)210 648 A
(switching)378 1110 A
1530(=)S
(FALSE;)252 1614 A
4590 V
(07356)210 648 A
1026(})S
4770 V
(07358)210 648 A
(/*==========================================================================*)3234 1026 A
4860 V
(07359)210 648 A
1068(*)S
(lock_ready)420 2370 A
4218(*)S
4950 V
(07360)210 648 A
(*==========================================================================*/)3234 1068 A
5040 V
(07361)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(lock_ready\(rp\))588 1530 A
5130 V
(07362)210 648 A
(struct)252 1026 A
(proc)168 1320 A
(*rp;)168 1530 A
2370(/*)S
(this)168 2496 A
(process)294 2706 A
3042(is)S
(now)126 3168 A
(runnable)336 3336 A
3714(*/)S
5220 V
(07363)210 648 A
1026({)S
5310 V
(07364)210 648 A
1026(/*)S
(Safe)168 1152 A
(gateway)294 1362 A
1698(to)S
(ready\(\))294 1824 A
(for)126 2160 A
(tasks.)252 2328 A
2622(*/)S
5400 V
(07365)210 648 A
5490 V
(07366)210 648 A
(switching)378 1110 A
1530(=)S
(TRUE;)210 1614 A
5580 V
(07367)210 648 A
(ready\(rp\);)420 1110 A
5670 V
(07368)210 648 A
(switching)378 1110 A
1530(=)S
(FALSE;)252 1614 A
5760 V
(07369)210 648 A
1026(})S
6030 V
(07372)210 648 A
(/*==========================================================================*)3234 1026 A
6120 V
(07373)210 648 A
1068(*)S
(lock_unready)504 2370 A
4218(*)S
6210 V
(07374)210 648 A
(*==========================================================================*/)3234 1068 A
8418 V
EP
%%Page: 90 90
BP
/slant 0 def
/height 0 def
630 V
12 B
648(90)S
11 R
2049(File:)S
2282(src/kernel/proc.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(07375)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(lock_unready\(rp\))672 1530 A
990 V
(07376)210 648 A
(struct)252 1026 A
(proc)168 1320 A
(*rp;)168 1530 A
2370(/*)S
(this)168 2496 A
(process)294 2706 A
3042(is)S
3168(no)S
(longer)252 3294 A
(runnable)336 3588 A
3966(*/)S
1080 V
(07377)210 648 A
1026({)S
1170 V
(07378)210 648 A
1026(/*)S
(Safe)168 1152 A
(gateway)294 1362 A
1698(to)S
(unready\(\))378 1824 A
(for)126 2244 A
(tasks.)252 2412 A
2706(*/)S
1260 V
(07379)210 648 A
1350 V
(07380)210 648 A
(switching)378 1110 A
1530(=)S
(TRUE;)210 1614 A
1440 V
(07381)210 648 A
(unready\(rp\);)504 1110 A
1530 V
(07382)210 648 A
(switching)378 1110 A
1530(=)S
(FALSE;)252 1614 A
1620 V
(07383)210 648 A
1026(})S
1800 V
(07385)210 648 A
(/*==========================================================================*)3234 1026 A
1890 V
(07386)210 648 A
1068(*)S
(lock_sched)420 2370 A
4218(*)S
1980 V
(07387)210 648 A
(*==========================================================================*/)3234 1068 A
2070 V
(07388)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(lock_sched\(\))504 1530 A
2160 V
(07389)210 648 A
1026({)S
2250 V
(07390)210 648 A
1026(/*)S
(Safe)168 1152 A
(gateway)294 1362 A
1698(to)S
(sched\(\))294 1824 A
(for)126 2160 A
(tasks.)252 2328 A
2622(*/)S
2340 V
(07391)210 648 A
2430 V
(07392)210 648 A
(switching)378 1110 A
1530(=)S
(TRUE;)210 1614 A
2520 V
(07393)210 648 A
(sched\(\);)336 1110 A
2610 V
(07394)210 648 A
(switching)378 1110 A
1530(=)S
(FALSE;)252 1614 A
2700 V
(07395)210 648 A
1026(})S
2880 V
(07397)210 648 A
(/*==========================================================================*)3234 1026 A
2970 V
(07398)210 648 A
1068(*)S
(unhold)252 2370 A
4218(*)S
3060 V
(07399)210 648 A
(*==========================================================================*/)3234 1068 A
3150 V
(07400)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(unhold\(\))336 1530 A
3240 V
(07401)210 648 A
1026({)S
3330 V
(07402)210 648 A
1026(/*)S
(Flush)210 1152 A
(any)126 1404 A
(held-up)294 1572 A
(interrupts.)462 1908 A
(k_reenter)378 2454 A
(must)168 2874 A
3084(be)S
3210(0.)S
(held_head)378 3378 A
(must)168 3798 A
(not)126 4008 A
3420 V
(07403)210 648 A
1068(*)S
1152(be)S
(NIL_PROC.)378 1278 A
(Interrupts)420 1740 A
(must)168 2202 A
2412(be)S
(disabled.)378 2538 A
(They)168 3000 A
(will)168 3210 A
3420(be)S
(enabled)294 3546 A
(but)126 3882 A
(will)168 4050 A
3510 V
(07404)210 648 A
1068(*)S
1152(be)S
(disabled)336 1278 A
(when)168 1656 A
(this)168 1866 A
(returns.)336 2076 A
3600 V
(07405)210 648 A
1068(*/)S
3690 V
(07406)210 648 A
3780 V
(07407)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
2370(/*)S
(current)294 2496 A
(head)168 2832 A
3042(of)S
(held)168 3168 A
(queue)210 3378 A
3630(*/)S
3870 V
(07408)210 648 A
3960 V
(07409)210 648 A
1110(if)S
(\(switching\))462 1236 A
(return;)294 1740 A
4050 V
(07410)210 648 A
1110(rp)S
1236(=)S
(held_head;)420 1320 A
4140 V
(07411)210 648 A
1110(do)S
1236({)S
4230 V
(07412)210 648 A
1362(if)S
1488(\()S
(\(held_head)420 1572 A
2034(=)S
(rp->p_nextheld\))630 2118 A
2790(==)S
(NIL_PROC\))378 2916 A
(held_tail)378 3336 A
3756(=)S
(NIL_PROC;)378 3840 A
4320 V
(07413)210 648 A
(rp->p_int_held)588 1362 A
1992(=)S
(FALSE;)252 2076 A
4410 V
(07414)210 648 A
(unlock\(\);)378 1362 A
2370(/*)S
(reduce)252 2496 A
(latency;)336 2790 A
(held)168 3168 A
(queue)210 3378 A
(may)126 3630 A
(change!)294 3798 A
4134(*/)S
4500 V
(07415)210 648 A
(interrupt\(proc_number\(rp\)\);)1134 1362 A
4590 V
(07416)210 648 A
(lock\(\);)294 1362 A
2370(/*)S
(protect)294 2496 A
(the)126 2832 A
(held)168 3000 A
(queue)210 3210 A
(again)210 3462 A
3714(*/)S
4680 V
(07417)210 648 A
1110(})S
4770 V
(07418)210 648 A
(while)210 1110 A
1362(\()S
(\(rp)126 1446 A
1614(=)S
(held_head\))420 1698 A
2160(!=)S
(NIL_PROC\);)420 2286 A
4860 V
(07419)210 648 A
1026(})S
8418 V
EP
%%Page: 91 91
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1931(File:)S
2164(src/kernel/exception.c)S
12 B
4308(91)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/kernel/exception.c)924 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(07500)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
1950(a)S
(simple)252 2034 A
(exception)378 2328 A
(handler.)336 2748 A
(Exceptions)420 3168 A
3630(in)S
(user)168 3756 A
1440 V
(07501)210 648 A
1068(*)S
(processes)378 1152 A
(are)126 1572 A
(converted)378 1740 A
2160(to)S
(signals.)336 2286 A
(Exceptions)420 2706 A
3168(in)S
(the)126 3294 A
(kernel,)294 3462 A
3798(MM)S
(and)126 3924 A
1530 V
(07502)210 648 A
1068(*)S
1152(FS)S
(cause)210 1278 A
1530(a)S
(panic.)252 1614 A
1620 V
(07503)210 648 A
1068(*/)S
1710 V
(07504)210 648 A
1800 V
(07505)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
1890 V
(07506)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
1980 V
(07507)210 648 A
(#include)336 1026 A
("proc.h")336 1404 A
2070 V
(07508)210 648 A
2160 V
(07509)210 648 A
(/*==========================================================================*)3234 1026 A
2250 V
(07510)210 648 A
1068(*)S
(exception)378 2370 A
4218(*)S
2340 V
(07511)210 648 A
(*==========================================================================*/)3234 1068 A
2430 V
(07512)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(exception\(vec_nr\))714 1530 A
2520 V
(07513)210 648 A
(unsigned)336 1026 A
(vec_nr;)294 1404 A
2610 V
(07514)210 648 A
1026({)S
2700 V
(07515)210 648 A
1026(/*)S
1152(An)S
(exception)378 1278 A
1698(or)S
(unexpected)420 1824 A
(interrupt)378 2286 A
(has)126 2706 A
(occurred.)378 2874 A
3294(*/)S
2790 V
(07516)210 648 A
2880 V
(07517)210 648 A
(struct)252 1110 A
(ex_s)168 1404 A
1614({)S
2970 V
(07518)210 648 A
(char)168 1362 A
(*msg;)210 1572 A
3060 V
(07519)210 648 A
(int)126 1362 A
(signum;)294 1530 A
3150 V
(07520)210 648 A
(int)126 1362 A
(minprocessor;)546 1530 A
3240 V
(07521)210 648 A
1110(};)S
3330 V
(07522)210 648 A
(static)252 1110 A
(struct)252 1404 A
(ex_s)168 1698 A
(ex_data[])378 1908 A
2328(=)S
2412({)S
3420 V
(07523)210 648 A
("Divide)294 1362 A
(error",)294 1698 A
(SIGFPE,)294 2034 A
(86,)126 2370 A
3510 V
(07524)210 648 A
("Debug)252 1362 A
(exception",)462 1656 A
(SIGTRAP,)336 2160 A
(86,)126 2538 A
3600 V
(07525)210 648 A
("Nonmaskable)504 1362 A
(interrupt",)462 1908 A
(SIGBUS,)294 2412 A
(86,)126 2748 A
3690 V
(07526)210 648 A
("Breakpoint",)546 1362 A
(SIGEMT,)294 1950 A
(86,)126 2286 A
3780 V
(07527)210 648 A
("Overflow",)462 1362 A
(SIGFPE,)294 1866 A
(86,)126 2202 A
3870 V
(07528)210 648 A
("Bounds)294 1362 A
(check",)294 1698 A
(SIGFPE,)294 2034 A
(186,)168 2370 A
3960 V
(07529)210 648 A
("Invalid)336 1362 A
(opcode",)336 1740 A
(SIGILL,)294 2118 A
(186,)168 2454 A
4050 V
(07530)210 648 A
("Coprocessor)504 1362 A
(not)126 1908 A
(available",)462 2076 A
(SIGFPE,)294 2580 A
(186,)168 2916 A
4140 V
(07531)210 648 A
("Double)294 1362 A
(fault",)294 1698 A
(SIGBUS,)294 2034 A
(286,)168 2370 A
4230 V
(07532)210 648 A
("Copressor)420 1362 A
(segment)294 1824 A
(overrun",)378 2160 A
(SIGSEGV,)336 2580 A
(286,)168 2958 A
4320 V
(07533)210 648 A
("Invalid)336 1362 A
(TSS",)210 1740 A
(SIGSEGV,)336 1992 A
(286,)168 2370 A
4410 V
(07534)210 648 A
("Segment)336 1362 A
(not)126 1740 A
(present",)378 1908 A
(SIGSEGV,)336 2328 A
(286,)168 2706 A
4500 V
(07535)210 648 A
("Stack)252 1362 A
(exception",)462 1656 A
(SIGSEGV,)336 2160 A
(286,)168 2538 A
3042(/*)S
(STACK_FAULT)462 3168 A
(already)294 3672 A
(used)168 4008 A
4218(*/)S
4590 V
(07536)210 648 A
("General)336 1362 A
(protection",)504 1740 A
(SIGSEGV,)336 2286 A
(286,)168 2664 A
4680 V
(07537)210 648 A
("Page)210 1362 A
(fault",)294 1614 A
(SIGSEGV,)336 1950 A
(386,)168 2328 A
3042(/*)S
(not)126 3168 A
(close)210 3336 A
3588(*/)S
4770 V
(07538)210 648 A
(NIL_PTR,)336 1362 A
(SIGILL,)294 1740 A
2076(0,)S
3042(/*)S
(probably)336 3168 A
(software)336 3546 A
(trap)168 3924 A
4134(*/)S
4860 V
(07539)210 648 A
("Coprocessor)504 1362 A
(error",)294 1908 A
(SIGFPE,)294 2244 A
(386,)168 2580 A
4950 V
(07540)210 648 A
1110(};)S
5040 V
(07541)210 648 A
(register)336 1110 A
(struct)252 1488 A
(ex_s)168 1782 A
(*ep;)168 1992 A
5130 V
(07542)210 648 A
(struct)252 1110 A
(proc)168 1404 A
(*saved_proc;)504 1614 A
5220 V
(07543)210 648 A
5310 V
(07544)210 648 A
(saved_proc=)462 1110 A
(proc_ptr;)378 1614 A
2034(/*)S
(Save)168 2160 A
(proc_ptr,)378 2370 A
(because)294 2790 A
3126(it)S
(may)126 3252 A
3420(be)S
(changed)294 3546 A
3882(by)S
(debug)210 4008 A
5400 V
(07545)210 648 A
2076(*)S
(statements.)462 2160 A
5490 V
(07546)210 648 A
2076(*/)S
5580 V
(07547)210 648 A
5670 V
(07548)210 648 A
1110(ep)S
1236(=)S
(&ex_data[vec_nr];)714 1320 A
5760 V
(07549)210 648 A
5850 V
(07550)210 648 A
1110(if)S
(\(vec_nr)294 1236 A
1572(==)S
1698(2\))S
1824({)S
2370(/*)S
(spurious)336 2496 A
(NMI)126 2874 A
3042(on)S
(some)168 3168 A
(machines)336 3378 A
3756(*/)S
5940 V
(07551)210 648 A
(printf\("got)462 1362 A
(spurious)336 1866 A
(NMI\\n"\);)336 2244 A
6030 V
(07552)210 648 A
(return;)294 1362 A
6120 V
(07553)210 648 A
1110(})S
6210 V
(07554)210 648 A
8418 V
EP
%%Page: 92 92
BP
/slant 0 def
/height 0 def
630 V
12 B
648(92)S
11 R
1931(File:)S
2164(src/kernel/exception.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(07555)210 648 A
1110(if)S
(\(k_reenter)420 1236 A
1698(==)S
1824(0)S
1908(&&)S
(isuserp\(saved_proc\)\))840 2034 A
2916({)S
990 V
(07556)210 648 A
(unlock\(\);)378 1362 A
2370(/*)S
(this)168 2496 A
2706(is)S
(protected)378 2832 A
(like)168 3252 A
(sys_call\(\))420 3462 A
3924(*/)S
1080 V
(07557)210 648 A
(cause_sig\(proc_number\(saved_proc\),)1428 1362 A
(ep->signum\);)504 2832 A
1170 V
(07558)210 648 A
(return;)294 1362 A
1260 V
(07559)210 648 A
1110(})S
1350 V
(07560)210 648 A
1440 V
(07561)210 648 A
1110(/*)S
(This)168 1236 A
1446(is)S
(not)126 1572 A
(supposed)336 1740 A
2118(to)S
(happen.)294 2244 A
2580(*/)S
1530 V
(07562)210 648 A
1110(if)S
(\(ep->msg)336 1236 A
1614(==)S
(NIL_PTR)294 1740 A
2076(||)S
(processor)378 2202 A
2622(<)S
(ep->minprocessor\))714 2706 A
1620 V
(07563)210 648 A
(printf\("\\nIntel-reserved)1008 1362 A
(exception)378 2412 A
(%d\\n",)252 2832 A
(vec_nr\);)336 3126 A
1710 V
(07564)210 648 A
(else)168 1110 A
1800 V
(07565)210 648 A
(printf\("\\n%s\\n",)672 1362 A
(ep->msg\);)378 2076 A
1890 V
(07566)210 648 A
(printf\("process)630 1110 A
(number)252 1782 A
(%d,)126 2076 A
2244(pc)S
2370(=)S
(0x%04x:0x%08x\\n",)714 2454 A
1980 V
(07567)210 648 A
(proc_number\(saved_proc\),)1008 1362 A
2070 V
(07568)210 648 A
(\(unsigned\))420 1362 A
(saved_proc->p_reg.cs,)882 1824 A
2160 V
(07569)210 648 A
(\(unsigned\))420 1362 A
(saved_proc->p_reg.pc\);)924 1824 A
2250 V
(07570)210 648 A
(panic\("exception)672 1110 A
1824(in)S
(system)252 1950 A
(code",)252 2244 A
(NO_NUM\);)336 2538 A
2340 V
(07571)210 648 A
1026(})S
2790 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2880 V
(src/kernel/i8259.c)756 2034 A
2970 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3150 V
(07600)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(routines)336 1950 A
(for)126 2328 A
(initializing)504 2496 A
(the)126 3042 A
(8259)168 3210 A
(interrupt)378 3420 A
(controller:)462 3840 A
3240 V
(07601)210 648 A
1068(*)S
(get_irq_handler:)672 1362 A
(address)294 2076 A
2412(of)S
(handler)294 2538 A
(for)126 2874 A
3042(a)S
(given)210 3126 A
(interrupt)378 3378 A
3330 V
(07602)210 648 A
1068(*)S
(put_irq_handler:)672 1362 A
(register)336 2076 A
2454(an)S
(interrupt)378 2580 A
(handler)294 3000 A
3420 V
(07603)210 648 A
1068(*)S
(intr_init:)420 1362 A
(initialize)420 2034 A
(the)126 2496 A
(interrupt)378 2664 A
(controller\(s\))546 3084 A
3510 V
(07604)210 648 A
1068(*/)S
3600 V
(07605)210 648 A
3690 V
(07606)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
3780 V
(07607)210 648 A
3870 V
(07608)210 648 A
(#define)294 1026 A
(ICW1_AT)294 1362 A
(0x11)168 2034 A
2370(/*)S
(edge)168 2496 A
(triggered,)420 2706 A
(cascade,)336 3168 A
(need)168 3546 A
(ICW4)168 3756 A
3966(*/)S
3960 V
(07609)210 648 A
(#define)294 1026 A
(ICW1_PC)294 1362 A
(0x13)168 2034 A
2370(/*)S
(edge)168 2496 A
(triggered,)420 2706 A
3168(no)S
(cascade,)336 3294 A
(need)168 3672 A
(ICW4)168 3882 A
4092(*/)S
4050 V
(07610)210 648 A
(#define)294 1026 A
(ICW1_PS)294 1362 A
(0x19)168 2034 A
2370(/*)S
(level)210 2496 A
(triggered,)420 2748 A
(cascade,)336 3210 A
(need)168 3588 A
(ICW4)168 3798 A
4008(*/)S
4140 V
(07611)210 648 A
(#define)294 1026 A
(ICW4_AT)294 1362 A
(0x01)168 2034 A
2370(/*)S
(not)126 2496 A
(SFNM,)210 2664 A
(not)126 2916 A
(buffered,)378 3084 A
(normal)252 3504 A
(EOI,)168 3798 A
(8086)168 4008 A
4218(*/)S
4230 V
(07612)210 648 A
(#define)294 1026 A
(ICW4_PC)294 1362 A
(0x09)168 2034 A
2370(/*)S
(not)126 2496 A
(SFNM,)210 2664 A
(buffered,)378 2916 A
(normal)252 3336 A
(EOI,)168 3630 A
(8086)168 3840 A
4050(*/)S
4320 V
(07613)210 648 A
4410 V
(07614)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(spurious_irq,)546 2034 A
(\(int)168 2622 A
(irq\))168 2832 A
3042(\);)S
4500 V
(07615)210 648 A
4590 V
(07616)210 648 A
(#define)294 1026 A
(set_vec\(nr,)462 1362 A
(addr\))210 1866 A
(\(\(void\)0\))378 2370 A
2790(/*)S
(kluge)210 2916 A
(for)126 3168 A
(protected)378 3336 A
(mode)168 3756 A
3966(*/)S
4680 V
(07617)210 648 A
4770 V
(07618)210 648 A
(/*==========================================================================*)3234 1026 A
4860 V
(07619)210 648 A
1068(*)S
(intr_init)378 2370 A
4218(*)S
4950 V
(07620)210 648 A
(*==========================================================================*/)3234 1068 A
5040 V
(07621)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(intr_init\(mine\))630 1530 A
5130 V
(07622)210 648 A
(int)126 1026 A
(mine;)210 1194 A
5220 V
(07623)210 648 A
1026({)S
5310 V
(07624)210 648 A
1026(/*)S
(Initialize)420 1152 A
(the)126 1614 A
(8259s,)252 1782 A
(finishing)378 2076 A
(with)168 2496 A
(all)126 2706 A
(interrupts)420 2874 A
(disabled.)378 3336 A
(This)168 3798 A
4008(is)S
5400 V
(07625)210 648 A
1068(*)S
(only)168 1152 A
(done)168 1362 A
1572(in)S
(protected)378 1698 A
(mode,)210 2118 A
2370(in)S
(real)168 2496 A
(mode)168 2706 A
2916(we)S
(don't)210 3042 A
(touch)210 3294 A
(the)126 3546 A
(8259s,)252 3714 A
(but)126 4008 A
5490 V
(07626)210 648 A
1068(*)S
(use)126 1152 A
(the)126 1320 A
(BIOS)168 1488 A
(locations)378 1698 A
(instead.)336 2118 A
(The)126 2538 A
(flag)168 2706 A
("mine")252 2916 A
3210(is)S
(set)126 3336 A
3504(if)S
(the)126 3630 A
(8259s)210 3798 A
(are)126 4050 A
5580 V
(07627)210 648 A
1068(*)S
1152(to)S
1278(be)S
(programmed)420 1404 A
(for)126 1866 A
(Minix,)252 2034 A
2328(or)S
2454(to)S
2580(be)S
(reset)210 2706 A
2958(to)S
(what)168 3084 A
(the)126 3294 A
(BIOS)168 3462 A
(expects.)336 3672 A
5670 V
(07628)210 648 A
1068(*/)S
5760 V
(07629)210 648 A
5850 V
(07630)210 648 A
(int)126 1110 A
1278(i;)S
5940 V
(07631)210 648 A
6030 V
(07632)210 648 A
(lock\(\);)294 1110 A
6120 V
(07633)210 648 A
1110(/*)S
(The)126 1236 A
1404(AT)S
(and)126 1530 A
(newer)210 1698 A
(PS/2)168 1950 A
(have)168 2160 A
(two)126 2370 A
(interrupt)378 2538 A
(controllers,)504 2958 A
(one)126 3504 A
(master,)294 3672 A
6210 V
(07634)210 648 A
1152(*)S
(one)126 1236 A
(slaved)252 1404 A
1698(at)S
(IRQ)126 1824 A
1992(2.)S
(\(We)126 2160 A
(don't)210 2328 A
(have)168 2580 A
2790(to)S
(deal)168 2916 A
(with)168 3126 A
(the)126 3336 A
3504(PC)S
(that)168 3630 A
8418 V
EP
%%Page: 93 93
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2022(File:)S
(src/kernel/i8259.c)799 2255 A
12 B
4308(93)S
900 V
7 LST
(07635)210 648 A
1152(*)S
(has)126 1236 A
(just)168 1404 A
(one)126 1614 A
(controller,)462 1782 A
(because)294 2286 A
2622(it)S
(must)168 2748 A
(run)126 2958 A
3126(in)S
(real)168 3252 A
(mode.\))252 3462 A
990 V
(07636)210 648 A
1152(*/)S
1080 V
(07637)210 648 A
(out_byte\(INT_CTL,)714 1110 A
(ps_mca)252 1866 A
2160(?)S
(ICW1_PS)294 2244 A
2580(:)S
(ICW1_AT\);)378 2664 A
1170 V
(07638)210 648 A
(out_byte\(INT_CTLMASK,)882 1110 A
(mine)168 2034 A
2244(?)S
(IRQ0_VECTOR)462 2328 A
2832(:)S
(BIOS_IRQ0_VEC\);)630 2916 A
1260 V
(07639)210 648 A
3042(/*)S
(ICW2)168 3168 A
(for)126 3378 A
(master)252 3546 A
3840(*/)S
1350 V
(07640)210 648 A
(out_byte\(INT_CTLMASK,)882 1110 A
2034(\(1)S
2160(<<)S
(CASCADE_IRQ\)\);)588 2286 A
3042(/*)S
(ICW3)168 3168 A
(tells)210 3378 A
(slaves)252 3630 A
3924(*/)S
1440 V
(07641)210 648 A
(out_byte\(INT_CTLMASK,)882 1110 A
(ICW4_AT\);)378 2034 A
1530 V
(07642)210 648 A
(out_byte\(INT_CTLMASK,)882 1110 A
(\304\(1)126 2034 A
2202(<<)S
(CASCADE_IRQ\)\);)588 2328 A
3042(/*)S
(IRQ)126 3168 A
(0-7)126 3336 A
(mask)168 3504 A
3714(*/)S
1620 V
(07643)210 648 A
(out_byte\(INT2_CTL,)756 1110 A
(ps_mca)252 1908 A
2202(?)S
(ICW1_PS)294 2286 A
2622(:)S
(ICW1_AT\);)378 2706 A
1710 V
(07644)210 648 A
(out_byte\(INT2_CTLMASK,)924 1110 A
(mine)168 2076 A
2286(?)S
(IRQ8_VECTOR)462 2370 A
2874(:)S
(BIOS_IRQ8_VEC\);)630 2958 A
1800 V
(07645)210 648 A
3042(/*)S
(ICW2)168 3168 A
(for)126 3378 A
(slave)210 3546 A
3798(*/)S
1890 V
(07646)210 648 A
(out_byte\(INT2_CTLMASK,)924 1110 A
(CASCADE_IRQ\);)546 2076 A
3042(/*)S
(ICW3)168 3168 A
3378(is)S
(slave)210 3504 A
3756(nr)S
3882(*/)S
1980 V
(07647)210 648 A
(out_byte\(INT2_CTLMASK,)924 1110 A
(ICW4_AT\);)378 2076 A
2070 V
(07648)210 648 A
(out_byte\(INT2_CTLMASK,)924 1110 A
(\3040\);)168 2076 A
3042(/*)S
(IRQ)126 3168 A
(8-15)168 3336 A
(mask)168 3546 A
3756(*/)S
2160 V
(07649)210 648 A
2250 V
(07650)210 648 A
1110(/*)S
(Initialize)420 1236 A
(the)126 1698 A
(table)210 1866 A
2118(of)S
(interrupt)378 2244 A
(handlers.)378 2664 A
3084(*/)S
2340 V
(07651)210 648 A
(for)126 1110 A
1278(\(i)S
1404(=)S
1488(0;)S
1614(i)S
1698(<)S
(NR_IRQ_VECTORS;)630 1782 A
(i++\))168 2454 A
(irq_table[i])504 2664 A
3210(=)S
(spurious_irq;)546 3294 A
2430 V
(07652)210 648 A
1026(})S
2610 V
(07654)210 648 A
(/*=========================================================================*)3192 1026 A
2700 V
(07655)210 648 A
1068(*)S
(spurious_irq)504 2370 A
4176(*)S
2790 V
(07656)210 648 A
(*=========================================================================*/)3192 1068 A
2880 V
(07657)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(spurious_irq\(irq\))714 1530 A
2970 V
(07658)210 648 A
(int)126 1026 A
(irq;)168 1194 A
3060 V
(07659)210 648 A
1026({)S
3150 V
(07660)210 648 A
1026(/*)S
(Default)294 1152 A
(interrupt)378 1488 A
(handler.)336 1908 A
2328(It)S
(complains)378 2454 A
2874(a)S
(lot.)168 2958 A
3168(*/)S
3240 V
(07661)210 648 A
3330 V
(07662)210 648 A
1110(if)S
(\(irq)168 1236 A
1446(<)S
1530(0)S
1614(||)S
(irq)126 1740 A
1908(>=)S
(NR_IRQ_VECTORS\))630 2034 A
3420 V
(07663)210 648 A
(panic\("invalid)588 1362 A
(call)168 1992 A
2202(to)S
(spurious_irq",)588 2328 A
(irq\);)210 2958 A
3510 V
(07664)210 648 A
3600 V
(07665)210 648 A
(printf\("spurious)672 1110 A
(irq)126 1824 A
(%d\\n",)252 1992 A
(irq\);)210 2286 A
3690 V
(07666)210 648 A
3780 V
(07667)210 648 A
(return)252 1110 A
1404(1;)S
1698(/*)S
(Reenable)336 1824 A
(interrupt)378 2202 A
2622(*/)S
3870 V
(07668)210 648 A
1026(})S
4050 V
(07670)210 648 A
(/*=========================================================================*)3192 1026 A
4140 V
(07671)210 648 A
1068(*)S
(put_irq_handler)630 2370 A
4176(*)S
4230 V
(07672)210 648 A
(*=========================================================================*/)3192 1068 A
4320 V
(07673)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(put_irq_handler\(irq,)840 1530 A
(handler\))336 2412 A
4410 V
(07674)210 648 A
(int)126 1026 A
(irq;)168 1194 A
4500 V
(07675)210 648 A
(irq_handler_t)546 1026 A
(handler;)336 1614 A
4590 V
(07676)210 648 A
1026({)S
4680 V
(07677)210 648 A
1026(/*)S
(Register)336 1152 A
1530(an)S
(interrupt)378 1656 A
(handler.)336 2076 A
2454(*/)S
4770 V
(07678)210 648 A
4860 V
(07679)210 648 A
1110(if)S
(\(irq)168 1236 A
1446(<)S
1530(0)S
1614(||)S
(irq)126 1740 A
1908(>=)S
(NR_IRQ_VECTORS\))630 2034 A
4950 V
(07680)210 648 A
(panic\("invalid)588 1362 A
(call)168 1992 A
2202(to)S
(put_irq_handler",)714 2328 A
(irq\);)210 3084 A
5040 V
(07681)210 648 A
5130 V
(07682)210 648 A
1110(if)S
(\(irq_table[irq])630 1236 A
1908(==)S
(handler\))336 2034 A
5220 V
(07683)210 648 A
(return;)294 1362 A
2034(/*)S
(extra)210 2160 A
(initialization)588 2412 A
3042(*/)S
5310 V
(07684)210 648 A
5400 V
(07685)210 648 A
1110(if)S
(\(irq_table[irq])630 1236 A
1908(!=)S
(spurious_irq\))546 2034 A
5490 V
(07686)210 648 A
(panic\("attempt)588 1362 A
1992(to)S
(register)336 2118 A
(second)252 2496 A
(irq)126 2790 A
(handler)294 2958 A
(for)126 3294 A
(irq",)210 3462 A
(irq\);)210 3714 A
5580 V
(07687)210 648 A
5670 V
(07688)210 648 A
(disable_irq\(irq\);)714 1110 A
5760 V
(07689)210 648 A
1110(if)S
(\(!protected_mode\))714 1236 A
(set_vec\(BIOS_VECTOR\(irq\),)1050 1992 A
(irq_vec[irq]\);)588 3084 A
5850 V
(07690)210 648 A
(irq_table[irq]=)630 1110 A
(handler;)336 1782 A
5940 V
(07691)210 648 A
(irq_use)294 1110 A
1446(|=)S
1572(1)S
1656(<<)S
(irq;)168 1782 A
6030 V
(07692)210 648 A
1026(})S
8418 V
EP
%%Page: 94 94
BP
/slant 0 def
/height 0 def
630 V
12 B
648(94)S
11 R
1993(File:)S
2226(src/kernel/protect.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/kernel/protect.c)840 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(07700)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(code)168 1950 A
(for)126 2160 A
(initialization)588 2328 A
2958(of)S
(protected)378 3084 A
(mode,)210 3504 A
3756(to)S
(initialize)420 3882 A
1440 V
(07701)210 648 A
1068(*)S
(code)168 1152 A
(and)126 1362 A
(data)168 1530 A
(segment)294 1740 A
(descriptors,)504 2076 A
(and)126 2622 A
2790(to)S
(initialize)420 2916 A
(global)252 3378 A
(descriptors)462 3672 A
1530 V
(07702)210 648 A
1068(*)S
(for)126 1152 A
(local)210 1320 A
(descriptors)462 1572 A
2076(in)S
(the)126 2202 A
(process)294 2370 A
(table.)252 2706 A
1620 V
(07703)210 648 A
1068(*/)S
1710 V
(07704)210 648 A
1800 V
(07705)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
1890 V
(07706)210 648 A
(#include)336 1026 A
("proc.h")336 1404 A
1980 V
(07707)210 648 A
(#include)336 1026 A
("protect.h")462 1404 A
2070 V
(07708)210 648 A
2160 V
(07709)210 648 A
(#define)294 1026 A
(INT_GATE_TYPE)546 1362 A
(\(INT_286_GATE)546 2034 A
2622(|)S
(DESC_386_BIT\))546 2706 A
2250 V
(07710)210 648 A
(#define)294 1026 A
(TSS_TYPE)336 1362 A
(\(AVL_286_TSS)504 2034 A
2622(|)S
(DESC_386_BIT\))546 2706 A
2340 V
(07711)210 648 A
2430 V
(07712)210 648 A
(struct)252 1026 A
(desctableptr_s)588 1320 A
1950({)S
2520 V
(07713)210 648 A
(char)168 1110 A
(limit[sizeof\(u16_t\)];)882 1320 A
2610 V
(07714)210 648 A
(char)168 1110 A
(base[sizeof\(u32_t\)];)840 1320 A
2706(/*)S
(really)252 2832 A
(u24_t)210 3126 A
3378(+)S
(pad)126 3462 A
(for)126 3630 A
(286)126 3798 A
3966(*/)S
2700 V
(07715)210 648 A
1026(};)S
2790 V
(07716)210 648 A
2880 V
(07717)210 648 A
(struct)252 1026 A
(gatedesc_s)420 1320 A
1782({)S
2970 V
(07718)210 648 A
(u16_t)210 1110 A
(offset_low;)462 1362 A
3060 V
(07719)210 648 A
(u16_t)210 1110 A
(selector;)378 1362 A
3150 V
(07720)210 648 A
(u8_t)168 1110 A
(pad;)168 1320 A
2370(/*)S
(|000|XXXXX|)462 2496 A
3000(ig)S
3126(&)S
(trpg,)210 3210 A
(|XXXXXXXX|)420 3462 A
(task)168 3924 A
4134(g)S
4218(*/)S
3240 V
(07721)210 648 A
(u8_t)168 1110 A
(p_dpl_type;)462 1320 A
2370(/*)S
(|P|DL|0|TYPE|)546 2496 A
3084(*/)S
3330 V
(07722)210 648 A
(u16_t)210 1110 A
(offset_high;)504 1362 A
3420 V
(07723)210 648 A
1026(};)S
3510 V
(07724)210 648 A
3600 V
(07725)210 648 A
(struct)252 1026 A
(tss_s)210 1320 A
1572({)S
3690 V
(07726)210 648 A
(reg_t)210 1110 A
(backlink;)378 1362 A
3780 V
(07727)210 648 A
(reg_t)210 1110 A
(sp0;)168 1362 A
2370(/*)S
(stack)210 2496 A
(pointer)294 2748 A
3084(to)S
(use)126 3210 A
(during)252 3378 A
(interrupt)378 3672 A
4092(*/)S
3870 V
(07728)210 648 A
(reg_t)210 1110 A
(ss0;)168 1362 A
2370(/*)S
2580(")S
(segment)294 2748 A
3126(")S
3252(")S
3462(")S
3840(")S
4092(*/)S
3960 V
(07729)210 648 A
(reg_t)210 1110 A
(sp1;)168 1362 A
4050 V
(07730)210 648 A
(reg_t)210 1110 A
(ss1;)168 1362 A
4140 V
(07731)210 648 A
(reg_t)210 1110 A
(sp2;)168 1362 A
4230 V
(07732)210 648 A
(reg_t)210 1110 A
(ss2;)168 1362 A
4320 V
(07733)210 648 A
(reg_t)210 1110 A
(cr3;)168 1362 A
4410 V
(07734)210 648 A
(reg_t)210 1110 A
(ip;)126 1362 A
4500 V
(07735)210 648 A
(reg_t)210 1110 A
(flags;)252 1362 A
4590 V
(07736)210 648 A
(reg_t)210 1110 A
(ax;)126 1362 A
4680 V
(07737)210 648 A
(reg_t)210 1110 A
(cx;)126 1362 A
4770 V
(07738)210 648 A
(reg_t)210 1110 A
(dx;)126 1362 A
4860 V
(07739)210 648 A
(reg_t)210 1110 A
(bx;)126 1362 A
4950 V
(07740)210 648 A
(reg_t)210 1110 A
(sp;)126 1362 A
5040 V
(07741)210 648 A
(reg_t)210 1110 A
(bp;)126 1362 A
5130 V
(07742)210 648 A
(reg_t)210 1110 A
(si;)126 1362 A
5220 V
(07743)210 648 A
(reg_t)210 1110 A
(di;)126 1362 A
5310 V
(07744)210 648 A
(reg_t)210 1110 A
(es;)126 1362 A
5400 V
(07745)210 648 A
(reg_t)210 1110 A
(cs;)126 1362 A
5490 V
(07746)210 648 A
(reg_t)210 1110 A
(ss;)126 1362 A
5580 V
(07747)210 648 A
(reg_t)210 1110 A
(ds;)126 1362 A
5670 V
(07748)210 648 A
(reg_t)210 1110 A
(fs;)126 1362 A
5760 V
(07749)210 648 A
(reg_t)210 1110 A
(gs;)126 1362 A
5850 V
(07750)210 648 A
(reg_t)210 1110 A
(ldt;)168 1362 A
5940 V
(07751)210 648 A
(u16_t)210 1110 A
(trap;)210 1362 A
6030 V
(07752)210 648 A
(u16_t)210 1110 A
(iobase;)294 1362 A
6120 V
(07753)210 648 A
1026(};)S
6210 V
(07754)210 648 A
8418 V
EP
%%Page: 95 95
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1993(File:)S
2226(src/kernel/protect.c)S
12 B
4308(95)S
900 V
7 LST
(07755)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(segdesc_s)378 1614 A
(gdt[GDT_SIZE];)588 2034 A
990 V
(07756)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(gatedesc_s)420 1656 A
(idt[IDT_SIZE];)588 2118 A
3042(/*)S
(zero-init)378 3168 A
3588(so)S
(none)168 3714 A
(present)294 3924 A
4260(*/)S
1080 V
(07757)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(tss_s)210 1614 A
(tss;)168 1866 A
2370(/*)S
(zero)168 2496 A
(init)168 2706 A
2916(*/)S
1170 V
(07758)210 648 A
1260 V
(07759)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(int_gate,)378 2076 A
(\(unsigned)378 2496 A
(vec_nr,)294 2916 A
(phys_bytes)420 3252 A
(base,)210 3714 A
1350 V
(07760)210 648 A
(unsigned)336 1698 A
(dpl_type\))378 2076 A
2496(\);)S
1440 V
(07761)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(sdesc,)252 2076 A
(\(struct)294 2370 A
(segdesc_s)378 2706 A
(*segdp,)294 3126 A
(phys_bytes)420 3462 A
(base,)210 3924 A
1530 V
(07762)210 648 A
(phys_bytes)420 1698 A
(size\))210 2160 A
2412(\);)S
1620 V
(07763)210 648 A
1710 V
(07764)210 648 A
(/*=========================================================================*)3192 1026 A
1800 V
(07765)210 648 A
1068(*)S
(prot_init)378 2370 A
4176(*)S
1890 V
(07766)210 648 A
(*=========================================================================*/)3192 1068 A
1980 V
(07767)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(prot_init\(\))462 1530 A
2070 V
(07768)210 648 A
1026({)S
2160 V
(07769)210 648 A
1026(/*)S
(Set)126 1152 A
1320(up)S
(tables)252 1446 A
(for)126 1740 A
(protected)378 1908 A
(mode.)210 2328 A
2250 V
(07770)210 648 A
1068(*)S
(All)126 1152 A
(GDT)126 1320 A
(slots)210 1488 A
(are)126 1740 A
(allocated)378 1908 A
2328(at)S
(compile)294 2454 A
(time.)210 2790 A
2340 V
(07771)210 648 A
1068(*/)S
2430 V
(07772)210 648 A
2520 V
(07773)210 648 A
(phys_bytes)420 1110 A
(code_bytes;)462 1572 A
2610 V
(07774)210 648 A
(phys_bytes)420 1110 A
(data_bytes;)462 1572 A
2700 V
(07775)210 648 A
(struct)252 1110 A
(gate_table_s)504 1404 A
(*gtp;)210 1950 A
2790 V
(07776)210 648 A
(struct)252 1110 A
(desctableptr_s)588 1404 A
(*dtp;)210 2034 A
2880 V
(07777)210 648 A
(unsigned)336 1110 A
(ldt_selector;)546 1488 A
2970 V
(07778)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
3060 V
(07779)210 648 A
3150 V
(07780)210 648 A
(static)252 1110 A
(struct)252 1404 A
(gate_table_s)504 1698 A
2244({)S
3240 V
(07781)210 648 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(\(*gate\),)336 2076 A
(\(void\))252 2454 A
2748(\);)S
3330 V
(07782)210 648 A
(unsigned)336 1362 A
(char)168 1740 A
(vec_nr;)294 1950 A
3420 V
(07783)210 648 A
(unsigned)336 1362 A
(char)168 1740 A
(privilege;)420 1950 A
3510 V
(07784)210 648 A
1110(})S
3600 V
(07785)210 648 A
(gate_table[])504 1110 A
1656(=)S
1740({)S
3690 V
(07786)210 648 A
(divide_error,)546 1362 A
(DIVIDE_VECTOR,)588 1950 A
(INTR_PRIVILEGE,)630 2580 A
3780 V
(07787)210 648 A
(single_step_exception,)924 1362 A
(DEBUG_VECTOR,)546 2328 A
(INTR_PRIVILEGE,)630 2916 A
3870 V
(07788)210 648 A
(nmi,)168 1362 A
(NMI_VECTOR,)462 1572 A
(INTR_PRIVILEGE,)630 2076 A
3960 V
(07789)210 648 A
(breakpoint_exception,)882 1362 A
(BREAKPOINT_VECTOR,)756 2286 A
(USER_PRIVILEGE,)630 3084 A
4050 V
(07790)210 648 A
(overflow,)378 1362 A
(OVERFLOW_VECTOR,)672 1782 A
(USER_PRIVILEGE,)630 2496 A
4140 V
(07791)210 648 A
(bounds_check,)546 1362 A
(BOUNDS_VECTOR,)588 1950 A
(INTR_PRIVILEGE,)630 2580 A
4230 V
(07792)210 648 A
(inval_opcode,)546 1362 A
(INVAL_OP_VECTOR,)672 1950 A
(INTR_PRIVILEGE,)630 2664 A
4320 V
(07793)210 648 A
(copr_not_available,)798 1362 A
(COPROC_NOT_VECTOR,)756 2202 A
(INTR_PRIVILEGE,)630 3000 A
4410 V
(07794)210 648 A
(double_fault,)546 1362 A
(DOUBLE_FAULT_VECTOR,)840 1950 A
(INTR_PRIVILEGE,)630 2832 A
4500 V
(07795)210 648 A
(copr_seg_overrun,)714 1362 A
(COPROC_SEG_VECTOR,)756 2118 A
(INTR_PRIVILEGE,)630 2916 A
4590 V
(07796)210 648 A
(inval_tss,)420 1362 A
(INVAL_TSS_VECTOR,)714 1824 A
(INTR_PRIVILEGE,)630 2580 A
4680 V
(07797)210 648 A
(segment_not_present,)840 1362 A
(SEG_NOT_VECTOR,)630 2244 A
(INTR_PRIVILEGE,)630 2916 A
4770 V
(07798)210 648 A
(stack_exception,)672 1362 A
(STACK_FAULT_VECTOR,)798 2076 A
(INTR_PRIVILEGE,)630 2916 A
4860 V
(07799)210 648 A
(general_protection,)798 1362 A
(PROTECTION_VECTOR,)756 2202 A
(INTR_PRIVILEGE,)630 3000 A
4950 V
(07800)210 648 A
(page_fault,)462 1362 A
(PAGE_FAULT_VECTOR,)756 1866 A
(INTR_PRIVILEGE,)630 2664 A
5040 V
(07801)210 648 A
(copr_error,)462 1362 A
(COPROC_ERR_VECTOR,)756 1866 A
(INTR_PRIVILEGE,)630 2664 A
5130 V
(07802)210 648 A
1362({)S
(hwint00,)336 1446 A
(VECTOR\()294 1824 A
(0\),)126 2160 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
5220 V
(07803)210 648 A
1362({)S
(hwint01,)336 1446 A
(VECTOR\()294 1824 A
(1\),)126 2160 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
5310 V
(07804)210 648 A
1362({)S
(hwint02,)336 1446 A
(VECTOR\()294 1824 A
(2\),)126 2160 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
5400 V
(07805)210 648 A
1362({)S
(hwint03,)336 1446 A
(VECTOR\()294 1824 A
(3\),)126 2160 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
5490 V
(07806)210 648 A
1362({)S
(hwint04,)336 1446 A
(VECTOR\()294 1824 A
(4\),)126 2160 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
5580 V
(07807)210 648 A
1362({)S
(hwint05,)336 1446 A
(VECTOR\()294 1824 A
(5\),)126 2160 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
5670 V
(07808)210 648 A
1362({)S
(hwint06,)336 1446 A
(VECTOR\()294 1824 A
(6\),)126 2160 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
5760 V
(07809)210 648 A
1362({)S
(hwint07,)336 1446 A
(VECTOR\()294 1824 A
(7\),)126 2160 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
5850 V
(07810)210 648 A
1362({)S
(hwint08,)336 1446 A
(VECTOR\()294 1824 A
(8\),)126 2160 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
5940 V
(07811)210 648 A
1362({)S
(hwint09,)336 1446 A
(VECTOR\()294 1824 A
(9\),)126 2160 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
6030 V
(07812)210 648 A
1362({)S
(hwint10,)336 1446 A
(VECTOR\(10\),)462 1824 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
6120 V
(07813)210 648 A
1362({)S
(hwint11,)336 1446 A
(VECTOR\(11\),)462 1824 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
6210 V
(07814)210 648 A
1362({)S
(hwint12,)336 1446 A
(VECTOR\(12\),)462 1824 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
8418 V
EP
%%Page: 96 96
BP
/slant 0 def
/height 0 def
630 V
12 B
648(96)S
11 R
1993(File:)S
2226(src/kernel/protect.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(07815)210 648 A
1362({)S
(hwint13,)336 1446 A
(VECTOR\(13\),)462 1824 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
990 V
(07816)210 648 A
1362({)S
(hwint14,)336 1446 A
(VECTOR\(14\),)462 1824 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
1080 V
(07817)210 648 A
1362({)S
(hwint15,)336 1446 A
(VECTOR\(15\),)462 1824 A
(INTR_PRIVILEGE)588 2328 A
2958(},)S
1170 V
(07818)210 648 A
1110(};)S
1260 V
(07819)210 648 A
1350 V
(07820)210 648 A
1110(/*)S
(This)168 1236 A
1446(is)S
(called)252 1572 A
(early)210 1866 A
(and)126 2118 A
(can't)210 2286 A
(use)126 2538 A
(tables)252 2706 A
(set)126 3000 A
3168(up)S
3294(by)S
(main\(\).)294 3420 A
3756(*/)S
1440 V
(07821)210 648 A
(data_bytes)420 1110 A
1572(=)S
(\(phys_bytes\))504 1656 A
(sizes[1])336 2202 A
2580(<<)S
(CLICK_SHIFT;)504 2706 A
1530 V
(07822)210 648 A
1110(if)S
(\(sizes[0])378 1236 A
1656(==)S
1782(0\))S
1620 V
(07823)210 648 A
(code_bytes)420 1362 A
1824(=)S
(data_bytes;)462 1908 A
2706(/*)S
(common)252 2832 A
(I&D)126 3126 A
3294(*/)S
1710 V
(07824)210 648 A
(else)168 1110 A
1800 V
(07825)210 648 A
(code_bytes)420 1362 A
1824(=)S
(\(phys_bytes\))504 1908 A
(sizes[0])336 2454 A
2832(<<)S
(CLICK_SHIFT;)504 2958 A
1890 V
(07826)210 648 A
1980 V
(07827)210 648 A
1110(/*)S
(Build)210 1236 A
(gdt)126 1488 A
(and)126 1656 A
(idt)126 1824 A
(pointers)336 1992 A
2370(in)S
(GDT)126 2496 A
(where)210 2664 A
(the)126 2916 A
(BIOS)168 3084 A
(expects)294 3294 A
(them.)210 3630 A
3882(*/)S
2070 V
(07828)210 648 A
(dtp=)168 1110 A
(\(struct)294 1320 A
(desctableptr_s)588 1656 A
2286(*\))S
(&gdt[GDT_INDEX];)672 2412 A
2160 V
(07829)210 648 A
1110(*)S
(\(u16_t)252 1194 A
1488(*\))S
(dtp->limit)420 1614 A
2076(=)S
(\(sizeof)294 2160 A
(gdt\))168 2496 A
2706(-)S
2790(1;)S
2250 V
(07830)210 648 A
1110(*)S
(\(u32_t)252 1194 A
1488(*\))S
(dtp->base)378 1614 A
2034(=)S
(vir2phys\(gdt\);)588 2118 A
2340 V
(07831)210 648 A
2430 V
(07832)210 648 A
(dtp=)168 1110 A
(\(struct)294 1320 A
(desctableptr_s)588 1656 A
2286(*\))S
(&gdt[IDT_INDEX];)672 2412 A
2520 V
(07833)210 648 A
1110(*)S
(\(u16_t)252 1194 A
1488(*\))S
(dtp->limit)420 1614 A
2076(=)S
(\(sizeof)294 2160 A
(idt\))168 2496 A
2706(-)S
2790(1;)S
2610 V
(07834)210 648 A
1110(*)S
(\(u32_t)252 1194 A
1488(*\))S
(dtp->base)378 1614 A
2034(=)S
(vir2phys\(idt\);)588 2118 A
2700 V
(07835)210 648 A
2790 V
(07836)210 648 A
1110(/*)S
(Build)210 1236 A
(segment)294 1488 A
(descriptors)462 1824 A
(for)126 2328 A
(tasks)210 2496 A
(and)126 2748 A
(interrupt)378 2916 A
(handlers.)378 3336 A
3756(*/)S
2880 V
(07837)210 648 A
(init_codeseg\(&gdt[CS_INDEX],)1176 1110 A
(code_base,)420 2328 A
(code_bytes,)462 2790 A
(INTR_PRIVILEGE\);)672 3294 A
2970 V
(07838)210 648 A
(init_dataseg\(&gdt[DS_INDEX],)1176 1110 A
(data_base,)420 2328 A
(data_bytes,)462 2790 A
(INTR_PRIVILEGE\);)672 3294 A
3060 V
(07839)210 648 A
(init_dataseg\(&gdt[ES_INDEX],)1176 1110 A
(0L,)126 2328 A
(0L,)126 2496 A
(TASK_PRIVILEGE\);)672 2664 A
3150 V
(07840)210 648 A
3240 V
(07841)210 648 A
1110(/*)S
(Build)210 1236 A
(scratch)294 1488 A
(descriptors)462 1824 A
(for)126 2328 A
(functions)378 2496 A
2916(in)S
(klib88.)294 3042 A
3378(*/)S
3330 V
(07842)210 648 A
(init_dataseg\(&gdt[DS_286_INDEX],)1344 1110 A
(\(phys_bytes\))504 2496 A
3042(0,)S
3420 V
(07843)210 648 A
(\(phys_bytes\))504 1656 A
(MAX_286_SEG_SIZE,)714 2202 A
(TASK_PRIVILEGE\);)672 2958 A
3510 V
(07844)210 648 A
(init_dataseg\(&gdt[ES_286_INDEX],)1344 1110 A
(\(phys_bytes\))504 2496 A
3042(0,)S
3600 V
(07845)210 648 A
(\(phys_bytes\))504 1656 A
(MAX_286_SEG_SIZE,)714 2202 A
(TASK_PRIVILEGE\);)672 2958 A
3690 V
(07846)210 648 A
3780 V
(07847)210 648 A
1110(/*)S
(Build)210 1236 A
(local)210 1488 A
(descriptors)462 1740 A
2244(in)S
(GDT)126 2370 A
(for)126 2538 A
(LDT's)210 2706 A
2958(in)S
(process)294 3084 A
(table.)252 3420 A
3870 V
(07848)210 648 A
1152(*)S
(The)126 1236 A
(LDT's)210 1404 A
(are)126 1656 A
(allocated)378 1824 A
2244(at)S
(compile)294 2370 A
(time)168 2706 A
2916(in)S
(the)126 3042 A
(process)294 3210 A
(table,)252 3546 A
(and)126 3840 A
3960 V
(07849)210 648 A
1152(*)S
(initialized)462 1236 A
(whenever)336 1740 A
2118(a)S
(process')336 2202 A
(map)126 2580 A
2748(is)S
(initialized)462 2874 A
3378(or)S
(changed.)336 3504 A
4050 V
(07850)210 648 A
1152(*/)S
4140 V
(07851)210 648 A
(for)126 1110 A
(\(rp)126 1278 A
1446(=)S
(BEG_PROC_ADDR,)588 1530 A
(ldt_selector)504 2160 A
2706(=)S
(FIRST_LDT_INDEX)630 2790 A
3462(*)S
(DESC_SIZE;)420 3546 A
4230 V
(07852)210 648 A
1320(rp)S
1446(<)S
(END_PROC_ADDR;)588 1530 A
(++rp,)210 2160 A
(ldt_selector)504 2412 A
2958(+=)S
(DESC_SIZE\))420 3084 A
3546({)S
4320 V
(07853)210 648 A
(init_dataseg\(&gdt[ldt_selector)1260 1362 A
2664(/)S
(DESC_SIZE],)462 2748 A
(vir2phys\(rp->p_ldt\),)840 3252 A
4410 V
(07854)210 648 A
(\(phys_bytes\))504 1908 A
(sizeof)252 2454 A
(rp->p_ldt,)420 2748 A
(INTR_PRIVILEGE\);)672 3210 A
4500 V
(07855)210 648 A
(gdt[ldt_selector)672 1362 A
2076(/)S
(DESC_SIZE].access)714 2160 A
2916(=)S
(PRESENT)294 3000 A
3336(|)S
(LDT;)168 3420 A
4590 V
(07856)210 648 A
(rp->p_ldt_sel)546 1362 A
1950(=)S
(ldt_selector;)546 2034 A
4680 V
(07857)210 648 A
1110(})S
4770 V
(07858)210 648 A
4860 V
(07859)210 648 A
1110(/*)S
(Build)210 1236 A
(main)168 1488 A
(TSS.)168 1698 A
4950 V
(07860)210 648 A
1152(*)S
(This)168 1236 A
1446(is)S
(used)168 1572 A
(only)168 1782 A
1992(to)S
(record)252 2118 A
(the)126 2412 A
(stack)210 2580 A
(pointer)294 2832 A
3168(to)S
3294(be)S
(used)168 3420 A
(after)210 3630 A
3882(an)S
5040 V
(07861)210 648 A
1152(*)S
(interrupt.)420 1236 A
5130 V
(07862)210 648 A
1152(*)S
(The)126 1236 A
(pointer)294 1404 A
1740(is)S
(set)126 1866 A
2034(up)S
2160(so)S
(that)168 2286 A
2496(an)S
(interrupt)378 2622 A
(automatically)546 3042 A
(saves)210 3630 A
(the)126 3882 A
5220 V
(07863)210 648 A
1152(*)S
(current)294 1236 A
(process's)378 1572 A
(registers)378 1992 A
(ip:cs:f:sp:ss)546 2412 A
3000(in)S
(the)126 3126 A
(correct)294 3294 A
(slots)210 3630 A
3882(in)S
(the)126 4008 A
5310 V
(07864)210 648 A
1152(*)S
(process)294 1236 A
(table.)252 1572 A
5400 V
(07865)210 648 A
1152(*/)S
5490 V
(07866)210 648 A
(tss.ss0)294 1110 A
1446(=)S
(DS_SELECTOR;)504 1530 A
5580 V
(07867)210 648 A
(init_dataseg\(&gdt[TSS_INDEX],)1218 1110 A
(vir2phys\(&tss\),)630 2370 A
(\(phys_bytes\))504 3042 A
(sizeof)252 3588 A
(tss,)168 3882 A
5670 V
(07868)210 648 A
(INTR_PRIVILEGE\);)672 3378 A
5760 V
(07869)210 648 A
(gdt[TSS_INDEX].access)882 1110 A
2034(=)S
(PRESENT)294 2118 A
2454(|)S
(\(INTR_PRIVILEGE)630 2538 A
3210(<<)S
(DPL_SHIFT\))420 3336 A
3798(|)S
(TSS_TYPE;)378 3882 A
5850 V
(07870)210 648 A
(tss.iobase)420 1110 A
1572(=)S
(sizeof)252 1656 A
(tss;)168 1950 A
2370(/*)S
(empty)210 2496 A
(i/o)126 2748 A
(permissions)462 2916 A
(map)126 3420 A
3588(*/)S
5940 V
(07871)210 648 A
6030 V
(07872)210 648 A
1110(/*)S
(Build)210 1236 A
(descriptors)462 1488 A
(for)126 1992 A
(interrupt)378 2160 A
(gates)210 2580 A
2832(in)S
(IDT.)168 2958 A
3168(*/)S
6120 V
(07873)210 648 A
(for)126 1110 A
(\(gtp)168 1278 A
1488(=)S
(&gate_table[0];)630 1572 A
6210 V
(07874)210 648 A
(gtp)126 1320 A
1488(<)S
(&gate_table[sizeof)756 1572 A
(gate_table)420 2370 A
2832(/)S
(sizeof)252 2916 A
(gate_table[0]];)630 3210 A
(++gtp\))252 3882 A
4176({)S
8418 V
EP
%%Page: 97 97
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1993(File:)S
2226(src/kernel/protect.c)S
12 B
4308(97)S
900 V
7 LST
(07875)210 648 A
(int_gate\(gtp->vec_nr,)882 1362 A
(\(phys_bytes\))504 2286 A
(\(vir_bytes\))462 2832 A
(gtp->gate,)420 3336 A
990 V
(07876)210 648 A
(PRESENT)294 1740 A
2076(|)S
(INT_GATE_TYPE)546 2160 A
2748(|)S
(\(gtp->privilege)630 2832 A
3504(<<)S
(DPL_SHIFT\)\);)504 3630 A
1080 V
(07877)210 648 A
1110(})S
1170 V
(07878)210 648 A
(int_gate\(SYS_VECTOR,)840 1110 A
(\(phys_bytes\))504 1992 A
(\(vir_bytes\))462 2538 A
(p_s_call,)378 3042 A
1260 V
(07879)210 648 A
(PRESENT)294 1488 A
1824(|)S
(\(USER_PRIVILEGE)630 1908 A
2580(<<)S
(DPL_SHIFT\))420 2706 A
3168(|)S
(INT_GATE_TYPE\);)630 3252 A
1350 V
(07880)210 648 A
(int_gate\(LEVEL0_VECTOR,)966 1110 A
(\(phys_bytes\))504 2118 A
(\(vir_bytes\))462 2664 A
(level0_call,)504 3168 A
1440 V
(07881)210 648 A
(PRESENT)294 1488 A
1824(|)S
(\(TASK_PRIVILEGE)630 1908 A
2580(<<)S
(DPL_SHIFT\))420 2706 A
3168(|)S
(INT_GATE_TYPE\);)630 3252 A
1530 V
(07882)210 648 A
(int_gate\(SYS386_VECTOR,)966 1110 A
(\(phys_bytes\))504 2118 A
(\(vir_bytes\))462 2664 A
(s_call,)294 3168 A
1620 V
(07883)210 648 A
(PRESENT)294 1488 A
1824(|)S
(\(USER_PRIVILEGE)630 1908 A
2580(<<)S
(DPL_SHIFT\))420 2706 A
3168(|)S
(INT_GATE_TYPE\);)630 3252 A
1710 V
(07884)210 648 A
1026(})S
1890 V
(07886)210 648 A
(/*=========================================================================*)3192 1026 A
1980 V
(07887)210 648 A
1068(*)S
(init_codeseg)504 2370 A
4176(*)S
2070 V
(07888)210 648 A
(*=========================================================================*/)3192 1068 A
2160 V
(07889)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(init_codeseg\(segdp,)798 1530 A
(base,)210 2370 A
(size,)210 2622 A
(privilege\))420 2874 A
2250 V
(07890)210 648 A
(register)336 1026 A
(struct)252 1404 A
(segdesc_s)378 1698 A
(*segdp;)294 2118 A
2340 V
(07891)210 648 A
(phys_bytes)420 1026 A
(base;)210 1488 A
2430 V
(07892)210 648 A
(phys_bytes)420 1026 A
(size;)210 1488 A
2520 V
(07893)210 648 A
(int)126 1026 A
(privilege;)420 1194 A
2610 V
(07894)210 648 A
1026({)S
2700 V
(07895)210 648 A
1026(/*)S
(Build)210 1152 A
(descriptor)420 1404 A
(for)126 1866 A
2034(a)S
(code)168 2118 A
(segment.)336 2328 A
2706(*/)S
2790 V
(07896)210 648 A
2880 V
(07897)210 648 A
(sdesc\(segdp,)504 1110 A
(base,)210 1656 A
(size\);)252 1908 A
2970 V
(07898)210 648 A
(segdp->access)546 1110 A
1698(=)S
(\(privilege)420 1782 A
2244(<<)S
(DPL_SHIFT\))420 2370 A
3060 V
(07899)210 648 A
1698(|)S
(\(PRESENT)336 1782 A
2160(|)S
(SEGMENT)294 2244 A
2580(|)S
(EXECUTABLE)420 2664 A
3126(|)S
(READABLE\);)420 3210 A
3150 V
(07900)210 648 A
1698(/*)S
(CONFORMING)420 1824 A
2286(=)S
2370(0,)S
(ACCESSED)336 2496 A
2874(=)S
2958(0)S
3042(*/)S
3240 V
(07901)210 648 A
1026(})S
3420 V
(07903)210 648 A
(/*=========================================================================*)3192 1026 A
3510 V
(07904)210 648 A
1068(*)S
(init_dataseg)504 2370 A
4176(*)S
3600 V
(07905)210 648 A
(*=========================================================================*/)3192 1068 A
3690 V
(07906)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(init_dataseg\(segdp,)798 1530 A
(base,)210 2370 A
(size,)210 2622 A
(privilege\))420 2874 A
3780 V
(07907)210 648 A
(register)336 1026 A
(struct)252 1404 A
(segdesc_s)378 1698 A
(*segdp;)294 2118 A
3870 V
(07908)210 648 A
(phys_bytes)420 1026 A
(base;)210 1488 A
3960 V
(07909)210 648 A
(phys_bytes)420 1026 A
(size;)210 1488 A
4050 V
(07910)210 648 A
(int)126 1026 A
(privilege;)420 1194 A
4140 V
(07911)210 648 A
1026({)S
4230 V
(07912)210 648 A
1026(/*)S
(Build)210 1152 A
(descriptor)420 1404 A
(for)126 1866 A
2034(a)S
(data)168 2118 A
(segment.)336 2328 A
2706(*/)S
4320 V
(07913)210 648 A
4410 V
(07914)210 648 A
(sdesc\(segdp,)504 1110 A
(base,)210 1656 A
(size\);)252 1908 A
4500 V
(07915)210 648 A
(segdp->access)546 1110 A
1698(=)S
(\(privilege)420 1782 A
2244(<<)S
(DPL_SHIFT\))420 2370 A
2832(|)S
(\(PRESENT)336 2916 A
3294(|)S
(SEGMENT)294 3378 A
3714(|)S
(WRITEABLE\);)462 3798 A
4590 V
(07916)210 648 A
1698(/*)S
(EXECUTABLE)420 1824 A
2286(=)S
2370(0,)S
(EXPAND_DOWN)462 2496 A
3000(=)S
3084(0,)S
(ACCESSED)336 3210 A
3588(=)S
3672(0)S
3756(*/)S
4680 V
(07917)210 648 A
1026(})S
4860 V
(07919)210 648 A
(/*=========================================================================*)3192 1026 A
4950 V
(07920)210 648 A
1068(*)S
(sdesc)210 2370 A
4176(*)S
5040 V
(07921)210 648 A
(*=========================================================================*/)3192 1068 A
5130 V
(07922)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(sdesc\(segdp,)504 1572 A
(base,)210 2118 A
(size\))210 2370 A
5220 V
(07923)210 648 A
(register)336 1026 A
(struct)252 1404 A
(segdesc_s)378 1698 A
(*segdp;)294 2118 A
5310 V
(07924)210 648 A
(phys_bytes)420 1026 A
(base;)210 1488 A
5400 V
(07925)210 648 A
(phys_bytes)420 1026 A
(size;)210 1488 A
5490 V
(07926)210 648 A
1026({)S
5580 V
(07927)210 648 A
1026(/*)S
(Fill)168 1152 A
1362(in)S
(the)126 1488 A
(size)168 1656 A
(fields)252 1866 A
(\(base,)252 2160 A
(limit)210 2454 A
(and)126 2706 A
(granularity\))504 2874 A
3420(of)S
3546(a)S
(descriptor.)462 3630 A
4134(*/)S
5670 V
(07928)210 648 A
5760 V
(07929)210 648 A
(segdp->base_low)630 1110 A
1782(=)S
(base;)210 1866 A
5850 V
(07930)210 648 A
(segdp->base_middle)756 1110 A
1908(=)S
(base)168 1992 A
2202(>>)S
(BASE_MIDDLE_SHIFT;)756 2328 A
5940 V
(07931)210 648 A
(segdp->base_high)672 1110 A
1824(=)S
(base)168 1908 A
2118(>>)S
(BASE_HIGH_SHIFT;)672 2244 A
6030 V
(07932)210 648 A
(--size;)294 1110 A
2370(/*)S
(convert)294 2496 A
2832(to)S
2958(a)S
(limit,)252 3042 A
3336(0)S
(size)168 3420 A
(means)210 3630 A
3882(4G)S
4008(*/)S
6120 V
(07933)210 648 A
1110(if)S
(\(size)210 1236 A
1488(>)S
(BYTE_GRAN_MAX\))588 1572 A
2202({)S
6210 V
(07934)210 648 A
(segdp->limit_low)672 1362 A
2076(=)S
(size)168 2160 A
2370(>>)S
(PAGE_GRAN_SHIFT;)672 2496 A
8418 V
EP
%%Page: 98 98
BP
/slant 0 def
/height 0 def
630 V
12 B
648(98)S
11 R
1993(File:)S
2226(src/kernel/protect.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(07935)210 648 A
(segdp->granularity)756 1362 A
2160(=)S
(GRANULAR)336 2244 A
2622(|)S
(\(size)210 2706 A
2958(>>)S
990 V
(07936)210 648 A
(\(PAGE_GRAN_SHIFT)672 2580 A
3294(+)S
(GRANULARITY_SHIFT\)\);)840 3378 A
1080 V
(07937)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1170 V
(07938)210 648 A
(segdp->limit_low)672 1362 A
2076(=)S
(size;)210 2160 A
1260 V
(07939)210 648 A
(segdp->granularity)756 1362 A
2160(=)S
(size)168 2244 A
2454(>>)S
(GRANULARITY_SHIFT;)756 2580 A
1350 V
(07940)210 648 A
1110(})S
1440 V
(07941)210 648 A
(segdp->granularity)756 1110 A
1908(|=)S
(DEFAULT;)336 2034 A
2706(/*)S
(means)210 2832 A
(BIG)126 3084 A
(for)126 3252 A
(data)168 3420 A
(seg)126 3630 A
3798(*/)S
1530 V
(07942)210 648 A
1026(})S
1710 V
(07944)210 648 A
(/*=========================================================================*)3192 1026 A
1800 V
(07945)210 648 A
1068(*)S
(seg2phys)336 2370 A
4176(*)S
1890 V
(07946)210 648 A
(*=========================================================================*/)3192 1068 A
1980 V
(07947)210 648 A
(PUBLIC)252 1026 A
(phys_bytes)420 1320 A
(seg2phys\(seg\))546 1782 A
2070 V
(07948)210 648 A
(U16_t)210 1026 A
(seg;)168 1278 A
2160 V
(07949)210 648 A
1026({)S
2250 V
(07950)210 648 A
1026(/*)S
(Return)252 1152 A
(the)126 1446 A
(base)168 1614 A
(address)294 1824 A
2160(of)S
2286(a)S
(segment,)336 2370 A
(with)168 2748 A
(seg)126 2958 A
(being)210 3126 A
(either)252 3378 A
3672(a)S
(8086)168 3756 A
(segment)294 3966 A
2340 V
(07951)210 648 A
1068(*)S
(register,)378 1152 A
1572(or)S
1698(a)S
(286/386)294 1782 A
(segment)294 2118 A
(selector.)378 2454 A
2430 V
(07952)210 648 A
1068(*/)S
2520 V
(07953)210 648 A
(phys_bytes)420 1110 A
(base;)210 1572 A
2610 V
(07954)210 648 A
(struct)252 1110 A
(segdesc_s)378 1404 A
(*segdp;)294 1824 A
2700 V
(07955)210 648 A
2790 V
(07956)210 648 A
1110(if)S
(\(!protected_mode\))714 1236 A
1992({)S
2880 V
(07957)210 648 A
(base)168 1362 A
1572(=)S
(hclick_to_physb\(seg\);)882 1656 A
2970 V
(07958)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3060 V
(07959)210 648 A
(segdp)210 1362 A
1614(=)S
(&gdt[seg)336 1698 A
2076(>>)S
(3];)126 2202 A
3150 V
(07960)210 648 A
(base)168 1362 A
1572(=)S
(segdp->base_low)630 1656 A
2328(|)S
(\(\(u32_t\))336 2412 A
(segdp->base_middle)756 2790 A
3588(<<)S
(16\);)168 3714 A
3240 V
(07961)210 648 A
(base)168 1362 A
1572(|=)S
(\(\(u32_t\))336 1698 A
(segdp->base_high)672 2076 A
2790(<<)S
(24\);)168 2916 A
3330 V
(07962)210 648 A
1110(})S
3420 V
(07963)210 648 A
(return)252 1110 A
(base;)210 1404 A
3510 V
(07964)210 648 A
1026(})S
3690 V
(07966)210 648 A
(/*=========================================================================*)3192 1026 A
3780 V
(07967)210 648 A
1068(*)S
(int_gate)336 2370 A
4176(*)S
3870 V
(07968)210 648 A
(*=========================================================================*/)3192 1068 A
3960 V
(07969)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(int_gate\(vec_nr,)672 1572 A
(base,)210 2286 A
(dpl_type\))378 2538 A
4050 V
(07970)210 648 A
(unsigned)336 1026 A
(vec_nr;)294 1404 A
4140 V
(07971)210 648 A
(phys_bytes)420 1026 A
(base;)210 1488 A
4230 V
(07972)210 648 A
(unsigned)336 1026 A
(dpl_type;)378 1404 A
4320 V
(07973)210 648 A
1026({)S
4410 V
(07974)210 648 A
1026(/*)S
(Build)210 1152 A
(descriptor)420 1404 A
(for)126 1866 A
2034(an)S
(interrupt)378 2160 A
(gate.)210 2580 A
2832(*/)S
4500 V
(07975)210 648 A
4590 V
(07976)210 648 A
(register)336 1110 A
(struct)252 1488 A
(gatedesc_s)420 1782 A
(*idp;)210 2244 A
4680 V
(07977)210 648 A
4770 V
(07978)210 648 A
(idp)126 1110 A
1278(=)S
(&idt[vec_nr];)546 1362 A
4860 V
(07979)210 648 A
(idp->offset_low)630 1110 A
1782(=)S
(base;)210 1866 A
4950 V
(07980)210 648 A
(idp->selector)546 1110 A
1698(=)S
(CS_SELECTOR;)504 1782 A
5040 V
(07981)210 648 A
(idp->p_dpl_type)630 1110 A
1782(=)S
(dpl_type;)378 1866 A
5130 V
(07982)210 648 A
(idp->offset_high)672 1110 A
1824(=)S
(base)168 1908 A
2118(>>)S
(OFFSET_HIGH_SHIFT;)756 2244 A
5220 V
(07983)210 648 A
1026(})S
5400 V
(07985)210 648 A
(/*=========================================================================*)3192 1026 A
5490 V
(07986)210 648 A
1068(*)S
(enable_iop)420 2370 A
4176(*)S
5580 V
(07987)210 648 A
(*=========================================================================*/)3192 1068 A
5670 V
(07988)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(enable_iop\(pp\))588 1530 A
5760 V
(07989)210 648 A
(struct)252 1026 A
(proc)168 1320 A
(*pp;)168 1530 A
5850 V
(07990)210 648 A
1026({)S
5940 V
(07991)210 648 A
1026(/*)S
(Allow)210 1152 A
1404(a)S
(user)168 1488 A
(process)294 1698 A
2034(to)S
(use)126 2160 A
(I/O)126 2328 A
(instructions.)546 2496 A
(Change)252 3126 A
(the)126 3420 A
(I/O)126 3588 A
(Permission)420 3756 A
6030 V
(07992)210 648 A
1068(*)S
(Level)210 1152 A
(bits)168 1404 A
1614(in)S
(the)126 1740 A
(psw.)168 1908 A
(These)210 2118 A
(specify)294 2370 A
(least-privileged)672 2706 A
(Current)294 3420 A
(Permission)420 3756 A
6120 V
(07993)210 648 A
1068(*)S
(Level)210 1152 A
(allowed)294 1404 A
1740(to)S
(execute)294 1866 A
(I/O)126 2202 A
(instructions.)546 2370 A
(Users)210 2958 A
(and)126 3210 A
(servers)294 3378 A
(have)168 3714 A
(CPL)126 3924 A
4092(3.)S
6210 V
(07994)210 648 A
1068(*)S
(You)126 1152 A
(can't)210 1320 A
(have)168 1572 A
(less)168 1782 A
(privilege)378 1992 A
(than)168 2412 A
(that.)210 2622 A
(Kernel)252 2874 A
(has)126 3168 A
(CPL)126 3336 A
3504(0,)S
(tasks)210 3630 A
(CPL)126 3882 A
4050(1.)S
8418 V
EP
%%Page: 99 99
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1993(File:)S
2226(src/kernel/protect.c)S
12 B
4308(99)S
900 V
7 LST
(07995)210 648 A
1068(*/)S
990 V
(07996)210 648 A
(pp->p_reg.psw)546 1110 A
1698(|=)S
(0x3000;)294 1824 A
1080 V
(07997)210 648 A
1026(})S
1440 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1530 V
(src/kernel/klib.s)714 2034 A
1620 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1800 V
(08000)210 648 A
1026(#)S
1890 V
(08001)210 648 A
1026(!)S
(Chooses)294 1110 A
(between)294 1446 A
(the)126 1782 A
(8086)168 1950 A
(and)126 2160 A
(386)126 2328 A
(versions)336 2496 A
2874(of)S
(the)126 3000 A
(low)126 3168 A
(level)210 3336 A
(kernel)252 3588 A
(code.)210 3882 A
1980 V
(08002)210 648 A
2070 V
(08003)210 648 A
(#include)336 1026 A
(<minix/config.h>)672 1404 A
2160 V
(08004)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(2)S
2250 V
(08005)210 648 A
(#include)336 1026 A
("klib88.s")420 1404 A
2340 V
(08006)210 648 A
(#else)210 1026 A
2430 V
(08007)210 648 A
(#include)336 1026 A
("klib386.s")462 1404 A
2520 V
(08008)210 648 A
(#endif)252 1026 A
2790 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2880 V
(src/kernel/klib386.s)840 2034 A
2970 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3150 V
(08100)210 648 A
1026(#)S
3240 V
(08101)210 648 A
1026(!)S
(sections)336 1110 A
3330 V
(08102)210 648 A
3420 V
(08103)210 648 A
(.sect)210 1026 A
(.text;)252 1278 A
(.sect)210 1572 A
(.rom;)210 1824 A
(.sect)210 2076 A
(.data;)252 2328 A
(.sect)210 2622 A
(.bss)168 2874 A
3510 V
(08104)210 648 A
3600 V
(08105)210 648 A
(#include)336 1026 A
(<minix/config.h>)672 1404 A
3690 V
(08106)210 648 A
(#include)336 1026 A
(<minix/const.h>)630 1404 A
3780 V
(08107)210 648 A
(#include)336 1026 A
("const.h")378 1404 A
3870 V
(08108)210 648 A
(#include)336 1026 A
("sconst.h")420 1404 A
3960 V
(08109)210 648 A
(#include)336 1026 A
("protect.h")462 1404 A
4050 V
(08110)210 648 A
4140 V
(08111)210 648 A
1026(!)S
(This)168 1110 A
(file)168 1320 A
(contains)336 1530 A
1908(a)S
(number)252 1992 A
2286(of)S
(assembly)336 2412 A
(code)168 2790 A
(utility)294 3000 A
(routines)336 3336 A
(needed)252 3714 A
4008(by)S
(the)126 4134 A
4230 V
(08112)210 648 A
1026(!)S
(kernel.)294 1110 A
(They)168 1488 A
(are:)168 1698 A
4320 V
(08113)210 648 A
4410 V
(08114)210 648 A
(.define)294 1026 A
(_monitor)336 1362 A
2034(!)S
(exit)168 2118 A
(Minix)210 2328 A
(and)126 2580 A
(return)252 2748 A
3042(to)S
(the)126 3168 A
(monitor)294 3336 A
4500 V
(08115)210 648 A
(.define)294 1026 A
(_check_mem)420 1362 A
2034(!)S
(check)210 2118 A
2370(a)S
(block)210 2454 A
2706(of)S
(memory,)294 2832 A
(return)252 3168 A
(the)126 3462 A
(valid)210 3630 A
(size)168 3882 A
4590 V
(08116)210 648 A
(.define)294 1026 A
(_cp_mess)336 1362 A
2034(!)S
(copies)252 2118 A
(messages)336 2412 A
(from)168 2790 A
(source)252 3000 A
3294(to)S
(destination)462 3420 A
4680 V
(08117)210 648 A
(.define)294 1026 A
(_exit)210 1362 A
2034(!)S
(dummy)210 2118 A
(for)126 2370 A
(library)294 2538 A
(routines)336 2874 A
4770 V
(08118)210 648 A
(.define)294 1026 A
(__exit)252 1362 A
2034(!)S
(dummy)210 2118 A
(for)126 2370 A
(library)294 2538 A
(routines)336 2874 A
4860 V
(08119)210 648 A
(.define)294 1026 A
(___exit)294 1362 A
2034(!)S
(dummy)210 2118 A
(for)126 2370 A
(library)294 2538 A
(routines)336 2874 A
4950 V
(08120)210 648 A
(.define)294 1026 A
(___main)294 1362 A
2034(!)S
(dummy)210 2118 A
(for)126 2370 A
(GCC)126 2538 A
5040 V
(08121)210 648 A
(.define)294 1026 A
(_in_byte)336 1362 A
2034(!)S
(read)168 2118 A
2328(a)S
(byte)168 2412 A
(from)168 2622 A
2832(a)S
(port)168 2916 A
(and)126 3126 A
(return)252 3294 A
3588(it)S
5130 V
(08122)210 648 A
(.define)294 1026 A
(_in_word)336 1362 A
2034(!)S
(read)168 2118 A
2328(a)S
(word)168 2412 A
(from)168 2622 A
2832(a)S
(port)168 2916 A
(and)126 3126 A
(return)252 3294 A
3588(it)S
5220 V
(08123)210 648 A
(.define)294 1026 A
(_out_byte)378 1362 A
2034(!)S
(write)210 2118 A
2370(a)S
(byte)168 2454 A
2664(to)S
2790(a)S
(port)168 2874 A
5310 V
(08124)210 648 A
(.define)294 1026 A
(_out_word)378 1362 A
2034(!)S
(write)210 2118 A
2370(a)S
(word)168 2454 A
2664(to)S
2790(a)S
(port)168 2874 A
5400 V
(08125)210 648 A
(.define)294 1026 A
(_port_read)420 1362 A
2034(!)S
(transfer)336 2118 A
(data)168 2496 A
(from)168 2706 A
(\(disk)210 2916 A
(controller\))462 3168 A
(port)168 3672 A
3882(to)S
(memory)252 4008 A
5490 V
(08126)210 648 A
(.define)294 1026 A
(_port_read_byte)630 1362 A
2034(!)S
(likewise)336 2118 A
(byte)168 2496 A
2706(by)S
(byte)168 2832 A
5580 V
(08127)210 648 A
(.define)294 1026 A
(_port_write)462 1362 A
2034(!)S
(transfer)336 2118 A
(data)168 2496 A
(from)168 2706 A
(memory)252 2916 A
3210(to)S
(\(disk)210 3336 A
(controller\))462 3588 A
(port)168 4092 A
5670 V
(08128)210 648 A
(.define)294 1026 A
(_port_write_byte)672 1362 A
2076(!)S
(likewise)336 2160 A
(byte)168 2538 A
2748(by)S
(byte)168 2874 A
5760 V
(08129)210 648 A
(.define)294 1026 A
(_lock)210 1362 A
2034(!)S
(disable)294 2118 A
(interrupts)420 2454 A
5850 V
(08130)210 648 A
(.define)294 1026 A
(_unlock)294 1362 A
2034(!)S
(enable)252 2118 A
(interrupts)420 2412 A
5940 V
(08131)210 648 A
(.define)294 1026 A
(_enable_irq)462 1362 A
2034(!)S
(enable)252 2118 A
2412(an)S
(irq)126 2538 A
2706(at)S
(the)126 2832 A
(8259)168 3000 A
(controller)420 3210 A
6030 V
(08132)210 648 A
(.define)294 1026 A
(_disable_irq)504 1362 A
2034(!)S
(disable)294 2118 A
2454(an)S
(irq)126 2580 A
6120 V
(08133)210 648 A
(.define)294 1026 A
(_phys_copy)420 1362 A
2034(!)S
(copy)168 2118 A
(data)168 2328 A
(from)168 2538 A
(anywhere)336 2748 A
3126(to)S
(anywhere)336 3252 A
3630(in)S
(memory)252 3756 A
6210 V
(08134)210 648 A
(.define)294 1026 A
(_mem_rdw)336 1362 A
2034(!)S
(copy)168 2118 A
(one)126 2328 A
(word)168 2496 A
(from)168 2706 A
([segment:offset])672 2916 A
8418 V
EP
%%Page: 100 100
BP
/slant 0 def
/height 0 def
630 V
12 B
(100)180 648 A
11 R
1982(File:)S
(src/kernel/klib386.s)878 2215 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(08135)210 648 A
(.define)294 1026 A
(_reset)252 1362 A
2034(!)S
(reset)210 2118 A
(the)126 2370 A
(system)252 2538 A
990 V
(08136)210 648 A
(.define)294 1026 A
(_mem_vid_copy)546 1362 A
2034(!)S
(copy)168 2118 A
(data)168 2328 A
2538(to)S
(video)210 2664 A
(ram)126 2916 A
1080 V
(08137)210 648 A
(.define)294 1026 A
(_vid_vid_copy)546 1362 A
2034(!)S
(move)168 2118 A
(data)168 2328 A
2538(in)S
(video)210 2664 A
(ram)126 2916 A
1170 V
(08138)210 648 A
(.define)294 1026 A
(_level0)294 1362 A
2034(!)S
(call)168 2118 A
2328(a)S
(function)336 2412 A
2790(at)S
(level)210 2916 A
3168(0)S
1260 V
(08139)210 648 A
1350 V
(08140)210 648 A
1026(!)S
(The)126 1110 A
(routines)336 1278 A
(only)168 1656 A
(guarantee)378 1866 A
2286(to)S
(preserve)336 2412 A
(the)126 2790 A
(registers)378 2958 A
(the)126 3378 A
3546(C)S
(compiler)336 3630 A
1440 V
(08141)210 648 A
1026(!)S
(expects)294 1110 A
1446(to)S
1572(be)S
(preserved)378 1698 A
(\(ebx,)210 2118 A
(esi,)168 2370 A
(edi,)168 2580 A
(ebp,)168 2790 A
(esp,)168 3000 A
(segment)294 3210 A
(registers,)420 3546 A
(and)126 4008 A
1530 V
(08142)210 648 A
1026(!)S
(direction)378 1110 A
(bit)126 1530 A
1698(in)S
(the)126 1824 A
(flags\).)294 1992 A
1620 V
(08143)210 648 A
1710 V
(08144)210 648 A
1026(!)S
(imported)336 1110 A
(variables)378 1488 A
1800 V
(08145)210 648 A
1890 V
(08146)210 648 A
(.sect)210 1026 A
(.bss)168 1278 A
1980 V
(08147)210 648 A
(.extern)294 1026 A
(_mon_return,)504 1362 A
(_mon_sp)294 1908 A
2070 V
(08148)210 648 A
(.extern)294 1026 A
(_irq_use)336 1362 A
2160 V
(08149)210 648 A
(.extern)294 1026 A
(_blank_color)504 1362 A
2250 V
(08150)210 648 A
(.extern)294 1026 A
(_ext_memsize)504 1362 A
2340 V
(08151)210 648 A
(.extern)294 1026 A
(_gdt)168 1362 A
2430 V
(08152)210 648 A
(.extern)294 1026 A
(_low_memsize)504 1362 A
2520 V
(08153)210 648 A
(.extern)294 1026 A
(_sizes)252 1362 A
2610 V
(08154)210 648 A
(.extern)294 1026 A
(_vid_seg)336 1362 A
2700 V
(08155)210 648 A
(.extern)294 1026 A
(_vid_size)378 1362 A
2790 V
(08156)210 648 A
(.extern)294 1026 A
(_vid_mask)378 1362 A
2880 V
(08157)210 648 A
(.extern)294 1026 A
(_level0_func)504 1362 A
2970 V
(08158)210 648 A
3060 V
(08159)210 648 A
(.sect)210 1026 A
(.text)210 1278 A
3150 V
(08160)210 648 A
(!*===========================================================================*)3276 1026 A
3240 V
(08161)210 648 A
1026(!*)S
(monitor)294 2370 A
4260(*)S
3330 V
(08162)210 648 A
(!*===========================================================================*)3276 1026 A
3420 V
(08163)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(monitor\(\);)420 1614 A
3510 V
(08164)210 648 A
1026(!)S
(Return)252 1110 A
1404(to)S
(the)126 1530 A
(monitor.)336 1698 A
3600 V
(08165)210 648 A
3690 V
(08166)210 648 A
(_monitor:)378 1026 A
3780 V
(08167)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(\(_reboot_code\))588 1908 A
2706(!)S
(address)294 2790 A
3126(of)S
(new)126 3252 A
(parameters)420 3420 A
3870 V
(08168)210 648 A
(mov)126 1362 A
(esp,)168 1698 A
(\(_mon_sp\))378 1908 A
2706(!)S
(restore)294 2790 A
(monitor)294 3126 A
(stack)210 3462 A
(pointer)294 3714 A
3960 V
(08169)210 648 A
(o16)126 1194 A
(mov)126 1362 A
(dx,)126 1698 A
(SS_SELECTOR)462 1866 A
2706(!)S
(monitor)294 2790 A
(data)168 3126 A
(segment)294 3336 A
4050 V
(08170)210 648 A
(mov)126 1362 A
(ds,)126 1698 A
1866(dx)S
4140 V
(08171)210 648 A
(mov)126 1362 A
(es,)126 1698 A
1866(dx)S
4230 V
(08172)210 648 A
(mov)126 1362 A
(fs,)126 1698 A
1866(dx)S
4320 V
(08173)210 648 A
(mov)126 1362 A
(gs,)126 1698 A
1866(dx)S
4410 V
(08174)210 648 A
(mov)126 1362 A
(ss,)126 1698 A
1866(dx)S
4500 V
(08175)210 648 A
(pop)126 1362 A
(edi)126 1698 A
4590 V
(08176)210 648 A
(pop)126 1362 A
(esi)126 1698 A
4680 V
(08177)210 648 A
(pop)126 1362 A
(ebp)126 1698 A
4770 V
(08178)210 648 A
(o16)126 1194 A
(retf)168 1362 A
2706(!)S
(return)252 2790 A
3084(to)S
(the)126 3210 A
(monitor)294 3378 A
4860 V
(08179)210 648 A
4950 V
(08180)210 648 A
5040 V
(08181)210 648 A
(!*===========================================================================*)3276 1026 A
5130 V
(08182)210 648 A
1026(!*)S
(check_mem)378 2370 A
4260(*)S
5220 V
(08183)210 648 A
(!*===========================================================================*)3276 1026 A
5310 V
(08184)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(phys_bytes)420 1404 A
(check_mem\(phys_bytes)840 1866 A
(base,)210 2748 A
(phys_bytes)420 3000 A
(size\);)252 3462 A
5400 V
(08185)210 648 A
1026(!)S
(Check)210 1110 A
1362(a)S
(block)210 1446 A
1698(of)S
(memory,)294 1824 A
(return)252 2160 A
(the)126 2454 A
(amount)252 2622 A
(valid.)252 2916 A
5490 V
(08186)210 648 A
1026(!)S
(Only)168 1110 A
(every)210 1320 A
(16th)168 1572 A
(byte)168 1782 A
1992(is)S
(checked.)336 2118 A
5580 V
(08187)210 648 A
1026(!)S
1110(An)S
(initial)294 1236 A
(size)168 1572 A
1782(of)S
1908(0)S
(means)210 1992 A
(everything.)462 2244 A
5670 V
(08188)210 648 A
1026(!)S
(This)168 1110 A
(really)252 1320 A
(should)252 1614 A
1908(do)S
(some)168 2034 A
(alias)210 2244 A
(checks.)294 2496 A
5760 V
(08189)210 648 A
5850 V
(08190)210 648 A
(CM_DENSITY)420 1026 A
1698(=)S
2034(16)S
5940 V
(08191)210 648 A
(CM_LOG_DENSITY)588 1026 A
1698(=)S
2034(4)S
6030 V
(08192)210 648 A
(TEST1PATTERN)504 1026 A
1698(=)S
(0x55)168 2034 A
2706(!)S
(memory)252 2790 A
(test)168 3084 A
(pattern)294 3294 A
3630(1)S
6120 V
(08193)210 648 A
(TEST2PATTERN)504 1026 A
1698(=)S
(0xAA)168 2034 A
2706(!)S
(memory)252 2790 A
(test)168 3084 A
(pattern)294 3294 A
3630(2)S
6210 V
(08194)210 648 A
8418 V
EP
%%Page: 101 101
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1982(File:)S
(src/kernel/klib386.s)878 2215 A
12 B
(101)180 4248 A
900 V
7 LST
(08195)210 648 A
(CHKM_ARGS)378 1026 A
1698(=)S
2034(4)S
2118(+)S
2202(4)S
2286(+)S
2370(4)S
2706(!)S
2790(4)S
2874(+)S
2958(4)S
990 V
(08196)210 648 A
1026(!)S
2034(ds)S
(ebx)126 2160 A
(eip)126 2328 A
(base)168 2706 A
(size)168 2916 A
1080 V
(08197)210 648 A
1170 V
(08198)210 648 A
(_check_mem:)462 1026 A
1260 V
(08199)210 648 A
(push)168 1362 A
(ebx)126 1698 A
1350 V
(08200)210 648 A
(push)168 1362 A
1698(ds)S
1440 V
(08201)210 648 A
(o16)126 1194 A
(mov)126 1362 A
(ax,)126 1698 A
(FLAT_DS_SELECTOR)672 1866 A
1530 V
(08202)210 648 A
(mov)126 1362 A
(ds,)126 1698 A
1866(ax)S
1620 V
(08203)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(CHKM_ARGS\(esp\))588 1908 A
1710 V
(08204)210 648 A
(mov)126 1362 A
(ebx,)168 1698 A
(eax)126 1908 A
1800 V
(08205)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(CHKM_ARGS+4\(esp\))672 1908 A
1890 V
(08206)210 648 A
(shr)126 1362 A
(ecx,)168 1698 A
(CM_LOG_DENSITY)588 1908 A
1980 V
(08207)210 648 A
(cm_loop:)336 1026 A
2070 V
(08208)210 648 A
(movb)168 1362 A
(dl,)126 1698 A
(TEST1PATTERN)504 1866 A
2160 V
(08209)210 648 A
(xchgb)210 1362 A
(dl,)126 1698 A
(\(eax\))210 1866 A
2706(!)S
(write)210 2790 A
(test)168 3042 A
(pattern,)336 3252 A
(remember)336 3630 A
(original)336 4008 A
2250 V
(08210)210 648 A
(xchgb)210 1362 A
(dl,)126 1698 A
(\(eax\))210 1866 A
2706(!)S
(restore)294 2790 A
(original,)378 3126 A
(read)168 3546 A
(test)168 3756 A
(pattern)294 3966 A
2340 V
(08211)210 648 A
(cmpb)168 1362 A
(dl,)126 1698 A
(TEST1PATTERN)504 1866 A
2706(!)S
(must)168 2790 A
(agree)210 3000 A
3252(if)S
(good)168 3378 A
(real)168 3588 A
(memory)252 3798 A
2430 V
(08212)210 648 A
(jnz)126 1362 A
(cm_exit)294 1698 A
2706(!)S
2790(if)S
(different,)420 2916 A
(memory)252 3378 A
3672(is)S
(unusable)336 3798 A
2520 V
(08213)210 648 A
(movb)168 1362 A
(dl,)126 1698 A
(TEST2PATTERN)504 1866 A
2610 V
(08214)210 648 A
(xchgb)210 1362 A
(dl,)126 1698 A
(\(eax\))210 1866 A
2700 V
(08215)210 648 A
(xchgb)210 1362 A
(dl,)126 1698 A
(\(eax\))210 1866 A
2790 V
(08216)210 648 A
(add)126 1362 A
(eax,)168 1698 A
(CM_DENSITY)420 1908 A
2880 V
(08217)210 648 A
(cmpb)168 1362 A
(dl,)126 1698 A
(TEST2PATTERN)504 1866 A
2970 V
(08218)210 648 A
(loopz)210 1362 A
(cm_loop)294 1698 A
3060 V
(08219)210 648 A
(cm_exit:)336 1026 A
3150 V
(08220)210 648 A
(sub)126 1362 A
(eax,)168 1698 A
(ebx)126 1908 A
3240 V
(08221)210 648 A
(pop)126 1362 A
1698(ds)S
3330 V
(08222)210 648 A
(pop)126 1362 A
(ebx)126 1698 A
3420 V
(08223)210 648 A
(ret)126 1362 A
3510 V
(08224)210 648 A
3600 V
(08225)210 648 A
3690 V
(08226)210 648 A
(!*===========================================================================*)3276 1026 A
3780 V
(08227)210 648 A
1026(!*)S
(cp_mess)294 2370 A
4260(*)S
3870 V
(08228)210 648 A
(!*===========================================================================*)3276 1026 A
3960 V
(08229)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(cp_mess\(int)462 1614 A
(src,)168 2118 A
(phys_clicks)462 2328 A
(src_clicks,)462 2832 A
(vir_bytes)378 3336 A
(src_offset,)462 3756 A
4050 V
(08230)210 648 A
1026(!)S
(phys_clicks)462 1950 A
(dst_clicks,)462 2454 A
(vir_bytes)378 2958 A
(dst_offset\);)504 3378 A
4140 V
(08231)210 648 A
1026(!)S
(This)168 1110 A
(routine)294 1320 A
(makes)210 1656 A
1908(a)S
(fast)168 1992 A
(copy)168 2202 A
2412(of)S
2538(a)S
(message)294 2622 A
(from)168 2958 A
(anywhere)336 3168 A
3546(in)S
(the)126 3672 A
(address)294 3840 A
4230 V
(08232)210 648 A
1026(!)S
(space)210 1110 A
1362(to)S
(anywhere)336 1488 A
(else.)210 1866 A
2160(It)S
(also)168 2286 A
(copies)252 2496 A
(the)126 2790 A
(source)252 2958 A
(address)294 3252 A
(provided)336 3588 A
3966(as)S
4092(a)S
4320 V
(08233)210 648 A
1026(!)S
(parameter)378 1110 A
1530(to)S
(the)126 1656 A
(call)168 1824 A
(into)168 2034 A
(the)126 2244 A
(first)210 2412 A
(word)168 2664 A
2874(of)S
(the)126 3000 A
(destination)462 3168 A
(message.)336 3672 A
4410 V
(08234)210 648 A
1026(!)S
4500 V
(08235)210 648 A
1026(!)S
(Note)168 1110 A
(that)168 1320 A
(the)126 1530 A
(message)294 1698 A
(size,)210 2034 A
("Msize")294 2286 A
2622(is)S
2748(in)S
(DWORDS)252 2874 A
(\(not)168 3168 A
(bytes\))252 3378 A
(and)126 3672 A
(must)168 3840 A
4050(be)S
(set)126 4176 A
4590 V
(08236)210 648 A
1026(!)S
(correctly.)420 1110 A
(Changing)336 1614 A
(the)126 1992 A
(definition)420 2160 A
2622(of)S
(message)294 2748 A
3084(in)S
(the)126 3210 A
(type)168 3378 A
(file)168 3588 A
(and)126 3798 A
(not)126 3966 A
4680 V
(08237)210 648 A
1026(!)S
(changing)336 1110 A
1488(it)S
(here)168 1614 A
(will)168 1824 A
(lead)168 2034 A
2244(to)S
(total)210 2370 A
(disaster.)378 2622 A
4770 V
(08238)210 648 A
4860 V
(08239)210 648 A
(CM_ARGS)294 1026 A
1362(=)S
1698(4)S
1782(+)S
1866(4)S
1950(+)S
2034(4)S
2118(+)S
2202(4)S
2286(+)S
2370(4)S
2706(!)S
2790(4)S
2874(+)S
2958(4)S
3042(+)S
3126(4)S
3210(+)S
3294(4)S
3378(+)S
3462(4)S
4950 V
(08240)210 648 A
1026(!)S
1698(es)S
1866(ds)S
(edi)126 1992 A
(esi)126 2160 A
(eip)126 2328 A
(proc)168 2706 A
(scl)126 2916 A
(sof)126 3084 A
(dcl)126 3252 A
(dof)126 3420 A
5040 V
(08241)210 648 A
5130 V
(08242)210 648 A
(.align)252 1362 A
1698(16)S
5220 V
(08243)210 648 A
(_cp_mess:)378 1026 A
5310 V
(08244)210 648 A
(cld)126 1362 A
5400 V
(08245)210 648 A
(push)168 1362 A
(esi)126 1698 A
5490 V
(08246)210 648 A
(push)168 1362 A
(edi)126 1698 A
5580 V
(08247)210 648 A
(push)168 1362 A
1698(ds)S
5670 V
(08248)210 648 A
(push)168 1362 A
1698(es)S
5760 V
(08249)210 648 A
5850 V
(08250)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(FLAT_DS_SELECTOR)672 1908 A
5940 V
(08251)210 648 A
(mov)126 1362 A
(ds,)126 1698 A
1866(ax)S
6030 V
(08252)210 648 A
(mov)126 1362 A
(es,)126 1698 A
1866(ax)S
6120 V
(08253)210 648 A
6210 V
(08254)210 648 A
(mov)126 1362 A
(esi,)168 1698 A
(CM_ARGS+4\(esp\))588 1908 A
3042(!)S
(src)126 3126 A
(clicks)252 3294 A
8418 V
EP
%%Page: 102 102
BP
/slant 0 def
/height 0 def
630 V
12 B
(102)180 648 A
11 R
1982(File:)S
(src/kernel/klib386.s)878 2215 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(08255)210 648 A
(shl)126 1362 A
(esi,)168 1698 A
(CLICK_SHIFT)462 1908 A
990 V
(08256)210 648 A
(add)126 1362 A
(esi,)168 1698 A
(CM_ARGS+4+4\(esp\))672 1908 A
3042(!)S
(src)126 3126 A
(offset)252 3294 A
1080 V
(08257)210 648 A
(mov)126 1362 A
(edi,)168 1698 A
(CM_ARGS+4+4+4\(esp\))756 1908 A
3042(!)S
(dst)126 3126 A
(clicks)252 3294 A
1170 V
(08258)210 648 A
(shl)126 1362 A
(edi,)168 1698 A
(CLICK_SHIFT)462 1908 A
1260 V
(08259)210 648 A
(add)126 1362 A
(edi,)168 1698 A
(CM_ARGS+4+4+4+4\(esp\))840 1908 A
3042(!)S
(dst)126 3126 A
(offset)252 3294 A
1350 V
(08260)210 648 A
1440 V
(08261)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(CM_ARGS\(esp\))504 1908 A
2706(!)S
(process)294 2790 A
(number)252 3126 A
3420(of)S
(sender)252 3546 A
1530 V
(08262)210 648 A
(stos)168 1362 A
2706(!)S
(copy)168 2790 A
(number)252 3000 A
3294(of)S
(sender)252 3420 A
3714(to)S
(dest)168 3840 A
(message)294 4050 A
1620 V
(08263)210 648 A
(add)126 1362 A
(esi,)168 1698 A
1908(4)S
2706(!)S
2790(do)S
(not)126 2916 A
(copy)168 3084 A
(first)210 3294 A
(word)168 3546 A
1710 V
(08264)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(Msize)210 1908 A
2160(-)S
2244(1)S
2706(!)S
(remember,)378 2790 A
(first)210 3210 A
(word)168 3462 A
(does)168 3672 A
(not)126 3882 A
(count)210 4050 A
1800 V
(08265)210 648 A
(rep)126 1362 A
1890 V
(08266)210 648 A
(movs)168 1362 A
2706(!)S
(copy)168 2790 A
(the)126 3000 A
(message)294 3168 A
1980 V
(08267)210 648 A
2070 V
(08268)210 648 A
(pop)126 1362 A
1698(es)S
2160 V
(08269)210 648 A
(pop)126 1362 A
1698(ds)S
2250 V
(08270)210 648 A
(pop)126 1362 A
(edi)126 1698 A
2340 V
(08271)210 648 A
(pop)126 1362 A
(esi)126 1698 A
2430 V
(08272)210 648 A
(ret)126 1362 A
2706(!)S
(that)168 2790 A
3000(is)S
(all)126 3126 A
(folks!)252 3294 A
2520 V
(08273)210 648 A
2610 V
(08274)210 648 A
2700 V
(08275)210 648 A
(!*===========================================================================*)3276 1026 A
2790 V
(08276)210 648 A
1026(!*)S
(exit)168 2370 A
4260(*)S
2880 V
(08277)210 648 A
(!*===========================================================================*)3276 1026 A
2970 V
(08278)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(exit\(\);)294 1614 A
3060 V
(08279)210 648 A
1026(!)S
(Some)168 1110 A
(library)294 1320 A
(routines)336 1656 A
(use)126 2034 A
(exit,)210 2202 A
2454(so)S
(provide)294 2580 A
2916(a)S
(dummy)210 3000 A
(version.)336 3252 A
3150 V
(08280)210 648 A
1026(!)S
(Actual)252 1110 A
(calls)210 1404 A
1656(to)S
(exit)168 1782 A
(cannot)252 1992 A
(occur)210 2286 A
2538(in)S
(the)126 2664 A
(kernel.)294 2832 A
3240 V
(08281)210 648 A
1026(!)S
(GNU)126 1110 A
1278(CC)S
(likes)210 1404 A
1656(to)S
(call)168 1782 A
(___main)294 1992 A
(from)168 2328 A
(main\(\))252 2538 A
(for)126 2832 A
(nonobvious)420 3000 A
(reasons.)336 3462 A
3330 V
(08282)210 648 A
3420 V
(08283)210 648 A
(_exit:)252 1026 A
3510 V
(08284)210 648 A
(__exit:)294 1026 A
3600 V
(08285)210 648 A
(___exit:)336 1026 A
3690 V
(08286)210 648 A
(sti)126 1362 A
3780 V
(08287)210 648 A
(jmp)126 1362 A
(___exit)294 1698 A
3870 V
(08288)210 648 A
3960 V
(08289)210 648 A
(___main:)336 1026 A
4050 V
(08290)210 648 A
(ret)126 1362 A
4140 V
(08291)210 648 A
4230 V
(08292)210 648 A
4320 V
(08293)210 648 A
(!*===========================================================================*)3276 1026 A
4410 V
(08294)210 648 A
1026(!*)S
(in_byte)294 2370 A
4260(*)S
4500 V
(08295)210 648 A
(!*===========================================================================*)3276 1026 A
4590 V
(08296)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(unsigned)336 1404 A
(in_byte\(port_t)588 1782 A
(port\);)252 2412 A
4680 V
(08297)210 648 A
1026(!)S
(Read)168 1110 A
1320(an)S
(\(unsigned\))420 1446 A
(byte)168 1908 A
(from)168 2118 A
(the)126 2328 A
(i/o)126 2496 A
(port)168 2664 A
(port)168 2916 A
(and)126 3168 A
(return)252 3336 A
(it.)126 3630 A
4770 V
(08298)210 648 A
4860 V
(08299)210 648 A
(.align)252 1362 A
1698(16)S
4950 V
(08300)210 648 A
(_in_byte:)378 1026 A
5040 V
(08301)210 648 A
(mov)126 1362 A
(edx,)168 1698 A
(4\(esp\))252 1908 A
2706(!)S
(port)168 2790 A
5130 V
(08302)210 648 A
(sub)126 1362 A
(eax,)168 1698 A
(eax)126 1908 A
5220 V
(08303)210 648 A
(inb)126 1362 A
1698(dx)S
2706(!)S
(read)168 2790 A
3000(1)S
(byte)168 3084 A
5310 V
(08304)210 648 A
(ret)126 1362 A
5400 V
(08305)210 648 A
5490 V
(08306)210 648 A
5580 V
(08307)210 648 A
(!*===========================================================================*)3276 1026 A
5670 V
(08308)210 648 A
1026(!*)S
(in_word)294 2370 A
4260(*)S
5760 V
(08309)210 648 A
(!*===========================================================================*)3276 1026 A
5850 V
(08310)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(unsigned)336 1404 A
(in_word\(port_t)588 1782 A
(port\);)252 2412 A
5940 V
(08311)210 648 A
1026(!)S
(Read)168 1110 A
1320(an)S
(\(unsigned\))420 1446 A
(word)168 1908 A
(from)168 2118 A
(the)126 2328 A
(i/o)126 2496 A
(port)168 2664 A
(port)168 2916 A
(and)126 3168 A
(return)252 3336 A
(it.)126 3630 A
6030 V
(08312)210 648 A
6120 V
(08313)210 648 A
(.align)252 1362 A
1698(16)S
6210 V
(08314)210 648 A
(_in_word:)378 1026 A
8418 V
EP
%%Page: 103 103
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1982(File:)S
(src/kernel/klib386.s)878 2215 A
12 B
(103)180 4248 A
900 V
7 LST
(08315)210 648 A
(mov)126 1362 A
(edx,)168 1698 A
(4\(esp\))252 1908 A
2706(!)S
(port)168 2790 A
990 V
(08316)210 648 A
(sub)126 1362 A
(eax,)168 1698 A
(eax)126 1908 A
1080 V
(08317)210 648 A
(o16)126 1194 A
1362(in)S
1698(dx)S
2706(!)S
(read)168 2790 A
3000(1)S
(word)168 3084 A
1170 V
(08318)210 648 A
(ret)126 1362 A
1260 V
(08319)210 648 A
1350 V
(08320)210 648 A
1440 V
(08321)210 648 A
(!*===========================================================================*)3276 1026 A
1530 V
(08322)210 648 A
1026(!*)S
(out_byte)336 2370 A
4260(*)S
1620 V
(08323)210 648 A
(!*===========================================================================*)3276 1026 A
1710 V
(08324)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(out_byte\(port_t)630 1614 A
(port,)210 2286 A
(u8_t)168 2538 A
(value\);)294 2748 A
1800 V
(08325)210 648 A
1026(!)S
(Write)210 1110 A
(value)210 1404 A
(\(cast)210 1698 A
1950(to)S
2076(a)S
(byte\))210 2160 A
2454(to)S
(the)126 2580 A
(I/O)126 2748 A
(port)168 2916 A
(port.)210 3168 A
1890 V
(08326)210 648 A
1980 V
(08327)210 648 A
(.align)252 1362 A
1698(16)S
2070 V
(08328)210 648 A
(_out_byte:)420 1026 A
2160 V
(08329)210 648 A
(mov)126 1362 A
(edx,)168 1698 A
(4\(esp\))252 1908 A
2706(!)S
(port)168 2790 A
2250 V
(08330)210 648 A
(movb)168 1362 A
(al,)126 1698 A
(4+4\(esp\))336 1866 A
2706(!)S
(value)210 2790 A
2340 V
(08331)210 648 A
(outb)168 1362 A
1698(dx)S
2706(!)S
(output)252 2790 A
3084(1)S
(byte)168 3168 A
2430 V
(08332)210 648 A
(ret)126 1362 A
2520 V
(08333)210 648 A
2610 V
(08334)210 648 A
2700 V
(08335)210 648 A
(!*===========================================================================*)3276 1026 A
2790 V
(08336)210 648 A
1026(!*)S
(out_word)336 2370 A
4260(*)S
2880 V
(08337)210 648 A
(!*===========================================================================*)3276 1026 A
2970 V
(08338)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(out_word\(Port_t)630 1614 A
(port,)210 2286 A
(U16_t)210 2538 A
(value\);)294 2790 A
3060 V
(08339)210 648 A
1026(!)S
(Write)210 1110 A
(value)210 1404 A
(\(cast)210 1698 A
1950(to)S
2076(a)S
(word\))210 2160 A
2454(to)S
(the)126 2580 A
(I/O)126 2748 A
(port)168 2916 A
(port.)210 3168 A
3150 V
(08340)210 648 A
3240 V
(08341)210 648 A
(.align)252 1362 A
1698(16)S
3330 V
(08342)210 648 A
(_out_word:)420 1026 A
3420 V
(08343)210 648 A
(mov)126 1362 A
(edx,)168 1698 A
(4\(esp\))252 1908 A
2706(!)S
(port)168 2790 A
3510 V
(08344)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(4+4\(esp\))336 1908 A
2706(!)S
(value)210 2790 A
3600 V
(08345)210 648 A
(o16)126 1194 A
(out)126 1362 A
1698(dx)S
2706(!)S
(output)252 2790 A
3084(1)S
(word)168 3168 A
3690 V
(08346)210 648 A
(ret)126 1362 A
3780 V
(08347)210 648 A
3870 V
(08348)210 648 A
3960 V
(08349)210 648 A
(!*===========================================================================*)3276 1026 A
4050 V
(08350)210 648 A
1026(!*)S
(port_read)378 2370 A
4260(*)S
4140 V
(08351)210 648 A
(!*===========================================================================*)3276 1026 A
4230 V
(08352)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(port_read\(port_t)672 1614 A
(port,)210 2328 A
(phys_bytes)420 2580 A
(destination,)504 3042 A
(unsigned)336 3588 A
(bytcount\);)420 3966 A
4320 V
(08353)210 648 A
1026(!)S
(Transfer)336 1110 A
(data)168 1488 A
(from)168 1698 A
(\(hard)210 1908 A
(disk)168 2160 A
(controller\))462 2370 A
(port)168 2874 A
3084(to)S
(memory.)294 3210 A
4410 V
(08354)210 648 A
4500 V
(08355)210 648 A
(PR_ARGS)294 1026 A
1362(=)S
1698(4)S
1782(+)S
1866(4)S
1950(+)S
2034(4)S
2706(!)S
2790(4)S
2874(+)S
2958(4)S
3042(+)S
3126(4)S
4590 V
(08356)210 648 A
1026(!)S
1698(es)S
(edi)126 1824 A
(eip)126 1992 A
(port)168 2706 A
(dst)126 2916 A
(len)126 3084 A
4680 V
(08357)210 648 A
4770 V
(08358)210 648 A
(.align)252 1362 A
1698(16)S
4860 V
(08359)210 648 A
(_port_read:)462 1026 A
4950 V
(08360)210 648 A
(cld)126 1362 A
5040 V
(08361)210 648 A
(push)168 1362 A
(edi)126 1698 A
5130 V
(08362)210 648 A
(push)168 1362 A
1698(es)S
5220 V
(08363)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(FLAT_DS_SELECTOR)672 1908 A
5310 V
(08364)210 648 A
(mov)126 1362 A
(es,)126 1698 A
1866(cx)S
5400 V
(08365)210 648 A
(mov)126 1362 A
(edx,)168 1698 A
(PR_ARGS\(esp\))504 1908 A
2706(!)S
(port)168 2790 A
3000(to)S
(read)168 3126 A
(from)168 3336 A
5490 V
(08366)210 648 A
(mov)126 1362 A
(edi,)168 1698 A
(PR_ARGS+4\(esp\))588 1908 A
2706(!)S
(destination)462 2790 A
(addr)168 3294 A
5580 V
(08367)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(PR_ARGS+4+4\(esp\))672 1908 A
2706(!)S
(byte)168 2790 A
(count)210 3000 A
5670 V
(08368)210 648 A
(shr)126 1362 A
(ecx,)168 1698 A
1908(1)S
2706(!)S
(word)168 2790 A
(count)210 3000 A
5760 V
(08369)210 648 A
(rep)126 1362 A
2706(!)S
(\(hardware)378 2790 A
(cannot)252 3210 A
(handle)252 3504 A
(dwords\))294 3798 A
5850 V
(08370)210 648 A
(o16)126 1194 A
(ins)126 1362 A
2706(!)S
(read)168 2790 A
(everything)420 3000 A
5940 V
(08371)210 648 A
(pop)126 1362 A
1698(es)S
6030 V
(08372)210 648 A
(pop)126 1362 A
(edi)126 1698 A
6120 V
(08373)210 648 A
(ret)126 1362 A
6210 V
(08374)210 648 A
8418 V
EP
%%Page: 104 104
BP
/slant 0 def
/height 0 def
630 V
12 B
(104)180 648 A
11 R
1982(File:)S
(src/kernel/klib386.s)878 2215 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(08375)210 648 A
990 V
(08376)210 648 A
(!*===========================================================================*)3276 1026 A
1080 V
(08377)210 648 A
1026(!*)S
(port_read_byte)588 2370 A
4260(*)S
1170 V
(08378)210 648 A
(!*===========================================================================*)3276 1026 A
1260 V
(08379)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(port_read_byte\(port_t)882 1614 A
(port,)210 2538 A
(phys_bytes)420 2790 A
(destination,)504 3252 A
1350 V
(08380)210 648 A
1026(!)S
(unsigned)336 3042 A
(bytcount\);)420 3420 A
1440 V
(08381)210 648 A
1026(!)S
(Transfer)336 1110 A
(data)168 1488 A
(from)168 1698 A
(port)168 1908 A
2118(to)S
(memory.)294 2244 A
1530 V
(08382)210 648 A
1620 V
(08383)210 648 A
(PR_ARGS_B)378 1026 A
1446(=)S
1698(4)S
1782(+)S
1866(4)S
1950(+)S
2034(4)S
2706(!)S
2790(4)S
2874(+)S
2958(4)S
3042(+)S
3126(4)S
1710 V
(08384)210 648 A
1026(!)S
1698(es)S
(edi)126 1824 A
(eip)126 1992 A
(port)168 2706 A
(dst)126 2916 A
(len)126 3084 A
1800 V
(08385)210 648 A
1890 V
(08386)210 648 A
(_port_read_byte:)672 1026 A
1980 V
(08387)210 648 A
(cld)126 1362 A
2070 V
(08388)210 648 A
(push)168 1362 A
(edi)126 1698 A
2160 V
(08389)210 648 A
(push)168 1362 A
1698(es)S
2250 V
(08390)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(FLAT_DS_SELECTOR)672 1908 A
2340 V
(08391)210 648 A
(mov)126 1362 A
(es,)126 1698 A
1866(cx)S
2430 V
(08392)210 648 A
(mov)126 1362 A
(edx,)168 1698 A
(PR_ARGS_B\(esp\))588 1908 A
2520 V
(08393)210 648 A
(mov)126 1362 A
(edi,)168 1698 A
(PR_ARGS_B+4\(esp\))672 1908 A
2610 V
(08394)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(PR_ARGS_B+4+4\(esp\))756 1908 A
2700 V
(08395)210 648 A
(rep)126 1362 A
2790 V
(08396)210 648 A
(insb)168 1362 A
2880 V
(08397)210 648 A
(pop)126 1362 A
1698(es)S
2970 V
(08398)210 648 A
(pop)126 1362 A
(edi)126 1698 A
3060 V
(08399)210 648 A
(ret)126 1362 A
3150 V
(08400)210 648 A
3240 V
(08401)210 648 A
3330 V
(08402)210 648 A
(!*===========================================================================*)3276 1026 A
3420 V
(08403)210 648 A
1026(!*)S
(port_write)420 2370 A
4260(*)S
3510 V
(08404)210 648 A
(!*===========================================================================*)3276 1026 A
3600 V
(08405)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(port_write\(port_t)714 1614 A
(port,)210 2370 A
(phys_bytes)420 2622 A
(source,)294 3084 A
(unsigned)336 3420 A
(bytcount\);)420 3798 A
3690 V
(08406)210 648 A
1026(!)S
(Transfer)336 1110 A
(data)168 1488 A
(from)168 1698 A
(memory)252 1908 A
2202(to)S
(\(hard)210 2328 A
(disk)168 2580 A
(controller\))462 2790 A
(port.)210 3294 A
3780 V
(08407)210 648 A
3870 V
(08408)210 648 A
(PW_ARGS)294 1026 A
1362(=)S
1698(4)S
1782(+)S
1866(4)S
1950(+)S
2034(4)S
2706(!)S
2790(4)S
2874(+)S
2958(4)S
3042(+)S
3126(4)S
3960 V
(08409)210 648 A
1026(!)S
1698(es)S
(edi)126 1824 A
(eip)126 1992 A
(port)168 2706 A
(src)126 2916 A
(len)126 3084 A
4050 V
(08410)210 648 A
4140 V
(08411)210 648 A
(.align)252 1362 A
1698(16)S
4230 V
(08412)210 648 A
(_port_write:)504 1026 A
4320 V
(08413)210 648 A
(cld)126 1362 A
4410 V
(08414)210 648 A
(push)168 1362 A
(esi)126 1698 A
4500 V
(08415)210 648 A
(push)168 1362 A
1698(ds)S
4590 V
(08416)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(FLAT_DS_SELECTOR)672 1908 A
4680 V
(08417)210 648 A
(mov)126 1362 A
(ds,)126 1698 A
1866(cx)S
4770 V
(08418)210 648 A
(mov)126 1362 A
(edx,)168 1698 A
(PW_ARGS\(esp\))504 1908 A
2706(!)S
(port)168 2790 A
3000(to)S
(write)210 3126 A
3378(to)S
4860 V
(08419)210 648 A
(mov)126 1362 A
(esi,)168 1698 A
(PW_ARGS+4\(esp\))588 1908 A
2706(!)S
(source)252 2790 A
(addr)168 3084 A
4950 V
(08420)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(PW_ARGS+4+4\(esp\))672 1908 A
2706(!)S
(byte)168 2790 A
(count)210 3000 A
5040 V
(08421)210 648 A
(shr)126 1362 A
(ecx,)168 1698 A
1908(1)S
2706(!)S
(word)168 2790 A
(count)210 3000 A
5130 V
(08422)210 648 A
(rep)126 1362 A
2706(!)S
(\(hardware)378 2790 A
(cannot)252 3210 A
(handle)252 3504 A
(dwords\))294 3798 A
5220 V
(08423)210 648 A
(o16)126 1194 A
(outs)168 1362 A
2706(!)S
(write)210 2790 A
(everything)420 3042 A
5310 V
(08424)210 648 A
(pop)126 1362 A
1698(ds)S
5400 V
(08425)210 648 A
(pop)126 1362 A
(esi)126 1698 A
5490 V
(08426)210 648 A
(ret)126 1362 A
5580 V
(08427)210 648 A
5670 V
(08428)210 648 A
5760 V
(08429)210 648 A
(!*===========================================================================*)3276 1026 A
5850 V
(08430)210 648 A
1026(!*)S
(port_write_byte)630 2370 A
4260(*)S
5940 V
(08431)210 648 A
(!*===========================================================================*)3276 1026 A
6030 V
(08432)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(port_write_byte\(port_t)924 1614 A
(port,)210 2580 A
(phys_bytes)420 2832 A
(source,)294 3294 A
6120 V
(08433)210 648 A
1026(!)S
(unsigned)336 3042 A
(bytcount\);)420 3420 A
6210 V
(08434)210 648 A
1026(!)S
(Transfer)336 1110 A
(data)168 1488 A
(from)168 1698 A
(memory)252 1908 A
2202(to)S
(port.)210 2328 A
8418 V
EP
%%Page: 105 105
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1982(File:)S
(src/kernel/klib386.s)878 2215 A
12 B
(105)180 4248 A
900 V
7 LST
(08435)210 648 A
990 V
(08436)210 648 A
(PW_ARGS_B)378 1026 A
1446(=)S
1698(4)S
1782(+)S
1866(4)S
1950(+)S
2034(4)S
2706(!)S
2790(4)S
2874(+)S
2958(4)S
3042(+)S
3126(4)S
1080 V
(08437)210 648 A
1026(!)S
1698(es)S
(edi)126 1824 A
(eip)126 1992 A
(port)168 2706 A
(src)126 2916 A
(len)126 3084 A
1170 V
(08438)210 648 A
1260 V
(08439)210 648 A
(_port_write_byte:)714 1026 A
1350 V
(08440)210 648 A
(cld)126 1362 A
1440 V
(08441)210 648 A
(push)168 1362 A
(esi)126 1698 A
1530 V
(08442)210 648 A
(push)168 1362 A
1698(ds)S
1620 V
(08443)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(FLAT_DS_SELECTOR)672 1908 A
1710 V
(08444)210 648 A
(mov)126 1362 A
(ds,)126 1698 A
1866(cx)S
1800 V
(08445)210 648 A
(mov)126 1362 A
(edx,)168 1698 A
(PW_ARGS_B\(esp\))588 1908 A
1890 V
(08446)210 648 A
(mov)126 1362 A
(esi,)168 1698 A
(PW_ARGS_B+4\(esp\))672 1908 A
1980 V
(08447)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(PW_ARGS_B+4+4\(esp\))756 1908 A
2070 V
(08448)210 648 A
(rep)126 1362 A
2160 V
(08449)210 648 A
(outsb)210 1362 A
2250 V
(08450)210 648 A
(pop)126 1362 A
1698(ds)S
2340 V
(08451)210 648 A
(pop)126 1362 A
(esi)126 1698 A
2430 V
(08452)210 648 A
(ret)126 1362 A
2520 V
(08453)210 648 A
2610 V
(08454)210 648 A
2700 V
(08455)210 648 A
(!*===========================================================================*)3276 1026 A
2790 V
(08456)210 648 A
1026(!*)S
(lock)168 2370 A
4260(*)S
2880 V
(08457)210 648 A
(!*===========================================================================*)3276 1026 A
2970 V
(08458)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(lock\(\);)294 1614 A
3060 V
(08459)210 648 A
1026(!)S
(Disable)294 1110 A
(CPU)126 1446 A
(interrupts.)462 1614 A
3150 V
(08460)210 648 A
3240 V
(08461)210 648 A
(.align)252 1362 A
1698(16)S
3330 V
(08462)210 648 A
(_lock:)252 1026 A
3420 V
(08463)210 648 A
(cli)126 1362 A
2706(!)S
(disable)294 2790 A
(interrupts)420 3126 A
3510 V
(08464)210 648 A
(ret)126 1362 A
3600 V
(08465)210 648 A
3690 V
(08466)210 648 A
3780 V
(08467)210 648 A
(!*===========================================================================*)3276 1026 A
3870 V
(08468)210 648 A
1026(!*)S
(unlock)252 2370 A
4260(*)S
3960 V
(08469)210 648 A
(!*===========================================================================*)3276 1026 A
4050 V
(08470)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(unlock\(\);)378 1614 A
4140 V
(08471)210 648 A
1026(!)S
(Enable)252 1110 A
(CPU)126 1404 A
(interrupts.)462 1572 A
4230 V
(08472)210 648 A
4320 V
(08473)210 648 A
(.align)252 1362 A
1698(16)S
4410 V
(08474)210 648 A
(_unlock:)336 1026 A
4500 V
(08475)210 648 A
(sti)126 1362 A
4590 V
(08476)210 648 A
(ret)126 1362 A
4680 V
(08477)210 648 A
4770 V
(08478)210 648 A
4860 V
(08479)210 648 A
(!*==========================================================================*)3234 1026 A
4950 V
(08480)210 648 A
1026(!*)S
(enable_irq)420 2370 A
4218(*)S
5040 V
(08481)210 648 A
(!*==========================================================================*/)3276 1026 A
5130 V
(08482)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(enable_irq\(unsigned)798 1614 A
(irq\))168 2454 A
5220 V
(08483)210 648 A
1026(!)S
(Enable)252 1110 A
1404(an)S
(interrupt)378 1530 A
(request)294 1950 A
(line)168 2286 A
2496(by)S
(clearing)336 2622 A
3000(an)S
(8259)168 3126 A
(bit.)168 3336 A
5310 V
(08484)210 648 A
1026(!)S
(Equivalent)420 1110 A
(code)168 1572 A
(for)126 1782 A
(irq)126 1950 A
2118(<)S
2202(8:)S
5400 V
(08485)210 648 A
1026(!)S
(out_byte\(INT_CTLMASK,)882 1362 A
(in_byte\(INT_CTLMASK\))840 2286 A
3168(&)S
(\304\(1)126 3252 A
3420(<<)S
(irq\)\);)252 3546 A
5490 V
(08486)210 648 A
5580 V
(08487)210 648 A
(.align)252 1362 A
1698(16)S
5670 V
(08488)210 648 A
(_enable_irq:)504 1026 A
5760 V
(08489)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(4\(esp\))252 1908 A
2706(!)S
(irq)126 2790 A
5850 V
(08490)210 648 A
(pushf)210 1362 A
5940 V
(08491)210 648 A
(cli)126 1362 A
6030 V
(08492)210 648 A
(movb)168 1362 A
(ah,)126 1698 A
1866(\3041)S
6120 V
(08493)210 648 A
(rolb)168 1362 A
(ah,)126 1698 A
1866(cl)S
2706(!)S
2790(ah)S
2916(=)S
(\304\(1)126 3000 A
3168(<<)S
(\(irq)168 3294 A
3504(%)S
(8\)\))126 3588 A
6210 V
(08494)210 648 A
(cmpb)168 1362 A
(cl,)126 1698 A
1866(8)S
8418 V
EP
%%Page: 106 106
BP
/slant 0 def
/height 0 def
630 V
12 B
(106)180 648 A
11 R
1982(File:)S
(src/kernel/klib386.s)878 2215 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(08495)210 648 A
(jae)126 1362 A
(enable_8)336 1698 A
2706(!)S
(enable)252 2790 A
(irq)126 3084 A
3252(>=)S
3378(8)S
3462(at)S
(the)126 3588 A
(slave)210 3756 A
(8259)168 4008 A
990 V
(08496)210 648 A
(enable_0:)378 1026 A
1080 V
(08497)210 648 A
(inb)126 1362 A
(INT_CTLMASK)462 1698 A
1170 V
(08498)210 648 A
(andb)168 1362 A
(al,)126 1698 A
1866(ah)S
1260 V
(08499)210 648 A
(outb)168 1362 A
(INT_CTLMASK)462 1698 A
2706(!)S
(clear)210 2790 A
(bit)126 3042 A
3210(at)S
(master)252 3336 A
(8259)168 3630 A
1350 V
(08500)210 648 A
(popf)168 1362 A
1440 V
(08501)210 648 A
(ret)126 1362 A
1530 V
(08502)210 648 A
(.align)252 1362 A
1698(4)S
1620 V
(08503)210 648 A
(enable_8:)378 1026 A
1710 V
(08504)210 648 A
(inb)126 1362 A
(INT2_CTLMASK)504 1698 A
1800 V
(08505)210 648 A
(andb)168 1362 A
(al,)126 1698 A
1866(ah)S
1890 V
(08506)210 648 A
(outb)168 1362 A
(INT2_CTLMASK)504 1698 A
2706(!)S
(clear)210 2790 A
(bit)126 3042 A
3210(at)S
(slave)210 3336 A
(8259)168 3588 A
1980 V
(08507)210 648 A
(popf)168 1362 A
2070 V
(08508)210 648 A
(ret)126 1362 A
2160 V
(08509)210 648 A
2250 V
(08510)210 648 A
2340 V
(08511)210 648 A
(!*==========================================================================*)3234 1026 A
2430 V
(08512)210 648 A
1026(!*)S
(disable_irq)462 2370 A
4218(*)S
2520 V
(08513)210 648 A
(!*==========================================================================*/)3276 1026 A
2610 V
(08514)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(int)126 1404 A
(disable_irq\(unsigned)840 1572 A
(irq\))168 2454 A
2700 V
(08515)210 648 A
1026(!)S
(Disable)294 1110 A
1446(an)S
(interrupt)378 1572 A
(request)294 1992 A
(line)168 2328 A
2538(by)S
(setting)294 2664 A
3000(an)S
(8259)168 3126 A
(bit.)168 3336 A
2790 V
(08516)210 648 A
1026(!)S
(Equivalent)420 1110 A
(code)168 1572 A
(for)126 1782 A
(irq)126 1950 A
2118(<)S
2202(8:)S
2880 V
(08517)210 648 A
1026(!)S
(out_byte\(INT_CTLMASK,)882 1362 A
(in_byte\(INT_CTLMASK\))840 2286 A
3168(|)S
3252(\(1)S
3378(<<)S
(irq\)\);)252 3504 A
2970 V
(08518)210 648 A
1026(!)S
(Returns)294 1110 A
(true)168 1446 A
(iff)126 1656 A
(the)126 1824 A
(interrupt)378 1992 A
(was)126 2412 A
(not)126 2580 A
(already)294 2748 A
(disabled.)378 3084 A
3060 V
(08519)210 648 A
3150 V
(08520)210 648 A
(.align)252 1362 A
1698(16)S
3240 V
(08521)210 648 A
(_disable_irq:)546 1026 A
3330 V
(08522)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(4\(esp\))252 1908 A
2706(!)S
(irq)126 2790 A
3420 V
(08523)210 648 A
(pushf)210 1362 A
3510 V
(08524)210 648 A
(cli)126 1362 A
3600 V
(08525)210 648 A
(movb)168 1362 A
(ah,)126 1698 A
1866(1)S
3690 V
(08526)210 648 A
(rolb)168 1362 A
(ah,)126 1698 A
1866(cl)S
2706(!)S
2790(ah)S
2916(=)S
3000(\(1)S
3126(<<)S
(\(irq)168 3252 A
3462(%)S
(8\)\))126 3546 A
3780 V
(08527)210 648 A
(cmpb)168 1362 A
(cl,)126 1698 A
1866(8)S
3870 V
(08528)210 648 A
(jae)126 1362 A
(disable_8)378 1698 A
2706(!)S
(disable)294 2790 A
(irq)126 3126 A
3294(>=)S
3420(8)S
3504(at)S
(the)126 3630 A
(slave)210 3798 A
(8259)168 4050 A
3960 V
(08529)210 648 A
(disable_0:)420 1026 A
4050 V
(08530)210 648 A
(inb)126 1362 A
(INT_CTLMASK)462 1698 A
4140 V
(08531)210 648 A
(testb)210 1362 A
(al,)126 1698 A
1866(ah)S
4230 V
(08532)210 648 A
(jnz)126 1362 A
(dis_already)462 1698 A
2706(!)S
(already)294 2790 A
(disabled?)378 3126 A
4320 V
(08533)210 648 A
(orb)126 1362 A
(al,)126 1698 A
1866(ah)S
4410 V
(08534)210 648 A
(outb)168 1362 A
(INT_CTLMASK)462 1698 A
2706(!)S
(set)126 2790 A
(bit)126 2958 A
3126(at)S
(master)252 3252 A
(8259)168 3546 A
4500 V
(08535)210 648 A
(popf)168 1362 A
4590 V
(08536)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
1908(1)S
2706(!)S
(disabled)336 2790 A
3168(by)S
(this)168 3294 A
(function)336 3504 A
4680 V
(08537)210 648 A
(ret)126 1362 A
4770 V
(08538)210 648 A
(disable_8:)420 1026 A
4860 V
(08539)210 648 A
(inb)126 1362 A
(INT2_CTLMASK)504 1698 A
4950 V
(08540)210 648 A
(testb)210 1362 A
(al,)126 1698 A
1866(ah)S
5040 V
(08541)210 648 A
(jnz)126 1362 A
(dis_already)462 1698 A
2706(!)S
(already)294 2790 A
(disabled?)378 3126 A
5130 V
(08542)210 648 A
(orb)126 1362 A
(al,)126 1698 A
1866(ah)S
5220 V
(08543)210 648 A
(outb)168 1362 A
(INT2_CTLMASK)504 1698 A
2706(!)S
(set)126 2790 A
(bit)126 2958 A
3126(at)S
(slave)210 3252 A
(8259)168 3504 A
5310 V
(08544)210 648 A
(popf)168 1362 A
5400 V
(08545)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
1908(1)S
2706(!)S
(disabled)336 2790 A
3168(by)S
(this)168 3294 A
(function)336 3504 A
5490 V
(08546)210 648 A
(ret)126 1362 A
5580 V
(08547)210 648 A
(dis_already:)504 1026 A
5670 V
(08548)210 648 A
(popf)168 1362 A
5760 V
(08549)210 648 A
(xor)126 1362 A
(eax,)168 1698 A
(eax)126 1908 A
2706(!)S
(already)294 2790 A
(disabled)336 3126 A
5850 V
(08550)210 648 A
(ret)126 1362 A
5940 V
(08551)210 648 A
6030 V
(08552)210 648 A
6120 V
(08553)210 648 A
(!*===========================================================================*)3276 1026 A
6210 V
(08554)210 648 A
1026(!*)S
(phys_copy)378 2370 A
4260(*)S
8418 V
EP
%%Page: 107 107
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1982(File:)S
(src/kernel/klib386.s)878 2215 A
12 B
(107)180 4248 A
900 V
7 LST
(08555)210 648 A
(!*===========================================================================*)3276 1026 A
990 V
(08556)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(phys_copy\(phys_bytes)840 1614 A
(source,)294 2496 A
(phys_bytes)420 2832 A
(destination,)504 3294 A
1080 V
(08557)210 648 A
1026(!)S
(phys_bytes)420 2034 A
(bytecount\);)462 2496 A
1170 V
(08558)210 648 A
1026(!)S
(Copy)168 1110 A
1320(a)S
(block)210 1404 A
1656(of)S
(physical)336 1782 A
(memory.)294 2160 A
1260 V
(08559)210 648 A
1350 V
(08560)210 648 A
(PC_ARGS)294 1026 A
1362(=)S
1698(4)S
1782(+)S
1866(4)S
1950(+)S
2034(4)S
2118(+)S
2202(4)S
2370(!)S
2454(4)S
2538(+)S
2622(4)S
2706(+)S
2790(4)S
1440 V
(08561)210 648 A
1026(!)S
1698(es)S
(edi)126 1824 A
(esi)126 1992 A
(eip)126 2160 A
(src)126 2412 A
(dst)126 2580 A
(len)126 2748 A
1530 V
(08562)210 648 A
1620 V
(08563)210 648 A
(.align)252 1362 A
1698(16)S
1710 V
(08564)210 648 A
(_phys_copy:)462 1026 A
1800 V
(08565)210 648 A
(cld)126 1362 A
1890 V
(08566)210 648 A
(push)168 1362 A
(esi)126 1698 A
1980 V
(08567)210 648 A
(push)168 1362 A
(edi)126 1698 A
2070 V
(08568)210 648 A
(push)168 1362 A
1698(es)S
2160 V
(08569)210 648 A
2250 V
(08570)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(FLAT_DS_SELECTOR)672 1908 A
2340 V
(08571)210 648 A
(mov)126 1362 A
(es,)126 1698 A
1866(ax)S
2430 V
(08572)210 648 A
2520 V
(08573)210 648 A
(mov)126 1362 A
(esi,)168 1698 A
(PC_ARGS\(esp\))504 1908 A
2610 V
(08574)210 648 A
(mov)126 1362 A
(edi,)168 1698 A
(PC_ARGS+4\(esp\))588 1908 A
2700 V
(08575)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(PC_ARGS+4+4\(esp\))672 1908 A
2790 V
(08576)210 648 A
2880 V
(08577)210 648 A
(cmp)126 1362 A
(eax,)168 1698 A
1908(10)S
2706(!)S
(avoid)210 2790 A
(align)210 3042 A
(overhead)336 3294 A
(for)126 3672 A
(small)210 3840 A
(counts)252 4092 A
2970 V
(08578)210 648 A
1362(jb)S
(pc_small)336 1698 A
3060 V
(08579)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(esi)126 1908 A
2706(!)S
(align)210 2790 A
(source,)294 3042 A
(hope)168 3378 A
(target)252 3588 A
3882(is)S
(too)126 4008 A
3150 V
(08580)210 648 A
(neg)126 1362 A
(ecx)126 1698 A
3240 V
(08581)210 648 A
(and)126 1362 A
(ecx,)168 1698 A
1908(3)S
2706(!)S
(count)210 2790 A
(for)126 3042 A
(alignment)378 3210 A
3330 V
(08582)210 648 A
(sub)126 1362 A
(eax,)168 1698 A
(ecx)126 1908 A
3420 V
(08583)210 648 A
(rep)126 1362 A
3510 V
(08584)210 648 A
(eseg)168 1152 A
(movsb)210 1362 A
3600 V
(08585)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(eax)126 1908 A
3690 V
(08586)210 648 A
(shr)126 1362 A
(ecx,)168 1698 A
1908(2)S
2706(!)S
(count)210 2790 A
3042(of)S
(dwords)252 3168 A
3780 V
(08587)210 648 A
(rep)126 1362 A
3870 V
(08588)210 648 A
(eseg)168 1152 A
(movs)168 1362 A
3960 V
(08589)210 648 A
(and)126 1362 A
(eax,)168 1698 A
1908(3)S
4050 V
(08590)210 648 A
(pc_small:)378 1026 A
4140 V
(08591)210 648 A
(xchg)168 1362 A
(ecx,)168 1698 A
(eax)126 1908 A
2706(!)S
(remainder)378 2790 A
4230 V
(08592)210 648 A
(rep)126 1362 A
4320 V
(08593)210 648 A
(eseg)168 1152 A
(movsb)210 1362 A
4410 V
(08594)210 648 A
4500 V
(08595)210 648 A
(pop)126 1362 A
1698(es)S
4590 V
(08596)210 648 A
(pop)126 1362 A
(edi)126 1698 A
4680 V
(08597)210 648 A
(pop)126 1362 A
(esi)126 1698 A
4770 V
(08598)210 648 A
(ret)126 1362 A
4860 V
(08599)210 648 A
4950 V
(08600)210 648 A
5040 V
(08601)210 648 A
(!*===========================================================================*)3276 1026 A
5130 V
(08602)210 648 A
1026(!*)S
(mem_rdw)294 2370 A
4260(*)S
5220 V
(08603)210 648 A
(!*===========================================================================*)3276 1026 A
5310 V
(08604)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(u16_t)210 1404 A
(mem_rdw\(U16_t)546 1656 A
(segment,)336 2244 A
(u16_t)210 2622 A
(*offset\);)378 2874 A
5400 V
(08605)210 648 A
1026(!)S
(Load)168 1110 A
(and)126 1320 A
(return)252 1488 A
(word)168 1782 A
1992(at)S
(far)126 2118 A
(pointer)294 2286 A
(segment:offset.)630 2622 A
5490 V
(08606)210 648 A
5580 V
(08607)210 648 A
(.align)252 1362 A
1698(16)S
5670 V
(08608)210 648 A
(_mem_rdw:)378 1026 A
5760 V
(08609)210 648 A
(mov)126 1362 A
(cx,)126 1698 A
1866(ds)S
5850 V
(08610)210 648 A
(mov)126 1362 A
(ds,)126 1698 A
(4\(esp\))252 1866 A
2706(!)S
(segment)294 2790 A
5940 V
(08611)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(4+4\(esp\))336 1908 A
2706(!)S
(offset)252 2790 A
6030 V
(08612)210 648 A
(movzx)210 1362 A
(eax,)168 1698 A
(\(eax\))210 1908 A
2706(!)S
(word)168 2790 A
3000(to)S
(return)252 3126 A
6120 V
(08613)210 648 A
(mov)126 1362 A
(ds,)126 1698 A
1866(cx)S
6210 V
(08614)210 648 A
(ret)126 1362 A
8418 V
EP
%%Page: 108 108
BP
/slant 0 def
/height 0 def
630 V
12 B
(108)180 648 A
11 R
1982(File:)S
(src/kernel/klib386.s)878 2215 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(08615)210 648 A
990 V
(08616)210 648 A
1080 V
(08617)210 648 A
(!*===========================================================================*)3276 1026 A
1170 V
(08618)210 648 A
1026(!*)S
(reset)210 2370 A
4260(*)S
1260 V
(08619)210 648 A
(!*===========================================================================*)3276 1026 A
1350 V
(08620)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(reset\(\);)336 1614 A
1440 V
(08621)210 648 A
1026(!)S
(Reset)210 1110 A
(the)126 1362 A
(system)252 1530 A
1824(by)S
(loading)294 1950 A
(IDT)126 2286 A
(with)168 2454 A
(offset)252 2664 A
2958(0)S
(and)126 3042 A
(interrupting.)546 3210 A
1530 V
(08622)210 648 A
1620 V
(08623)210 648 A
(_reset:)294 1026 A
1710 V
(08624)210 648 A
(lidt)168 1362 A
(\(idt_zero\))420 1698 A
1800 V
(08625)210 648 A
(int)126 1362 A
1698(3)S
2370(!)S
(anything)336 2454 A
(goes,)210 2832 A
(the)126 3084 A
(386)126 3252 A
(will)168 3420 A
(not)126 3630 A
(like)168 3798 A
4008(it)S
1890 V
(08626)210 648 A
(.sect)210 1026 A
(.data)210 1278 A
1980 V
(08627)210 648 A
(idt_zero:)378 1026 A
(.data4)252 1698 A
2034(0,)S
2160(0)S
2070 V
(08628)210 648 A
(.sect)210 1026 A
(.text)210 1278 A
2160 V
(08629)210 648 A
2250 V
(08630)210 648 A
2340 V
(08631)210 648 A
(!*===========================================================================*)3276 1026 A
2430 V
(08632)210 648 A
1026(!*)S
(mem_vid_copy)504 2370 A
4260(*)S
2520 V
(08633)210 648 A
(!*===========================================================================*)3276 1026 A
2610 V
(08634)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(mem_vid_copy\(u16)672 1614 A
(*src,)210 2328 A
(unsigned)336 2580 A
(dst,)168 2958 A
(unsigned)336 3168 A
(count\);)294 3546 A
2700 V
(08635)210 648 A
1026(!)S
2790 V
(08636)210 648 A
1026(!)S
(Copy)168 1110 A
(count)210 1320 A
(characters)420 1572 A
(from)168 2034 A
(kernel)252 2244 A
(memory)252 2538 A
2832(to)S
(video)210 2958 A
(memory.)294 3210 A
(Src,)168 3588 A
(dst)126 3798 A
(and)126 3966 A
2880 V
(08637)210 648 A
1026(!)S
(count)210 1110 A
(are)126 1362 A
(character)378 1530 A
(\(word\))252 1950 A
(based)210 2244 A
(video)210 2496 A
(offsets)294 2748 A
(and)126 3084 A
(counts.)294 3252 A
3630(If)S
(src)126 3756 A
3924(is)S
(null)168 4050 A
2970 V
(08638)210 648 A
1026(!)S
(then)168 1110 A
(screen)252 1320 A
(memory)252 1614 A
1908(is)S
(blanked)294 2034 A
2370(by)S
(filling)294 2496 A
2832(it)S
(with)168 2958 A
(blank_color.)504 3168 A
3060 V
(08639)210 648 A
3150 V
(08640)210 648 A
(MVC_ARGS)336 1026 A
1698(=)S
2034(4)S
2118(+)S
2202(4)S
2286(+)S
2370(4)S
2454(+)S
2538(4)S
2706(!)S
2790(4)S
2874(+)S
2958(4)S
3042(+)S
3126(4)S
3240 V
(08641)210 648 A
1026(!)S
2034(es)S
(edi)126 2160 A
(esi)126 2328 A
(eip)126 2496 A
(src)126 2748 A
(dst)126 2916 A
3084(ct)S
3330 V
(08642)210 648 A
3420 V
(08643)210 648 A
(_mem_vid_copy:)588 1026 A
3510 V
(08644)210 648 A
(push)168 1362 A
(esi)126 1698 A
3600 V
(08645)210 648 A
(push)168 1362 A
(edi)126 1698 A
3690 V
(08646)210 648 A
(push)168 1362 A
1698(es)S
3780 V
(08647)210 648 A
(mov)126 1362 A
(esi,)168 1698 A
(MVC_ARGS\(esp\))546 1908 A
2706(!)S
(source)252 2790 A
3870 V
(08648)210 648 A
(mov)126 1362 A
(edi,)168 1698 A
(MVC_ARGS+4\(esp\))630 1908 A
2706(!)S
(destination)462 2790 A
3960 V
(08649)210 648 A
(mov)126 1362 A
(edx,)168 1698 A
(MVC_ARGS+4+4\(esp\))714 1908 A
2706(!)S
(count)210 2790 A
4050 V
(08650)210 648 A
(mov)126 1362 A
(es,)126 1698 A
(\(_vid_seg\))420 1866 A
2706(!)S
(destination)462 2790 A
3294(is)S
(video)210 3420 A
(segment)294 3672 A
4140 V
(08651)210 648 A
(cld)126 1362 A
2706(!)S
(make)168 2790 A
(sure)168 3000 A
(direction)378 3210 A
3630(is)S
3756(up)S
4230 V
(08652)210 648 A
(mvc_loop:)378 1026 A
4320 V
(08653)210 648 A
(and)126 1362 A
(edi,)168 1698 A
(\(_vid_mask\))462 1908 A
2706(!)S
(wrap)168 2790 A
(address)294 3000 A
4410 V
(08654)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(edx)126 1908 A
2706(!)S
(one)126 2790 A
(chunk)210 2958 A
3210(to)S
(copy)168 3336 A
4500 V
(08655)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(\(_vid_size\))462 1908 A
4590 V
(08656)210 648 A
(sub)126 1362 A
(eax,)168 1698 A
(edi)126 1908 A
4680 V
(08657)210 648 A
(cmp)126 1362 A
(ecx,)168 1698 A
(eax)126 1908 A
4770 V
(08658)210 648 A
(jbe)126 1362 A
1698(0f)S
4860 V
(08659)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(eax)126 1908 A
2706(!)S
(ecx)126 2790 A
2958(=)S
(min\(ecx,)336 3042 A
(vid_size)336 3420 A
3798(-)S
(edi\))168 3882 A
4950 V
(08660)210 648 A
1026(0:)S
(sub)126 1362 A
(edx,)168 1698 A
(ecx)126 1908 A
2706(!)S
(count)210 2790 A
3042(-=)S
(ecx)126 3168 A
5040 V
(08661)210 648 A
(shl)126 1362 A
(edi,)168 1698 A
1908(1)S
2706(!)S
(byte)168 2790 A
(address)294 3000 A
5130 V
(08662)210 648 A
(test)168 1362 A
(esi,)168 1698 A
(esi)126 1908 A
2706(!)S
(source)252 2790 A
3084(==)S
3210(0)S
(means)210 3294 A
(blank)210 3546 A
(the)126 3798 A
(screen)252 3966 A
5220 V
(08663)210 648 A
1362(jz)S
(mvc_blank)378 1698 A
5310 V
(08664)210 648 A
(mvc_copy:)378 1026 A
5400 V
(08665)210 648 A
(rep)126 1362 A
2706(!)S
(copy)168 2790 A
(words)210 3000 A
3252(to)S
(video)210 3378 A
(memory)252 3630 A
5490 V
(08666)210 648 A
(o16)126 1194 A
(movs)168 1362 A
5580 V
(08667)210 648 A
(jmp)126 1362 A
(mvc_test)336 1698 A
5670 V
(08668)210 648 A
(mvc_blank:)420 1026 A
5760 V
(08669)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(\(_blank_color\))588 1908 A
2706(!)S
2790(ax)S
2916(=)S
(blanking)336 3000 A
(character)378 3378 A
5850 V
(08670)210 648 A
(rep)126 1362 A
5940 V
(08671)210 648 A
(o16)126 1194 A
(stos)168 1362 A
2706(!)S
(copy)168 2790 A
(blanks)252 3000 A
3294(to)S
(video)210 3420 A
(memory)252 3672 A
6030 V
(08672)210 648 A
(!jmp)168 1362 A
(mvc_test)336 1698 A
6120 V
(08673)210 648 A
(mvc_test:)378 1026 A
6210 V
(08674)210 648 A
(shr)126 1362 A
(edi,)168 1698 A
1908(1)S
2706(!)S
(word)168 2790 A
(addresses)378 3000 A
8418 V
EP
%%Page: 109 109
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1982(File:)S
(src/kernel/klib386.s)878 2215 A
12 B
(109)180 4248 A
900 V
7 LST
(08675)210 648 A
(test)168 1362 A
(edx,)168 1698 A
(edx)126 1908 A
990 V
(08676)210 648 A
(jnz)126 1362 A
(mvc_loop)336 1698 A
1080 V
(08677)210 648 A
(mvc_done:)378 1026 A
1170 V
(08678)210 648 A
(pop)126 1362 A
1698(es)S
1260 V
(08679)210 648 A
(pop)126 1362 A
(edi)126 1698 A
1350 V
(08680)210 648 A
(pop)126 1362 A
(esi)126 1698 A
1440 V
(08681)210 648 A
(ret)126 1362 A
1530 V
(08682)210 648 A
1620 V
(08683)210 648 A
1710 V
(08684)210 648 A
(!*===========================================================================*)3276 1026 A
1800 V
(08685)210 648 A
1026(!*)S
(vid_vid_copy)504 2370 A
4260(*)S
1890 V
(08686)210 648 A
(!*===========================================================================*)3276 1026 A
1980 V
(08687)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(vid_vid_copy\(unsigned)882 1614 A
(src,)168 2538 A
(unsigned)336 2748 A
(dst,)168 3126 A
(unsigned)336 3336 A
(count\);)294 3714 A
2070 V
(08688)210 648 A
1026(!)S
2160 V
(08689)210 648 A
1026(!)S
(Copy)168 1110 A
(count)210 1320 A
(characters)420 1572 A
(from)168 2034 A
(video)210 2244 A
(memory)252 2496 A
2790(to)S
(video)210 2916 A
(memory.)294 3168 A
(Handle)252 3546 A
(overlap.)336 3840 A
2250 V
(08690)210 648 A
1026(!)S
(Used)168 1110 A
(for)126 1320 A
(scrolling,)420 1488 A
(line)168 1950 A
2160(or)S
(character)378 2286 A
(insertion)378 2706 A
(and)126 3126 A
(deletion.)378 3294 A
(Src,)168 3756 A
(dst)126 3966 A
2340 V
(08691)210 648 A
1026(!)S
(and)126 1110 A
(count)210 1278 A
(are)126 1530 A
(character)378 1698 A
(\(word\))252 2118 A
(based)210 2412 A
(video)210 2664 A
(offsets)294 2916 A
(and)126 3252 A
(counts.)294 3420 A
2430 V
(08692)210 648 A
2520 V
(08693)210 648 A
(VVC_ARGS)336 1026 A
1698(=)S
2034(4)S
2118(+)S
2202(4)S
2286(+)S
2370(4)S
2454(+)S
2538(4)S
2706(!)S
2790(4)S
2874(+)S
2958(4)S
3042(+)S
3126(4)S
2610 V
(08694)210 648 A
1026(!)S
2034(es)S
(edi)126 2160 A
(esi)126 2328 A
(eip)126 2496 A
(src)126 2748 A
(dst)126 2916 A
3084(ct)S
2700 V
(08695)210 648 A
2790 V
(08696)210 648 A
(_vid_vid_copy:)588 1026 A
2880 V
(08697)210 648 A
(push)168 1362 A
(esi)126 1698 A
2970 V
(08698)210 648 A
(push)168 1362 A
(edi)126 1698 A
3060 V
(08699)210 648 A
(push)168 1362 A
1698(es)S
3150 V
(08700)210 648 A
(mov)126 1362 A
(esi,)168 1698 A
(VVC_ARGS\(esp\))546 1908 A
2706(!)S
(source)252 2790 A
3240 V
(08701)210 648 A
(mov)126 1362 A
(edi,)168 1698 A
(VVC_ARGS+4\(esp\))630 1908 A
2706(!)S
(destination)462 2790 A
3330 V
(08702)210 648 A
(mov)126 1362 A
(edx,)168 1698 A
(VVC_ARGS+4+4\(esp\))714 1908 A
2706(!)S
(count)210 2790 A
3420 V
(08703)210 648 A
(mov)126 1362 A
(es,)126 1698 A
(\(_vid_seg\))420 1866 A
2706(!)S
(use)126 2790 A
(video)210 2958 A
(segment)294 3210 A
3510 V
(08704)210 648 A
(cmp)126 1362 A
(esi,)168 1698 A
(edi)126 1908 A
2706(!)S
(copy)168 2790 A
3000(up)S
3126(or)S
(down?)210 3252 A
3600 V
(08705)210 648 A
1362(jb)S
(vvc_down)336 1698 A
3690 V
(08706)210 648 A
(vvc_up:)294 1026 A
3780 V
(08707)210 648 A
(cld)126 1362 A
2706(!)S
(direction)378 2790 A
3210(is)S
3336(up)S
3870 V
(08708)210 648 A
(vvc_uploop:)462 1026 A
3960 V
(08709)210 648 A
(and)126 1362 A
(esi,)168 1698 A
(\(_vid_mask\))462 1908 A
2706(!)S
(wrap)168 2790 A
(addresses)378 3000 A
4050 V
(08710)210 648 A
(and)126 1362 A
(edi,)168 1698 A
(\(_vid_mask\))462 1908 A
4140 V
(08711)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(edx)126 1908 A
2706(!)S
(one)126 2790 A
(chunk)210 2958 A
3210(to)S
(copy)168 3336 A
4230 V
(08712)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(\(_vid_size\))462 1908 A
4320 V
(08713)210 648 A
(sub)126 1362 A
(eax,)168 1698 A
(esi)126 1908 A
4410 V
(08714)210 648 A
(cmp)126 1362 A
(ecx,)168 1698 A
(eax)126 1908 A
4500 V
(08715)210 648 A
(jbe)126 1362 A
1698(0f)S
4590 V
(08716)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(eax)126 1908 A
2706(!)S
(ecx)126 2790 A
2958(=)S
(min\(ecx,)336 3042 A
(vid_size)336 3420 A
3798(-)S
(esi\))168 3882 A
4680 V
(08717)210 648 A
1026(0:)S
(mov)126 1362 A
(eax,)168 1698 A
(\(_vid_size\))462 1908 A
4770 V
(08718)210 648 A
(sub)126 1362 A
(eax,)168 1698 A
(edi)126 1908 A
4860 V
(08719)210 648 A
(cmp)126 1362 A
(ecx,)168 1698 A
(eax)126 1908 A
4950 V
(08720)210 648 A
(jbe)126 1362 A
1698(0f)S
5040 V
(08721)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(eax)126 1908 A
2706(!)S
(ecx)126 2790 A
2958(=)S
(min\(ecx,)336 3042 A
(vid_size)336 3420 A
3798(-)S
(edi\))168 3882 A
5130 V
(08722)210 648 A
1026(0:)S
(sub)126 1362 A
(edx,)168 1698 A
(ecx)126 1908 A
2706(!)S
(count)210 2790 A
3042(-=)S
(ecx)126 3168 A
5220 V
(08723)210 648 A
(shl)126 1362 A
(esi,)168 1698 A
1908(1)S
5310 V
(08724)210 648 A
(shl)126 1362 A
(edi,)168 1698 A
1908(1)S
2706(!)S
(byte)168 2790 A
(addresses)378 3000 A
5400 V
(08725)210 648 A
(rep)126 1362 A
5490 V
(08726)210 648 A
(eseg)168 1026 A
(o16)126 1236 A
(movs)168 1404 A
2706(!)S
(copy)168 2790 A
(video)210 3000 A
(words)210 3252 A
5580 V
(08727)210 648 A
(shr)126 1362 A
(esi,)168 1698 A
1908(1)S
5670 V
(08728)210 648 A
(shr)126 1362 A
(edi,)168 1698 A
1908(1)S
2706(!)S
(word)168 2790 A
(addresses)378 3000 A
5760 V
(08729)210 648 A
(test)168 1362 A
(edx,)168 1698 A
(edx)126 1908 A
5850 V
(08730)210 648 A
(jnz)126 1362 A
(vvc_uploop)420 1698 A
2706(!)S
(again?)252 2790 A
5940 V
(08731)210 648 A
(jmp)126 1362 A
(vvc_done)336 1698 A
6030 V
(08732)210 648 A
(vvc_down:)378 1026 A
6120 V
(08733)210 648 A
(std)126 1362 A
2706(!)S
(direction)378 2790 A
3210(is)S
(down)168 3336 A
6210 V
(08734)210 648 A
(lea)126 1362 A
(esi,)168 1698 A
(-1\(esi\)\(edx*1\))588 1908 A
2706(!)S
(start)210 2790 A
(copying)294 3042 A
3378(at)S
(the)126 3504 A
(top)126 3672 A
8418 V
EP
%%Page: 110 110
BP
/slant 0 def
/height 0 def
630 V
12 B
(110)180 648 A
11 R
1982(File:)S
(src/kernel/klib386.s)878 2215 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(08735)210 648 A
(lea)126 1362 A
(edi,)168 1698 A
(-1\(edi\)\(edx*1\))588 1908 A
990 V
(08736)210 648 A
(vvc_downloop:)546 1026 A
1080 V
(08737)210 648 A
(and)126 1362 A
(esi,)168 1698 A
(\(_vid_mask\))462 1908 A
2706(!)S
(wrap)168 2790 A
(addresses)378 3000 A
1170 V
(08738)210 648 A
(and)126 1362 A
(edi,)168 1698 A
(\(_vid_mask\))462 1908 A
1260 V
(08739)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(edx)126 1908 A
2706(!)S
(one)126 2790 A
(chunk)210 2958 A
3210(to)S
(copy)168 3336 A
1350 V
(08740)210 648 A
(lea)126 1362 A
(eax,)168 1698 A
(1\(esi\))252 1908 A
1440 V
(08741)210 648 A
(cmp)126 1362 A
(ecx,)168 1698 A
(eax)126 1908 A
1530 V
(08742)210 648 A
(jbe)126 1362 A
1698(0f)S
1620 V
(08743)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(eax)126 1908 A
2706(!)S
(ecx)126 2790 A
2958(=)S
(min\(ecx,)336 3042 A
(esi)126 3420 A
3588(+)S
3672(1\))S
1710 V
(08744)210 648 A
1026(0:)S
(lea)126 1362 A
(eax,)168 1698 A
(1\(edi\))252 1908 A
1800 V
(08745)210 648 A
(cmp)126 1362 A
(ecx,)168 1698 A
(eax)126 1908 A
1890 V
(08746)210 648 A
(jbe)126 1362 A
1698(0f)S
1980 V
(08747)210 648 A
(mov)126 1362 A
(ecx,)168 1698 A
(eax)126 1908 A
2706(!)S
(ecx)126 2790 A
2958(=)S
(min\(ecx,)336 3042 A
(edi)126 3420 A
3588(+)S
3672(1\))S
2070 V
(08748)210 648 A
1026(0:)S
(sub)126 1362 A
(edx,)168 1698 A
(ecx)126 1908 A
2706(!)S
(count)210 2790 A
3042(-=)S
(ecx)126 3168 A
2160 V
(08749)210 648 A
(shl)126 1362 A
(esi,)168 1698 A
1908(1)S
2250 V
(08750)210 648 A
(shl)126 1362 A
(edi,)168 1698 A
1908(1)S
2706(!)S
(byte)168 2790 A
(addresses)378 3000 A
2340 V
(08751)210 648 A
(rep)126 1362 A
2430 V
(08752)210 648 A
(eseg)168 1026 A
(o16)126 1236 A
(movs)168 1404 A
2706(!)S
(copy)168 2790 A
(video)210 3000 A
(words)210 3252 A
2520 V
(08753)210 648 A
(shr)126 1362 A
(esi,)168 1698 A
1908(1)S
2610 V
(08754)210 648 A
(shr)126 1362 A
(edi,)168 1698 A
1908(1)S
2706(!)S
(word)168 2790 A
(addresses)378 3000 A
2700 V
(08755)210 648 A
(test)168 1362 A
(edx,)168 1698 A
(edx)126 1908 A
2790 V
(08756)210 648 A
(jnz)126 1362 A
(vvc_downloop)504 1698 A
2706(!)S
(again?)252 2790 A
2880 V
(08757)210 648 A
(cld)126 1362 A
2706(!)S
2790(C)S
(compiler)336 2874 A
(expect)252 3252 A
3546(up)S
2970 V
(08758)210 648 A
(!jmp)168 1362 A
(vvc_done)336 1698 A
3060 V
(08759)210 648 A
(vvc_done:)378 1026 A
3150 V
(08760)210 648 A
(pop)126 1362 A
1698(es)S
3240 V
(08761)210 648 A
(pop)126 1362 A
(edi)126 1698 A
3330 V
(08762)210 648 A
(pop)126 1362 A
(esi)126 1698 A
3420 V
(08763)210 648 A
(ret)126 1362 A
3510 V
(08764)210 648 A
3600 V
(08765)210 648 A
3690 V
(08766)210 648 A
(!*===========================================================================*)3276 1026 A
3780 V
(08767)210 648 A
1026(!*)S
(level0)252 2286 A
4260(*)S
3870 V
(08768)210 648 A
(!*===========================================================================*)3276 1026 A
3960 V
(08769)210 648 A
1026(!)S
(PUBLIC)252 1110 A
(void)168 1404 A
(level0\(void)462 1614 A
(\(*func\)\(void\)\))588 2118 A
4050 V
(08770)210 648 A
1026(!)S
(Call)168 1110 A
1320(a)S
(function)336 1404 A
1782(at)S
(permission)420 1908 A
(level)210 2370 A
2622(0.)S
(This)168 2790 A
(allows)252 3000 A
(kernel)252 3294 A
(tasks)210 3588 A
3840(to)S
3966(do)S
4140 V
(08771)210 648 A
1026(!)S
(things)252 1110 A
(that)168 1404 A
(are)126 1614 A
(only)168 1782 A
(possible)336 1992 A
2370(at)S
(the)126 2496 A
(most)168 2664 A
(privileged)420 2874 A
(CPU)126 3336 A
(level.)252 3504 A
4230 V
(08772)210 648 A
1026(!)S
4320 V
(08773)210 648 A
(_level0:)336 1026 A
4410 V
(08774)210 648 A
(mov)126 1362 A
(eax,)168 1698 A
(4\(esp\))252 1908 A
4500 V
(08775)210 648 A
(mov)126 1362 A
(\(_level0_func\),)630 1698 A
(eax)126 2370 A
4590 V
(08776)210 648 A
(int)126 1362 A
(LEVEL0_VECTOR)546 1698 A
4680 V
(08777)210 648 A
(ret)126 1362 A
5040 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5130 V
(src/kernel/misc.c)714 2034 A
5220 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5400 V
(08800)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
1950(a)S
(collection)420 2034 A
2496(of)S
(miscellaneous)546 2622 A
(procedures:)462 3210 A
5490 V
(08801)210 648 A
1068(*)S
(mem_init:)378 1362 A
(initialize)420 2034 A
(memory)252 2496 A
(tables.)294 2790 A
(Some)168 3168 A
(memory)252 3378 A
3672(is)S
(reported)336 3798 A
5580 V
(08802)210 648 A
1068(*)S
2034(by)S
(the)126 2160 A
(BIOS,)210 2328 A
(some)168 2580 A
2790(is)S
(guesstimated)504 2916 A
(and)126 3462 A
(checked)294 3630 A
(later)210 3966 A
5670 V
(08803)210 648 A
1068(*)S
(env_parse)378 1362 A
(parse)210 2034 A
(environment)462 2286 A
(variable.)378 2790 A
5760 V
(08804)210 648 A
1068(*)S
(bad_assertion)546 1362 A
(for)126 2034 A
(debugging)378 2202 A
5850 V
(08805)210 648 A
1068(*)S
(bad_compare)462 1362 A
(for)126 2034 A
(debugging)378 2202 A
5940 V
(08806)210 648 A
1068(*/)S
6030 V
(08807)210 648 A
6120 V
(08808)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
6210 V
(08809)210 648 A
(#include)336 1026 A
("assert.h")420 1404 A
8418 V
EP
%%Page: 111 111
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2042(File:)S
2275(src/kernel/misc.c)S
12 B
(111)180 4248 A
900 V
7 LST
(08810)210 648 A
(#include)336 1026 A
(<stdlib.h>)420 1404 A
990 V
(08811)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
1080 V
(08812)210 648 A
1170 V
(08813)210 648 A
(#define)294 1026 A
(EM_BASE)294 1362 A
(0x100000L)378 1866 A
2370(/*)S
(base)168 2496 A
2706(of)S
(extended)336 2832 A
(memory)252 3210 A
3504(on)S
(AT's)168 3630 A
3840(*/)S
1260 V
(08814)210 648 A
(#define)294 1026 A
(SHADOW_BASE)462 1362 A
(0xFA0000L)378 1866 A
2370(/*)S
(base)168 2496 A
2706(of)S
(RAM)126 2832 A
(shadowing)378 3000 A
(ROM)126 3420 A
3588(on)S
(some)168 3714 A
(AT's)168 3924 A
4134(*/)S
1350 V
(08815)210 648 A
(#define)294 1026 A
(SHADOW_MAX)420 1362 A
(0x060000L)378 1866 A
2370(/*)S
(maximum)294 2496 A
(usable)252 2832 A
(shadow)252 3126 A
(memory)252 3420 A
(\(16M)168 3714 A
(limit\))252 3924 A
4218(*/)S
1440 V
(08816)210 648 A
1530 V
(08817)210 648 A
(/*=========================================================================*)3192 1026 A
1620 V
(08818)210 648 A
1068(*)S
(mem_init)336 2370 A
4176(*)S
1710 V
(08819)210 648 A
(*=========================================================================*/)3192 1068 A
1800 V
(08820)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(mem_init\(\))420 1530 A
1890 V
(08821)210 648 A
1026({)S
1980 V
(08822)210 648 A
1026(/*)S
(Initialize)420 1152 A
(the)126 1614 A
(memory)252 1782 A
(size)168 2076 A
(tables.)294 2286 A
(This)168 2664 A
2874(is)S
(complicated)462 3000 A
3504(by)S
(fragmentation)546 3630 A
2070 V
(08823)210 648 A
1068(*)S
(and)126 1152 A
(different)378 1320 A
(access)252 1740 A
(strategies)420 2034 A
(for)126 2496 A
(protected)378 2664 A
(mode.)210 3084 A
(There)210 3378 A
(must)168 3630 A
3840(be)S
3966(a)S
2160 V
(08824)210 648 A
1068(*)S
(chunk)210 1152 A
1404(at)S
1530(0)S
(big)126 1614 A
(enough)252 1782 A
2076(to)S
(hold)168 2202 A
(Minix)210 2412 A
(proper.)294 2664 A
(For)126 3042 A
(286)126 3210 A
(and)126 3378 A
(386)126 3546 A
(processors,)462 3714 A
2250 V
(08825)210 648 A
1068(*)S
(there)210 1152 A
(can)126 1404 A
1572(be)S
(extended)336 1698 A
(memory)252 2076 A
(\(memory)294 2370 A
(above)210 2706 A
(1MB\).)210 2958 A
(This)168 3252 A
(usually)294 3462 A
(starts)252 3798 A
4092(at)S
2340 V
(08826)210 648 A
1068(*)S
(1MB,)168 1152 A
(but)126 1362 A
(there)210 1530 A
(may)126 1782 A
1950(be)S
(another)294 2076 A
(chunk)210 2412 A
(just)168 2664 A
(below)210 2874 A
(16MB,)210 3126 A
(reserved)336 3378 A
(under)210 3756 A
(DOS)126 4008 A
2430 V
(08827)210 648 A
1068(*)S
(for)126 1152 A
(shadowing)378 1320 A
(ROM,)168 1740 A
(but)126 1950 A
(available)378 2118 A
2538(to)S
(Minix)210 2664 A
2916(if)S
(the)126 3042 A
(hardware)336 3210 A
(can)126 3588 A
3756(be)S
(re-mapped.)420 3882 A
2520 V
(08828)210 648 A
1068(*)S
1152(In)S
(protected)378 1278 A
(mode,)210 1698 A
(extended)336 1950 A
(memory)252 2328 A
2622(is)S
(accessible)420 2748 A
(assuming)336 3210 A
(CLICK_SIZE)420 3588 A
4050(is)S
2610 V
(08829)210 648 A
1068(*)S
(large)210 1152 A
(enough,)294 1404 A
(and)126 1740 A
1908(is)S
(treated)294 2034 A
2370(as)S
(ordinary)336 2496 A
(memory.)294 2874 A
2700 V
(08830)210 648 A
1068(*/)S
2790 V
(08831)210 648 A
2880 V
(08832)210 648 A
(u32_t)210 1110 A
(ext_clicks;)462 1362 A
2970 V
(08833)210 648 A
(phys_clicks)462 1110 A
(max_clicks;)462 1614 A
3060 V
(08834)210 648 A
3150 V
(08835)210 648 A
1110(/*)S
(Get)126 1236 A
(the)126 1404 A
(size)168 1572 A
1782(of)S
(ordinary)336 1908 A
(memory)252 2286 A
(from)168 2580 A
(the)126 2790 A
(BIOS.)210 2958 A
3210(*/)S
3240 V
(08836)210 648 A
(mem[0].size)462 1110 A
1614(=)S
(k_to_click\(low_memsize\);)1008 1698 A
3042(/*)S
(base)168 3168 A
3378(=)S
3462(0)S
3546(*/)S
3330 V
(08837)210 648 A
3420 V
(08838)210 648 A
1110(if)S
(\(pc_at)252 1236 A
1530(&&)S
(protected_mode\))630 1656 A
2328({)S
3510 V
(08839)210 648 A
1362(/*)S
(Get)126 1488 A
(the)126 1656 A
(size)168 1824 A
2034(of)S
(extended)336 2160 A
(memory)252 2538 A
(from)168 2832 A
(the)126 3042 A
(BIOS.)210 3210 A
(This)168 3504 A
3714(is)S
(special)294 3840 A
3600 V
(08840)210 648 A
1404(*)S
(except)252 1488 A
1782(in)S
(protected)378 1908 A
(mode,)210 2328 A
(but)126 2580 A
(protected)378 2748 A
(mode)168 3168 A
3378(is)S
(now)126 3504 A
(normal.)294 3672 A
3690 V
(08841)210 648 A
1404(*)S
(Note)168 1488 A
(that)168 1698 A
1908(no)S
(more)168 2034 A
(than)168 2244 A
(16M)126 2454 A
(can)126 2622 A
2790(be)S
(addressed)378 2916 A
3336(in)S
(286)126 3462 A
(mode,)210 3630 A
3882(so)S
(make)168 4008 A
3780 V
(08842)210 648 A
1404(*)S
(sure)168 1488 A
(that)168 1698 A
(the)126 1908 A
(highest)294 2076 A
(memory)252 2412 A
(address)294 2706 A
(fits)168 3042 A
3252(in)S
3378(a)S
(short)210 3462 A
(when)168 3714 A
(counted)294 3924 A
3870 V
(08843)210 648 A
1404(*)S
1488(in)S
(clicks.)294 1614 A
3960 V
(08844)210 648 A
1404(*/)S
4050 V
(08845)210 648 A
(ext_clicks)420 1362 A
1824(=)S
(k_to_click\(\(u32_t\))756 1908 A
(ext_memsize\);)546 2706 A
4140 V
(08846)210 648 A
(max_clicks)420 1362 A
1824(=)S
(USHRT_MAX)378 1908 A
2328(-)S
(\(EM_BASE)336 2412 A
2790(>>)S
(CLICK_SHIFT\);)546 2916 A
4230 V
(08847)210 648 A
(mem[1].size)462 1362 A
1866(=)S
(MIN\(ext_clicks,)630 1950 A
(max_clicks\);)504 2622 A
4320 V
(08848)210 648 A
(mem[1].base)462 1362 A
1866(=)S
(EM_BASE)294 1950 A
2286(>>)S
(CLICK_SHIFT;)504 2412 A
4410 V
(08849)210 648 A
4500 V
(08850)210 648 A
1362(if)S
(\(ext_memsize)504 1488 A
2034(<=)S
(\(unsigned\))420 2160 A
(\(\(SHADOW_BASE)546 2622 A
3210(-)S
(EM_BASE\))336 3294 A
3672(/)S
(1024\))210 3756 A
4590 V
(08851)210 648 A
2034(&&)S
(check_mem\(SHADOW_BASE,)924 2160 A
(SHADOW_MAX\))462 3126 A
3630(==)S
(SHADOW_MAX\))462 3756 A
4260({)S
4680 V
(08852)210 648 A
1698(/*)S
(Shadow)252 1824 A
(ROM)126 2118 A
(memory.)294 2286 A
2622(*/)S
4770 V
(08853)210 648 A
(mem[2].size)462 1698 A
2202(=)S
(SHADOW_MAX)420 2286 A
2748(>>)S
(CLICK_SHIFT;)504 2874 A
4860 V
(08854)210 648 A
(mem[2].base)462 1698 A
2202(=)S
(SHADOW_BASE)462 2286 A
2790(>>)S
(CLICK_SHIFT;)504 2916 A
4950 V
(08855)210 648 A
1362(})S
5040 V
(08856)210 648 A
1110(})S
5130 V
(08857)210 648 A
5220 V
(08858)210 648 A
1110(/*)S
(Total)210 1236 A
(system)252 1488 A
(memory.)294 1782 A
2118(*/)S
5310 V
(08859)210 648 A
(tot_mem_size)504 1110 A
1656(=)S
(mem[0].size)462 1740 A
2244(+)S
(mem[1].size)462 2328 A
2832(+)S
(mem[2].size;)504 2916 A
5400 V
(08860)210 648 A
1026(})S
5580 V
(08862)210 648 A
(/*=========================================================================*)3192 1026 A
5670 V
(08863)210 648 A
1068(*)S
(env_parse)378 2370 A
4176(*)S
5760 V
(08864)210 648 A
(*=========================================================================*/)3192 1068 A
5850 V
(08865)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(env_parse\(env,)588 1488 A
(fmt,)168 2118 A
(field,)252 2328 A
(param,)252 2622 A
(min,)168 2916 A
(max\))168 3126 A
5940 V
(08866)210 648 A
(char)168 1026 A
(*env;)210 1236 A
2034(/*)S
(environment)462 2160 A
(variable)336 2664 A
3042(to)S
(inspect)294 3168 A
3504(*/)S
6030 V
(08867)210 648 A
(char)168 1026 A
(*fmt;)210 1236 A
2034(/*)S
(template)336 2160 A
2538(to)S
(parse)210 2664 A
2916(it)S
(with)168 3042 A
3252(*/)S
6120 V
(08868)210 648 A
(int)126 1026 A
(field;)252 1194 A
2034(/*)S
(field)210 2160 A
(number)252 2412 A
2706(of)S
(value)210 2832 A
3084(to)S
(return)252 3210 A
3504(*/)S
6210 V
(08869)210 648 A
(long)168 1026 A
(*param;)294 1236 A
2034(/*)S
(address)294 2160 A
2496(of)S
(parameter)378 2622 A
3042(to)S
(get)126 3168 A
3336(*/)S
8418 V
EP
%%Page: 112 112
BP
/slant 0 def
/height 0 def
630 V
12 B
(112)180 648 A
11 R
2042(File:)S
2275(src/kernel/misc.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(08870)210 648 A
(long)168 1026 A
(min,)168 1236 A
(max;)168 1446 A
2034(/*)S
(minimum)294 2160 A
(and)126 2496 A
(maximum)294 2664 A
(values)252 3000 A
(for)126 3294 A
(the)126 3462 A
(parameter)378 3630 A
4050(*/)S
990 V
(08871)210 648 A
1026({)S
1080 V
(08872)210 648 A
1026(/*)S
(Parse)210 1152 A
1404(an)S
(environment)462 1530 A
(variable)336 2034 A
(setting,)336 2412 A
(something)378 2790 A
(like)168 3210 A
("DPETH0=300:3".)630 3420 A
1170 V
(08873)210 648 A
1068(*)S
(Panic)210 1152 A
1404(if)S
(the)126 1530 A
(parsing)294 1698 A
(fails.)252 2034 A
(Return)252 2370 A
(EP_UNSET)336 2664 A
3042(if)S
(the)126 3168 A
(environment)462 3336 A
(variable)336 3840 A
1260 V
(08874)210 648 A
1068(*)S
1152(is)S
(not)126 1278 A
(set,)168 1446 A
(EP_OFF)252 1656 A
1950(if)S
2076(it)S
2202(is)S
(set)126 2328 A
2496(to)S
("off",)252 2622 A
(EP_ON)210 2916 A
3168(if)S
(set)126 3294 A
3462(to)S
("on")168 3588 A
3798(or)S
3924(a)S
1350 V
(08875)210 648 A
1068(*)S
(field)210 1152 A
1404(is)S
(left)168 1530 A
(blank,)252 1740 A
2034(or)S
(EP_SET)252 2160 A
2454(if)S
2580(a)S
(field)210 2664 A
2916(is)S
(given)210 3042 A
(\(return)294 3294 A
(value)210 3630 A
(through)294 3882 A
1440 V
(08876)210 648 A
1068(*)S
(*param\).)336 1152 A
(Commas)252 1572 A
(and)126 1866 A
(colons)252 2034 A
(may)126 2328 A
2496(be)S
(used)168 2622 A
2832(in)S
(the)126 2958 A
(environment)462 3126 A
(and)126 3630 A
(format)252 3798 A
1530 V
(08877)210 648 A
1068(*)S
(string,)294 1152 A
(fields)252 1488 A
1782(in)S
(the)126 1908 A
(environment)462 2076 A
(string)252 2580 A
(may)126 2874 A
3042(be)S
(empty,)252 3168 A
(and)126 3462 A
(punctuation)462 3630 A
1620 V
(08878)210 648 A
1068(*)S
(may)126 1152 A
1320(be)S
(missing)294 1446 A
1782(to)S
(skip)168 1908 A
(fields.)294 2118 A
(The)126 2496 A
(format)252 2664 A
(string)252 2958 A
(contains)336 3252 A
(characters)420 3630 A
1710 V
(08879)210 648 A
1068(*)S
('d',)168 1152 A
('o',)168 1362 A
('x')126 1572 A
(and)126 1740 A
('c')126 1908 A
2076(to)S
(indicate)336 2202 A
(that)168 2580 A
(10,)126 2790 A
2958(8,)S
(16,)126 3084 A
3252(or)S
3378(0)S
3462(is)S
(used)168 3588 A
3798(as)S
(the)126 3924 A
1800 V
(08880)210 648 A
1068(*)S
(last)168 1152 A
(argument)336 1362 A
1740(to)S
(strtol.)294 1866 A
1890 V
(08881)210 648 A
1068(*/)S
1980 V
(08882)210 648 A
2070 V
(08883)210 648 A
(char)168 1110 A
(*val,)210 1320 A
(*end;)210 1572 A
2160 V
(08884)210 648 A
(long)168 1110 A
(newpar;)294 1320 A
2250 V
(08885)210 648 A
(int)126 1110 A
1278(i)S
1362(=)S
1446(0,)S
(radix,)252 1572 A
1866(r;)S
2340 V
(08886)210 648 A
2430 V
(08887)210 648 A
1110(if)S
(\(\(val)210 1236 A
1488(=)S
(k_getenv\(env\)\))588 1572 A
2202(==)S
(NIL_PTR\))336 2328 A
(return\(EP_UNSET\);)714 2706 A
2520 V
(08888)210 648 A
1110(if)S
(\(strcmp\(val,)504 1236 A
("off"\))252 1782 A
2076(==)S
2202(0\))S
(return\(EP_OFF\);)630 2328 A
2610 V
(08889)210 648 A
1110(if)S
(\(strcmp\(val,)504 1236 A
("on"\))210 1782 A
2034(==)S
2160(0\))S
(return\(EP_ON\);)588 2286 A
2700 V
(08890)210 648 A
2790 V
(08891)210 648 A
1110(r)S
1194(=)S
(EP_ON;)252 1278 A
2880 V
(08892)210 648 A
(for)126 1110 A
(\(;;\))168 1278 A
1488({)S
2970 V
(08893)210 648 A
(while)210 1362 A
(\(*val)210 1614 A
1866(==)S
1992(')S
2076('\))S
(val++;)252 2202 A
3060 V
(08894)210 648 A
3150 V
(08895)210 648 A
1362(if)S
(\(*val)210 1488 A
1740(==)S
1866(0\))S
(return\(r\);)420 1992 A
2706(/*)S
(the)126 2832 A
(proper)252 3000 A
(exit)168 3294 A
(point)210 3504 A
3756(*/)S
3240 V
(08896)210 648 A
3330 V
(08897)210 648 A
1362(if)S
(\(*fmt)210 1488 A
1740(==)S
1866(0\))S
(break;)252 1992 A
2706(/*)S
(too)126 2832 A
(many)168 3000 A
(values)252 3210 A
3504(*/)S
3420 V
(08898)210 648 A
3510 V
(08899)210 648 A
1362(if)S
(\(*val)210 1488 A
1740(==)S
(',')126 1866 A
2034(||)S
(*val)168 2160 A
2370(==)S
(':'\))168 2496 A
2706({)S
3600 V
(08900)210 648 A
1698(/*)S
(Time)168 1824 A
2034(to)S
2160(go)S
2286(to)S
(the)126 2412 A
(next)168 2580 A
(field.)252 2790 A
3084(*/)S
3690 V
(08901)210 648 A
1698(if)S
(\(*fmt)210 1824 A
2076(==)S
(',')126 2202 A
2370(||)S
(*fmt)168 2496 A
2706(==)S
(':'\))168 2832 A
(i++;)168 3042 A
3780 V
(08902)210 648 A
1698(if)S
(\(*fmt++)294 1824 A
2160(==)S
(*val\))210 2286 A
(val++;)252 2538 A
3870 V
(08903)210 648 A
1362(})S
(else)168 1446 A
1656({)S
3960 V
(08904)210 648 A
1698(/*)S
(Environment)462 1824 A
(contains)336 2328 A
2706(a)S
(value,)252 2790 A
(get)126 3084 A
(it.)126 3252 A
3420(*/)S
4050 V
(08905)210 648 A
(switch)252 1698 A
(\(*fmt\))252 1992 A
2286({)S
4140 V
(08906)210 648 A
(case)168 1698 A
('d':)168 1908 A
(radix)210 2370 A
2622(=)S
(10;)126 2790 A
(break;)252 3042 A
4230 V
(08907)210 648 A
(case)168 1698 A
('o':)168 1908 A
(radix)210 2370 A
2622(=)S
(010;)168 2748 A
(break;)252 3042 A
4320 V
(08908)210 648 A
(case)168 1698 A
('x':)168 1908 A
(radix)210 2370 A
2622(=)S
(0x10;)210 2706 A
(break;)252 3042 A
4410 V
(08909)210 648 A
(case)168 1698 A
('c':)168 1908 A
(radix)210 2370 A
2622(=)S
2832(0;)S
(break;)252 3042 A
4500 V
(08910)210 648 A
(default:)336 1698 A
(goto)168 2370 A
(badenv;)294 2580 A
4590 V
(08911)210 648 A
1698(})S
4680 V
(08912)210 648 A
(newpar)252 1698 A
1992(=)S
(strtol\(val,)462 2076 A
(&end,)210 2580 A
(radix\);)294 2832 A
4770 V
(08913)210 648 A
4860 V
(08914)210 648 A
1698(if)S
(\(end)168 1824 A
2034(==)S
(val\))168 2160 A
(break;)252 2370 A
2706(/*)S
(not)126 2832 A
3000(a)S
(number)252 3084 A
3378(*/)S
4950 V
(08915)210 648 A
(val)126 1698 A
1866(=)S
(end;)168 1950 A
5040 V
(08916)210 648 A
5130 V
(08917)210 648 A
1698(if)S
1824(\(i)S
1950(==)S
(field\))252 2076 A
2370({)S
5220 V
(08918)210 648 A
2034(/*)S
(The)126 2160 A
(field)210 2328 A
(requested.)420 2580 A
3042(*/)S
5310 V
(08919)210 648 A
2034(if)S
(\(newpar)294 2160 A
2496(<)S
(min)126 2580 A
2748(||)S
(newpar)252 2874 A
3168(>)S
(max\))168 3252 A
(break;)252 3462 A
5400 V
(08920)210 648 A
(*param)252 2034 A
2328(=)S
(newpar;)294 2412 A
5490 V
(08921)210 648 A
2034(r)S
2118(=)S
(EP_SET;)294 2202 A
5580 V
(08922)210 648 A
1698(})S
5670 V
(08923)210 648 A
1362(})S
5760 V
(08924)210 648 A
1110(})S
5850 V
(08925)210 648 A
(badenv:)294 1026 A
5940 V
(08926)210 648 A
(printf\("Bad)462 1110 A
(environment)462 1614 A
(setting:)336 2118 A
('%s)126 2496 A
2664(=)S
(%s'\\n",)294 2748 A
(env,)168 3084 A
(k_getenv\(env\)\);)630 3294 A
6030 V
(08927)210 648 A
(panic\("",)378 1110 A
(NO_NUM\);)336 1530 A
6120 V
(08928)210 648 A
(/*NOTREACHED*/)588 1110 A
6210 V
(08929)210 648 A
1026(})S
8418 V
EP
%%Page: 113 113
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2042(File:)S
2275(src/kernel/misc.c)S
12 B
(113)180 4248 A
990 V
7 LST
(08931)210 648 A
(#if)126 1026 A
(DEBUG)210 1194 A
1080 V
(08932)210 648 A
(/*=========================================================================*)3192 1026 A
1170 V
(08933)210 648 A
1068(*)S
(bad_assertion)546 2370 A
4176(*)S
1260 V
(08934)210 648 A
(*=========================================================================*/)3192 1068 A
1350 V
(08935)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(bad_assertion\(file,)798 1530 A
(line,)210 2370 A
(what\))210 2622 A
1440 V
(08936)210 648 A
(char)168 1026 A
(*file;)252 1236 A
1530 V
(08937)210 648 A
(int)126 1026 A
(line;)210 1194 A
1620 V
(08938)210 648 A
(char)168 1026 A
(*what;)252 1236 A
1710 V
(08939)210 648 A
1026({)S
1800 V
(08940)210 648 A
(printf\("panic)546 1110 A
1698(at)S
(%s\(%d\):)294 1824 A
(assertion)378 2160 A
(\\"%s\\")252 2580 A
(failed\\n",)420 2874 A
(file,)210 3336 A
(line,)210 3588 A
(what\);)252 3840 A
1890 V
(08941)210 648 A
(panic\(NULL,)462 1110 A
(NO_NUM\);)336 1614 A
1980 V
(08942)210 648 A
1026(})S
2160 V
(08944)210 648 A
(/*=========================================================================*)3192 1026 A
2250 V
(08945)210 648 A
1068(*)S
(bad_compare)462 2370 A
4176(*)S
2340 V
(08946)210 648 A
(*=========================================================================*/)3192 1068 A
2430 V
(08947)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(bad_compare\(file,)714 1530 A
(line,)210 2286 A
(lhs,)168 2538 A
(what,)210 2748 A
(rhs\))168 3000 A
2520 V
(08948)210 648 A
(char)168 1026 A
(*file;)252 1236 A
2610 V
(08949)210 648 A
(int)126 1026 A
(line;)210 1194 A
2700 V
(08950)210 648 A
(int)126 1026 A
(lhs;)168 1194 A
2790 V
(08951)210 648 A
(char)168 1026 A
(*what;)252 1236 A
2880 V
(08952)210 648 A
(int)126 1026 A
(rhs;)168 1194 A
2970 V
(08953)210 648 A
1026({)S
3060 V
(08954)210 648 A
(printf\("panic)546 1110 A
1698(at)S
(%s\(%d\):)294 1824 A
(compare)294 2160 A
(\(%d\))168 2496 A
2706(%s)S
(\(%d\))168 2832 A
(failed\\n",)420 3042 A
3150 V
(08955)210 648 A
(file,)210 1362 A
(line,)210 1614 A
(lhs,)168 1866 A
(what,)210 2076 A
(rhs\);)210 2328 A
3240 V
(08956)210 648 A
(panic\(NULL,)462 1110 A
(NO_NUM\);)336 1614 A
3330 V
(08957)210 648 A
1026(})S
3420 V
(08958)210 648 A
(#endif)252 1026 A
1320(/*)S
(DEBUG)210 1446 A
1698(*/)S
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(src/kernel/driver.h)798 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(09000)210 648 A
1026(/*)S
(Types)210 1152 A
(and)126 1404 A
(constants)378 1572 A
(shared)252 1992 A
(between)294 2286 A
(the)126 2622 A
(generic)294 2790 A
(and)126 3126 A
(device)252 3294 A
(dependent)378 3588 A
4140 V
(09001)210 648 A
1068(*)S
(device)252 1152 A
(driver)252 1446 A
(code.)210 1740 A
4230 V
(09002)210 648 A
1068(*/)S
4320 V
(09003)210 648 A
4410 V
(09004)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
4500 V
(09005)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
4590 V
(09006)210 648 A
(#include)336 1026 A
("proc.h")336 1404 A
4680 V
(09007)210 648 A
(#include)336 1026 A
(<minix/partition.h>)798 1404 A
4770 V
(09008)210 648 A
4860 V
(09009)210 648 A
1026(/*)S
(Info)168 1152 A
(about)210 1362 A
(and)126 1614 A
(entry)210 1782 A
(points)252 2034 A
(into)168 2328 A
(the)126 2538 A
(device)252 2706 A
(dependent)378 3000 A
(code.)210 3420 A
3672(*/)S
4950 V
(09010)210 648 A
(struct)252 1026 A
(driver)252 1320 A
1614({)S
5040 V
(09011)210 648 A
(_PROTOTYPE\()462 1110 A
(char)168 1614 A
(*\(*dr_name\),)504 1824 A
(\(void\))252 2370 A
2664(\);)S
5130 V
(09012)210 648 A
(_PROTOTYPE\()462 1110 A
(int)126 1614 A
(\(*dr_open\),)462 1782 A
(\(struct)294 2286 A
(driver)252 2622 A
(*dp,)168 2916 A
(message)294 3126 A
(*m_ptr\))294 3462 A
3798(\);)S
5220 V
(09013)210 648 A
(_PROTOTYPE\()462 1110 A
(int)126 1614 A
(\(*dr_close\),)504 1782 A
(\(struct)294 2328 A
(driver)252 2664 A
(*dp,)168 2958 A
(message)294 3168 A
(*m_ptr\))294 3504 A
3840(\);)S
5310 V
(09014)210 648 A
(_PROTOTYPE\()462 1110 A
(int)126 1614 A
(\(*dr_ioctl\),)504 1782 A
(\(struct)294 2328 A
(driver)252 2664 A
(*dp,)168 2958 A
(message)294 3168 A
(*m_ptr\))294 3504 A
3840(\);)S
5400 V
(09015)210 648 A
(_PROTOTYPE\()462 1110 A
(struct)252 1614 A
(device)252 1908 A
(*\(*dr_prepare\),)630 2202 A
(\(int)168 2874 A
(device\))294 3084 A
3420(\);)S
5490 V
(09016)210 648 A
(_PROTOTYPE\()462 1110 A
(int)126 1614 A
(\(*dr_schedule\),)630 1782 A
(\(int)168 2454 A
(proc_nr,)336 2664 A
(struct)252 3042 A
(iorequest_s)462 3336 A
(*request\))378 3840 A
4260(\);)S
5580 V
(09017)210 648 A
(_PROTOTYPE\()462 1110 A
(int)126 1614 A
(\(*dr_finish\),)546 1782 A
(\(void\))252 2370 A
2664(\);)S
5670 V
(09018)210 648 A
(_PROTOTYPE\()462 1110 A
(void)168 1614 A
(\(*dr_cleanup\),)588 1824 A
(\(void\))252 2454 A
2748(\);)S
5760 V
(09019)210 648 A
(_PROTOTYPE\()462 1110 A
(void)168 1614 A
(\(*dr_geometry\),)630 1824 A
(\(struct)294 2496 A
(partition)378 2832 A
(*entry\))294 3252 A
3588(\);)S
5850 V
(09020)210 648 A
1026(};)S
5940 V
(09021)210 648 A
6030 V
(09022)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
6120 V
(09023)210 648 A
6210 V
(09024)210 648 A
1026(/*)S
(Number)252 1152 A
1446(of)S
(bytes)210 1572 A
(you)126 1824 A
(can)126 1992 A
(DMA)126 2160 A
(before)252 2328 A
(hitting)294 2622 A
2958(a)S
(64K)126 3042 A
(boundary:)378 3210 A
3630(*/)S
8418 V
EP
%%Page: 114 114
BP
/slant 0 def
/height 0 def
630 V
12 B
(114)180 648 A
11 R
2012(File:)S
2245(src/kernel/driver.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(09025)210 648 A
(#define)294 1026 A
(dma_bytes_left\(phys\))840 1362 A
2370(\\)S
990 V
(09026)210 648 A
(\(\(unsigned\))462 1152 A
(\(sizeof\(int\))504 1656 A
2202(==)S
2328(2)S
2412(?)S
2496(0)S
2580(:)S
(0x10000\))336 2664 A
3042(-)S
(\(unsigned\))420 3126 A
(\(\(phys\))294 3588 A
3924(&)S
(0xFFFF\)\))336 4008 A
1080 V
(09027)210 648 A
1170 V
(09028)210 648 A
(#endif)252 1026 A
1320(/*)S
(CHIP)168 1446 A
1656(==)S
(INTEL)210 1782 A
2034(*/)S
1260 V
(09029)210 648 A
1350 V
(09030)210 648 A
1026(/*)S
(Base)168 1152 A
(and)126 1362 A
(size)168 1530 A
1740(of)S
1866(a)S
(partition)378 1950 A
2370(in)S
(bytes.)252 2496 A
2790(*/)S
1440 V
(09031)210 648 A
(struct)252 1026 A
(device)252 1320 A
1614({)S
1530 V
(09032)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(dv_base;)336 1698 A
1620 V
(09033)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(dv_size;)336 1698 A
1710 V
(09034)210 648 A
1026(};)S
1800 V
(09035)210 648 A
1890 V
(09036)210 648 A
(#define)294 1026 A
(NIL_DEV)294 1362 A
(\(\(struct)336 2034 A
(device)252 2412 A
2706(*\))S
2832(0\))S
1980 V
(09037)210 648 A
2070 V
(09038)210 648 A
1026(/*)S
(Functions)378 1152 A
(defined)294 1572 A
1908(by)S
(driver.c:)378 2034 A
2454(*/)S
2160 V
(09039)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(driver_task,)504 1740 A
(\(struct)294 2286 A
(driver)252 2622 A
(*dr\))168 2916 A
3126(\);)S
2250 V
(09040)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_rdwt,)336 1698 A
(\(struct)294 2076 A
(driver)252 2412 A
(*dr,)168 2706 A
(message)294 2916 A
(*m_ptr\))294 3252 A
3588(\);)S
2340 V
(09041)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_vrdwt,)378 1698 A
(\(struct)294 2118 A
(driver)252 2454 A
(*dr,)168 2748 A
(message)294 2958 A
(*m_ptr\))294 3294 A
3630(\);)S
2430 V
(09042)210 648 A
(_PROTOTYPE\()462 1026 A
(char)168 1530 A
(*no_name,)378 1740 A
(\(void\))252 2160 A
2454(\);)S
2520 V
(09043)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_nop,)294 1698 A
(\(struct)294 2034 A
(driver)252 2370 A
(*dp,)168 2664 A
(message)294 2874 A
(*m_ptr\))294 3210 A
3546(\);)S
2610 V
(09044)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(nop_finish,)462 1698 A
(\(void\))252 2202 A
2496(\);)S
2700 V
(09045)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(nop_cleanup,)504 1740 A
(\(void\))252 2286 A
2580(\);)S
2790 V
(09046)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(clock_mess,)462 1740 A
(\(int)168 2244 A
(ticks,)252 2454 A
(watchdog_t)420 2748 A
(func\))210 3210 A
3462(\);)S
2880 V
(09047)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_diocntl,)462 1698 A
(\(struct)294 2202 A
(driver)252 2538 A
(*dr,)168 2832 A
(message)294 3042 A
(*m_ptr\))294 3378 A
3714(\);)S
2970 V
(09048)210 648 A
3060 V
(09049)210 648 A
1026(/*)S
(Parameters)420 1152 A
(for)126 1614 A
(the)126 1782 A
(disk)168 1950 A
(drive.)252 2160 A
2454(*/)S
3150 V
(09050)210 648 A
(#define)294 1026 A
(SECTOR_SIZE)462 1362 A
(512)126 2076 A
2370(/*)S
(physical)336 2496 A
(sector)252 2874 A
(size)168 3168 A
3378(in)S
(bytes)210 3504 A
3756(*/)S
3240 V
(09051)210 648 A
(#define)294 1026 A
(SECTOR_SHIFT)504 1362 A
2160(9)S
2370(/*)S
(for)126 2496 A
(division)336 2664 A
3042(*/)S
3330 V
(09052)210 648 A
(#define)294 1026 A
(SECTOR_MASK)462 1362 A
(511)126 2076 A
2370(/*)S
(and)126 2496 A
(remainder)378 2664 A
3084(*/)S
3420 V
(09053)210 648 A
3510 V
(09054)210 648 A
1026(/*)S
(Size)168 1152 A
1362(of)S
(the)126 1488 A
(DMA)126 1656 A
(buffer)252 1824 A
(buffer)252 2118 A
2412(in)S
(bytes.)252 2538 A
2832(*/)S
3600 V
(09055)210 648 A
(#define)294 1026 A
(DMA_BUF_SIZE)504 1362 A
(\(DMA_SECTORS)504 2034 A
2580(*)S
(SECTOR_SIZE\))504 2664 A
3690 V
(09056)210 648 A
3780 V
(09057)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
3870 V
(09058)210 648 A
(extern)252 1026 A
(u8_t)168 1320 A
(*tmp_buf;)378 1530 A
2706(/*)S
(the)126 2832 A
(DMA)126 3000 A
(buffer)252 3168 A
3462(*/)S
3960 V
(09059)210 648 A
(#else)210 1026 A
4050 V
(09060)210 648 A
(extern)252 1026 A
(u8_t)168 1320 A
(tmp_buf[];)420 1530 A
2706(/*)S
(the)126 2832 A
(DMA)126 3000 A
(buffer)252 3168 A
3462(*/)S
4140 V
(09061)210 648 A
(#endif)252 1026 A
4230 V
(09062)210 648 A
(extern)252 1026 A
(phys_bytes)420 1320 A
(tmp_phys;)378 1782 A
2706(/*)S
(phys)168 2832 A
(address)294 3042 A
3378(of)S
(DMA)126 3504 A
(buffer)252 3672 A
3966(*/)S
4590 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4680 V
(src/kernel/driver.c)798 2034 A
4770 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4950 V
(09100)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(device)252 1950 A
(independent)462 2244 A
(device)252 2748 A
(driver)252 3042 A
(interface.)420 3336 A
5040 V
(09101)210 648 A
1068(*)S
(Author:)294 3378 A
(Kees)168 3714 A
3924(J.)S
(Bot.)168 4050 A
5130 V
(09102)210 648 A
1068(*)S
5220 V
(09103)210 648 A
1068(*)S
(The)126 1152 A
(drivers)294 1320 A
(support)294 1656 A
(the)126 1992 A
(following)378 2160 A
(operations)420 2580 A
(\(using)252 3042 A
(message)294 3336 A
(format)252 3672 A
(m2\):)168 3966 A
5310 V
(09104)210 648 A
1068(*)S
5400 V
(09105)210 648 A
1068(*)S
(m_type)252 1278 A
(DEVICE)252 1782 A
(PROC_NR)294 2202 A
(COUNT)210 2706 A
(POSITION)336 3084 A
(ADRRESS)294 3504 A
5490 V
(09106)210 648 A
1068(*)S
(----------------------------------------------------------------)2688 1152 A
5580 V
(09107)210 648 A
1068(*)S
1152(|)S
(DEV_OPEN)336 1278 A
1698(|)S
(device)252 1782 A
2118(|)S
(proc)168 2202 A
2412(nr)S
2538(|)S
2958(|)S
3378(|)S
3798(|)S
5670 V
(09108)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------+---------|)2688 1152 A
5760 V
(09109)210 648 A
1068(*)S
1152(|)S
(DEV_CLOSE)378 1278 A
1698(|)S
(device)252 1782 A
2118(|)S
(proc)168 2202 A
2412(nr)S
2538(|)S
2958(|)S
3378(|)S
3798(|)S
5850 V
(09110)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------+---------|)2688 1152 A
5940 V
(09111)210 648 A
1068(*)S
1152(|)S
(DEV_READ)336 1278 A
1698(|)S
(device)252 1782 A
2118(|)S
(proc)168 2202 A
2412(nr)S
2538(|)S
(bytes)210 2664 A
2958(|)S
(offset)252 3084 A
3378(|)S
(buf)126 3462 A
(ptr)126 3630 A
3798(|)S
6030 V
(09112)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------+---------|)2688 1152 A
6120 V
(09113)210 648 A
1068(*)S
1152(|)S
(DEV_WRITE)378 1278 A
1698(|)S
(device)252 1782 A
2118(|)S
(proc)168 2202 A
2412(nr)S
2538(|)S
(bytes)210 2664 A
2958(|)S
(offset)252 3084 A
3378(|)S
(buf)126 3462 A
(ptr)126 3630 A
3798(|)S
6210 V
(09114)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------+---------|)2688 1152 A
8418 V
EP
%%Page: 115 115
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2015(File:)S
2248(src/kernel/driver.c)S
12 B
(115)180 4248 A
900 V
7 LST
(09115)210 648 A
1068(*)S
(|SCATTERED_IO|)588 1152 A
(device)252 1782 A
2118(|)S
(proc)168 2202 A
2412(nr)S
2538(|)S
(requests|)378 2622 A
3378(|)S
(iov)126 3462 A
(ptr)126 3630 A
3798(|)S
990 V
(09116)210 648 A
1068(*)S
(----------------------------------------------------------------)2688 1152 A
1080 V
(09117)210 648 A
1068(*)S
1152(|)S
(DEV_IOCTL)378 1278 A
1698(|)S
(device)252 1782 A
2118(|)S
(proc)168 2202 A
2412(nr)S
(|func)210 2538 A
(code|)210 2790 A
3378(|)S
(buf)126 3462 A
(ptr)126 3630 A
3798(|)S
1170 V
(09118)210 648 A
1068(*)S
(----------------------------------------------------------------)2688 1152 A
1260 V
(09119)210 648 A
1068(*)S
1350 V
(09120)210 648 A
1068(*)S
(The)126 1152 A
(file)168 1320 A
(contains)336 1530 A
(one)126 1908 A
(entry)210 2076 A
(point:)252 2328 A
1440 V
(09121)210 648 A
1068(*)S
1530 V
(09122)210 648 A
1068(*)S
(driver_task:)504 1236 A
(called)252 2034 A
2328(by)S
(the)126 2454 A
(device)252 2622 A
(dependent)378 2916 A
(task)168 3336 A
(entry)210 3546 A
1620 V
(09123)210 648 A
1068(*)S
1710 V
(09124)210 648 A
1068(*)S
1800 V
(09125)210 648 A
1068(*)S
(Constructed)462 1152 A
(92/04/02)336 1656 A
2034(by)S
(Kees)168 2160 A
2370(J.)S
(Bot)126 2496 A
(from)168 2664 A
(the)126 2874 A
(old)126 3042 A
3210(AT)S
(wini)168 3336 A
(and)126 3546 A
(floppy)252 3714 A
(driver.)294 4008 A
1890 V
(09126)210 648 A
1068(*/)S
1980 V
(09127)210 648 A
2070 V
(09128)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
2160 V
(09129)210 648 A
(#include)336 1026 A
(<sys/ioctl.h>)546 1404 A
2250 V
(09130)210 648 A
(#include)336 1026 A
("driver.h")420 1404 A
2340 V
(09131)210 648 A
2430 V
(09132)210 648 A
(#define)294 1026 A
(BUF_EXTRA)378 1362 A
2034(0)S
2520 V
(09133)210 648 A
2610 V
(09134)210 648 A
1026(/*)S
(Claim)210 1152 A
(space)210 1404 A
(for)126 1656 A
(variables.)420 1824 A
2286(*/)S
2700 V
(09135)210 648 A
(PRIVATE)294 1026 A
(u8_t)168 1362 A
(buffer[\(unsigned\))714 1572 A
2328(2)S
2412(*)S
(DMA_BUF_SIZE)504 2496 A
3042(+)S
(BUF_EXTRA];)462 3126 A
2790 V
(09136)210 648 A
(u8_t)168 1026 A
(*tmp_buf;)378 1236 A
2370(/*)S
(the)126 2496 A
(DMA)126 2664 A
(buffer)252 2832 A
(eventually)420 3126 A
3588(*/)S
2880 V
(09137)210 648 A
(phys_bytes)420 1026 A
(tmp_phys;)378 1488 A
2370(/*)S
(phys)168 2496 A
(address)294 2706 A
3042(of)S
(DMA)126 3168 A
(buffer)252 3336 A
3630(*/)S
2970 V
(09138)210 648 A
3060 V
(09139)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(init_buffer,)504 2076 A
(\(void\))252 2622 A
2916(\);)S
3150 V
(09140)210 648 A
3240 V
(09141)210 648 A
(/*===========================================================================*)3276 1026 A
3330 V
(09142)210 648 A
1068(*)S
(driver_task)462 2370 A
4260(*)S
3420 V
(09143)210 648 A
(*===========================================================================*/)3276 1068 A
3510 V
(09144)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(driver_task\(dp\))630 1530 A
3600 V
(09145)210 648 A
(struct)252 1026 A
(driver)252 1320 A
(*dp;)168 1614 A
2034(/*)S
(Device)252 2160 A
(dependent)378 2454 A
(entry)210 2874 A
(points.)294 3126 A
3462(*/)S
3690 V
(09146)210 648 A
1026({)S
3780 V
(09147)210 648 A
1026(/*)S
(Main)168 1152 A
(program)294 1362 A
1698(of)S
(any)126 1824 A
(device)252 1992 A
(driver)252 2286 A
(task.)210 2580 A
2832(*/)S
3870 V
(09148)210 648 A
3960 V
(09149)210 648 A
(int)126 1110 A
1278(r,)S
(caller,)294 1404 A
(proc_nr;)336 1740 A
4050 V
(09150)210 648 A
(message)294 1110 A
(mess;)210 1446 A
4140 V
(09151)210 648 A
4230 V
(09152)210 648 A
(init_buffer\(\);)588 1110 A
2034(/*)S
(Get)126 2160 A
2328(a)S
(DMA)126 2412 A
(buffer.)294 2580 A
2916(*/)S
4320 V
(09153)210 648 A
4410 V
(09154)210 648 A
1110(/*)S
(Here)168 1236 A
1446(is)S
(the)126 1572 A
(main)168 1740 A
(loop)168 1950 A
2160(of)S
(the)126 2286 A
(disk)168 2454 A
(task.)210 2664 A
2958(It)S
(waits)210 3084 A
(for)126 3336 A
3504(a)S
(message,)336 3588 A
(carries)294 3966 A
4500 V
(09155)210 648 A
1152(*)S
1236(it)S
(out,)168 1362 A
(and)126 1572 A
(sends)210 1740 A
1992(a)S
(reply.)252 2076 A
4590 V
(09156)210 648 A
1152(*/)S
4680 V
(09157)210 648 A
4770 V
(09158)210 648 A
(while)210 1110 A
(\(TRUE\))252 1362 A
1656({)S
4860 V
(09159)210 648 A
1362(/*)S
(First)210 1488 A
(wait)168 1740 A
(for)126 1950 A
2118(a)S
(request)294 2202 A
2538(to)S
(read)168 2664 A
2874(or)S
(write)210 3000 A
3252(a)S
(disk)168 3336 A
(block.)252 3546 A
3840(*/)S
4950 V
(09160)210 648 A
(receive\(ANY,)504 1362 A
(&mess\);)294 1908 A
5040 V
(09161)210 648 A
5130 V
(09162)210 648 A
(caller)252 1362 A
1656(=)S
(mess.m_source;)588 1740 A
5220 V
(09163)210 648 A
(proc_nr)294 1362 A
1698(=)S
(mess.PROC_NR;)546 1782 A
5310 V
(09164)210 648 A
5400 V
(09165)210 648 A
(switch)252 1362 A
(\(caller\))336 1656 A
2034({)S
5490 V
(09166)210 648 A
(case)168 1362 A
(HARDWARE:)378 1572 A
5580 V
(09167)210 648 A
1698(/*)S
(Leftover)336 1824 A
(interrupt.)420 2202 A
2664(*/)S
5670 V
(09168)210 648 A
(continue;)378 1698 A
5760 V
(09169)210 648 A
(case)168 1362 A
(FS_PROC_NR:)462 1572 A
5850 V
(09170)210 648 A
1698(/*)S
(The)126 1824 A
(only)168 1992 A
(legitimate)420 2202 A
(caller.)294 2664 A
3000(*/)S
5940 V
(09171)210 648 A
(break;)252 1698 A
6030 V
(09172)210 648 A
(default:)336 1362 A
6120 V
(09173)210 648 A
(printf\("%s:)462 1698 A
(got)126 2202 A
(message)294 2370 A
(from)168 2706 A
(%d\\n",)252 2916 A
(\(*dp->dr_name\)\(\),)714 3210 A
(caller\);)336 3966 A
6210 V
(09174)210 648 A
(continue;)378 1698 A
8418 V
EP
%%Page: 116 116
BP
/slant 0 def
/height 0 def
630 V
12 B
(116)180 648 A
11 R
2015(File:)S
2248(src/kernel/driver.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(09175)210 648 A
1362(})S
990 V
(09176)210 648 A
1080 V
(09177)210 648 A
1362(/*)S
(Now)126 1488 A
(carry)210 1656 A
(out)126 1908 A
(the)126 2076 A
(work.)210 2244 A
2496(*/)S
1170 V
(09178)210 648 A
(switch\(mess.m_type\))798 1362 A
2202({)S
1260 V
(09179)210 648 A
(case)168 1530 A
(DEV_OPEN:)378 1740 A
2370(r)S
2454(=)S
(\(*dp->dr_open\)\(dp,)756 2538 A
(&mess\);)294 3336 A
(break;)252 3714 A
1350 V
(09180)210 648 A
(case)168 1530 A
(DEV_CLOSE:)420 1740 A
2370(r)S
2454(=)S
(\(*dp->dr_close\)\(dp,)798 2538 A
(&mess\);)294 3378 A
(break;)252 3714 A
1440 V
(09181)210 648 A
(case)168 1530 A
(DEV_IOCTL:)420 1740 A
2370(r)S
2454(=)S
(\(*dp->dr_ioctl\)\(dp,)798 2538 A
(&mess\);)294 3378 A
(break;)252 3714 A
1530 V
(09182)210 648 A
1620 V
(09183)210 648 A
(case)168 1530 A
(DEV_READ:)378 1740 A
1710 V
(09184)210 648 A
(case)168 1530 A
(DEV_WRITE:)420 1740 A
2370(r)S
2454(=)S
(do_rdwt\(dp,)462 2538 A
(&mess\);)294 3042 A
(break;)252 3714 A
1800 V
(09185)210 648 A
1890 V
(09186)210 648 A
(case)168 1530 A
(SCATTERED_IO:)546 1740 A
2370(r)S
2454(=)S
(do_vrdwt\(dp,)504 2538 A
(&mess\);)294 3084 A
(break;)252 3714 A
1980 V
(09187)210 648 A
(default:)336 1530 A
2370(r)S
2454(=)S
(EINVAL;)294 2538 A
(break;)252 3714 A
2070 V
(09188)210 648 A
1362(})S
2160 V
(09189)210 648 A
2250 V
(09190)210 648 A
1362(/*)S
(Clean)210 1488 A
1740(up)S
(leftover)336 1866 A
(state.)252 2244 A
2538(*/)S
2340 V
(09191)210 648 A
(\(*dp->dr_cleanup\)\(\);)840 1362 A
2430 V
(09192)210 648 A
2520 V
(09193)210 648 A
1362(/*)S
(Finally,)336 1488 A
(prepare)294 1866 A
(and)126 2202 A
(send)168 2370 A
(the)126 2580 A
(reply)210 2748 A
(message.)336 3000 A
3378(*/)S
2610 V
(09194)210 648 A
(mess.m_type)462 1362 A
1866(=)S
(TASK_REPLY;)462 1950 A
2700 V
(09195)210 648 A
(mess.REP_PROC_NR)672 1362 A
2076(=)S
(proc_nr;)336 2160 A
2790 V
(09196)210 648 A
2880 V
(09197)210 648 A
(mess.REP_STATUS)630 1362 A
2034(=)S
2118(r;)S
2370(/*)S
2496(#)S
2580(of)S
(bytes)210 2706 A
(transferred)462 2958 A
3462(or)S
(error)210 3588 A
(code)168 3840 A
4050(*/)S
2970 V
(09198)210 648 A
(send\(caller,)504 1362 A
(&mess\);)294 1908 A
2370(/*)S
(send)168 2496 A
(reply)210 2706 A
2958(to)S
(caller)252 3084 A
3378(*/)S
3060 V
(09199)210 648 A
1110(})S
3150 V
(09200)210 648 A
1026(})S
3330 V
(09202)210 648 A
(/*===========================================================================*)3276 1026 A
3420 V
(09203)210 648 A
1068(*)S
(init_buffer)462 2370 A
4260(*)S
3510 V
(09204)210 648 A
(*===========================================================================*/)3276 1068 A
3600 V
(09205)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(init_buffer\(\))546 1572 A
3690 V
(09206)210 648 A
1026({)S
3780 V
(09207)210 648 A
1026(/*)S
(Select)252 1152 A
1446(a)S
(buffer)252 1530 A
(that)168 1824 A
(can)126 2034 A
(safely)252 2202 A
2496(be)S
(used)168 2622 A
(for)126 2832 A
(dma)126 3000 A
(transfers.)420 3168 A
3672(It)S
(may)126 3798 A
(also)168 3966 A
3870 V
(09208)210 648 A
1068(*)S
1152(be)S
(used)168 1278 A
1488(to)S
(read)168 1614 A
(partition)378 1824 A
(tables)252 2244 A
(and)126 2538 A
(such.)210 2706 A
(Its)126 3000 A
(absolute)336 3168 A
(address)294 3546 A
3882(is)S
3960 V
(09209)210 648 A
1068(*)S
('tmp_phys',)462 1152 A
(the)126 1656 A
(normal)252 1824 A
(address)294 2118 A
2454(is)S
('tmp_buf'.)420 2580 A
4050 V
(09210)210 648 A
1068(*/)S
4140 V
(09211)210 648 A
4230 V
(09212)210 648 A
(tmp_buf)294 1110 A
1446(=)S
(buffer;)294 1530 A
4320 V
(09213)210 648 A
(tmp_phys)336 1110 A
1488(=)S
(vir2phys\(buffer\);)714 1572 A
4410 V
(09214)210 648 A
4500 V
(09215)210 648 A
1110(if)S
(\(tmp_phys)378 1236 A
1656(==)S
1782(0\))S
(panic\("no)378 1908 A
(DMA)126 2328 A
(buffer",)336 2496 A
(NO_NUM\);)336 2874 A
4590 V
(09216)210 648 A
4680 V
(09217)210 648 A
1110(if)S
(\(dma_bytes_left\(tmp_phys\))1050 1236 A
2328(<)S
(DMA_BUF_SIZE\))546 2412 A
3000({)S
4770 V
(09218)210 648 A
1362(/*)S
(First)210 1488 A
(half)168 1740 A
1950(of)S
(buffer)252 2076 A
(crosses)294 2370 A
2706(a)S
(64K)126 2790 A
(boundary,)378 2958 A
(can't)210 3378 A
(DMA)126 3630 A
(into)168 3798 A
(that)168 4008 A
4218(*/)S
4860 V
(09219)210 648 A
(tmp_buf)294 1362 A
1698(+=)S
(DMA_BUF_SIZE;)546 1824 A
4950 V
(09220)210 648 A
(tmp_phys)336 1362 A
1740(+=)S
(DMA_BUF_SIZE;)546 1866 A
5040 V
(09221)210 648 A
1110(})S
5130 V
(09222)210 648 A
1026(})S
5310 V
(09224)210 648 A
(/*===========================================================================*)3276 1026 A
5400 V
(09225)210 648 A
1068(*)S
(do_rdwt)294 2370 A
4260(*)S
5490 V
(09226)210 648 A
(*===========================================================================*/)3276 1068 A
5580 V
(09227)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_rdwt\(dp,)462 1488 A
(m_ptr\))252 1992 A
5670 V
(09228)210 648 A
(struct)252 1026 A
(driver)252 1320 A
(*dp;)168 1614 A
2370(/*)S
(device)252 2496 A
(dependent)378 2790 A
(entry)210 3210 A
(points)252 3462 A
3756(*/)S
5760 V
(09229)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(read)168 2958 A
3168(or)S
(write)210 3294 A
(message)294 3546 A
3882(*/)S
5850 V
(09230)210 648 A
1026({)S
5940 V
(09231)210 648 A
1026(/*)S
(Carry)210 1152 A
(out)126 1404 A
1572(a)S
(single)252 1656 A
(read)168 1950 A
2160(or)S
(write)210 2286 A
(request.)336 2538 A
2916(*/)S
6030 V
(09232)210 648 A
(struct)252 1110 A
(iorequest_s)462 1404 A
(ioreq;)252 1908 A
6120 V
(09233)210 648 A
(int)126 1110 A
1278(r;)S
6210 V
(09234)210 648 A
8418 V
EP
%%Page: 117 117
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2015(File:)S
2248(src/kernel/driver.c)S
12 B
(117)180 4248 A
900 V
7 LST
(09235)210 648 A
1110(if)S
(\(m_ptr->COUNT)546 1236 A
1824(<=)S
1950(0\))S
(return\(EINVAL\);)630 2076 A
990 V
(09236)210 648 A
1080 V
(09237)210 648 A
1110(if)S
(\(\(*dp->dr_prepare\)\(m_ptr->DEVICE\))1386 1236 A
2664(==)S
(NIL_DEV\))336 2790 A
(return\(ENXIO\);)588 3168 A
1170 V
(09238)210 648 A
1260 V
(09239)210 648 A
(ioreq.io_request)672 1110 A
1824(=)S
(m_ptr->m_type;)588 1908 A
1350 V
(09240)210 648 A
(ioreq.io_buf)504 1110 A
1656(=)S
(m_ptr->ADDRESS;)630 1740 A
1440 V
(09241)210 648 A
(ioreq.io_position)714 1110 A
1866(=)S
(m_ptr->POSITION;)672 1950 A
1530 V
(09242)210 648 A
(ioreq.io_nbytes)630 1110 A
1782(=)S
(m_ptr->COUNT;)546 1866 A
1620 V
(09243)210 648 A
1710 V
(09244)210 648 A
1110(r)S
1194(=)S
(\(*dp->dr_schedule\)\(m_ptr->PROC_NR,)1428 1278 A
(&ioreq\);)336 2748 A
1800 V
(09245)210 648 A
1890 V
(09246)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
(\(void\))252 1656 A
(\(*dp->dr_finish\)\(\);)798 1950 A
1980 V
(09247)210 648 A
2070 V
(09248)210 648 A
1110(r)S
1194(=)S
(ioreq.io_nbytes;)672 1278 A
2160 V
(09249)210 648 A
(return\(r)336 1110 A
1488(<)S
1572(0)S
1656(?)S
1740(r)S
1824(:)S
(m_ptr->COUNT)504 1908 A
2454(-)S
(r\);)126 2538 A
2250 V
(09250)210 648 A
1026(})S
2430 V
(09252)210 648 A
(/*==========================================================================*)3234 1026 A
2520 V
(09253)210 648 A
1068(*)S
(do_vrdwt)336 2370 A
4218(*)S
2610 V
(09254)210 648 A
(*==========================================================================*/)3234 1068 A
2700 V
(09255)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_vrdwt\(dp,)504 1488 A
(m_ptr\))252 2034 A
2790 V
(09256)210 648 A
(struct)252 1026 A
(driver)252 1320 A
(*dp;)168 1614 A
2034(/*)S
(device)252 2160 A
(dependent)378 2454 A
(entry)210 2874 A
(points)252 3126 A
3420(*/)S
2880 V
(09257)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2034(/*)S
(pointer)294 2160 A
2496(to)S
(read)168 2622 A
2832(or)S
(write)210 2958 A
(message)294 3210 A
3546(*/)S
2970 V
(09258)210 648 A
1026({)S
3060 V
(09259)210 648 A
1026(/*)S
(Fetch)210 1152 A
1404(a)S
(vector)252 1488 A
1782(of)S
(i/o)126 1908 A
(requests.)378 2076 A
(Handle)252 2538 A
(requests)336 2832 A
(one)126 3210 A
3378(at)S
3504(a)S
(time.)210 3588 A
(Return)252 3882 A
3150 V
(09260)210 648 A
1068(*)S
(status)252 1152 A
1446(in)S
(the)126 1572 A
(vector.)294 1740 A
3240 V
(09261)210 648 A
1068(*/)S
3330 V
(09262)210 648 A
3420 V
(09263)210 648 A
(struct)252 1110 A
(iorequest_s)462 1404 A
(*iop;)210 1908 A
3510 V
(09264)210 648 A
(static)252 1110 A
(struct)252 1404 A
(iorequest_s)462 1698 A
(iovec[NR_IOREQS];)714 2202 A
3600 V
(09265)210 648 A
(phys_bytes)420 1110 A
(iovec_phys;)462 1572 A
3690 V
(09266)210 648 A
(unsigned)336 1110 A
(nr_requests;)504 1488 A
3780 V
(09267)210 648 A
(int)126 1110 A
(request;)336 1278 A
3870 V
(09268)210 648 A
(int)126 1110 A
1278(r;)S
3960 V
(09269)210 648 A
(phys_bytes)420 1110 A
(user_iovec_phys;)672 1572 A
4050 V
(09270)210 648 A
4140 V
(09271)210 648 A
(nr_requests)462 1110 A
1614(=)S
(m_ptr->COUNT;)546 1698 A
4230 V
(09272)210 648 A
4320 V
(09273)210 648 A
1110(if)S
(\(nr_requests)504 1236 A
1782(>)S
(sizeof)252 1866 A
(iovec)210 2160 A
2412(/)S
(sizeof)252 2496 A
(iovec[0]\))378 2790 A
4410 V
(09274)210 648 A
(panic\("FS)378 1362 A
(passed)252 1782 A
(too)126 2076 A
(big)126 2244 A
2412(an)S
(I/O)126 2538 A
(vector",)336 2706 A
(nr_requests\);)546 3084 A
4500 V
(09275)210 648 A
4590 V
(09276)210 648 A
(iovec_phys)420 1110 A
1572(=)S
(vir2phys\(iovec\);)672 1656 A
4680 V
(09277)210 648 A
(user_iovec_phys)630 1110 A
1782(=)S
(numap\(m_ptr->PROC_NR,)882 1866 A
(\(vir_bytes\))462 2790 A
(m_ptr->ADDRESS,)630 3294 A
4770 V
(09278)210 648 A
(\(vir_bytes\))462 2076 A
(\(nr_requests)504 2580 A
3126(*)S
(sizeof)252 3210 A
(iovec[0]\)\);)462 3504 A
4860 V
(09279)210 648 A
4950 V
(09280)210 648 A
1110(if)S
(\(user_iovec_phys)672 1236 A
1950(==)S
2076(0\))S
5040 V
(09281)210 648 A
(panic\("FS)378 1362 A
(passed)252 1782 A
2076(a)S
(bad)126 2160 A
(I/O)126 2328 A
(vector",)336 2496 A
(\(int\))210 2874 A
(m_ptr->ADDRESS\);)672 3126 A
5130 V
(09282)210 648 A
5220 V
(09283)210 648 A
(phys_copy\(user_iovec_phys,)1092 1110 A
(iovec_phys,)462 2244 A
5310 V
(09284)210 648 A
(\(phys_bytes\))504 2202 A
(nr_requests)462 2748 A
3252(*)S
(sizeof)252 3336 A
(iovec[0]\);)420 3630 A
5400 V
(09285)210 648 A
5490 V
(09286)210 648 A
1110(if)S
(\(\(*dp->dr_prepare\)\(m_ptr->DEVICE\))1386 1236 A
2664(==)S
(NIL_DEV\))336 2790 A
(return\(ENXIO\);)588 3168 A
5580 V
(09287)210 648 A
5670 V
(09288)210 648 A
(for)126 1110 A
(\(request)336 1278 A
1656(=)S
1740(0,)S
(iop)126 1866 A
2034(=)S
(iovec;)252 2118 A
(request)294 2412 A
2748(<)S
(nr_requests;)504 2832 A
(request++,)420 3378 A
(iop++\))252 3840 A
4134({)S
5760 V
(09289)210 648 A
1362(if)S
(\(\(r)126 1488 A
1656(=)S
(\(*dp->dr_schedule\)\(m_ptr->PROC_NR,)1428 1740 A
(iop\)\))210 3210 A
3462(!=)S
(OK\))126 3588 A
(break;)252 3756 A
5850 V
(09290)210 648 A
1110(})S
5940 V
(09291)210 648 A
6030 V
(09292)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
(\(void\))252 1656 A
(\(*dp->dr_finish\)\(\);)798 1950 A
6120 V
(09293)210 648 A
6210 V
(09294)210 648 A
(phys_copy\(iovec_phys,)882 1110 A
(user_iovec_phys,)672 2034 A
8418 V
EP
%%Page: 118 118
BP
/slant 0 def
/height 0 def
630 V
12 B
(118)180 648 A
11 R
2015(File:)S
2248(src/kernel/driver.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(09295)210 648 A
(\(phys_bytes\))504 2202 A
(nr_requests)462 2748 A
3252(*)S
(sizeof)252 3336 A
(iovec[0]\);)420 3630 A
990 V
(09296)210 648 A
(return\(OK\);)462 1110 A
1080 V
(09297)210 648 A
1026(})S
1260 V
(09299)210 648 A
(/*===========================================================================*)3276 1026 A
1350 V
(09300)210 648 A
1068(*)S
(no_name)294 2370 A
4260(*)S
1440 V
(09301)210 648 A
(*===========================================================================*/)3276 1068 A
1530 V
(09302)210 648 A
(PUBLIC)252 1026 A
(char)168 1320 A
(*no_name\(\))420 1530 A
1620 V
(09303)210 648 A
1026({)S
1710 V
(09304)210 648 A
1026(/*)S
1152(If)S
1278(no)S
(specific)336 1404 A
(name)168 1782 A
(for)126 1992 A
(the)126 2160 A
(device.)294 2328 A
2664(*/)S
1800 V
(09305)210 648 A
1890 V
(09306)210 648 A
(return\(tasktab[proc_number\(proc_ptr\))1512 1110 A
2664(+)S
(NR_TASKS].name\);)672 2748 A
1980 V
(09307)210 648 A
1026(})S
2160 V
(09309)210 648 A
(/*============================================================================*)3318 1026 A
2250 V
(09310)210 648 A
1068(*)S
(do_nop)252 2370 A
4302(*)S
2340 V
(09311)210 648 A
(*============================================================================*/)3318 1068 A
2430 V
(09312)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_nop\(dp,)420 1488 A
(m_ptr\))252 1950 A
2520 V
(09313)210 648 A
(struct)252 1026 A
(driver)252 1320 A
(*dp;)168 1614 A
2610 V
(09314)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2700 V
(09315)210 648 A
1026({)S
2790 V
(09316)210 648 A
1026(/*)S
(Nothing)294 1152 A
(there,)252 1488 A
1782(or)S
(nothing)294 1908 A
2244(to)S
(do.)126 2370 A
2538(*/)S
2880 V
(09317)210 648 A
2970 V
(09318)210 648 A
(switch)252 1110 A
(\(m_ptr->m_type\))630 1404 A
2076({)S
3060 V
(09319)210 648 A
(case)168 1110 A
(DEV_OPEN:)378 1320 A
(return\(ENODEV\);)630 2034 A
3150 V
(09320)210 648 A
(case)168 1110 A
(DEV_CLOSE:)420 1320 A
(return\(OK\);)462 2034 A
3240 V
(09321)210 648 A
(case)168 1110 A
(DEV_IOCTL:)420 1320 A
(return\(ENOTTY\);)630 2034 A
3330 V
(09322)210 648 A
(default:)336 1110 A
(return\(EIO\);)504 2034 A
3420 V
(09323)210 648 A
1110(})S
3510 V
(09324)210 648 A
1026(})S
3690 V
(09326)210 648 A
(/*===========================================================================*)3276 1026 A
3780 V
(09327)210 648 A
1068(*)S
(nop_finish)420 2370 A
4260(*)S
3870 V
(09328)210 648 A
(*===========================================================================*/)3276 1068 A
3960 V
(09329)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(nop_finish\(\))504 1488 A
4050 V
(09330)210 648 A
1026({)S
4140 V
(09331)210 648 A
1026(/*)S
(Nothing)294 1152 A
1488(to)S
(finish,)294 1614 A
(all)126 1950 A
(the)126 2118 A
(work)168 2286 A
(has)126 2496 A
(been)168 2664 A
(done)168 2874 A
3084(by)S
(dp->dr_schedule.)672 3210 A
3924(*/)S
4230 V
(09332)210 648 A
(return\(OK\);)462 1110 A
4320 V
(09333)210 648 A
1026(})S
4500 V
(09335)210 648 A
(/*===========================================================================*)3276 1026 A
4590 V
(09336)210 648 A
1068(*)S
(nop_cleanup)462 2370 A
4260(*)S
4680 V
(09337)210 648 A
(*===========================================================================*/)3276 1068 A
4770 V
(09338)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(nop_cleanup\(\))546 1530 A
4860 V
(09339)210 648 A
1026({)S
4950 V
(09340)210 648 A
1026(/*)S
(Nothing)294 1152 A
1488(to)S
(clean)210 1614 A
(up.)126 1866 A
2034(*/)S
5040 V
(09341)210 648 A
1026(})S
5220 V
(09343)210 648 A
(/*===========================================================================*)3276 1026 A
5310 V
(09344)210 648 A
1068(*)S
(clock_mess)420 2370 A
4260(*)S
5400 V
(09345)210 648 A
(*===========================================================================*/)3276 1068 A
5490 V
(09346)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(clock_mess\(ticks,)714 1530 A
(func\))210 2286 A
5580 V
(09347)210 648 A
(int)126 1026 A
(ticks;)252 1194 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(clock)210 2874 A
(ticks)210 3126 A
3378(to)S
(wait)168 3504 A
3714(*/)S
5670 V
(09348)210 648 A
(watchdog_t)420 1026 A
(func;)210 1488 A
2370(/*)S
(function)336 2496 A
2874(to)S
(call)168 3000 A
(upon)168 3210 A
(time)168 3420 A
(out)126 3630 A
3798(*/)S
5760 V
(09349)210 648 A
1026({)S
5850 V
(09350)210 648 A
1026(/*)S
(Send)168 1152 A
(the)126 1362 A
(clock)210 1530 A
(task)168 1782 A
1992(a)S
(message.)336 2076 A
2454(*/)S
5940 V
(09351)210 648 A
6030 V
(09352)210 648 A
(message)294 1110 A
(mess;)210 1446 A
6120 V
(09353)210 648 A
6210 V
(09354)210 648 A
(mess.m_type)462 1110 A
1614(=)S
(SET_ALARM;)420 1698 A
8418 V
EP
%%Page: 119 119
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2015(File:)S
2248(src/kernel/driver.c)S
12 B
(119)180 4248 A
900 V
7 LST
(09355)210 648 A
(mess.CLOCK_PROC_NR)756 1110 A
1908(=)S
(proc_number\(proc_ptr\);)924 1992 A
990 V
(09356)210 648 A
(mess.DELTA_TICKS)672 1110 A
1824(=)S
(\(long\))252 1908 A
(ticks;)252 2202 A
1080 V
(09357)210 648 A
(mess.FUNC_TO_CALL)714 1110 A
1866(=)S
(\(sighandler_t\))588 1950 A
(func;)210 2580 A
1170 V
(09358)210 648 A
(sendrec\(CLOCK,)588 1110 A
(&mess\);)294 1740 A
1260 V
(09359)210 648 A
1026(})S
1440 V
(09361)210 648 A
(/*============================================================================*)3318 1026 A
1530 V
(09362)210 648 A
1068(*)S
(do_diocntl)420 2370 A
4302(*)S
1620 V
(09363)210 648 A
(*============================================================================*/)3318 1068 A
1710 V
(09364)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_diocntl\(dp,)588 1488 A
(m_ptr\))252 2118 A
1800 V
(09365)210 648 A
(struct)252 1026 A
(driver)252 1320 A
(*dp;)168 1614 A
1890 V
(09366)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(ioctl)210 2958 A
(request)294 3210 A
3546(*/)S
1980 V
(09367)210 648 A
1026({)S
2070 V
(09368)210 648 A
1026(/*)S
(Carry)210 1152 A
(out)126 1404 A
1572(a)S
(partition)378 1656 A
(setting/getting)630 2076 A
(request.)336 2748 A
3126(*/)S
2160 V
(09369)210 648 A
(struct)252 1110 A
(device)252 1404 A
(*dv;)168 1698 A
2250 V
(09370)210 648 A
(phys_bytes)420 1110 A
(user_phys,)420 1572 A
(entry_phys;)462 2034 A
2340 V
(09371)210 648 A
(struct)252 1110 A
(partition)378 1404 A
(entry;)252 1824 A
2430 V
(09372)210 648 A
2520 V
(09373)210 648 A
1110(if)S
(\(m_ptr->REQUEST)630 1236 A
1908(!=)S
(DIOCSETP)336 2034 A
2412(&&)S
(m_ptr->REQUEST)588 2538 A
3168(!=)S
(DIOCGETP\))378 3294 A
(return\(ENOTTY\);)630 3714 A
2610 V
(09374)210 648 A
2700 V
(09375)210 648 A
1110(/*)S
(Decode)252 1236 A
(the)126 1530 A
(message)294 1698 A
(parameters.)462 2034 A
2538(*/)S
2790 V
(09376)210 648 A
1110(if)S
(\(\(dv)168 1236 A
1446(=)S
(\(*dp->dr_prepare\)\(m_ptr->DEVICE\)\))1386 1530 A
2958(==)S
(NIL_DEV\))336 3084 A
(return\(ENXIO\);)588 3462 A
2880 V
(09377)210 648 A
2970 V
(09378)210 648 A
(user_phys)378 1110 A
1530(=)S
(numap\(m_ptr->PROC_NR,)882 1614 A
(\(vir_bytes\))462 2538 A
(m_ptr->ADDRESS,)630 3042 A
(sizeof\(entry\)\);)630 3714 A
3060 V
(09379)210 648 A
1110(if)S
(\(user_phys)420 1236 A
1698(==)S
1824(0\))S
(return\(EFAULT\);)630 1950 A
3150 V
(09380)210 648 A
3240 V
(09381)210 648 A
(entry_phys)420 1110 A
1572(=)S
(vir2phys\(&entry\);)714 1656 A
3330 V
(09382)210 648 A
3420 V
(09383)210 648 A
1110(if)S
(\(m_ptr->REQUEST)630 1236 A
1908(==)S
(DIOCSETP\))378 2034 A
2454({)S
3510 V
(09384)210 648 A
1362(/*)S
(Copy)168 1488 A
(just)168 1698 A
(this)168 1908 A
(one)126 2118 A
(partition)378 2286 A
(table)210 2706 A
(entry.)252 2958 A
3252(*/)S
3600 V
(09385)210 648 A
(phys_copy\(user_phys,)840 1362 A
(entry_phys,)462 2244 A
(\(phys_bytes\))504 2748 A
(sizeof\(entry\)\);)630 3294 A
3690 V
(09386)210 648 A
(dv->dv_base)462 1362 A
1866(=)S
(entry.base;)462 1950 A
3780 V
(09387)210 648 A
(dv->dv_size)462 1362 A
1866(=)S
(entry.size;)462 1950 A
3870 V
(09388)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3960 V
(09389)210 648 A
1362(/*)S
(Return)252 1488 A
1782(a)S
(partition)378 1866 A
(table)210 2286 A
(entry)210 2538 A
(and)126 2790 A
(the)126 2958 A
(geometry)336 3126 A
3504(of)S
(the)126 3630 A
(drive.)252 3798 A
4092(*/)S
4050 V
(09390)210 648 A
(entry.base)420 1362 A
1824(=)S
(dv->dv_base;)504 1908 A
4140 V
(09391)210 648 A
(entry.size)420 1362 A
1824(=)S
(dv->dv_size;)504 1908 A
4230 V
(09392)210 648 A
(\(*dp->dr_geometry\)\(&entry\);)1134 1362 A
4320 V
(09393)210 648 A
(phys_copy\(entry_phys,)882 1362 A
(user_phys,)420 2286 A
(\(phys_bytes\))504 2748 A
(sizeof\(entry\)\);)630 3294 A
4410 V
(09394)210 648 A
1110(})S
4500 V
(09395)210 648 A
(return\(OK\);)462 1110 A
4590 V
(09396)210 648 A
1026(})S
5040 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5130 V
(src/kernel/drvlib.h)798 2034 A
5220 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5400 V
(09400)210 648 A
1026(/*)S
(IBM)126 1152 A
(device)252 1320 A
(driver)252 1614 A
(definitions)462 1908 A
(Author:)294 3378 A
(Kees)168 3714 A
3924(J.)S
(Bot)126 4050 A
5490 V
(09401)210 648 A
1068(*)S
3714(7)S
(Dec)126 3798 A
(1995)168 3966 A
5580 V
(09402)210 648 A
1068(*/)S
5670 V
(09403)210 648 A
5760 V
(09404)210 648 A
(#include)336 1026 A
(<ibm/partition.h>)714 1404 A
5850 V
(09405)210 648 A
5940 V
(09406)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(partition,)420 1740 A
(\(struct)294 2202 A
(driver)252 2538 A
(*dr,)168 2832 A
(int)126 3042 A
(device,)294 3210 A
(int)126 3546 A
(style\))252 3714 A
4008(\);)S
6030 V
(09407)210 648 A
6120 V
(09408)210 648 A
1026(/*)S
(BIOS)168 1152 A
(parameter)378 1362 A
(table)210 1782 A
(layout.)294 2034 A
2370(*/)S
6210 V
(09409)210 648 A
(#define)294 1026 A
(bp_cylinders\(t\))630 1362 A
2370(\(*)S
(\(u16_t)252 2496 A
2790(*\))S
(\(&\(t\)[0]\)\))420 2916 A
8418 V
EP
%%Page: 120 120
BP
/slant 0 def
/height 0 def
630 V
12 B
(120)180 648 A
11 R
2013(File:)S
2246(src/kernel/drvlib.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(09410)210 648 A
(#define)294 1026 A
(bp_heads\(t\))462 1362 A
2370(\(*)S
(\(u8_t)210 2496 A
2748(*\))S
(\(&\(t\)[2]\)\))420 2916 A
990 V
(09411)210 648 A
(#define)294 1026 A
(bp_reduced_wr\(t\))672 1362 A
2370(\(*)S
(\(u16_t)252 2496 A
2790(*\))S
(\(&\(t\)[3]\)\))420 2916 A
1080 V
(09412)210 648 A
(#define)294 1026 A
(bp_precomp\(t\))546 1362 A
2370(\(*)S
(\(u16_t)252 2496 A
2790(*\))S
(\(&\(t\)[5]\)\))420 2916 A
1170 V
(09413)210 648 A
(#define)294 1026 A
(bp_max_ecc\(t\))546 1362 A
2370(\(*)S
(\(u8_t)210 2496 A
2748(*\))S
(\(&\(t\)[7]\)\))420 2916 A
1260 V
(09414)210 648 A
(#define)294 1026 A
(bp_ctlbyte\(t\))546 1362 A
2370(\(*)S
(\(u8_t)210 2496 A
2748(*\))S
(\(&\(t\)[8]\)\))420 2916 A
1350 V
(09415)210 648 A
(#define)294 1026 A
(bp_landingzone\(t\))714 1362 A
2370(\(*)S
(\(u16_t)252 2496 A
2790(*\))S
(\(&\(t\)[12]\)\))462 2916 A
1440 V
(09416)210 648 A
(#define)294 1026 A
(bp_sectors\(t\))546 1362 A
2370(\(*)S
(\(u8_t)210 2496 A
2748(*\))S
(\(&\(t\)[14]\)\))462 2916 A
1530 V
(09417)210 648 A
1620 V
(09418)210 648 A
1026(/*)S
(Miscellaneous.)588 1152 A
1782(*/)S
1710 V
(09419)210 648 A
(#define)294 1026 A
(DEV_PER_DRIVE)546 1362 A
2034(\(1)S
2160(+)S
(NR_PARTITIONS\))588 2244 A
1800 V
(09420)210 648 A
(#define)294 1026 A
(MINOR_hd1a)420 1362 A
(128)126 2034 A
1890 V
(09421)210 648 A
(#define)294 1026 A
(MINOR_fd0a)420 1362 A
(\(28<<2\))294 2034 A
1980 V
(09422)210 648 A
(#define)294 1026 A
(P_FLOPPY)336 1362 A
2034(0)S
2070 V
(09423)210 648 A
(#define)294 1026 A
(P_PRIMARY)378 1362 A
2034(1)S
2160 V
(09424)210 648 A
(#define)294 1026 A
(P_SUB)210 1362 A
2034(2)S
2790 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2880 V
(src/kernel/drvlib.c)798 2034 A
2970 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3150 V
(09500)210 648 A
1026(/*)S
(IBM)126 1152 A
(device)252 1320 A
(driver)252 1614 A
(utility)294 1908 A
(functions.)420 2244 A
(Author:)294 3378 A
(Kees)168 3714 A
3924(J.)S
(Bot)126 4050 A
3240 V
(09501)210 648 A
1068(*)S
3714(7)S
(Dec)126 3798 A
(1995)168 3966 A
3330 V
(09502)210 648 A
1068(*)S
(Entry)210 1152 A
(point:)252 1404 A
3420 V
(09503)210 648 A
1068(*)S
(partition:)420 1236 A
(partition)378 1698 A
2118(a)S
(disk)168 2202 A
2412(to)S
(the)126 2538 A
(partition)378 2706 A
(table\(s\))336 3126 A
3504(on)S
(it.)126 3630 A
3510 V
(09504)210 648 A
1068(*/)S
3600 V
(09505)210 648 A
3690 V
(09506)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
3780 V
(09507)210 648 A
(#include)336 1026 A
("driver.h")420 1404 A
3870 V
(09508)210 648 A
(#include)336 1026 A
("drvlib.h")420 1404 A
3960 V
(09509)210 648 A
4050 V
(09510)210 648 A
4140 V
(09511)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(extpartition,)546 2076 A
(\(struct)294 2664 A
(driver)252 3000 A
(*dp,)168 3294 A
(int)126 3504 A
(extdev,)294 3672 A
4230 V
(09512)210 648 A
(unsigned)336 3042 A
(long)168 3420 A
(extbase\))336 3630 A
4008(\);)S
4320 V
(09513)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(get_part_table,)630 2034 A
(\(struct)294 2706 A
(driver)252 3042 A
(*dp,)168 3336 A
(int)126 3546 A
(device,)294 3714 A
4410 V
(09514)210 648 A
(unsigned)336 2034 A
(long)168 2412 A
(offset,)294 2622 A
(struct)252 2958 A
(part_entry)420 3252 A
(*table\))294 3714 A
4050(\);)S
4500 V
(09515)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(sort,)210 2076 A
(\(struct)294 2328 A
(part_entry)420 2664 A
(*table\))294 3126 A
3462(\);)S
4590 V
(09516)210 648 A
4680 V
(09517)210 648 A
4770 V
(09518)210 648 A
(/*============================================================================*)3318 1026 A
4860 V
(09519)210 648 A
1068(*)S
(partition)378 2370 A
4302(*)S
4950 V
(09520)210 648 A
(*============================================================================*/)3318 1068 A
5040 V
(09521)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(partition\(dp,)546 1530 A
(device,)294 2118 A
(style\))252 2454 A
5130 V
(09522)210 648 A
(struct)252 1026 A
(driver)252 1320 A
(*dp;)168 1614 A
2034(/*)S
(device)252 2160 A
(dependent)378 2454 A
(entry)210 2874 A
(points)252 3126 A
3420(*/)S
5220 V
(09523)210 648 A
(int)126 1026 A
(device;)294 1194 A
2034(/*)S
(device)252 2160 A
2454(to)S
(partition)378 2580 A
3000(*/)S
5310 V
(09524)210 648 A
(int)126 1026 A
(style;)252 1194 A
2034(/*)S
(partitioning)504 2160 A
(style:)252 2706 A
(floppy,)294 3000 A
(primary,)336 3336 A
(sub.)168 3714 A
3924(*/)S
5400 V
(09525)210 648 A
1026({)S
5490 V
(09526)210 648 A
1026(/*)S
(This)168 1152 A
(routine)294 1362 A
1698(is)S
(called)252 1824 A
2118(on)S
(first)210 2244 A
(open)168 2496 A
2706(to)S
(initialize)420 2832 A
(the)126 3294 A
(partition)378 3462 A
(tables)252 3882 A
5580 V
(09527)210 648 A
1068(*)S
1152(of)S
1278(a)S
(device.)294 1362 A
1740(It)S
(makes)210 1866 A
(sure)168 2118 A
(that)168 2328 A
(each)168 2538 A
(partition)378 2748 A
(falls)210 3168 A
(safely)252 3420 A
(within)252 3714 A
(the)126 4008 A
5670 V
(09528)210 648 A
1068(*)S
(device's)336 1152 A
(limits.)294 1530 A
(Depending)378 1908 A
2328(on)S
(the)126 2454 A
(partition)378 2622 A
(style)210 3042 A
3294(we)S
(are)126 3420 A
(either)252 3588 A
(making)252 3882 A
5760 V
(09529)210 648 A
1068(*)S
(floppy)252 1152 A
(partitions,)462 1446 A
(primary)294 1950 A
(partitions)420 2286 A
2748(or)S
(subpartitions.)588 2874 A
(Only)168 3546 A
(primary)294 3756 A
5850 V
(09530)210 648 A
1068(*)S
(partitions)420 1152 A
(are)126 1614 A
(sorted,)294 1782 A
(because)294 2118 A
(they)168 2454 A
(are)126 2664 A
(shared)252 2832 A
(with)168 3126 A
(other)210 3336 A
(operating)378 3588 A
5940 V
(09531)210 648 A
1068(*)S
(systems)294 1152 A
(that)168 1488 A
(expect)252 1698 A
(this.)210 1992 A
6030 V
(09532)210 648 A
1068(*/)S
6120 V
(09533)210 648 A
(struct)252 1110 A
(part_entry)420 1404 A
(table[NR_PARTITIONS],)882 1866 A
(*pe;)168 2790 A
6210 V
(09534)210 648 A
(int)126 1110 A
(disk,)210 1278 A
(par;)168 1530 A
8418 V
EP
%%Page: 121 121
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2015(File:)S
2248(src/kernel/drvlib.c)S
12 B
(121)180 4248 A
900 V
7 LST
(09535)210 648 A
(struct)252 1110 A
(device)252 1404 A
(*dv;)168 1698 A
990 V
(09536)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(base,)210 1698 A
(limit,)252 1950 A
(part_limit;)462 2244 A
1080 V
(09537)210 648 A
1170 V
(09538)210 648 A
1110(/*)S
(Get)126 1236 A
(the)126 1404 A
(geometry)336 1572 A
1950(of)S
(the)126 2076 A
(device)252 2244 A
2538(to)S
(partition)378 2664 A
3084(*/)S
1260 V
(09539)210 648 A
1110(if)S
(\(\(dv)168 1236 A
1446(=)S
(\(*dp->dr_prepare\)\(device\)\))1092 1530 A
2664(==)S
(NIL_DEV)294 2790 A
3126(||)S
(dv->dv_size)462 3252 A
3756(==)S
3882(0\))S
(return;)294 4008 A
1350 V
(09540)210 648 A
(base)168 1110 A
1320(=)S
(dv->dv_base)462 1404 A
1908(>>)S
(SECTOR_SHIFT;)546 2034 A
1440 V
(09541)210 648 A
(limit)210 1110 A
1362(=)S
(base)168 1446 A
1656(+)S
(\(dv->dv_size)504 1740 A
2286(>>)S
(SECTOR_SHIFT\);)588 2412 A
1530 V
(09542)210 648 A
1620 V
(09543)210 648 A
1110(/*)S
(Read)168 1236 A
(the)126 1446 A
(partition)378 1614 A
(table)210 2034 A
(for)126 2286 A
(the)126 2454 A
(device.)294 2622 A
2958(*/)S
1710 V
(09544)210 648 A
1110(if)S
(\(!get_part_table\(dp,)840 1236 A
(device,)294 2118 A
(0L,)126 2454 A
(table\)\))294 2622 A
(return;)294 2958 A
1800 V
(09545)210 648 A
1890 V
(09546)210 648 A
1110(/*)S
(Compute)294 1236 A
(the)126 1572 A
(device)252 1740 A
(number)252 2034 A
2328(of)S
(the)126 2454 A
(first)210 2622 A
(partition.)420 2874 A
3336(*/)S
1980 V
(09547)210 648 A
(switch)252 1110 A
(\(style\))294 1404 A
1740({)S
2070 V
(09548)210 648 A
(case)168 1110 A
(P_FLOPPY:)378 1320 A
2160 V
(09549)210 648 A
(device)252 1362 A
1656(+=)S
(MINOR_fd0a;)462 1782 A
2250 V
(09550)210 648 A
(break;)252 1362 A
2340 V
(09551)210 648 A
(case)168 1110 A
(P_PRIMARY:)420 1320 A
2430 V
(09552)210 648 A
(sort\(table\);)504 1362 A
2370(/*)S
(sort)168 2496 A
2706(a)S
(primary)294 2790 A
(partition)378 3126 A
(table)210 3546 A
3798(*/)S
2520 V
(09553)210 648 A
(device)252 1362 A
1656(+=)S
1782(1;)S
2610 V
(09554)210 648 A
(break;)252 1362 A
2700 V
(09555)210 648 A
(case)168 1110 A
(P_SUB:)252 1320 A
2790 V
(09556)210 648 A
(disk)168 1362 A
1572(=)S
(device)252 1656 A
1950(/)S
(DEV_PER_DRIVE;)588 2034 A
2880 V
(09557)210 648 A
(par)126 1362 A
1530(=)S
(device)252 1614 A
1908(%)S
(DEV_PER_DRIVE)546 1992 A
2580(-)S
2664(1;)S
2970 V
(09558)210 648 A
(device)252 1362 A
1656(=)S
(MINOR_hd1a)420 1740 A
2202(+)S
(\(disk)210 2286 A
2538(*)S
(NR_PARTITIONS)546 2622 A
3210(+)S
(par\))168 3294 A
3504(*)S
(NR_PARTITIONS;)588 3588 A
3060 V
(09559)210 648 A
1110(})S
3150 V
(09560)210 648 A
3240 V
(09561)210 648 A
1110(/*)S
(Find)168 1236 A
1446(an)S
(array)210 1572 A
1824(of)S
(devices.)336 1950 A
2328(*/)S
3330 V
(09562)210 648 A
1110(if)S
(\(\(dv)168 1236 A
1446(=)S
(\(*dp->dr_prepare\)\(device\)\))1092 1530 A
2664(==)S
(NIL_DEV\))336 2790 A
(return;)294 3168 A
3420 V
(09563)210 648 A
3510 V
(09564)210 648 A
1110(/*)S
(Set)126 1236 A
(the)126 1404 A
(geometry)336 1572 A
1950(of)S
(the)126 2076 A
(partitions)420 2244 A
(from)168 2706 A
(the)126 2916 A
(partition)378 3084 A
(table.)252 3504 A
3798(*/)S
3600 V
(09565)210 648 A
(for)126 1110 A
(\(par)168 1278 A
1488(=)S
1572(0;)S
(par)126 1698 A
1866(<)S
(NR_PARTITIONS;)588 1950 A
(par++,)252 2580 A
(dv++\))210 2874 A
3126({)S
3690 V
(09566)210 648 A
1362(/*)S
(Shrink)252 1488 A
(the)126 1782 A
(partition)378 1950 A
2370(to)S
(fit)126 2496 A
(within)252 2664 A
(the)126 2958 A
(device.)294 3126 A
3462(*/)S
3780 V
(09567)210 648 A
1362(pe)S
1488(=)S
(&table[par];)504 1572 A
3870 V
(09568)210 648 A
(part_limit)420 1362 A
1824(=)S
(pe->lowsec)420 1908 A
2370(+)S
(pe->size;)378 2454 A
3960 V
(09569)210 648 A
1362(if)S
(\(part_limit)462 1488 A
1992(<)S
(pe->lowsec\))462 2076 A
(part_limit)420 2580 A
3042(=)S
(limit;)252 3126 A
4050 V
(09570)210 648 A
1362(if)S
(\(part_limit)462 1488 A
1992(>)S
(limit\))252 2076 A
(part_limit)420 2370 A
2832(=)S
(limit;)252 2916 A
4140 V
(09571)210 648 A
1362(if)S
(\(pe->lowsec)462 1488 A
1992(<)S
(base\))210 2076 A
(pe->lowsec)420 2328 A
2790(=)S
(base;)210 2874 A
4230 V
(09572)210 648 A
1362(if)S
(\(part_limit)462 1488 A
1992(<)S
(pe->lowsec\))462 2076 A
(part_limit)420 2580 A
3042(=)S
(pe->lowsec;)462 3126 A
4320 V
(09573)210 648 A
4410 V
(09574)210 648 A
(dv->dv_base)462 1362 A
1866(=)S
(pe->lowsec)420 1950 A
2412(<<)S
(SECTOR_SHIFT;)546 2538 A
4500 V
(09575)210 648 A
(dv->dv_size)462 1362 A
1866(=)S
(\(part_limit)462 1950 A
2454(-)S
(pe->lowsec\))462 2538 A
3042(<<)S
(SECTOR_SHIFT;)546 3168 A
4590 V
(09576)210 648 A
4680 V
(09577)210 648 A
1362(if)S
(\(style)252 1488 A
1782(==)S
(P_PRIMARY\))420 1908 A
2370({)S
4770 V
(09578)210 648 A
1698(/*)S
(Each)168 1824 A
(Minix)210 2034 A
(primary)294 2286 A
(partition)378 2622 A
(can)126 3042 A
3210(be)S
(subpartitioned.)630 3336 A
4008(*/)S
4860 V
(09579)210 648 A
1698(if)S
(\(pe->sysind)462 1824 A
2328(==)S
(MINIX_PART\))462 2454 A
4950 V
(09580)210 648 A
(partition\(dp,)546 2034 A
(device)252 2622 A
2916(+)S
(par,)168 3000 A
(P_SUB\);)294 3210 A
5040 V
(09581)210 648 A
5130 V
(09582)210 648 A
1698(/*)S
1824(An)S
(extended)336 1950 A
(partition)378 2328 A
(has)126 2748 A
(logical)294 2916 A
(partitions.)462 3252 A
3756(*/)S
5220 V
(09583)210 648 A
1698(if)S
(\(pe->sysind)462 1824 A
2328(==)S
(EXT_PART\))378 2454 A
5310 V
(09584)210 648 A
(extpartition\(dp,)672 2034 A
(device)252 2748 A
3042(+)S
(par,)168 3126 A
(pe->lowsec\);)504 3336 A
5400 V
(09585)210 648 A
1362(})S
5490 V
(09586)210 648 A
1110(})S
5580 V
(09587)210 648 A
1026(})S
5850 V
(09590)210 648 A
(/*============================================================================*)3318 1026 A
5940 V
(09591)210 648 A
1068(*)S
(extpartition)504 2370 A
4302(*)S
6030 V
(09592)210 648 A
(*============================================================================*/)3318 1068 A
6120 V
(09593)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(extpartition\(dp,)672 1572 A
(extdev,)294 2286 A
(extbase\))336 2622 A
6210 V
(09594)210 648 A
(struct)252 1026 A
(driver)252 1320 A
(*dp;)168 1614 A
2034(/*)S
(device)252 2160 A
(dependent)378 2454 A
(entry)210 2874 A
(points)252 3126 A
3420(*/)S
8418 V
EP
%%Page: 122 122
BP
/slant 0 def
/height 0 def
630 V
12 B
(122)180 648 A
11 R
2015(File:)S
2248(src/kernel/drvlib.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(09595)210 648 A
(int)126 1026 A
(extdev;)294 1194 A
2034(/*)S
(extended)336 2160 A
(partition)378 2538 A
2958(to)S
(scan)168 3084 A
3294(*/)S
990 V
(09596)210 648 A
(unsigned)336 1026 A
(long)168 1404 A
(extbase;)336 1614 A
2034(/*)S
(sector)252 2160 A
(offset)252 2454 A
2748(of)S
(the)126 2874 A
(base)168 3042 A
(extended)336 3252 A
(partition)378 3630 A
4050(*/)S
1080 V
(09597)210 648 A
1026({)S
1170 V
(09598)210 648 A
1026(/*)S
(Extended)336 1152 A
(partitions)420 1530 A
(cannot)252 1992 A
2286(be)S
(ignored)294 2412 A
(alas,)210 2748 A
(because)294 3000 A
(people)252 3336 A
(like)168 3630 A
3840(to)S
(move)168 3966 A
1260 V
(09599)210 648 A
1068(*)S
(files)210 1152 A
1404(to)S
(and)126 1530 A
(from)168 1698 A
(DOS)126 1908 A
(partitions.)462 2076 A
(Avoid)210 2622 A
(reading)294 2874 A
(this)168 3210 A
(code,)210 3420 A
(it's)168 3672 A
3882(no)S
(fun.)168 4008 A
1350 V
(09600)210 648 A
1068(*/)S
1440 V
(09601)210 648 A
(struct)252 1110 A
(part_entry)420 1404 A
(table[NR_PARTITIONS],)882 1866 A
(*pe;)168 2790 A
1530 V
(09602)210 648 A
(int)126 1110 A
(subdev,)294 1278 A
(disk,)210 1614 A
(par;)168 1866 A
1620 V
(09603)210 648 A
(struct)252 1110 A
(device)252 1404 A
(*dv;)168 1698 A
1710 V
(09604)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(offset,)294 1698 A
(nextoffset;)462 2034 A
1800 V
(09605)210 648 A
1890 V
(09606)210 648 A
(disk)168 1110 A
1320(=)S
(extdev)252 1404 A
1698(/)S
(DEV_PER_DRIVE;)588 1782 A
1980 V
(09607)210 648 A
(par)126 1110 A
1278(=)S
(extdev)252 1362 A
1656(%)S
(DEV_PER_DRIVE)546 1740 A
2328(-)S
2412(1;)S
2070 V
(09608)210 648 A
(subdev)252 1110 A
1404(=)S
(MINOR_hd1a)420 1488 A
1950(+)S
(\(disk)210 2034 A
2286(*)S
(NR_PARTITIONS)546 2370 A
2958(+)S
(par\))168 3042 A
3252(*)S
(NR_PARTITIONS;)588 3336 A
2160 V
(09609)210 648 A
2250 V
(09610)210 648 A
(offset)252 1110 A
1404(=)S
1488(0;)S
2340 V
(09611)210 648 A
1110(do)S
1236({)S
2430 V
(09612)210 648 A
1362(if)S
(\(!get_part_table\(dp,)840 1488 A
(extdev,)294 2370 A
(offset,)294 2706 A
(table\)\))294 3042 A
(return;)294 3378 A
2520 V
(09613)210 648 A
(sort\(table\);)504 1362 A
2610 V
(09614)210 648 A
2700 V
(09615)210 648 A
1362(/*)S
(The)126 1488 A
(table)210 1656 A
(should)252 1908 A
(contain)294 2202 A
(one)126 2538 A
(logical)294 2706 A
(partition)378 3042 A
(and)126 3462 A
(optionally)420 3630 A
2790 V
(09616)210 648 A
1404(*)S
(another)294 1488 A
(extended)336 1824 A
(partition.)420 2202 A
(\(It's)210 2706 A
2958(a)S
(linked)252 3042 A
(list.\))252 3336 A
2880 V
(09617)210 648 A
1404(*/)S
2970 V
(09618)210 648 A
(nextoffset)420 1362 A
1824(=)S
1908(0;)S
3060 V
(09619)210 648 A
(for)126 1362 A
(\(par)168 1530 A
1740(=)S
1824(0;)S
(par)126 1950 A
2118(<)S
(NR_PARTITIONS;)588 2202 A
(par++\))252 2832 A
3126({)S
3150 V
(09620)210 648 A
1698(pe)S
1824(=)S
(&table[par];)504 1908 A
3240 V
(09621)210 648 A
1698(if)S
(\(pe->sysind)462 1824 A
2328(==)S
(EXT_PART\))378 2454 A
2874({)S
3330 V
(09622)210 648 A
(nextoffset)420 2034 A
2496(=)S
(pe->lowsec;)462 2580 A
3420 V
(09623)210 648 A
1698(})S
(else)168 1782 A
3510 V
(09624)210 648 A
1698(if)S
(\(pe->sysind)462 1824 A
2328(!=)S
(NO_PART\))336 2454 A
2832({)S
3600 V
(09625)210 648 A
2034(if)S
(\(\(dv)168 2160 A
2370(=)S
(\(*dp->dr_prepare\)\(subdev\)\))1092 2454 A
3588(==)S
(NIL_DEV\))336 3714 A
(return;)294 4092 A
3690 V
(09626)210 648 A
3780 V
(09627)210 648 A
(dv->dv_base)462 2034 A
2538(=)S
(\(extbase)336 2622 A
3000(+)S
(offset)252 3084 A
3870 V
(09628)210 648 A
2706(+)S
(pe->lowsec\))462 2790 A
3294(<<)S
(SECTOR_SHIFT;)546 3420 A
3960 V
(09629)210 648 A
(dv->dv_size)462 2034 A
2538(=)S
(pe->size)336 2622 A
3000(<<)S
(SECTOR_SHIFT;)546 3126 A
4050 V
(09630)210 648 A
4140 V
(09631)210 648 A
2034(/*)S
(Out)126 2160 A
2328(of)S
(devices?)336 2454 A
2832(*/)S
4230 V
(09632)210 648 A
2034(if)S
(\(++subdev)378 2160 A
2580(%)S
(NR_PARTITIONS)546 2664 A
3252(==)S
3378(0\))S
(return;)294 3504 A
4320 V
(09633)210 648 A
1698(})S
4410 V
(09634)210 648 A
1362(})S
4500 V
(09635)210 648 A
1110(})S
(while)210 1194 A
(\(\(offset)336 1446 A
1824(=)S
(nextoffset\))462 1908 A
2412(!=)S
(0\);)126 2538 A
4590 V
(09636)210 648 A
1026(})S
4860 V
(09639)210 648 A
(/*============================================================================*)3318 1026 A
4950 V
(09640)210 648 A
1068(*)S
(get_part_table)588 2370 A
4302(*)S
5040 V
(09641)210 648 A
(*============================================================================*/)3318 1068 A
5130 V
(09642)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(get_part_table\(dp,)756 1530 A
(device,)294 2328 A
(offset,)294 2664 A
(table\))252 3000 A
5220 V
(09643)210 648 A
(struct)252 1026 A
(driver)252 1320 A
(*dp;)168 1614 A
5310 V
(09644)210 648 A
(int)126 1026 A
(device;)294 1194 A
5400 V
(09645)210 648 A
(unsigned)336 1026 A
(long)168 1404 A
(offset;)294 1614 A
2370(/*)S
(sector)252 2496 A
(offset)252 2790 A
3084(to)S
(the)126 3210 A
(table)210 3378 A
3630(*/)S
5490 V
(09646)210 648 A
(struct)252 1026 A
(part_entry)420 1320 A
(*table;)294 1782 A
2370(/*)S
(four)168 2496 A
(entries)294 2706 A
3042(*/)S
5580 V
(09647)210 648 A
1026({)S
5670 V
(09648)210 648 A
1026(/*)S
(Read)168 1152 A
(the)126 1362 A
(partition)378 1530 A
(table)210 1950 A
(for)126 2202 A
(the)126 2370 A
(device,)294 2538 A
(return)252 2874 A
(true)168 3168 A
(iff)126 3378 A
(there)210 3546 A
(were)168 3798 A
4008(no)S
5760 V
(09649)210 648 A
1068(*)S
(errors.)294 1152 A
5850 V
(09650)210 648 A
1068(*/)S
5940 V
(09651)210 648 A
(message)294 1110 A
(mess;)210 1446 A
6030 V
(09652)210 648 A
6120 V
(09653)210 648 A
(mess.DEVICE)462 1110 A
1614(=)S
(device;)294 1698 A
6210 V
(09654)210 648 A
(mess.POSITION)546 1110 A
1698(=)S
(offset)252 1782 A
2076(<<)S
(SECTOR_SHIFT;)546 2202 A
8418 V
EP
%%Page: 123 123
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2015(File:)S
2248(src/kernel/drvlib.c)S
12 B
(123)180 4248 A
900 V
7 LST
(09655)210 648 A
(mess.COUNT)420 1110 A
1572(=)S
(SECTOR_SIZE;)504 1656 A
990 V
(09656)210 648 A
(mess.ADDRESS)504 1110 A
1656(=)S
(\(char)210 1740 A
1992(*\))S
(tmp_buf;)336 2118 A
1080 V
(09657)210 648 A
(mess.PROC_NR)504 1110 A
1656(=)S
(proc_number\(proc_ptr\);)924 1740 A
1170 V
(09658)210 648 A
(mess.m_type)462 1110 A
1614(=)S
(DEV_READ;)378 1698 A
1260 V
(09659)210 648 A
1350 V
(09660)210 648 A
1110(if)S
(\(do_rdwt\(dp,)504 1236 A
(&mess\))252 1782 A
2076(!=)S
(SECTOR_SIZE\))504 2202 A
2748({)S
1440 V
(09661)210 648 A
(printf\("%s:)462 1362 A
(can't)210 1866 A
(read)168 2118 A
(partition)378 2328 A
(table\\n",)378 2748 A
(\(*dp->dr_name\)\(\)\);)756 3168 A
1530 V
(09662)210 648 A
(return)252 1362 A
1656(0;)S
1620 V
(09663)210 648 A
1110(})S
1710 V
(09664)210 648 A
1110(if)S
(\(tmp_buf[510])546 1236 A
1824(!=)S
(0x55)168 1950 A
2160(||)S
(tmp_buf[511])504 2286 A
2832(!=)S
(0xAA\))210 2958 A
3210({)S
1800 V
(09665)210 648 A
1362(/*)S
(Invalid)294 1488 A
(partition)378 1824 A
(table.)252 2244 A
2538(*/)S
1890 V
(09666)210 648 A
(return)252 1362 A
1656(0;)S
1980 V
(09667)210 648 A
1110(})S
2070 V
(09668)210 648 A
(memcpy\(table,)546 1110 A
(\(tmp_buf)336 1698 A
2076(+)S
(PART_TABLE_OFF\),)672 2160 A
(NR_PARTITIONS)546 2874 A
3462(*)S
(sizeof\(table[0]\)\);)756 3546 A
2160 V
(09669)210 648 A
(return)252 1110 A
1404(1;)S
2250 V
(09670)210 648 A
1026(})S
2520 V
(09673)210 648 A
(/*===========================================================================*)3276 1026 A
2610 V
(09674)210 648 A
1068(*)S
(sort)168 2370 A
4260(*)S
2700 V
(09675)210 648 A
(*===========================================================================*/)3276 1068 A
2790 V
(09676)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(sort\(table\))462 1572 A
2880 V
(09677)210 648 A
(struct)252 1026 A
(part_entry)420 1320 A
(*table;)294 1782 A
2970 V
(09678)210 648 A
1026({)S
3060 V
(09679)210 648 A
1026(/*)S
(Sort)168 1152 A
1362(a)S
(partition)378 1446 A
(table.)252 1866 A
2160(*/)S
3150 V
(09680)210 648 A
(struct)252 1110 A
(part_entry)420 1404 A
(*pe,)168 1866 A
(tmp;)168 2076 A
3240 V
(09681)210 648 A
(int)126 1110 A
1278(n)S
1362(=)S
(NR_PARTITIONS;)588 1446 A
3330 V
(09682)210 648 A
3420 V
(09683)210 648 A
1110(do)S
1236({)S
3510 V
(09684)210 648 A
(for)126 1362 A
(\(pe)126 1530 A
1698(=)S
(table;)252 1782 A
2076(pe)S
2202(<)S
(table)210 2286 A
2538(+)S
(NR_PARTITIONS-1;)672 2622 A
(pe++\))210 3336 A
3588({)S
3600 V
(09685)210 648 A
1698(if)S
(\(pe[0].sysind)546 1824 A
2412(==)S
(NO_PART)294 2538 A
3690 V
(09686)210 648 A
2034(||)S
(\(pe[0].lowsec)546 2160 A
2748(>)S
(pe[1].lowsec)504 2832 A
3780 V
(09687)210 648 A
2706(&&)S
(pe[1].sysind)504 2832 A
3378(!=)S
(NO_PART\)\))378 3504 A
3924({)S
3870 V
(09688)210 648 A
(tmp)126 2034 A
2202(=)S
(pe[0];)252 2286 A
(pe[0])210 2580 A
2832(=)S
(pe[1];)252 2916 A
(pe[1])210 3210 A
3462(=)S
(tmp;)168 3546 A
3960 V
(09689)210 648 A
1698(})S
4050 V
(09690)210 648 A
1362(})S
4140 V
(09691)210 648 A
1110(})S
(while)210 1194 A
(\(--n)168 1446 A
1656(>)S
(0\);)126 1740 A
4230 V
(09692)210 648 A
1026(})S
4590 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4680 V
(src/kernel/memory.c)798 2034 A
4770 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4950 V
(09700)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(device)252 2118 A
(dependent)378 2412 A
(part)168 2832 A
3042(of)S
(the)126 3168 A
(drivers)294 3336 A
(for)126 3672 A
(the)126 3840 A
5040 V
(09701)210 648 A
1068(*)S
(following)378 1152 A
(special)294 1572 A
(files:)252 1908 A
5130 V
(09702)210 648 A
1068(*)S
(/dev/null)378 1320 A
2034(-)S
(null)168 2118 A
(device)252 2328 A
(\(data)210 2622 A
(sink\))210 2874 A
5220 V
(09703)210 648 A
1068(*)S
(/dev/mem)336 1320 A
2034(-)S
(absolute)336 2118 A
(memory)252 2496 A
5310 V
(09704)210 648 A
1068(*)S
(/dev/kmem)378 1320 A
2034(-)S
(kernel)252 2118 A
(virtual)294 2412 A
(memory)252 2748 A
5400 V
(09705)210 648 A
1068(*)S
(/dev/ram)336 1320 A
2034(-)S
(RAM)126 2118 A
(disk)168 2286 A
5490 V
(09706)210 648 A
1068(*)S
5580 V
(09707)210 648 A
1068(*)S
(The)126 1152 A
(file)168 1320 A
(contains)336 1530 A
(one)126 1908 A
(entry)210 2076 A
(point:)252 2328 A
5670 V
(09708)210 648 A
1068(*)S
5760 V
(09709)210 648 A
1068(*)S
(mem_task:)378 1236 A
(main)168 1698 A
(entry)210 1908 A
(when)168 2160 A
(system)252 2370 A
2664(is)S
(brought)294 2790 A
3126(up)S
5850 V
(09710)210 648 A
1068(*)S
5940 V
(09711)210 648 A
1068(*)S
(Changes:)336 1194 A
6030 V
(09712)210 648 A
1068(*)S
1362(20)S
(Apr)126 1488 A
(1992)168 1698 A
1908(by)S
(Kees)168 2034 A
2244(J.)S
(Bot:)168 2370 A
(device)252 2580 A
(dependent/independent)882 2874 A
(split)210 3798 A
6120 V
(09713)210 648 A
1068(*/)S
6210 V
(09714)210 648 A
8418 V
EP
%%Page: 124 124
BP
/slant 0 def
/height 0 def
630 V
12 B
(124)180 648 A
11 R
1963(File:)S
2196(src/kernel/memory.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(09715)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
990 V
(09716)210 648 A
(#include)336 1026 A
("driver.h")420 1404 A
1080 V
(09717)210 648 A
(#include)336 1026 A
(<sys/ioctl.h>)546 1404 A
1170 V
(09718)210 648 A
1260 V
(09719)210 648 A
(#define)294 1026 A
(NR_RAMS)294 1362 A
2160(4)S
2370(/*)S
(number)252 2496 A
2790(of)S
(RAM-type)336 2916 A
(devices)294 3294 A
3630(*/)S
1350 V
(09720)210 648 A
1440 V
(09721)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(device)252 1656 A
(m_geom[NR_RAMS];)672 1950 A
2706(/*)S
(Base)168 2832 A
(and)126 3042 A
(size)168 3210 A
3420(of)S
(each)168 3546 A
(RAM)126 3756 A
(disk)168 3924 A
4134(*/)S
1530 V
(09722)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(m_device;)378 1530 A
2370(/*)S
(current)294 2496 A
(device)252 2832 A
3126(*/)S
1620 V
(09723)210 648 A
1710 V
(09724)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(struct)252 1866 A
(device)252 2160 A
(*m_prepare,)462 2454 A
(\(int)168 2958 A
(device\))294 3168 A
3504(\);)S
1800 V
(09725)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(m_schedule,)462 2034 A
(\(int)168 2538 A
(proc_nr,)336 2748 A
(struct)252 3126 A
(iorequest_s)462 3420 A
(*iop\))210 3924 A
4176(\);)S
1890 V
(09726)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(m_do_open,)420 2034 A
(\(struct)294 2496 A
(driver)252 2832 A
(*dp,)168 3126 A
(message)294 3336 A
(*m_ptr\))294 3672 A
4008(\);)S
1980 V
(09727)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(m_init,)294 2076 A
(\(void\))252 2412 A
2706(\);)S
2070 V
(09728)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(m_ioctl,)336 2034 A
(\(struct)294 2412 A
(driver)252 2748 A
(*dp,)168 3042 A
(message)294 3252 A
(*m_ptr\))294 3588 A
3924(\);)S
2160 V
(09729)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(m_geometry,)462 2076 A
(\(struct)294 2580 A
(partition)378 2916 A
(*entry\))294 3336 A
3672(\);)S
2250 V
(09730)210 648 A
2340 V
(09731)210 648 A
2430 V
(09732)210 648 A
1026(/*)S
(Entry)210 1152 A
(points)252 1404 A
1698(to)S
(this)168 1824 A
(driver.)294 2034 A
2370(*/)S
2520 V
(09733)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(driver)252 1656 A
(m_dtab)252 1950 A
2244(=)S
2328({)S
2610 V
(09734)210 648 A
(no_name,)336 1110 A
1698(/*)S
(current)294 1824 A
(device's)336 2160 A
(name)168 2538 A
2748(*/)S
2700 V
(09735)210 648 A
(m_do_open,)420 1110 A
1698(/*)S
(open)168 1824 A
2034(or)S
(mount)210 2160 A
2412(*/)S
2790 V
(09736)210 648 A
(do_nop,)294 1110 A
1698(/*)S
(nothing)294 1824 A
2160(on)S
2286(a)S
(close)210 2370 A
2622(*/)S
2880 V
(09737)210 648 A
(m_ioctl,)336 1110 A
1698(/*)S
(specify)294 1824 A
(ram)126 2160 A
(disk)168 2328 A
(geometry)336 2538 A
2916(*/)S
2970 V
(09738)210 648 A
(m_prepare,)420 1110 A
1698(/*)S
(prepare)294 1824 A
(for)126 2160 A
(I/O)126 2328 A
2496(on)S
2622(a)S
(given)210 2706 A
(minor)210 2958 A
(device)252 3210 A
3504(*/)S
3060 V
(09739)210 648 A
(m_schedule,)462 1110 A
1698(/*)S
1824(do)S
(the)126 1950 A
(I/O)126 2118 A
2286(*/)S
3150 V
(09740)210 648 A
(nop_finish,)462 1110 A
1698(/*)S
(schedule)336 1824 A
(does)168 2202 A
(the)126 2412 A
(work,)210 2580 A
2832(no)S
(need)168 2958 A
3168(to)S
3294(be)S
(smart)210 3420 A
3672(*/)S
3240 V
(09741)210 648 A
(nop_cleanup,)504 1110 A
1698(/*)S
(nothing's)378 1824 A
(dirty)210 2244 A
2496(*/)S
3330 V
(09742)210 648 A
(m_geometry,)462 1110 A
1698(/*)S
(memory)252 1824 A
(device)252 2118 A
("geometry")420 2412 A
2874(*/)S
3420 V
(09743)210 648 A
1026(};)S
3510 V
(09744)210 648 A
3600 V
(09745)210 648 A
3690 V
(09746)210 648 A
(/*===========================================================================*)3276 1026 A
3780 V
(09747)210 648 A
1068(*)S
(mem_task)336 2370 A
4260(*)S
3870 V
(09748)210 648 A
(*===========================================================================*/)3276 1068 A
3960 V
(09749)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(mem_task\(\))420 1530 A
4050 V
(09750)210 648 A
1026({)S
4140 V
(09751)210 648 A
(m_init\(\);)378 1110 A
4230 V
(09752)210 648 A
(driver_task\(&m_dtab\);)882 1110 A
4320 V
(09753)210 648 A
1026(})S
4590 V
(09756)210 648 A
(/*===========================================================================*)3276 1026 A
4680 V
(09757)210 648 A
1068(*)S
(m_prepare)378 2370 A
4260(*)S
4770 V
(09758)210 648 A
(*===========================================================================*/)3276 1068 A
4860 V
(09759)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(device)252 1656 A
(*m_prepare\(device\))756 1950 A
4950 V
(09760)210 648 A
(int)126 1026 A
(device;)294 1194 A
5040 V
(09761)210 648 A
1026({)S
5130 V
(09762)210 648 A
1026(/*)S
(Prepare)294 1152 A
(for)126 1488 A
(I/O)126 1656 A
1824(on)S
1950(a)S
(device.)294 2034 A
2370(*/)S
5220 V
(09763)210 648 A
5310 V
(09764)210 648 A
1110(if)S
(\(device)294 1236 A
1572(<)S
1656(0)S
1740(||)S
(device)252 1866 A
2160(>=)S
(NR_RAMS\))336 2286 A
(return\(NIL_DEV\);)672 2664 A
5400 V
(09765)210 648 A
(m_device)336 1110 A
1488(=)S
(device;)294 1572 A
5490 V
(09766)210 648 A
5580 V
(09767)210 648 A
(return\(&m_geom[device]\);)1008 1110 A
5670 V
(09768)210 648 A
1026(})S
5940 V
(09771)210 648 A
(/*===========================================================================*)3276 1026 A
6030 V
(09772)210 648 A
1068(*)S
(m_schedule)420 2370 A
4260(*)S
6120 V
(09773)210 648 A
(*===========================================================================*/)3276 1068 A
6210 V
(09774)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(m_schedule\(proc_nr,)798 1530 A
(iop\))168 2370 A
8418 V
EP
%%Page: 125 125
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1963(File:)S
2196(src/kernel/memory.c)S
12 B
(125)180 4248 A
900 V
7 LST
(09775)210 648 A
(int)126 1026 A
(proc_nr;)336 1194 A
2370(/*)S
(process)294 2496 A
(doing)210 2832 A
(the)126 3084 A
(request)294 3252 A
3588(*/)S
990 V
(09776)210 648 A
(struct)252 1026 A
(iorequest_s)462 1320 A
(*iop;)210 1824 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(read)168 2958 A
3168(or)S
(write)210 3294 A
(request)294 3546 A
3882(*/)S
1080 V
(09777)210 648 A
1026({)S
1170 V
(09778)210 648 A
1026(/*)S
(Read)168 1152 A
1362(or)S
(write)210 1488 A
(/dev/null,)420 1740 A
(/dev/mem,)378 2202 A
(/dev/kmem,)420 2622 A
3084(or)S
(/dev/ram.)378 3210 A
3630(*/)S
1260 V
(09779)210 648 A
1350 V
(09780)210 648 A
(int)126 1110 A
(device,)294 1278 A
(count,)252 1614 A
(opcode;)294 1908 A
1440 V
(09781)210 648 A
(phys_bytes)420 1110 A
(mem_phys,)378 1572 A
(user_phys;)420 1992 A
1530 V
(09782)210 648 A
(struct)252 1110 A
(device)252 1404 A
(*dv;)168 1698 A
1620 V
(09783)210 648 A
1710 V
(09784)210 648 A
1110(/*)S
(Type)168 1236 A
1446(of)S
(request)294 1572 A
1908(*/)S
1800 V
(09785)210 648 A
(opcode)252 1110 A
1404(=)S
(iop->io_request)630 1488 A
2160(&)S
(\304OPTIONAL_IO;)546 2244 A
1890 V
(09786)210 648 A
1980 V
(09787)210 648 A
1110(/*)S
(Get)126 1236 A
(minor)210 1404 A
(device)252 1656 A
(number)252 1950 A
(and)126 2244 A
(check)210 2412 A
(for)126 2664 A
(/dev/null.)420 2832 A
3294(*/)S
2070 V
(09788)210 648 A
(device)252 1110 A
1404(=)S
(m_device;)378 1488 A
2160 V
(09789)210 648 A
1110(dv)S
1236(=)S
(&m_geom[device];)672 1320 A
2250 V
(09790)210 648 A
2340 V
(09791)210 648 A
1110(/*)S
(Determine)378 1236 A
(address)294 1656 A
(where)210 1992 A
(data)168 2244 A
2454(is)S
2580(to)S
2706(go)S
2832(or)S
2958(to)S
(come)168 3084 A
(from.)210 3294 A
3546(*/)S
2430 V
(09792)210 648 A
(user_phys)378 1110 A
1530(=)S
(numap\(proc_nr,)588 1614 A
(\(vir_bytes\))462 2244 A
(iop->io_buf,)504 2748 A
2520 V
(09793)210 648 A
(\(vir_bytes\))462 3042 A
(iop->io_nbytes\);)672 3546 A
2610 V
(09794)210 648 A
1110(if)S
(\(user_phys)420 1236 A
1698(==)S
1824(0\))S
(return\(iop->io_nbytes)882 1950 A
2874(=)S
(EINVAL\);)336 2958 A
2700 V
(09795)210 648 A
2790 V
(09796)210 648 A
1110(if)S
(\(device)294 1236 A
1572(==)S
(NULL_DEV\))378 1698 A
2118({)S
2880 V
(09797)210 648 A
1362(/*)S
(/dev/null:)420 1488 A
(Black)210 1950 A
(hole.)210 2202 A
2454(*/)S
2970 V
(09798)210 648 A
1362(if)S
(\(opcode)294 1488 A
1824(==)S
(DEV_WRITE\))420 1950 A
(iop->io_nbytes)588 2412 A
3042(=)S
3126(0;)S
3060 V
(09799)210 648 A
(count)210 1362 A
1614(=)S
1698(0;)S
3150 V
(09800)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3240 V
(09801)210 648 A
1362(/*)S
(/dev/mem,)378 1488 A
(/dev/kmem,)420 1908 A
2370(or)S
(/dev/ram:)378 2496 A
(Check)210 2916 A
(for)126 3168 A
(EOF)126 3336 A
3504(*/)S
3330 V
(09802)210 648 A
1362(if)S
(\(iop->io_position)714 1488 A
2244(>=)S
(dv->dv_size\))504 2370 A
(return\(OK\);)462 2916 A
3420 V
(09803)210 648 A
(count)210 1362 A
1614(=)S
(iop->io_nbytes;)630 1698 A
3510 V
(09804)210 648 A
1362(if)S
(\(iop->io_position)714 1488 A
2244(+)S
(count)210 2328 A
2580(>)S
(dv->dv_size\))504 2664 A
3600 V
(09805)210 648 A
(count)210 1698 A
1950(=)S
(dv->dv_size)462 2034 A
2538(-)S
(iop->io_position;)714 2622 A
3690 V
(09806)210 648 A
1110(})S
3780 V
(09807)210 648 A
3870 V
(09808)210 648 A
1110(/*)S
(Set)126 1236 A
1404(up)S
('mem_phys')420 1530 A
(for)126 1992 A
(/dev/mem,)378 2160 A
(/dev/kmem,)420 2580 A
3042(or)S
(/dev/ram)336 3168 A
3546(*/)S
3960 V
(09809)210 648 A
(mem_phys)336 1110 A
1488(=)S
(dv->dv_base)462 1572 A
2076(+)S
(iop->io_position;)714 2160 A
4050 V
(09810)210 648 A
4140 V
(09811)210 648 A
1110(/*)S
(Book)168 1236 A
(the)126 1446 A
(number)252 1614 A
1908(of)S
(bytes)210 2034 A
2286(to)S
2412(be)S
(transferred)462 2538 A
3042(in)S
(advance.)336 3168 A
3546(*/)S
4230 V
(09812)210 648 A
(iop->io_nbytes)588 1110 A
1740(-=)S
(count;)252 1866 A
4320 V
(09813)210 648 A
4410 V
(09814)210 648 A
1110(if)S
(\(count)252 1236 A
1530(==)S
1656(0\))S
(return\(OK\);)462 1782 A
4500 V
(09815)210 648 A
4590 V
(09816)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(data.)210 1614 A
1866(*/)S
4680 V
(09817)210 648 A
1110(if)S
(\(opcode)294 1236 A
1572(==)S
(DEV_READ\))378 1698 A
4770 V
(09818)210 648 A
(phys_copy\(mem_phys,)798 1362 A
(user_phys,)420 2202 A
(\(phys_bytes\))504 2664 A
(count\);)294 3210 A
4860 V
(09819)210 648 A
(else)168 1110 A
4950 V
(09820)210 648 A
(phys_copy\(user_phys,)840 1362 A
(mem_phys,)378 2244 A
(\(phys_bytes\))504 2664 A
(count\);)294 3210 A
5040 V
(09821)210 648 A
5130 V
(09822)210 648 A
(return\(OK\);)462 1110 A
5220 V
(09823)210 648 A
1026(})S
5490 V
(09826)210 648 A
(/*============================================================================*)3318 1026 A
5580 V
(09827)210 648 A
1068(*)S
(m_do_open)378 2370 A
4302(*)S
5670 V
(09828)210 648 A
(*============================================================================*/)3318 1068 A
5760 V
(09829)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(m_do_open\(dp,)546 1530 A
(m_ptr\))252 2118 A
5850 V
(09830)210 648 A
(struct)252 1026 A
(driver)252 1320 A
(*dp;)168 1614 A
5940 V
(09831)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
6030 V
(09832)210 648 A
1026({)S
6120 V
(09833)210 648 A
1026(/*)S
(Check)210 1152 A
(device)252 1404 A
(number)252 1698 A
1992(on)S
(open.)210 2118 A
(Give)168 2412 A
(I/O)126 2622 A
(privileges)420 2790 A
3252(to)S
3378(a)S
(process)294 3462 A
(opening)294 3798 A
6210 V
(09834)210 648 A
1068(*)S
(/dev/mem)336 1152 A
1530(or)S
(/dev/kmem.)420 1656 A
8418 V
EP
%%Page: 126 126
BP
/slant 0 def
/height 0 def
630 V
12 B
(126)180 648 A
11 R
1963(File:)S
2196(src/kernel/memory.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(09835)210 648 A
1068(*/)S
990 V
(09836)210 648 A
1080 V
(09837)210 648 A
1110(if)S
(\(m_prepare\(m_ptr->DEVICE\))1050 1236 A
2328(==)S
(NIL_DEV\))336 2454 A
(return\(ENXIO\);)588 2832 A
1170 V
(09838)210 648 A
1260 V
(09839)210 648 A
1110(if)S
(\(m_device)378 1236 A
1656(==)S
(MEM_DEV)294 1782 A
2118(||)S
(m_device)336 2244 A
2622(==)S
(KMEM_DEV\))378 2748 A
1350 V
(09840)210 648 A
(enable_iop\(proc_addr\(m_ptr->PROC_NR\)\);)1596 1362 A
1440 V
(09841)210 648 A
1530 V
(09842)210 648 A
(return\(OK\);)462 1110 A
1620 V
(09843)210 648 A
1026(})S
1890 V
(09846)210 648 A
(/*===========================================================================*)3276 1026 A
1980 V
(09847)210 648 A
1068(*)S
(m_init)252 2370 A
4260(*)S
2070 V
(09848)210 648 A
(*===========================================================================*/)3276 1068 A
2160 V
(09849)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(m_init\(\))336 1572 A
2250 V
(09850)210 648 A
1026({)S
2340 V
(09851)210 648 A
1110(/*)S
(Initialize)420 1236 A
(this)168 1698 A
(task.)210 1908 A
2160(*/)S
2430 V
(09852)210 648 A
(extern)252 1110 A
(int)126 1404 A
(_end;)210 1572 A
2520 V
(09853)210 648 A
2610 V
(09854)210 648 A
(m_geom[KMEM_DEV].dv_base)1008 1110 A
2160(=)S
(vir2phys\(0\);)504 2244 A
2700 V
(09855)210 648 A
(m_geom[KMEM_DEV].dv_size)1008 1110 A
2160(=)S
(vir2phys\(&_end\);)672 2244 A
2790 V
(09856)210 648 A
2880 V
(09857)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
2970 V
(09858)210 648 A
1110(if)S
(\(!protected_mode\))714 1236 A
1992({)S
3060 V
(09859)210 648 A
(m_geom[MEM_DEV].dv_size)966 1362 A
2370(=)S
(0x100000;)378 2538 A
3042(/*)S
3168(1M)S
(for)126 3294 A
(8086)168 3462 A
(systems)294 3672 A
4008(*/)S
3150 V
(09860)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3240 V
(09861)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(2)S
3330 V
(09862)210 648 A
(m_geom[MEM_DEV].dv_size)966 1362 A
2370(=)S
(0x1000000;)420 2496 A
3042(/*)S
(16M)126 3168 A
(for)126 3336 A
(286)126 3504 A
(systems)294 3672 A
4008(*/)S
3420 V
(09863)210 648 A
(#else)210 1026 A
3510 V
(09864)210 648 A
(m_geom[MEM_DEV].dv_size)966 1362 A
2370(=)S
(0xFFFFFFFF;)462 2454 A
3042(/*)S
(4G-1)168 3168 A
(for)126 3378 A
(386)126 3546 A
(systems)294 3714 A
4050(*/)S
3600 V
(09865)210 648 A
(#endif)252 1026 A
3690 V
(09866)210 648 A
1110(})S
3780 V
(09867)210 648 A
(#endif)252 1026 A
3870 V
(09868)210 648 A
1026(})S
4140 V
(09871)210 648 A
(/*===========================================================================*)3276 1026 A
4230 V
(09872)210 648 A
1068(*)S
(m_ioctl)294 2370 A
4260(*)S
4320 V
(09873)210 648 A
(*===========================================================================*/)3276 1068 A
4410 V
(09874)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(m_ioctl\(dp,)462 1530 A
(m_ptr\))252 2034 A
4500 V
(09875)210 648 A
(struct)252 1026 A
(driver)252 1320 A
(*dp;)168 1614 A
4590 V
(09876)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(read)168 2958 A
3168(or)S
(write)210 3294 A
(message)294 3546 A
3882(*/)S
4680 V
(09877)210 648 A
1026({)S
4770 V
(09878)210 648 A
1026(/*)S
(Set)126 1152 A
(parameters)420 1320 A
(for)126 1782 A
(one)126 1950 A
2118(of)S
(the)126 2244 A
(RAM)126 2412 A
(disks.)252 2580 A
2874(*/)S
4860 V
(09879)210 648 A
4950 V
(09880)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(bytesize;)378 1698 A
5040 V
(09881)210 648 A
(unsigned)336 1110 A
(base,)210 1488 A
(size;)210 1740 A
5130 V
(09882)210 648 A
(struct)252 1110 A
(memory)252 1404 A
(*memp;)252 1698 A
5220 V
(09883)210 648 A
(static)252 1110 A
(struct)252 1404 A
(psinfo)252 1698 A
(psinfo)252 1992 A
2286(=)S
2370({)S
(NR_TASKS,)378 2454 A
(NR_PROCS,)378 2874 A
(\(vir_bytes\))462 3294 A
(proc,)210 3798 A
4050(0,)S
4176(0)S
4260(};)S
5310 V
(09884)210 648 A
(phys_bytes)420 1110 A
(psinfo_phys;)504 1572 A
5400 V
(09885)210 648 A
5490 V
(09886)210 648 A
(switch)252 1110 A
(\(m_ptr->REQUEST\))672 1404 A
2118({)S
5580 V
(09887)210 648 A
(case)168 1110 A
(MIOCRAMSIZE:)504 1320 A
5670 V
(09888)210 648 A
1362(/*)S
1488(FS)S
(sets)168 1614 A
(the)126 1824 A
(RAM)126 1992 A
(disk)168 2160 A
(size.)210 2370 A
2622(*/)S
5760 V
(09889)210 648 A
1362(if)S
(\(m_ptr->PROC_NR)630 1488 A
2160(!=)S
(FS_PROC_NR\))462 2286 A
(return\(EPERM\);)588 2790 A
5850 V
(09890)210 648 A
5940 V
(09891)210 648 A
(bytesize)336 1362 A
1740(=)S
(m_ptr->POSITION)630 1824 A
2496(*)S
(BLOCK_SIZE;)462 2580 A
6030 V
(09892)210 648 A
(size)168 1362 A
1572(=)S
(\(bytesize)378 1656 A
2076(+)S
(CLICK_SHIFT-1\))588 2160 A
2790(>>)S
(CLICK_SHIFT;)504 2916 A
6120 V
(09893)210 648 A
6210 V
(09894)210 648 A
1362(/*)S
(Find)168 1488 A
1698(a)S
(memory)252 1782 A
(chunk)210 2076 A
(big)126 2328 A
(enough)252 2496 A
(for)126 2790 A
(the)126 2958 A
(RAM)126 3126 A
(disk.)210 3294 A
3546(*/)S
8418 V
EP
%%Page: 127 127
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1963(File:)S
2196(src/kernel/memory.c)S
12 B
(127)180 4248 A
900 V
7 LST
(09895)210 648 A
(memp=)210 1362 A
(&mem[NR_MEMS];)588 1614 A
990 V
(09896)210 648 A
(while)210 1362 A
(\(\(--memp\)->size)630 1614 A
2286(<)S
(size\))210 2370 A
2622({)S
1080 V
(09897)210 648 A
1698(if)S
(\(memp)210 1824 A
2076(==)S
(mem\))168 2202 A
(panic\("RAM)420 2412 A
(disk)168 2874 A
3084(is)S
(too)126 3210 A
(big",)210 3378 A
(NO_NUM\);)336 3630 A
1170 V
(09898)210 648 A
1362(})S
1260 V
(09899)210 648 A
(base)168 1362 A
1572(=)S
(memp->base;)462 1656 A
1350 V
(09900)210 648 A
(memp->base)420 1362 A
1824(+=)S
(size;)210 1950 A
1440 V
(09901)210 648 A
(memp->size)420 1362 A
1824(-=)S
(size;)210 1950 A
1530 V
(09902)210 648 A
1620 V
(09903)210 648 A
(m_geom[RAM_DEV].dv_base)966 1362 A
2370(=)S
(\(unsigned)378 2454 A
(long\))210 2874 A
(base)168 3126 A
3336(<<)S
(CLICK_SHIFT;)504 3462 A
1710 V
(09904)210 648 A
(m_geom[RAM_DEV].dv_size)966 1362 A
2370(=)S
(bytesize;)378 2454 A
1800 V
(09905)210 648 A
(break;)252 1362 A
1890 V
(09906)210 648 A
(case)168 1110 A
(MIOCSPSINFO:)504 1320 A
1980 V
(09907)210 648 A
1362(/*)S
1488(MM)S
1614(or)S
1740(FS)S
(set)126 1866 A
(the)126 2034 A
(address)294 2202 A
2538(of)S
(their)210 2664 A
(process)294 2916 A
(table.)252 3252 A
3546(*/)S
2070 V
(09908)210 648 A
1362(if)S
(\(m_ptr->PROC_NR)630 1488 A
2160(==)S
(MM_PROC_NR\))462 2286 A
2790({)S
2160 V
(09909)210 648 A
(psinfo.mproc)504 1698 A
2244(=)S
(\(vir_bytes\))462 2328 A
(m_ptr->ADDRESS;)630 2832 A
2250 V
(09910)210 648 A
1362(})S
(else)168 1446 A
2340 V
(09911)210 648 A
1362(if)S
(\(m_ptr->PROC_NR)630 1488 A
2160(==)S
(FS_PROC_NR\))462 2286 A
2790({)S
2430 V
(09912)210 648 A
(psinfo.fproc)504 1698 A
2244(=)S
(\(vir_bytes\))462 2328 A
(m_ptr->ADDRESS;)630 2832 A
2520 V
(09913)210 648 A
1362(})S
(else)168 1446 A
1656({)S
2610 V
(09914)210 648 A
(return\(EPERM\);)588 1698 A
2700 V
(09915)210 648 A
1362(})S
2790 V
(09916)210 648 A
(break;)252 1362 A
2880 V
(09917)210 648 A
(case)168 1110 A
(MIOCGPSINFO:)504 1320 A
2970 V
(09918)210 648 A
1362(/*)S
(The)126 1488 A
1656(ps)S
(program)294 1782 A
(wants)210 2118 A
(the)126 2370 A
(process)294 2538 A
(table)210 2874 A
(addresses.)420 3126 A
3588(*/)S
3060 V
(09919)210 648 A
(psinfo_phys)462 1362 A
1866(=)S
(numap\(m_ptr->PROC_NR,)882 1950 A
(\(vir_bytes\))462 2874 A
(m_ptr->ADDRESS,)630 3378 A
3150 V
(09920)210 648 A
(sizeof\(psinfo\)\);)672 3378 A
3240 V
(09921)210 648 A
1362(if)S
(\(psinfo_phys)504 1488 A
2034(==)S
2160(0\))S
(return\(EFAULT\);)630 2286 A
3330 V
(09922)210 648 A
(phys_copy\(vir2phys\(&psinfo\),)1176 1362 A
(psinfo_phys,)504 2580 A
(\(phys_bytes\))504 3126 A
(sizeof\(psinfo\)\);)672 3672 A
3420 V
(09923)210 648 A
(break;)252 1362 A
3510 V
(09924)210 648 A
(default:)336 1110 A
3600 V
(09925)210 648 A
(return\(do_diocntl\(&m_dtab,)1092 1362 A
(m_ptr\)\);)336 2496 A
3690 V
(09926)210 648 A
1110(})S
3780 V
(09927)210 648 A
(return\(OK\);)462 1110 A
3870 V
(09928)210 648 A
1026(})S
4140 V
(09931)210 648 A
(/*============================================================================*)3318 1026 A
4230 V
(09932)210 648 A
1068(*)S
(m_geometry)420 2370 A
4302(*)S
4320 V
(09933)210 648 A
(*============================================================================*/)3318 1068 A
4410 V
(09934)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(m_geometry\(entry\))714 1572 A
4500 V
(09935)210 648 A
(struct)252 1026 A
(partition)378 1320 A
(*entry;)294 1740 A
4590 V
(09936)210 648 A
1026({)S
4680 V
(09937)210 648 A
1110(/*)S
(Memory)252 1236 A
(devices)294 1530 A
(don't)210 1866 A
(have)168 2118 A
2328(a)S
(geometry,)378 2412 A
(but)126 2832 A
(the)126 3000 A
(outside)294 3168 A
(world)210 3504 A
(insists.)336 3756 A
4134(*/)S
4770 V
(09938)210 648 A
(entry->cylinders)672 1110 A
1824(=)S
(\(m_geom[m_device].dv_size)1050 1908 A
3000(>>)S
(SECTOR_SHIFT\))546 3126 A
3714(/)S
(\(64)126 3798 A
3966(*)S
(32\);)168 4050 A
4860 V
(09939)210 648 A
(entry->heads)504 1110 A
1656(=)S
(64;)126 1740 A
4950 V
(09940)210 648 A
(entry->sectors)588 1110 A
1740(=)S
(32;)126 1824 A
5040 V
(09941)210 648 A
1026(})S
8418 V
EP
%%Page: 128 128
BP
/slant 0 def
/height 0 def
630 V
12 B
(128)180 648 A
11 R
2049(File:)S
2282(src/kernel/wini.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/kernel/wini.c)714 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(10000)210 648 A
1026(/*)S
(wini.c)252 1362 A
1656(-)S
(choose)252 1740 A
2034(a)S
(winchester)420 2118 A
(driver.)294 2580 A
(Author:)294 3378 A
(Kees)168 3714 A
3924(J.)S
(Bot)126 4050 A
1440 V
(10001)210 648 A
1068(*)S
3714(28)S
(May)126 3840 A
(1994)168 4008 A
1530 V
(10002)210 648 A
1068(*)S
(Several)294 1152 A
(different)378 1488 A
(winchester)420 1908 A
(drivers)294 2370 A
(may)126 2706 A
2874(be)S
(compiled)336 3000 A
1620 V
(10003)210 648 A
1068(*)S
(into)168 1152 A
(the)126 1362 A
(kernel,)294 1530 A
(but)126 1866 A
(only)168 2034 A
(one)126 2244 A
(may)126 2412 A
(run.)168 2580 A
(That)168 2832 A
(one)126 3042 A
3210(is)S
(chosen)252 3336 A
(here)168 3630 A
(using)210 3840 A
1710 V
(10004)210 648 A
1068(*)S
(the)126 1152 A
(boot)168 1320 A
(variable)336 1530 A
('hd'.)210 1908 A
1800 V
(10005)210 648 A
1068(*/)S
1890 V
(10006)210 648 A
1980 V
(10007)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
2070 V
(10008)210 648 A
(#include)336 1026 A
("driver.h")420 1404 A
2160 V
(10009)210 648 A
2250 V
(10010)210 648 A
(#if)126 1026 A
(ENABLE_WINI)462 1194 A
2340 V
(10011)210 648 A
2430 V
(10012)210 648 A
1026(/*)S
(Map)126 1152 A
(driver)252 1320 A
(name)168 1614 A
1824(to)S
(task)168 1950 A
(function.)378 2160 A
2580(*/)S
2520 V
(10013)210 648 A
(struct)252 1026 A
(hdmap)210 1320 A
1572({)S
2610 V
(10014)210 648 A
(char)168 1110 A
(*name;)252 1698 A
2700 V
(10015)210 648 A
(task_t)252 1110 A
(*task;)252 1698 A
2790 V
(10016)210 648 A
1026(})S
(hdmap[])294 1110 A
1446(=)S
1530({)S
2880 V
(10017)210 648 A
2970 V
(10018)210 648 A
(#if)126 1026 A
(ENABLE_AT_WINI)588 1194 A
3060 V
(10019)210 648 A
1110({)S
("at",)210 1194 A
(at_winchester_task)756 1698 A
2706(},)S
3150 V
(10020)210 648 A
(#endif)252 1026 A
3240 V
(10021)210 648 A
3330 V
(10022)210 648 A
(#if)126 1026 A
(ENABLE_BIOS_WINI)672 1194 A
3420 V
(10023)210 648 A
1110({)S
("bios",)294 1194 A
(bios_winchester_task)840 1698 A
2706(},)S
3510 V
(10024)210 648 A
(#endif)252 1026 A
3600 V
(10025)210 648 A
3690 V
(10026)210 648 A
(#if)126 1026 A
(ENABLE_ESDI_WINI)672 1194 A
3780 V
(10027)210 648 A
1110({)S
("esdi",)294 1194 A
(esdi_winchester_task)840 1698 A
2706(},)S
3870 V
(10028)210 648 A
(#endif)252 1026 A
3960 V
(10029)210 648 A
4050 V
(10030)210 648 A
(#if)126 1026 A
(ENABLE_XT_WINI)588 1194 A
4140 V
(10031)210 648 A
1110({)S
("xt",)210 1194 A
(xt_winchester_task)756 1698 A
2706(},)S
4230 V
(10032)210 648 A
(#endif)252 1026 A
4320 V
(10033)210 648 A
4410 V
(10034)210 648 A
1026(};)S
4500 V
(10035)210 648 A
4590 V
(10036)210 648 A
4680 V
(10037)210 648 A
(/*===========================================================================*)3276 1026 A
4770 V
(10038)210 648 A
1068(*)S
(winchester_task)630 2370 A
4260(*)S
4860 V
(10039)210 648 A
(*===========================================================================*/)3276 1068 A
4950 V
(10040)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(winchester_task\(\))714 1530 A
5040 V
(10041)210 648 A
1026({)S
5130 V
(10042)210 648 A
1110(/*)S
(Call)168 1236 A
(the)126 1446 A
(default)294 1614 A
1950(or)S
(selected)336 2076 A
(winchester)420 2454 A
(task.)210 2916 A
3168(*/)S
5220 V
(10043)210 648 A
(char)168 1110 A
(*hd;)168 1320 A
5310 V
(10044)210 648 A
(struct)252 1110 A
(hdmap)210 1404 A
(*map;)210 1656 A
5400 V
(10045)210 648 A
5490 V
(10046)210 648 A
1110(hd)S
1236(=)S
(k_getenv\("hd"\);)630 1320 A
5580 V
(10047)210 648 A
5670 V
(10048)210 648 A
(for)126 1110 A
(\(map)168 1278 A
1488(=)S
(hdmap;)252 1572 A
(map)126 1866 A
2034(<)S
(hdmap)210 2118 A
2370(+)S
(sizeof\(hdmap\)/sizeof\(hdmap[0]\);)1302 2454 A
(map++\))252 3798 A
4092({)S
5760 V
(10049)210 648 A
1362(if)S
(\(hd)126 1488 A
1656(==)S
(NULL)168 1782 A
1992(||)S
(strcmp\(hd,)420 2118 A
(map->name\))420 2580 A
3042(==)S
3168(0\))S
3294({)S
5850 V
(10050)210 648 A
1698(/*)S
(Run)126 1824 A
(the)126 1992 A
(selected)336 2160 A
(winchester)420 2538 A
(task.)210 3000 A
3252(*/)S
5940 V
(10051)210 648 A
(\(*map->task\)\(\);)630 1698 A
6030 V
(10052)210 648 A
1362(})S
6120 V
(10053)210 648 A
1110(})S
6210 V
(10054)210 648 A
(panic\("no)378 1110 A
1530(hd)S
(driver",)336 1656 A
(NO_NUM\);)336 2034 A
8418 V
EP
%%Page: 129 129
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2049(File:)S
2282(src/kernel/wini.c)S
12 B
(129)180 4248 A
900 V
7 LST
(10055)210 648 A
1026(})S
990 V
(10056)210 648 A
(#endif)252 1026 A
1320(/*)S
(ENABLE_WINI)462 1446 A
1950(*/)S
1440 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1530 V
(src/kernel/at_wini.c)840 2034 A
1620 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1800 V
(10100)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(device)252 2118 A
(dependent)378 2412 A
(part)168 2832 A
3042(of)S
3168(a)S
(driver)252 3252 A
(for)126 3546 A
(the)126 3714 A
(IBM-AT)252 3882 A
1890 V
(10101)210 648 A
1068(*)S
(winchester)420 1152 A
(controller.)462 1614 A
1980 V
(10102)210 648 A
1068(*)S
1152(It)S
(was)126 1278 A
(written)294 1446 A
1782(by)S
(Adri)168 1908 A
(Koppes.)294 2118 A
2070 V
(10103)210 648 A
1068(*)S
2160 V
(10104)210 648 A
1068(*)S
(The)126 1152 A
(file)168 1320 A
(contains)336 1530 A
(one)126 1908 A
(entry)210 2076 A
(point:)252 2328 A
2250 V
(10105)210 648 A
1068(*)S
2340 V
(10106)210 648 A
1068(*)S
(at_winchester_task:)798 1236 A
(main)168 2370 A
(entry)210 2580 A
(when)168 2832 A
(system)252 3042 A
3336(is)S
(brought)294 3462 A
3798(up)S
2430 V
(10107)210 648 A
1068(*)S
2520 V
(10108)210 648 A
1068(*)S
2610 V
(10109)210 648 A
1068(*)S
(Changes:)336 1152 A
2700 V
(10110)210 648 A
1068(*)S
1362(13)S
(Apr)126 1488 A
(1992)168 1656 A
1866(by)S
(Kees)168 1992 A
2202(J.)S
(Bot:)168 2328 A
(device)252 2538 A
(dependent/independent)882 2832 A
(split.)252 3756 A
2790 V
(10111)210 648 A
1068(*/)S
2880 V
(10112)210 648 A
2970 V
(10113)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
3060 V
(10114)210 648 A
(#include)336 1026 A
("driver.h")420 1404 A
3150 V
(10115)210 648 A
(#include)336 1026 A
("drvlib.h")420 1404 A
3240 V
(10116)210 648 A
3330 V
(10117)210 648 A
(#if)126 1026 A
(ENABLE_AT_WINI)588 1194 A
3420 V
(10118)210 648 A
3510 V
(10119)210 648 A
1026(/*)S
(I/O)126 1152 A
(Ports)210 1320 A
(used)168 1572 A
1782(by)S
(winchester)420 1908 A
(disk)168 2370 A
(controllers.)504 2580 A
3126(*/)S
3600 V
(10120)210 648 A
3690 V
(10121)210 648 A
1026(/*)S
(Read)168 1152 A
(and)126 1362 A
(write)210 1530 A
(registers)378 1782 A
2202(*/)S
3780 V
(10122)210 648 A
(#define)294 1026 A
(REG_BASE0)378 1362 A
(0x1F0)210 2034 A
2370(/*)S
(base)168 2496 A
(register)336 2706 A
3084(of)S
(controller)420 3210 A
3672(0)S
3756(*/)S
3870 V
(10123)210 648 A
(#define)294 1026 A
(REG_BASE1)378 1362 A
(0x170)210 2034 A
2370(/*)S
(base)168 2496 A
(register)336 2706 A
3084(of)S
(controller)420 3210 A
3672(1)S
3756(*/)S
3960 V
(10124)210 648 A
(#define)294 1026 A
(REG_DATA)336 1362 A
2202(0)S
2370(/*)S
(data)168 2496 A
(register)336 2706 A
(\(offset)294 3084 A
(from)168 3420 A
(the)126 3630 A
(base)168 3798 A
(reg.\))210 4008 A
4260(*/)S
4050 V
(10125)210 648 A
(#define)294 1026 A
(REG_PRECOMP)462 1362 A
2202(1)S
2370(/*)S
(start)210 2496 A
2748(of)S
(write)210 2874 A
(precompensation)630 3126 A
3798(*/)S
4140 V
(10126)210 648 A
(#define)294 1026 A
(REG_COUNT)378 1362 A
2202(2)S
2370(/*)S
(sectors)294 2496 A
2832(to)S
(transfer)336 2958 A
3336(*/)S
4230 V
(10127)210 648 A
(#define)294 1026 A
(REG_SECTOR)420 1362 A
2202(3)S
2370(/*)S
(sector)252 2496 A
(number)252 2790 A
3084(*/)S
4320 V
(10128)210 648 A
(#define)294 1026 A
(REG_CYL_LO)420 1362 A
2202(4)S
2370(/*)S
(low)126 2496 A
(byte)168 2664 A
2874(of)S
(cylinder)336 3000 A
(number)252 3378 A
3672(*/)S
4410 V
(10129)210 648 A
(#define)294 1026 A
(REG_CYL_HI)420 1362 A
2202(5)S
2370(/*)S
(high)168 2496 A
(byte)168 2706 A
2916(of)S
(cylinder)336 3042 A
(number)252 3420 A
3714(*/)S
4500 V
(10130)210 648 A
(#define)294 1026 A
(REG_LDH)294 1362 A
2202(6)S
2370(/*)S
(lba,)168 2496 A
(drive)210 2706 A
(and)126 2958 A
(head)168 3126 A
3336(*/)S
4590 V
(10131)210 648 A
(#define)294 1026 A
(LDH_DEFAULT)462 1446 A
(0xA0)168 2370 A
2706(/*)S
(ECC)126 2832 A
(enable,)294 3000 A
(512)126 3336 A
(bytes)210 3504 A
(per)126 3756 A
(sector)252 3924 A
4218(*/)S
4680 V
(10132)210 648 A
(#define)294 1026 A
(LDH_LBA)294 1446 A
(0x40)168 2370 A
2706(/*)S
(Use)126 2832 A
(LBA)126 3000 A
(addressing)420 3168 A
3630(*/)S
4770 V
(10133)210 648 A
(#define)294 1026 A
(ldh_init\(drive\))630 1446 A
(\(LDH_DEFAULT)504 2370 A
2916(|)S
(\(\(drive\))336 3000 A
3378(<<)S
(4\)\))126 3504 A
4860 V
(10134)210 648 A
4950 V
(10135)210 648 A
1026(/*)S
(Read)168 1152 A
(only)168 1362 A
(registers)378 1572 A
1992(*/)S
5040 V
(10136)210 648 A
(#define)294 1026 A
(REG_STATUS)420 1362 A
2202(7)S
2370(/*)S
(status)252 2496 A
2790(*/)S
5130 V
(10137)210 648 A
(#define)294 1026 A
(STATUS_BSY)420 1446 A
(0x80)168 2370 A
2706(/*)S
(controller)420 2832 A
(busy)168 3294 A
3504(*/)S
5220 V
(10138)210 648 A
(#define)294 1026 A
(STATUS_RDY)420 1446 A
(0x40)168 2370 A
2706(/*)S
(drive)210 2832 A
(ready)210 3084 A
3336(*/)S
5310 V
(10139)210 648 A
(#define)294 1026 A
(STATUS_WF)378 1446 A
(0x20)168 2370 A
2706(/*)S
(write)210 2832 A
(fault)210 3084 A
3336(*/)S
5400 V
(10140)210 648 A
(#define)294 1026 A
(STATUS_SC)378 1446 A
(0x10)168 2370 A
2706(/*)S
(seek)168 2832 A
(complete)336 3042 A
(\(obsolete\))420 3420 A
3882(*/)S
5490 V
(10141)210 648 A
(#define)294 1026 A
(STATUS_DRQ)420 1446 A
(0x08)168 2370 A
2706(/*)S
(data)168 2832 A
(transfer)336 3042 A
(request)294 3420 A
3756(*/)S
5580 V
(10142)210 648 A
(#define)294 1026 A
(STATUS_CRD)420 1446 A
(0x04)168 2370 A
2706(/*)S
(corrected)378 2832 A
(data)168 3252 A
3462(*/)S
5670 V
(10143)210 648 A
(#define)294 1026 A
(STATUS_IDX)420 1446 A
(0x02)168 2370 A
2706(/*)S
(index)210 2832 A
(pulse)210 3084 A
3336(*/)S
5760 V
(10144)210 648 A
(#define)294 1026 A
(STATUS_ERR)420 1446 A
(0x01)168 2370 A
2706(/*)S
(error)210 2832 A
3084(*/)S
5850 V
(10145)210 648 A
(#define)294 1026 A
(REG_ERROR)378 1362 A
2202(1)S
2370(/*)S
(error)210 2496 A
(code)168 2748 A
2958(*/)S
5940 V
(10146)210 648 A
(#define)294 1026 A
(ERROR_BB)336 1446 A
(0x80)168 2370 A
2706(/*)S
(bad)126 2832 A
(block)210 3000 A
3252(*/)S
6030 V
(10147)210 648 A
(#define)294 1026 A
(ERROR_ECC)378 1446 A
(0x40)168 2370 A
2706(/*)S
(bad)126 2832 A
(ecc)126 3000 A
(bytes)210 3168 A
3420(*/)S
6120 V
(10148)210 648 A
(#define)294 1026 A
(ERROR_ID)336 1446 A
(0x10)168 2370 A
2706(/*)S
2832(id)S
(not)126 2958 A
(found)210 3126 A
3378(*/)S
6210 V
(10149)210 648 A
(#define)294 1026 A
(ERROR_AC)336 1446 A
(0x04)168 2370 A
2706(/*)S
(aborted)294 2832 A
(command)294 3168 A
3504(*/)S
8418 V
EP
%%Page: 130 130
BP
/slant 0 def
/height 0 def
630 V
12 B
(130)180 648 A
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(10150)210 648 A
(#define)294 1026 A
(ERROR_TK)336 1446 A
(0x02)168 2370 A
2706(/*)S
(track)210 2832 A
(zero)168 3084 A
(error)210 3294 A
3546(*/)S
990 V
(10151)210 648 A
(#define)294 1026 A
(ERROR_DM)336 1446 A
(0x01)168 2370 A
2706(/*)S
2832(no)S
(data)168 2958 A
(address)294 3168 A
(mark)168 3504 A
3714(*/)S
1080 V
(10152)210 648 A
1170 V
(10153)210 648 A
1026(/*)S
(Write)210 1152 A
(only)168 1404 A
(registers)378 1614 A
2034(*/)S
1260 V
(10154)210 648 A
(#define)294 1026 A
(REG_COMMAND)462 1362 A
2202(7)S
2370(/*)S
(command)294 2496 A
2832(*/)S
1350 V
(10155)210 648 A
(#define)294 1026 A
(CMD_IDLE)336 1446 A
(0x00)168 2370 A
2706(/*)S
(for)126 2832 A
(w_command:)420 3000 A
(drive)210 3462 A
(idle)168 3714 A
3924(*/)S
1440 V
(10156)210 648 A
(#define)294 1026 A
(CMD_RECALIBRATE)630 1446 A
(0x10)168 2370 A
2706(/*)S
(recalibrate)462 2832 A
(drive)210 3336 A
3588(*/)S
1530 V
(10157)210 648 A
(#define)294 1026 A
(CMD_READ)336 1446 A
(0x20)168 2370 A
2706(/*)S
(read)168 2832 A
(data)168 3042 A
3252(*/)S
1620 V
(10158)210 648 A
(#define)294 1026 A
(CMD_WRITE)378 1446 A
(0x30)168 2370 A
2706(/*)S
(write)210 2832 A
(data)168 3084 A
3294(*/)S
1710 V
(10159)210 648 A
(#define)294 1026 A
(CMD_READVERIFY)588 1446 A
(0x40)168 2370 A
2706(/*)S
(read)168 2832 A
(verify)252 3042 A
3336(*/)S
1800 V
(10160)210 648 A
(#define)294 1026 A
(CMD_FORMAT)420 1446 A
(0x50)168 2370 A
2706(/*)S
(format)252 2832 A
(track)210 3126 A
3378(*/)S
1890 V
(10161)210 648 A
(#define)294 1026 A
(CMD_SEEK)336 1446 A
(0x70)168 2370 A
2706(/*)S
(seek)168 2832 A
(cylinder)336 3042 A
3420(*/)S
1980 V
(10162)210 648 A
(#define)294 1026 A
(CMD_DIAG)336 1446 A
(0x90)168 2370 A
2706(/*)S
(execute)294 2832 A
(device)252 3168 A
(diagnostics)462 3462 A
3966(*/)S
2070 V
(10163)210 648 A
(#define)294 1026 A
(CMD_SPECIFY)462 1446 A
(0x91)168 2370 A
2706(/*)S
(specify)294 2832 A
(parameters)420 3168 A
3630(*/)S
2160 V
(10164)210 648 A
(#define)294 1026 A
(ATA_IDENTIFY)504 1446 A
(0xEC)168 2370 A
2706(/*)S
(identify)336 2832 A
(drive)210 3210 A
3462(*/)S
2250 V
(10165)210 648 A
(#define)294 1026 A
(REG_CTL)294 1362 A
(0x206)210 2034 A
2370(/*)S
(control)294 2496 A
(register)336 2832 A
3210(*/)S
2340 V
(10166)210 648 A
(#define)294 1026 A
(CTL_NORETRY)462 1446 A
(0x80)168 2370 A
2706(/*)S
(disable)294 2832 A
(access)252 3168 A
(retry)210 3462 A
3714(*/)S
2430 V
(10167)210 648 A
(#define)294 1026 A
(CTL_NOECC)378 1446 A
(0x40)168 2370 A
2706(/*)S
(disable)294 2832 A
(ecc)126 3168 A
(retry)210 3336 A
3588(*/)S
2520 V
(10168)210 648 A
(#define)294 1026 A
(CTL_EIGHTHEADS)588 1446 A
(0x08)168 2370 A
2706(/*)S
(more)168 2832 A
(than)168 3042 A
(eight)210 3252 A
(heads)210 3504 A
3756(*/)S
2610 V
(10169)210 648 A
(#define)294 1026 A
(CTL_RESET)378 1446 A
(0x04)168 2370 A
2706(/*)S
(reset)210 2832 A
(controller)420 3084 A
3546(*/)S
2700 V
(10170)210 648 A
(#define)294 1026 A
(CTL_INTDISABLE)588 1446 A
(0x02)168 2370 A
2706(/*)S
(disable)294 2832 A
(interrupts)420 3168 A
3630(*/)S
2790 V
(10171)210 648 A
2880 V
(10172)210 648 A
1026(/*)S
(Interrupt)378 1152 A
(request)294 1572 A
(lines.)252 1908 A
2202(*/)S
2970 V
(10173)210 648 A
(#define)294 1026 A
(AT_IRQ0)294 1362 A
2034(14)S
2370(/*)S
(interrupt)378 2496 A
(number)252 2916 A
(for)126 3210 A
(controller)420 3378 A
3840(0)S
3924(*/)S
3060 V
(10174)210 648 A
(#define)294 1026 A
(AT_IRQ1)294 1362 A
2034(15)S
2370(/*)S
(interrupt)378 2496 A
(number)252 2916 A
(for)126 3210 A
(controller)420 3378 A
3840(1)S
3924(*/)S
3150 V
(10175)210 648 A
3240 V
(10176)210 648 A
1026(/*)S
(Common)252 1152 A
(command)294 1446 A
(block)210 1782 A
2034(*/)S
3330 V
(10177)210 648 A
(struct)252 1026 A
(command)294 1320 A
1656({)S
3420 V
(10178)210 648 A
(u8_t)168 1110 A
(precomp;)336 1362 A
2034(/*)S
(REG_PRECOMP,)504 2160 A
(etc.)168 2706 A
2916(*/)S
3510 V
(10179)210 648 A
(u8_t)168 1110 A
(count;)252 1362 A
3600 V
(10180)210 648 A
(u8_t)168 1110 A
(sector;)294 1362 A
3690 V
(10181)210 648 A
(u8_t)168 1110 A
(cyl_lo;)294 1362 A
3780 V
(10182)210 648 A
(u8_t)168 1110 A
(cyl_hi;)294 1362 A
3870 V
(10183)210 648 A
(u8_t)168 1110 A
(ldh;)168 1362 A
3960 V
(10184)210 648 A
(u8_t)168 1110 A
(command;)336 1362 A
4050 V
(10185)210 648 A
1026(};)S
4140 V
(10186)210 648 A
4230 V
(10187)210 648 A
4320 V
(10188)210 648 A
1026(/*)S
(Error)210 1152 A
(codes)210 1404 A
1656(*/)S
4410 V
(10189)210 648 A
(#define)294 1026 A
(ERR)126 1362 A
(\(-1\))168 2076 A
2370(/*)S
(general)294 2496 A
(error)210 2832 A
3084(*/)S
4500 V
(10190)210 648 A
(#define)294 1026 A
(ERR_BAD_SECTOR)588 1362 A
(\(-2\))168 2076 A
2370(/*)S
(block)210 2496 A
(marked)252 2748 A
(bad)126 3042 A
(detected)336 3210 A
3588(*/)S
4590 V
(10191)210 648 A
4680 V
(10192)210 648 A
1026(/*)S
(Some)168 1152 A
(controllers)462 1362 A
(don't)210 1866 A
(interrupt,)420 2118 A
(the)126 2580 A
(clock)210 2748 A
(will)168 3000 A
(wake)168 3210 A
3420(us)S
(up.)126 3546 A
3714(*/)S
4770 V
(10193)210 648 A
(#define)294 1026 A
(WAKEUP)252 1362 A
(\(32*HZ\))294 2034 A
2370(/*)S
(drive)210 2496 A
(may)126 2748 A
2916(be)S
(out)126 3042 A
(for)126 3210 A
3378(31)S
(seconds)294 3504 A
(max)126 3840 A
4008(*/)S
4860 V
(10194)210 648 A
4950 V
(10195)210 648 A
1026(/*)S
(Miscellaneous.)588 1152 A
1782(*/)S
5040 V
(10196)210 648 A
(#define)294 1026 A
(MAX_DRIVES)420 1362 A
2160(4)S
2370(/*)S
(this)168 2496 A
(driver)252 2706 A
(supports)336 3000 A
3378(4)S
(drives)252 3462 A
(\(hd0)168 3756 A
3966(-)S
(hd19\))210 4050 A
4302(*/)S
5130 V
(10197)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(>)S
1740(2)S
5220 V
(10198)210 648 A
(#define)294 1026 A
(MAX_SECS)336 1362 A
(256)126 2076 A
2370(/*)S
(controller)420 2496 A
(can)126 2958 A
(transfer)336 3126 A
(this)168 3504 A
(many)168 3714 A
(sectors)294 3924 A
4260(*/)S
5310 V
(10199)210 648 A
(#else)210 1026 A
5400 V
(10200)210 648 A
(#define)294 1026 A
(MAX_SECS)336 1362 A
(127)126 2076 A
2370(/*)S
(but)126 2496 A
(not)126 2664 A
2832(to)S
2958(a)S
3042(16)S
(bit)126 3168 A
(process)294 3336 A
3672(*/)S
5490 V
(10201)210 648 A
(#endif)252 1026 A
5580 V
(10202)210 648 A
(#define)294 1026 A
(MAX_ERRORS)420 1362 A
2160(4)S
2370(/*)S
(how)126 2496 A
(often)210 2664 A
2916(to)S
(try)126 3042 A
(rd/wt)210 3210 A
(before)252 3462 A
(quitting)336 3756 A
4134(*/)S
5670 V
(10203)210 648 A
(#define)294 1026 A
(NR_DEVICES)420 1362 A
(\(MAX_DRIVES)462 2034 A
2538(*)S
(DEV_PER_DRIVE\))588 2622 A
5760 V
(10204)210 648 A
(#define)294 1026 A
(SUB_PER_DRIVE)546 1362 A
(\(NR_PARTITIONS)588 2034 A
2664(*)S
(NR_PARTITIONS\))588 2748 A
5850 V
(10205)210 648 A
(#define)294 1026 A
(NR_SUBDEVS)420 1362 A
(\(MAX_DRIVES)462 2034 A
2538(*)S
(SUB_PER_DRIVE\))588 2622 A
5940 V
(10206)210 648 A
(#define)294 1026 A
(TIMEOUT)294 1362 A
(32000)210 1992 A
2370(/*)S
(controller)420 2496 A
(timeout)294 2958 A
3294(in)S
3420(ms)S
3546(*/)S
6030 V
(10207)210 648 A
(#define)294 1026 A
(RECOVERYTIME)504 1362 A
(500)126 2076 A
2370(/*)S
(controller)420 2496 A
(recovery)336 2958 A
(time)168 3336 A
3546(in)S
3672(ms)S
3798(*/)S
6120 V
(10208)210 648 A
(#define)294 1026 A
(INITIALIZED)462 1362 A
(0x01)168 2034 A
2370(/*)S
(drive)210 2496 A
2748(is)S
(initialized)462 2874 A
3378(*/)S
6210 V
(10209)210 648 A
(#define)294 1026 A
(DEAF)168 1362 A
(0x02)168 2034 A
2370(/*)S
(controller)420 2496 A
(must)168 2958 A
3168(be)S
(reset)210 3294 A
3546(*/)S
8418 V
EP
%%Page: 131 131
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
12 B
(131)180 4248 A
900 V
7 LST
(10210)210 648 A
(#define)294 1026 A
(SMART)210 1362 A
(0x04)168 2034 A
2370(/*)S
(drive)210 2496 A
(supports)336 2748 A
(ATA)126 3126 A
(commands)336 3294 A
3672(*/)S
990 V
(10211)210 648 A
1080 V
(10212)210 648 A
1170 V
(10213)210 648 A
1026(/*)S
(Variables.)420 1152 A
1614(*/)S
1260 V
(10214)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(wini)168 1656 A
1866({)S
2370(/*)S
(main)168 2496 A
(drive)210 2706 A
(struct,)294 2958 A
(one)126 3294 A
(entry)210 3462 A
(per)126 3714 A
(drive)210 3882 A
4134(*/)S
1350 V
(10215)210 648 A
(unsigned)336 1110 A
(state;)252 1488 A
2370(/*)S
(drive)210 2496 A
(state:)252 2748 A
(deaf,)210 3042 A
(initialized,)504 3294 A
(dead)168 3840 A
4050(*/)S
1440 V
(10216)210 648 A
(unsigned)336 1110 A
(base;)210 1488 A
2370(/*)S
(base)168 2496 A
(register)336 2706 A
3084(of)S
(the)126 3210 A
(register)336 3378 A
(file)168 3756 A
3966(*/)S
1530 V
(10217)210 648 A
(unsigned)336 1110 A
(irq;)168 1488 A
2370(/*)S
(interrupt)378 2496 A
(request)294 2916 A
(line)168 3252 A
3462(*/)S
1620 V
(10218)210 648 A
(unsigned)336 1110 A
(lcylinders;)462 1488 A
2370(/*)S
(logical)294 2496 A
(number)252 2832 A
3126(of)S
(cylinders)378 3252 A
(\(BIOS\))252 3672 A
3966(*/)S
1710 V
(10219)210 648 A
(unsigned)336 1110 A
(lheads;)294 1488 A
2370(/*)S
(logical)294 2496 A
(number)252 2832 A
3126(of)S
(heads)210 3252 A
3504(*/)S
1800 V
(10220)210 648 A
(unsigned)336 1110 A
(lsectors;)378 1488 A
2370(/*)S
(logical)294 2496 A
(number)252 2832 A
3126(of)S
(sectors)294 3252 A
(per)126 3588 A
(track)210 3756 A
4008(*/)S
1890 V
(10221)210 648 A
(unsigned)336 1110 A
(pcylinders;)462 1488 A
2370(/*)S
(physical)336 2496 A
(number)252 2874 A
3168(of)S
(cylinders)378 3294 A
(\(translated\))504 3714 A
4260(*/)S
1980 V
(10222)210 648 A
(unsigned)336 1110 A
(pheads;)294 1488 A
2370(/*)S
(physical)336 2496 A
(number)252 2874 A
3168(of)S
(heads)210 3294 A
3546(*/)S
2070 V
(10223)210 648 A
(unsigned)336 1110 A
(psectors;)378 1488 A
2370(/*)S
(physical)336 2496 A
(number)252 2874 A
3168(of)S
(sectors)294 3294 A
(per)126 3630 A
(track)210 3798 A
4050(*/)S
2160 V
(10224)210 648 A
(unsigned)336 1110 A
(ldhpref;)336 1488 A
2370(/*)S
(top)126 2496 A
(four)168 2664 A
(bytes)210 2874 A
3126(of)S
(the)126 3252 A
(LDH)126 3420 A
(\(head\))252 3588 A
(register)336 3882 A
4260(*/)S
2250 V
(10225)210 648 A
(unsigned)336 1110 A
(precomp;)336 1488 A
2370(/*)S
(write)210 2496 A
(precompensation)630 2748 A
(cylinder)336 3420 A
3798(/)S
3882(4)S
3966(*/)S
2340 V
(10226)210 648 A
(unsigned)336 1110 A
(max_count;)420 1488 A
2370(/*)S
(max)126 2496 A
(request)294 2664 A
(for)126 3000 A
(this)168 3168 A
(drive)210 3378 A
3630(*/)S
2430 V
(10227)210 648 A
(unsigned)336 1110 A
(open_ct;)336 1488 A
2370(/*)S
(in-use)252 2496 A
(count)210 2790 A
3042(*/)S
2520 V
(10228)210 648 A
(struct)252 1110 A
(device)252 1404 A
(part[DEV_PER_DRIVE];)840 1698 A
2706(/*)S
(primary)294 2832 A
(partitions:)462 3168 A
(hd[0-4])294 3672 A
4008(*/)S
2610 V
(10229)210 648 A
(struct)252 1110 A
(device)252 1404 A
(subpart[SUB_PER_DRIVE];)966 1698 A
2706(/*)S
(subpartitions:)588 2832 A
(hd[1-4][a-d])504 3462 A
4008(*/)S
2700 V
(10230)210 648 A
1026(})S
(wini[MAX_DRIVES],)714 1110 A
(*w_wn;)252 1866 A
2790 V
(10231)210 648 A
2880 V
(10232)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(trans)210 1656 A
1908({)S
2970 V
(10233)210 648 A
(struct)252 1110 A
(iorequest_s)462 1404 A
(*iop;)210 1908 A
2370(/*)S
(belongs)294 2496 A
2832(to)S
(this)168 2958 A
(I/O)126 3168 A
(request)294 3336 A
3672(*/)S
3060 V
(10234)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(block;)252 1698 A
2370(/*)S
(first)210 2496 A
(sector)252 2748 A
3042(to)S
(transfer)336 3168 A
3546(*/)S
3150 V
(10235)210 648 A
(unsigned)336 1110 A
(count;)252 1488 A
2370(/*)S
(byte)168 2496 A
(count)210 2706 A
2958(*/)S
3240 V
(10236)210 648 A
(phys_bytes)420 1110 A
(phys;)210 1572 A
2370(/*)S
(user)168 2496 A
(physical)336 2706 A
(address)294 3084 A
3420(*/)S
3330 V
(10237)210 648 A
1026(})S
(wtrans[NR_IOREQS];)756 1110 A
3420 V
(10238)210 648 A
3510 V
(10239)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(trans)210 1656 A
(*w_tp;)252 1908 A
2706(/*)S
2832(to)S
(add)126 2958 A
(transfer)336 3126 A
(requests)336 3504 A
3882(*/)S
3600 V
(10240)210 648 A
(PRIVATE)294 1026 A
(unsigned)336 1362 A
(w_count;)336 1740 A
2706(/*)S
(number)252 2832 A
3126(of)S
(bytes)210 3252 A
3504(to)S
(transfer)336 3630 A
4008(*/)S
3690 V
(10241)210 648 A
(PRIVATE)294 1026 A
(unsigned)336 1362 A
(long)168 1740 A
(w_nextblock;)504 1950 A
2706(/*)S
(next)168 2832 A
(block)210 3042 A
3294(on)S
(disk)168 3420 A
3630(to)S
(transfer)336 3756 A
4134(*/)S
3780 V
(10242)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_opcode;)378 1530 A
2706(/*)S
(DEV_READ)336 2832 A
3210(or)S
(DEV_WRITE)378 3336 A
3756(*/)S
3870 V
(10243)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_command;)420 1530 A
2706(/*)S
(current)294 2832 A
(command)294 3168 A
3504(in)S
(execution)378 3630 A
4050(*/)S
3960 V
(10244)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_status;)378 1530 A
2706(/*)S
(status)252 2832 A
(after)210 3126 A
(interrupt)378 3378 A
3798(*/)S
4050 V
(10245)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_drive;)336 1530 A
2706(/*)S
(selected)336 2832 A
(drive)210 3210 A
3462(*/)S
4140 V
(10246)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(device)252 1656 A
(*w_dv;)252 1950 A
2706(/*)S
(device's)336 2832 A
(base)168 3210 A
(and)126 3420 A
(size)168 3588 A
3798(*/)S
4230 V
(10247)210 648 A
4320 V
(10248)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(init_params,)504 2076 A
(\(void\))252 2622 A
2916(\);)S
4410 V
(10249)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(w_do_open,)420 2034 A
(\(struct)294 2496 A
(driver)252 2832 A
(*dp,)168 3126 A
(message)294 3336 A
(*m_ptr\))294 3672 A
4008(\);)S
4500 V
(10250)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(struct)252 1866 A
(device)252 2160 A
(*w_prepare,)462 2454 A
(\(int)168 2958 A
(device\))294 3168 A
3504(\);)S
4590 V
(10251)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(w_identify,)462 2034 A
(\(void\))252 2538 A
2832(\);)S
4680 V
(10252)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(char)168 1866 A
(*w_name,)336 2076 A
(\(void\))252 2454 A
2748(\);)S
4770 V
(10253)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(w_specify,)420 2034 A
(\(void\))252 2496 A
2790(\);)S
4860 V
(10254)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(w_schedule,)462 2034 A
(\(int)168 2538 A
(proc_nr,)336 2748 A
(struct)252 3126 A
(iorequest_s)462 3420 A
(*iop\))210 3924 A
4176(\);)S
4950 V
(10255)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(w_finish,)378 2034 A
(\(void\))252 2454 A
2748(\);)S
5040 V
(10256)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(com_out,)336 2034 A
(\(struct)294 2412 A
(command)294 2748 A
(*cmd\))210 3084 A
3336(\);)S
5130 V
(10257)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(w_need_reset,)546 2076 A
(\(void\))252 2664 A
2958(\);)S
5220 V
(10258)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(w_do_close,)462 2034 A
(\(struct)294 2538 A
(driver)252 2874 A
(*dp,)168 3168 A
(message)294 3378 A
(*m_ptr\))294 3714 A
4050(\);)S
5310 V
(10259)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(com_simple,)462 2034 A
(\(struct)294 2538 A
(command)294 2874 A
(*cmd\))210 3210 A
3462(\);)S
5400 V
(10260)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(w_timeout,)420 2076 A
(\(void\))252 2538 A
2832(\);)S
5490 V
(10261)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(w_reset,)336 2034 A
(\(void\))252 2412 A
2706(\);)S
5580 V
(10262)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(w_intr_wait,)504 2034 A
(\(void\))252 2580 A
2874(\);)S
5670 V
(10263)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(w_waitfor,)420 2034 A
(\(int)168 2496 A
(mask,)210 2706 A
(int)126 2958 A
(value\))252 3126 A
3420(\);)S
5760 V
(10264)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(w_handler,)420 2034 A
(\(int)168 2496 A
(irq\))168 2706 A
2916(\);)S
5850 V
(10265)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(w_geometry,)462 2076 A
(\(struct)294 2580 A
(partition)378 2916 A
(*entry\))294 3336 A
3672(\);)S
5940 V
(10266)210 648 A
6030 V
(10267)210 648 A
1026(/*)S
(w_waitfor)378 1152 A
(loop)168 1572 A
(unrolled)336 1782 A
(once)168 2160 A
(for)126 2370 A
(speed.)252 2538 A
2832(*/)S
6120 V
(10268)210 648 A
(#define)294 1026 A
(waitfor\(mask,)546 1362 A
(value\))252 1950 A
2370(\\)S
6210 V
(10269)210 648 A
(\(\(in_byte\(w_wn->base)840 1362 A
2244(+)S
(REG_STATUS\))462 2328 A
2832(&)S
(mask\))210 2916 A
3168(==)S
(value)210 3294 A
3546(\\)S
8418 V
EP
%%Page: 132 132
BP
/slant 0 def
/height 0 def
630 V
12 B
(132)180 648 A
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(10270)210 648 A
1698(||)S
(w_waitfor\(mask,)630 1824 A
(value\)\))294 2496 A
990 V
(10271)210 648 A
1080 V
(10272)210 648 A
1170 V
(10273)210 648 A
1026(/*)S
(Entry)210 1152 A
(points)252 1404 A
1698(to)S
(this)168 1824 A
(driver.)294 2034 A
2370(*/)S
1260 V
(10274)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(driver)252 1656 A
(w_dtab)252 1950 A
2244(=)S
2328({)S
1350 V
(10275)210 648 A
(w_name,)294 1110 A
2034(/*)S
(current)294 2160 A
(device's)336 2496 A
(name)168 2874 A
3084(*/)S
1440 V
(10276)210 648 A
(w_do_open,)420 1110 A
2034(/*)S
(open)168 2160 A
2370(or)S
(mount)210 2496 A
(request,)336 2748 A
(initialize)420 3126 A
(device)252 3588 A
3882(*/)S
1530 V
(10277)210 648 A
(w_do_close,)462 1110 A
2034(/*)S
(release)294 2160 A
(device)252 2496 A
2790(*/)S
1620 V
(10278)210 648 A
(do_diocntl,)462 1110 A
2034(/*)S
(get)126 2160 A
2328(or)S
(set)126 2454 A
2622(a)S
(partition's)462 2706 A
(geometry)336 3210 A
3588(*/)S
1710 V
(10279)210 648 A
(w_prepare,)420 1110 A
2034(/*)S
(prepare)294 2160 A
(for)126 2496 A
(I/O)126 2664 A
2832(on)S
2958(a)S
(given)210 3042 A
(minor)210 3294 A
(device)252 3546 A
3840(*/)S
1800 V
(10280)210 648 A
(w_schedule,)462 1110 A
2034(/*)S
(precompute)420 2160 A
(cylinder,)378 2622 A
(head,)210 3042 A
(sector,)294 3294 A
(etc.)168 3630 A
3840(*/)S
1890 V
(10281)210 648 A
(w_finish,)378 1110 A
2034(/*)S
2160(do)S
(the)126 2286 A
(I/O)126 2454 A
2622(*/)S
1980 V
(10282)210 648 A
(nop_cleanup,)504 1110 A
2034(/*)S
(nothing)294 2160 A
2496(to)S
(clean)210 2622 A
2874(up)S
3000(*/)S
2070 V
(10283)210 648 A
(w_geometry,)462 1110 A
2034(/*)S
(tell)168 2160 A
(the)126 2370 A
(geometry)336 2538 A
2916(of)S
(the)126 3042 A
(disk)168 3210 A
3420(*/)S
2160 V
(10284)210 648 A
1026(};)S
2250 V
(10285)210 648 A
2340 V
(10286)210 648 A
(#if)126 1026 A
(ENABLE_ATAPI)504 1194 A
2430 V
(10287)210 648 A
(#include)336 1026 A
("atapi.c")378 1404 A
2034(/*)S
(extra)210 2160 A
(code)168 2412 A
(for)126 2622 A
(ATAPI)210 2790 A
(CD-ROM)252 3042 A
3336(*/)S
2520 V
(10288)210 648 A
(#endif)252 1026 A
2610 V
(10289)210 648 A
2700 V
(10290)210 648 A
2790 V
(10291)210 648 A
(/*===========================================================================*)3276 1026 A
2880 V
(10292)210 648 A
1068(*)S
(at_winchester_task)756 2370 A
4260(*)S
2970 V
(10293)210 648 A
(*===========================================================================*/)3276 1068 A
3060 V
(10294)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(at_winchester_task\(\))840 1530 A
3150 V
(10295)210 648 A
1026({)S
3240 V
(10296)210 648 A
1026(/*)S
(Set)126 1152 A
(special)294 1320 A
(disk)168 1656 A
(parameters)420 1866 A
(then)168 2328 A
(call)168 2538 A
(the)126 2748 A
(generic)294 2916 A
(main)168 3252 A
(loop.)210 3462 A
3714(*/)S
3330 V
(10297)210 648 A
3420 V
(10298)210 648 A
(init_params\(\);)588 1110 A
3510 V
(10299)210 648 A
3600 V
(10300)210 648 A
(driver_task\(&w_dtab\);)882 1110 A
3690 V
(10301)210 648 A
1026(})S
3960 V
(10304)210 648 A
(/*============================================================================*)3318 1026 A
4050 V
(10305)210 648 A
1068(*)S
(init_params)462 2370 A
4302(*)S
4140 V
(10306)210 648 A
(*============================================================================*/)3318 1068 A
4230 V
(10307)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(init_params\(\))546 1572 A
4320 V
(10308)210 648 A
1026({)S
4410 V
(10309)210 648 A
1026(/*)S
(This)168 1152 A
(routine)294 1362 A
1698(is)S
(called)252 1824 A
2118(at)S
(startup)294 2244 A
2580(to)S
(initialize)420 2706 A
(the)126 3168 A
(drive)210 3336 A
(parameters.)462 3588 A
4092(*/)S
4500 V
(10310)210 648 A
4590 V
(10311)210 648 A
(u16_t)210 1110 A
(parv[2];)336 1362 A
4680 V
(10312)210 648 A
(unsigned)336 1110 A
(int)126 1488 A
(vector;)294 1656 A
4770 V
(10313)210 648 A
(int)126 1110 A
(drive,)252 1278 A
(nr_drives,)420 1572 A
2034(i;)S
4860 V
(10314)210 648 A
(struct)252 1110 A
(wini)168 1404 A
(*wn;)168 1614 A
4950 V
(10315)210 648 A
(u8_t)168 1110 A
(params[16];)462 1320 A
5040 V
(10316)210 648 A
(phys_bytes)420 1110 A
(param_phys)420 1572 A
2034(=)S
(vir2phys\(params\);)714 2118 A
5130 V
(10317)210 648 A
5220 V
(10318)210 648 A
1110(/*)S
(Get)126 1236 A
(the)126 1404 A
(number)252 1572 A
1866(of)S
(drives)252 1992 A
(from)168 2286 A
(the)126 2496 A
(BIOS)168 2664 A
(data)168 2874 A
(area)168 3084 A
3294(*/)S
5310 V
(10319)210 648 A
(phys_copy\(0x475L,)714 1110 A
(param_phys,)462 1866 A
(1L\);)168 2370 A
5400 V
(10320)210 648 A
1110(if)S
(\(\(nr_drives)462 1236 A
1740(=)S
(params[0]\))420 1824 A
2286(>)S
2370(2\))S
(nr_drives)378 2496 A
2916(=)S
3000(2;)S
5490 V
(10321)210 648 A
5580 V
(10322)210 648 A
(for)126 1110 A
(\(drive)252 1278 A
1572(=)S
1656(0,)S
1782(wn)S
1908(=)S
(wini;)210 1992 A
(drive)210 2244 A
2496(<)S
(MAX_DRIVES;)462 2580 A
(drive++,)336 3084 A
(wn++\))210 3462 A
3714({)S
5670 V
(10323)210 648 A
1362(if)S
(\(drive)252 1488 A
1782(<)S
(nr_drives\))420 1866 A
2328({)S
5760 V
(10324)210 648 A
1698(/*)S
(Copy)168 1824 A
(the)126 2034 A
(BIOS)168 2202 A
(parameter)378 2412 A
(vector)252 2832 A
3126(*/)S
5850 V
(10325)210 648 A
(vector)252 1698 A
1992(=)S
(drive)210 2076 A
2328(==)S
2454(0)S
2538(?)S
(WINI_0_PARM_VEC)630 2622 A
3294(:)S
(WINI_1_PARM_VEC;)672 3378 A
5940 V
(10326)210 648 A
(phys_copy\(vector)672 1698 A
2412(*)S
(4L,)126 2496 A
(vir2phys\(parv\),)630 2664 A
(4L\);)168 3336 A
6030 V
(10327)210 648 A
6120 V
(10328)210 648 A
1698(/*)S
(Calculate)378 1824 A
(the)126 2244 A
(address)294 2412 A
2748(of)S
(the)126 2874 A
(parameters)420 3042 A
(and)126 3504 A
(copy)168 3672 A
(them)168 3882 A
4092(*/)S
6210 V
(10329)210 648 A
(phys_copy\(hclick_to_physb\(parv[1]\))1428 1698 A
3168(+)S
(parv[0],)336 3252 A
(param_phys,)462 3630 A
(16L\);)210 4134 A
8418 V
EP
%%Page: 133 133
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
12 B
(133)180 4248 A
900 V
7 LST
(10330)210 648 A
990 V
(10331)210 648 A
1698(/*)S
(Copy)168 1824 A
(the)126 2034 A
(parameters)420 2202 A
2664(to)S
(the)126 2790 A
(structures)420 2958 A
3420(of)S
(the)126 3546 A
(drive)210 3714 A
3966(*/)S
1080 V
(10332)210 648 A
(wn->lcylinders)588 1698 A
2328(=)S
(bp_cylinders\(params\);)882 2412 A
1170 V
(10333)210 648 A
(wn->lheads)420 1698 A
2160(=)S
(bp_heads\(params\);)714 2244 A
1260 V
(10334)210 648 A
(wn->lsectors)504 1698 A
2244(=)S
(bp_sectors\(params\);)798 2328 A
1350 V
(10335)210 648 A
(wn->precomp)462 1698 A
2202(=)S
(bp_precomp\(params\))756 2286 A
3084(>>)S
3210(2;)S
1440 V
(10336)210 648 A
1362(})S
1530 V
(10337)210 648 A
(wn->ldhpref)462 1362 A
1866(=)S
(ldh_init\(drive\);)672 1950 A
1620 V
(10338)210 648 A
(wn->max_count)546 1362 A
1950(=)S
(MAX_SECS)336 2034 A
2412(<<)S
(SECTOR_SHIFT;)546 2538 A
1710 V
(10339)210 648 A
1362(if)S
(\(drive)252 1488 A
1782(<)S
1866(2\))S
1992({)S
1800 V
(10340)210 648 A
1698(/*)S
(Controller)420 1824 A
2286(0.)S
2412(*/)S
1890 V
(10341)210 648 A
(wn->base)336 1698 A
2076(=)S
(REG_BASE0;)420 2160 A
1980 V
(10342)210 648 A
(wn->irq)294 1698 A
2034(=)S
(AT_IRQ0;)336 2118 A
2070 V
(10343)210 648 A
1362(})S
(else)168 1446 A
1656({)S
2160 V
(10344)210 648 A
1698(/*)S
(Controller)420 1824 A
2286(1.)S
2412(*/)S
2250 V
(10345)210 648 A
(wn->base)336 1698 A
2076(=)S
(REG_BASE1;)420 2160 A
2340 V
(10346)210 648 A
(wn->irq)294 1698 A
2034(=)S
(AT_IRQ1;)336 2118 A
2430 V
(10347)210 648 A
1362(})S
2520 V
(10348)210 648 A
1110(})S
2610 V
(10349)210 648 A
1026(})S
2880 V
(10352)210 648 A
(/*============================================================================*)3318 1026 A
2970 V
(10353)210 648 A
1068(*)S
(w_do_open)378 2370 A
4302(*)S
3060 V
(10354)210 648 A
(*============================================================================*/)3318 1068 A
3150 V
(10355)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_do_open\(dp,)546 1530 A
(m_ptr\))252 2118 A
3240 V
(10356)210 648 A
(struct)252 1026 A
(driver)252 1320 A
(*dp;)168 1614 A
3330 V
(10357)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
3420 V
(10358)210 648 A
1026({)S
3510 V
(10359)210 648 A
1026(/*)S
(Device)252 1152 A
(open:)210 1446 A
(Initialize)420 1698 A
(the)126 2160 A
(controller)420 2328 A
(and)126 2790 A
(read)168 2958 A
(the)126 3168 A
(partition)378 3336 A
(table.)252 3756 A
4050(*/)S
3600 V
(10360)210 648 A
3690 V
(10361)210 648 A
(int)126 1110 A
1278(r;)S
3780 V
(10362)210 648 A
(struct)252 1110 A
(wini)168 1404 A
(*wn;)168 1614 A
3870 V
(10363)210 648 A
(struct)252 1110 A
(command)294 1404 A
(cmd;)168 1740 A
3960 V
(10364)210 648 A
4050 V
(10365)210 648 A
1110(if)S
(\(w_prepare\(m_ptr->DEVICE\))1050 1236 A
2328(==)S
(NIL_DEV\))336 2454 A
(return\(ENXIO\);)588 2832 A
4140 V
(10366)210 648 A
1110(wn)S
1236(=)S
(w_wn;)210 1320 A
4230 V
(10367)210 648 A
4320 V
(10368)210 648 A
1110(if)S
(\(wn->state)420 1236 A
1698(==)S
1824(0\))S
1950({)S
4410 V
(10369)210 648 A
1362(/*)S
(Try)126 1488 A
1656(to)S
(identify)336 1782 A
(the)126 2160 A
(device.)294 2328 A
2664(*/)S
4500 V
(10370)210 648 A
1362(if)S
(\(w_identify\(\))546 1488 A
2076(!=)S
(OK\))126 2202 A
2370({)S
4590 V
(10371)210 648 A
(printf\("%s:)462 1698 A
(probe)210 2202 A
(failed\\n",)420 2454 A
(w_name\(\)\);)420 2916 A
4680 V
(10372)210 648 A
1698(if)S
(\(wn->state)420 1824 A
2286(&)S
(DEAF\))210 2370 A
(w_reset\(\);)420 2622 A
4770 V
(10373)210 648 A
(wn->state)378 1698 A
2118(=)S
2202(0;)S
4860 V
(10374)210 648 A
(return\(ENXIO\);)588 1698 A
4950 V
(10375)210 648 A
1362(})S
5040 V
(10376)210 648 A
1110(})S
5130 V
(10377)210 648 A
1110(if)S
(\(wn->open_ct++)588 1236 A
1866(==)S
1992(0\))S
2118({)S
5220 V
(10378)210 648 A
1362(/*)S
(Partition)378 1488 A
(the)126 1908 A
(disk.)210 2076 A
2328(*/)S
5310 V
(10379)210 648 A
(partition\(&w_dtab,)756 1362 A
(w_drive)294 2160 A
2496(*)S
(DEV_PER_DRIVE,)588 2580 A
(P_PRIMARY\);)462 3210 A
5400 V
(10380)210 648 A
1110(})S
5490 V
(10381)210 648 A
(return\(OK\);)462 1110 A
5580 V
(10382)210 648 A
1026(})S
5850 V
(10385)210 648 A
(/*===========================================================================*)3276 1026 A
5940 V
(10386)210 648 A
1068(*)S
(w_prepare)378 2370 A
4260(*)S
6030 V
(10387)210 648 A
(*===========================================================================*/)3276 1068 A
6120 V
(10388)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(device)252 1656 A
(*w_prepare\(device\))756 1950 A
6210 V
(10389)210 648 A
(int)126 1026 A
(device;)294 1194 A
8418 V
EP
%%Page: 134 134
BP
/slant 0 def
/height 0 def
630 V
12 B
(134)180 648 A
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(10390)210 648 A
1026({)S
990 V
(10391)210 648 A
1026(/*)S
(Prepare)294 1152 A
(for)126 1488 A
(I/O)126 1656 A
1824(on)S
1950(a)S
(device.)294 2034 A
2370(*/)S
1080 V
(10392)210 648 A
1170 V
(10393)210 648 A
1110(/*)S
(Nothing)294 1236 A
1572(to)S
(transfer)336 1698 A
2076(as)S
(yet.)168 2202 A
2412(*/)S
1260 V
(10394)210 648 A
(w_count)294 1110 A
1446(=)S
1530(0;)S
1350 V
(10395)210 648 A
1440 V
(10396)210 648 A
1110(if)S
(\(device)294 1236 A
1572(<)S
(NR_DEVICES\))462 1656 A
2160({)S
3042(/*)S
(hd0,)168 3168 A
(hd1,)168 3378 A
(...)126 3588 A
3756(*/)S
1530 V
(10397)210 648 A
(w_drive)294 1362 A
1698(=)S
(device)252 1782 A
2076(/)S
(DEV_PER_DRIVE;)588 2160 A
3042(/*)S
(save)168 3168 A
(drive)210 3378 A
(number)252 3630 A
3924(*/)S
1620 V
(10398)210 648 A
(w_wn)168 1362 A
1572(=)S
(&wini[w_drive];)630 1656 A
1710 V
(10399)210 648 A
(w_dv)168 1362 A
1572(=)S
(&w_wn->part[device)756 1656 A
2454(%)S
(DEV_PER_DRIVE];)630 2538 A
1800 V
(10400)210 648 A
1110(})S
(else)168 1194 A
1890 V
(10401)210 648 A
1110(if)S
(\(\(unsigned\))462 1236 A
(\(device)294 1740 A
2076(-=)S
(MINOR_hd1a\))462 2202 A
2706(<)S
(NR_SUBDEVS\))462 2790 A
3294({)S
3378(/*)S
(hd1a,)210 3504 A
(hd1b,)210 3756 A
(...)126 4008 A
4176(*/)S
1980 V
(10402)210 648 A
(w_drive)294 1362 A
1698(=)S
(device)252 1782 A
2076(/)S
(SUB_PER_DRIVE;)588 2160 A
2070 V
(10403)210 648 A
(w_wn)168 1362 A
1572(=)S
(&wini[w_drive];)630 1656 A
2160 V
(10404)210 648 A
(w_dv)168 1362 A
1572(=)S
(&w_wn->subpart[device)882 1656 A
2580(%)S
(SUB_PER_DRIVE];)630 2664 A
2250 V
(10405)210 648 A
1110(})S
(else)168 1194 A
1404({)S
2340 V
(10406)210 648 A
(return\(NIL_DEV\);)672 1362 A
2430 V
(10407)210 648 A
1110(})S
2520 V
(10408)210 648 A
(return\(w_dv\);)546 1110 A
2610 V
(10409)210 648 A
1026(})S
2880 V
(10412)210 648 A
(/*===========================================================================*)3276 1026 A
2970 V
(10413)210 648 A
1068(*)S
(w_identify)420 2370 A
4260(*)S
3060 V
(10414)210 648 A
(*===========================================================================*/)3276 1068 A
3150 V
(10415)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_identify\(\))504 1530 A
3240 V
(10416)210 648 A
1026({)S
3330 V
(10417)210 648 A
1026(/*)S
(Find)168 1152 A
(out)126 1362 A
1530(if)S
1656(a)S
(device)252 1740 A
(exists,)294 2034 A
2370(if)S
2496(it)S
2622(is)S
2748(an)S
(old)126 2874 A
3042(AT)S
(disk,)210 3168 A
3420(or)S
3546(a)S
(newer)210 3630 A
(ATA)126 3882 A
3420 V
(10418)210 648 A
1068(*)S
(drive,)252 1152 A
1446(a)S
(removable)378 1530 A
(media)210 1950 A
(device,)294 2202 A
(etc.)168 2538 A
3510 V
(10419)210 648 A
1068(*/)S
3600 V
(10420)210 648 A
3690 V
(10421)210 648 A
(struct)252 1110 A
(wini)168 1404 A
(*wn)126 1614 A
1782(=)S
(w_wn;)210 1866 A
3780 V
(10422)210 648 A
(struct)252 1110 A
(command)294 1404 A
(cmd;)168 1740 A
3870 V
(10423)210 648 A
(char)168 1110 A
(id_string[40];)588 1320 A
3960 V
(10424)210 648 A
(int)126 1110 A
1278(i,)S
1404(r;)S
4050 V
(10425)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(size;)210 1698 A
4140 V
(10426)210 648 A
(#define)294 1026 A
(id_byte\(n\))420 1362 A
(\(&tmp_buf[2)462 2034 A
2538(*)S
(\(n\)]\))210 2622 A
4230 V
(10427)210 648 A
(#define)294 1026 A
(id_word\(n\))420 1362 A
(\(\(\(u16_t\))378 2034 A
(id_byte\(n\)[0])546 2454 A
3042(<<)S
3210(0\))S
3336(\\)S
4320 V
(10428)210 648 A
(|\(\(u16_t\))378 2034 A
(id_byte\(n\)[1])546 2454 A
3042(<<)S
(8\)\))126 3210 A
4410 V
(10429)210 648 A
(#define)294 1026 A
(id_longword\(n\))588 1362 A
(\(\(\(u32_t\))378 2034 A
(id_byte\(n\)[0])546 2454 A
3042(<<)S
3210(0\))S
3336(\\)S
4500 V
(10430)210 648 A
(|\(\(u32_t\))378 2034 A
(id_byte\(n\)[1])546 2454 A
3042(<<)S
3210(8\))S
3336(\\)S
4590 V
(10431)210 648 A
(|\(\(u32_t\))378 2034 A
(id_byte\(n\)[2])546 2454 A
3042(<<)S
(16\))126 3168 A
3336(\\)S
4680 V
(10432)210 648 A
(|\(\(u32_t\))378 2034 A
(id_byte\(n\)[3])546 2454 A
3042(<<)S
(24\)\))168 3168 A
4770 V
(10433)210 648 A
4860 V
(10434)210 648 A
1110(/*)S
(Check)210 1236 A
1488(if)S
(the)126 1614 A
(one)126 1782 A
1950(of)S
(the)126 2076 A
(registers)378 2244 A
(exists.)294 2664 A
3000(*/)S
4950 V
(10435)210 648 A
1110(r)S
1194(=)S
(in_byte\(wn->base)672 1278 A
1992(+)S
(REG_CYL_LO\);)504 2076 A
5040 V
(10436)210 648 A
(out_byte\(wn->base)714 1110 A
1866(+)S
(REG_CYL_LO,)462 1950 A
(\304r\);)168 2454 A
5130 V
(10437)210 648 A
1110(if)S
(\(in_byte\(wn->base)714 1236 A
1992(+)S
(REG_CYL_LO\))462 2076 A
2580(==)S
2706(r\))S
(return\(ERR\);)504 2832 A
5220 V
(10438)210 648 A
5310 V
(10439)210 648 A
1110(/*)S
(Looks)210 1236 A
(OK;)126 1488 A
(register)336 1656 A
(IRQ)126 2034 A
(and)126 2202 A
(try)126 2370 A
2538(an)S
(ATA)126 2664 A
(identify)336 2832 A
(command.)336 3210 A
3588(*/)S
5400 V
(10440)210 648 A
(put_irq_handler\(wn->irq,)1008 1110 A
(w_handler\);)462 2160 A
5490 V
(10441)210 648 A
(enable_irq\(wn->irq\);)840 1110 A
5580 V
(10442)210 648 A
5670 V
(10443)210 648 A
(cmd.ldh)294 1110 A
1614(=)S
(wn->ldhpref;)504 1698 A
5760 V
(10444)210 648 A
(cmd.command)462 1110 A
1614(=)S
(ATA_IDENTIFY;)546 1698 A
5850 V
(10445)210 648 A
1110(if)S
(\(com_simple\(&cmd\))714 1236 A
1992(==)S
(OK\))126 2118 A
2286({)S
5940 V
(10446)210 648 A
1362(/*)S
(This)168 1488 A
1698(is)S
1824(an)S
(ATA)126 1950 A
(device.)294 2118 A
2454(*/)S
6030 V
(10447)210 648 A
(wn->state)378 1362 A
1782(|=)S
(SMART;)252 1908 A
6120 V
(10448)210 648 A
6210 V
(10449)210 648 A
1362(/*)S
(Device)252 1488 A
(information.)504 1782 A
2328(*/)S
8418 V
EP
%%Page: 135 135
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
12 B
(135)180 4248 A
900 V
7 LST
(10450)210 648 A
(port_read\(wn->base)756 1362 A
2160(+)S
(REG_DATA,)378 2244 A
(tmp_phys,)378 2664 A
(SECTOR_SIZE\);)546 3084 A
990 V
(10451)210 648 A
1080 V
(10452)210 648 A
1362(/*)S
(Why)126 1488 A
(are)126 1656 A
(the)126 1824 A
(strings)294 1992 A
(byte)168 2328 A
(swapped???)420 2538 A
3000(*/)S
1170 V
(10453)210 648 A
(for)126 1362 A
1530(\(i)S
1656(=)S
1740(0;)S
1866(i)S
1950(<)S
(40;)126 2034 A
(i++\))168 2202 A
(id_string[i])504 2412 A
2958(=)S
(id_byte\(27\)[i\3031];)714 3042 A
1260 V
(10454)210 648 A
1350 V
(10455)210 648 A
1362(/*)S
(Preferred)378 1488 A
(CHS)126 1908 A
(translation)462 2076 A
(mode.)210 2580 A
2832(*/)S
1440 V
(10456)210 648 A
(wn->pcylinders)588 1362 A
1992(=)S
(id_word\(1\);)462 2076 A
1530 V
(10457)210 648 A
(wn->pheads)420 1362 A
1824(=)S
(id_word\(3\);)462 1908 A
1620 V
(10458)210 648 A
(wn->psectors)504 1362 A
1908(=)S
(id_word\(6\);)462 1992 A
1710 V
(10459)210 648 A
(size)168 1362 A
1572(=)S
(\(u32_t\))294 1656 A
(wn->pcylinders)588 1992 A
2622(*)S
(wn->pheads)420 2706 A
3168(*)S
(wn->psectors;)546 3252 A
1800 V
(10460)210 648 A
1890 V
(10461)210 648 A
1362(if)S
(\(\(id_byte\(49\)[1])672 1488 A
2202(&)S
(0x02\))210 2286 A
2538(&&)S
(size)168 2664 A
2874(>)S
(512L*1024*2\))504 2958 A
3504({)S
1980 V
(10462)210 648 A
1698(/*)S
(Drive)210 1824 A
2076(is)S
(LBA)126 2202 A
(capable)294 2370 A
(and)126 2706 A
2874(is)S
(big)126 3000 A
(enough)252 3168 A
3462(to)S
(trust)210 3588 A
3840(it)S
3966(to)S
2070 V
(10463)210 648 A
1740(*)S
(not)126 1824 A
(make)168 1992 A
2202(a)S
(mess)168 2286 A
2496(of)S
(it.)126 2622 A
2160 V
(10464)210 648 A
1740(*/)S
2250 V
(10465)210 648 A
(wn->ldhpref)462 1698 A
2202(|=)S
(LDH_LBA;)336 2328 A
2340 V
(10466)210 648 A
(size)168 1698 A
1908(=)S
(id_longword\(60\);)672 1992 A
2430 V
(10467)210 648 A
1362(})S
2520 V
(10468)210 648 A
2610 V
(10469)210 648 A
1362(if)S
(\(wn->lcylinders)630 1488 A
2160(==)S
2286(0\))S
2412({)S
2700 V
(10470)210 648 A
1698(/*)S
1824(No)S
(BIOS)168 1950 A
(parameters?)462 2160 A
(Then)168 2706 A
(make)168 2916 A
(some)168 3126 A
(up.)126 3336 A
3504(*/)S
2790 V
(10471)210 648 A
(wn->lcylinders)588 1698 A
2328(=)S
(wn->pcylinders;)630 2412 A
2880 V
(10472)210 648 A
(wn->lheads)420 1698 A
2160(=)S
(wn->pheads;)462 2244 A
2970 V
(10473)210 648 A
(wn->lsectors)504 1698 A
2244(=)S
(wn->psectors;)546 2328 A
3060 V
(10474)210 648 A
(while)210 1698 A
(\(wn->lcylinders)630 1950 A
2622(>)S
(1024\))210 2706 A
2958({)S
3150 V
(10475)210 648 A
(wn->lheads)420 2034 A
2496(*=)S
2622(2;)S
3240 V
(10476)210 648 A
(wn->lcylinders)588 2034 A
2664(/=)S
2790(2;)S
3330 V
(10477)210 648 A
1698(})S
3420 V
(10478)210 648 A
1362(})S
3510 V
(10479)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3600 V
(10480)210 648 A
1362(/*)S
(Not)126 1488 A
1656(an)S
(ATA)126 1782 A
(device;)294 1950 A
2286(no)S
(translations,)546 2412 A
3000(no)S
(special)294 3126 A
(features.)378 3462 A
(Don't)210 3924 A
3690 V
(10481)210 648 A
1404(*)S
(touch)210 1488 A
1740(it)S
(unless)252 1866 A
(the)126 2160 A
(BIOS)168 2328 A
(knows)210 2538 A
(about)210 2790 A
(it.)126 3042 A
3780 V
(10482)210 648 A
1404(*/)S
3870 V
(10483)210 648 A
1362(if)S
(\(wn->lcylinders)630 1488 A
2160(==)S
2286(0\))S
(return\(ERR\);)504 2412 A
3042(/*)S
3168(no)S
(BIOS)168 3294 A
(parameters)420 3504 A
3966(*/)S
3960 V
(10484)210 648 A
(wn->pcylinders)588 1362 A
1992(=)S
(wn->lcylinders;)630 2076 A
4050 V
(10485)210 648 A
(wn->pheads)420 1362 A
1824(=)S
(wn->lheads;)462 1908 A
4140 V
(10486)210 648 A
(wn->psectors)504 1362 A
1908(=)S
(wn->lsectors;)546 1992 A
4230 V
(10487)210 648 A
(size)168 1362 A
1572(=)S
(\(u32_t\))294 1656 A
(wn->pcylinders)588 1992 A
2622(*)S
(wn->pheads)420 2706 A
3168(*)S
(wn->psectors;)546 3252 A
4320 V
(10488)210 648 A
1110(})S
4410 V
(10489)210 648 A
1110(/*)S
(The)126 1236 A
(fun)126 1404 A
(ends)168 1572 A
1782(at)S
1908(4)S
(GB.)126 1992 A
2160(*/)S
4500 V
(10490)210 648 A
1110(if)S
(\(size)210 1236 A
1488(>)S
(\(\(u32_t\))336 1572 A
(-1\))126 1950 A
2118(/)S
(SECTOR_SIZE\))504 2202 A
(size)168 2748 A
2958(=)S
(\(\(u32_t\))336 3042 A
(-1\))126 3420 A
3588(/)S
(SECTOR_SIZE;)504 3672 A
4590 V
(10491)210 648 A
4680 V
(10492)210 648 A
1110(/*)S
(Base)168 1236 A
(and)126 1446 A
(size)168 1614 A
1824(of)S
(the)126 1950 A
(whole)210 2118 A
(drive)210 2370 A
2622(*/)S
4770 V
(10493)210 648 A
(wn->part[0].dv_base)798 1110 A
1950(=)S
2034(0;)S
4860 V
(10494)210 648 A
(wn->part[0].dv_size)798 1110 A
1950(=)S
(size)168 2034 A
2244(<<)S
(SECTOR_SHIFT;)546 2370 A
4950 V
(10495)210 648 A
5040 V
(10496)210 648 A
1110(if)S
(\(w_specify\(\))504 1236 A
1782(!=)S
1908(OK)S
2034(&&)S
(w_specify\(\))462 2160 A
2664(!=)S
(OK\))126 2790 A
(return\(ERR\);)504 2958 A
5130 V
(10497)210 648 A
5220 V
(10498)210 648 A
(printf\("%s:)462 1110 A
1614(",)S
(w_name\(\)\);)420 1740 A
5310 V
(10499)210 648 A
1110(if)S
(\(wn->state)420 1236 A
1698(&)S
(SMART\))252 1782 A
2076({)S
5400 V
(10500)210 648 A
(printf\("%.40s\\n",)714 1362 A
(id_string\);)462 2118 A
5490 V
(10501)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5580 V
(10502)210 648 A
(printf\("%ux%ux%u\\n",)840 1362 A
(wn->pcylinders,)630 2244 A
(wn->pheads,)462 2916 A
(wn->psectors\);)588 3420 A
5670 V
(10503)210 648 A
1110(})S
5760 V
(10504)210 648 A
(return\(OK\);)462 1110 A
5850 V
(10505)210 648 A
1026(})S
6120 V
(10508)210 648 A
(/*===========================================================================*)3276 1026 A
6210 V
(10509)210 648 A
1068(*)S
(w_name)252 2370 A
4260(*)S
8418 V
EP
%%Page: 136 136
BP
/slant 0 def
/height 0 def
630 V
12 B
(136)180 648 A
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(10510)210 648 A
(*===========================================================================*/)3276 1068 A
990 V
(10511)210 648 A
(PRIVATE)294 1026 A
(char)168 1362 A
(*w_name\(\))378 1572 A
1080 V
(10512)210 648 A
1026({)S
1170 V
(10513)210 648 A
1026(/*)S
(Return)252 1152 A
1446(a)S
(name)168 1530 A
(for)126 1740 A
(the)126 1908 A
(current)294 2076 A
(device.)294 2412 A
2748(*/)S
1260 V
(10514)210 648 A
(static)252 1110 A
(char)168 1404 A
(name[])252 1614 A
1908(=)S
("at-hd15";)420 1992 A
1350 V
(10515)210 648 A
(unsigned)336 1110 A
(device)252 1488 A
1782(=)S
(w_drive)294 1866 A
2202(*)S
(DEV_PER_DRIVE;)588 2286 A
1440 V
(10516)210 648 A
1530 V
(10517)210 648 A
1110(if)S
(\(device)294 1236 A
1572(<)S
(10\))126 1656 A
1824({)S
1620 V
(10518)210 648 A
(name[5])294 1362 A
1698(=)S
('0')126 1782 A
1950(+)S
(device;)294 2034 A
1710 V
(10519)210 648 A
(name[6])294 1362 A
1698(=)S
1782(0;)S
1800 V
(10520)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1890 V
(10521)210 648 A
(name[5])294 1362 A
1698(=)S
('0')126 1782 A
1950(+)S
(device)252 2034 A
2328(/)S
(10;)126 2412 A
1980 V
(10522)210 648 A
(name[6])294 1362 A
1698(=)S
('0')126 1782 A
1950(+)S
(device)252 2034 A
2328(%)S
(10;)126 2412 A
2070 V
(10523)210 648 A
1110(})S
2160 V
(10524)210 648 A
(return)252 1110 A
(name;)210 1404 A
2250 V
(10525)210 648 A
1026(})S
2520 V
(10528)210 648 A
(/*===========================================================================*)3276 1026 A
2610 V
(10529)210 648 A
1068(*)S
(w_specify)378 2370 A
4260(*)S
2700 V
(10530)210 648 A
(*===========================================================================*/)3276 1068 A
2790 V
(10531)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_specify\(\))462 1530 A
2880 V
(10532)210 648 A
1026({)S
2970 V
(10533)210 648 A
1026(/*)S
(Routine)294 1152 A
1488(to)S
(initialize)420 1614 A
(the)126 2076 A
(drive)210 2244 A
(after)210 2496 A
(boot)168 2748 A
2958(or)S
(when)168 3084 A
3294(a)S
(reset)210 3378 A
3630(is)S
(needed.)294 3756 A
4092(*/)S
3060 V
(10534)210 648 A
3150 V
(10535)210 648 A
(struct)252 1110 A
(wini)168 1404 A
(*wn)126 1614 A
1782(=)S
(w_wn;)210 1866 A
3240 V
(10536)210 648 A
(struct)252 1110 A
(command)294 1404 A
(cmd;)168 1740 A
3330 V
(10537)210 648 A
3420 V
(10538)210 648 A
1110(if)S
(\(\(wn->state)462 1236 A
1740(&)S
(DEAF\))210 1824 A
2076(&&)S
(w_reset\(\))378 2202 A
2622(!=)S
(OK\))126 2748 A
(return\(ERR\);)504 2916 A
3510 V
(10539)210 648 A
3600 V
(10540)210 648 A
1110(/*)S
(Specify)294 1236 A
(parameters:)462 1572 A
(precompensation,)672 2076 A
(number)252 2790 A
3084(of)S
(heads)210 3210 A
(and)126 3462 A
(sectors.)336 3630 A
4008(*/)S
3690 V
(10541)210 648 A
(cmd.precomp)462 1110 A
1614(=)S
(wn->precomp;)504 1698 A
3780 V
(10542)210 648 A
(cmd.count)378 1110 A
1614(=)S
(wn->psectors;)546 1698 A
3870 V
(10543)210 648 A
(cmd.ldh)294 1110 A
1614(=)S
(w_wn->ldhpref)546 1698 A
2286(|)S
(\(wn->pheads)462 2370 A
2874(-)S
(1\);)126 2958 A
3960 V
(10544)210 648 A
(cmd.command)462 1110 A
1614(=)S
(CMD_SPECIFY;)504 1698 A
2706(/*)S
(Specify)294 2832 A
(some)168 3168 A
(parameters)420 3378 A
3840(*/)S
4050 V
(10545)210 648 A
4140 V
(10546)210 648 A
1110(if)S
(\(com_simple\(&cmd\))714 1236 A
1992(!=)S
(OK\))126 2118 A
(return\(ERR\);)504 2286 A
4230 V
(10547)210 648 A
4320 V
(10548)210 648 A
1110(if)S
(\(!\(wn->state)504 1236 A
1782(&)S
(SMART\)\))294 1866 A
2202({)S
4410 V
(10549)210 648 A
1362(/*)S
(Calibrate)378 1488 A
1908(an)S
(old)126 2034 A
(disk.)210 2202 A
2454(*/)S
4500 V
(10550)210 648 A
(cmd.sector)420 1362 A
1866(=)S
1950(0;)S
4590 V
(10551)210 648 A
(cmd.cyl_lo)420 1362 A
1866(=)S
1950(0;)S
4680 V
(10552)210 648 A
(cmd.cyl_hi)420 1362 A
1866(=)S
1950(0;)S
4770 V
(10553)210 648 A
(cmd.ldh)294 1362 A
1866(=)S
(w_wn->ldhpref;)588 1950 A
4860 V
(10554)210 648 A
(cmd.command)462 1362 A
1866(=)S
(CMD_RECALIBRATE;)672 1950 A
4950 V
(10555)210 648 A
5040 V
(10556)210 648 A
1362(if)S
(\(com_simple\(&cmd\))714 1488 A
2244(!=)S
(OK\))126 2370 A
(return\(ERR\);)504 2538 A
5130 V
(10557)210 648 A
1110(})S
5220 V
(10558)210 648 A
5310 V
(10559)210 648 A
(wn->state)378 1110 A
1530(|=)S
(INITIALIZED;)504 1656 A
5400 V
(10560)210 648 A
(return\(OK\);)462 1110 A
5490 V
(10561)210 648 A
1026(})S
5760 V
(10564)210 648 A
(/*===========================================================================*)3276 1026 A
5850 V
(10565)210 648 A
1068(*)S
(w_schedule)420 2370 A
4260(*)S
5940 V
(10566)210 648 A
(*===========================================================================*/)3276 1068 A
6030 V
(10567)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_schedule\(proc_nr,)798 1530 A
(iop\))168 2370 A
6120 V
(10568)210 648 A
(int)126 1026 A
(proc_nr;)336 1194 A
2370(/*)S
(process)294 2496 A
(doing)210 2832 A
(the)126 3084 A
(request)294 3252 A
3588(*/)S
6210 V
(10569)210 648 A
(struct)252 1026 A
(iorequest_s)462 1320 A
(*iop;)210 1824 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(read)168 2958 A
3168(or)S
(write)210 3294 A
(request)294 3546 A
3882(*/)S
8418 V
EP
%%Page: 137 137
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
12 B
(137)180 4248 A
900 V
7 LST
(10570)210 648 A
1026({)S
990 V
(10571)210 648 A
1026(/*)S
(Gather)252 1152 A
(I/O)126 1446 A
(requests)336 1614 A
1992(on)S
(consecutive)462 2118 A
(blocks)252 2622 A
2916(so)S
(they)168 3042 A
(may)126 3252 A
3420(be)S
(read/written)504 3546 A
1080 V
(10572)210 648 A
1068(*)S
1152(in)S
(one)126 1278 A
(controller)420 1446 A
(command.)336 1908 A
(\(There)252 2328 A
2622(is)S
(enough)252 2748 A
(time)168 3042 A
3252(to)S
(compute)294 3378 A
(the)126 3714 A
(next)168 3882 A
1170 V
(10573)210 648 A
1068(*)S
(consecutive)462 1152 A
(request)294 1656 A
(while)210 1992 A
2244(an)S
(unwanted)336 2370 A
(block)210 2748 A
(passes)252 3000 A
(by.\))168 3294 A
1260 V
(10574)210 648 A
1068(*/)S
1350 V
(10575)210 648 A
(struct)252 1110 A
(wini)168 1404 A
(*wn)126 1614 A
1782(=)S
(w_wn;)210 1866 A
1440 V
(10576)210 648 A
(int)126 1110 A
1278(r,)S
(opcode;)294 1404 A
1530 V
(10577)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(pos;)168 1698 A
1620 V
(10578)210 648 A
(unsigned)336 1110 A
(nbytes,)294 1488 A
(count;)252 1824 A
1710 V
(10579)210 648 A
(unsigned)336 1110 A
(long)168 1488 A
(block;)252 1698 A
1800 V
(10580)210 648 A
(phys_bytes)420 1110 A
(user_phys;)420 1572 A
1890 V
(10581)210 648 A
1980 V
(10582)210 648 A
1110(/*)S
(This)168 1236 A
(many)168 1446 A
(bytes)210 1656 A
1908(to)S
(read/write)420 2034 A
2496(*/)S
2070 V
(10583)210 648 A
(nbytes)252 1110 A
1404(=)S
(iop->io_nbytes;)630 1488 A
2160 V
(10584)210 648 A
1110(if)S
(\(\(nbytes)336 1236 A
1614(&)S
(SECTOR_MASK\))504 1698 A
2244(!=)S
2370(0\))S
(return\(iop->io_nbytes)882 2496 A
3420(=)S
(EINVAL\);)336 3504 A
2250 V
(10585)210 648 A
2340 V
(10586)210 648 A
1110(/*)S
(From/to)294 1236 A
(this)168 1572 A
(position)336 1782 A
2160(on)S
(the)126 2286 A
(device)252 2454 A
2748(*/)S
2430 V
(10587)210 648 A
(pos)126 1110 A
1278(=)S
(iop->io_position;)714 1362 A
2520 V
(10588)210 648 A
1110(if)S
(\(\(pos)210 1236 A
1488(&)S
(SECTOR_MASK\))504 1572 A
2118(!=)S
2244(0\))S
(return\(iop->io_nbytes)882 2370 A
3294(=)S
(EINVAL\);)336 3378 A
2610 V
(10589)210 648 A
2700 V
(10590)210 648 A
1110(/*)S
(To/from)294 1236 A
(this)168 1572 A
(user)168 1782 A
(address)294 1992 A
2328(*/)S
2790 V
(10591)210 648 A
(user_phys)378 1110 A
1530(=)S
(numap\(proc_nr,)588 1614 A
(\(vir_bytes\))462 2244 A
(iop->io_buf,)504 2748 A
(nbytes\);)336 3294 A
2880 V
(10592)210 648 A
1110(if)S
(\(user_phys)420 1236 A
1698(==)S
1824(0\))S
(return\(iop->io_nbytes)882 1950 A
2874(=)S
(EINVAL\);)336 2958 A
2970 V
(10593)210 648 A
3060 V
(10594)210 648 A
1110(/*)S
(Read)168 1236 A
1446(or)S
(write?)252 1572 A
1866(*/)S
3150 V
(10595)210 648 A
(opcode)252 1110 A
1404(=)S
(iop->io_request)630 1488 A
2160(&)S
(\304OPTIONAL_IO;)546 2244 A
3240 V
(10596)210 648 A
3330 V
(10597)210 648 A
1110(/*)S
(Which)210 1236 A
(block)210 1488 A
1740(on)S
(disk)168 1866 A
(and)126 2076 A
(how)126 2244 A
(close)210 2412 A
2664(to)S
(EOF?)168 2790 A
3000(*/)S
3420 V
(10598)210 648 A
1110(if)S
(\(pos)168 1236 A
1446(>=)S
(w_dv->dv_size\))588 1572 A
(return\(OK\);)462 2202 A
3042(/*)S
3168(At)S
(EOF)126 3294 A
3462(*/)S
3510 V
(10599)210 648 A
1110(if)S
(\(pos)168 1236 A
1446(+)S
(nbytes)252 1530 A
1824(>)S
(w_dv->dv_size\))588 1908 A
(nbytes)252 2538 A
2832(=)S
(w_dv->dv_size)546 2916 A
3504(-)S
(pos;)168 3588 A
3600 V
(10600)210 648 A
(block)210 1110 A
1362(=)S
(\(w_dv->dv_base)588 1446 A
2076(+)S
(pos\))168 2160 A
2370(>>)S
(SECTOR_SHIFT;)546 2496 A
3690 V
(10601)210 648 A
3780 V
(10602)210 648 A
1110(if)S
(\(w_count)336 1236 A
1614(>)S
1698(0)S
1782(&&)S
(block)210 1908 A
2160(!=)S
(w_nextblock\))504 2286 A
2832({)S
3870 V
(10603)210 648 A
1362(/*)S
(This)168 1488 A
(new)126 1698 A
(request)294 1866 A
(can't)210 2202 A
2454(be)S
(chained)294 2580 A
2916(to)S
(the)126 3042 A
(job)126 3210 A
(being)210 3378 A
(built)210 3630 A
3882(*/)S
3960 V
(10604)210 648 A
1362(if)S
(\(\(r)126 1488 A
1656(=)S
(w_finish\(\)\))462 1740 A
2244(!=)S
(OK\))126 2370 A
(return\(r\);)420 2538 A
4050 V
(10605)210 648 A
1110(})S
4140 V
(10606)210 648 A
4230 V
(10607)210 648 A
1110(/*)S
(The)126 1236 A
(next)168 1404 A
(consecutive)462 1614 A
(block)210 2118 A
2370(*/)S
4320 V
(10608)210 648 A
(w_nextblock)462 1110 A
1614(=)S
(block)210 1698 A
1950(+)S
(\(nbytes)294 2034 A
2370(>>)S
(SECTOR_SHIFT\);)588 2496 A
4410 V
(10609)210 648 A
4500 V
(10610)210 648 A
1110(/*)S
(While)210 1236 A
(there)210 1488 A
(are)126 1740 A
("unscheduled")546 1908 A
(bytes)210 2496 A
2748(in)S
(the)126 2874 A
(request:)336 3042 A
3420(*/)S
4590 V
(10611)210 648 A
1110(do)S
1236({)S
4680 V
(10612)210 648 A
(count)210 1362 A
1614(=)S
(nbytes;)294 1698 A
4770 V
(10613)210 648 A
4860 V
(10614)210 648 A
1362(if)S
(\(w_count)336 1488 A
1866(==)S
(wn->max_count\))588 1992 A
2622({)S
4950 V
(10615)210 648 A
1698(/*)S
(The)126 1824 A
(drive)210 1992 A
(can't)210 2244 A
2496(do)S
(more)168 2622 A
(then)168 2832 A
(max_count)378 3042 A
3462(at)S
(once)168 3588 A
3798(*/)S
5040 V
(10616)210 648 A
1698(if)S
(\(\(r)126 1824 A
1992(=)S
(w_finish\(\)\))462 2076 A
2580(!=)S
(OK\))126 2706 A
(return\(r\);)420 2874 A
5130 V
(10617)210 648 A
1362(})S
5220 V
(10618)210 648 A
5310 V
(10619)210 648 A
1362(if)S
(\(w_count)336 1488 A
1866(+)S
(count)210 1950 A
2202(>)S
(wn->max_count\))588 2286 A
5400 V
(10620)210 648 A
(count)210 1698 A
1950(=)S
(wn->max_count)546 2034 A
2622(-)S
(w_count;)336 2706 A
5490 V
(10621)210 648 A
5580 V
(10622)210 648 A
1362(if)S
(\(w_count)336 1488 A
1866(==)S
1992(0\))S
2118({)S
5670 V
(10623)210 648 A
1698(/*)S
(The)126 1824 A
(first)210 1992 A
(request)294 2244 A
2580(in)S
2706(a)S
(row,)168 2790 A
(initialize.)462 3000 A
3504(*/)S
5760 V
(10624)210 648 A
(w_opcode)336 1698 A
2076(=)S
(opcode;)294 2160 A
5850 V
(10625)210 648 A
(w_tp)168 1698 A
1908(=)S
(wtrans;)294 1992 A
5940 V
(10626)210 648 A
1362(})S
6030 V
(10627)210 648 A
6120 V
(10628)210 648 A
1362(/*)S
(Store)210 1488 A
(I/O)126 1740 A
(parameters)420 1908 A
2370(*/)S
6210 V
(10629)210 648 A
(w_tp->iop)378 1362 A
1782(=)S
(iop;)168 1866 A
8418 V
EP
%%Page: 138 138
BP
/slant 0 def
/height 0 def
630 V
12 B
(138)180 648 A
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(10630)210 648 A
(w_tp->block)462 1362 A
1866(=)S
(block;)252 1950 A
990 V
(10631)210 648 A
(w_tp->count)462 1362 A
1866(=)S
(count;)252 1950 A
1080 V
(10632)210 648 A
(w_tp->phys)420 1362 A
1824(=)S
(user_phys;)420 1908 A
1170 V
(10633)210 648 A
1260 V
(10634)210 648 A
1362(/*)S
(Update)252 1488 A
(counters)336 1782 A
2160(*/)S
1350 V
(10635)210 648 A
(w_tp++;)294 1362 A
1440 V
(10636)210 648 A
(w_count)294 1362 A
1698(+=)S
(count;)252 1824 A
1530 V
(10637)210 648 A
(block)210 1362 A
1614(+=)S
(count)210 1740 A
1992(>>)S
(SECTOR_SHIFT;)546 2118 A
1620 V
(10638)210 648 A
(user_phys)378 1362 A
1782(+=)S
(count;)252 1908 A
1710 V
(10639)210 648 A
(nbytes)252 1362 A
1656(-=)S
(count;)252 1782 A
1800 V
(10640)210 648 A
1110(})S
(while)210 1194 A
(\(nbytes)294 1446 A
1782(>)S
(0\);)126 1866 A
1890 V
(10641)210 648 A
1980 V
(10642)210 648 A
(return\(OK\);)462 1110 A
2070 V
(10643)210 648 A
1026(})S
2340 V
(10646)210 648 A
(/*===========================================================================*)3276 1026 A
2430 V
(10647)210 648 A
1068(*)S
(w_finish)336 2370 A
4260(*)S
2520 V
(10648)210 648 A
(*===========================================================================*/)3276 1068 A
2610 V
(10649)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_finish\(\))420 1530 A
2700 V
(10650)210 648 A
1026({)S
2790 V
(10651)210 648 A
1026(/*)S
(Carry)210 1152 A
(out)126 1404 A
(the)126 1572 A
(I/O)126 1740 A
(requests)336 1908 A
(gathered)336 2286 A
2664(in)S
(wtrans[].)378 2790 A
3210(*/)S
2880 V
(10652)210 648 A
2970 V
(10653)210 648 A
(struct)252 1110 A
(trans)210 1404 A
(*tp)126 1656 A
1824(=)S
(wtrans;)294 1908 A
3060 V
(10654)210 648 A
(struct)252 1110 A
(wini)168 1404 A
(*wn)126 1614 A
1782(=)S
(w_wn;)210 1866 A
3150 V
(10655)210 648 A
(int)126 1110 A
1278(r,)S
(errors;)294 1404 A
3240 V
(10656)210 648 A
(struct)252 1110 A
(command)294 1404 A
(cmd;)168 1740 A
3330 V
(10657)210 648 A
(unsigned)336 1110 A
(cylinder,)378 1488 A
(head,)210 1908 A
(sector,)294 2160 A
(secspcyl;)378 2496 A
3420 V
(10658)210 648 A
3510 V
(10659)210 648 A
1110(if)S
(\(w_count)336 1236 A
1614(==)S
1740(0\))S
(return\(OK\);)462 1866 A
2370(/*)S
(Spurious)336 2496 A
(finish.)294 2874 A
3210(*/)S
3600 V
(10660)210 648 A
3690 V
(10661)210 648 A
1110(r)S
1194(=)S
(ERR;)168 1278 A
1698(/*)S
(Trigger)294 1824 A
(the)126 2160 A
(first)210 2328 A
(com_out)294 2580 A
2916(*/)S
3780 V
(10662)210 648 A
(errors)252 1110 A
1404(=)S
1488(0;)S
3870 V
(10663)210 648 A
3960 V
(10664)210 648 A
1110(do)S
1236({)S
4050 V
(10665)210 648 A
1362(if)S
1488(\(r)S
1614(!=)S
(OK\))126 1740 A
1908({)S
4140 V
(10666)210 648 A
1698(/*)S
(The)126 1824 A
(controller)420 1992 A
(must)168 2454 A
2664(be)S
(\(re\)programmed.)630 2790 A
3462(*/)S
4230 V
(10667)210 648 A
4320 V
(10668)210 648 A
1698(/*)S
(First)210 1824 A
(check)210 2076 A
2328(to)S
(see)126 2454 A
2622(if)S
2748(a)S
(reinitialization)672 2832 A
3546(is)S
(needed.)294 3672 A
4008(*/)S
4410 V
(10669)210 648 A
1698(if)S
(\(!\(wn->state)504 1824 A
2370(&)S
(INITIALIZED\))504 2454 A
3000(&&)S
(w_specify\(\))462 3126 A
3630(!=)S
(OK\))126 3756 A
4500 V
(10670)210 648 A
(return\(tp->iop->io_nbytes)1050 2034 A
3126(=)S
(EIO\);)210 3210 A
4590 V
(10671)210 648 A
4680 V
(10672)210 648 A
1698(/*)S
(Tell)168 1824 A
(the)126 2034 A
(controller)420 2202 A
2664(to)S
(transfer)336 2790 A
(w_count)294 3168 A
(bytes)210 3504 A
3756(*/)S
4770 V
(10673)210 648 A
(cmd.precomp)462 1698 A
2202(=)S
(wn->precomp;)504 2286 A
4860 V
(10674)210 648 A
(cmd.count)378 1698 A
2202(=)S
(\(w_count)336 2286 A
2664(>>)S
(SECTOR_SHIFT\))546 2790 A
3378(&)S
(BYTE;)210 3462 A
4950 V
(10675)210 648 A
1698(if)S
(\(wn->ldhpref)504 1824 A
2370(&)S
(LDH_LBA\))336 2454 A
2832({)S
5040 V
(10676)210 648 A
(cmd.sector)420 2034 A
2538(=)S
(\(tp->block)420 2622 A
3084(>>)S
3252(0\))S
3378(&)S
(0xFF;)210 3462 A
5130 V
(10677)210 648 A
(cmd.cyl_lo)420 2034 A
2538(=)S
(\(tp->block)420 2622 A
3084(>>)S
3252(8\))S
3378(&)S
(0xFF;)210 3462 A
5220 V
(10678)210 648 A
(cmd.cyl_hi)420 2034 A
2538(=)S
(\(tp->block)420 2622 A
3084(>>)S
(16\))126 3210 A
3378(&)S
(0xFF;)210 3462 A
5310 V
(10679)210 648 A
(cmd.ldh)294 2034 A
2538(=)S
(wn->ldhpref)462 2622 A
3126(|)S
(\(\(tp->block)462 3210 A
3714(>>)S
(24\))126 3840 A
4008(&)S
(0xF\);)210 4092 A
5400 V
(10680)210 648 A
1698(})S
(else)168 1782 A
1992({)S
5490 V
(10681)210 648 A
(secspcyl)336 2034 A
2412(=)S
(wn->pheads)420 2496 A
2958(*)S
(wn->psectors;)546 3042 A
5580 V
(10682)210 648 A
(cylinder)336 2034 A
2412(=)S
(tp->block)378 2496 A
2916(/)S
(secspcyl;)378 3000 A
5670 V
(10683)210 648 A
(head)168 2034 A
2244(=)S
(\(tp->block)420 2328 A
2790(%)S
(secspcyl\))378 2874 A
3294(/)S
(wn->psectors;)546 3378 A
5760 V
(10684)210 648 A
(sector)252 2034 A
2328(=)S
(tp->block)378 2412 A
2832(%)S
(wn->psectors;)546 2916 A
5850 V
(10685)210 648 A
(cmd.sector)420 2034 A
2538(=)S
(sector)252 2622 A
2916(+)S
3000(1;)S
5940 V
(10686)210 648 A
(cmd.cyl_lo)420 2034 A
2538(=)S
(cylinder)336 2622 A
3000(&)S
(BYTE;)210 3084 A
6030 V
(10687)210 648 A
(cmd.cyl_hi)420 2034 A
2538(=)S
(\(cylinder)378 2622 A
3042(>>)S
3168(8\))S
3294(&)S
(BYTE;)210 3378 A
6120 V
(10688)210 648 A
(cmd.ldh)294 2034 A
2538(=)S
(wn->ldhpref)462 2622 A
3126(|)S
(head;)210 3210 A
6210 V
(10689)210 648 A
1698(})S
8418 V
EP
%%Page: 139 139
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
12 B
(139)180 4248 A
900 V
7 LST
(10690)210 648 A
(cmd.command)462 1698 A
2202(=)S
(w_opcode)336 2286 A
2664(==)S
(DEV_WRITE)378 2790 A
3210(?)S
(CMD_WRITE)378 3294 A
3714(:)S
(CMD_READ;)378 3798 A
990 V
(10691)210 648 A
1080 V
(10692)210 648 A
1698(if)S
(\(\(r)126 1824 A
1992(=)S
(com_out\(&cmd\)\))588 2076 A
2706(!=)S
(OK\))126 2832 A
3000({)S
1170 V
(10693)210 648 A
2034(if)S
(\(++errors)378 2160 A
2580(==)S
(MAX_ERRORS\))462 2706 A
3210({)S
1260 V
(10694)210 648 A
(w_command)378 2370 A
2790(=)S
(CMD_IDLE;)378 2874 A
1350 V
(10695)210 648 A
(return\(tp->iop->io_nbytes)1050 2370 A
3462(=)S
(EIO\);)210 3546 A
1440 V
(10696)210 648 A
2034(})S
1530 V
(10697)210 648 A
(continue;)378 2034 A
2706(/*)S
(Retry)210 2832 A
3084(*/)S
1620 V
(10698)210 648 A
1698(})S
1710 V
(10699)210 648 A
1362(})S
1800 V
(10700)210 648 A
1890 V
(10701)210 648 A
1362(/*)S
(For)126 1488 A
(each)168 1656 A
(sector,)294 1866 A
(wait)168 2202 A
(for)126 2412 A
2580(an)S
(interrupt)378 2706 A
(and)126 3126 A
(fetch)210 3294 A
(the)126 3546 A
(data)168 3714 A
(\(read\),)294 3924 A
1980 V
(10702)210 648 A
1404(*)S
1488(or)S
(supply)252 1614 A
(data)168 1908 A
2118(to)S
(the)126 2244 A
(controller)420 2412 A
(and)126 2874 A
(wait)168 3042 A
(for)126 3252 A
3420(an)S
(interrupt)378 3546 A
(\(write\).)336 3966 A
2070 V
(10703)210 648 A
1404(*/)S
2160 V
(10704)210 648 A
2250 V
(10705)210 648 A
1362(if)S
(\(w_opcode)378 1488 A
1908(==)S
(DEV_READ\))378 2034 A
2454({)S
2340 V
(10706)210 648 A
1698(if)S
(\(\(r)126 1824 A
1992(=)S
(w_intr_wait\(\)\))588 2076 A
2706(==)S
(OK\))126 2832 A
3000({)S
2430 V
(10707)210 648 A
2034(/*)S
(Copy)168 2160 A
(data)168 2370 A
(from)168 2580 A
(the)126 2790 A
(device's)336 2958 A
(buffer)252 3336 A
3630(to)S
(user)168 3756 A
(space.)252 3966 A
4260(*/)S
2520 V
(10708)210 648 A
2610 V
(10709)210 648 A
(port_read\(wn->base)756 2034 A
2832(+)S
(REG_DATA,)378 2916 A
(tp->phys,)378 3336 A
(SECTOR_SIZE\);)546 3756 A
2700 V
(10710)210 648 A
2790 V
(10711)210 648 A
(tp->phys)336 2034 A
2412(+=)S
(SECTOR_SIZE;)504 2538 A
2880 V
(10712)210 648 A
(tp->iop->io_nbytes)756 2034 A
2832(-=)S
(SECTOR_SIZE;)504 2958 A
2970 V
(10713)210 648 A
(w_count)294 2034 A
2370(-=)S
(SECTOR_SIZE;)504 2496 A
3060 V
(10714)210 648 A
2034(if)S
(\(\(tp->count)462 2160 A
2664(-=)S
(SECTOR_SIZE\))504 2790 A
3336(==)S
3462(0\))S
(tp++;)210 3588 A
3150 V
(10715)210 648 A
1698(})S
(else)168 1782 A
1992({)S
3240 V
(10716)210 648 A
2034(/*)S
(Any)126 2160 A
(faulty)252 2328 A
(data?)210 2622 A
2874(*/)S
3330 V
(10717)210 648 A
2034(if)S
(\(w_status)378 2160 A
2580(&)S
(STATUS_DRQ\))462 2664 A
3168({)S
3420 V
(10718)210 648 A
(port_read\(wn->base)756 2370 A
3168(+)S
(REG_DATA,)378 3252 A
(tmp_phys,)378 3672 A
3510 V
(10719)210 648 A
(SECTOR_SIZE\);)546 3714 A
3600 V
(10720)210 648 A
2034(})S
3690 V
(10721)210 648 A
1698(})S
3780 V
(10722)210 648 A
1362(})S
(else)168 1446 A
1656({)S
3870 V
(10723)210 648 A
1698(/*)S
(Wait)168 1824 A
(for)126 2034 A
(data)168 2202 A
(requested.)420 2412 A
2874(*/)S
3960 V
(10724)210 648 A
1698(if)S
(\(!waitfor\(STATUS_DRQ,)882 1824 A
(STATUS_DRQ\)\))504 2748 A
3294({)S
4050 V
(10725)210 648 A
2034(r)S
2118(=)S
(ERR;)168 2202 A
4140 V
(10726)210 648 A
1698(})S
(else)168 1782 A
1992({)S
4230 V
(10727)210 648 A
2034(/*)S
(Fill)168 2160 A
(the)126 2370 A
(buffer)252 2538 A
2832(of)S
(the)126 2958 A
(drive.)252 3126 A
3420(*/)S
4320 V
(10728)210 648 A
4410 V
(10729)210 648 A
(port_write\(wn->base)798 2034 A
2874(+)S
(REG_DATA,)378 2958 A
(tp->phys,)378 3378 A
(SECTOR_SIZE\);)546 3798 A
4500 V
(10730)210 648 A
2034(r)S
2118(=)S
(w_intr_wait\(\);)588 2202 A
4590 V
(10731)210 648 A
1698(})S
4680 V
(10732)210 648 A
4770 V
(10733)210 648 A
1698(if)S
1824(\(r)S
1950(==)S
(OK\))126 2076 A
2244({)S
4860 V
(10734)210 648 A
2034(/*)S
(Book)168 2160 A
(the)126 2370 A
(bytes)210 2538 A
(successfully)504 2790 A
(written.)336 3336 A
3714(*/)S
4950 V
(10735)210 648 A
5040 V
(10736)210 648 A
(tp->phys)336 2034 A
2412(+=)S
(SECTOR_SIZE;)504 2538 A
5130 V
(10737)210 648 A
(tp->iop->io_nbytes)756 2034 A
2832(-=)S
(SECTOR_SIZE;)504 2958 A
5220 V
(10738)210 648 A
(w_count)294 2034 A
2370(-=)S
(SECTOR_SIZE;)504 2496 A
5310 V
(10739)210 648 A
2034(if)S
(\(\(tp->count)462 2160 A
2664(-=)S
(SECTOR_SIZE\))504 2790 A
3336(==)S
3462(0\))S
(tp++;)210 3588 A
5400 V
(10740)210 648 A
1698(})S
5490 V
(10741)210 648 A
1362(})S
5580 V
(10742)210 648 A
5670 V
(10743)210 648 A
1362(if)S
1488(\(r)S
1614(!=)S
(OK\))126 1740 A
1908({)S
5760 V
(10744)210 648 A
1698(/*)S
(Don't)210 1824 A
(retry)210 2076 A
2328(if)S
(sector)252 2454 A
(marked)252 2748 A
(bad)126 3042 A
3210(or)S
(too)126 3336 A
(many)168 3504 A
(errors)252 3714 A
4008(*/)S
5850 V
(10745)210 648 A
1698(if)S
1824(\(r)S
1950(==)S
(ERR_BAD_SECTOR)588 2076 A
2706(||)S
(++errors)336 2832 A
3210(==)S
(MAX_ERRORS\))462 3336 A
3840({)S
5940 V
(10746)210 648 A
(w_command)378 2034 A
2454(=)S
(CMD_IDLE;)378 2538 A
6030 V
(10747)210 648 A
(return\(tp->iop->io_nbytes)1050 2034 A
3126(=)S
(EIO\);)210 3210 A
6120 V
(10748)210 648 A
1698(})S
6210 V
(10749)210 648 A
8418 V
EP
%%Page: 140 140
BP
/slant 0 def
/height 0 def
630 V
12 B
(140)180 648 A
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(10750)210 648 A
1698(/*)S
(Reset)210 1824 A
2076(if)S
(halfway,)336 2202 A
(but)126 2580 A
(bail)168 2748 A
(out)126 2958 A
3126(if)S
(optional)336 3252 A
(I/O.)168 3630 A
3840(*/)S
990 V
(10751)210 648 A
1698(if)S
(\(errors)294 1824 A
2160(==)S
(MAX_ERRORS)420 2286 A
2748(/)S
2832(2\))S
2958({)S
1080 V
(10752)210 648 A
(w_need_reset\(\);)630 2034 A
1170 V
(10753)210 648 A
2034(if)S
(\(tp->iop->io_request)840 2160 A
3042(&)S
(OPTIONAL_IO\))504 3126 A
3672({)S
1260 V
(10754)210 648 A
(w_command)378 2370 A
2790(=)S
(CMD_IDLE;)378 2874 A
1350 V
(10755)210 648 A
(return\(tp->iop->io_nbytes)1050 2370 A
3462(=)S
(EIO\);)210 3546 A
1440 V
(10756)210 648 A
2034(})S
1530 V
(10757)210 648 A
1698(})S
1620 V
(10758)210 648 A
(continue;)378 1698 A
2370(/*)S
(Retry)210 2496 A
2748(*/)S
1710 V
(10759)210 648 A
1362(})S
1800 V
(10760)210 648 A
(errors)252 1362 A
1656(=)S
1740(0;)S
1890 V
(10761)210 648 A
1110(})S
(while)210 1194 A
(\(w_count)336 1446 A
1824(>)S
(0\);)126 1908 A
1980 V
(10762)210 648 A
2070 V
(10763)210 648 A
(w_command)378 1110 A
1530(=)S
(CMD_IDLE;)378 1614 A
2160 V
(10764)210 648 A
(return\(OK\);)462 1110 A
2250 V
(10765)210 648 A
1026(})S
2520 V
(10768)210 648 A
(/*============================================================================*)3318 1026 A
2610 V
(10769)210 648 A
1068(*)S
(com_out)294 2370 A
4302(*)S
2700 V
(10770)210 648 A
(*============================================================================*/)3318 1068 A
2790 V
(10771)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(com_out\(cmd\))504 1530 A
2880 V
(10772)210 648 A
(struct)252 1026 A
(command)294 1320 A
(*cmd;)210 1656 A
2370(/*)S
(Command)294 2496 A
(block)210 2832 A
3084(*/)S
2970 V
(10773)210 648 A
1026({)S
3060 V
(10774)210 648 A
1026(/*)S
(Output)252 1152 A
(the)126 1446 A
(command)294 1614 A
(block)210 1950 A
2202(to)S
(the)126 2328 A
(winchester)420 2496 A
(controller)420 2958 A
(and)126 3420 A
(return)252 3588 A
(status)252 3882 A
4176(*/)S
3150 V
(10775)210 648 A
3240 V
(10776)210 648 A
(struct)252 1110 A
(wini)168 1404 A
(*wn)126 1614 A
1782(=)S
(w_wn;)210 1866 A
3330 V
(10777)210 648 A
(unsigned)336 1110 A
(base)168 1488 A
1698(=)S
(wn->base;)378 1782 A
3420 V
(10778)210 648 A
3510 V
(10779)210 648 A
1110(if)S
(\(!waitfor\(STATUS_BSY,)882 1236 A
(0\)\))126 2160 A
2328({)S
3600 V
(10780)210 648 A
(printf\("%s:)462 1362 A
(controller)420 1866 A
(not)126 2328 A
(ready\\n",)378 2496 A
(w_name\(\)\);)420 2916 A
3690 V
(10781)210 648 A
(return\(ERR\);)504 1362 A
3780 V
(10782)210 648 A
1110(})S
3870 V
(10783)210 648 A
3960 V
(10784)210 648 A
1110(/*)S
(Select)252 1236 A
(drive.)252 1530 A
1824(*/)S
4050 V
(10785)210 648 A
(out_byte\(base)546 1110 A
1698(+)S
(REG_LDH,)336 1782 A
(cmd->ldh\);)420 2160 A
4140 V
(10786)210 648 A
4230 V
(10787)210 648 A
1110(if)S
(\(!waitfor\(STATUS_BSY,)882 1236 A
(0\)\))126 2160 A
2328({)S
4320 V
(10788)210 648 A
(printf\("%s:)462 1362 A
(drive)210 1866 A
(not)126 2118 A
(ready\\n",)378 2286 A
(w_name\(\)\);)420 2706 A
4410 V
(10789)210 648 A
(return\(ERR\);)504 1362 A
4500 V
(10790)210 648 A
1110(})S
4590 V
(10791)210 648 A
4680 V
(10792)210 648 A
1110(/*)S
(Schedule)336 1236 A
1614(a)S
(wakeup)252 1698 A
(call,)210 1992 A
(some)168 2244 A
(controllers)462 2454 A
(are)126 2958 A
(flaky.)252 3126 A
3420(*/)S
4770 V
(10793)210 648 A
(clock_mess\(WAKEUP,)756 1110 A
(w_timeout\);)462 1908 A
4860 V
(10794)210 648 A
4950 V
(10795)210 648 A
(out_byte\(base)546 1110 A
1698(+)S
(REG_CTL,)336 1782 A
(wn->pheads)420 2160 A
2622(>=)S
2748(8)S
2832(?)S
(CTL_EIGHTHEADS)588 2916 A
3546(:)S
(0\);)126 3630 A
5040 V
(10796)210 648 A
(out_byte\(base)546 1110 A
1698(+)S
(REG_PRECOMP,)504 1782 A
(cmd->precomp\);)588 2328 A
5130 V
(10797)210 648 A
(out_byte\(base)546 1110 A
1698(+)S
(REG_COUNT,)420 1782 A
(cmd->count\);)504 2244 A
5220 V
(10798)210 648 A
(out_byte\(base)546 1110 A
1698(+)S
(REG_SECTOR,)462 1782 A
(cmd->sector\);)546 2286 A
5310 V
(10799)210 648 A
(out_byte\(base)546 1110 A
1698(+)S
(REG_CYL_LO,)462 1782 A
(cmd->cyl_lo\);)546 2286 A
5400 V
(10800)210 648 A
(out_byte\(base)546 1110 A
1698(+)S
(REG_CYL_HI,)462 1782 A
(cmd->cyl_hi\);)546 2286 A
5490 V
(10801)210 648 A
(lock\(\);)294 1110 A
5580 V
(10802)210 648 A
(out_byte\(base)546 1110 A
1698(+)S
(REG_COMMAND,)504 1782 A
(cmd->command\);)588 2328 A
5670 V
(10803)210 648 A
(w_command)378 1110 A
1530(=)S
(cmd->command;)546 1614 A
5760 V
(10804)210 648 A
(w_status)336 1110 A
1488(=)S
(STATUS_BSY;)462 1572 A
5850 V
(10805)210 648 A
(unlock\(\);)378 1110 A
5940 V
(10806)210 648 A
(return\(OK\);)462 1110 A
6030 V
(10807)210 648 A
1026(})S
8418 V
EP
%%Page: 141 141
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
12 B
(141)180 4248 A
900 V
7 LST
(10810)210 648 A
(/*===========================================================================*)3276 1026 A
990 V
(10811)210 648 A
1068(*)S
(w_need_reset)504 2370 A
4260(*)S
1080 V
(10812)210 648 A
(*===========================================================================*/)3276 1068 A
1170 V
(10813)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(w_need_reset\(\))588 1572 A
1260 V
(10814)210 648 A
1026({)S
1350 V
(10815)210 648 A
1026(/*)S
(The)126 1152 A
(controller)420 1320 A
(needs)210 1782 A
2034(to)S
2160(be)S
(reset.)252 2286 A
2580(*/)S
1440 V
(10816)210 648 A
(struct)252 1110 A
(wini)168 1404 A
(*wn;)168 1614 A
1530 V
(10817)210 648 A
1620 V
(10818)210 648 A
(for)126 1110 A
(\(wn)126 1278 A
1446(=)S
(wini;)210 1530 A
1782(wn)S
1908(<)S
(&wini[MAX_DRIVES];)756 1992 A
(wn++\))210 2790 A
3042({)S
1710 V
(10819)210 648 A
(wn->state)378 1362 A
1782(|=)S
(DEAF;)210 1908 A
1800 V
(10820)210 648 A
(wn->state)378 1362 A
1782(&=)S
(\304INITIALIZED;)546 1908 A
1890 V
(10821)210 648 A
1110(})S
1980 V
(10822)210 648 A
1026(})S
2250 V
(10825)210 648 A
(/*============================================================================*)3318 1026 A
2340 V
(10826)210 648 A
1068(*)S
(w_do_close)420 2370 A
4302(*)S
2430 V
(10827)210 648 A
(*============================================================================*/)3318 1068 A
2520 V
(10828)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_do_close\(dp,)588 1530 A
(m_ptr\))252 2160 A
2610 V
(10829)210 648 A
(struct)252 1026 A
(driver)252 1320 A
(*dp;)168 1614 A
2700 V
(10830)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2790 V
(10831)210 648 A
1026({)S
2880 V
(10832)210 648 A
1026(/*)S
(Device)252 1152 A
(close:)252 1446 A
(Release)294 1740 A
2076(a)S
(device.)294 2160 A
2496(*/)S
2970 V
(10833)210 648 A
3060 V
(10834)210 648 A
1110(if)S
(\(w_prepare\(m_ptr->DEVICE\))1050 1236 A
2328(==)S
(NIL_DEV\))336 2454 A
(return\(ENXIO\);)588 2832 A
3150 V
(10835)210 648 A
(w_wn->open_ct--;)672 1110 A
3240 V
(10836)210 648 A
(return\(OK\);)462 1110 A
3330 V
(10837)210 648 A
1026(})S
3600 V
(10840)210 648 A
(/*============================================================================*)3318 1026 A
3690 V
(10841)210 648 A
1068(*)S
(com_simple)420 2370 A
4302(*)S
3780 V
(10842)210 648 A
(*============================================================================*/)3318 1068 A
3870 V
(10843)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(com_simple\(cmd\))630 1530 A
3960 V
(10844)210 648 A
(struct)252 1026 A
(command)294 1320 A
(*cmd;)210 1656 A
2370(/*)S
(Command)294 2496 A
(block)210 2832 A
3084(*/)S
4050 V
(10845)210 648 A
1026({)S
4140 V
(10846)210 648 A
1026(/*)S
1152(A)S
(simple)252 1236 A
(controller)420 1530 A
(command,)336 1992 A
(only)168 2370 A
(one)126 2580 A
(interrupt)378 2748 A
(and)126 3168 A
3336(no)S
(data-out)336 3462 A
(phase.)252 3840 A
4134(*/)S
4230 V
(10847)210 648 A
(int)126 1110 A
1278(r;)S
4320 V
(10848)210 648 A
4410 V
(10849)210 648 A
1110(if)S
(\(\(r)126 1236 A
1404(=)S
(com_out\(cmd\)\))546 1488 A
2076(==)S
(OK\))126 2202 A
2370(r)S
2454(=)S
(w_intr_wait\(\);)588 2538 A
4500 V
(10850)210 648 A
(w_command)378 1110 A
1530(=)S
(CMD_IDLE;)378 1614 A
4590 V
(10851)210 648 A
(return\(r\);)420 1110 A
4680 V
(10852)210 648 A
1026(})S
4950 V
(10855)210 648 A
(/*===========================================================================*)3276 1026 A
5040 V
(10856)210 648 A
1068(*)S
(w_timeout)378 2370 A
4260(*)S
5130 V
(10857)210 648 A
(*===========================================================================*/)3276 1068 A
5220 V
(10858)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(w_timeout\(\))462 1572 A
5310 V
(10859)210 648 A
1026({)S
5400 V
(10860)210 648 A
(struct)252 1110 A
(wini)168 1404 A
(*wn)126 1614 A
1782(=)S
(w_wn;)210 1866 A
5490 V
(10861)210 648 A
5580 V
(10862)210 648 A
(switch)252 1110 A
(\(w_command\))462 1404 A
1908({)S
5670 V
(10863)210 648 A
(case)168 1110 A
(CMD_IDLE:)378 1320 A
5760 V
(10864)210 648 A
(break;)252 1362 A
2034(/*)S
(fine)168 2160 A
2370(*/)S
5850 V
(10865)210 648 A
(case)168 1110 A
(CMD_READ:)378 1320 A
5940 V
(10866)210 648 A
(case)168 1110 A
(CMD_WRITE:)420 1320 A
6030 V
(10867)210 648 A
1362(/*)S
(Impossible,)462 1488 A
(but)126 1992 A
(not)126 2160 A
2328(on)S
(PC's:)210 2454 A
(The)126 2748 A
(controller)420 2916 A
(does)168 3378 A
(not)126 3588 A
(respond.)336 3756 A
4134(*/)S
6120 V
(10868)210 648 A
6210 V
(10869)210 648 A
1362(/*)S
(Limiting)336 1488 A
(multisector)462 1866 A
(I/O)126 2370 A
(seems)210 2538 A
2790(to)S
(help.)210 2916 A
3168(*/)S
8418 V
EP
%%Page: 142 142
BP
/slant 0 def
/height 0 def
630 V
12 B
(142)180 648 A
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(10870)210 648 A
1362(if)S
(\(wn->max_count)588 1488 A
2118(>)S
2202(8)S
2286(*)S
(SECTOR_SIZE\))504 2370 A
2916({)S
990 V
(10871)210 648 A
(wn->max_count)546 1698 A
2286(=)S
2370(8)S
2454(*)S
(SECTOR_SIZE;)504 2538 A
1080 V
(10872)210 648 A
1362(})S
(else)168 1446 A
1656({)S
1170 V
(10873)210 648 A
(wn->max_count)546 1698 A
2286(=)S
(SECTOR_SIZE;)504 2370 A
1260 V
(10874)210 648 A
1362(})S
1350 V
(10875)210 648 A
(/*FALL)252 1362 A
(THROUGH*/)378 1656 A
1440 V
(10876)210 648 A
(default:)336 1110 A
1530 V
(10877)210 648 A
1362(/*)S
(Some)168 1488 A
(other)210 1698 A
(command.)336 1950 A
2328(*/)S
1620 V
(10878)210 648 A
(printf\("%s:)462 1362 A
(timeout)294 1866 A
2202(on)S
(command)294 2328 A
(%02x\\n",)336 2664 A
(w_name\(\),)378 3042 A
(w_command\);)462 3462 A
1710 V
(10879)210 648 A
(w_need_reset\(\);)630 1362 A
1800 V
(10880)210 648 A
(w_status)336 1362 A
1740(=)S
1824(0;)S
1890 V
(10881)210 648 A
(interrupt\(WINCHESTER\);)924 1362 A
1980 V
(10882)210 648 A
1110(})S
2070 V
(10883)210 648 A
1026(})S
2340 V
(10886)210 648 A
(/*===========================================================================*)3276 1026 A
2430 V
(10887)210 648 A
1068(*)S
(w_reset)294 2370 A
4260(*)S
2520 V
(10888)210 648 A
(*===========================================================================*/)3276 1068 A
2610 V
(10889)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_reset\(\))378 1530 A
2700 V
(10890)210 648 A
1026({)S
2790 V
(10891)210 648 A
1026(/*)S
(Issue)210 1152 A
1404(a)S
(reset)210 1488 A
1740(to)S
(the)126 1866 A
(controller.)462 2034 A
(This)168 2580 A
2790(is)S
(done)168 2916 A
(after)210 3126 A
(any)126 3378 A
(catastrophe,)504 3546 A
2880 V
(10892)210 648 A
1068(*)S
(like)168 1152 A
(the)126 1362 A
(controller)420 1530 A
(refusing)336 1992 A
2370(to)S
(respond.)336 2496 A
2970 V
(10893)210 648 A
1068(*/)S
3060 V
(10894)210 648 A
3150 V
(10895)210 648 A
(struct)252 1110 A
(wini)168 1404 A
(*wn;)168 1614 A
3240 V
(10896)210 648 A
(int)126 1110 A
(err;)168 1278 A
3330 V
(10897)210 648 A
3420 V
(10898)210 648 A
1110(/*)S
(Wait)168 1236 A
(for)126 1446 A
(any)126 1614 A
(internal)336 1782 A
(drive)210 2160 A
(recovery.)378 2412 A
2832(*/)S
3510 V
(10899)210 648 A
(milli_delay\(RECOVERYTIME\);)1092 1110 A
3600 V
(10900)210 648 A
3690 V
(10901)210 648 A
1110(/*)S
(Strobe)252 1236 A
(reset)210 1530 A
(bit)126 1782 A
1950(*/)S
3780 V
(10902)210 648 A
(out_byte\(w_wn->base)798 1110 A
1950(+)S
(REG_CTL,)336 2034 A
(CTL_RESET\);)462 2412 A
3870 V
(10903)210 648 A
(milli_delay\(1\);)630 1110 A
3960 V
(10904)210 648 A
(out_byte\(w_wn->base)798 1110 A
1950(+)S
(REG_CTL,)336 2034 A
(0\);)126 2412 A
4050 V
(10905)210 648 A
(milli_delay\(1\);)630 1110 A
4140 V
(10906)210 648 A
4230 V
(10907)210 648 A
1110(/*)S
(Wait)168 1236 A
(for)126 1446 A
(controller)420 1614 A
(ready)210 2076 A
2328(*/)S
4320 V
(10908)210 648 A
1110(if)S
(\(!w_waitfor\(STATUS_BSY)924 1236 A
2202(|)S
(STATUS_RDY,)462 2286 A
(STATUS_RDY\)\))504 2790 A
3336({)S
4410 V
(10909)210 648 A
(printf\("%s:)462 1362 A
(reset)210 1866 A
(failed,)294 2118 A
(drive)210 2454 A
(busy\\n",)336 2706 A
(w_name\(\)\);)420 3084 A
4500 V
(10910)210 648 A
(return\(ERR\);)504 1362 A
4590 V
(10911)210 648 A
1110(})S
4680 V
(10912)210 648 A
4770 V
(10913)210 648 A
1110(/*)S
(The)126 1236 A
(error)210 1404 A
(register)336 1656 A
(should)252 2034 A
2328(be)S
(checked)294 2454 A
(now,)168 2790 A
(but)126 3000 A
(some)168 3168 A
(drives)252 3378 A
(mess)168 3672 A
3882(it)S
(up.)126 4008 A
4176(*/)S
4860 V
(10914)210 648 A
4950 V
(10915)210 648 A
(for)126 1110 A
(\(wn)126 1278 A
1446(=)S
(wini;)210 1530 A
1782(wn)S
1908(<)S
(&wini[MAX_DRIVES];)756 1992 A
(wn++\))210 2790 A
3042({)S
5040 V
(10916)210 648 A
1362(if)S
(\(wn->base)378 1488 A
1908(==)S
(w_wn->base\))462 2034 A
(wn->state)378 2538 A
2958(&=)S
(\304DEAF;)252 3084 A
5130 V
(10917)210 648 A
1110(})S
5220 V
(10918)210 648 A
(return\(OK\);)462 1110 A
5310 V
(10919)210 648 A
1026(})S
5580 V
(10922)210 648 A
(/*============================================================================*)3318 1026 A
5670 V
(10923)210 648 A
1068(*)S
(w_intr_wait)462 2370 A
4302(*)S
5760 V
(10924)210 648 A
(*============================================================================*/)3318 1068 A
5850 V
(10925)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_intr_wait\(\))546 1530 A
5940 V
(10926)210 648 A
1026({)S
6030 V
(10927)210 648 A
1026(/*)S
(Wait)168 1152 A
(for)126 1362 A
1530(a)S
(task)168 1614 A
(completion)420 1824 A
(interrupt)378 2286 A
(and)126 2706 A
(return)252 2874 A
(results.)336 3168 A
3546(*/)S
6120 V
(10928)210 648 A
6210 V
(10929)210 648 A
(message)294 1110 A
(mess;)210 1446 A
8418 V
EP
%%Page: 143 143
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
12 B
(143)180 4248 A
900 V
7 LST
(10930)210 648 A
(int)126 1110 A
1278(r;)S
990 V
(10931)210 648 A
1080 V
(10932)210 648 A
1110(/*)S
(Wait)168 1236 A
(for)126 1446 A
1614(an)S
(interrupt)378 1740 A
(that)168 2160 A
(sets)168 2370 A
(w_status)336 2580 A
2958(to)S
("not)168 3084 A
(busy".)252 3294 A
3588(*/)S
1170 V
(10933)210 648 A
(while)210 1110 A
(\(w_status)378 1362 A
1782(&)S
(STATUS_BSY\))462 1866 A
(receive\(HARDWARE,)714 2370 A
(&mess\);)294 3126 A
1260 V
(10934)210 648 A
1350 V
(10935)210 648 A
1110(/*)S
(Check)210 1236 A
(status.)294 1488 A
1824(*/)S
1440 V
(10936)210 648 A
(lock\(\);)294 1110 A
1530 V
(10937)210 648 A
1110(if)S
(\(\(w_status)420 1236 A
1698(&)S
(\(STATUS_BSY)462 1782 A
2286(|)S
(STATUS_RDY)420 2370 A
2832(|)S
(STATUS_WF)378 2916 A
3336(|)S
(STATUS_ERR\)\))504 3420 A
1620 V
(10938)210 648 A
3378(==)S
(STATUS_RDY\))462 3504 A
4008({)S
1710 V
(10939)210 648 A
1362(r)S
1446(=)S
(OK;)126 1530 A
1800 V
(10940)210 648 A
(w_status)336 1362 A
1740(|=)S
(STATUS_BSY;)462 1866 A
2370(/*)S
(assume)252 2496 A
(still)210 2790 A
(busy)168 3042 A
(with)168 3252 A
(I/O)126 3462 A
3630(*/)S
1890 V
(10941)210 648 A
1110(})S
(else)168 1194 A
1980 V
(10942)210 648 A
1110(if)S
(\(\(w_status)420 1236 A
1698(&)S
(STATUS_ERR\))462 1782 A
2286(&&)S
(\(in_byte\(w_wn->base)798 2412 A
3252(+)S
(REG_ERROR\))420 3336 A
3798(&)S
(ERROR_BB\)\))420 3882 A
4344({)S
2070 V
(10943)210 648 A
1362(r)S
1446(=)S
(ERR_BAD_SECTOR;)630 1530 A
2370(/*)S
(sector)252 2496 A
(marked)252 2790 A
(bad,)168 3084 A
(retries)294 3294 A
(won't)210 3630 A
(help)168 3882 A
4092(*/)S
2160 V
(10944)210 648 A
1110(})S
(else)168 1194 A
1404({)S
2250 V
(10945)210 648 A
1362(r)S
1446(=)S
(ERR;)168 1530 A
2370(/*)S
(any)126 2496 A
(other)210 2664 A
(error)210 2916 A
3168(*/)S
2340 V
(10946)210 648 A
1110(})S
2430 V
(10947)210 648 A
(unlock\(\);)378 1110 A
2520 V
(10948)210 648 A
(return\(r\);)420 1110 A
2610 V
(10949)210 648 A
1026(})S
2880 V
(10952)210 648 A
(/*==========================================================================*)3234 1026 A
2970 V
(10953)210 648 A
1068(*)S
(w_waitfor)378 2370 A
4218(*)S
3060 V
(10954)210 648 A
(*==========================================================================*/)3234 1068 A
3150 V
(10955)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_waitfor\(mask,)630 1530 A
(value\))252 2202 A
3240 V
(10956)210 648 A
(int)126 1026 A
(mask;)210 1194 A
2370(/*)S
(status)252 2496 A
(mask)168 2790 A
3000(*/)S
3330 V
(10957)210 648 A
(int)126 1026 A
(value;)252 1194 A
2370(/*)S
(required)336 2496 A
(status)252 2874 A
3168(*/)S
3420 V
(10958)210 648 A
1026({)S
3510 V
(10959)210 648 A
1026(/*)S
(Wait)168 1152 A
(until)210 1362 A
(controller)420 1614 A
2076(is)S
2202(in)S
(the)126 2328 A
(required)336 2496 A
(state.)252 2874 A
(Return)252 3210 A
(zero)168 3504 A
3714(on)S
(timeout.)336 3840 A
4218(*/)S
3600 V
(10960)210 648 A
3690 V
(10961)210 648 A
(struct)252 1110 A
(milli_state)462 1404 A
(ms;)126 1908 A
3780 V
(10962)210 648 A
3870 V
(10963)210 648 A
(milli_start\(&ms\);)714 1110 A
3960 V
(10964)210 648 A
1110(do)S
1236({)S
4050 V
(10965)210 648 A
1320(if)S
(\(\(in_byte\(w_wn->base)840 1446 A
2328(+)S
(REG_STATUS\))462 2412 A
2916(&)S
(mask\))210 3000 A
3252(==)S
(value\))252 3378 A
(return)252 3672 A
3966(1;)S
4140 V
(10966)210 648 A
1110(})S
(while)210 1194 A
(\(milli_elapsed\(&ms\))798 1446 A
2286(<)S
(TIMEOUT\);)378 2370 A
4230 V
(10967)210 648 A
4320 V
(10968)210 648 A
(w_need_reset\(\);)630 1110 A
2034(/*)S
(Controller)420 2160 A
(gone)168 2622 A
(deaf.)210 2832 A
3084(*/)S
4410 V
(10969)210 648 A
(return\(0\);)420 1110 A
4500 V
(10970)210 648 A
1026(})S
4770 V
(10973)210 648 A
(/*==========================================================================*)3234 1026 A
4860 V
(10974)210 648 A
1068(*)S
(w_handler)378 2370 A
4218(*)S
4950 V
(10975)210 648 A
(*==========================================================================*/)3234 1068 A
5040 V
(10976)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(w_handler\(irq\))588 1530 A
5130 V
(10977)210 648 A
(int)126 1026 A
(irq;)168 1194 A
5220 V
(10978)210 648 A
1026({)S
5310 V
(10979)210 648 A
1026(/*)S
(Disk)168 1152 A
(interrupt,)420 1362 A
(send)168 1824 A
(message)294 2034 A
2370(to)S
(winchester)420 2496 A
(task)168 2958 A
(and)126 3168 A
(reenable)336 3336 A
(interrupts.)462 3714 A
4218(*/)S
5400 V
(10980)210 648 A
5490 V
(10981)210 648 A
(w_status)336 1110 A
1488(=)S
(in_byte\(w_wn->base)756 1572 A
2370(+)S
(REG_STATUS\);)504 2454 A
3042(/*)S
(acknowledge)462 3168 A
(interrupt)378 3672 A
4092(*/)S
5580 V
(10982)210 648 A
(interrupt\(WINCHESTER\);)924 1110 A
5670 V
(10983)210 648 A
(return)252 1110 A
1404(1;)S
5760 V
(10984)210 648 A
1026(})S
6030 V
(10987)210 648 A
(/*============================================================================*)3318 1026 A
6120 V
(10988)210 648 A
1068(*)S
(w_geometry)420 2370 A
4302(*)S
6210 V
(10989)210 648 A
(*============================================================================*/)3318 1068 A
8418 V
EP
%%Page: 144 144
BP
/slant 0 def
/height 0 def
630 V
12 B
(144)180 648 A
11 R
1981(File:)S
2214(src/kernel/at_wini.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(10990)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(w_geometry\(entry\))714 1572 A
990 V
(10991)210 648 A
(struct)252 1026 A
(partition)378 1320 A
(*entry;)294 1740 A
1080 V
(10992)210 648 A
1026({)S
1170 V
(10993)210 648 A
(entry->cylinders)672 1110 A
1824(=)S
(w_wn->lcylinders;)714 1908 A
1260 V
(10994)210 648 A
(entry->heads)504 1110 A
1656(=)S
(w_wn->lheads;)546 1740 A
1350 V
(10995)210 648 A
(entry->sectors)588 1110 A
1740(=)S
(w_wn->lsectors;)630 1824 A
1440 V
(10996)210 648 A
1026(})S
1530 V
(10997)210 648 A
(#endif)252 1026 A
1320(/*)S
(ENABLE_AT_WINI)588 1446 A
2076(*/)S
1890 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1980 V
(src/kernel/clock.c)756 2034 A
2070 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2250 V
(11000)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(code)168 2118 A
(and)126 2328 A
(data)168 2496 A
(for)126 2706 A
(the)126 2874 A
(clock)210 3042 A
(task.)210 3294 A
(The)126 3588 A
(clock)210 3756 A
(task)168 4008 A
2340 V
(11001)210 648 A
1068(*)S
(accepts)294 1152 A
(six)126 1488 A
(message)294 1656 A
(types:)252 1992 A
2430 V
(11002)210 648 A
1068(*)S
2520 V
(11003)210 648 A
1068(*)S
(HARD_INT:)378 1236 A
1782(a)S
(clock)210 1866 A
(interrupt)378 2118 A
(has)126 2538 A
(occurred)336 2706 A
2610 V
(11004)210 648 A
1068(*)S
(GET_UPTIME:)462 1236 A
(get)126 1782 A
(the)126 1950 A
(time)168 2118 A
(since)210 2328 A
(boot)168 2580 A
2790(in)S
(ticks)210 2916 A
2700 V
(11005)210 648 A
1068(*)S
(GET_TIME:)378 1236 A
1782(a)S
(process)294 1866 A
(wants)210 2202 A
(the)126 2454 A
(real)168 2622 A
(time)168 2832 A
3042(in)S
(seconds)294 3168 A
2790 V
(11006)210 648 A
1068(*)S
(SET_TIME:)378 1236 A
1782(a)S
(process)294 1866 A
(wants)210 2202 A
2454(to)S
(set)126 2580 A
(the)126 2748 A
(real)168 2916 A
(time)168 3126 A
3336(in)S
(seconds)294 3462 A
2880 V
(11007)210 648 A
1068(*)S
(SET_ALARM:)420 1236 A
1782(a)S
(process)294 1866 A
(wants)210 2202 A
2454(to)S
2580(be)S
(alerted)294 2706 A
(after)210 3042 A
3294(a)S
(specified)378 3378 A
(interval)336 3798 A
2970 V
(11008)210 648 A
1068(*)S
(SET_SYN_AL:)462 1236 A
(set)126 1782 A
(the)126 1950 A
(sync)168 2118 A
(alarm)210 2328 A
3060 V
(11009)210 648 A
1068(*)S
3150 V
(11010)210 648 A
1068(*)S
3240 V
(11011)210 648 A
1068(*)S
(The)126 1152 A
(input)210 1320 A
(message)294 1572 A
1908(is)S
(format)252 2034 A
(m6.)126 2328 A
(The)126 2538 A
(parameters)420 2706 A
(are)126 3168 A
3336(as)S
(follows:)336 3462 A
3330 V
(11012)210 648 A
1068(*)S
3420 V
(11013)210 648 A
1068(*)S
(m_type)252 1320 A
(CLOCK_PROC)420 1740 A
(FUNC)168 2286 A
(NEW_TIME)336 2622 A
3510 V
(11014)210 648 A
1068(*)S
(---------------------------------------------)1890 1152 A
3600 V
(11015)210 648 A
1068(*)S
1152(|)S
(HARD_INT)336 1236 A
1698(|)S
2160(|)S
2580(|)S
3000(|)S
3690 V
(11016)210 648 A
1068(*)S
(|------------+----------+---------+---------|)1890 1152 A
3780 V
(11017)210 648 A
1068(*)S
1152(|)S
(GET_UPTIME)420 1236 A
1698(|)S
2160(|)S
2580(|)S
3000(|)S
3870 V
(11018)210 648 A
1068(*)S
(|------------+----------+---------+---------|)1890 1152 A
3960 V
(11019)210 648 A
1068(*)S
1152(|)S
(GET_TIME)336 1236 A
1698(|)S
2160(|)S
2580(|)S
3000(|)S
4050 V
(11020)210 648 A
1068(*)S
(|------------+----------+---------+---------|)1890 1152 A
4140 V
(11021)210 648 A
1068(*)S
1152(|)S
(SET_TIME)336 1236 A
1698(|)S
2160(|)S
2580(|)S
(newtime)294 2664 A
3000(|)S
4230 V
(11022)210 648 A
1068(*)S
(|------------+----------+---------+---------|)1890 1152 A
4320 V
(11023)210 648 A
1068(*)S
1152(|)S
(SET_ALARM)378 1236 A
1698(|)S
(proc_nr)294 1782 A
2160(|f)S
2286(to)S
(call|)210 2412 A
(delta)210 2706 A
3000(|)S
4410 V
(11024)210 648 A
1068(*)S
(|------------+----------+---------+---------|)1890 1152 A
4500 V
(11025)210 648 A
1068(*)S
1152(|)S
(SET_SYN_AL)420 1236 A
1698(|)S
(proc_nr)294 1782 A
2160(|)S
2580(|)S
(delta)210 2706 A
3000(|)S
4590 V
(11026)210 648 A
1068(*)S
(---------------------------------------------)1890 1152 A
4680 V
(11027)210 648 A
1068(*)S
(NEW_TIME,)378 1152 A
(DELTA_CLICKS,)546 1572 A
(and)126 2160 A
(SECONDS_LEFT)504 2328 A
(all)126 2874 A
(refer)210 3042 A
3294(to)S
(the)126 3420 A
(same)168 3588 A
(field)210 3798 A
4050(in)S
4770 V
(11028)210 648 A
1068(*)S
(the)126 1152 A
(message,)336 1320 A
(depending)378 1698 A
(upon)168 2118 A
(the)126 2328 A
(message)294 2496 A
(type.)210 2832 A
4860 V
(11029)210 648 A
1068(*)S
4950 V
(11030)210 648 A
1068(*)S
(Reply)210 1152 A
(messages)336 1404 A
(are)126 1782 A
1950(of)S
(type)168 2076 A
(OK,)126 2286 A
(except)252 2454 A
2748(in)S
(the)126 2874 A
(case)168 3042 A
3252(of)S
3378(a)S
(HARD_INT,)378 3462 A
3882(to)S
5040 V
(11031)210 648 A
1068(*)S
(which)210 1152 A
1404(no)S
(reply)210 1530 A
1782(is)S
(generated.)420 1908 A
(For)126 2370 A
(the)126 2538 A
(GET_*)210 2706 A
(messages)336 2958 A
(the)126 3336 A
(time)168 3504 A
3714(is)S
(returned)336 3840 A
5130 V
(11032)210 648 A
1068(*)S
1152(in)S
(the)126 1278 A
(NEW_TIME)336 1446 A
(field,)252 1824 A
(and)126 2118 A
(for)126 2286 A
(the)126 2454 A
(SET_ALARM)378 2622 A
(and)126 3042 A
(SET_SYN_AL)420 3210 A
(the)126 3672 A
(time)168 3840 A
5220 V
(11033)210 648 A
1068(*)S
1152(in)S
(seconds)294 1278 A
(remaining)378 1614 A
(until)210 2034 A
(the)126 2286 A
(alarm)210 2454 A
2706(is)S
(returned)336 2832 A
3210(is)S
(returned)336 3336 A
3714(in)S
(the)126 3840 A
(same)168 4008 A
5310 V
(11034)210 648 A
1068(*)S
(field.)252 1152 A
5400 V
(11035)210 648 A
1068(*)S
5490 V
(11036)210 648 A
1068(*)S
(When)168 1152 A
1362(an)S
(alarm)210 1488 A
(goes)168 1740 A
(off,)168 1950 A
2160(if)S
(the)126 2286 A
(caller)252 2454 A
2748(is)S
2874(a)S
(user)168 2958 A
(process,)336 3168 A
3546(a)S
(SIGALRM)294 3630 A
(signal)252 3966 A
5580 V
(11037)210 648 A
1068(*)S
1152(is)S
(sent)168 1278 A
1488(to)S
(it.)126 1614 A
1824(If)S
1950(it)S
2076(is)S
2202(a)S
(task,)210 2286 A
2538(a)S
(function)336 2622 A
(specified)378 3000 A
3420(by)S
(the)126 3546 A
(caller)252 3714 A
(will)168 4008 A
5670 V
(11038)210 648 A
1068(*)S
1152(be)S
(invoked.)336 1278 A
(This)168 1698 A
(function)336 1908 A
(may,)168 2286 A
(for)126 2496 A
(example,)336 2664 A
(send)168 3042 A
3252(a)S
(message,)336 3336 A
(but)126 3714 A
(only)168 3882 A
4092(if)S
5760 V
(11039)210 648 A
1068(*)S
1152(it)S
1278(is)S
(certain)294 1404 A
(that)168 1740 A
(the)126 1950 A
(task)168 2118 A
(will)168 2328 A
2538(be)S
(blocked)294 2664 A
(when)168 3000 A
(the)126 3210 A
(timer)210 3378 A
(goes)168 3630 A
(off.)168 3840 A
4050(A)S
5850 V
(11040)210 648 A
1068(*)S
(synchronous)462 1152 A
(alarm)210 1656 A
(sends)210 1908 A
2160(a)S
(message)294 2244 A
2580(to)S
(the)126 2706 A
(synchronous)462 2874 A
(alarm)210 3378 A
(task,)210 3630 A
(which)210 3882 A
5940 V
(11041)210 648 A
1068(*)S
1152(in)S
(turn)168 1278 A
(can)126 1488 A
(dispatch)336 1656 A
2034(a)S
(message)294 2118 A
2454(to)S
(another)294 2580 A
(server.)294 2916 A
(This)168 3252 A
3462(is)S
(the)126 3588 A
(only)168 3756 A
(way)126 3966 A
6030 V
(11042)210 648 A
1068(*)S
1152(to)S
(send)168 1278 A
1488(an)S
(alarm)210 1614 A
1866(to)S
1992(a)S
(server,)294 2076 A
(since)210 2412 A
(servers)294 2664 A
(cannot)252 3000 A
(use)126 3294 A
(the)126 3462 A
(function-call)546 3630 A
6120 V
(11043)210 648 A
1068(*)S
(mechanism)378 1152 A
(available)378 1572 A
1992(to)S
(tasks)210 2118 A
(and)126 2370 A
(servers)294 2538 A
(cannot)252 2874 A
(receive)294 3168 A
(signals.)336 3504 A
6210 V
(11044)210 648 A
1068(*/)S
8418 V
EP
%%Page: 145 145
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2027(File:)S
2260(src/kernel/clock.c)S
12 B
(145)180 4248 A
900 V
7 LST
(11045)210 648 A
990 V
(11046)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
1080 V
(11047)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
1170 V
(11048)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
1260 V
(11049)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
1350 V
(11050)210 648 A
(#include)336 1026 A
("proc.h")336 1404 A
1440 V
(11051)210 648 A
1530 V
(11052)210 648 A
1026(/*)S
(Constant)336 1152 A
(definitions.)504 1530 A
2076(*/)S
1620 V
(11053)210 648 A
(#define)294 1026 A
(MILLISEC)336 1362 A
(100)126 2076 A
2370(/*)S
(how)126 2496 A
(often)210 2664 A
2916(to)S
(call)168 3042 A
(the)126 3252 A
(scheduler)378 3420 A
(\(msec\))252 3840 A
4134(*/)S
1710 V
(11054)210 648 A
(#define)294 1026 A
(SCHED_RATE)420 1362 A
(\(MILLISEC*HZ/1000\))756 1824 A
2706(/*)S
(number)252 2832 A
3126(of)S
(ticks)210 3252 A
(per)126 3504 A
(schedule)336 3672 A
4050(*/)S
1800 V
(11055)210 648 A
1890 V
(11056)210 648 A
1026(/*)S
(Clock)210 1152 A
(parameters.)462 1404 A
1908(*/)S
1980 V
(11057)210 648 A
(#define)294 1026 A
(COUNTER_FREQ)504 1362 A
(\(2*TIMER_FREQ\))588 1908 A
2706(/*)S
(counter)294 2832 A
(frequency)378 3168 A
(using)210 3588 A
(sqare)210 3840 A
(wave*/)252 4092 A
2070 V
(11058)210 648 A
(#define)294 1026 A
(LATCH_COUNT)462 1362 A
(0x00)168 2034 A
2370(/*)S
(cc00xxxx,)378 2496 A
2916(c)S
3000(=)S
(channel,)336 3084 A
3462(x)S
3546(=)S
(any)126 3630 A
3798(*/)S
2160 V
(11059)210 648 A
(#define)294 1026 A
(SQUARE_WAVE)462 1362 A
(0x36)168 2034 A
2370(/*)S
(ccaammmb,)378 2496 A
2916(a)S
3000(=)S
(access,)294 3084 A
3420(m)S
3504(=)S
(mode,)210 3588 A
3840(b)S
3924(=)S
(BCD)126 4008 A
4176(*/)S
2250 V
(11060)210 648 A
2370(/*)S
(11x11,)252 2580 A
2874(11)S
3000(=)S
(LSB)126 3084 A
(then)168 3252 A
(MSB,)168 3462 A
(x11)126 3672 A
3840(=)S
3924(sq)S
(wave)168 4050 A
4260(*/)S
2340 V
(11061)210 648 A
(#define)294 1026 A
(TIMER_COUNT)462 1362 A
(\(\(unsigned\))462 1866 A
(\(TIMER_FREQ/HZ\)\))672 2370 A
3084(/*)S
(initial)294 3210 A
(value)210 3546 A
(for)126 3798 A
(counter*/)378 3966 A
2430 V
(11062)210 648 A
(#define)294 1026 A
(TIMER_FREQ)420 1362 A
(1193182L)336 1866 A
2370(/*)S
(clock)210 2496 A
(frequency)378 2748 A
(for)126 3168 A
(timer)210 3336 A
3588(in)S
3714(PC)S
(and)126 3840 A
4008(AT)S
4134(*/)S
2520 V
(11063)210 648 A
2610 V
(11064)210 648 A
(#define)294 1026 A
(CLOCK_ACK_BIT)546 1362 A
(0x80)168 2034 A
2370(/*)S
(PS/2)168 2496 A
(clock)210 2706 A
(interrupt)378 2958 A
(acknowledge)462 3378 A
(bit)126 3882 A
4050(*/)S
2700 V
(11065)210 648 A
2790 V
(11066)210 648 A
1026(/*)S
(Clock)210 1152 A
(task)168 1404 A
(variables.)420 1614 A
2076(*/)S
2880 V
(11067)210 648 A
(PRIVATE)294 1026 A
(clock_t)294 1362 A
(realtime;)378 1698 A
2370(/*)S
(real)168 2496 A
(time)168 2706 A
(clock)210 2916 A
3168(*/)S
2970 V
(11068)210 648 A
(PRIVATE)294 1026 A
(time_t)252 1362 A
(boot_time;)420 1656 A
2370(/*)S
(time)168 2496 A
2706(in)S
(seconds)294 2832 A
3168(of)S
(system)252 3294 A
(boot)168 3588 A
3798(*/)S
3060 V
(11069)210 648 A
(PRIVATE)294 1026 A
(clock_t)294 1362 A
(next_alarm;)462 1698 A
2370(/*)S
(probable)336 2496 A
(time)168 2874 A
3084(of)S
(next)168 3210 A
(alarm)210 3420 A
3672(*/)S
3150 V
(11070)210 648 A
(PRIVATE)294 1026 A
(message)294 1362 A
(mc;)126 1698 A
2370(/*)S
(message)294 2496 A
(buffer)252 2832 A
(for)126 3126 A
(both)168 3294 A
(input)210 3504 A
(and)126 3756 A
(output)252 3924 A
4218(*/)S
3240 V
(11071)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(watchdog_proc;)588 1530 A
2370(/*)S
(contains)336 2496 A
(proc_nr)294 2874 A
3210(at)S
(call)168 3336 A
3546(of)S
(*watch_dog[]*/)588 3672 A
3330 V
(11072)210 648 A
(PRIVATE)294 1026 A
(watchdog_t)420 1362 A
(watch_dog[NR_TASKS+NR_PROCS];)1218 1824 A
3420 V
(11073)210 648 A
3510 V
(11074)210 648 A
1026(/*)S
(Variables)378 1152 A
(used)168 1572 A
1782(by)S
(both)168 1908 A
(clock)210 2118 A
(task)168 2370 A
(and)126 2580 A
(synchronous)462 2748 A
(alarm)210 3252 A
(task)168 3504 A
3714(*/)S
3600 V
(11075)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(syn_al_alive=)546 1530 A
(TRUE;)210 2118 A
2370(/*)S
(don't)210 2496 A
(wake)168 2748 A
(syn_alrm_task)546 2958 A
(before)252 3546 A
(inited*/)336 3840 A
3690 V
(11076)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(syn_table[NR_TASKS+NR_PROCS];)1218 1530 A
2790(/*)S
(which)210 2916 A
(tasks)210 3168 A
(get)126 3420 A
(CLOCK_INT*/)462 3588 A
3780 V
(11077)210 648 A
3870 V
(11078)210 648 A
1026(/*)S
(Variables)378 1152 A
(changed)294 1572 A
1908(by)S
(interrupt)378 2034 A
(handler)294 2454 A
2790(*/)S
3960 V
(11079)210 648 A
(PRIVATE)294 1026 A
(clock_t)294 1362 A
(pending_ticks;)588 1698 A
2370(/*)S
(ticks)210 2496 A
(seen)168 2748 A
2958(by)S
(low)126 3084 A
(level)210 3252 A
(only)168 3504 A
3714(*/)S
4050 V
(11080)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(sched_ticks)462 1530 A
2034(=)S
(SCHED_RATE;)462 2118 A
2706(/*)S
(counter:)336 2832 A
(when)168 3210 A
3420(0,)S
(call)168 3546 A
(scheduler)378 3756 A
4176(*/)S
4140 V
(11081)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(proc)168 1656 A
(*prev_ptr;)420 1866 A
2370(/*)S
(last)168 2496 A
(user)168 2706 A
(process)294 2916 A
(run)126 3252 A
3420(by)S
(clock)210 3546 A
(task)168 3798 A
4008(*/)S
4230 V
(11082)210 648 A
4320 V
(11083)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(common_setalarm,)672 2076 A
(\(int)168 2790 A
(proc_nr,)336 3000 A
4410 V
(11084)210 648 A
(long)168 1698 A
(delta_ticks,)504 1908 A
(watchdog_t)420 2454 A
(fuction\))336 2916 A
3294(\);)S
4500 V
(11085)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_clocktick,)546 2076 A
(\(void\))252 2664 A
2958(\);)S
4590 V
(11086)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_get_time,)504 2076 A
(\(void\))252 2622 A
2916(\);)S
4680 V
(11087)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_getuptime,)546 2076 A
(\(void\))252 2664 A
2958(\);)S
4770 V
(11088)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_set_time,)504 2076 A
(\(message)336 2622 A
(*m_ptr\))294 3000 A
3336(\);)S
4860 V
(11089)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_setalarm,)504 2076 A
(\(message)336 2622 A
(*m_ptr\))294 3000 A
3336(\);)S
4950 V
(11090)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(init_clock,)462 2076 A
(\(void\))252 2580 A
2874(\);)S
5040 V
(11091)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(cause_alarm,)504 2076 A
(\(void\))252 2622 A
2916(\);)S
5130 V
(11092)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_setsyn_alrm,)630 2076 A
(\(message)336 2748 A
(*m_ptr\))294 3126 A
3462(\);)S
5220 V
(11093)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(clock_handler,)588 2034 A
(\(int)168 2664 A
(irq\))168 2874 A
3084(\);)S
5310 V
(11094)210 648 A
5400 V
(11095)210 648 A
(/*===========================================================================*)3276 1026 A
5490 V
(11096)210 648 A
1068(*)S
(clock_task)420 2370 A
4260(*)S
5580 V
(11097)210 648 A
(*===========================================================================*/)3276 1068 A
5670 V
(11098)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(clock_task\(\))504 1530 A
5760 V
(11099)210 648 A
1026({)S
5850 V
(11100)210 648 A
1026(/*)S
(Main)168 1152 A
(program)294 1362 A
1698(of)S
(clock)210 1824 A
(task.)210 2076 A
2370(It)S
(corrects)336 2496 A
(realtime)336 2874 A
3252(by)S
(adding)252 3378 A
(pending)294 3672 A
5940 V
(11101)210 648 A
1068(*)S
(ticks)210 1152 A
(seen)168 1404 A
(only)168 1614 A
1824(by)S
(the)126 1950 A
(interrupt)378 2118 A
(service,)336 2538 A
(then)168 2916 A
3126(it)S
(determines)420 3252 A
(which)210 3714 A
6030 V
(11102)210 648 A
1068(*)S
1152(of)S
(the)126 1278 A
1446(6)S
(possible)336 1530 A
(calls)210 1908 A
(this)168 2160 A
2370(is)S
2496(by)S
(looking)294 2622 A
2958(at)S
('mc.m_type'.)504 3084 A
(Then)168 3672 A
6120 V
(11103)210 648 A
1068(*)S
1152(it)S
(dispatches.)462 1278 A
6210 V
(11104)210 648 A
1068(*/)S
8418 V
EP
%%Page: 146 146
BP
/slant 0 def
/height 0 def
630 V
12 B
(146)180 648 A
11 R
2027(File:)S
2260(src/kernel/clock.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(11105)210 648 A
990 V
(11106)210 648 A
(int)126 1110 A
(opcode;)294 1278 A
1080 V
(11107)210 648 A
1170 V
(11108)210 648 A
(init_clock\(\);)546 1110 A
2370(/*)S
(initialize)420 2496 A
(clock)210 2958 A
(task)168 3210 A
3420(*/)S
1260 V
(11109)210 648 A
1350 V
(11110)210 648 A
1110(/*)S
(Main)168 1236 A
(loop)168 1446 A
1656(of)S
(the)126 1782 A
(clock)210 1950 A
(task.)210 2202 A
(Get)126 2496 A
(work,)210 2664 A
(process)294 2916 A
(it,)126 3252 A
(sometimes)378 3420 A
(reply.)252 3840 A
4134(*/)S
1440 V
(11111)210 648 A
(while)210 1110 A
(\(TRUE\))252 1362 A
1656({)S
1530 V
(11112)210 648 A
(receive\(ANY,)504 1236 A
(&mc\);)210 1782 A
2370(/*)S
2496(go)S
(get)126 2622 A
2790(a)S
(message)294 2874 A
3210(*/)S
1620 V
(11113)210 648 A
(opcode)252 1236 A
1530(=)S
(mc.m_type;)420 1614 A
2370(/*)S
(extract)294 2496 A
(the)126 2832 A
(function)336 3000 A
(code)168 3378 A
3588(*/)S
1710 V
(11114)210 648 A
1800 V
(11115)210 648 A
(lock\(\);)294 1236 A
1890 V
(11116)210 648 A
(realtime)336 1236 A
1614(+=)S
(pending_ticks;)588 1740 A
2370(/*)S
(transfer)336 2496 A
(ticks)210 2874 A
(from)168 3126 A
(low)126 3336 A
(level)210 3504 A
(handler)294 3756 A
4092(*/)S
1980 V
(11117)210 648 A
(pending_ticks)546 1236 A
1824(=)S
1908(0;)S
2370(/*)S
2496(so)S
2622(we)S
(don't)210 2748 A
(have)168 3000 A
3210(to)S
(worry)210 3336 A
(about)210 3588 A
(them)168 3840 A
4050(*/)S
2070 V
(11118)210 648 A
(unlock\(\);)378 1236 A
2160 V
(11119)210 648 A
2250 V
(11120)210 648 A
(switch)252 1236 A
(\(opcode\))336 1530 A
1908({)S
2340 V
(11121)210 648 A
(case)168 1362 A
(HARD_INT:)378 1572 A
(do_clocktick\(\);)630 2076 A
(break;)252 3042 A
2430 V
(11122)210 648 A
(case)168 1362 A
(GET_UPTIME:)462 1572 A
(do_getuptime\(\);)630 2076 A
(break;)252 3042 A
2520 V
(11123)210 648 A
(case)168 1362 A
(GET_TIME:)378 1572 A
(do_get_time\(\);)588 2076 A
(break;)252 3042 A
2610 V
(11124)210 648 A
(case)168 1362 A
(SET_TIME:)378 1572 A
(do_set_time\(&mc\);)714 2076 A
(break;)252 3042 A
2700 V
(11125)210 648 A
(case)168 1362 A
(SET_ALARM:)420 1572 A
(do_setalarm\(&mc\);)714 2076 A
(break;)252 3042 A
2790 V
(11126)210 648 A
(case)168 1362 A
(SET_SYNC_AL:do_setsyn_alrm\(&mc\);)1344 1572 A
(break;)252 3042 A
2880 V
(11127)210 648 A
(default:)336 1362 A
(panic\("clock)504 1740 A
(task)168 2286 A
(got)126 2496 A
(bad)126 2664 A
(message",)378 2832 A
(mc.m_type\);)462 3252 A
2970 V
(11128)210 648 A
1236(})S
3060 V
(11129)210 648 A
3150 V
(11130)210 648 A
1194(/*)S
(Send)168 1320 A
(reply,)252 1530 A
(except)252 1824 A
(for)126 2118 A
(clock)210 2286 A
(tick.)210 2538 A
2790(*/)S
3240 V
(11131)210 648 A
(mc.m_type)378 1194 A
1614(=)S
(OK;)126 1698 A
3330 V
(11132)210 648 A
1194(if)S
(\(opcode)294 1320 A
1656(!=)S
(HARD_INT\))378 1782 A
(send\(mc.m_source,)714 2202 A
(&mc\);)210 2958 A
3420 V
(11133)210 648 A
1110(})S
3510 V
(11134)210 648 A
1026(})S
3780 V
(11137)210 648 A
(/*===========================================================================*)3276 1026 A
3870 V
(11138)210 648 A
1068(*)S
(do_clocktick)504 2370 A
4260(*)S
3960 V
(11139)210 648 A
(*===========================================================================*/)3276 1068 A
4050 V
(11140)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_clocktick\(\))588 1572 A
4140 V
(11141)210 648 A
1026({)S
4230 V
(11142)210 648 A
1026(/*)S
(Despite)294 1152 A
(its)126 1488 A
(name,)210 1656 A
(this)168 1908 A
(routine)294 2118 A
2454(is)S
(not)126 2580 A
(called)252 2748 A
3042(on)S
(every)210 3168 A
(clock)210 3420 A
(tick.)210 3672 A
3924(It)S
4320 V
(11143)210 648 A
1068(*)S
1152(is)S
(called)252 1278 A
1572(on)S
(those)210 1698 A
(clock)210 1950 A
(ticks)210 2202 A
(when)168 2454 A
2664(a)S
(lot)126 2748 A
2916(of)S
(work)168 3042 A
(needs)210 3252 A
3504(to)S
3630(be)S
(done.)210 3756 A
4410 V
(11144)210 648 A
1068(*/)S
4500 V
(11145)210 648 A
4590 V
(11146)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
4680 V
(11147)210 648 A
(register)336 1110 A
(int)126 1488 A
(proc_nr;)336 1656 A
4770 V
(11148)210 648 A
4860 V
(11149)210 648 A
1110(if)S
(\(next_alarm)462 1236 A
1740(<=)S
(realtime\))378 1866 A
2286({)S
4950 V
(11150)210 648 A
1362(/*)S
1488(An)S
(alarm)210 1614 A
(may)126 1866 A
(have)168 2034 A
(gone)168 2244 A
(off,)168 2454 A
(but)126 2664 A
(proc)168 2832 A
(may)126 3042 A
(have)168 3210 A
(exited,)294 3420 A
3756(so)S
(check.)252 3882 A
4176(*/)S
5040 V
(11151)210 648 A
(next_alarm)420 1362 A
1824(=)S
(LONG_MAX;)378 1908 A
2370(/*)S
(start)210 2496 A
(computing)378 2748 A
(next)168 3168 A
(alarm)210 3378 A
3630(*/)S
5130 V
(11152)210 648 A
(for)126 1362 A
(\(rp)126 1530 A
1698(=)S
(BEG_PROC_ADDR;)588 1782 A
2412(rp)S
2538(<)S
(END_PROC_ADDR;)588 2622 A
(rp++\))210 3252 A
3504({)S
5220 V
(11153)210 648 A
1698(if)S
(\(rp->p_alarm)504 1824 A
2370(!=)S
2496(0\))S
2622({)S
5310 V
(11154)210 648 A
2034(/*)S
(See)126 2160 A
2328(if)S
(this)168 2454 A
(alarm)210 2664 A
(time)168 2916 A
(has)126 3126 A
(been)168 3294 A
(reached.)336 3504 A
3882(*/)S
5400 V
(11155)210 648 A
2034(if)S
(\(rp->p_alarm)504 2160 A
2706(<=)S
(realtime\))378 2832 A
3252({)S
5490 V
(11156)210 648 A
2370(/*)S
2496(A)S
(timer)210 2580 A
(has)126 2832 A
(gone)168 3000 A
(off.)168 3210 A
3462(If)S
3588(it)S
3714(is)S
3840(a)S
(user)168 3924 A
(proc,)210 4134 A
5580 V
(11157)210 648 A
2412(*)S
(send)168 2496 A
2706(it)S
2832(a)S
(signal.)294 2916 A
3294(If)S
3420(it)S
3546(is)S
3672(a)S
(task,)210 3756 A
(call)168 4008 A
(the)126 4218 A
5670 V
(11158)210 648 A
2412(*)S
(function)336 2496 A
(previously)420 2874 A
(specified)378 3336 A
3756(by)S
(the)126 3882 A
(task.)210 4050 A
5760 V
(11159)210 648 A
2412(*/)S
5850 V
(11160)210 648 A
(proc_nr)294 2370 A
2706(=)S
(proc_number\(rp\);)672 2790 A
5940 V
(11161)210 648 A
2370(if)S
(\(watch_dog[proc_nr+NR_TASKS]\))1218 2496 A
3756({)S
6030 V
(11162)210 648 A
(watchdog_proc=)588 2706 A
(proc_nr;)336 3336 A
6120 V
(11163)210 648 A
(\(*watch_dog[proc_nr+NR_TASKS]\)\(\);)1386 2706 A
6210 V
(11164)210 648 A
2370(})S
8418 V
EP
%%Page: 147 147
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2027(File:)S
2260(src/kernel/clock.c)S
12 B
(147)180 4248 A
900 V
7 LST
(11165)210 648 A
(else)168 2370 A
990 V
(11166)210 648 A
(cause_sig\(proc_nr,)756 2706 A
(SIGALRM\);)378 3504 A
1080 V
(11167)210 648 A
(rp->p_alarm)462 2370 A
2874(=)S
2958(0;)S
1170 V
(11168)210 648 A
2034(})S
1260 V
(11169)210 648 A
1350 V
(11170)210 648 A
2034(/*)S
(Work)168 2160 A
2370(on)S
(determining)462 2496 A
(which)210 3000 A
(alarm)210 3252 A
3504(is)S
(next.)210 3630 A
3882(*/)S
1440 V
(11171)210 648 A
2034(if)S
(\(rp->p_alarm)504 2160 A
2706(!=)S
2832(0)S
2916(&&)S
(rp->p_alarm)462 3042 A
3546(<)S
(next_alarm\))462 3630 A
1530 V
(11172)210 648 A
(next_alarm)420 2370 A
2832(=)S
(rp->p_alarm;)504 2916 A
1620 V
(11173)210 648 A
1698(})S
1710 V
(11174)210 648 A
1362(})S
1800 V
(11175)210 648 A
1110(})S
1890 V
(11176)210 648 A
1980 V
(11177)210 648 A
1110(/*)S
1236(If)S
1362(a)S
(user)168 1446 A
(process)294 1656 A
(has)126 1992 A
(been)168 2160 A
(running)294 2370 A
(too)126 2706 A
(long,)210 2874 A
(pick)168 3126 A
(another)294 3336 A
(one.)168 3672 A
3882(*/)S
2070 V
(11178)210 648 A
1110(if)S
(\(--sched_ticks)588 1236 A
1866(==)S
1992(0\))S
2118({)S
2160 V
(11179)210 648 A
1362(if)S
(\(bill_ptr)378 1488 A
1908(==)S
(prev_ptr\))378 2034 A
(lock_sched\(\);)546 2454 A
3042(/*)S
(process)294 3168 A
(has)126 3504 A
(run)126 3672 A
(too)126 3840 A
(long)168 4008 A
4218(*/)S
2250 V
(11180)210 648 A
(sched_ticks)462 1362 A
1866(=)S
(SCHED_RATE;)462 1950 A
3042(/*)S
(reset)210 3168 A
(quantum)294 3420 A
3756(*/)S
2340 V
(11181)210 648 A
(prev_ptr)336 1362 A
1740(=)S
(bill_ptr;)378 1824 A
3042(/*)S
(new)126 3168 A
(previous)336 3336 A
(process)294 3714 A
4050(*/)S
2430 V
(11182)210 648 A
1110(})S
2520 V
(11183)210 648 A
1026(})S
2790 V
(11186)210 648 A
(/*===========================================================================*)3276 1026 A
2880 V
(11187)210 648 A
1068(*)S
(do_getuptime)504 2370 A
4260(*)S
2970 V
(11188)210 648 A
(*===========================================================================*/)3276 1068 A
3060 V
(11189)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_getuptime\(\))588 1572 A
3150 V
(11190)210 648 A
1026({)S
3240 V
(11191)210 648 A
1026(/*)S
(Get)126 1152 A
(and)126 1320 A
(return)252 1488 A
(the)126 1782 A
(current)294 1950 A
(clock)210 2286 A
(uptime)252 2538 A
2832(in)S
(ticks.)252 2958 A
3252(*/)S
3330 V
(11192)210 648 A
3420 V
(11193)210 648 A
(mc.NEW_TIME)462 1110 A
1614(=)S
(realtime;)378 1698 A
2370(/*)S
(current)294 2496 A
(uptime)252 2832 A
3126(*/)S
3510 V
(11194)210 648 A
1026(})S
3780 V
(11197)210 648 A
(/*===========================================================================*)3276 1026 A
3870 V
(11198)210 648 A
1068(*)S
(get_uptime)420 2370 A
4260(*)S
3960 V
(11199)210 648 A
(*===========================================================================*/)3276 1068 A
4050 V
(11200)210 648 A
(PUBLIC)252 1026 A
(clock_t)294 1320 A
(get_uptime\(\))504 1656 A
4140 V
(11201)210 648 A
1026({)S
4230 V
(11202)210 648 A
1026(/*)S
(Get)126 1152 A
(and)126 1320 A
(return)252 1488 A
(the)126 1782 A
(current)294 1950 A
(clock)210 2286 A
(uptime)252 2538 A
2832(in)S
(ticks.)252 2958 A
(This)168 3294 A
(function)336 3504 A
3882(is)S
4320 V
(11203)210 648 A
1068(*)S
(designed)336 1152 A
1530(to)S
1656(be)S
(called)252 1782 A
(from)168 2076 A
(other)210 2286 A
(tasks,)252 2538 A
2832(so)S
(they)168 2958 A
(can)126 3168 A
(get)126 3336 A
(uptime)252 3504 A
(without)294 3798 A
4410 V
(11204)210 648 A
1068(*)S
(the)126 1152 A
(overhead)336 1320 A
1698(of)S
(messages.)378 1824 A
2244(It)S
(has)126 2370 A
2538(to)S
2664(be)S
(careful)294 2790 A
(about)210 3126 A
(pending_ticks.)588 3378 A
4500 V
(11205)210 648 A
1068(*/)S
4590 V
(11206)210 648 A
4680 V
(11207)210 648 A
(clock_t)294 1110 A
(uptime;)294 1446 A
4770 V
(11208)210 648 A
4860 V
(11209)210 648 A
(lock\(\);)294 1110 A
4950 V
(11210)210 648 A
(uptime)252 1110 A
1404(=)S
(realtime)336 1488 A
1866(+)S
(pending_ticks;)588 1950 A
5040 V
(11211)210 648 A
(unlock\(\);)378 1110 A
5130 V
(11212)210 648 A
(return\(uptime\);)630 1110 A
5220 V
(11213)210 648 A
1026(})S
5490 V
(11216)210 648 A
(/*===========================================================================*)3276 1026 A
5580 V
(11217)210 648 A
1068(*)S
(do_get_time)462 2370 A
4260(*)S
5670 V
(11218)210 648 A
(*===========================================================================*/)3276 1068 A
5760 V
(11219)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_get_time\(\))546 1572 A
5850 V
(11220)210 648 A
1026({)S
5940 V
(11221)210 648 A
1026(/*)S
(Get)126 1152 A
(and)126 1320 A
(return)252 1488 A
(the)126 1782 A
(current)294 1950 A
(clock)210 2286 A
(time)168 2538 A
2748(in)S
(seconds.)336 2874 A
3252(*/)S
6030 V
(11222)210 648 A
6120 V
(11223)210 648 A
(mc.NEW_TIME)462 1110 A
1614(=)S
(boot_time)378 1698 A
2118(+)S
(realtime/HZ;)504 2202 A
3042(/*)S
(current)294 3168 A
(real)168 3504 A
(time)168 3714 A
3924(*/)S
6210 V
(11224)210 648 A
1026(})S
8418 V
EP
%%Page: 148 148
BP
/slant 0 def
/height 0 def
630 V
12 B
(148)180 648 A
11 R
2027(File:)S
2260(src/kernel/clock.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
1080 V
7 LST
(11227)210 648 A
(/*===========================================================================*)3276 1026 A
1170 V
(11228)210 648 A
1068(*)S
(do_set_time)462 2370 A
4260(*)S
1260 V
(11229)210 648 A
(*===========================================================================*/)3276 1068 A
1350 V
(11230)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_set_time\(m_ptr\))756 1572 A
1440 V
(11231)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
1530 V
(11232)210 648 A
1026({)S
1620 V
(11233)210 648 A
1026(/*)S
(Set)126 1152 A
(the)126 1320 A
(real)168 1488 A
(time)168 1698 A
(clock.)252 1908 A
(Only)168 2244 A
(the)126 2454 A
(superuser)378 2622 A
(can)126 3042 A
(use)126 3210 A
(this)168 3378 A
(call.)210 3588 A
3840(*/)S
1710 V
(11234)210 648 A
1800 V
(11235)210 648 A
(boot_time)378 1110 A
1530(=)S
(m_ptr->NEW_TIME)630 1614 A
2286(-)S
(realtime/HZ;)504 2370 A
1890 V
(11236)210 648 A
1026(})S
2160 V
(11239)210 648 A
(/*===========================================================================*)3276 1026 A
2250 V
(11240)210 648 A
1068(*)S
(do_setalarm)462 2370 A
4260(*)S
2340 V
(11241)210 648 A
(*===========================================================================*/)3276 1068 A
2430 V
(11242)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_setalarm\(m_ptr\))756 1572 A
2520 V
(11243)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
2610 V
(11244)210 648 A
1026({)S
2700 V
(11245)210 648 A
1026(/*)S
1152(A)S
(process)294 1236 A
(wants)210 1572 A
1824(an)S
(alarm)210 1950 A
(signal)252 2202 A
2496(or)S
2622(a)S
(task)168 2706 A
(wants)210 2916 A
3168(a)S
(given)210 3252 A
(watch_dog)378 3504 A
(function)336 3924 A
2790 V
(11246)210 648 A
1068(*)S
(called)252 1152 A
(after)210 1446 A
1698(a)S
(specified)378 1782 A
(interval.)378 2202 A
2880 V
(11247)210 648 A
1068(*/)S
2970 V
(11248)210 648 A
3060 V
(11249)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
3150 V
(11250)210 648 A
(int)126 1110 A
(proc_nr;)336 1278 A
2370(/*)S
(which)210 2496 A
(process)294 2748 A
(wants)210 3084 A
(the)126 3336 A
(alarm)210 3504 A
3756(*/)S
3240 V
(11251)210 648 A
(long)168 1110 A
(delta_ticks;)504 1320 A
2370(/*)S
2496(in)S
(how)126 2622 A
(many)168 2790 A
(clock)210 3000 A
(ticks)210 3252 A
(does)168 3504 A
3714(he)S
(want)168 3840 A
(it?)126 4050 A
4218(*/)S
3330 V
(11252)210 648 A
(watchdog_t)420 1110 A
(function;)378 1572 A
2370(/*)S
(function)336 2496 A
2874(to)S
(call)168 3000 A
(\(tasks)252 3210 A
(only\))210 3504 A
3756(*/)S
3420 V
(11253)210 648 A
3510 V
(11254)210 648 A
1110(/*)S
(Extract)294 1236 A
(the)126 1572 A
(parameters)420 1740 A
(from)168 2202 A
(the)126 2412 A
(message.)336 2580 A
2958(*/)S
3600 V
(11255)210 648 A
(proc_nr)294 1110 A
1446(=)S
(m_ptr->CLOCK_PROC_NR;)882 1530 A
2706(/*)S
(process)294 2832 A
3168(to)S
(interrupt)378 3294 A
(later)210 3714 A
3966(*/)S
3690 V
(11256)210 648 A
(delta_ticks)462 1110 A
1614(=)S
(m_ptr->DELTA_TICKS;)798 1698 A
2706(/*)S
(how)126 2832 A
(many)168 3000 A
(ticks)210 3210 A
3462(to)S
(wait)168 3588 A
3798(*/)S
3780 V
(11257)210 648 A
(function)336 1110 A
1488(=)S
(\(watchdog_t\))504 1572 A
(m_ptr->FUNC_TO_CALL;)840 2118 A
3870 V
(11258)210 648 A
2706(/*)S
(function)336 2832 A
3210(to)S
(call)168 3336 A
(\(tasks)252 3546 A
(only\))210 3840 A
4092(*/)S
3960 V
(11259)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(proc_nr\);)798 1320 A
4050 V
(11260)210 648 A
(mc.SECONDS_LEFT)630 1110 A
1782(=)S
(\(rp->p_alarm)504 1866 A
2412(==)S
2538(0)S
2622(?)S
2706(0)S
2790(:)S
(\(rp->p_alarm)504 2874 A
3420(-)S
(realtime\)/HZ)504 3504 A
4050(\);)S
4140 V
(11261)210 648 A
1110(if)S
(\(!istaskp\(rp\)\))588 1236 A
(function=)378 1866 A
2286(0;)S
2706(/*)S
(user)168 2832 A
(processes)378 3042 A
(get)126 3462 A
(signaled)336 3630 A
4008(*/)S
4230 V
(11262)210 648 A
(common_setalarm\(proc_nr,)1008 1110 A
(delta_ticks,)504 2160 A
(function\);)420 2706 A
4320 V
(11263)210 648 A
1026(})S
4590 V
(11266)210 648 A
(/*===========================================================================*)3276 1026 A
4680 V
(11267)210 648 A
1068(*)S
(do_setsyn_alrm)588 2370 A
4260(*)S
4770 V
(11268)210 648 A
(*===========================================================================*/)3276 1068 A
4860 V
(11269)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_setsyn_alrm\(m_ptr\))882 1572 A
4950 V
(11270)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
5040 V
(11271)210 648 A
1026({)S
5130 V
(11272)210 648 A
1026(/*)S
1152(A)S
(process)294 1236 A
(wants)210 1572 A
1824(a)S
(synchronous)462 1908 A
(alarm.)252 2412 A
5220 V
(11273)210 648 A
1068(*/)S
5310 V
(11274)210 648 A
5400 V
(11275)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
5490 V
(11276)210 648 A
(int)126 1110 A
(proc_nr;)336 1278 A
2370(/*)S
(which)210 2496 A
(process)294 2748 A
(wants)210 3084 A
(the)126 3336 A
(alarm)210 3504 A
3756(*/)S
5580 V
(11277)210 648 A
(long)168 1110 A
(delta_ticks;)504 1320 A
2370(/*)S
2496(in)S
(how)126 2622 A
(many)168 2790 A
(clock)210 3000 A
(ticks)210 3252 A
(does)168 3504 A
3714(he)S
(want)168 3840 A
(it?)126 4050 A
4218(*/)S
5670 V
(11278)210 648 A
5760 V
(11279)210 648 A
1110(/*)S
(Extract)294 1236 A
(the)126 1572 A
(parameters)420 1740 A
(from)168 2202 A
(the)126 2412 A
(message.)336 2580 A
2958(*/)S
5850 V
(11280)210 648 A
(proc_nr)294 1110 A
1446(=)S
(m_ptr->CLOCK_PROC_NR;)882 1530 A
2706(/*)S
(process)294 2832 A
3168(to)S
(interrupt)378 3294 A
(later)210 3714 A
3966(*/)S
5940 V
(11281)210 648 A
(delta_ticks)462 1110 A
1614(=)S
(m_ptr->DELTA_TICKS;)798 1698 A
2706(/*)S
(how)126 2832 A
(many)168 3000 A
(ticks)210 3210 A
3462(to)S
(wait)168 3588 A
3798(*/)S
6030 V
(11282)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(proc_nr\);)798 1320 A
6120 V
(11283)210 648 A
(mc.SECONDS_LEFT)630 1110 A
1782(=)S
(\(rp->p_alarm)504 1866 A
2412(==)S
2538(0)S
2622(?)S
2706(0)S
2790(:)S
(\(rp->p_alarm)504 2874 A
3420(-)S
(realtime\)/HZ)504 3504 A
4050(\);)S
6210 V
(11284)210 648 A
(common_setalarm\(proc_nr,)1008 1110 A
(delta_ticks,)504 2160 A
(cause_alarm\);)546 2706 A
8418 V
EP
%%Page: 149 149
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2027(File:)S
2260(src/kernel/clock.c)S
12 B
(149)180 4248 A
900 V
7 LST
(11285)210 648 A
1026(})S
1170 V
(11288)210 648 A
(/*===========================================================================*)3276 1026 A
1260 V
(11289)210 648 A
1068(*)S
(common_setalarm)630 2370 A
4260(*)S
1350 V
(11290)210 648 A
(*===========================================================================*/)3276 1068 A
1440 V
(11291)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(common_setalarm\(proc_nr,)1008 1572 A
(delta_ticks,)504 2622 A
(function\))378 3168 A
1530 V
(11292)210 648 A
(int)126 1026 A
(proc_nr;)336 1194 A
2370(/*)S
(which)210 2496 A
(process)294 2748 A
(wants)210 3084 A
(the)126 3336 A
(alarm)210 3504 A
3756(*/)S
1620 V
(11293)210 648 A
(long)168 1026 A
(delta_ticks;)504 1236 A
2370(/*)S
2496(in)S
(how)126 2622 A
(many)168 2790 A
(clock)210 3000 A
(ticks)210 3252 A
(does)168 3504 A
3714(he)S
(want)168 3840 A
(it?)126 4050 A
4218(*/)S
1710 V
(11294)210 648 A
(watchdog_t)420 1026 A
(function;)378 1488 A
2370(/*)S
(function)336 2496 A
2874(to)S
(call)168 3000 A
3210(\(0)S
3336(if)S
(cause_sig)378 3462 A
3882(is)S
1800 V
(11295)210 648 A
2412(*)S
2496(to)S
2622(be)S
(called)252 2748 A
3042(*/)S
1890 V
(11296)210 648 A
1026({)S
1980 V
(11297)210 648 A
1026(/*)S
(Finish)252 1152 A
1446(up)S
(work)168 1572 A
1782(of)S
(do_set_alarm)504 1908 A
(and)126 2454 A
(do_setsyn_alrm.)630 2622 A
(Record)252 3336 A
3630(an)S
(alarm)210 3756 A
2070 V
(11298)210 648 A
1068(*)S
(request)294 1152 A
(and)126 1488 A
(check)210 1656 A
1908(to)S
(see)126 2034 A
2202(if)S
2328(it)S
2454(is)S
(the)126 2580 A
(next)168 2748 A
(alarm)210 2958 A
(needed.)294 3210 A
2160 V
(11299)210 648 A
1068(*/)S
2250 V
(11300)210 648 A
2340 V
(11301)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
2430 V
(11302)210 648 A
2520 V
(11303)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(proc_nr\);)798 1320 A
2610 V
(11304)210 648 A
(rp->p_alarm)462 1110 A
1614(=)S
(\(delta_ticks)504 1698 A
2244(==)S
2370(0)S
2454(?)S
2538(0)S
2622(:)S
(realtime)336 2706 A
3084(+)S
(delta_ticks\);)546 3168 A
2700 V
(11305)210 648 A
(watch_dog[proc_nr+NR_TASKS])1134 1110 A
2286(=)S
(function;)378 2370 A
2790 V
(11306)210 648 A
2880 V
(11307)210 648 A
1110(/*)S
(Which)210 1236 A
(alarm)210 1488 A
1740(is)S
(next?)210 1866 A
2118(*/)S
2970 V
(11308)210 648 A
(next_alarm)420 1110 A
1572(=)S
(LONG_MAX;)378 1656 A
3060 V
(11309)210 648 A
(for)126 1110 A
(\(rp)126 1278 A
1446(=)S
(BEG_PROC_ADDR;)588 1530 A
2160(rp)S
2286(<)S
(END_PROC_ADDR;)588 2370 A
(rp++\))210 3000 A
3150 V
(11310)210 648 A
(if\(rp->p_alarm)588 1362 A
1992(!=)S
2118(0)S
2202(&&)S
(rp->p_alarm)462 2328 A
2832(<)S
(next_alarm\)next_alarm=rp->p_alarm;)1428 2916 A
3240 V
(11311)210 648 A
3330 V
(11312)210 648 A
1026(})S
3600 V
(11315)210 648 A
(/*===========================================================================*)3276 1026 A
3690 V
(11316)210 648 A
1068(*)S
(cause_alarm)462 2370 A
4260(*)S
3780 V
(11317)210 648 A
(*===========================================================================*/)3276 1068 A
3870 V
(11318)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(cause_alarm\(\))546 1572 A
3960 V
(11319)210 648 A
1026({)S
4050 V
(11320)210 648 A
1026(/*)S
(Routine)294 1152 A
(called)252 1488 A
1782(if)S
1908(a)S
(timer)210 1992 A
(goes)168 2244 A
(off)126 2454 A
(and)126 2622 A
(the)126 2790 A
(process)294 2958 A
(requested)378 3294 A
3714(a)S
(synchronous)462 3798 A
4140 V
(11321)210 648 A
1068(*)S
(alarm.)252 1152 A
(The)126 1446 A
(process)294 1614 A
(number)252 1950 A
2244(is)S
2370(in)S
(the)126 2496 A
(global)252 2664 A
(variable)336 2958 A
(watchdog_proc)546 3336 A
(\(HACK\).)294 3924 A
4230 V
(11322)210 648 A
1068(*/)S
4320 V
(11323)210 648 A
(message)294 1110 A
(mess;)210 1446 A
4410 V
(11324)210 648 A
4500 V
(11325)210 648 A
(syn_table[watchdog_proc)966 1110 A
2118(+)S
(NR_TASKS]=)420 2202 A
(TRUE;)210 2664 A
4590 V
(11326)210 648 A
1110(if)S
(\(!syn_al_alive\))630 1236 A
(send)168 1908 A
(\(SYN_ALRM_TASK,)630 2118 A
(&mess\);)294 2790 A
4680 V
(11327)210 648 A
1026(})S
4950 V
(11330)210 648 A
(/*===========================================================================*)3276 1026 A
5040 V
(11331)210 648 A
1068(*)S
(syn_alrm_task)546 2370 A
4260(*)S
5130 V
(11332)210 648 A
(*===========================================================================*/)3276 1068 A
5220 V
(11333)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(syn_alrm_task\(\))630 1530 A
5310 V
(11334)210 648 A
1026({)S
5400 V
(11335)210 648 A
1026(/*)S
(Main)168 1152 A
(program)294 1362 A
1698(of)S
(the)126 1824 A
(synchronous)462 1992 A
(alarm)210 2496 A
(task.)210 2748 A
5490 V
(11336)210 648 A
1068(*)S
(This)168 1152 A
(task)168 1362 A
(receives)336 1572 A
(messages)336 1950 A
(only)168 2328 A
(from)168 2538 A
(cause_alarm)462 2748 A
3252(in)S
(the)126 3378 A
(clock)210 3546 A
(task.)210 3798 A
5580 V
(11337)210 648 A
1068(*)S
1152(It)S
(sends)210 1278 A
1530(a)S
(CLOCK_INT)378 1614 A
(message)294 2034 A
2370(to)S
2496(a)S
(process)294 2580 A
(that)168 2916 A
(requested)378 3126 A
3546(a)S
(syn_alrm.)378 3630 A
5670 V
(11338)210 648 A
1068(*)S
(Synchronous)462 1152 A
(alarms)252 1656 A
(are)126 1950 A
2118(so)S
(called)252 2244 A
(because,)336 2538 A
(unlike)252 2916 A
3210(a)S
(signals)294 3294 A
3630(or)S
(the)126 3756 A
5760 V
(11339)210 648 A
1068(*)S
(activation)420 1152 A
1614(of)S
1740(a)S
(watchdog,)378 1824 A
2244(a)S
(synchronous)462 2328 A
(alarm)210 2832 A
3084(is)S
(received)336 3210 A
3588(by)S
3714(a)S
(process)294 3798 A
5850 V
(11340)210 648 A
1068(*)S
(when)168 1152 A
1362(it)S
1488(is)S
1614(in)S
1740(a)S
(known)210 1824 A
(part)168 2076 A
2286(of)S
(its)126 2412 A
(code,)210 2580 A
(that)168 2832 A
(is,)126 3042 A
(when)168 3210 A
3420(it)S
(has)126 3546 A
(issued)252 3714 A
5940 V
(11341)210 648 A
1068(*)S
1152(a)S
(call)168 1236 A
1446(to)S
(receive)294 1572 A
1908(a)S
(message.)336 1992 A
6030 V
(11342)210 648 A
1068(*/)S
6120 V
(11343)210 648 A
6210 V
(11344)210 648 A
(message)294 1110 A
(mess;)210 1446 A
8418 V
EP
%%Page: 150 150
BP
/slant 0 def
/height 0 def
630 V
12 B
(150)180 648 A
11 R
2027(File:)S
2260(src/kernel/clock.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(11345)210 648 A
(int)126 1110 A
(work_done;)420 1278 A
2034(/*)S
(ready)210 2160 A
2412(to)S
(sleep)210 2538 A
2790(?)S
2874(*/)S
990 V
(11346)210 648 A
(int)126 1110 A
(*al_ptr;)336 1278 A
2034(/*)S
(pointer)294 2160 A
2496(in)S
(syn_table)378 2622 A
3042(*/)S
1080 V
(11347)210 648 A
(int)126 1110 A
1278(i;)S
1170 V
(11348)210 648 A
1260 V
(11349)210 648 A
(syn_al_alive=)546 1110 A
(TRUE;)210 1698 A
1350 V
(11350)210 648 A
(for)126 1110 A
(\(i=)126 1278 A
1446(0,)S
(al_ptr=)294 1572 A
(syn_table;)420 1908 A
(i<NR_TASKS+NR_PROCS;)840 2370 A
(i++,)168 3252 A
(al_ptr++\))378 3462 A
1440 V
(11351)210 648 A
(*al_ptr=)336 1362 A
(FALSE;)252 1740 A
1530 V
(11352)210 648 A
1620 V
(11353)210 648 A
(while)210 1110 A
(\(TRUE\))252 1362 A
1656({)S
1710 V
(11354)210 648 A
(work_done=)420 1362 A
(TRUE;)210 1824 A
1800 V
(11355)210 648 A
(for)126 1362 A
(\(i=)126 1530 A
1698(0,)S
(al_ptr=)294 1824 A
(syn_table;)420 2160 A
(i<NR_TASKS+NR_PROCS;)840 2622 A
(i++,)168 3504 A
(al_ptr++\))378 3714 A
1890 V
(11356)210 648 A
1698(if)S
(\(*al_ptr\))378 1824 A
2244({)S
1980 V
(11357)210 648 A
(*al_ptr=)336 2034 A
(FALSE;)252 2412 A
2070 V
(11358)210 648 A
(mess.m_type=)504 2034 A
(CLOCK_INT;)420 2580 A
2160 V
(11359)210 648 A
(send)168 2034 A
(\(i-NR_TASKS,)504 2244 A
(&mess\);)294 2790 A
2250 V
(11360)210 648 A
(work_done=)420 2034 A
(FALSE;)252 2496 A
2340 V
(11361)210 648 A
1698(})S
2430 V
(11362)210 648 A
1362(if)S
(\(work_done\))462 1488 A
1992({)S
2520 V
(11363)210 648 A
(syn_al_alive=)546 1698 A
(FALSE;)252 2286 A
2610 V
(11364)210 648 A
(receive)294 1698 A
(\(CLOCK,)294 2034 A
(&mess\);)294 2370 A
2700 V
(11365)210 648 A
(syn_al_alive=)546 1698 A
(TRUE;)210 2286 A
2790 V
(11366)210 648 A
1362(})S
2880 V
(11367)210 648 A
1110(})S
2970 V
(11368)210 648 A
1026(})S
3240 V
(11371)210 648 A
(/*===========================================================================*)3276 1026 A
3330 V
(11372)210 648 A
1068(*)S
(clock_handler)546 2370 A
4260(*)S
3420 V
(11373)210 648 A
(*===========================================================================*/)3276 1068 A
3510 V
(11374)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(clock_handler\(irq\))756 1530 A
3600 V
(11375)210 648 A
(int)126 1026 A
(irq;)168 1194 A
3690 V
(11376)210 648 A
1026({)S
3780 V
(11377)210 648 A
1026(/*)S
(This)168 1152 A
(executes)336 1362 A
1740(on)S
(every)210 1866 A
(clock)210 2118 A
(tick)168 2370 A
(\(i.e.,)252 2580 A
(every)210 2874 A
(time)168 3126 A
(the)126 3336 A
(timer)210 3504 A
(chip)168 3756 A
3870 V
(11378)210 648 A
1068(*)S
(generates)378 1152 A
1572(an)S
(interrupt\).)462 1698 A
2202(It)S
(does)168 2328 A
2538(a)S
(little)252 2622 A
(bit)126 2916 A
3084(of)S
(work)168 3210 A
3420(so)S
(the)126 3546 A
(clock)210 3714 A
3960 V
(11379)210 648 A
1068(*)S
(task)168 1152 A
(does)168 1362 A
(not)126 1572 A
(have)168 1740 A
1950(to)S
2076(be)S
(called)252 2202 A
2496(on)S
(every)210 2622 A
(tick.)210 2874 A
4050 V
(11380)210 648 A
1068(*)S
4140 V
(11381)210 648 A
1068(*)S
(Switch)252 1152 A
(context)294 1446 A
1782(to)S
(do_clocktick)504 1908 A
2454(if)S
2580(an)S
(alarm)210 2706 A
(has)126 2958 A
(gone)168 3126 A
(off.)168 3336 A
4230 V
(11382)210 648 A
1068(*)S
(Also)168 1152 A
(switch)252 1362 A
(there)210 1656 A
1908(to)S
(reschedule)420 2034 A
2496(if)S
(the)126 2622 A
(reschedule)420 2790 A
(will)168 3252 A
3462(do)S
(something.)420 3588 A
4320 V
(11383)210 648 A
1068(*)S
(This)168 1152 A
(happens)294 1362 A
(when)168 1698 A
4410 V
(11384)210 648 A
1068(*)S
(\(1\))126 1362 A
(quantum)294 1530 A
(has)126 1866 A
(expired)294 2034 A
4500 V
(11385)210 648 A
1068(*)S
(\(2\))126 1362 A
(current)294 1530 A
(process)294 1866 A
(received)336 2202 A
(full)168 2580 A
(quantum)294 2790 A
(\(as)126 3126 A
(clock)210 3294 A
(sampled)294 3546 A
(it!\))168 3882 A
4590 V
(11386)210 648 A
1068(*)S
(\(3\))126 1362 A
(something)378 1530 A
(else)168 1950 A
2160(is)S
(ready)210 2286 A
2538(to)S
(run.)168 2664 A
4680 V
(11387)210 648 A
1068(*)S
(Also)168 1152 A
(call)168 1362 A
(TTY)126 1572 A
(and)126 1740 A
(PRINTER)294 1908 A
(and)126 2244 A
(let)126 2412 A
(them)168 2580 A
2790(do)S
(whatever)336 2916 A
3294(is)S
(necessary.)420 3420 A
4770 V
(11388)210 648 A
1068(*)S
4860 V
(11389)210 648 A
1068(*)S
(Many)168 1152 A
(global)252 1362 A
(global)252 1656 A
(and)126 1950 A
(static)252 2118 A
(variables)378 2412 A
(are)126 2832 A
(accessed)336 3000 A
(here.)210 3378 A
(The)126 3672 A
(safety)252 3840 A
4950 V
(11390)210 648 A
1068(*)S
1152(of)S
(this)168 1278 A
(must)168 1488 A
1698(be)S
(justified.)420 1824 A
(Most)168 2328 A
2538(of)S
(them)168 2664 A
(are)126 2874 A
(not)126 3042 A
(changed)294 3210 A
(here:)210 3546 A
5040 V
(11391)210 648 A
1068(*)S
(k_reenter:)420 1362 A
5130 V
(11392)210 648 A
1068(*)S
(This)168 1698 A
(safely)252 1908 A
(tells)210 2202 A
2454(if)S
(the)126 2580 A
(clock)210 2748 A
(interrupt)378 3000 A
3420(is)S
(nested.)294 3546 A
5220 V
(11393)210 648 A
1068(*)S
(proc_ptr,)378 1362 A
(bill_ptr:)378 1782 A
5310 V
(11394)210 648 A
1068(*)S
(These)210 1698 A
(are)126 1950 A
(used)168 2118 A
(for)126 2328 A
(accounting.)462 2496 A
3042(It)S
(does)168 3168 A
(not)126 3378 A
(matter)252 3546 A
3840(if)S
(proc.c)252 3966 A
5400 V
(11395)210 648 A
1068(*)S
1698(is)S
(changing)336 1824 A
(them,)210 2202 A
(provided)336 2454 A
(they)168 2832 A
(are)126 3042 A
(always)252 3210 A
(valid)210 3504 A
(pointers,)378 3756 A
5490 V
(11396)210 648 A
1068(*)S
(since)210 1698 A
1950(at)S
(worst)210 2076 A
(the)126 2328 A
(previous)336 2496 A
(process)294 2874 A
(would)210 3210 A
3462(be)S
(billed.)294 3588 A
5580 V
(11397)210 648 A
1068(*)S
(next_alarm,)462 1362 A
(realtime,)378 1866 A
(sched_ticks,)504 2286 A
(bill_ptr,)378 2832 A
(prev_ptr,)378 3252 A
5670 V
(11398)210 648 A
1068(*)S
(rdy_head[USER_Q]:)714 1362 A
5760 V
(11399)210 648 A
1068(*)S
(These)210 1698 A
(are)126 1950 A
(tested)252 2118 A
2412(to)S
(decide)252 2538 A
(whether)294 2832 A
3168(to)S
(call)168 3294 A
(interrupt\(\).)504 3504 A
4092(It)S
5850 V
(11400)210 648 A
1068(*)S
(does)168 1698 A
(not)126 1908 A
(matter)252 2076 A
2370(if)S
(the)126 2496 A
(test)168 2664 A
2874(is)S
(sometimes)378 3000 A
(\(rarely\))336 3420 A
(backwards)378 3798 A
5940 V
(11401)210 648 A
1068(*)S
(due)126 1698 A
1866(to)S
1992(a)S
(race,)210 2076 A
(since)210 2328 A
(this)168 2580 A
(will)168 2790 A
(only)168 3000 A
(delay)210 3210 A
(the)126 3462 A
(high-level)420 3630 A
6030 V
(11402)210 648 A
1068(*)S
(processing)420 1698 A
2160(by)S
(one)126 2286 A
(tick,)210 2454 A
2706(or)S
(call)168 2832 A
(the)126 3042 A
(high)168 3210 A
(level)210 3420 A
(unnecessarily.)588 3672 A
6120 V
(11403)210 648 A
1068(*)S
(The)126 1152 A
(variables)378 1320 A
(which)210 1740 A
(are)126 1992 A
(changed)294 2160 A
(require)294 2496 A
(more)168 2832 A
(care:)210 3042 A
6210 V
(11404)210 648 A
1068(*)S
(rp->user_time,)588 1362 A
(rp->sys_time:)546 1992 A
8418 V
EP
%%Page: 151 151
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2027(File:)S
2260(src/kernel/clock.c)S
12 B
(151)180 4248 A
900 V
7 LST
(11405)210 648 A
1068(*)S
(These)210 1698 A
(are)126 1950 A
(protected)378 2118 A
2538(by)S
(explicit)336 2664 A
(locks)210 3042 A
3294(in)S
(system.c.)378 3420 A
(They)168 3882 A
(are)126 4092 A
990 V
(11406)210 648 A
1068(*)S
(not)126 1698 A
(properly)336 1866 A
(protected)378 2244 A
2664(in)S
(dmp.c)210 2790 A
(\(the)168 3042 A
(increment)378 3252 A
(here)168 3672 A
3882(is)S
(not)126 4008 A
1080 V
(11407)210 648 A
1068(*)S
(atomic\))294 1698 A
(but)126 2034 A
(that)168 2202 A
(hardly)252 2412 A
(matters.)336 2706 A
1170 V
(11408)210 648 A
1068(*)S
(pending_ticks:)588 1362 A
1260 V
(11409)210 648 A
1068(*)S
(This)168 1698 A
1908(is)S
(protected)378 2034 A
2454(by)S
(explicit)336 2580 A
(locks)210 2958 A
3210(in)S
(clock.c.)336 3336 A
(Don't)210 3756 A
1350 V
(11410)210 648 A
1068(*)S
(update)252 1698 A
(realtime)336 1992 A
(directly,)378 2370 A
(since)210 2790 A
(there)210 3042 A
(are)126 3294 A
(too)126 3462 A
(many)168 3630 A
1440 V
(11411)210 648 A
1068(*)S
(references)420 1698 A
2160(to)S
2286(it)S
2412(to)S
(guard)210 2538 A
(conveniently.)546 2790 A
1530 V
(11412)210 648 A
1068(*)S
(lost_ticks:)462 1362 A
1620 V
(11413)210 648 A
1068(*)S
(Clock)210 1698 A
(ticks)210 1950 A
(counted)294 2202 A
(outside)294 2538 A
(the)126 2874 A
(clock)210 3042 A
(task.)210 3294 A
1710 V
(11414)210 648 A
1068(*)S
(sched_ticks,)504 1362 A
(prev_ptr:)378 1908 A
1800 V
(11415)210 648 A
1068(*)S
(Updating)336 1698 A
(these)210 2076 A
(competes)336 2328 A
(with)168 2706 A
(similar)294 2916 A
(code)168 3252 A
3462(in)S
(do_clocktick\(\).)630 3588 A
1890 V
(11416)210 648 A
1068(*)S
1698(No)S
(lock)168 1824 A
2034(is)S
(necessary,)420 2160 A
(because)294 2622 A
2958(if)S
(bad)126 3084 A
(things)252 3252 A
(happen)252 3546 A
(here)168 3840 A
1980 V
(11417)210 648 A
1068(*)S
(\(like)210 1698 A
(sched_ticks)462 1950 A
(going)210 2454 A
(negative\),)420 2706 A
(the)126 3168 A
(code)168 3336 A
3546(in)S
(do_clocktick\(\))588 3672 A
2070 V
(11418)210 648 A
1068(*)S
(will)168 1698 A
(restore)294 1908 A
(the)126 2244 A
(variables)378 2412 A
2832(to)S
(reasonable)420 2958 A
(values,)294 3420 A
(and)126 3756 A
3924(an)S
2160 V
(11419)210 648 A
1068(*)S
(occasional)420 1698 A
(missed)252 2160 A
2454(or)S
(extra)210 2580 A
(sched\(\))294 2832 A
3168(is)S
(harmless.)378 3294 A
2250 V
(11420)210 648 A
1068(*)S
2340 V
(11421)210 648 A
1068(*)S
(Are)126 1152 A
(these)210 1320 A
(complications)546 1572 A
(worth)210 2160 A
(the)126 2412 A
(trouble?)336 2580 A
(Well,)210 3000 A
(they)168 3252 A
(make)168 3462 A
(the)126 3672 A
(system)252 3840 A
(15%)126 4134 A
2430 V
(11422)210 648 A
1068(*)S
(faster)252 1152 A
1446(on)S
1572(a)S
(5MHz)168 1656 A
(8088,)210 1866 A
(and)126 2118 A
(make)168 2286 A
(task)168 2496 A
(debugging)378 2706 A
(much)168 3126 A
(easier)252 3336 A
(since)210 3630 A
(there)210 3882 A
(are)126 4134 A
2520 V
(11423)210 648 A
1068(*)S
1152(no)S
(task)168 1278 A
(switches)336 1488 A
1866(on)S
1992(an)S
(inactive)336 2118 A
(system.)294 2496 A
2610 V
(11424)210 648 A
1068(*/)S
2700 V
(11425)210 648 A
2790 V
(11426)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
2880 V
(11427)210 648 A
(register)336 1110 A
(unsigned)336 1488 A
(ticks;)252 1866 A
2970 V
(11428)210 648 A
(clock_t)294 1110 A
(now;)168 1446 A
3060 V
(11429)210 648 A
3150 V
(11430)210 648 A
1110(if)S
(\(ps_mca\))336 1236 A
1614({)S
3240 V
(11431)210 648 A
1362(/*)S
(Acknowledge)462 1488 A
(the)126 1992 A
(PS/2)168 2160 A
(clock)210 2370 A
(interrupt.)420 2622 A
3084(*/)S
3330 V
(11432)210 648 A
(out_byte\(PORT_B,)672 1362 A
(in_byte\(PORT_B\))630 2076 A
2748(|)S
(CLOCK_ACK_BIT\);)630 2832 A
3420 V
(11433)210 648 A
1110(})S
3510 V
(11434)210 648 A
3600 V
(11435)210 648 A
1110(/*)S
(Update)252 1236 A
(user)168 1530 A
(and)126 1740 A
(system)252 1908 A
(accounting)420 2202 A
(times.)252 2664 A
3690 V
(11436)210 648 A
1152(*)S
(First)210 1236 A
(charge)252 1488 A
(the)126 1782 A
(current)294 1950 A
(process)294 2286 A
(for)126 2622 A
(user)168 2790 A
(time.)210 3000 A
3780 V
(11437)210 648 A
1152(*)S
1236(If)S
(the)126 1362 A
(current)294 1530 A
(process)294 1866 A
2202(is)S
(not)126 2328 A
(the)126 2496 A
(billable)336 2664 A
(process)294 3042 A
(\(usually)336 3378 A
(because)294 3756 A
4092(it)S
3870 V
(11438)210 648 A
1152(*)S
1236(is)S
1362(a)S
(task\),)252 1446 A
(charge)252 1740 A
(the)126 2034 A
(billable)336 2202 A
(process)294 2580 A
(for)126 2916 A
(system)252 3084 A
(time)168 3378 A
3588(as)S
(well.)210 3714 A
3960 V
(11439)210 648 A
1152(*)S
(Thus)168 1236 A
(the)126 1446 A
(unbillable)420 1614 A
(tasks')252 2076 A
(user)168 2370 A
(time)168 2580 A
2790(is)S
(the)126 2916 A
(billable)336 3084 A
(users')252 3462 A
(system)252 3756 A
(time.)210 4050 A
4050 V
(11440)210 648 A
1152(*/)S
4140 V
(11441)210 648 A
1110(if)S
(\(k_reenter)420 1236 A
1698(!=)S
1824(0\))S
4230 V
(11442)210 648 A
1362(rp)S
1488(=)S
(proc_addr\(HARDWARE\);)840 1572 A
4320 V
(11443)210 648 A
(else)168 1110 A
4410 V
(11444)210 648 A
1362(rp)S
1488(=)S
(proc_ptr;)378 1572 A
4500 V
(11445)210 648 A
(ticks)210 1110 A
1362(=)S
(lost_ticks)420 1446 A
1908(+)S
1992(1;)S
4590 V
(11446)210 648 A
(lost_ticks)420 1110 A
1572(=)S
1656(0;)S
4680 V
(11447)210 648 A
(rp->user_time)546 1110 A
1698(+=)S
(ticks;)252 1824 A
4770 V
(11448)210 648 A
1110(if)S
(\(rp)126 1236 A
1404(!=)S
(bill_ptr)336 1530 A
1908(&&)S
2034(rp)S
2160(!=)S
(proc_addr\(IDLE\)\))672 2286 A
(bill_ptr->sys_time)756 3000 A
3798(+=)S
(ticks;)252 3924 A
4860 V
(11449)210 648 A
4950 V
(11450)210 648 A
(pending_ticks)546 1110 A
1698(+=)S
(ticks;)252 1824 A
5040 V
(11451)210 648 A
(now)126 1110 A
1278(=)S
(realtime)336 1362 A
1740(+)S
(pending_ticks;)588 1824 A
5130 V
(11452)210 648 A
1110(if)S
(\(tty_timeout)504 1236 A
1782(<=)S
(now\))168 1908 A
(tty_wakeup\(now\);)672 2118 A
3042(/*)S
(possibly)336 3168 A
(wake)168 3546 A
3756(up)S
(TTY)126 3882 A
4050(*/)S
5220 V
(11453)210 648 A
(pr_restart\(\);)546 1110 A
3042(/*)S
(possibly)336 3168 A
(restart)294 3546 A
(printer)294 3882 A
4218(*/)S
5310 V
(11454)210 648 A
5400 V
(11455)210 648 A
1110(if)S
(\(next_alarm)462 1236 A
1740(<=)S
(now)126 1866 A
2034(||)S
5490 V
(11456)210 648 A
(sched_ticks)462 1278 A
1782(==)S
1908(1)S
1992(&&)S
5580 V
(11457)210 648 A
(bill_ptr)336 1278 A
1656(==)S
(prev_ptr)336 1782 A
2160(&&)S
5670 V
(11458)210 648 A
(rdy_head[USER_Q])672 1278 A
1992(!=)S
(NIL_PROC\))378 2118 A
2538({)S
5760 V
(11459)210 648 A
(interrupt\(CLOCK\);)714 1362 A
5850 V
(11460)210 648 A
(return)252 1362 A
1656(1;)S
2034(/*)S
(Reenable)336 2160 A
(interrupts)420 2538 A
3000(*/)S
5940 V
(11461)210 648 A
1110(})S
6030 V
(11462)210 648 A
6120 V
(11463)210 648 A
1110(if)S
(\(--sched_ticks)588 1236 A
1866(==)S
1992(0\))S
2118({)S
6210 V
(11464)210 648 A
1362(/*)S
1488(If)S
(bill_ptr)336 1614 A
1992(==)S
(prev_ptr,)378 2118 A
2538(no)S
(ready)210 2664 A
(users)210 2916 A
3168(so)S
(don't)210 3294 A
(need)168 3546 A
(sched\(\).)336 3756 A
4134(*/)S
8418 V
EP
%%Page: 152 152
BP
/slant 0 def
/height 0 def
630 V
12 B
(152)180 648 A
11 R
2027(File:)S
2260(src/kernel/clock.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(11465)210 648 A
(sched_ticks)462 1362 A
1866(=)S
(SCHED_RATE;)462 1950 A
2706(/*)S
(reset)210 2832 A
(quantum)294 3084 A
3420(*/)S
990 V
(11466)210 648 A
(prev_ptr)336 1362 A
1740(=)S
(bill_ptr;)378 1824 A
2706(/*)S
(new)126 2832 A
(previous)336 3000 A
(process)294 3378 A
3714(*/)S
1080 V
(11467)210 648 A
1110(})S
1170 V
(11468)210 648 A
(return)252 1110 A
1404(1;)S
1698(/*)S
(Reenable)336 1824 A
(clock)210 2202 A
(interrupt)378 2454 A
2874(*/)S
1260 V
(11469)210 648 A
1026(})S
1440 V
(11471)210 648 A
(/*===========================================================================*)3276 1026 A
1530 V
(11472)210 648 A
1068(*)S
(init_clock)420 2370 A
4260(*)S
1620 V
(11473)210 648 A
(*===========================================================================*/)3276 1068 A
1710 V
(11474)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(init_clock\(\))504 1572 A
1800 V
(11475)210 648 A
1026({)S
1890 V
(11476)210 648 A
1026(/*)S
(Initialize)420 1152 A
(channel)294 1614 A
1950(0)S
2034(of)S
(the)126 2160 A
(8253A)210 2328 A
(timer)210 2580 A
2832(to)S
(e.g.)168 2958 A
3168(60)S
(Hz.)126 3294 A
3462(*/)S
1980 V
(11477)210 648 A
2070 V
(11478)210 648 A
(out_byte\(TIMER_MODE,)840 1110 A
(SQUARE_WAVE\);)546 1992 A
2706(/*)S
(set)126 2832 A
(timer)210 3000 A
3252(to)S
(run)126 3378 A
(continuously)504 3546 A
4092(*/)S
2160 V
(11479)210 648 A
(out_byte\(TIMER0,)672 1110 A
(TIMER_COUNT\);)546 1824 A
2706(/*)S
(load)168 2832 A
(timer)210 3042 A
(low)126 3294 A
(byte)168 3462 A
3672(*/)S
2250 V
(11480)210 648 A
(out_byte\(TIMER0,)672 1110 A
(TIMER_COUNT)462 1824 A
2328(>>)S
(8\);)126 2454 A
2706(/*)S
(load)168 2832 A
(timer)210 3042 A
(high)168 3294 A
(byte)168 3504 A
3714(*/)S
2340 V
(11481)210 648 A
(put_irq_handler\(CLOCK_IRQ,)1092 1110 A
(clock_handler\);)630 2244 A
3042(/*)S
(set)126 3168 A
(the)126 3336 A
(interrupt)378 3504 A
(handler)294 3924 A
4260(*/)S
2430 V
(11482)210 648 A
(enable_irq\(CLOCK_IRQ\);)924 1110 A
2706(/*)S
(ready)210 2832 A
(for)126 3084 A
(clock)210 3252 A
(interrupts)420 3504 A
3966(*/)S
2520 V
(11483)210 648 A
1026(})S
2790 V
(11486)210 648 A
(/*===========================================================================*)3276 1026 A
2880 V
(11487)210 648 A
1068(*)S
(clock_stop)420 2370 A
4260(*)S
2970 V
(11488)210 648 A
(*===========================================================================*/)3276 1068 A
3060 V
(11489)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(clock_stop\(\))504 1530 A
3150 V
(11490)210 648 A
1026({)S
3240 V
(11491)210 648 A
1026(/*)S
(Reset)210 1152 A
(the)126 1404 A
(clock)210 1572 A
1824(to)S
(the)126 1950 A
(BIOS)168 2118 A
(rate.)210 2328 A
(\(For)168 2580 A
(rebooting\))420 2790 A
3252(*/)S
3330 V
(11492)210 648 A
3420 V
(11493)210 648 A
(out_byte\(TIMER_MODE,)840 1110 A
(0x36\);)252 1992 A
3510 V
(11494)210 648 A
(out_byte\(TIMER0,)672 1110 A
(0\);)126 1824 A
3600 V
(11495)210 648 A
(out_byte\(TIMER0,)672 1110 A
(0\);)126 1824 A
3690 V
(11496)210 648 A
1026(})S
3960 V
(11499)210 648 A
(/*==========================================================================*)3234 1026 A
4050 V
(11500)210 648 A
1068(*)S
(milli_delay)462 2370 A
4218(*)S
4140 V
(11501)210 648 A
(*==========================================================================*/)3234 1068 A
4230 V
(11502)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(milli_delay\(millisec\))882 1530 A
4320 V
(11503)210 648 A
(unsigned)336 1026 A
(millisec;)378 1404 A
4410 V
(11504)210 648 A
1026({)S
4500 V
(11505)210 648 A
1026(/*)S
(Delay)210 1152 A
(some)168 1404 A
(milliseconds.)546 1614 A
2202(*/)S
4590 V
(11506)210 648 A
4680 V
(11507)210 648 A
(struct)252 1110 A
(milli_state)462 1404 A
(ms;)126 1908 A
4770 V
(11508)210 648 A
4860 V
(11509)210 648 A
(milli_start\(&ms\);)714 1110 A
4950 V
(11510)210 648 A
(while)210 1110 A
(\(milli_elapsed\(&ms\))798 1362 A
2202(<)S
(millisec\))378 2286 A
2706({})S
5040 V
(11511)210 648 A
1026(})S
5220 V
(11513)210 648 A
(/*==========================================================================*)3234 1026 A
5310 V
(11514)210 648 A
1068(*)S
(milli_start)462 2370 A
4218(*)S
5400 V
(11515)210 648 A
(*==========================================================================*/)3234 1068 A
5490 V
(11516)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(milli_start\(msp\))672 1530 A
5580 V
(11517)210 648 A
(struct)252 1026 A
(milli_state)462 1320 A
(*msp;)210 1824 A
5670 V
(11518)210 648 A
1026({)S
5760 V
(11519)210 648 A
1026(/*)S
(Prepare)294 1152 A
(for)126 1488 A
(calls)210 1656 A
1908(to)S
(milli_elapsed\(\).)672 2034 A
2748(*/)S
5850 V
(11520)210 648 A
5940 V
(11521)210 648 A
(msp->prev_count)630 1110 A
1782(=)S
1866(0;)S
6030 V
(11522)210 648 A
(msp->accum_count)672 1110 A
1824(=)S
1908(0;)S
6120 V
(11523)210 648 A
1026(})S
8418 V
EP
%%Page: 153 153
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2027(File:)S
2260(src/kernel/clock.c)S
12 B
(153)180 4248 A
990 V
7 LST
(11526)210 648 A
(/*==========================================================================*)3234 1026 A
1080 V
(11527)210 648 A
1068(*)S
(milli_elapsed)546 2370 A
4218(*)S
1170 V
(11528)210 648 A
(*==========================================================================*/)3234 1068 A
1260 V
(11529)210 648 A
(PUBLIC)252 1026 A
(unsigned)336 1320 A
(milli_elapsed\(msp\))756 1698 A
1350 V
(11530)210 648 A
(struct)252 1026 A
(milli_state)462 1320 A
(*msp;)210 1824 A
1440 V
(11531)210 648 A
1026({)S
1530 V
(11532)210 648 A
1026(/*)S
(Return)252 1152 A
(the)126 1446 A
(number)252 1614 A
1908(of)S
(milliseconds)504 2034 A
(since)210 2580 A
(the)126 2832 A
(call)168 3000 A
3210(to)S
(milli_start\(\).)588 3336 A
(Must)168 4008 A
4218(be)S
1620 V
(11533)210 648 A
1068(*)S
(polled)252 1152 A
(rapidly.)336 1446 A
1710 V
(11534)210 648 A
1068(*/)S
1800 V
(11535)210 648 A
(unsigned)336 1110 A
(count;)252 1488 A
1890 V
(11536)210 648 A
1980 V
(11537)210 648 A
1110(/*)S
(Read)168 1236 A
(the)126 1446 A
(counter)294 1614 A
(for)126 1950 A
(channel)294 2118 A
2454(0)S
2538(of)S
(the)126 2664 A
(8253A)210 2832 A
(timer.)252 3084 A
(The)126 3420 A
(counter)294 3588 A
2070 V
(11538)210 648 A
1152(*)S
(decrements)420 1236 A
1698(at)S
(twice)210 1824 A
(the)126 2076 A
(timer)210 2244 A
(frequency)378 2496 A
(\(one)168 2916 A
(full)168 3126 A
(cycle)210 3336 A
(for)126 3588 A
(each)168 3756 A
2160 V
(11539)210 648 A
1152(*)S
(half)168 1236 A
1446(of)S
(square)252 1572 A
(wave\).)252 1866 A
(The)126 2202 A
(counter)294 2370 A
(normally)336 2706 A
(has)126 3084 A
3252(a)S
(value)210 3336 A
(between)294 3588 A
3924(0)S
2250 V
(11540)210 648 A
1152(*)S
(and)126 1236 A
(TIMER_COUNT,)504 1404 A
(but)126 1950 A
(before)252 2118 A
(the)126 2412 A
(clock)210 2580 A
(task)168 2832 A
(has)126 3042 A
(been)168 3210 A
(initialized,)504 3420 A
2340 V
(11541)210 648 A
1152(*)S
(its)126 1236 A
(maximum)294 1404 A
(value)210 1740 A
1992(is)S
(65535,)252 2118 A
2412(as)S
(set)126 2538 A
2706(by)S
(the)126 2832 A
(BIOS.)210 3000 A
2430 V
(11542)210 648 A
1152(*/)S
2520 V
(11543)210 648 A
(out_byte\(TIMER_MODE,)840 1110 A
(LATCH_COUNT\);)546 1992 A
2706(/*)S
(make)168 2832 A
(chip)168 3042 A
(copy)168 3252 A
(count)210 3462 A
3714(to)S
(latch)210 3840 A
4092(*/)S
2610 V
(11544)210 648 A
(count)210 1110 A
1362(=)S
(in_byte\(TIMER0\);)672 1446 A
2370(/*)S
(countdown)378 2496 A
(continues)378 2916 A
(during)252 3336 A
(2-step)252 3630 A
(read)168 3924 A
4134(*/)S
2700 V
(11545)210 648 A
(count)210 1110 A
1362(|=)S
(in_byte\(TIMER0\))630 1488 A
2160(<<)S
2286(8;)S
2790 V
(11546)210 648 A
2880 V
(11547)210 648 A
1110(/*)S
(Add)126 1236 A
(difference)420 1404 A
(between)294 1866 A
(previous)336 2202 A
(and)126 2580 A
(new)126 2748 A
(count)210 2916 A
(unless)252 3168 A
(the)126 3462 A
(counter)294 3630 A
(has)126 3966 A
2970 V
(11548)210 648 A
1152(*)S
(increased)378 1236 A
(\(restarted)420 1656 A
(its)126 2118 A
(cycle\).)294 2286 A
2664(We)S
(may)126 2790 A
(lose)168 2958 A
3168(a)S
(tick)168 3252 A
(now)126 3462 A
(and)126 3630 A
(then,)210 3798 A
(but)126 4050 A
3060 V
(11549)210 648 A
1152(*)S
(microsecond)462 1236 A
(precision)378 1740 A
2160(is)S
(not)126 2286 A
(needed.)294 2454 A
3150 V
(11550)210 648 A
1152(*/)S
3240 V
(11551)210 648 A
(msp->accum_count)672 1110 A
1824(+=)S
(count)210 1950 A
2202(<=)S
(msp->prev_count)630 2328 A
3000(?)S
(\(msp->prev_count)672 3084 A
3798(-)S
(count\))252 3882 A
4176(:)S
4260(1;)S
3330 V
(11552)210 648 A
(msp->prev_count)630 1110 A
1782(=)S
(count;)252 1866 A
3420 V
(11553)210 648 A
3510 V
(11554)210 648 A
(return)252 1110 A
(msp->accum_count)672 1404 A
2118(/)S
(\(TIMER_FREQ)462 2202 A
2706(/)S
(1000\);)252 2790 A
3600 V
(11555)210 648 A
1026(})S
4140 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4230 V
(src/kernel/tty.h)672 2034 A
4320 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4500 V
(11600)210 648 A
1026(/*)S
(tty.h)210 1362 A
1614(-)S
(Terminals)378 1698 A
2370(*/)S
4590 V
(11601)210 648 A
4680 V
(11602)210 648 A
(#define)294 1026 A
(TTY_IN_BYTES)504 1362 A
(256)126 2076 A
2370(/*)S
(tty)126 2496 A
(input)210 2664 A
(queue)210 2916 A
(size)168 3168 A
3378(*/)S
4770 V
(11603)210 648 A
(#define)294 1026 A
(TAB_SIZE)336 1362 A
2160(8)S
2370(/*)S
(distance)336 2496 A
(between)294 2874 A
(tab)126 3210 A
(stops)210 3378 A
3630(*/)S
4860 V
(11604)210 648 A
(#define)294 1026 A
(TAB_MASK)336 1362 A
2160(7)S
2370(/*)S
(mask)168 2496 A
2706(to)S
(compute)294 2832 A
3168(a)S
(tab)126 3252 A
(stop)168 3420 A
(position)336 3630 A
4008(*/)S
4950 V
(11605)210 648 A
5040 V
(11606)210 648 A
(#define)294 1026 A
(ESC)126 1362 A
('\\33')210 2034 A
2370(/*)S
(escape)252 2496 A
2790(*/)S
5130 V
(11607)210 648 A
5220 V
(11608)210 648 A
(#define)294 1026 A
(O_NOCTTY)336 1362 A
(00400)210 1992 A
2370(/*)S
(from)168 2496 A
(<fcntl.h>,)420 2706 A
3168(or)S
3294(cc)S
(will)168 3420 A
(choke)210 3630 A
3882(*/)S
5310 V
(11609)210 648 A
(#define)294 1026 A
(O_NONBLOCK)420 1362 A
(04000)210 1992 A
5400 V
(11610)210 648 A
5490 V
(11611)210 648 A
(typedef)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(\(*devfun_t\),)504 2076 A
(\(struct)294 2622 A
(tty)126 2958 A
(*tp\))168 3126 A
3336(\);)S
5580 V
(11612)210 648 A
(typedef)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(\(*devfunarg_t\),)630 2076 A
(\(struct)294 2748 A
(tty)126 3084 A
(*tp,)168 3252 A
(int)126 3462 A
3630(c\))S
3756(\);)S
5670 V
(11613)210 648 A
5760 V
(11614)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
(tty)126 1656 A
1824({)S
5850 V
(11615)210 648 A
(int)126 1110 A
(tty_events;)462 1278 A
2370(/*)S
(set)126 2496 A
(when)168 2664 A
(TTY)126 2874 A
(should)252 3042 A
(inspect)294 3336 A
(this)168 3672 A
(line)168 3882 A
4092(*/)S
5940 V
(11616)210 648 A
6030 V
(11617)210 648 A
1110(/*)S
(Input)210 1236 A
(queue.)252 1488 A
(Typed)210 1824 A
(characters)420 2076 A
(are)126 2538 A
(stored)252 2706 A
(here)168 3000 A
(until)210 3210 A
(read)168 3462 A
3672(by)S
3798(a)S
(program.)336 3882 A
4260(*/)S
6120 V
(11618)210 648 A
(u16_t)210 1110 A
(*tty_inhead;)504 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(place)210 2958 A
(where)210 3210 A
(next)168 3462 A
(char)168 3672 A
(goes)168 3882 A
4092(*/)S
6210 V
(11619)210 648 A
(u16_t)210 1110 A
(*tty_intail;)504 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(next)168 2958 A
(char)168 3168 A
3378(to)S
3504(be)S
(given)210 3630 A
3882(to)S
(prog)168 4008 A
4218(*/)S
8418 V
EP
%%Page: 154 154
BP
/slant 0 def
/height 0 def
630 V
12 B
(154)180 648 A
11 R
2086(File:)S
(src/kernel/tty.h)670 2319 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(11620)210 648 A
(int)126 1110 A
(tty_incount;)504 1278 A
2370(/*)S
2496(#)S
(chars)210 2580 A
2832(in)S
(the)126 2958 A
(input)210 3126 A
(queue)210 3378 A
3630(*/)S
990 V
(11621)210 648 A
(int)126 1110 A
(tty_eotct;)420 1278 A
2370(/*)S
(number)252 2496 A
2790(of)S
("line)210 2916 A
(breaks")294 3168 A
3504(in)S
(input)210 3630 A
(queue)210 3882 A
4134(*/)S
1080 V
(11622)210 648 A
(devfun_t)336 1110 A
(tty_devread;)504 1488 A
2370(/*)S
(routine)294 2496 A
2832(to)S
(read)168 2958 A
(from)168 3168 A
(low)126 3378 A
(level)210 3546 A
(buffers)294 3798 A
4134(*/)S
1170 V
(11623)210 648 A
(devfun_t)336 1110 A
(tty_icancel;)504 1488 A
2370(/*)S
(cancel)252 2496 A
(any)126 2790 A
(device)252 2958 A
(input)210 3252 A
3504(*/)S
1260 V
(11624)210 648 A
(int)126 1110 A
(tty_min;)336 1278 A
2370(/*)S
(minimum)294 2496 A
(requested)378 2832 A
(#chars)252 3252 A
3546(in)S
(input)210 3672 A
(queue)210 3924 A
4176(*/)S
1350 V
(11625)210 648 A
(clock_t)294 1110 A
(tty_time;)378 1446 A
2370(/*)S
(time)168 2496 A
(when)168 2706 A
(the)126 2916 A
(input)210 3084 A
3336(is)S
(available)378 3462 A
3882(*/)S
1440 V
(11626)210 648 A
(struct)252 1110 A
(tty)126 1404 A
(*tty_timenext;)588 1572 A
2370(/*)S
(for)126 2496 A
2664(a)S
(list)168 2748 A
2958(of)S
(ttys)168 3084 A
(with)168 3294 A
(active)252 3504 A
(timers)252 3798 A
4092(*/)S
1530 V
(11627)210 648 A
1620 V
(11628)210 648 A
1110(/*)S
(Output)252 1236 A
(section.)336 1530 A
1908(*/)S
1710 V
(11629)210 648 A
(devfun_t)336 1110 A
(tty_devwrite;)546 1488 A
2370(/*)S
(routine)294 2496 A
2832(to)S
(start)210 2958 A
(actual)252 3210 A
(device)252 3504 A
(output)252 3798 A
4092(*/)S
1800 V
(11630)210 648 A
(devfunarg_t)462 1110 A
(tty_echo;)378 1614 A
2370(/*)S
(routine)294 2496 A
2832(to)S
(echo)168 2958 A
(characters)420 3168 A
(input)210 3630 A
3882(*/)S
1890 V
(11631)210 648 A
(devfun_t)336 1110 A
(tty_ocancel;)504 1488 A
2370(/*)S
(cancel)252 2496 A
(any)126 2790 A
(ongoing)294 2958 A
(device)252 3294 A
(output)252 3588 A
3882(*/)S
1980 V
(11632)210 648 A
(devfun_t)336 1110 A
(tty_break;)420 1488 A
2370(/*)S
(let)126 2496 A
(the)126 2664 A
(device)252 2832 A
(send)168 3126 A
3336(a)S
(break)210 3420 A
3672(*/)S
2070 V
(11633)210 648 A
2160 V
(11634)210 648 A
1110(/*)S
(Terminal)336 1236 A
(parameters)420 1614 A
(and)126 2076 A
(status.)294 2244 A
2580(*/)S
2250 V
(11635)210 648 A
(int)126 1110 A
(tty_position;)546 1278 A
2370(/*)S
(current)294 2496 A
(position)336 2832 A
3210(on)S
(the)126 3336 A
(screen)252 3504 A
(for)126 3798 A
(echoing)294 3966 A
4302(*/)S
2340 V
(11636)210 648 A
(char)168 1110 A
(tty_reprint;)504 1320 A
2370(/*)S
2496(1)S
(when)168 2580 A
(echoed)252 2790 A
(input)210 3084 A
(messed)252 3336 A
(up,)126 3630 A
(else)168 3798 A
4008(0)S
4092(*/)S
2430 V
(11637)210 648 A
(char)168 1110 A
(tty_escaped;)504 1320 A
2370(/*)S
2496(1)S
(when)168 2580 A
(LNEXT)210 2790 A
(\(\303V\))168 3042 A
(just)168 3252 A
(seen,)210 3462 A
(else)168 3714 A
3924(0)S
4008(*/)S
2520 V
(11638)210 648 A
(char)168 1110 A
(tty_inhibited;)588 1320 A
2370(/*)S
2496(1)S
(when)168 2580 A
(STOP)168 2790 A
(\(\303S\))168 3000 A
(just)168 3210 A
(seen)168 3420 A
(\(stops)252 3630 A
(output\))294 3924 A
4260(*/)S
2610 V
(11639)210 648 A
(char)168 1110 A
(tty_pgrp;)378 1320 A
2370(/*)S
(slot)168 2496 A
(number)252 2706 A
3000(of)S
(controlling)462 3126 A
(process)294 3630 A
3966(*/)S
2700 V
(11640)210 648 A
(char)168 1110 A
(tty_openct;)462 1320 A
2370(/*)S
(count)210 2496 A
2748(of)S
(number)252 2874 A
3168(of)S
(opens)210 3294 A
3546(of)S
(this)168 3672 A
(tty)126 3882 A
4050(*/)S
2790 V
(11641)210 648 A
2880 V
(11642)210 648 A
1110(/*)S
(Information)462 1236 A
(about)210 1740 A
(incomplete)420 1992 A
(I/O)126 2454 A
(requests)336 2622 A
3000(is)S
(stored)252 3126 A
(here.)210 3420 A
3672(*/)S
2970 V
(11643)210 648 A
(char)168 1110 A
(tty_inrepcode;)588 1320 A
2370(/*)S
(reply)210 2496 A
(code,)210 2748 A
(TASK_REPLY)420 3000 A
3462(or)S
(REVIVE)252 3588 A
3882(*/)S
3060 V
(11644)210 648 A
(char)168 1110 A
(tty_incaller;)546 1320 A
2370(/*)S
(process)294 2496 A
(that)168 2832 A
(made)168 3042 A
(the)126 3252 A
(call)168 3420 A
(\(usually)336 3630 A
(FS\))126 4008 A
4176(*/)S
3150 V
(11645)210 648 A
(char)168 1110 A
(tty_inproc;)462 1320 A
2370(/*)S
(process)294 2496 A
(that)168 2832 A
(wants)210 3042 A
3294(to)S
(read)168 3420 A
(from)168 3630 A
(tty)126 3840 A
4008(*/)S
3240 V
(11646)210 648 A
(vir_bytes)378 1110 A
(tty_in_vir;)462 1530 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
(where)210 3168 A
(data)168 3420 A
3630(is)S
3756(to)S
3882(go)S
4008(*/)S
3330 V
(11647)210 648 A
(int)126 1110 A
(tty_inleft;)462 1278 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(chars)210 2874 A
(are)126 3126 A
(still)210 3294 A
(needed)252 3546 A
3840(*/)S
3420 V
(11648)210 648 A
(int)126 1110 A
(tty_incum;)420 1278 A
2370(/*)S
2496(#)S
(chars)210 2580 A
(input)210 2832 A
3084(so)S
(far)126 3210 A
3378(*/)S
3510 V
(11649)210 648 A
(char)168 1110 A
(tty_outrepcode;)630 1320 A
2370(/*)S
(reply)210 2496 A
(code,)210 2748 A
(TASK_REPLY)420 3000 A
3462(or)S
(REVIVE)252 3588 A
3882(*/)S
3600 V
(11650)210 648 A
(char)168 1110 A
(tty_outcaller;)588 1320 A
2370(/*)S
(process)294 2496 A
(that)168 2832 A
(made)168 3042 A
(the)126 3252 A
(call)168 3420 A
(\(usually)336 3630 A
(FS\))126 4008 A
4176(*/)S
3690 V
(11651)210 648 A
(char)168 1110 A
(tty_outproc;)504 1320 A
2370(/*)S
(process)294 2496 A
(that)168 2832 A
(wants)210 3042 A
3294(to)S
(write)210 3420 A
3672(to)S
(tty)126 3798 A
3966(*/)S
3780 V
(11652)210 648 A
(vir_bytes)378 1110 A
(tty_out_vir;)504 1530 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
(where)210 3168 A
(data)168 3420 A
(comes)210 3630 A
(from)168 3882 A
4092(*/)S
3870 V
(11653)210 648 A
(int)126 1110 A
(tty_outleft;)504 1278 A
2370(/*)S
2496(#)S
(chars)210 2580 A
(yet)126 2832 A
3000(to)S
3126(be)S
(output)252 3252 A
3546(*/)S
3960 V
(11654)210 648 A
(int)126 1110 A
(tty_outcum;)462 1278 A
2370(/*)S
2496(#)S
(chars)210 2580 A
(output)252 2832 A
3126(so)S
(far)126 3252 A
3420(*/)S
4050 V
(11655)210 648 A
(char)168 1110 A
(tty_iocaller;)546 1320 A
2370(/*)S
(process)294 2496 A
(that)168 2832 A
(made)168 3042 A
(the)126 3252 A
(call)168 3420 A
(\(usually)336 3630 A
(FS\))126 4008 A
4176(*/)S
4140 V
(11656)210 648 A
(char)168 1110 A
(tty_ioproc;)462 1320 A
2370(/*)S
(process)294 2496 A
(that)168 2832 A
(wants)210 3042 A
3294(to)S
3420(do)S
3546(an)S
(ioctl)210 3672 A
3924(*/)S
4230 V
(11657)210 648 A
(int)126 1110 A
(tty_ioreq;)420 1278 A
2370(/*)S
(ioctl)210 2496 A
(request)294 2748 A
(code)168 3084 A
3294(*/)S
4320 V
(11658)210 648 A
(vir_bytes)378 1110 A
(tty_iovir;)420 1530 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
3168(of)S
(ioctl)210 3294 A
(buffer)252 3546 A
3840(*/)S
4410 V
(11659)210 648 A
4500 V
(11660)210 648 A
1110(/*)S
(Miscellaneous.)588 1236 A
1866(*/)S
4590 V
(11661)210 648 A
(devfun_t)336 1110 A
(tty_ioctl;)420 1488 A
2370(/*)S
(set)126 2496 A
(line)168 2664 A
(speed,)252 2874 A
(etc.)168 3168 A
3378(at)S
(the)126 3504 A
(device)252 3672 A
(level)210 3966 A
4218(*/)S
4680 V
(11662)210 648 A
(devfun_t)336 1110 A
(tty_close;)420 1488 A
2370(/*)S
(tell)168 2496 A
(the)126 2706 A
(device)252 2874 A
(that)168 3168 A
(the)126 3378 A
(tty)126 3546 A
3714(is)S
(closed)252 3840 A
4134(*/)S
4770 V
(11663)210 648 A
(void)168 1110 A
(*tty_priv;)420 1320 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(per)126 2958 A
(device)252 3126 A
(private)294 3420 A
(data)168 3756 A
3966(*/)S
4860 V
(11664)210 648 A
(struct)252 1110 A
(termios)294 1404 A
(tty_termios;)504 1740 A
2370(/*)S
(terminal)336 2496 A
(attributes)420 2874 A
3336(*/)S
4950 V
(11665)210 648 A
(struct)252 1110 A
(winsize)294 1404 A
(tty_winsize;)504 1740 A
2370(/*)S
(window)252 2496 A
(size)168 2790 A
(\(#lines)294 3000 A
(and)126 3336 A
(#columns\))378 3504 A
3924(*/)S
5040 V
(11666)210 648 A
5130 V
(11667)210 648 A
(u16_t)210 1110 A
(tty_inbuf[TTY_IN_BYTES];/*)1092 1362 A
(tty)126 2496 A
(input)210 2664 A
(buffer)252 2916 A
3210(*/)S
5220 V
(11668)210 648 A
1026(})S
(tty_t;)252 1110 A
5310 V
(11669)210 648 A
5400 V
(11670)210 648 A
(EXTERN)252 1026 A
(tty_t)210 1320 A
(tty_table[NR_CONS+NR_RS_LINES+NR_PTYS];)1638 1572 A
5490 V
(11671)210 648 A
5580 V
(11672)210 648 A
1026(/*)S
(Values)252 1152 A
(for)126 1446 A
(the)126 1614 A
(fields.)294 1782 A
2118(*/)S
5670 V
(11673)210 648 A
(#define)294 1026 A
(NOT_ESCAPED)462 1362 A
2160(0)S
2370(/*)S
(previous)336 2496 A
(character)378 2874 A
3294(is)S
(not)126 3420 A
(LNEXT)210 3588 A
(\(\303V\))168 3840 A
4050(*/)S
5760 V
(11674)210 648 A
(#define)294 1026 A
(ESCAPED)294 1362 A
2160(1)S
2370(/*)S
(previous)336 2496 A
(character)378 2874 A
(was)126 3294 A
(LNEXT)210 3462 A
(\(\303V\))168 3714 A
3924(*/)S
5850 V
(11675)210 648 A
(#define)294 1026 A
(RUNNING)294 1362 A
2160(0)S
2370(/*)S
2496(no)S
(STOP)168 2622 A
(\(\303S\))168 2832 A
(has)126 3042 A
(been)168 3210 A
(typed)210 3420 A
3672(to)S
(stop)168 3798 A
(output)252 4008 A
4302(*/)S
5940 V
(11676)210 648 A
(#define)294 1026 A
(STOPPED)294 1362 A
2160(1)S
2370(/*)S
(STOP)168 2496 A
(\(\303S\))168 2706 A
(has)126 2916 A
(been)168 3084 A
(typed)210 3294 A
3546(to)S
(stop)168 3672 A
(output)252 3882 A
4176(*/)S
6030 V
(11677)210 648 A
6120 V
(11678)210 648 A
1026(/*)S
(Fields)252 1152 A
(and)126 1446 A
(flags)210 1614 A
1866(on)S
(characters)420 1992 A
2454(in)S
(the)126 2580 A
(input)210 2748 A
(queue.)252 3000 A
3294(*/)S
6210 V
(11679)210 648 A
(#define)294 1026 A
(IN_CHAR)294 1362 A
(0x00FF)252 1950 A
2370(/*)S
(low)126 2496 A
2664(8)S
(bits)168 2748 A
(are)126 2958 A
(the)126 3126 A
(character)378 3294 A
(itself)252 3714 A
4008(*/)S
8418 V
EP
%%Page: 155 155
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2086(File:)S
(src/kernel/tty.h)670 2319 A
12 B
(155)180 4248 A
900 V
7 LST
(11680)210 648 A
(#define)294 1026 A
(IN_LEN)252 1362 A
(0x0F00)252 1950 A
2370(/*)S
(length)252 2496 A
2790(of)S
(char)168 2916 A
3126(if)S
3252(it)S
(has)126 3378 A
(been)168 3546 A
(echoed)252 3756 A
4050(*/)S
990 V
(11681)210 648 A
(#define)294 1026 A
(IN_LSHIFT)378 1362 A
2160(8)S
2370(/*)S
(length)252 2496 A
2790(=)S
2874(\(c)S
3000(&)S
(IN_LEN\))294 3084 A
3420(>>)S
(IN_LSHIFT)378 3546 A
3966(*/)S
1080 V
(11682)210 648 A
(#define)294 1026 A
(IN_EOT)252 1362 A
(0x1000)252 1950 A
2370(/*)S
(char)168 2496 A
2706(is)S
2832(a)S
(line)168 2916 A
(break)210 3126 A
(\(\303D,)168 3378 A
(LF\))126 3588 A
3756(*/)S
1170 V
(11683)210 648 A
(#define)294 1026 A
(IN_EOF)252 1362 A
(0x2000)252 1950 A
2370(/*)S
(char)168 2496 A
2706(is)S
(EOF)126 2832 A
(\(\303D\),)210 3000 A
3252(do)S
(not)126 3378 A
(return)252 3546 A
3840(to)S
(user)168 3966 A
4176(*/)S
1260 V
(11684)210 648 A
(#define)294 1026 A
(IN_ESC)252 1362 A
(0x4000)252 1950 A
2370(/*)S
(escaped)294 2496 A
2832(by)S
(LNEXT)210 2958 A
(\(\303V\),)210 3210 A
3462(no)S
(interpretation)588 3588 A
4218(*/)S
1350 V
(11685)210 648 A
1440 V
(11686)210 648 A
1026(/*)S
(Times)210 1152 A
(and)126 1404 A
(timeouts.)378 1572 A
1992(*/)S
1530 V
(11687)210 648 A
(#define)294 1026 A
(TIME_NEVER)420 1362 A
(\(\(clock_t\))420 2034 A
2496(-1)S
2622(<)S
2706(0)S
2790(?)S
(\(clock_t\))378 2874 A
(LONG_MAX)336 3294 A
3672(:)S
(\(clock_t\))378 3756 A
(-1\))126 4176 A
1620 V
(11688)210 648 A
(#define)294 1026 A
(force_timeout\(\))630 1362 A
(\(\(void\))294 2034 A
(\(tty_timeout)504 2370 A
2916(=)S
(0\)\))126 3000 A
1710 V
(11689)210 648 A
1800 V
(11690)210 648 A
(EXTERN)252 1026 A
(tty_t)210 1320 A
(*tty_timelist;)588 1572 A
2370(/*)S
(list)168 2496 A
2706(of)S
(ttys)168 2832 A
(with)168 3042 A
(active)252 3252 A
(timers)252 3546 A
3840(*/)S
1890 V
(11691)210 648 A
1980 V
(11692)210 648 A
1026(/*)S
(Number)252 1152 A
1446(of)S
(elements)336 1572 A
(and)126 1950 A
(limit)210 2118 A
2370(of)S
2496(a)S
(buffer.)294 2580 A
2916(*/)S
2070 V
(11693)210 648 A
(#define)294 1026 A
(buflen\(buf\))462 1362 A
(\(sizeof\(buf\))504 2034 A
2580(/)S
(sizeof\(\(buf\)[0]\)\))714 2664 A
2160 V
(11694)210 648 A
(#define)294 1026 A
(bufend\(buf\))462 1362 A
(\(\(buf\))252 2034 A
2328(+)S
(buflen\(buf\)\))504 2412 A
2790 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2880 V
(src/kernel/tty.c)672 2034 A
2970 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3150 V
(11700)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(terminal)336 2118 A
(driver,)294 2496 A
(both)168 2832 A
(for)126 3042 A
(the)126 3210 A
(IBM)126 3378 A
(console)294 3546 A
(and)126 3882 A
(regular)294 4050 A
3240 V
(11701)210 648 A
1068(*)S
(ASCII)210 1152 A
(terminals.)420 1404 A
1908(It)S
(handles)294 2034 A
(only)168 2370 A
(the)126 2580 A
(device-independent)756 2748 A
(part)168 3546 A
3756(of)S
3882(a)S
(TTY,)168 3966 A
(the)126 4176 A
3330 V
(11702)210 648 A
1068(*)S
(device)252 1152 A
(dependent)378 1446 A
(parts)210 1866 A
(are)126 2118 A
2286(in)S
(console.c,)420 2412 A
(rs232.c,)336 2874 A
(etc.)168 3252 A
(This)168 3504 A
(file)168 3714 A
(contains)336 3924 A
3420 V
(11703)210 648 A
1068(*)S
(two)126 1152 A
(main)168 1320 A
(entry)210 1530 A
(points,)294 1782 A
(tty_task\(\))420 2118 A
(and)126 2580 A
(tty_wakeup\(\),)546 2748 A
(and)126 3336 A
(several)294 3504 A
(minor)210 3840 A
(entry)210 4092 A
3510 V
(11704)210 648 A
1068(*)S
(points)252 1152 A
(for)126 1446 A
(use)126 1614 A
1782(by)S
(the)126 1908 A
(device-dependent)672 2076 A
(code.)210 2790 A
3600 V
(11705)210 648 A
1068(*)S
3690 V
(11706)210 648 A
1068(*)S
(The)126 1152 A
(device-independent)756 1320 A
(part)168 2118 A
(accepts)294 2328 A
("keyboard")420 2664 A
(input)210 3126 A
(from)168 3378 A
(the)126 3588 A
(device-)294 3756 A
3780 V
(11707)210 648 A
1068(*)S
(dependent)378 1152 A
(part,)210 1572 A
(performs)336 1824 A
(input)210 2202 A
(processing)420 2454 A
(\(special)336 2916 A
(key)126 3294 A
(interpretation\),)672 3462 A
3870 V
(11708)210 648 A
1068(*)S
(and)126 1152 A
(sends)210 1320 A
(the)126 1572 A
(input)210 1740 A
1992(to)S
2118(a)S
(process)294 2202 A
(reading)294 2538 A
(from)168 2874 A
(the)126 3084 A
(TTY.)168 3252 A
(Output)252 3504 A
3798(to)S
3924(a)S
(TTY)126 4008 A
3960 V
(11709)210 648 A
1068(*)S
1152(is)S
(sent)168 1278 A
1488(to)S
(the)126 1614 A
(device-dependent)672 1782 A
(code)168 2496 A
(for)126 2706 A
(output)252 2874 A
(processing)420 3168 A
(and)126 3630 A
("screen")336 3798 A
4050 V
(11710)210 648 A
1068(*)S
(display.)336 1152 A
(Input)210 1572 A
(processing)420 1824 A
2286(is)S
(done)168 2412 A
2622(by)S
(the)126 2748 A
(device)252 2916 A
3210(by)S
(calling)294 3336 A
('in_process')504 3672 A
4140 V
(11711)210 648 A
1068(*)S
1152(on)S
(the)126 1278 A
(input)210 1446 A
(characters,)462 1698 A
(output)252 2202 A
(processing)420 2496 A
(may)126 2958 A
3126(be)S
(done)168 3252 A
3462(by)S
(the)126 3588 A
(device)252 3756 A
(itself)252 4050 A
4230 V
(11712)210 648 A
1068(*)S
1152(or)S
1278(by)S
(calling)294 1404 A
('out_process'.)588 1740 A
(The)126 2412 A
(TTY)126 2580 A
(takes)210 2748 A
(care)168 3000 A
3210(of)S
(input)210 3336 A
(queuing,)336 3588 A
(the)126 3966 A
4320 V
(11713)210 648 A
1068(*)S
(device)252 1152 A
(does)168 1446 A
(the)126 1656 A
(output)252 1824 A
(queuing.)336 2118 A
2538(If)S
2664(a)S
(device)252 2748 A
(receives)336 3042 A
3420(an)S
(external)336 3546 A
(signal,)294 3924 A
4410 V
(11714)210 648 A
1068(*)S
(like)168 1152 A
1362(an)S
(interrupt,)420 1488 A
(then)168 1950 A
2160(it)S
(causes)252 2286 A
(tty_wakeup\(\))504 2580 A
3126(to)S
3252(be)S
(run)126 3378 A
3546(by)S
(the)126 3672 A
(CLOCK)210 3840 A
(task)168 4092 A
4500 V
(11715)210 648 A
1068(*)S
(to,)126 1152 A
(you)126 1320 A
(guessed)294 1488 A
(it,)126 1824 A
(wake)168 1992 A
2202(up)S
(the)126 2328 A
(TTY)126 2496 A
2664(to)S
(check)210 2790 A
3042(if)S
(input)210 3168 A
3420(or)S
(output)252 3546 A
(can)126 3840 A
4590 V
(11716)210 648 A
1068(*)S
(continue.)378 1152 A
4680 V
(11717)210 648 A
1068(*)S
4770 V
(11718)210 648 A
1068(*)S
(The)126 1152 A
(valid)210 1320 A
(messages)336 1572 A
(and)126 1950 A
(their)210 2118 A
(parameters)420 2370 A
(are:)168 2832 A
4860 V
(11719)210 648 A
1068(*)S
4950 V
(11720)210 648 A
1068(*)S
(HARD_INT:)378 1236 A
(output)252 1824 A
(has)126 2118 A
(been)168 2286 A
(completed)378 2496 A
2916(or)S
(input)210 3042 A
(has)126 3294 A
(arrived)294 3462 A
5040 V
(11721)210 648 A
1068(*)S
(DEV_READ:)378 1236 A
1824(a)S
(process)294 1908 A
(wants)210 2244 A
2496(to)S
(read)168 2622 A
(from)168 2832 A
3042(a)S
(terminal)336 3126 A
5130 V
(11722)210 648 A
1068(*)S
(DEV_WRITE:)420 1236 A
1824(a)S
(process)294 1908 A
(wants)210 2244 A
2496(to)S
(write)210 2622 A
2874(on)S
3000(a)S
(terminal)336 3084 A
5220 V
(11723)210 648 A
1068(*)S
(DEV_IOCTL:)420 1236 A
1824(a)S
(process)294 1908 A
(wants)210 2244 A
2496(to)S
(change)252 2622 A
2916(a)S
(terminal's)420 3000 A
(parameters)420 3462 A
5310 V
(11724)210 648 A
1068(*)S
(DEV_OPEN:)378 1236 A
1824(a)S
(tty)126 1908 A
(line)168 2076 A
(has)126 2286 A
(been)168 2454 A
(opened)252 2664 A
5400 V
(11725)210 648 A
1068(*)S
(DEV_CLOSE:)420 1236 A
1824(a)S
(tty)126 1908 A
(line)168 2076 A
(has)126 2286 A
(been)168 2454 A
(closed)252 2664 A
5490 V
(11726)210 648 A
1068(*)S
(CANCEL:)294 1236 A
(terminate)378 1824 A
2244(a)S
(previous)336 2328 A
(incomplete)420 2706 A
(system)252 3168 A
(call)168 3462 A
(immediately)462 3672 A
5580 V
(11727)210 648 A
1068(*)S
5670 V
(11728)210 648 A
1068(*)S
(m_type)252 1278 A
(TTY_LINE)336 1782 A
(PROC_NR)294 2244 A
(COUNT)210 2706 A
(TTY_SPEK)336 3042 A
(TTY_FLAGS)378 3462 A
(ADDRESS)294 3924 A
5760 V
(11729)210 648 A
1068(*)S
(---------------------------------------------------------------------------)3150 1152 A
5850 V
(11730)210 648 A
1068(*)S
1152(|)S
(HARD_INT)336 1236 A
1740(|)S
2160(|)S
2580(|)S
3000(|)S
3420(|)S
3840(|)S
4260(|)S
5940 V
(11731)210 648 A
1068(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1152 A
6030 V
(11732)210 648 A
1068(*)S
1152(|)S
(DEV_READ)336 1236 A
(|minor)252 1740 A
(dev|)168 2034 A
(proc)168 2244 A
2454(nr)S
2580(|)S
(count)210 2706 A
3000(|)S
(O_NONBLOCK|)462 3420 A
(buf)126 3924 A
(ptr)126 4092 A
4260(|)S
6120 V
(11733)210 648 A
1068(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1152 A
6210 V
(11734)210 648 A
1068(*)S
1152(|)S
(DEV_WRITE)378 1236 A
(|minor)252 1740 A
(dev|)168 2034 A
(proc)168 2244 A
2454(nr)S
2580(|)S
(count)210 2706 A
3000(|)S
3420(|)S
3840(|)S
(buf)126 3924 A
(ptr)126 4092 A
4260(|)S
8418 V
EP
%%Page: 156 156
BP
/slant 0 def
/height 0 def
630 V
12 B
(156)180 648 A
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(11735)210 648 A
1068(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1152 A
990 V
(11736)210 648 A
1068(*)S
1152(|)S
(DEV_IOCTL)378 1236 A
(|minor)252 1740 A
(dev|)168 2034 A
(proc)168 2244 A
2454(nr)S
(|func)210 2580 A
(code|erase)420 2832 A
(etc|)168 3294 A
(flags)210 3546 A
3840(|)S
4260(|)S
1080 V
(11737)210 648 A
1068(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1152 A
1170 V
(11738)210 648 A
1068(*)S
1152(|)S
(DEV_OPEN)336 1236 A
(|minor)252 1740 A
(dev|)168 2034 A
(proc)168 2244 A
2454(nr)S
2580(|)S
(O_NOCTTY|)378 2664 A
3420(|)S
3840(|)S
4260(|)S
1260 V
(11739)210 648 A
1068(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1152 A
1350 V
(11740)210 648 A
1068(*)S
1152(|)S
(DEV_CLOSE)378 1236 A
(|minor)252 1740 A
(dev|)168 2034 A
(proc)168 2244 A
2454(nr)S
2580(|)S
3000(|)S
3420(|)S
3840(|)S
4260(|)S
1440 V
(11741)210 648 A
1068(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1152 A
1530 V
(11742)210 648 A
1068(*)S
1152(|)S
(CANCEL)252 1236 A
(|minor)252 1740 A
(dev|)168 2034 A
(proc)168 2244 A
2454(nr)S
2580(|)S
3000(|)S
3420(|)S
3840(|)S
4260(|)S
1620 V
(11743)210 648 A
1068(*)S
(---------------------------------------------------------------------------)3150 1152 A
1710 V
(11744)210 648 A
1068(*/)S
1800 V
(11745)210 648 A
1890 V
(11746)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
1980 V
(11747)210 648 A
(#include)336 1026 A
(<termios.h>)462 1404 A
2070 V
(11748)210 648 A
(#include)336 1026 A
(<sys/ioctl.h>)546 1404 A
2160 V
(11749)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
2250 V
(11750)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
2340 V
(11751)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
2430 V
(11752)210 648 A
(#include)336 1026 A
(<minix/keymap.h>)672 1404 A
2520 V
(11753)210 648 A
(#include)336 1026 A
("tty.h")294 1404 A
2610 V
(11754)210 648 A
(#include)336 1026 A
("proc.h")336 1404 A
2700 V
(11755)210 648 A
2790 V
(11756)210 648 A
1026(/*)S
(Address)294 1152 A
1488(of)S
1614(a)S
(tty)126 1698 A
(structure.)420 1866 A
2328(*/)S
2880 V
(11757)210 648 A
(#define)294 1026 A
(tty_addr\(line\))588 1362 A
(\(&tty_table[line]\))756 2034 A
2970 V
(11758)210 648 A
3060 V
(11759)210 648 A
1026(/*)S
(First)210 1152 A
(minor)210 1404 A
(numbers)294 1656 A
(for)126 1992 A
(the)126 2160 A
(various)294 2328 A
(classes)294 2664 A
3000(of)S
(TTY)126 3126 A
(devices.)336 3294 A
3672(*/)S
3150 V
(11760)210 648 A
(#define)294 1026 A
(CONS_MINOR)420 1362 A
2118(0)S
3240 V
(11761)210 648 A
(#define)294 1026 A
(LOG_MINOR)378 1362 A
2076(15)S
3330 V
(11762)210 648 A
(#define)294 1026 A
(RS232_MINOR)462 1362 A
2076(16)S
3420 V
(11763)210 648 A
(#define)294 1026 A
(TTYPX_MINOR)462 1362 A
(128)126 2034 A
3510 V
(11764)210 648 A
(#define)294 1026 A
(PTYPX_MINOR)462 1362 A
(192)126 2034 A
3600 V
(11765)210 648 A
3690 V
(11766)210 648 A
1026(/*)S
(Macros)252 1152 A
(for)126 1446 A
(magic)210 1614 A
(tty)126 1866 A
(types.)252 2034 A
2328(*/)S
3780 V
(11767)210 648 A
(#define)294 1026 A
(isconsole\(tp\))546 1362 A
(\(\(tp\))210 2034 A
2286(<)S
(tty_addr\(NR_CONS\)\))756 2370 A
3870 V
(11768)210 648 A
3960 V
(11769)210 648 A
1026(/*)S
(Macros)252 1152 A
(for)126 1446 A
(magic)210 1614 A
(tty)126 1866 A
(structure)378 2034 A
(pointers.)378 2454 A
2874(*/)S
4050 V
(11770)210 648 A
(#define)294 1026 A
(FIRST_TTY)378 1362 A
(tty_addr\(0\))462 2034 A
4140 V
(11771)210 648 A
(#define)294 1026 A
(END_TTY)294 1362 A
(tty_addr\(sizeof\(tty_table\))1092 2034 A
3168(/)S
(sizeof\(tty_table[0]\)\))882 3252 A
4230 V
(11772)210 648 A
4320 V
(11773)210 648 A
1026(/*)S
1152(A)S
(device)252 1236 A
(exists)252 1530 A
1824(if)S
1950(at)S
(least)210 2076 A
(its)126 2328 A
('devread')378 2496 A
(function)336 2916 A
3294(is)S
(defined.)336 3420 A
3798(*/)S
4410 V
(11774)210 648 A
(#define)294 1026 A
(tty_active\(tp\))588 1362 A
(\(\(tp\)->tty_devread)756 2034 A
2832(!=)S
(NULL\))210 2958 A
4500 V
(11775)210 648 A
4590 V
(11776)210 648 A
1026(/*)S
(RS232)210 1152 A
(lines)210 1404 A
1656(or)S
(pseudo)252 1782 A
(terminals)378 2076 A
(can)126 2496 A
2664(be)S
(completely)420 2790 A
(configured)420 3252 A
(out.)168 3714 A
3924(*/)S
4680 V
(11777)210 648 A
(#if)126 1026 A
(NR_RS_LINES)462 1194 A
1698(==)S
1824(0)S
4770 V
(11778)210 648 A
(#define)294 1026 A
(rs_init\(tp\))462 1362 A
(\(\(void\))294 2034 A
2370(0\))S
4860 V
(11779)210 648 A
(#endif)252 1026 A
4950 V
(11780)210 648 A
(#if)126 1026 A
(NR_PTYS)294 1194 A
1530(==)S
1656(0)S
5040 V
(11781)210 648 A
(#define)294 1026 A
(pty_init\(tp\))504 1362 A
(\(\(void\))294 2034 A
2370(0\))S
5130 V
(11782)210 648 A
(#define)294 1026 A
(do_pty\(tp,)420 1362 A
(mp\))126 1824 A
(\(\(void\))294 2034 A
2370(0\))S
5220 V
(11783)210 648 A
(#endif)252 1026 A
5310 V
(11784)210 648 A
5400 V
(11785)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_cancel,)420 2076 A
(\(tty_t)252 2538 A
(*tp,)168 2832 A
(message)294 3042 A
(*m_ptr\))294 3378 A
4050(\);)S
5490 V
(11786)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_ioctl,)378 2076 A
(\(tty_t)252 2496 A
(*tp,)168 2790 A
(message)294 3000 A
(*m_ptr\))294 3336 A
4050(\);)S
5580 V
(11787)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_open,)336 2076 A
(\(tty_t)252 2454 A
(*tp,)168 2748 A
(message)294 2958 A
(*m_ptr\))294 3294 A
4050(\);)S
5670 V
(11788)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_close,)378 2076 A
(\(tty_t)252 2496 A
(*tp,)168 2790 A
(message)294 3000 A
(*m_ptr\))294 3336 A
4050(\);)S
5760 V
(11789)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_read,)336 2076 A
(\(tty_t)252 2454 A
(*tp,)168 2748 A
(message)294 2958 A
(*m_ptr\))294 3294 A
4050(\);)S
5850 V
(11790)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_write,)378 2076 A
(\(tty_t)252 2496 A
(*tp,)168 2790 A
(message)294 3000 A
(*m_ptr\))294 3336 A
4050(\);)S
5940 V
(11791)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(in_transfer,)504 2076 A
(\(tty_t)252 2622 A
(*tp\))168 2916 A
4050(\);)S
6030 V
(11792)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(echo,)210 2034 A
(\(tty_t)252 2286 A
(*tp,)168 2580 A
(int)126 2790 A
(ch\))126 2958 A
4050(\);)S
6120 V
(11793)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(rawecho,)336 2076 A
(\(tty_t)252 2454 A
(*tp,)168 2748 A
(int)126 2958 A
(ch\))126 3126 A
4050(\);)S
6210 V
(11794)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(back_over,)420 2034 A
(\(tty_t)252 2496 A
(*tp\))168 2790 A
4050(\);)S
8418 V
EP
%%Page: 157 157
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
12 B
(157)180 4248 A
900 V
7 LST
(11795)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(reprint,)336 2076 A
(\(tty_t)252 2454 A
(*tp\))168 2748 A
4050(\);)S
990 V
(11796)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(dev_ioctl,)420 2076 A
(\(tty_t)252 2538 A
(*tp\))168 2832 A
4050(\);)S
1080 V
(11797)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(setattr,)336 2076 A
(\(tty_t)252 2454 A
(*tp\))168 2748 A
4050(\);)S
1170 V
(11798)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(tty_icancel,)504 2076 A
(\(tty_t)252 2622 A
(*tp\))168 2916 A
4050(\);)S
1260 V
(11799)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(tty_init,)378 2076 A
(\(tty_t)252 2496 A
(*tp\))168 2790 A
4050(\);)S
1350 V
(11800)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(settimer,)378 2076 A
(\(tty_t)252 2496 A
(*tp,)168 2790 A
(int)126 3000 A
(on\))126 3168 A
4050(\);)S
1440 V
(11801)210 648 A
1530 V
(11802)210 648 A
1026(/*)S
(Default)294 1152 A
(attributes.)462 1488 A
1992(*/)S
1620 V
(11803)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(termios)294 1656 A
(termios_defaults)672 1992 A
2706(=)S
2790({)S
1710 V
(11804)210 648 A
(TINPUT_DEF,)462 1110 A
(TOUTPUT_DEF,)504 1614 A
(TCTRL_DEF,)420 2160 A
(TLOCAL_DEF,)462 2622 A
(TSPEED_DEF,)462 3126 A
(TSPEED_DEF,)462 3630 A
1800 V
(11805)210 648 A
1110({)S
1890 V
(11806)210 648 A
(TEOF_DEF,)378 1362 A
(TEOL_DEF,)378 1782 A
(TERASE_DEF,)462 2202 A
(TINTR_DEF,)420 2706 A
(TKILL_DEF,)420 3168 A
(TMIN_DEF,)378 3630 A
1980 V
(11807)210 648 A
(TQUIT_DEF,)420 1362 A
(TTIME_DEF,)420 1824 A
(TSUSP_DEF,)420 2286 A
(TSTART_DEF,)462 2748 A
(TSTOP_DEF,)420 3252 A
2070 V
(11808)210 648 A
(TREPRINT_DEF,)546 1362 A
(TLNEXT_DEF,)462 1950 A
(TDISCARD_DEF,)546 2454 A
2160 V
(11809)210 648 A
1110(},)S
2250 V
(11810)210 648 A
1026(};)S
2340 V
(11811)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(winsize)294 1656 A
(winsize_defaults;)714 1992 A
3042(/*)S
3168(=)S
(all)126 3252 A
(zeroes)252 3420 A
3714(*/)S
2430 V
(11812)210 648 A
2520 V
(11813)210 648 A
2610 V
(11814)210 648 A
(/*===========================================================================*)3276 1026 A
2700 V
(11815)210 648 A
1068(*)S
(tty_task)336 2370 A
4260(*)S
2790 V
(11816)210 648 A
(*===========================================================================*/)3276 1068 A
2880 V
(11817)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(tty_task\(\))420 1530 A
2970 V
(11818)210 648 A
1026({)S
3060 V
(11819)210 648 A
1026(/*)S
(Main)168 1152 A
(routine)294 1362 A
1698(of)S
(the)126 1824 A
(terminal)336 1992 A
(task.)210 2370 A
2622(*/)S
3150 V
(11820)210 648 A
3240 V
(11821)210 648 A
(message)294 1110 A
(tty_mess;)378 1446 A
2370(/*)S
(buffer)252 2496 A
(for)126 2790 A
(all)126 2958 A
(incoming)336 3126 A
(messages)336 3504 A
3882(*/)S
3330 V
(11822)210 648 A
(register)336 1110 A
(tty_t)210 1488 A
(*tp;)168 1740 A
3420 V
(11823)210 648 A
(unsigned)336 1110 A
(line;)210 1488 A
3510 V
(11824)210 648 A
3600 V
(11825)210 648 A
1110(/*)S
(Initialize)420 1236 A
(the)126 1698 A
(terminal)336 1866 A
(lines.)252 2244 A
2538(*/)S
3690 V
(11826)210 648 A
(for)126 1110 A
(\(tp)126 1278 A
1446(=)S
(FIRST_TTY;)420 1530 A
1992(tp)S
2118(<)S
(END_TTY;)336 2202 A
(tp++\))210 2580 A
(tty_init\(tp\);)546 2832 A
3780 V
(11827)210 648 A
3870 V
(11828)210 648 A
1110(/*)S
(Display)294 1236 A
(the)126 1572 A
(Minix)210 1740 A
(startup)294 1992 A
(banner.)294 2328 A
2664(*/)S
3960 V
(11829)210 648 A
(printf\("Minix)546 1110 A
(%s.%s)210 1698 A
(Copyright)378 1992 A
(1997)168 2412 A
(Prentice-Hall,)588 2622 A
(Inc.\\n\\n",)420 3252 A
4050 V
(11830)210 648 A
(OS_RELEASE,)462 3042 A
(OS_VERSION\);)504 3546 A
4140 V
(11831)210 648 A
(printf\("Executing)714 1110 A
1866(in)S
(32-bit)252 1992 A
(protected)378 2286 A
(mode\\n\\n"\);)462 2706 A
4230 V
(11832)210 648 A
4320 V
(11833)210 648 A
(while)210 1110 A
(\(TRUE\))252 1362 A
1656({)S
4410 V
(11834)210 648 A
1362(/*)S
(Handle)252 1488 A
(any)126 1782 A
(events)252 1950 A
2244(on)S
(any)126 2370 A
2538(of)S
(the)126 2664 A
(ttys.)210 2832 A
3084(*/)S
4500 V
(11835)210 648 A
(for)126 1362 A
(\(tp)126 1530 A
1698(=)S
(FIRST_TTY;)420 1782 A
2244(tp)S
2370(<)S
(END_TTY;)336 2454 A
(tp++\))210 2832 A
3084({)S
4590 V
(11836)210 648 A
1698(if)S
(\(tp->tty_events\))672 1824 A
(handle_events\(tp\);)756 2538 A
4680 V
(11837)210 648 A
1362(})S
4770 V
(11838)210 648 A
4860 V
(11839)210 648 A
(receive\(ANY,)504 1362 A
(&tty_mess\);)462 1908 A
4950 V
(11840)210 648 A
5040 V
(11841)210 648 A
1362(/*)S
1488(A)S
(hardware)336 1572 A
(interrupt)378 1950 A
2370(is)S
2496(an)S
(invitation)420 2622 A
3084(to)S
(check)210 3210 A
(for)126 3462 A
(events.)294 3630 A
3966(*/)S
5130 V
(11842)210 648 A
1362(if)S
(\(tty_mess.m_type)672 1488 A
2202(==)S
(HARD_INT\))378 2328 A
(continue;)378 2748 A
5220 V
(11843)210 648 A
5310 V
(11844)210 648 A
1362(/*)S
(Check)210 1488 A
(the)126 1740 A
(minor)210 1908 A
(device)252 2160 A
(number.)294 2454 A
2790(*/)S
5400 V
(11845)210 648 A
(line)168 1362 A
1572(=)S
(tty_mess.TTY_LINE;)756 1656 A
5490 V
(11846)210 648 A
1362(if)S
(\(\(line)252 1488 A
1782(-)S
(CONS_MINOR\))462 1866 A
2370(<)S
(NR_CONS\))336 2454 A
2832({)S
5580 V
(11847)210 648 A
1698(tp)S
1824(=)S
(tty_addr\(line)546 1908 A
2496(-)S
(CONS_MINOR\);)504 2580 A
5670 V
(11848)210 648 A
1362(})S
(else)168 1446 A
5760 V
(11849)210 648 A
1362(if)S
(\(line)210 1488 A
1740(==)S
(LOG_MINOR\))420 1866 A
2328({)S
5850 V
(11850)210 648 A
1698(tp)S
1824(=)S
(tty_addr\(0\);)504 1908 A
5940 V
(11851)210 648 A
1362(})S
(else)168 1446 A
6030 V
(11852)210 648 A
1362(if)S
(\(\(line)252 1488 A
1782(-)S
(RS232_MINOR\))504 1866 A
2412(<)S
(NR_RS_LINES\))504 2496 A
3042({)S
6120 V
(11853)210 648 A
1698(tp)S
1824(=)S
(tty_addr\(line)546 1908 A
2496(-)S
(RS232_MINOR)462 2580 A
3084(+)S
(NR_CONS\);)378 3168 A
6210 V
(11854)210 648 A
1362(})S
(else)168 1446 A
8418 V
EP
%%Page: 158 158
BP
/slant 0 def
/height 0 def
630 V
12 B
(158)180 648 A
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(11855)210 648 A
1362(if)S
(\(\(line)252 1488 A
1782(-)S
(TTYPX_MINOR\))504 1866 A
2412(<)S
(NR_PTYS\))336 2496 A
2874({)S
990 V
(11856)210 648 A
1698(tp)S
1824(=)S
(tty_addr\(line)546 1908 A
2496(-)S
(TTYPX_MINOR)462 2580 A
3084(+)S
(NR_CONS)294 3168 A
3504(+)S
(NR_RS_LINES\);)546 3588 A
1080 V
(11857)210 648 A
1362(})S
(else)168 1446 A
1170 V
(11858)210 648 A
1362(if)S
(\(\(line)252 1488 A
1782(-)S
(PTYPX_MINOR\))504 1866 A
2412(<)S
(NR_PTYS\))336 2496 A
2874({)S
1260 V
(11859)210 648 A
1698(tp)S
1824(=)S
(tty_addr\(line)546 1908 A
2496(-)S
(PTYPX_MINOR)462 2580 A
3084(+)S
(NR_CONS)294 3168 A
3504(+)S
(NR_RS_LINES\);)546 3588 A
1350 V
(11860)210 648 A
(do_pty\(tp,)420 1698 A
(&tty_mess\);)462 2160 A
1440 V
(11861)210 648 A
(continue;)378 1698 A
3042(/*)S
(this)168 3168 A
3378(is)S
3504(a)S
(pty,)168 3588 A
(not)126 3798 A
3966(a)S
(tty)126 4050 A
4218(*/)S
1530 V
(11862)210 648 A
1362(})S
(else)168 1446 A
1656({)S
1620 V
(11863)210 648 A
1698(tp)S
1824(=)S
(NULL;)210 1908 A
1710 V
(11864)210 648 A
1362(})S
1800 V
(11865)210 648 A
1890 V
(11866)210 648 A
1362(/*)S
1488(If)S
(the)126 1614 A
(device)252 1782 A
(doesn't)294 2076 A
(exist)210 2412 A
2664(or)S
2790(is)S
(not)126 2916 A
(configured)420 3084 A
(return)252 3546 A
(ENXIO.)252 3840 A
4134(*/)S
1980 V
(11867)210 648 A
1362(if)S
(\(tp)126 1488 A
1656(==)S
(NULL)168 1782 A
1992(||)S
(!tty_active\(tp\)\))672 2118 A
2832({)S
2070 V
(11868)210 648 A
(tty_reply\(TASK_REPLY,)882 1698 A
(tty_mess.m_source,)756 2622 A
2160 V
(11869)210 648 A
(tty_mess.PROC_NR,)714 3042 A
(ENXIO\);)294 3798 A
2250 V
(11870)210 648 A
(continue;)378 1698 A
2340 V
(11871)210 648 A
1362(})S
2430 V
(11872)210 648 A
2520 V
(11873)210 648 A
1362(/*)S
(Execute)294 1488 A
(the)126 1824 A
(requested)378 1992 A
(function.)378 2412 A
2832(*/)S
2610 V
(11874)210 648 A
(switch)252 1362 A
(\(tty_mess.m_type\))714 1656 A
2412({)S
2700 V
(11875)210 648 A
(case)168 1530 A
(DEV_READ:)378 1740 A
(do_read\(tp,)462 2370 A
(&tty_mess\);)462 2874 A
(break;)252 3714 A
2790 V
(11876)210 648 A
(case)168 1530 A
(DEV_WRITE:)420 1740 A
(do_write\(tp,)504 2370 A
(&tty_mess\);)462 2916 A
(break;)252 3714 A
2880 V
(11877)210 648 A
(case)168 1530 A
(DEV_IOCTL:)420 1740 A
(do_ioctl\(tp,)504 2370 A
(&tty_mess\);)462 2916 A
(break;)252 3714 A
2970 V
(11878)210 648 A
(case)168 1530 A
(DEV_OPEN:)378 1740 A
(do_open\(tp,)462 2370 A
(&tty_mess\);)462 2874 A
(break;)252 3714 A
3060 V
(11879)210 648 A
(case)168 1530 A
(DEV_CLOSE:)420 1740 A
(do_close\(tp,)504 2370 A
(&tty_mess\);)462 2916 A
(break;)252 3714 A
3150 V
(11880)210 648 A
(case)168 1530 A
(CANCEL:)294 1740 A
(do_cancel\(tp,)546 2370 A
(&tty_mess\);)462 2958 A
(break;)252 3714 A
3240 V
(11881)210 648 A
(default:)336 1530 A
(tty_reply\(TASK_REPLY,)882 2370 A
(tty_mess.m_source,)756 3294 A
3330 V
(11882)210 648 A
(tty_mess.PROC_NR,)714 3042 A
(EINVAL\);)336 3798 A
3420 V
(11883)210 648 A
1362(})S
3510 V
(11884)210 648 A
1110(})S
3600 V
(11885)210 648 A
1026(})S
3870 V
(11888)210 648 A
(/*===========================================================================*)3276 1026 A
3960 V
(11889)210 648 A
1068(*)S
(do_read)294 2370 A
4260(*)S
4050 V
(11890)210 648 A
(*===========================================================================*/)3276 1068 A
4140 V
(11891)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_read\(tp,)462 1572 A
(m_ptr\))252 2076 A
4230 V
(11892)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(tty)126 2958 A
(struct)252 3126 A
3420(*/)S
4320 V
(11893)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
(sent)168 3294 A
3504(to)S
(the)126 3630 A
(task)168 3798 A
4008(*/)S
4410 V
(11894)210 648 A
1026({)S
4500 V
(11895)210 648 A
1026(/*)S
1152(A)S
(process)294 1236 A
(wants)210 1572 A
1824(to)S
(read)168 1950 A
(from)168 2160 A
2370(a)S
(terminal.)378 2454 A
2874(*/)S
4590 V
(11896)210 648 A
(int)126 1110 A
1278(r;)S
4680 V
(11897)210 648 A
4770 V
(11898)210 648 A
1110(/*)S
(Check)210 1236 A
1488(if)S
(there)210 1614 A
1866(is)S
(already)294 1992 A
2328(a)S
(process)294 2412 A
(hanging)294 2748 A
3084(in)S
3210(a)S
(read,)210 3294 A
(check)210 3546 A
3798(if)S
(the)126 3924 A
4860 V
(11899)210 648 A
1152(*)S
(parameters)420 1236 A
(are)126 1698 A
(correct,)336 1866 A
2244(do)S
(I/O.)168 2370 A
4950 V
(11900)210 648 A
1152(*/)S
5040 V
(11901)210 648 A
1110(if)S
(\(tp->tty_inleft)630 1236 A
1908(>)S
1992(0\))S
2118({)S
5130 V
(11902)210 648 A
1362(r)S
1446(=)S
(EIO;)168 1530 A
5220 V
(11903)210 648 A
1110(})S
(else)168 1194 A
5310 V
(11904)210 648 A
1110(if)S
(\(m_ptr->COUNT)546 1236 A
1824(<=)S
1950(0\))S
2076({)S
5400 V
(11905)210 648 A
1362(r)S
1446(=)S
(EINVAL;)294 1530 A
5490 V
(11906)210 648 A
1110(})S
(else)168 1194 A
5580 V
(11907)210 648 A
1110(if)S
(\(numap\(m_ptr->PROC_NR,)924 1236 A
(\(vir_bytes\))462 2202 A
(m_ptr->ADDRESS,)630 2706 A
(m_ptr->COUNT\))546 3378 A
3966(==)S
4092(0\))S
4218({)S
5670 V
(11908)210 648 A
1362(r)S
1446(=)S
(EFAULT;)294 1530 A
5760 V
(11909)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5850 V
(11910)210 648 A
1362(/*)S
(Copy)168 1488 A
(information)462 1698 A
(from)168 2202 A
(the)126 2412 A
(message)294 2580 A
2916(to)S
(the)126 3042 A
(tty)126 3210 A
(struct.)294 3378 A
3714(*/)S
5940 V
(11911)210 648 A
(tp->tty_inrepcode)714 1362 A
2118(=)S
(TASK_REPLY;)462 2202 A
6030 V
(11912)210 648 A
(tp->tty_incaller)672 1362 A
2076(=)S
(m_ptr->m_source;)672 2160 A
6120 V
(11913)210 648 A
(tp->tty_inproc)588 1362 A
1992(=)S
(m_ptr->PROC_NR;)630 2076 A
6210 V
(11914)210 648 A
(tp->tty_in_vir)588 1362 A
1992(=)S
(\(vir_bytes\))462 2076 A
(m_ptr->ADDRESS;)630 2580 A
8418 V
EP
%%Page: 159 159
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
12 B
(159)180 4248 A
900 V
7 LST
(11915)210 648 A
(tp->tty_inleft)588 1362 A
1992(=)S
(m_ptr->COUNT;)546 2076 A
990 V
(11916)210 648 A
1080 V
(11917)210 648 A
1362(if)S
(\(!\(tp->tty_termios.c_lflag)1092 1488 A
2622(&)S
(ICANON\))294 2706 A
1170 V
(11918)210 648 A
2706(&&)S
(tp->tty_termios.c_cc[VTIME])1134 2832 A
4008(>)S
4092(0\))S
4218({)S
1260 V
(11919)210 648 A
1698(if)S
(\(tp->tty_termios.c_cc[VMIN])1134 1824 A
3000(==)S
3126(0\))S
3252({)S
1350 V
(11920)210 648 A
2034(/*)S
(MIN)126 2160 A
2328(&)S
(TIME)168 2412 A
(specify)294 2622 A
2958(a)S
(read)168 3042 A
(timer)210 3252 A
(that)168 3504 A
(finishes)336 3714 A
(the)126 4092 A
1440 V
(11921)210 648 A
2076(*)S
(read)168 2160 A
2370(in)S
(TIME/10)294 2496 A
(seconds)294 2832 A
3168(if)S
3294(no)S
(bytes)210 3420 A
(are)126 3672 A
(available.)420 3840 A
1530 V
(11922)210 648 A
2076(*/)S
1620 V
(11923)210 648 A
(lock\(\);)294 2034 A
1710 V
(11924)210 648 A
(settimer\(tp,)504 2034 A
(TRUE\);)252 2580 A
1800 V
(11925)210 648 A
(tp->tty_min)462 2034 A
2538(=)S
2622(1;)S
1890 V
(11926)210 648 A
(unlock\(\);)378 2034 A
1980 V
(11927)210 648 A
1698(})S
(else)168 1782 A
1992({)S
2070 V
(11928)210 648 A
2034(/*)S
(MIN)126 2160 A
2328(&)S
(TIME)168 2412 A
(specify)294 2622 A
2958(an)S
(inter-byte)420 3084 A
(timer)210 3546 A
(that)168 3798 A
(may)126 4008 A
2160 V
(11929)210 648 A
2076(*)S
(have)168 2160 A
2370(to)S
2496(be)S
(cancelled)378 2622 A
3042(if)S
(there)210 3168 A
(are)126 3420 A
3588(no)S
(bytes)210 3714 A
(yet.)168 3966 A
2250 V
(11930)210 648 A
2076(*/)S
2340 V
(11931)210 648 A
2034(if)S
(\(tp->tty_eotct)588 2160 A
2790(==)S
2916(0\))S
3042({)S
2430 V
(11932)210 648 A
(lock\(\);)294 2370 A
2520 V
(11933)210 648 A
(settimer\(tp,)504 2370 A
(FALSE\);)294 2916 A
2610 V
(11934)210 648 A
(unlock\(\);)378 2370 A
2700 V
(11935)210 648 A
(tp->tty_min)462 2370 A
2874(=)S
(tp->tty_termios.c_cc[VMIN];)1134 2958 A
2790 V
(11936)210 648 A
2034(})S
2880 V
(11937)210 648 A
1698(})S
2970 V
(11938)210 648 A
1362(})S
3060 V
(11939)210 648 A
3150 V
(11940)210 648 A
1362(/*)S
(Anything)336 1488 A
(waiting)294 1866 A
2202(in)S
(the)126 2328 A
(input)210 2496 A
(buffer?)294 2748 A
(Clear)210 3084 A
3336(it)S
(out...)252 3462 A
3756(*/)S
3240 V
(11941)210 648 A
(in_transfer\(tp\);)672 1362 A
3330 V
(11942)210 648 A
1362(/*)S
(...then)294 1488 A
1824(go)S
(back)168 1950 A
(for)126 2160 A
(more)168 2328 A
2538(*/)S
3420 V
(11943)210 648 A
(handle_events\(tp\);)756 1362 A
3510 V
(11944)210 648 A
1362(if)S
(\(tp->tty_inleft)630 1488 A
2160(==)S
2286(0\))S
(return;)294 2412 A
3378(/*)S
(already)294 3504 A
(done)168 3840 A
4050(*/)S
3600 V
(11945)210 648 A
3690 V
(11946)210 648 A
1362(/*)S
(There)210 1488 A
(were)168 1740 A
1950(no)S
(bytes)210 2076 A
2328(in)S
(the)126 2454 A
(input)210 2622 A
(queue)210 2874 A
(available,)420 3126 A
3588(so)S
(either)252 3714 A
(suspend)294 4008 A
3780 V
(11947)210 648 A
1404(*)S
(the)126 1488 A
(caller)252 1656 A
1950(or)S
(break)210 2076 A
(off)126 2328 A
(the)126 2496 A
(read)168 2664 A
2874(if)S
(nonblocking.)504 3000 A
3870 V
(11948)210 648 A
1404(*/)S
3960 V
(11949)210 648 A
1362(if)S
(\(m_ptr->TTY_FLAGS)714 1488 A
2244(&)S
(O_NONBLOCK\))462 2328 A
2832({)S
4050 V
(11950)210 648 A
1698(r)S
1782(=)S
(EAGAIN;)294 1866 A
3378(/*)S
(cancel)252 3504 A
(the)126 3798 A
(read)168 3966 A
4176(*/)S
4140 V
(11951)210 648 A
(tp->tty_inleft)588 1698 A
2328(=)S
(tp->tty_incum)546 2412 A
3000(=)S
3084(0;)S
4230 V
(11952)210 648 A
1362(})S
(else)168 1446 A
1656({)S
4320 V
(11953)210 648 A
1698(r)S
1782(=)S
(SUSPEND;)336 1866 A
3378(/*)S
(suspend)294 3504 A
(the)126 3840 A
(caller)252 4008 A
4302(*/)S
4410 V
(11954)210 648 A
(tp->tty_inrepcode)714 1698 A
2454(=)S
(REVIVE;)294 2538 A
4500 V
(11955)210 648 A
1362(})S
4590 V
(11956)210 648 A
1110(})S
4680 V
(11957)210 648 A
(tty_reply\(TASK_REPLY,)882 1110 A
(m_ptr->m_source,)672 2034 A
(m_ptr->PROC_NR,)630 2748 A
(r\);)126 3420 A
4770 V
(11958)210 648 A
1026(})S
5040 V
(11961)210 648 A
(/*===========================================================================*)3276 1026 A
5130 V
(11962)210 648 A
1068(*)S
(do_write)336 2370 A
4260(*)S
5220 V
(11963)210 648 A
(*===========================================================================*/)3276 1068 A
5310 V
(11964)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_write\(tp,)504 1572 A
(m_ptr\))252 2118 A
5400 V
(11965)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
5490 V
(11966)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
(sent)168 3294 A
3504(to)S
(the)126 3630 A
(task)168 3798 A
4008(*/)S
5580 V
(11967)210 648 A
1026({)S
5670 V
(11968)210 648 A
1026(/*)S
1152(A)S
(process)294 1236 A
(wants)210 1572 A
1824(to)S
(write)210 1950 A
2202(on)S
2328(a)S
(terminal.)378 2412 A
2832(*/)S
5760 V
(11969)210 648 A
(int)126 1110 A
1278(r;)S
5850 V
(11970)210 648 A
5940 V
(11971)210 648 A
1110(/*)S
(Check)210 1236 A
1488(if)S
(there)210 1614 A
1866(is)S
(already)294 1992 A
2328(a)S
(process)294 2412 A
(hanging)294 2748 A
3084(in)S
3210(a)S
(write,)252 3294 A
(check)210 3588 A
3840(if)S
(the)126 3966 A
6030 V
(11972)210 648 A
1152(*)S
(parameters)420 1236 A
(are)126 1698 A
(correct,)336 1866 A
2244(do)S
(I/O.)168 2370 A
6120 V
(11973)210 648 A
1152(*/)S
6210 V
(11974)210 648 A
1110(if)S
(\(tp->tty_outleft)672 1236 A
1950(>)S
2034(0\))S
2160({)S
8418 V
EP
%%Page: 160 160
BP
/slant 0 def
/height 0 def
630 V
12 B
(160)180 648 A
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(11975)210 648 A
1362(r)S
1446(=)S
(EIO;)168 1530 A
990 V
(11976)210 648 A
1110(})S
(else)168 1194 A
1080 V
(11977)210 648 A
1110(if)S
(\(m_ptr->COUNT)546 1236 A
1824(<=)S
1950(0\))S
2076({)S
1170 V
(11978)210 648 A
1362(r)S
1446(=)S
(EINVAL;)294 1530 A
1260 V
(11979)210 648 A
1110(})S
(else)168 1194 A
1350 V
(11980)210 648 A
1110(if)S
(\(numap\(m_ptr->PROC_NR,)924 1236 A
(\(vir_bytes\))462 2202 A
(m_ptr->ADDRESS,)630 2706 A
(m_ptr->COUNT\))546 3378 A
3966(==)S
4092(0\))S
4218({)S
1440 V
(11981)210 648 A
1362(r)S
1446(=)S
(EFAULT;)294 1530 A
1530 V
(11982)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1620 V
(11983)210 648 A
1362(/*)S
(Copy)168 1488 A
(message)294 1698 A
(parameters)420 2034 A
2496(to)S
(the)126 2622 A
(tty)126 2790 A
(structure.)420 2958 A
3420(*/)S
1710 V
(11984)210 648 A
(tp->tty_outrepcode)756 1362 A
2160(=)S
(TASK_REPLY;)462 2244 A
1800 V
(11985)210 648 A
(tp->tty_outcaller)714 1362 A
2118(=)S
(m_ptr->m_source;)672 2202 A
1890 V
(11986)210 648 A
(tp->tty_outproc)630 1362 A
2034(=)S
(m_ptr->PROC_NR;)630 2118 A
1980 V
(11987)210 648 A
(tp->tty_out_vir)630 1362 A
2034(=)S
(\(vir_bytes\))462 2118 A
(m_ptr->ADDRESS;)630 2622 A
2070 V
(11988)210 648 A
(tp->tty_outleft)630 1362 A
2034(=)S
(m_ptr->COUNT;)546 2118 A
2160 V
(11989)210 648 A
2250 V
(11990)210 648 A
1362(/*)S
(Try)126 1488 A
1656(to)S
(write.)252 1782 A
2076(*/)S
2340 V
(11991)210 648 A
(handle_events\(tp\);)756 1362 A
2430 V
(11992)210 648 A
1362(if)S
(\(tp->tty_outleft)672 1488 A
2202(==)S
2328(0\))S
(return;)294 2454 A
3378(/*)S
(already)294 3504 A
(done)168 3840 A
4050(*/)S
2520 V
(11993)210 648 A
2610 V
(11994)210 648 A
1362(/*)S
(None)168 1488 A
1698(or)S
(not)126 1824 A
(all)126 1992 A
(the)126 2160 A
(bytes)210 2328 A
(could)210 2580 A
2832(be)S
(written,)336 2958 A
3336(so)S
(either)252 3462 A
(suspend)294 3756 A
(the)126 4092 A
2700 V
(11995)210 648 A
1404(*)S
(caller)252 1488 A
1782(or)S
(break)210 1908 A
(off)126 2160 A
(the)126 2328 A
(write)210 2496 A
2748(if)S
(nonblocking.)504 2874 A
2790 V
(11996)210 648 A
1404(*/)S
2880 V
(11997)210 648 A
1362(if)S
(\(m_ptr->TTY_FLAGS)714 1488 A
2244(&)S
(O_NONBLOCK\))462 2328 A
2832({)S
3378(/*)S
(cancel)252 3504 A
(the)126 3798 A
(write)210 3966 A
4218(*/)S
2970 V
(11998)210 648 A
1698(r)S
1782(=)S
(tp->tty_outcum)588 1866 A
2496(>)S
2580(0)S
2664(?)S
(tp->tty_outcum)588 2748 A
3378(:)S
(EAGAIN;)294 3462 A
3060 V
(11999)210 648 A
(tp->tty_outleft)630 1698 A
2370(=)S
(tp->tty_outcum)588 2454 A
3084(=)S
3168(0;)S
3150 V
(12000)210 648 A
1362(})S
(else)168 1446 A
1656({)S
3240 V
(12001)210 648 A
1698(r)S
1782(=)S
(SUSPEND;)336 1866 A
3378(/*)S
(suspend)294 3504 A
(the)126 3840 A
(caller)252 4008 A
4302(*/)S
3330 V
(12002)210 648 A
(tp->tty_outrepcode)756 1698 A
2496(=)S
(REVIVE;)294 2580 A
3420 V
(12003)210 648 A
1362(})S
3510 V
(12004)210 648 A
1110(})S
3600 V
(12005)210 648 A
(tty_reply\(TASK_REPLY,)882 1110 A
(m_ptr->m_source,)672 2034 A
(m_ptr->PROC_NR,)630 2748 A
(r\);)126 3420 A
3690 V
(12006)210 648 A
1026(})S
3960 V
(12009)210 648 A
(/*===========================================================================*)3276 1026 A
4050 V
(12010)210 648 A
1068(*)S
(do_ioctl)336 2370 A
4260(*)S
4140 V
(12011)210 648 A
(*===========================================================================*/)3276 1068 A
4230 V
(12012)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_ioctl\(tp,)504 1572 A
(m_ptr\))252 2118 A
4320 V
(12013)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
4410 V
(12014)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
(sent)168 3294 A
3504(to)S
(task)168 3630 A
3840(*/)S
4500 V
(12015)210 648 A
1026({)S
4590 V
(12016)210 648 A
1026(/*)S
(Perform)294 1152 A
1488(an)S
(IOCTL)210 1614 A
1866(on)S
(this)168 1992 A
(terminal.)378 2202 A
(Posix)210 2622 A
(termios)294 2874 A
(calls)210 3210 A
(are)126 3462 A
(handled)294 3630 A
4680 V
(12017)210 648 A
1068(*)S
1152(by)S
(the)126 1278 A
(IOCTL)210 1446 A
(system)252 1698 A
(call)168 1992 A
4770 V
(12018)210 648 A
1068(*/)S
4860 V
(12019)210 648 A
4950 V
(12020)210 648 A
(int)126 1110 A
1278(r;)S
5040 V
(12021)210 648 A
(union)210 1110 A
1362({)S
5130 V
(12022)210 648 A
(int)126 1362 A
1530(i;)S
5220 V
(12023)210 648 A
1362(/*)S
(these)210 1488 A
(non-Posix)378 1740 A
(params)252 2160 A
(are)126 2454 A
(not)126 2622 A
(used)168 2790 A
(now,)168 3000 A
(but)126 3210 A
(the)126 3378 A
(union)210 3546 A
3798(is)S
(retained)336 3924 A
5310 V
(12024)210 648 A
1404(*)S
1488(to)S
(minimize)336 1614 A
(code)168 1992 A
(differences)462 2202 A
(with)168 2706 A
(backward)336 2916 A
(compatible)420 3294 A
(version)294 3756 A
5400 V
(12025)210 648 A
1404(*)S
(struct)252 1488 A
(sgttyb)252 1782 A
(sg;)126 2076 A
5490 V
(12026)210 648 A
1404(*)S
(struct)252 1488 A
(tchars)252 1782 A
(tc;)126 2076 A
5580 V
(12027)210 648 A
1404(*/)S
5670 V
(12028)210 648 A
1110(})S
(param;)252 1194 A
5760 V
(12029)210 648 A
(phys_bytes)420 1110 A
(user_phys;)420 1572 A
5850 V
(12030)210 648 A
(size_t)252 1110 A
(size;)210 1404 A
5940 V
(12031)210 648 A
6030 V
(12032)210 648 A
1110(/*)S
(Size)168 1236 A
1446(of)S
(the)126 1572 A
(ioctl)210 1740 A
(parameter.)420 1992 A
2454(*/)S
6120 V
(12033)210 648 A
(switch)252 1110 A
(\(m_ptr->TTY_REQUEST\))840 1404 A
2286({)S
6210 V
(12034)210 648 A
(case)168 1194 A
(TCGETS:)294 1404 A
2034(/*)S
(Posix)210 2160 A
(tcgetattr)378 2412 A
(function)336 2832 A
3210(*/)S
8418 V
EP
%%Page: 161 161
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
12 B
(161)180 4248 A
900 V
7 LST
(12035)210 648 A
(case)168 1194 A
(TCSETS:)294 1404 A
2034(/*)S
(Posix)210 2160 A
(tcsetattr)378 2412 A
(function,)378 2832 A
(TCSANOW)294 3252 A
(option)252 3588 A
3882(*/)S
990 V
(12036)210 648 A
(case)168 1194 A
(TCSETSW:)336 1404 A
2034(/*)S
(Posix)210 2160 A
(tcsetattr)378 2412 A
(function,)378 2832 A
(TCSADRAIN)378 3252 A
(option)252 3672 A
3966(*/)S
1080 V
(12037)210 648 A
(case)168 1194 A
(TCSETSF:)336 1404 A
2034(/*)S
(Posix)210 2160 A
(tcsetattr)378 2412 A
(function,)378 2832 A
(TCSAFLUSH)378 3252 A
(option)252 3672 A
3966(*/)S
1170 V
(12038)210 648 A
(size)168 1362 A
1572(=)S
(sizeof\(struct)546 1656 A
(termios\);)378 2244 A
1260 V
(12039)210 648 A
(break;)252 1362 A
1350 V
(12040)210 648 A
1440 V
(12041)210 648 A
(case)168 1194 A
(TCSBRK:)294 1404 A
2034(/*)S
(Posix)210 2160 A
(tcsendbreak)462 2412 A
(function)336 2916 A
3294(*/)S
1530 V
(12042)210 648 A
(case)168 1194 A
(TCFLOW:)294 1404 A
2034(/*)S
(Posix)210 2160 A
(tcflow)252 2412 A
(function)336 2706 A
3084(*/)S
1620 V
(12043)210 648 A
(case)168 1194 A
(TCFLSH:)294 1404 A
2034(/*)S
(Posix)210 2160 A
(tcflush)294 2412 A
(function)336 2748 A
3126(*/)S
1710 V
(12044)210 648 A
(case)168 1194 A
(TIOCGPGRP:)420 1404 A
2034(/*)S
(Posix)210 2160 A
(tcgetpgrp)378 2412 A
(function)336 2832 A
3210(*/)S
1800 V
(12045)210 648 A
(case)168 1194 A
(TIOCSPGRP:)420 1404 A
2034(/*)S
(Posix)210 2160 A
(tcsetpgrp)378 2412 A
(function)336 2832 A
3210(*/)S
1890 V
(12046)210 648 A
(size)168 1362 A
1572(=)S
(sizeof\(int\);)504 1656 A
1980 V
(12047)210 648 A
(break;)252 1362 A
2070 V
(12048)210 648 A
2160 V
(12049)210 648 A
(case)168 1194 A
(TIOCGWINSZ:)462 1404 A
2034(/*)S
(get)126 2160 A
(window)252 2328 A
(size)168 2622 A
(\(not)168 2832 A
(Posix\))252 3042 A
3336(*/)S
2250 V
(12050)210 648 A
(case)168 1194 A
(TIOCSWINSZ:)462 1404 A
2034(/*)S
(set)126 2160 A
(window)252 2328 A
(size)168 2622 A
(\(not)168 2832 A
(Posix\))252 3042 A
3336(*/)S
2340 V
(12051)210 648 A
(size)168 1362 A
1572(=)S
(sizeof\(struct)546 1656 A
(winsize\);)378 2244 A
2430 V
(12052)210 648 A
(break;)252 1362 A
2520 V
(12053)210 648 A
2610 V
(12054)210 648 A
(case)168 1194 A
(KIOCSMAP:)378 1404 A
2034(/*)S
(load)168 2160 A
(keymap)252 2370 A
(\(Minix)252 2664 A
(extension\))420 2958 A
3420(*/)S
2700 V
(12055)210 648 A
(size)168 1362 A
1572(=)S
(sizeof\(keymap_t\);)714 1656 A
2790 V
(12056)210 648 A
(break;)252 1362 A
2880 V
(12057)210 648 A
2970 V
(12058)210 648 A
(case)168 1194 A
(TIOCSFON:)378 1404 A
2034(/*)S
(load)168 2160 A
(font)168 2370 A
(\(Minix)252 2580 A
(extension\))420 2874 A
3336(*/)S
3060 V
(12059)210 648 A
(size)168 1362 A
1572(=)S
(sizeof\(u8_t)462 1656 A
([8192]\);)336 2160 A
3150 V
(12060)210 648 A
(break;)252 1362 A
3240 V
(12061)210 648 A
3330 V
(12062)210 648 A
(case)168 1194 A
(TCDRAIN:)336 1404 A
2034(/*)S
(Posix)210 2160 A
(tcdrain)294 2412 A
(function)336 2748 A
3126(--)S
3252(no)S
(parameter)378 3378 A
3798(*/)S
3420 V
(12063)210 648 A
(default:)336 1194 A
(size)168 2034 A
2244(=)S
2328(0;)S
3510 V
(12064)210 648 A
1110(})S
3600 V
(12065)210 648 A
3690 V
(12066)210 648 A
1110(if)S
(\(size)210 1236 A
1488(!=)S
1614(0\))S
1740({)S
3780 V
(12067)210 648 A
(user_phys)378 1362 A
1782(=)S
(numap\(m_ptr->PROC_NR,)882 1866 A
(\(vir_bytes\))462 2790 A
(m_ptr->ADDRESS,)630 3294 A
(size\);)252 3966 A
3870 V
(12068)210 648 A
1362(if)S
(\(user_phys)420 1488 A
1950(==)S
2076(0\))S
2202({)S
3960 V
(12069)210 648 A
(tty_reply\(TASK_REPLY,)882 1698 A
(m_ptr->m_source,)672 2622 A
(m_ptr->PROC_NR,)630 3336 A
(EFAULT\);)336 4008 A
4050 V
(12070)210 648 A
(return;)294 1698 A
4140 V
(12071)210 648 A
1362(})S
4230 V
(12072)210 648 A
1110(})S
4320 V
(12073)210 648 A
4410 V
(12074)210 648 A
1110(r)S
1194(=)S
(OK;)126 1278 A
4500 V
(12075)210 648 A
(switch)252 1110 A
(\(m_ptr->TTY_REQUEST\))840 1404 A
2286({)S
4590 V
(12076)210 648 A
(case)168 1194 A
(TCGETS:)294 1404 A
4680 V
(12077)210 648 A
1362(/*)S
(Get)126 1488 A
(the)126 1656 A
(termios)294 1824 A
(attributes.)462 2160 A
2664(*/)S
4770 V
(12078)210 648 A
(phys_copy\(vir2phys\(&tp->tty_termios\),)1554 1362 A
(user_phys,)420 2958 A
(\(phys_bytes\))504 3420 A
(size\);)252 3966 A
4860 V
(12079)210 648 A
(break;)252 1362 A
4950 V
(12080)210 648 A
5040 V
(12081)210 648 A
(case)168 1194 A
(TCSETSW:)336 1404 A
5130 V
(12082)210 648 A
(case)168 1194 A
(TCSETSF:)336 1404 A
5220 V
(12083)210 648 A
(case)168 1194 A
(TCDRAIN:)336 1404 A
5310 V
(12084)210 648 A
1362(if)S
(\(tp->tty_outleft)672 1488 A
2202(>)S
2286(0\))S
2412({)S
5400 V
(12085)210 648 A
1698(/*)S
(Wait)168 1824 A
(for)126 2034 A
(all)126 2202 A
(ongoing)294 2370 A
(output)252 2706 A
(processing)420 3000 A
3462(to)S
(finish.)294 3588 A
3924(*/)S
5490 V
(12086)210 648 A
(tp->tty_iocaller)672 1698 A
2412(=)S
(m_ptr->m_source;)672 2496 A
5580 V
(12087)210 648 A
(tp->tty_ioproc)588 1698 A
2328(=)S
(m_ptr->PROC_NR;)630 2412 A
5670 V
(12088)210 648 A
(tp->tty_ioreq)546 1698 A
2286(=)S
(m_ptr->REQUEST;)630 2370 A
5760 V
(12089)210 648 A
(tp->tty_iovir)546 1698 A
2286(=)S
(\(vir_bytes\))462 2370 A
(m_ptr->ADDRESS;)630 2874 A
5850 V
(12090)210 648 A
1698(r)S
1782(=)S
(SUSPEND;)336 1866 A
5940 V
(12091)210 648 A
(break;)252 1698 A
6030 V
(12092)210 648 A
1362(})S
6120 V
(12093)210 648 A
1362(if)S
(\(m_ptr->TTY_REQUEST)798 1488 A
2328(==)S
(TCDRAIN\))336 2454 A
(break;)252 2832 A
6210 V
(12094)210 648 A
1362(if)S
(\(m_ptr->TTY_REQUEST)798 1488 A
2328(==)S
(TCSETSF\))336 2454 A
(tty_icancel\(tp\);)672 2832 A
8418 V
EP
%%Page: 162 162
BP
/slant 0 def
/height 0 def
630 V
12 B
(162)180 648 A
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(12095)210 648 A
(/*FALL)252 1362 A
(THROUGH*/)378 1656 A
990 V
(12096)210 648 A
(case)168 1194 A
(TCSETS:)294 1404 A
1080 V
(12097)210 648 A
1362(/*)S
(Set)126 1488 A
(the)126 1656 A
(termios)294 1824 A
(attributes.)462 2160 A
2664(*/)S
1170 V
(12098)210 648 A
(phys_copy\(user_phys,)840 1362 A
(vir2phys\(&tp->tty_termios\),)1134 2244 A
(\(phys_bytes\))504 3420 A
(size\);)252 3966 A
1260 V
(12099)210 648 A
(setattr\(tp\);)504 1362 A
1350 V
(12100)210 648 A
(break;)252 1362 A
1440 V
(12101)210 648 A
1530 V
(12102)210 648 A
(case)168 1194 A
(TCFLSH:)294 1404 A
1620 V
(12103)210 648 A
(phys_copy\(user_phys,)840 1362 A
(vir2phys\(&param.i\),)798 2244 A
(\(phys_bytes\))504 3084 A
(size\);)252 3630 A
1710 V
(12104)210 648 A
(switch)252 1362 A
(\(param.i\))378 1656 A
2076({)S
1800 V
(12105)210 648 A
(case)168 1530 A
(TCIFLUSH:)378 1740 A
(tty_icancel\(tp\);)672 2370 A
(break;)252 4050 A
1890 V
(12106)210 648 A
(case)168 1530 A
(TCOFLUSH:)378 1740 A
(\(*tp->tty_ocancel\)\(tp\);)966 2370 A
(break;)252 4050 A
1980 V
(12107)210 648 A
(case)168 1530 A
(TCIOFLUSH:)420 1740 A
(tty_icancel\(tp\);)672 2370 A
(\(*tp->tty_ocancel\)\(tp\);break;)1218 3084 A
2070 V
(12108)210 648 A
(default:)336 1530 A
2370(r)S
2454(=)S
(EINVAL;)294 2538 A
2160 V
(12109)210 648 A
1362(})S
2250 V
(12110)210 648 A
(break;)252 1362 A
2340 V
(12111)210 648 A
2430 V
(12112)210 648 A
(case)168 1194 A
(TCFLOW:)294 1404 A
2520 V
(12113)210 648 A
(phys_copy\(user_phys,)840 1362 A
(vir2phys\(&param.i\),)798 2244 A
(\(phys_bytes\))504 3084 A
(size\);)252 3630 A
2610 V
(12114)210 648 A
(switch)252 1362 A
(\(param.i\))378 1656 A
2076({)S
2700 V
(12115)210 648 A
(case)168 1530 A
(TCOOFF:)294 1740 A
2790 V
(12116)210 648 A
(case)168 1530 A
(TCOON:)252 1740 A
2880 V
(12117)210 648 A
(tp->tty_inhibited)714 1698 A
2454(=)S
(\(param.i)336 2538 A
2916(==)S
(TCOOFF\);)336 3042 A
2970 V
(12118)210 648 A
(tp->tty_events)588 1698 A
2328(=)S
2412(1;)S
3060 V
(12119)210 648 A
(break;)252 1698 A
3150 V
(12120)210 648 A
(case)168 1530 A
(TCIOFF:)294 1740 A
3240 V
(12121)210 648 A
(\(*tp->tty_echo\)\(tp,)798 1698 A
(tp->tty_termios.c_cc[VSTOP]\);)1218 2538 A
3330 V
(12122)210 648 A
(break;)252 1698 A
3420 V
(12123)210 648 A
(case)168 1530 A
(TCION:)252 1740 A
3510 V
(12124)210 648 A
(\(*tp->tty_echo\)\(tp,)798 1698 A
(tp->tty_termios.c_cc[VSTART]\);)1260 2538 A
3600 V
(12125)210 648 A
(break;)252 1698 A
3690 V
(12126)210 648 A
(default:)336 1530 A
3780 V
(12127)210 648 A
1698(r)S
1782(=)S
(EINVAL;)294 1866 A
3870 V
(12128)210 648 A
1362(})S
3960 V
(12129)210 648 A
(break;)252 1362 A
4050 V
(12130)210 648 A
4140 V
(12131)210 648 A
(case)168 1194 A
(TCSBRK:)294 1404 A
4230 V
(12132)210 648 A
1362(if)S
(\(tp->tty_break)588 1488 A
2118(!=)S
(NULL\))210 2244 A
(\(*tp->tty_break\)\(tp\);)882 2496 A
4320 V
(12133)210 648 A
(break;)252 1362 A
4410 V
(12134)210 648 A
4500 V
(12135)210 648 A
(case)168 1194 A
(TIOCGWINSZ:)462 1404 A
4590 V
(12136)210 648 A
(phys_copy\(vir2phys\(&tp->tty_winsize\),)1554 1362 A
(user_phys,)420 2958 A
(\(phys_bytes\))504 3420 A
(size\);)252 3966 A
4680 V
(12137)210 648 A
(break;)252 1362 A
4770 V
(12138)210 648 A
4860 V
(12139)210 648 A
(case)168 1194 A
(TIOCSWINSZ:)462 1404 A
4950 V
(12140)210 648 A
(phys_copy\(user_phys,)840 1362 A
(vir2phys\(&tp->tty_winsize\),)1134 2244 A
(\(phys_bytes\))504 3420 A
(size\);)252 3966 A
5040 V
(12141)210 648 A
1362(/*)S
(SIGWINCH...)462 1488 A
1992(*/)S
5130 V
(12142)210 648 A
(break;)252 1362 A
5220 V
(12143)210 648 A
5310 V
(12144)210 648 A
(case)168 1194 A
(KIOCSMAP:)378 1404 A
5400 V
(12145)210 648 A
1362(/*)S
(Load)168 1488 A
1698(a)S
(new)126 1782 A
(keymap)252 1950 A
(\(only)210 2244 A
(/dev/console\).)588 2496 A
3126(*/)S
5490 V
(12146)210 648 A
1362(if)S
(\(isconsole\(tp\)\))630 1488 A
2160(r)S
2244(=)S
(kbd_loadmap\(user_phys\);)966 2328 A
5580 V
(12147)210 648 A
(break;)252 1362 A
5670 V
(12148)210 648 A
5760 V
(12149)210 648 A
(case)168 1194 A
(TIOCSFON:)378 1404 A
5850 V
(12150)210 648 A
1362(/*)S
(Load)168 1488 A
1698(a)S
(font)168 1782 A
(into)168 1992 A
2202(an)S
(EGA)126 2328 A
2496(or)S
(VGA)126 2622 A
(card)168 2790 A
(\(hs@hck.hr\))462 3000 A
3504(*/)S
5940 V
(12151)210 648 A
1362(if)S
(\(isconsole\(tp\)\))630 1488 A
2160(r)S
2244(=)S
(con_loadfont\(user_phys\);)1008 2328 A
6030 V
(12152)210 648 A
(break;)252 1362 A
6120 V
(12153)210 648 A
6210 V
(12154)210 648 A
1026(/*)S
(These)210 1152 A
(Posix)210 1404 A
(functions)378 1656 A
(are)126 2076 A
(allowed)294 2244 A
2580(to)S
(fail)168 2706 A
2916(if)S
(_POSIX_JOB_CONTROL)756 3042 A
3840(is)S
8418 V
EP
%%Page: 163 163
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
12 B
(163)180 4248 A
900 V
7 LST
(12155)210 648 A
1068(*)S
(not)126 1152 A
(defined.)336 1320 A
990 V
(12156)210 648 A
1068(*/)S
1080 V
(12157)210 648 A
(case)168 1194 A
(TIOCGPGRP:)420 1404 A
1170 V
(12158)210 648 A
(case)168 1194 A
(TIOCSPGRP:)420 1404 A
1260 V
(12159)210 648 A
(default:)336 1194 A
1350 V
(12160)210 648 A
1362(r)S
1446(=)S
(ENOTTY;)294 1530 A
1440 V
(12161)210 648 A
1110(})S
1530 V
(12162)210 648 A
1620 V
(12163)210 648 A
1110(/*)S
(Send)168 1236 A
(the)126 1446 A
(reply.)252 1614 A
1908(*/)S
1710 V
(12164)210 648 A
(tty_reply\(TASK_REPLY,)882 1110 A
(m_ptr->m_source,)672 2034 A
(m_ptr->PROC_NR,)630 2748 A
(r\);)126 3420 A
1800 V
(12165)210 648 A
1026(})S
2070 V
(12168)210 648 A
(/*===========================================================================*)3276 1026 A
2160 V
(12169)210 648 A
1068(*)S
(do_open)294 2370 A
4260(*)S
2250 V
(12170)210 648 A
(*===========================================================================*/)3276 1068 A
2340 V
(12171)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_open\(tp,)462 1572 A
(m_ptr\))252 2076 A
2430 V
(12172)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
2520 V
(12173)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
(sent)168 3294 A
3504(to)S
(task)168 3630 A
3840(*/)S
2610 V
(12174)210 648 A
1026({)S
2700 V
(12175)210 648 A
1026(/*)S
1152(A)S
(tty)126 1236 A
(line)168 1404 A
(has)126 1614 A
(been)168 1782 A
(opened.)294 1992 A
(Make)168 2370 A
2580(it)S
(the)126 2706 A
(callers)294 2874 A
(controlling)462 3210 A
(tty)126 3714 A
3882(if)S
2790 V
(12176)210 648 A
1068(*)S
(O_NOCTTY)336 1152 A
1530(is)S
(*not*)210 1656 A
(set)126 1908 A
(and)126 2076 A
2244(it)S
2370(is)S
(not)126 2496 A
(the)126 2664 A
(log)126 2832 A
(device.)294 3000 A
3378(1)S
3462(is)S
(returned)336 3588 A
3966(if)S
2880 V
(12177)210 648 A
1068(*)S
(the)126 1152 A
(tty)126 1320 A
1488(is)S
(made)168 1614 A
(the)126 1824 A
(controlling)462 1992 A
(tty,)168 2496 A
(otherwise)378 2706 A
3126(OK)S
3252(or)S
3378(an)S
(error)210 3504 A
(code.)210 3756 A
2970 V
(12178)210 648 A
1068(*/)S
3060 V
(12179)210 648 A
(int)126 1110 A
1278(r)S
1362(=)S
(OK;)126 1446 A
3150 V
(12180)210 648 A
3240 V
(12181)210 648 A
1110(if)S
(\(m_ptr->TTY_LINE)672 1236 A
1950(==)S
(LOG_MINOR\))420 2076 A
2538({)S
3330 V
(12182)210 648 A
1362(/*)S
(The)126 1488 A
(log)126 1656 A
(device)252 1824 A
2118(is)S
2244(a)S
(write-only)420 2328 A
(diagnostics)462 2790 A
(device.)294 3294 A
3630(*/)S
3420 V
(12183)210 648 A
1362(if)S
(\(m_ptr->COUNT)546 1488 A
2076(&)S
(R_BIT\))252 2160 A
2454(r)S
2538(=)S
(EACCES;)294 2622 A
3510 V
(12184)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3600 V
(12185)210 648 A
1362(if)S
(\(!\(m_ptr->COUNT)630 1488 A
2160(&)S
(O_NOCTTY\)\))420 2244 A
2706({)S
3690 V
(12186)210 648 A
(tp->tty_pgrp)504 1698 A
2244(=)S
(m_ptr->PROC_NR;)630 2328 A
3780 V
(12187)210 648 A
1698(r)S
1782(=)S
1866(1;)S
3870 V
(12188)210 648 A
1362(})S
3960 V
(12189)210 648 A
(tp->tty_openct++;)714 1362 A
4050 V
(12190)210 648 A
1110(})S
4140 V
(12191)210 648 A
(tty_reply\(TASK_REPLY,)882 1110 A
(m_ptr->m_source,)672 2034 A
(m_ptr->PROC_NR,)630 2748 A
(r\);)126 3420 A
4230 V
(12192)210 648 A
1026(})S
4500 V
(12195)210 648 A
(/*===========================================================================*)3276 1026 A
4590 V
(12196)210 648 A
1068(*)S
(do_close)336 2370 A
4260(*)S
4680 V
(12197)210 648 A
(*===========================================================================*/)3276 1068 A
4770 V
(12198)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_close\(tp,)504 1572 A
(m_ptr\))252 2118 A
4860 V
(12199)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
4950 V
(12200)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
(sent)168 3294 A
3504(to)S
(task)168 3630 A
3840(*/)S
5040 V
(12201)210 648 A
1026({)S
5130 V
(12202)210 648 A
1026(/*)S
1152(A)S
(tty)126 1236 A
(line)168 1404 A
(has)126 1614 A
(been)168 1782 A
(closed.)294 1992 A
(Clean)210 2370 A
2622(up)S
(the)126 2748 A
(line)168 2916 A
3126(if)S
3252(it)S
3378(is)S
(the)126 3504 A
(last)168 3672 A
(close.)252 3882 A
4176(*/)S
5220 V
(12203)210 648 A
5310 V
(12204)210 648 A
1110(if)S
(\(m_ptr->TTY_LINE)672 1236 A
1950(!=)S
(LOG_MINOR)378 2076 A
2496(&&)S
(--tp->tty_openct)672 2622 A
3336(==)S
3462(0\))S
3588({)S
5400 V
(12205)210 648 A
(tp->tty_pgrp)504 1362 A
1908(=)S
1992(0;)S
5490 V
(12206)210 648 A
(tty_icancel\(tp\);)672 1362 A
5580 V
(12207)210 648 A
(\(*tp->tty_ocancel\)\(tp\);)966 1362 A
5670 V
(12208)210 648 A
(\(*tp->tty_close\)\(tp\);)882 1362 A
5760 V
(12209)210 648 A
(tp->tty_termios)630 1362 A
2034(=)S
(termios_defaults;)714 2118 A
5850 V
(12210)210 648 A
(tp->tty_winsize)630 1362 A
2034(=)S
(winsize_defaults;)714 2118 A
5940 V
(12211)210 648 A
(setattr\(tp\);)504 1362 A
6030 V
(12212)210 648 A
1110(})S
6120 V
(12213)210 648 A
(tty_reply\(TASK_REPLY,)882 1110 A
(m_ptr->m_source,)672 2034 A
(m_ptr->PROC_NR,)630 2748 A
(OK\);)168 3420 A
6210 V
(12214)210 648 A
1026(})S
8418 V
EP
%%Page: 164 164
BP
/slant 0 def
/height 0 def
630 V
12 B
(164)180 648 A
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
1080 V
7 LST
(12217)210 648 A
(/*===========================================================================*)3276 1026 A
1170 V
(12218)210 648 A
1068(*)S
(do_cancel)378 2370 A
4260(*)S
1260 V
(12219)210 648 A
(*===========================================================================*/)3276 1068 A
1350 V
(12220)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_cancel\(tp,)546 1572 A
(m_ptr\))252 2160 A
1440 V
(12221)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
1530 V
(12222)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
(sent)168 3294 A
3504(to)S
(task)168 3630 A
3840(*/)S
1620 V
(12223)210 648 A
1026({)S
1710 V
(12224)210 648 A
1026(/*)S
1152(A)S
(signal)252 1236 A
(has)126 1530 A
(been)168 1698 A
(sent)168 1908 A
2118(to)S
2244(a)S
(process)294 2328 A
(that)168 2664 A
2874(is)S
(hanging)294 3000 A
(trying)252 3336 A
3630(to)S
(read)168 3756 A
3966(or)S
(write.)252 4092 A
1800 V
(12225)210 648 A
1068(*)S
(The)126 1152 A
(pending)294 1320 A
(read)168 1656 A
1866(or)S
(write)210 1992 A
(must)168 2244 A
2454(be)S
(finished)336 2580 A
(off)126 2958 A
(immediately.)504 3126 A
1890 V
(12226)210 648 A
1068(*/)S
1980 V
(12227)210 648 A
2070 V
(12228)210 648 A
(int)126 1110 A
(proc_nr;)336 1278 A
2160 V
(12229)210 648 A
(int)126 1110 A
(mode;)210 1278 A
2250 V
(12230)210 648 A
2340 V
(12231)210 648 A
1110(/*)S
(Check)210 1236 A
(the)126 1488 A
(parameters)420 1656 A
(carefully,)420 2118 A
2580(to)S
(avoid)210 2706 A
(cancelling)420 2958 A
(twice.)252 3420 A
3714(*/)S
2430 V
(12232)210 648 A
(proc_nr)294 1110 A
1446(=)S
(m_ptr->PROC_NR;)630 1530 A
2520 V
(12233)210 648 A
(mode)168 1110 A
1320(=)S
(m_ptr->COUNT;)546 1404 A
2610 V
(12234)210 648 A
1110(if)S
(\(\(mode)252 1236 A
1530(&)S
(R_BIT\))252 1614 A
1908(&&)S
(tp->tty_inleft)588 2034 A
2664(!=)S
2790(0)S
2874(&&)S
(proc_nr)294 3000 A
3336(==)S
(tp->tty_inproc\))630 3462 A
4134({)S
2700 V
(12235)210 648 A
1362(/*)S
(Process)294 1488 A
(was)126 1824 A
(reading)294 1992 A
(when)168 2328 A
(killed.)294 2538 A
(Clean)210 2916 A
3168(up)S
(input.)252 3294 A
3588(*/)S
2790 V
(12236)210 648 A
(tty_icancel\(tp\);)672 1362 A
2880 V
(12237)210 648 A
(tp->tty_inleft)588 1362 A
1992(=)S
(tp->tty_incum)546 2076 A
2664(=)S
2748(0;)S
2970 V
(12238)210 648 A
1110(})S
3060 V
(12239)210 648 A
1110(if)S
(\(\(mode)252 1236 A
1530(&)S
(W_BIT\))252 1614 A
1908(&&)S
(tp->tty_outleft)630 2034 A
2706(!=)S
2832(0)S
2916(&&)S
(proc_nr)294 3042 A
3378(==)S
(tp->tty_outproc\))672 3504 A
4218({)S
3150 V
(12240)210 648 A
1362(/*)S
(Process)294 1488 A
(was)126 1824 A
(writing)294 1992 A
(when)168 2328 A
(killed.)294 2538 A
(Clean)210 2916 A
3168(up)S
(output.)294 3294 A
3630(*/)S
3240 V
(12241)210 648 A
(\(*tp->tty_ocancel\)\(tp\);)966 1362 A
3330 V
(12242)210 648 A
(tp->tty_outleft)630 1362 A
2034(=)S
(tp->tty_outcum)588 2118 A
2748(=)S
2832(0;)S
3420 V
(12243)210 648 A
1110(})S
3510 V
(12244)210 648 A
1110(if)S
(\(tp->tty_ioreq)588 1236 A
1866(!=)S
1992(0)S
2076(&&)S
(proc_nr)294 2202 A
2538(==)S
(tp->tty_ioproc\))630 2664 A
3336({)S
3600 V
(12245)210 648 A
1362(/*)S
(Process)294 1488 A
(was)126 1824 A
(waiting)294 1992 A
(for)126 2328 A
(output)252 2496 A
2790(to)S
(drain.)252 2916 A
3210(*/)S
3690 V
(12246)210 648 A
(tp->tty_ioreq)546 1362 A
1950(=)S
2034(0;)S
3780 V
(12247)210 648 A
1110(})S
3870 V
(12248)210 648 A
(tp->tty_events)588 1110 A
1740(=)S
1824(1;)S
3960 V
(12249)210 648 A
(tty_reply\(TASK_REPLY,)882 1110 A
(m_ptr->m_source,)672 2034 A
(proc_nr,)336 2748 A
(EINTR\);)294 3126 A
4050 V
(12250)210 648 A
1026(})S
4320 V
(12253)210 648 A
(/*===========================================================================*)3276 1026 A
4410 V
(12254)210 648 A
1068(*)S
(handle_events)546 2370 A
4260(*)S
4500 V
(12255)210 648 A
(*===========================================================================*/)3276 1068 A
4590 V
(12256)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(handle_events\(tp\))714 1530 A
4680 V
(12257)210 648 A
(tty_t)210 1026 A
(*tp;)168 1278 A
2370(/*)S
(TTY)126 2496 A
2664(to)S
(check)210 2790 A
(for)126 3042 A
(events.)294 3210 A
3546(*/)S
4770 V
(12258)210 648 A
1026({)S
4860 V
(12259)210 648 A
1026(/*)S
(Handle)252 1152 A
(any)126 1446 A
(events)252 1614 A
(pending)294 1908 A
2244(on)S
2370(a)S
(TTY.)168 2454 A
(These)210 2706 A
(events)252 2958 A
(are)126 3252 A
(usually)294 3420 A
(device)252 3756 A
4950 V
(12260)210 648 A
1068(*)S
(interrupts.)462 1152 A
5040 V
(12261)210 648 A
1068(*)S
5130 V
(12262)210 648 A
1068(*)S
(Two)126 1152 A
(kinds)210 1320 A
1572(of)S
(events)252 1698 A
(are)126 1992 A
(prominent:)420 2160 A
5220 V
(12263)210 648 A
1068(*)S
1362(-)S
1446(a)S
(character)378 1530 A
(has)126 1950 A
(been)168 2118 A
(received)336 2328 A
(from)168 2706 A
(the)126 2916 A
(console)294 3084 A
3420(or)S
3546(an)S
(RS232)210 3672 A
(line.)210 3924 A
5310 V
(12264)210 648 A
1068(*)S
1362(-)S
1446(an)S
(RS232)210 1572 A
(line)168 1824 A
(has)126 2034 A
(completed)378 2202 A
2622(a)S
(write)210 2706 A
(request)294 2958 A
(\(on)126 3294 A
(behalf)252 3462 A
3756(of)S
3882(a)S
(user\).)252 3966 A
5400 V
(12265)210 648 A
1068(*)S
(The)126 1152 A
(interrupt)378 1320 A
(handler)294 1740 A
(may)126 2076 A
(delay)210 2244 A
(the)126 2496 A
(interrupt)378 2664 A
(message)294 3084 A
3420(at)S
(its)126 3546 A
(discretion)420 3714 A
5490 V
(12266)210 648 A
1068(*)S
1152(to)S
(avoid)210 1278 A
(swamping)336 1530 A
(the)126 1908 A
(TTY)126 2076 A
(task.)210 2244 A
(Messages)336 2538 A
(may)126 2916 A
3084(be)S
(overwritten)462 3210 A
(when)168 3714 A
(the)126 3924 A
5580 V
(12267)210 648 A
1068(*)S
(lines)210 1152 A
(are)126 1404 A
(fast)168 1572 A
1782(or)S
(when)168 1908 A
(there)210 2118 A
(are)126 2370 A
(races)210 2538 A
(between)294 2790 A
(different)378 3126 A
(lines,)252 3546 A
(input)210 3840 A
5670 V
(12268)210 648 A
1068(*)S
(and)126 1152 A
(output,)294 1320 A
(because)294 1656 A
(MINIX)210 1992 A
(only)168 2244 A
(provides)336 2454 A
(single)252 2832 A
(buffering)378 3126 A
(for)126 3546 A
(interrupt)378 3714 A
5760 V
(12269)210 648 A
1068(*)S
(messages)336 1152 A
(\(in)126 1530 A
(proc.c\).)336 1698 A
(This)168 2118 A
2328(is)S
(handled)294 2454 A
2790(by)S
(explicitly)420 2916 A
(checking)336 3378 A
(each)168 3756 A
(line)168 3966 A
5850 V
(12270)210 648 A
1068(*)S
(for)126 1152 A
(fresh)210 1320 A
(input)210 1572 A
(and)126 1824 A
(completed)378 1992 A
(output)252 2412 A
2706(on)S
(each)168 2832 A
(interrupt.)420 3042 A
5940 V
(12271)210 648 A
1068(*/)S
6030 V
(12272)210 648 A
(char)168 1110 A
(*buf;)210 1320 A
6120 V
(12273)210 648 A
(unsigned)336 1110 A
(count;)252 1488 A
6210 V
(12274)210 648 A
8418 V
EP
%%Page: 165 165
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
12 B
(165)180 4248 A
900 V
7 LST
(12275)210 648 A
1110(do)S
1236({)S
990 V
(12276)210 648 A
(tp->tty_events)588 1362 A
1992(=)S
2076(0;)S
1080 V
(12277)210 648 A
1170 V
(12278)210 648 A
1362(/*)S
(Read)168 1488 A
(input)210 1698 A
(and)126 1950 A
(perform)294 2118 A
(input)210 2454 A
(processing.)462 2706 A
3210(*/)S
1260 V
(12279)210 648 A
(\(*tp->tty_devread\)\(tp\);)966 1362 A
1350 V
(12280)210 648 A
1440 V
(12281)210 648 A
1362(/*)S
(Perform)294 1488 A
(output)252 1824 A
(processing)420 2118 A
(and)126 2580 A
(write)210 2748 A
(output.)294 3000 A
3336(*/)S
1530 V
(12282)210 648 A
(\(*tp->tty_devwrite\)\(tp\);)1008 1362 A
1620 V
(12283)210 648 A
1710 V
(12284)210 648 A
1362(/*)S
(Ioctl)210 1488 A
(waiting)294 1740 A
(for)126 2076 A
(some)168 2244 A
(event?)252 2454 A
2748(*/)S
1800 V
(12285)210 648 A
1362(if)S
(\(tp->tty_ioreq)588 1488 A
2118(!=)S
2244(0\))S
(dev_ioctl\(tp\);)588 2370 A
1890 V
(12286)210 648 A
1110(})S
(while)210 1194 A
(\(tp->tty_events\);)714 1446 A
1980 V
(12287)210 648 A
2070 V
(12288)210 648 A
1110(/*)S
(Transfer)336 1236 A
(characters)420 1614 A
(from)168 2076 A
(the)126 2286 A
(input)210 2454 A
(queue)210 2706 A
2958(to)S
3084(a)S
(waiting)294 3168 A
(process.)336 3504 A
3882(*/)S
2160 V
(12289)210 648 A
(in_transfer\(tp\);)672 1110 A
2250 V
(12290)210 648 A
2340 V
(12291)210 648 A
1110(/*)S
(Reply)210 1236 A
1488(if)S
(enough)252 1614 A
(bytes)210 1908 A
(are)126 2160 A
(available.)420 2328 A
2790(*/)S
2430 V
(12292)210 648 A
1110(if)S
(\(tp->tty_incum)588 1236 A
1866(>=)S
(tp->tty_min)462 1992 A
2496(&&)S
(tp->tty_inleft)588 2622 A
3252(>)S
3336(0\))S
3462({)S
2520 V
(12293)210 648 A
(tty_reply\(tp->tty_inrepcode,)1176 1362 A
(tp->tty_incaller,)714 2580 A
(tp->tty_inproc,)630 3336 A
2610 V
(12294)210 648 A
(tp->tty_incum\);)630 3714 A
2700 V
(12295)210 648 A
(tp->tty_inleft)588 1362 A
1992(=)S
(tp->tty_incum)546 2076 A
2664(=)S
2748(0;)S
2790 V
(12296)210 648 A
1110(})S
2880 V
(12297)210 648 A
1026(})S
3150 V
(12300)210 648 A
(/*===========================================================================*)3276 1026 A
3240 V
(12301)210 648 A
1068(*)S
(in_transfer)462 2370 A
4260(*)S
3330 V
(12302)210 648 A
(*===========================================================================*/)3276 1068 A
3420 V
(12303)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(in_transfer\(tp\))630 1572 A
3510 V
(12304)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(terminal)336 2958 A
3336(to)S
(read)168 3462 A
(from)168 3672 A
3882(*/)S
3600 V
(12305)210 648 A
1026({)S
3690 V
(12306)210 648 A
1026(/*)S
(Transfer)336 1152 A
(bytes)210 1530 A
(from)168 1782 A
(the)126 1992 A
(input)210 2160 A
(queue)210 2412 A
2664(to)S
2790(a)S
(process)294 2874 A
(reading)294 3210 A
(from)168 3546 A
3756(a)S
(terminal.)378 3840 A
4260(*/)S
3780 V
(12307)210 648 A
3870 V
(12308)210 648 A
(int)126 1110 A
(ch;)126 1278 A
3960 V
(12309)210 648 A
(int)126 1110 A
(count;)252 1278 A
4050 V
(12310)210 648 A
(phys_bytes)420 1110 A
(buf_phys,)378 1572 A
(user_base;)420 1992 A
4140 V
(12311)210 648 A
(char)168 1110 A
(buf[64],)336 1320 A
(*bp;)168 1698 A
4230 V
(12312)210 648 A
4320 V
(12313)210 648 A
1110(/*)S
(Anything)336 1236 A
1614(to)S
(do?)126 1740 A
1908(*/)S
4410 V
(12314)210 648 A
1110(if)S
(\(tp->tty_inleft)630 1236 A
1908(==)S
2034(0)S
2118(||)S
(tp->tty_eotct)546 2244 A
2832(<)S
(tp->tty_min\))504 2916 A
(return;)294 3462 A
4500 V
(12315)210 648 A
4590 V
(12316)210 648 A
(buf_phys)336 1110 A
1488(=)S
(vir2phys\(buf\);)588 1572 A
4680 V
(12317)210 648 A
(user_base)378 1110 A
1530(=)S
(proc_vir2phys\(proc_addr\(tp->tty_inproc\),)1680 1614 A
(0\);)126 3336 A
4770 V
(12318)210 648 A
1110(bp)S
1236(=)S
(buf;)168 1320 A
4860 V
(12319)210 648 A
(while)210 1110 A
(\(tp->tty_inleft)630 1362 A
2034(>)S
2118(0)S
2202(&&)S
(tp->tty_eotct)546 2328 A
2916(>)S
3000(0\))S
3126({)S
4950 V
(12320)210 648 A
1362(ch)S
1488(=)S
(*tp->tty_intail;)672 1572 A
5040 V
(12321)210 648 A
5130 V
(12322)210 648 A
1362(if)S
(\(!\(ch)210 1488 A
1740(&)S
(IN_EOF\)\))336 1824 A
2202({)S
5220 V
(12323)210 648 A
1698(/*)S
(One)126 1824 A
(character)378 1992 A
2412(to)S
2538(be)S
(delivered)378 2664 A
3084(to)S
(the)126 3210 A
(user.)210 3378 A
3630(*/)S
5310 V
(12324)210 648 A
(*bp)126 1698 A
1866(=)S
1950(ch)S
2076(&)S
(IN_CHAR;)336 2160 A
5400 V
(12325)210 648 A
(tp->tty_inleft--;)714 1698 A
5490 V
(12326)210 648 A
1698(if)S
(\(++bp)210 1824 A
2076(==)S
(bufend\(buf\)\))504 2202 A
2748({)S
5580 V
(12327)210 648 A
2034(/*)S
(Temp)168 2160 A
(buffer)252 2370 A
(full,)210 2664 A
(copy)168 2916 A
3126(to)S
(user)168 3252 A
(space.)252 3462 A
3756(*/)S
5670 V
(12328)210 648 A
(phys_copy\(buf_phys,)798 2034 A
(user_base)378 2874 A
3294(+)S
(tp->tty_in_vir,)630 3378 A
5760 V
(12329)210 648 A
(\(phys_bytes\))504 3042 A
(buflen\(buf\)\);)546 3588 A
5850 V
(12330)210 648 A
(tp->tty_in_vir)588 2034 A
2664(+=)S
(buflen\(buf\);)504 2790 A
5940 V
(12331)210 648 A
(tp->tty_incum)546 2034 A
2622(+=)S
(buflen\(buf\);)504 2748 A
6030 V
(12332)210 648 A
2034(bp)S
2160(=)S
(buf;)168 2244 A
6120 V
(12333)210 648 A
1698(})S
6210 V
(12334)210 648 A
1362(})S
8418 V
EP
%%Page: 166 166
BP
/slant 0 def
/height 0 def
630 V
12 B
(166)180 648 A
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(12335)210 648 A
990 V
(12336)210 648 A
1362(/*)S
(Remove)252 1488 A
(the)126 1782 A
(character)378 1950 A
(from)168 2370 A
(the)126 2580 A
(input)210 2748 A
(queue.)252 3000 A
3294(*/)S
1080 V
(12337)210 648 A
1362(if)S
(\(++tp->tty_intail)714 1488 A
2244(==)S
(bufend\(tp->tty_inbuf\)\))924 2370 A
1170 V
(12338)210 648 A
(tp->tty_intail)588 1698 A
2328(=)S
(tp->tty_inbuf;)588 2412 A
1260 V
(12339)210 648 A
(tp->tty_incount--;)756 1362 A
1350 V
(12340)210 648 A
1362(if)S
(\(ch)126 1488 A
1656(&)S
(IN_EOT\))294 1740 A
2076({)S
1440 V
(12341)210 648 A
(tp->tty_eotct--;)672 1698 A
1530 V
(12342)210 648 A
1698(/*)S
(Don't)210 1824 A
(read)168 2076 A
(past)168 2286 A
2496(a)S
(line)168 2580 A
(break)210 2790 A
3042(in)S
(canonical)378 3168 A
(mode.)210 3588 A
3840(*/)S
1620 V
(12343)210 648 A
1698(if)S
(\(tp->tty_termios.c_lflag)1008 1824 A
2874(&)S
(ICANON\))294 2958 A
(tp->tty_inleft)588 3294 A
3924(=)S
4008(0;)S
1710 V
(12344)210 648 A
1362(})S
1800 V
(12345)210 648 A
1110(})S
1890 V
(12346)210 648 A
1980 V
(12347)210 648 A
1110(if)S
(\(bp)126 1236 A
1404(>)S
(buf\))168 1488 A
1698({)S
2070 V
(12348)210 648 A
1362(/*)S
(Leftover)336 1488 A
(characters)420 1866 A
2328(in)S
(the)126 2454 A
(buffer.)294 2622 A
2958(*/)S
2160 V
(12349)210 648 A
(count)210 1362 A
1614(=)S
1698(bp)S
1824(-)S
(buf;)168 1908 A
2250 V
(12350)210 648 A
(phys_copy\(buf_phys,)798 1362 A
(user_base)378 2202 A
2622(+)S
(tp->tty_in_vir,)630 2706 A
(\(phys_bytes\))504 3378 A
(count\);)294 3924 A
2340 V
(12351)210 648 A
(tp->tty_in_vir)588 1362 A
1992(+=)S
(count;)252 2118 A
2430 V
(12352)210 648 A
(tp->tty_incum)546 1362 A
1950(+=)S
(count;)252 2076 A
2520 V
(12353)210 648 A
1110(})S
2610 V
(12354)210 648 A
2700 V
(12355)210 648 A
1110(/*)S
(Usually)294 1236 A
(reply)210 1572 A
1824(to)S
(the)126 1950 A
(reader,)294 2118 A
(possibly)336 2454 A
(even)168 2832 A
3042(if)S
(incum)210 3168 A
3420(==)S
3546(0)S
(\(EOF\).)252 3630 A
3924(*/)S
2790 V
(12356)210 648 A
1110(if)S
(\(tp->tty_inleft)630 1236 A
1908(==)S
2034(0\))S
2160({)S
2880 V
(12357)210 648 A
(tty_reply\(tp->tty_inrepcode,)1176 1362 A
(tp->tty_incaller,)714 2580 A
(tp->tty_inproc,)630 3336 A
2970 V
(12358)210 648 A
(tp->tty_incum\);)630 3714 A
3060 V
(12359)210 648 A
(tp->tty_inleft)588 1362 A
1992(=)S
(tp->tty_incum)546 2076 A
2664(=)S
2748(0;)S
3150 V
(12360)210 648 A
1110(})S
3240 V
(12361)210 648 A
1026(})S
3510 V
(12364)210 648 A
(/*===========================================================================*)3276 1026 A
3600 V
(12365)210 648 A
1068(*)S
(in_process)420 2370 A
4260(*)S
3690 V
(12366)210 648 A
(*===========================================================================*/)3276 1068 A
3780 V
(12367)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(in_process\(tp,)588 1488 A
(buf,)168 2118 A
(count\))252 2328 A
3870 V
(12368)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
2370(/*)S
(terminal)336 2496 A
2874(on)S
(which)210 3000 A
(character)378 3252 A
(has)126 3672 A
(arrived)294 3840 A
4176(*/)S
3960 V
(12369)210 648 A
(char)168 1026 A
(*buf;)210 1236 A
2370(/*)S
(buffer)252 2496 A
(with)168 2790 A
(input)210 3000 A
(characters)420 3252 A
3714(*/)S
4050 V
(12370)210 648 A
(int)126 1026 A
(count;)252 1194 A
2370(/*)S
(number)252 2496 A
2790(of)S
(input)210 2916 A
(characters)420 3168 A
3630(*/)S
4140 V
(12371)210 648 A
1026({)S
4230 V
(12372)210 648 A
1026(/*)S
(Characters)420 1152 A
(have)168 1614 A
(just)168 1824 A
(been)168 2034 A
(typed)210 2244 A
(in.)126 2496 A
(Process,)336 2706 A
(save,)210 3084 A
(and)126 3336 A
(echo)168 3504 A
(them.)210 3714 A
(Return)252 4008 A
4320 V
(12373)210 648 A
1068(*)S
(the)126 1152 A
(number)252 1320 A
1614(of)S
(characters)420 1740 A
(processed.)420 2202 A
4410 V
(12374)210 648 A
1068(*/)S
4500 V
(12375)210 648 A
4590 V
(12376)210 648 A
(int)126 1110 A
(ch,)126 1278 A
(sig,)168 1446 A
(ct;)126 1656 A
4680 V
(12377)210 648 A
(int)126 1110 A
(timeset)294 1278 A
1614(=)S
(FALSE;)252 1698 A
4770 V
(12378)210 648 A
(static)252 1110 A
(unsigned)336 1404 A
(char)168 1782 A
(csize_mask[])504 1992 A
2538(=)S
2622({)S
(0x1F,)210 2706 A
(0x3F,)210 2958 A
(0x7F,)210 3210 A
(0xFF)168 3462 A
3672(};)S
4860 V
(12379)210 648 A
4950 V
(12380)210 648 A
(for)126 1110 A
(\(ct)126 1278 A
1446(=)S
1530(0;)S
1656(ct)S
1782(<)S
(count;)252 1866 A
(ct++\))210 2160 A
2412({)S
5040 V
(12381)210 648 A
1362(/*)S
(Take)168 1488 A
(one)126 1698 A
(character.)420 1866 A
2328(*/)S
5130 V
(12382)210 648 A
1362(ch)S
1488(=)S
(*buf++)252 1572 A
1866(&)S
(BYTE;)210 1950 A
5220 V
(12383)210 648 A
5310 V
(12384)210 648 A
1362(/*)S
(Strip)210 1488 A
1740(to)S
(seven)210 1866 A
(bits?)210 2118 A
2370(*/)S
5400 V
(12385)210 648 A
1362(if)S
(\(tp->tty_termios.c_iflag)1008 1488 A
2538(&)S
(ISTRIP\))294 2622 A
2958(ch)S
3084(&=)S
(0x7F;)210 3210 A
5490 V
(12386)210 648 A
5580 V
(12387)210 648 A
1362(/*)S
(Input)210 1488 A
(extensions?)462 1740 A
2244(*/)S
5670 V
(12388)210 648 A
1362(if)S
(\(tp->tty_termios.c_lflag)1008 1488 A
2538(&)S
(IEXTEN\))294 2622 A
2958({)S
5760 V
(12389)210 648 A
5850 V
(12390)210 648 A
1698(/*)S
(Previous)336 1824 A
(character)378 2202 A
(was)126 2622 A
2790(a)S
(character)378 2874 A
(escape?)294 3294 A
3630(*/)S
5940 V
(12391)210 648 A
1698(if)S
(\(tp->tty_escaped\))714 1824 A
2580({)S
6030 V
(12392)210 648 A
(tp->tty_escaped)630 2034 A
2706(=)S
(NOT_ESCAPED;)504 2790 A
6120 V
(12393)210 648 A
2034(ch)S
2160(|=)S
(IN_ESC;)294 2286 A
2706(/*)S
(protect)294 2832 A
(character)378 3168 A
3588(*/)S
6210 V
(12394)210 648 A
1698(})S
8418 V
EP
%%Page: 167 167
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
12 B
(167)180 4248 A
900 V
7 LST
(12395)210 648 A
990 V
(12396)210 648 A
1698(/*)S
(LNEXT)210 1824 A
(\(\303V\))168 2076 A
2286(to)S
(escape)252 2412 A
(the)126 2706 A
(next)168 2874 A
(character?)420 3084 A
3546(*/)S
1080 V
(12397)210 648 A
1698(if)S
(\(ch)126 1824 A
1992(==)S
(tp->tty_termios.c_cc[VLNEXT]\))1218 2118 A
3378({)S
1170 V
(12398)210 648 A
(tp->tty_escaped)630 2034 A
2706(=)S
(ESCAPED;)336 2790 A
1260 V
(12399)210 648 A
(rawecho\(tp,)462 2034 A
('\303'\);)210 2538 A
1350 V
(12400)210 648 A
(rawecho\(tp,)462 2034 A
('\\b'\);)252 2538 A
1440 V
(12401)210 648 A
(continue;)378 2034 A
2706(/*)S
2832(do)S
(not)126 2958 A
(store)210 3126 A
(the)126 3378 A
(escape)252 3546 A
3840(*/)S
1530 V
(12402)210 648 A
1698(})S
1620 V
(12403)210 648 A
1710 V
(12404)210 648 A
1698(/*)S
(REPRINT)294 1824 A
(\(\303R\))168 2160 A
2370(to)S
(reprint)294 2496 A
(echoed)252 2832 A
(characters?)462 3126 A
3630(*/)S
1800 V
(12405)210 648 A
1698(if)S
(\(ch)126 1824 A
1992(==)S
(tp->tty_termios.c_cc[VREPRINT]\))1302 2118 A
3462({)S
1890 V
(12406)210 648 A
(reprint\(tp\);)504 2034 A
1980 V
(12407)210 648 A
(continue;)378 2034 A
2070 V
(12408)210 648 A
1698(})S
2160 V
(12409)210 648 A
1362(})S
2250 V
(12410)210 648 A
2340 V
(12411)210 648 A
1362(/*)S
(_POSIX_VDISABLE)630 1488 A
2160(is)S
2286(a)S
(normal)252 2370 A
(character)378 2664 A
(value,)252 3084 A
3378(so)S
(better)252 3504 A
(escape)252 3798 A
(it.)126 4092 A
4260(*/)S
2430 V
(12412)210 648 A
1362(if)S
(\(ch)126 1488 A
1656(==)S
(_POSIX_VDISABLE\))672 1782 A
2496(ch)S
2622(|=)S
(IN_ESC;)294 2748 A
2520 V
(12413)210 648 A
2610 V
(12414)210 648 A
1362(/*)S
(Map)126 1488 A
1656(CR)S
1782(to)S
(LF,)126 1908 A
(ignore)252 2076 A
(CR,)126 2370 A
2538(or)S
(map)126 2664 A
2832(LF)S
2958(to)S
(CR.)126 3084 A
3252(*/)S
2700 V
(12415)210 648 A
1362(if)S
(\(ch)126 1488 A
1656(==)S
('\\r'\))210 1782 A
2034({)S
2790 V
(12416)210 648 A
1698(if)S
(\(tp->tty_termios.c_iflag)1008 1824 A
2874(&)S
(IGNCR\))252 2958 A
(continue;)378 3252 A
2880 V
(12417)210 648 A
1698(if)S
(\(tp->tty_termios.c_iflag)1008 1824 A
2874(&)S
(ICRNL\))252 2958 A
3252(ch)S
3378(=)S
('\\n';)210 3462 A
2970 V
(12418)210 648 A
1362(})S
(else)168 1446 A
3060 V
(12419)210 648 A
1362(if)S
(\(ch)126 1488 A
1656(==)S
('\\n'\))210 1782 A
2034({)S
3150 V
(12420)210 648 A
1698(if)S
(\(tp->tty_termios.c_iflag)1008 1824 A
2874(&)S
(INLCR\))252 2958 A
3252(ch)S
3378(=)S
('\\r';)210 3462 A
3240 V
(12421)210 648 A
1362(})S
3330 V
(12422)210 648 A
3420 V
(12423)210 648 A
1362(/*)S
(Canonical)378 1488 A
(mode?)210 1908 A
2160(*/)S
3510 V
(12424)210 648 A
1362(if)S
(\(tp->tty_termios.c_lflag)1008 1488 A
2538(&)S
(ICANON\))294 2622 A
2958({)S
3600 V
(12425)210 648 A
3690 V
(12426)210 648 A
1698(/*)S
(Erase)210 1824 A
(processing)420 2076 A
(\(rub)168 2538 A
(out)126 2748 A
2916(of)S
(last)168 3042 A
(character\).)462 3252 A
3756(*/)S
3780 V
(12427)210 648 A
1698(if)S
(\(ch)126 1824 A
1992(==)S
(tp->tty_termios.c_cc[VERASE]\))1218 2118 A
3378({)S
3870 V
(12428)210 648 A
(\(void\))252 2034 A
(back_over\(tp\);)588 2328 A
3960 V
(12429)210 648 A
2034(if)S
(\(!\(tp->tty_termios.c_lflag)1092 2160 A
3294(&)S
(ECHOE\)\))294 3378 A
3714({)S
4050 V
(12430)210 648 A
(\(void\))252 2370 A
(echo\(tp,)336 2664 A
(ch\);)168 3042 A
4140 V
(12431)210 648 A
2034(})S
4230 V
(12432)210 648 A
(continue;)378 2034 A
4320 V
(12433)210 648 A
1698(})S
4410 V
(12434)210 648 A
4500 V
(12435)210 648 A
1698(/*)S
(Kill)168 1824 A
(processing)420 2034 A
(\(remove)294 2496 A
(current)294 2832 A
(line\).)252 3168 A
3462(*/)S
4590 V
(12436)210 648 A
1698(if)S
(\(ch)126 1824 A
1992(==)S
(tp->tty_termios.c_cc[VKILL]\))1176 2118 A
3336({)S
4680 V
(12437)210 648 A
(while)210 2034 A
(\(back_over\(tp\)\))630 2286 A
2958({})S
4770 V
(12438)210 648 A
2034(if)S
(\(!\(tp->tty_termios.c_lflag)1092 2160 A
3294(&)S
(ECHOE\)\))294 3378 A
3714({)S
4860 V
(12439)210 648 A
(\(void\))252 2370 A
(echo\(tp,)336 2664 A
(ch\);)168 3042 A
4950 V
(12440)210 648 A
2370(if)S
(\(tp->tty_termios.c_lflag)1008 2496 A
3546(&)S
(ECHOK\))252 3630 A
5040 V
(12441)210 648 A
(rawecho\(tp,)462 2706 A
('\\n'\);)252 3210 A
5130 V
(12442)210 648 A
2034(})S
5220 V
(12443)210 648 A
(continue;)378 2034 A
5310 V
(12444)210 648 A
1698(})S
5400 V
(12445)210 648 A
5490 V
(12446)210 648 A
1698(/*)S
(EOF)126 1824 A
(\(\303D\))168 1992 A
(means)210 2202 A
(end-of-file,)504 2454 A
3000(an)S
(invisible)378 3126 A
("line)210 3546 A
(break".)294 3798 A
4134(*/)S
5580 V
(12447)210 648 A
1698(if)S
(\(ch)126 1824 A
1992(==)S
(tp->tty_termios.c_cc[VEOF]\))1134 2118 A
3294(ch)S
3420(|=)S
(IN_EOT)252 3546 A
3840(|)S
(IN_EOF;)294 3924 A
5670 V
(12448)210 648 A
5760 V
(12449)210 648 A
1698(/*)S
(The)126 1824 A
(line)168 1992 A
(may)126 2202 A
2370(be)S
(returned)336 2496 A
2874(to)S
(the)126 3000 A
(user)168 3168 A
(after)210 3378 A
3630(an)S
(LF.)126 3756 A
3924(*/)S
5850 V
(12450)210 648 A
1698(if)S
(\(ch)126 1824 A
1992(==)S
('\\n'\))210 2118 A
2370(ch)S
2496(|=)S
(IN_EOT;)294 2622 A
5940 V
(12451)210 648 A
6030 V
(12452)210 648 A
1698(/*)S
(Same)168 1824 A
(thing)210 2034 A
(with)168 2286 A
(EOL,)168 2496 A
(whatever)336 2706 A
3084(it)S
(may)126 3210 A
(be.)126 3378 A
3546(*/)S
6120 V
(12453)210 648 A
1698(if)S
(\(ch)126 1824 A
1992(==)S
(tp->tty_termios.c_cc[VEOL]\))1134 2118 A
3294(ch)S
3420(|=)S
(IN_EOT;)294 3546 A
6210 V
(12454)210 648 A
1362(})S
8418 V
EP
%%Page: 168 168
BP
/slant 0 def
/height 0 def
630 V
12 B
(168)180 648 A
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(12455)210 648 A
990 V
(12456)210 648 A
1362(/*)S
(Start/stop)420 1488 A
(input)210 1950 A
(control?)336 2202 A
2580(*/)S
1080 V
(12457)210 648 A
1362(if)S
(\(tp->tty_termios.c_iflag)1008 1488 A
2538(&)S
(IXON\))210 2622 A
2874({)S
1170 V
(12458)210 648 A
1260 V
(12459)210 648 A
1698(/*)S
(Output)252 1824 A
(stops)210 2118 A
2370(on)S
(STOP)168 2496 A
(\(\303S\).)210 2706 A
2958(*/)S
1350 V
(12460)210 648 A
1698(if)S
(\(ch)126 1824 A
1992(==)S
(tp->tty_termios.c_cc[VSTOP]\))1176 2118 A
3336({)S
1440 V
(12461)210 648 A
(tp->tty_inhibited)714 2034 A
2790(=)S
(STOPPED;)336 2874 A
1530 V
(12462)210 648 A
(tp->tty_events)588 2034 A
2664(=)S
2748(1;)S
1620 V
(12463)210 648 A
(continue;)378 2034 A
1710 V
(12464)210 648 A
1698(})S
1800 V
(12465)210 648 A
1890 V
(12466)210 648 A
1698(/*)S
(Output)252 1824 A
(restarts)336 2118 A
2496(on)S
(START)210 2622 A
(\(\303Q\))168 2874 A
3084(or)S
(any)126 3210 A
(character)378 3378 A
3798(if)S
(IXANY.)252 3924 A
4218(*/)S
1980 V
(12467)210 648 A
1698(if)S
(\(tp->tty_inhibited\))798 1824 A
2664({)S
2070 V
(12468)210 648 A
2034(if)S
(\(ch)126 2160 A
2328(==)S
(tp->tty_termios.c_cc[VSTART])1176 2454 A
2160 V
(12469)210 648 A
2706(||)S
(\(tp->tty_termios.c_iflag)1008 2832 A
3882(&)S
(IXANY\)\))294 3966 A
4302({)S
2250 V
(12470)210 648 A
(tp->tty_inhibited)714 2370 A
3126(=)S
(RUNNING;)336 3210 A
2340 V
(12471)210 648 A
(tp->tty_events)588 2370 A
3000(=)S
3084(1;)S
2430 V
(12472)210 648 A
2370(if)S
(\(ch)126 2496 A
2664(==)S
(tp->tty_termios.c_cc[VSTART]\))1218 2790 A
2520 V
(12473)210 648 A
(continue;)378 2706 A
2610 V
(12474)210 648 A
2034(})S
2700 V
(12475)210 648 A
1698(})S
2790 V
(12476)210 648 A
1362(})S
2880 V
(12477)210 648 A
2970 V
(12478)210 648 A
1362(if)S
(\(tp->tty_termios.c_lflag)1008 1488 A
2538(&)S
(ISIG\))210 2622 A
2874({)S
3060 V
(12479)210 648 A
1698(/*)S
(Check)210 1824 A
(for)126 2076 A
(INTR)168 2244 A
(\(\303?\))168 2454 A
(and)126 2664 A
(QUIT)168 2832 A
(\(\303\\\))168 3042 A
(characters.)462 3252 A
3756(*/)S
3150 V
(12480)210 648 A
1698(if)S
(\(ch)126 1824 A
1992(==)S
(tp->tty_termios.c_cc[VINTR])1134 2118 A
3240 V
(12481)210 648 A
2706(||)S
2832(ch)S
2958(==)S
(tp->tty_termios.c_cc[VQUIT]\))1176 3084 A
4302({)S
3330 V
(12482)210 648 A
(sig)126 2034 A
2202(=)S
(SIGINT;)294 2286 A
3420 V
(12483)210 648 A
2034(if)S
(\(ch)126 2160 A
2328(==)S
(tp->tty_termios.c_cc[VQUIT]\))1176 2454 A
(sig)126 3672 A
3840(=)S
(SIGQUIT;)336 3924 A
3510 V
(12484)210 648 A
(sigchar\(tp,)462 2034 A
(sig\);)210 2538 A
3600 V
(12485)210 648 A
(\(void\))252 2034 A
(echo\(tp,)336 2328 A
(ch\);)168 2706 A
3690 V
(12486)210 648 A
(continue;)378 2034 A
3780 V
(12487)210 648 A
1698(})S
3870 V
(12488)210 648 A
1362(})S
3960 V
(12489)210 648 A
4050 V
(12490)210 648 A
1362(/*)S
1488(Is)S
(there)210 1614 A
(space)210 1866 A
2118(in)S
(the)126 2244 A
(input)210 2412 A
(buffer?)294 2664 A
3000(*/)S
4140 V
(12491)210 648 A
1362(if)S
(\(tp->tty_incount)672 1488 A
2202(==)S
(buflen\(tp->tty_inbuf\)\))924 2328 A
3294({)S
4230 V
(12492)210 648 A
1698(/*)S
1824(No)S
(space;)252 1950 A
(discard)294 2244 A
2580(in)S
(canonical)378 2706 A
(mode,)210 3126 A
(keep)168 3378 A
3588(in)S
(raw)126 3714 A
(mode.)210 3882 A
4134(*/)S
4320 V
(12493)210 648 A
1698(if)S
(\(tp->tty_termios.c_lflag)1008 1824 A
2874(&)S
(ICANON\))294 2958 A
(continue;)378 3294 A
4410 V
(12494)210 648 A
(break;)252 1698 A
4500 V
(12495)210 648 A
1362(})S
4590 V
(12496)210 648 A
4680 V
(12497)210 648 A
1362(if)S
(\(!\(tp->tty_termios.c_lflag)1092 1488 A
2622(&)S
(ICANON\)\))336 2706 A
3084({)S
4770 V
(12498)210 648 A
1698(/*)S
1824(In)S
(raw)126 1950 A
(mode)168 2118 A
(all)126 2328 A
(characters)420 2496 A
(are)126 2958 A
("line)210 3126 A
(breaks".)336 3378 A
3756(*/)S
4860 V
(12499)210 648 A
1698(ch)S
1824(|=)S
(IN_EOT;)294 1950 A
4950 V
(12500)210 648 A
5040 V
(12501)210 648 A
1698(/*)S
(Start)210 1824 A
2076(an)S
(inter-byte)420 2202 A
(timer?)252 2664 A
2958(*/)S
5130 V
(12502)210 648 A
1698(if)S
(\(!timeset)378 1824 A
2244(&&)S
(tp->tty_termios.c_cc[VMIN])1092 2370 A
3504(>)S
3588(0)S
5220 V
(12503)210 648 A
2370(&&)S
(tp->tty_termios.c_cc[VTIME])1134 2496 A
3672(>)S
3756(0\))S
3882({)S
5310 V
(12504)210 648 A
(lock\(\);)294 2034 A
5400 V
(12505)210 648 A
(settimer\(tp,)504 2034 A
(TRUE\);)252 2580 A
5490 V
(12506)210 648 A
(unlock\(\);)378 2034 A
5580 V
(12507)210 648 A
(timeset)294 2034 A
2370(=)S
(TRUE;)210 2454 A
5670 V
(12508)210 648 A
1698(})S
5760 V
(12509)210 648 A
1362(})S
5850 V
(12510)210 648 A
5940 V
(12511)210 648 A
1362(/*)S
(Perform)294 1488 A
(the)126 1824 A
(intricate)378 1992 A
(function)336 2412 A
2790(of)S
(echoing.)336 2916 A
3294(*/)S
6030 V
(12512)210 648 A
1362(if)S
(\(tp->tty_termios.c_lflag)1008 1488 A
2538(&)S
(\(ECHO|ECHONL\)\))588 2622 A
3252(ch)S
3378(=)S
(echo\(tp,)336 3462 A
(ch\);)168 3840 A
6120 V
(12513)210 648 A
6210 V
(12514)210 648 A
1362(/*)S
(Save)168 1488 A
(the)126 1698 A
(character)378 1866 A
2286(in)S
(the)126 2412 A
(input)210 2580 A
(queue.)252 2832 A
3126(*/)S
8418 V
EP
%%Page: 169 169
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
12 B
(169)180 4248 A
900 V
7 LST
(12515)210 648 A
(*tp->tty_inhead++)714 1362 A
2118(=)S
(ch;)126 2202 A
990 V
(12516)210 648 A
1362(if)S
(\(tp->tty_inhead)630 1488 A
2160(==)S
(bufend\(tp->tty_inbuf\)\))924 2286 A
1080 V
(12517)210 648 A
(tp->tty_inhead)588 1698 A
2328(=)S
(tp->tty_inbuf;)588 2412 A
1170 V
(12518)210 648 A
(tp->tty_incount++;)756 1362 A
1260 V
(12519)210 648 A
1362(if)S
(\(ch)126 1488 A
1656(&)S
(IN_EOT\))294 1740 A
(tp->tty_eotct++;)672 2076 A
1350 V
(12520)210 648 A
1440 V
(12521)210 648 A
1362(/*)S
(Try)126 1488 A
1656(to)S
(finish)252 1782 A
(input)210 2076 A
2328(if)S
(the)126 2454 A
(queue)210 2622 A
(threatens)378 2874 A
3294(to)S
(overflow.)378 3420 A
3840(*/)S
1530 V
(12522)210 648 A
1362(if)S
(\(tp->tty_incount)672 1488 A
2202(==)S
(buflen\(tp->tty_inbuf\)\))924 2328 A
(in_transfer\(tp\);)672 3294 A
1620 V
(12523)210 648 A
1110(})S
1710 V
(12524)210 648 A
(return)252 1110 A
(ct;)126 1404 A
1800 V
(12525)210 648 A
1026(})S
2070 V
(12528)210 648 A
(/*===========================================================================*)3276 1026 A
2160 V
(12529)210 648 A
1068(*)S
(echo)168 2370 A
4260(*)S
2250 V
(12530)210 648 A
(*===========================================================================*/)3276 1068 A
2340 V
(12531)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(echo\(tp,)336 1530 A
(ch\))126 1908 A
2430 V
(12532)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
2370(/*)S
(terminal)336 2496 A
2874(on)S
(which)210 3000 A
3252(to)S
(echo)168 3378 A
3588(*/)S
2520 V
(12533)210 648 A
(register)336 1026 A
(int)126 1404 A
(ch;)126 1572 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(character)378 2958 A
3378(to)S
(echo)168 3504 A
3714(*/)S
2610 V
(12534)210 648 A
1026({)S
2700 V
(12535)210 648 A
1026(/*)S
(Echo)168 1152 A
(the)126 1362 A
(character)378 1530 A
1950(if)S
(echoing)294 2076 A
2412(is)S
(on.)126 2538 A
(Some)168 2748 A
(control)294 2958 A
(characters)420 3294 A
(are)126 3756 A
(echoed)252 3924 A
2790 V
(12536)210 648 A
1068(*)S
(with)168 1152 A
(their)210 1362 A
(normal)252 1614 A
(effect,)294 1908 A
(other)210 2244 A
(control)294 2496 A
(characters)420 2832 A
(are)126 3294 A
(echoed)252 3462 A
3756(as)S
("\303X",)210 3882 A
2880 V
(12537)210 648 A
1068(*)S
(normal)252 1152 A
(characters)420 1446 A
(are)126 1908 A
(echoed)252 2076 A
(normally.)378 2370 A
(EOF)126 2832 A
(\(\303D\))168 3000 A
3210(is)S
(echoed,)294 3336 A
(but)126 3672 A
(immediately)462 3840 A
2970 V
(12538)210 648 A
1068(*)S
(backspaced)420 1152 A
(over.)210 1614 A
(Return)252 1908 A
(the)126 2202 A
(character)378 2370 A
(with)168 2790 A
(the)126 3000 A
(echoed)252 3168 A
(length)252 3462 A
(added)210 3756 A
4008(to)S
(its)126 4134 A
3060 V
(12539)210 648 A
1068(*)S
(attributes.)462 1152 A
3150 V
(12540)210 648 A
1068(*/)S
3240 V
(12541)210 648 A
(int)126 1110 A
(len,)168 1278 A
(rp;)126 1488 A
3330 V
(12542)210 648 A
3420 V
(12543)210 648 A
1110(ch)S
1236(&=)S
(\304IN_LEN;)336 1362 A
3510 V
(12544)210 648 A
1110(if)S
(\(!\(tp->tty_termios.c_lflag)1092 1236 A
2370(&)S
(ECHO\)\))252 2454 A
2748({)S
3600 V
(12545)210 648 A
1362(if)S
(\(ch)126 1488 A
1656(==)S
(\('\\n')210 1782 A
2034(|)S
(IN_EOT\))294 2118 A
2454(&&)S
(\(tp->tty_termios.c_lflag)1008 2580 A
3690 V
(12546)210 648 A
2706(&)S
(\(ICANON|ECHONL\)\))672 2790 A
3504(==)S
(\(ICANON|ECHONL\)\))672 3630 A
3780 V
(12547)210 648 A
(\(*tp->tty_echo\)\(tp,)798 1698 A
('\\n'\);)252 2538 A
3870 V
(12548)210 648 A
(return\(ch\);)462 1362 A
3960 V
(12549)210 648 A
1110(})S
4050 V
(12550)210 648 A
4140 V
(12551)210 648 A
1110(/*)S
("Reprint")378 1236 A
(tells)210 1656 A
1908(if)S
(the)126 2034 A
(echo)168 2202 A
(output)252 2412 A
(has)126 2706 A
(been)168 2874 A
(messed)252 3084 A
3378(up)S
3504(by)S
(other)210 3630 A
(output.)294 3882 A
4218(*/)S
4230 V
(12552)210 648 A
1110(rp)S
1236(=)S
(tp->tty_incount)630 1320 A
1992(==)S
2118(0)S
2202(?)S
(FALSE)210 2286 A
2538(:)S
(tp->tty_reprint;)672 2622 A
4320 V
(12553)210 648 A
4410 V
(12554)210 648 A
1110(if)S
(\(\(ch)168 1236 A
1446(&)S
(IN_CHAR\))336 1530 A
1908(<)S
1992(')S
2076('\))S
2202({)S
4500 V
(12555)210 648 A
(switch)252 1362 A
(\(ch)126 1656 A
1824(&)S
(\(IN_ESC|IN_EOF|IN_EOT|IN_CHAR\)\))1302 1908 A
3252({)S
4590 V
(12556)210 648 A
(case)168 1530 A
('\\t':)210 1740 A
4680 V
(12557)210 648 A
(len)126 1698 A
1866(=)S
1950(0;)S
4770 V
(12558)210 648 A
1698(do)S
1824({)S
4860 V
(12559)210 648 A
(\(*tp->tty_echo\)\(tp,)798 2034 A
2874(')S
('\);)126 2958 A
4950 V
(12560)210 648 A
(len++;)252 2034 A
5040 V
(12561)210 648 A
1698(})S
(while)210 1782 A
(\(len)168 2034 A
2244(<)S
(TAB_SIZE)336 2328 A
2706(&&)S
(\(tp->tty_position)714 2832 A
3588(&)S
(TAB_MASK\))378 3672 A
4092(!=)S
(0\);)126 4218 A
5130 V
(12562)210 648 A
(break;)252 1698 A
5220 V
(12563)210 648 A
(case)168 1530 A
('\\r')168 1740 A
1950(|)S
(IN_EOT:)294 2034 A
5310 V
(12564)210 648 A
(case)168 1530 A
('\\n')168 1740 A
1950(|)S
(IN_EOT:)294 2034 A
5400 V
(12565)210 648 A
(\(*tp->tty_echo\)\(tp,)798 1698 A
2538(ch)S
2664(&)S
(IN_CHAR\);)378 2748 A
5490 V
(12566)210 648 A
(len)126 1698 A
1866(=)S
1950(0;)S
5580 V
(12567)210 648 A
(break;)252 1698 A
5670 V
(12568)210 648 A
(default:)336 1530 A
5760 V
(12569)210 648 A
(\(*tp->tty_echo\)\(tp,)798 1698 A
('\303'\);)210 2538 A
5850 V
(12570)210 648 A
(\(*tp->tty_echo\)\(tp,)798 1698 A
('@')126 2538 A
2706(+)S
(\(ch)126 2790 A
2958(&)S
(IN_CHAR\)\);)420 3042 A
5940 V
(12571)210 648 A
(len)126 1698 A
1866(=)S
1950(2;)S
6030 V
(12572)210 648 A
1362(})S
6120 V
(12573)210 648 A
1110(})S
(else)168 1194 A
6210 V
(12574)210 648 A
1110(if)S
(\(\(ch)168 1236 A
1446(&)S
(IN_CHAR\))336 1530 A
1908(==)S
('\\177'\))294 2034 A
2370({)S
8418 V
EP
%%Page: 170 170
BP
/slant 0 def
/height 0 def
630 V
12 B
(170)180 648 A
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(12575)210 648 A
1362(/*)S
1488(A)S
(DEL)126 1572 A
(prints)252 1740 A
2034(as)S
("\303?".)210 2160 A
2412(*/)S
990 V
(12576)210 648 A
(\(*tp->tty_echo\)\(tp,)798 1362 A
('\303'\);)210 2202 A
1080 V
(12577)210 648 A
(\(*tp->tty_echo\)\(tp,)798 1362 A
('?'\);)210 2202 A
1170 V
(12578)210 648 A
(len)126 1362 A
1530(=)S
1614(2;)S
1260 V
(12579)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1350 V
(12580)210 648 A
(\(*tp->tty_echo\)\(tp,)798 1362 A
2202(ch)S
2328(&)S
(IN_CHAR\);)378 2412 A
1440 V
(12581)210 648 A
(len)126 1362 A
1530(=)S
1614(1;)S
1530 V
(12582)210 648 A
1110(})S
1620 V
(12583)210 648 A
1110(if)S
(\(ch)126 1236 A
1404(&)S
(IN_EOF\))294 1488 A
(while)210 1824 A
(\(len)168 2076 A
2286(>)S
2370(0\))S
2496({)S
(\(*tp->tty_echo\)\(tp,)798 2580 A
('\\b'\);)252 3420 A
(len--;)252 3714 A
4008(})S
1710 V
(12584)210 648 A
1800 V
(12585)210 648 A
(tp->tty_reprint)630 1110 A
1782(=)S
(rp;)126 1866 A
1890 V
(12586)210 648 A
(return\(ch)378 1110 A
1530(|)S
(\(len)168 1614 A
1824(<<)S
(IN_LSHIFT\)\);)504 1950 A
1980 V
(12587)210 648 A
1026(})S
2250 V
(12590)210 648 A
(/*==========================================================================*)3234 1026 A
2340 V
(12591)210 648 A
1068(*)S
(rawecho)294 2370 A
4218(*)S
2430 V
(12592)210 648 A
(*==========================================================================*/)3234 1068 A
2520 V
(12593)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(rawecho\(tp,)462 1572 A
(ch\))126 2076 A
2610 V
(12594)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
2700 V
(12595)210 648 A
(int)126 1026 A
(ch;)126 1194 A
2790 V
(12596)210 648 A
1026({)S
2880 V
(12597)210 648 A
1026(/*)S
(Echo)168 1152 A
(without)294 1362 A
(interpretation)588 1698 A
2328(if)S
(ECHO)168 2454 A
2664(is)S
(set.)168 2790 A
3000(*/)S
2970 V
(12598)210 648 A
(int)126 1110 A
1278(rp)S
1404(=)S
(tp->tty_reprint;)672 1488 A
3060 V
(12599)210 648 A
1110(if)S
(\(tp->tty_termios.c_lflag)1008 1236 A
2286(&)S
(ECHO\))210 2370 A
(\(*tp->tty_echo\)\(tp,)798 2622 A
(ch\);)168 3462 A
3150 V
(12600)210 648 A
(tp->tty_reprint)630 1110 A
1782(=)S
(rp;)126 1866 A
3240 V
(12601)210 648 A
1026(})S
3510 V
(12604)210 648 A
(/*==========================================================================*)3234 1026 A
3600 V
(12605)210 648 A
1068(*)S
(back_over)378 2370 A
4218(*)S
3690 V
(12606)210 648 A
(*==========================================================================*/)3234 1068 A
3780 V
(12607)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(back_over\(tp\))546 1530 A
3870 V
(12608)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
3960 V
(12609)210 648 A
1026({)S
4050 V
(12610)210 648 A
1026(/*)S
(Backspace)378 1152 A
1572(to)S
(previous)336 1698 A
(character)378 2076 A
2496(on)S
(screen)252 2622 A
(and)126 2916 A
(erase)210 3084 A
(it.)126 3336 A
3504(*/)S
4140 V
(12611)210 648 A
(u16_t)210 1110 A
(*head;)252 1362 A
4230 V
(12612)210 648 A
(int)126 1110 A
(len;)168 1278 A
4320 V
(12613)210 648 A
4410 V
(12614)210 648 A
1110(if)S
(\(tp->tty_incount)672 1236 A
1950(==)S
2076(0\))S
(return\(0\);)420 2202 A
2706(/*)S
(queue)210 2832 A
(empty)210 3084 A
3336(*/)S
4500 V
(12615)210 648 A
(head)168 1110 A
1320(=)S
(tp->tty_inhead;)630 1404 A
4590 V
(12616)210 648 A
1110(if)S
(\(head)210 1236 A
1488(==)S
(tp->tty_inbuf\))588 1614 A
(head)168 2244 A
2454(=)S
(bufend\(tp->tty_inbuf\);)924 2538 A
4680 V
(12617)210 648 A
1110(if)S
(\(*--head)336 1236 A
1614(&)S
(IN_EOT\))294 1698 A
(return\(0\);)420 2034 A
3042(/*)S
(can't)210 3168 A
(erase)210 3420 A
("line)210 3672 A
(breaks")294 3924 A
4260(*/)S
4770 V
(12618)210 648 A
1110(if)S
(\(tp->tty_reprint\))714 1236 A
(reprint\(tp\);)504 1992 A
3042(/*)S
(reprint)294 3168 A
3504(if)S
(messed)252 3630 A
3924(up)S
4050(*/)S
4860 V
(12619)210 648 A
(tp->tty_inhead)588 1110 A
1740(=)S
(head;)210 1824 A
4950 V
(12620)210 648 A
(tp->tty_incount--;)756 1110 A
5040 V
(12621)210 648 A
1110(if)S
(\(tp->tty_termios.c_lflag)1008 1236 A
2286(&)S
(ECHOE\))252 2370 A
2664({)S
5130 V
(12622)210 648 A
(len)126 1362 A
1530(=)S
(\(*head)252 1614 A
1908(&)S
(IN_LEN\))294 1992 A
2328(>>)S
(IN_LSHIFT;)420 2454 A
5220 V
(12623)210 648 A
(while)210 1362 A
(\(len)168 1614 A
1824(>)S
1908(0\))S
2034({)S
5310 V
(12624)210 648 A
(rawecho\(tp,)462 1698 A
('\\b'\);)252 2202 A
5400 V
(12625)210 648 A
(rawecho\(tp,)462 1698 A
2202(')S
('\);)126 2286 A
5490 V
(12626)210 648 A
(rawecho\(tp,)462 1698 A
('\\b'\);)252 2202 A
5580 V
(12627)210 648 A
(len--;)252 1698 A
5670 V
(12628)210 648 A
1362(})S
5760 V
(12629)210 648 A
1110(})S
5850 V
(12630)210 648 A
(return\(1\);)420 1110 A
2706(/*)S
(one)126 2832 A
(character)378 3000 A
(erased)252 3420 A
3714(*/)S
5940 V
(12631)210 648 A
1026(})S
6210 V
(12634)210 648 A
(/*==========================================================================*)3234 1026 A
8418 V
EP
%%Page: 171 171
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
12 B
(171)180 4248 A
900 V
7 LST
(12635)210 648 A
1068(*)S
(reprint)294 2370 A
4218(*)S
990 V
(12636)210 648 A
(*==========================================================================*/)3234 1068 A
1080 V
(12637)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(reprint\(tp\))462 1572 A
1170 V
(12638)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(tty)126 2958 A
(struct)252 3126 A
3420(*/)S
1260 V
(12639)210 648 A
1026({)S
1350 V
(12640)210 648 A
1026(/*)S
(Restore)294 1152 A
(what)168 1488 A
(has)126 1698 A
(been)168 1866 A
(echoed)252 2076 A
2370(to)S
(screen)252 2496 A
(before)252 2790 A
3084(if)S
(the)126 3210 A
(user)168 3378 A
(input)210 3588 A
(has)126 3840 A
(been)168 4008 A
1440 V
(12641)210 648 A
1068(*)S
(messed)252 1152 A
1446(up)S
1572(by)S
(output,)294 1698 A
2034(or)S
2160(if)S
(REPRINT)294 2286 A
(\(\303R\))168 2622 A
2832(is)S
(typed.)252 2958 A
1530 V
(12642)210 648 A
1068(*/)S
1620 V
(12643)210 648 A
(int)126 1110 A
(count;)252 1278 A
1710 V
(12644)210 648 A
(u16_t)210 1110 A
(*head;)252 1362 A
1800 V
(12645)210 648 A
1890 V
(12646)210 648 A
(tp->tty_reprint)630 1110 A
1782(=)S
(FALSE;)252 1866 A
1980 V
(12647)210 648 A
2070 V
(12648)210 648 A
1110(/*)S
(Find)168 1236 A
(the)126 1446 A
(last)168 1614 A
(line)168 1824 A
(break)210 2034 A
2286(in)S
(the)126 2412 A
(input.)252 2580 A
2874(*/)S
2160 V
(12649)210 648 A
(head)168 1110 A
1320(=)S
(tp->tty_inhead;)630 1404 A
2250 V
(12650)210 648 A
(count)210 1110 A
1362(=)S
(tp->tty_incount;)672 1446 A
2340 V
(12651)210 648 A
(while)210 1110 A
(\(count)252 1362 A
1656(>)S
1740(0\))S
1866({)S
2430 V
(12652)210 648 A
1362(if)S
(\(head)210 1488 A
1740(==)S
(tp->tty_inbuf\))588 1866 A
(head)168 2496 A
2706(=)S
(bufend\(tp->tty_inbuf\);)924 2790 A
2520 V
(12653)210 648 A
1362(if)S
(\(head[-1])378 1488 A
1908(&)S
(IN_EOT\))294 1992 A
(break;)252 2328 A
2610 V
(12654)210 648 A
(head--;)294 1362 A
2700 V
(12655)210 648 A
(count--;)336 1362 A
2790 V
(12656)210 648 A
1110(})S
2880 V
(12657)210 648 A
1110(if)S
(\(count)252 1236 A
1530(==)S
(tp->tty_incount\))672 1656 A
(return;)294 2370 A
3042(/*)S
3168(no)S
(reason)252 3294 A
3588(to)S
(reprint)294 3714 A
4050(*/)S
2970 V
(12658)210 648 A
3060 V
(12659)210 648 A
1110(/*)S
(Show)168 1236 A
(REPRINT)294 1446 A
(\(\303R\))168 1782 A
(and)126 1992 A
(move)168 2160 A
2370(to)S
2496(a)S
(new)126 2580 A
(line.)210 2748 A
3000(*/)S
3150 V
(12660)210 648 A
(\(void\))252 1110 A
(echo\(tp,)336 1404 A
(tp->tty_termios.c_cc[VREPRINT])1260 1782 A
3084(|)S
(IN_ESC\);)336 3168 A
3240 V
(12661)210 648 A
(rawecho\(tp,)462 1110 A
('\\r'\);)252 1614 A
3330 V
(12662)210 648 A
(rawecho\(tp,)462 1110 A
('\\n'\);)252 1614 A
3420 V
(12663)210 648 A
3510 V
(12664)210 648 A
1110(/*)S
(Reprint)294 1236 A
(from)168 1572 A
(the)126 1782 A
(last)168 1950 A
(break)210 2160 A
(onwards.)336 2412 A
2790(*/)S
3600 V
(12665)210 648 A
1110(do)S
1236({)S
3690 V
(12666)210 648 A
1362(if)S
(\(head)210 1488 A
1740(==)S
(bufend\(tp->tty_inbuf\)\))924 1866 A
(head)168 2832 A
3042(=)S
(tp->tty_inbuf;)588 3126 A
3780 V
(12667)210 648 A
(*head)210 1362 A
1614(=)S
(echo\(tp,)336 1698 A
(*head\);)294 2076 A
3870 V
(12668)210 648 A
(head++;)294 1362 A
3960 V
(12669)210 648 A
(count++;)336 1362 A
4050 V
(12670)210 648 A
1110(})S
(while)210 1194 A
(\(count)252 1446 A
1740(<)S
(tp->tty_incount\);)714 1824 A
4140 V
(12671)210 648 A
1026(})S
4410 V
(12674)210 648 A
(/*==========================================================================*)3234 1026 A
4500 V
(12675)210 648 A
1068(*)S
(out_process)462 2370 A
4218(*)S
4590 V
(12676)210 648 A
(*==========================================================================*/)3234 1068 A
4680 V
(12677)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(out_process\(tp,)630 1530 A
(bstart,)294 2202 A
(bpos,)210 2538 A
(bend,)210 2790 A
(icount,)294 3042 A
(ocount\))294 3378 A
4770 V
(12678)210 648 A
(tty_t)210 1026 A
(*tp;)168 1278 A
4860 V
(12679)210 648 A
(char)168 1026 A
(*bstart,)336 1236 A
(*bpos,)252 1614 A
(*bend;)252 1908 A
2370(/*)S
(start/pos/end)546 2496 A
3084(of)S
(circular)336 3210 A
(buffer)252 3588 A
3882(*/)S
4950 V
(12680)210 648 A
(int)126 1026 A
(*icount;)336 1194 A
2370(/*)S
2496(#)S
(input)210 2580 A
(chars)210 2832 A
3084(/)S
(input)210 3168 A
(chars)210 3420 A
(used)168 3672 A
3882(*/)S
5040 V
(12681)210 648 A
(int)126 1026 A
(*ocount;)336 1194 A
2370(/*)S
(max)126 2496 A
(output)252 2664 A
(chars)210 2958 A
3210(/)S
(output)252 3294 A
(chars)210 3588 A
(used)168 3840 A
4050(*/)S
5130 V
(12682)210 648 A
1026({)S
5220 V
(12683)210 648 A
1026(/*)S
(Perform)294 1152 A
(output)252 1488 A
(processing)420 1782 A
2244(on)S
2370(a)S
(circular)336 2454 A
(buffer.)294 2832 A
(*icount)294 3210 A
3546(is)S
(the)126 3672 A
(number)252 3840 A
4134(of)S
5310 V
(12684)210 648 A
1068(*)S
(bytes)210 1152 A
1404(to)S
(process,)336 1530 A
(and)126 1908 A
(the)126 2076 A
(number)252 2244 A
2538(of)S
(bytes)210 2664 A
(actually)336 2916 A
(processed)378 3294 A
3714(on)S
(return.)294 3840 A
5400 V
(12685)210 648 A
1068(*)S
(*ocount)294 1152 A
1488(is)S
(the)126 1614 A
(space)210 1782 A
(available)378 2034 A
2454(on)S
(input)210 2580 A
(and)126 2832 A
(the)126 3000 A
(space)210 3168 A
(used)168 3420 A
3630(on)S
(output.)294 3756 A
5490 V
(12686)210 648 A
1068(*)S
(\(Naturally)420 1152 A
(*icount)294 1614 A
1950(<)S
(*ocount.\))378 2034 A
(The)126 2496 A
(column)252 2664 A
(position)336 2958 A
3336(is)S
(updated)294 3462 A
(modulo)252 3798 A
5580 V
(12687)210 648 A
1068(*)S
(the)126 1152 A
(TAB)126 1320 A
(size,)210 1488 A
(because)294 1740 A
2076(we)S
(really)252 2202 A
(only)168 2496 A
(need)168 2706 A
2916(it)S
(for)126 3042 A
(tabs.)210 3210 A
5670 V
(12688)210 648 A
1068(*/)S
5760 V
(12689)210 648 A
5850 V
(12690)210 648 A
(int)126 1110 A
(tablen;)294 1278 A
5940 V
(12691)210 648 A
(int)126 1110 A
(ict)126 1278 A
1446(=)S
(*icount;)336 1530 A
6030 V
(12692)210 648 A
(int)126 1110 A
(oct)126 1278 A
1446(=)S
(*ocount;)336 1530 A
6120 V
(12693)210 648 A
(int)126 1110 A
(pos)126 1278 A
1446(=)S
(tp->tty_position;)714 1530 A
6210 V
(12694)210 648 A
8418 V
EP
%%Page: 172 172
BP
/slant 0 def
/height 0 def
630 V
12 B
(172)180 648 A
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(12695)210 648 A
(while)210 1110 A
(\(ict)168 1362 A
1572(>)S
1656(0\))S
1782({)S
990 V
(12696)210 648 A
(switch)252 1362 A
(\(*bpos\))294 1656 A
1992({)S
1080 V
(12697)210 648 A
(case)168 1362 A
('\\7':)210 1572 A
1170 V
(12698)210 648 A
(break;)252 1698 A
1260 V
(12699)210 648 A
(case)168 1362 A
('\\b':)210 1572 A
1350 V
(12700)210 648 A
(pos--;)252 1698 A
1440 V
(12701)210 648 A
(break;)252 1698 A
1530 V
(12702)210 648 A
(case)168 1362 A
('\\r':)210 1572 A
1620 V
(12703)210 648 A
(pos)126 1698 A
1866(=)S
1950(0;)S
1710 V
(12704)210 648 A
(break;)252 1698 A
1800 V
(12705)210 648 A
(case)168 1362 A
('\\n':)210 1572 A
1890 V
(12706)210 648 A
1698(if)S
(\(\(tp->tty_termios.c_oflag)1050 1824 A
2916(&)S
(\(OPOST|ONLCR\)\))588 3000 A
1980 V
(12707)210 648 A
3378(==)S
(\(OPOST|ONLCR\)\))588 3504 A
4134({)S
2070 V
(12708)210 648 A
2034(/*)S
(Map)126 2160 A
2328(LF)S
2454(to)S
(CR+LF)210 2580 A
2832(if)S
(there)210 2958 A
3210(is)S
(space.)252 3336 A
(Note)168 3672 A
(that)168 3882 A
(the)126 4092 A
2160 V
(12709)210 648 A
2076(*)S
(next)168 2160 A
(character)378 2370 A
2790(in)S
(the)126 2916 A
(buffer)252 3084 A
3378(is)S
(overwritten,)504 3504 A
4050(so)S
2250 V
(12710)210 648 A
2076(*)S
2160(we)S
(stop)168 2286 A
2496(at)S
(this)168 2622 A
(point.)252 2832 A
2340 V
(12711)210 648 A
2076(*/)S
2430 V
(12712)210 648 A
2034(if)S
(\(oct)168 2160 A
2370(>=)S
2496(2\))S
2622({)S
2520 V
(12713)210 648 A
(*bpos)210 2370 A
2622(=)S
('\\r';)210 2706 A
2610 V
(12714)210 648 A
2370(if)S
(\(++bpos)294 2496 A
2832(==)S
(bend\))210 2958 A
(bpos)168 3210 A
3420(=)S
(bstart;)294 3504 A
2700 V
(12715)210 648 A
(*bpos)210 2370 A
2622(=)S
('\\n';)210 2706 A
2790 V
(12716)210 648 A
(pos)126 2370 A
2538(=)S
2622(0;)S
2880 V
(12717)210 648 A
(ict--;)252 2370 A
2970 V
(12718)210 648 A
(oct)126 2370 A
2538(-=)S
2664(2;)S
3060 V
(12719)210 648 A
2034(})S
3150 V
(12720)210 648 A
(goto)168 2034 A
(out_done;)378 2244 A
2706(/*)S
2832(no)S
(space)210 2958 A
3210(or)S
(buffer)252 3336 A
(got)126 3630 A
(changed)294 3798 A
4134(*/)S
3240 V
(12721)210 648 A
1698(})S
3330 V
(12722)210 648 A
(break;)252 1698 A
3420 V
(12723)210 648 A
(case)168 1362 A
('\\t':)210 1572 A
3510 V
(12724)210 648 A
1698(/*)S
(Best)168 1824 A
(guess)210 2034 A
(for)126 2286 A
(the)126 2454 A
(tab)126 2622 A
(length.)294 2790 A
3126(*/)S
3600 V
(12725)210 648 A
(tablen)252 1698 A
1992(=)S
(TAB_SIZE)336 2076 A
2454(-)S
(\(pos)168 2538 A
2748(&)S
(TAB_MASK\);)420 2832 A
3690 V
(12726)210 648 A
3780 V
(12727)210 648 A
1698(if)S
(\(\(tp->tty_termios.c_oflag)1050 1824 A
2916(&)S
(\(OPOST|XTABS\)\))588 3000 A
3870 V
(12728)210 648 A
3378(==)S
(\(OPOST|XTABS\)\))588 3504 A
4134({)S
3960 V
(12729)210 648 A
2034(/*)S
(Tabs)168 2160 A
(must)168 2370 A
2580(be)S
(expanded.)378 2706 A
3126(*/)S
4050 V
(12730)210 648 A
2034(if)S
(\(oct)168 2160 A
2370(>=)S
(tablen\))294 2496 A
2832({)S
4140 V
(12731)210 648 A
(pos)126 2370 A
2538(+=)S
(tablen;)294 2664 A
4230 V
(12732)210 648 A
(ict--;)252 2370 A
4320 V
(12733)210 648 A
(oct)126 2370 A
2538(-=)S
(tablen;)294 2664 A
4410 V
(12734)210 648 A
2370(do)S
2496({)S
4500 V
(12735)210 648 A
(*bpos)210 2706 A
2958(=)S
3042(')S
3126(';)S
4590 V
(12736)210 648 A
2706(if)S
(\(++bpos)294 2832 A
3168(==)S
(bend\))210 3294 A
(bpos)168 3546 A
3756(=)S
(bstart;)294 3840 A
4680 V
(12737)210 648 A
2370(})S
(while)210 2454 A
(\(--tablen)378 2706 A
3126(!=)S
(0\);)126 3252 A
4770 V
(12738)210 648 A
2034(})S
4860 V
(12739)210 648 A
(goto)168 2034 A
(out_done;)378 2244 A
4950 V
(12740)210 648 A
1698(})S
5040 V
(12741)210 648 A
1698(/*)S
(Tabs)168 1824 A
(are)126 2034 A
(output)252 2202 A
(directly.)378 2496 A
2916(*/)S
5130 V
(12742)210 648 A
(pos)126 1698 A
1866(+=)S
(tablen;)294 1992 A
5220 V
(12743)210 648 A
(break;)252 1698 A
5310 V
(12744)210 648 A
(default:)336 1362 A
5400 V
(12745)210 648 A
1698(/*)S
(Assume)252 1824 A
(any)126 2118 A
(other)210 2286 A
(character)378 2538 A
(prints)252 2958 A
3252(as)S
(one)126 3378 A
(character.)420 3546 A
4008(*/)S
5490 V
(12746)210 648 A
(pos++;)252 1698 A
5580 V
(12747)210 648 A
1362(})S
5670 V
(12748)210 648 A
1362(if)S
(\(++bpos)294 1488 A
1824(==)S
(bend\))210 1950 A
(bpos)168 2202 A
2412(=)S
(bstart;)294 2496 A
5760 V
(12749)210 648 A
(ict--;)252 1362 A
5850 V
(12750)210 648 A
(oct--;)252 1362 A
5940 V
(12751)210 648 A
1110(})S
6030 V
(12752)210 648 A
(out_done:)378 1026 A
6120 V
(12753)210 648 A
(tp->tty_position)672 1110 A
1824(=)S
(pos)126 1908 A
2076(&)S
(TAB_MASK;)378 2160 A
6210 V
(12754)210 648 A
8418 V
EP
%%Page: 173 173
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
12 B
(173)180 4248 A
900 V
7 LST
(12755)210 648 A
(*icount)294 1110 A
1446(-=)S
(ict;)168 1572 A
2034(/*)S
([io]ct)252 2160 A
(are)126 2454 A
(the)126 2622 A
(number)252 2790 A
3084(of)S
(chars)210 3210 A
(not)126 3462 A
(used)168 3630 A
3840(*/)S
990 V
(12756)210 648 A
(*ocount)294 1110 A
1446(-=)S
(oct;)168 1572 A
2034(/*)S
(*[io]count)420 2160 A
(are)126 2622 A
(the)126 2790 A
(number)252 2958 A
3252(of)S
(chars)210 3378 A
(that)168 3630 A
(are)126 3840 A
(used)168 4008 A
4218(*/)S
1080 V
(12757)210 648 A
1026(})S
1350 V
(12760)210 648 A
(/*===========================================================================*)3276 1026 A
1440 V
(12761)210 648 A
1068(*)S
(dev_ioctl)378 2370 A
4260(*)S
1530 V
(12762)210 648 A
(*===========================================================================*/)3276 1068 A
1620 V
(12763)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(dev_ioctl\(tp\))546 1572 A
1710 V
(12764)210 648 A
(tty_t)210 1026 A
(*tp;)168 1278 A
1800 V
(12765)210 648 A
1026({)S
1890 V
(12766)210 648 A
1026(/*)S
(The)126 1152 A
(ioctl's)294 1320 A
(TCSETSW,)336 1656 A
(TCSETSF)294 2034 A
(and)126 2370 A
(TCDRAIN)294 2538 A
(wait)168 2874 A
(for)126 3084 A
(output)252 3252 A
3546(to)S
(finish)252 3672 A
3966(to)S
(make)168 4092 A
1980 V
(12767)210 648 A
1068(*)S
(sure)168 1152 A
(that)168 1362 A
1572(an)S
(attribute)378 1698 A
(change)252 2118 A
(doesn't)294 2412 A
(affect)252 2748 A
(the)126 3042 A
(processing)420 3210 A
3672(of)S
(current)294 3798 A
2070 V
(12768)210 648 A
1068(*)S
(output.)294 1152 A
(Once)168 1530 A
(output)252 1740 A
(finishes)336 2034 A
(the)126 2412 A
(ioctl)210 2580 A
2832(is)S
(executed)336 2958 A
3336(as)S
3462(in)S
(do_ioctl\(\).)462 3588 A
2160 V
(12769)210 648 A
1068(*/)S
2250 V
(12770)210 648 A
(phys_bytes)420 1110 A
(user_phys;)420 1572 A
2340 V
(12771)210 648 A
2430 V
(12772)210 648 A
1110(if)S
(\(tp->tty_outleft)672 1236 A
1950(>)S
2034(0\))S
(return;)294 2160 A
3042(/*)S
(output)252 3168 A
(not)126 3462 A
(finished)336 3630 A
4008(*/)S
2520 V
(12773)210 648 A
2610 V
(12774)210 648 A
1110(if)S
(\(tp->tty_ioreq)588 1236 A
1866(!=)S
(TCDRAIN\))336 1992 A
2370({)S
2700 V
(12775)210 648 A
1362(if)S
(\(tp->tty_ioreq)588 1488 A
2118(==)S
(TCSETSF\))336 2244 A
(tty_icancel\(tp\);)672 2622 A
2790 V
(12776)210 648 A
(user_phys)378 1362 A
1782(=)S
(proc_vir2phys\(proc_addr\(tp->tty_ioproc\),)1680 1866 A
(tp->tty_iovir\);)630 3588 A
2880 V
(12777)210 648 A
(phys_copy\(user_phys,)840 1362 A
(vir2phys\(&tp->tty_termios\),)1134 2244 A
2970 V
(12778)210 648 A
(\(phys_bytes\))504 2706 A
(sizeof\(tp->tty_termios\)\);)1050 3252 A
3060 V
(12779)210 648 A
(setattr\(tp\);)504 1362 A
3150 V
(12780)210 648 A
1110(})S
3240 V
(12781)210 648 A
(tp->tty_ioreq)546 1110 A
1698(=)S
1782(0;)S
3330 V
(12782)210 648 A
(tty_reply\(REVIVE,)714 1110 A
(tp->tty_iocaller,)714 1866 A
(tp->tty_ioproc,)630 2622 A
(OK\);)168 3294 A
3420 V
(12783)210 648 A
1026(})S
3690 V
(12786)210 648 A
(/*===========================================================================*)3276 1026 A
3780 V
(12787)210 648 A
1068(*)S
(setattr)294 2370 A
4260(*)S
3870 V
(12788)210 648 A
(*===========================================================================*/)3276 1068 A
3960 V
(12789)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(setattr\(tp\))462 1572 A
4050 V
(12790)210 648 A
(tty_t)210 1026 A
(*tp;)168 1278 A
4140 V
(12791)210 648 A
1026({)S
4230 V
(12792)210 648 A
1026(/*)S
(Apply)210 1152 A
(the)126 1404 A
(new)126 1572 A
(line)168 1740 A
(attributes)420 1950 A
(\(raw/canonical,)630 2412 A
(line)168 3084 A
(speed,)252 3294 A
(etc.\))210 3588 A
3840(*/)S
4320 V
(12793)210 648 A
(u16_t)210 1110 A
(*inp;)210 1362 A
4410 V
(12794)210 648 A
(int)126 1110 A
(count;)252 1278 A
4500 V
(12795)210 648 A
4590 V
(12796)210 648 A
1110(if)S
(\(!\(tp->tty_termios.c_lflag)1092 1236 A
2370(&)S
(ICANON\)\))336 2454 A
2832({)S
4680 V
(12797)210 648 A
1362(/*)S
(Raw)126 1488 A
(mode;)210 1656 A
(put)126 1908 A
2076(a)S
("line)210 2160 A
(break")252 2412 A
2706(on)S
(all)126 2832 A
(characters)420 3000 A
3462(in)S
(the)126 3588 A
(input)210 3756 A
(queue.)252 4008 A
4770 V
(12798)210 648 A
1404(*)S
1488(It)S
1614(is)S
(undefined)378 1740 A
(what)168 2160 A
(happens)294 2370 A
2706(to)S
(the)126 2832 A
(input)210 3000 A
(queue)210 3252 A
(when)168 3504 A
(ICANON)252 3714 A
4008(is)S
4860 V
(12799)210 648 A
1404(*)S
(switched)336 1488 A
(off,)168 1866 A
2076(a)S
(process)294 2160 A
(should)252 2496 A
(use)126 2790 A
(TCSAFLUSH)378 2958 A
3378(to)S
(flush)210 3504 A
(the)126 3756 A
(queue.)252 3924 A
4950 V
(12800)210 648 A
1404(*)S
(Keeping)294 1488 A
(the)126 1824 A
(queue)210 1992 A
2244(to)S
(preserve)336 2370 A
(typeahead)378 2748 A
3168(is)S
(the)126 3294 A
(Right)210 3462 A
(Thing,)252 3714 A
(however)294 4008 A
5040 V
(12801)210 648 A
1404(*)S
(when)168 1488 A
1698(a)S
(process)294 1782 A
(does)168 2118 A
(use)126 2328 A
(TCSANOW)294 2496 A
2832(to)S
(switch)252 2958 A
3252(to)S
(raw)126 3378 A
(mode.)210 3546 A
5130 V
(12802)210 648 A
1404(*/)S
5220 V
(12803)210 648 A
(count)210 1362 A
1614(=)S
(tp->tty_eotct)546 1698 A
2286(=)S
(tp->tty_incount;)672 2370 A
5310 V
(12804)210 648 A
(inp)126 1362 A
1530(=)S
(tp->tty_intail;)630 1614 A
5400 V
(12805)210 648 A
(while)210 1362 A
(\(count)252 1614 A
1908(>)S
1992(0\))S
2118({)S
5490 V
(12806)210 648 A
(*inp)168 1698 A
1908(|=)S
(IN_EOT;)294 2034 A
5580 V
(12807)210 648 A
1698(if)S
(\(++inp)252 1824 A
2118(==)S
(bufend\(tp->tty_inbuf\)\))924 2244 A
(inp)126 3210 A
3378(=)S
(tp->tty_inbuf;)588 3462 A
5670 V
(12808)210 648 A
(--count;)336 1698 A
5760 V
(12809)210 648 A
1362(})S
5850 V
(12810)210 648 A
1110(})S
5940 V
(12811)210 648 A
6030 V
(12812)210 648 A
1110(/*)S
(Inspect)294 1236 A
(MIN)126 1572 A
(and)126 1740 A
(TIME.)210 1908 A
2160(*/)S
6120 V
(12813)210 648 A
(lock\(\);)294 1110 A
6210 V
(12814)210 648 A
(settimer\(tp,)504 1110 A
(FALSE\);)294 1656 A
8418 V
EP
%%Page: 174 174
BP
/slant 0 def
/height 0 def
630 V
12 B
(174)180 648 A
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(12815)210 648 A
(unlock\(\);)378 1110 A
990 V
(12816)210 648 A
1110(if)S
(\(tp->tty_termios.c_lflag)1008 1236 A
2286(&)S
(ICANON\))294 2370 A
2706({)S
1080 V
(12817)210 648 A
1362(/*)S
1488(No)S
(MIN)126 1614 A
1782(&)S
(TIME)168 1866 A
2076(in)S
(canonical)378 2202 A
(mode.)210 2622 A
2874(*/)S
1170 V
(12818)210 648 A
(tp->tty_min)462 1362 A
1866(=)S
1950(1;)S
1260 V
(12819)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1350 V
(12820)210 648 A
1362(/*)S
1488(In)S
(raw)126 1614 A
(mode)168 1782 A
(MIN)126 1992 A
2160(is)S
(the)126 2286 A
(number)252 2454 A
2748(of)S
(chars)210 2874 A
(wanted,)294 3126 A
(and)126 3462 A
(TIME)168 3630 A
(how)126 3840 A
(long)168 4008 A
1440 V
(12821)210 648 A
1404(*)S
1488(to)S
(wait)168 1614 A
(for)126 1824 A
(them.)210 1992 A
(With)168 2286 A
(interesting)462 2496 A
(exceptions)420 3000 A
3462(if)S
(either)252 3588 A
3882(is)S
(zero.)210 4008 A
1530 V
(12822)210 648 A
1404(*/)S
1620 V
(12823)210 648 A
(tp->tty_min)462 1362 A
1866(=)S
(tp->tty_termios.c_cc[VMIN];)1134 1950 A
1710 V
(12824)210 648 A
1362(if)S
(\(tp->tty_min)504 1488 A
2034(==)S
2160(0)S
2244(&&)S
(tp->tty_termios.c_cc[VTIME])1134 2370 A
3546(>)S
3630(0\))S
1800 V
(12825)210 648 A
(tp->tty_min)462 1698 A
2202(=)S
2286(1;)S
1890 V
(12826)210 648 A
1110(})S
1980 V
(12827)210 648 A
2070 V
(12828)210 648 A
1110(if)S
(\(!\(tp->tty_termios.c_iflag)1092 1236 A
2370(&)S
(IXON\)\))252 2454 A
2748({)S
2160 V
(12829)210 648 A
1362(/*)S
1488(No)S
(start/stop)420 1614 A
(output)252 2076 A
(control,)336 2370 A
2748(so)S
(don't)210 2874 A
(leave)210 3126 A
(output)252 3378 A
(inhibited.)420 3672 A
4134(*/)S
2250 V
(12830)210 648 A
(tp->tty_inhibited)714 1362 A
2118(=)S
(RUNNING;)336 2202 A
2340 V
(12831)210 648 A
(tp->tty_events)588 1362 A
1992(=)S
2076(1;)S
2430 V
(12832)210 648 A
1110(})S
2520 V
(12833)210 648 A
2610 V
(12834)210 648 A
1110(/*)S
(Setting)294 1236 A
(the)126 1572 A
(output)252 1740 A
(speed)210 2034 A
2286(to)S
(zero)168 2412 A
(hangs)210 2622 A
2874(up)S
(the)126 3000 A
(phone.)252 3168 A
3462(*/)S
2700 V
(12835)210 648 A
1110(if)S
(\(tp->tty_termios.c_ospeed)1050 1236 A
2328(==)S
(B0\))126 2454 A
(sigchar\(tp,)462 2622 A
(SIGHUP\);)336 3126 A
2790 V
(12836)210 648 A
2880 V
(12837)210 648 A
1110(/*)S
(Set)126 1236 A
(new)126 1404 A
(line)168 1572 A
(speed,)252 1782 A
(character)378 2076 A
(size,)210 2496 A
(etc)126 2748 A
2916(at)S
(the)126 3042 A
(device)252 3210 A
(level.)252 3504 A
3798(*/)S
2970 V
(12838)210 648 A
(\(*tp->tty_ioctl\)\(tp\);)882 1110 A
3060 V
(12839)210 648 A
1026(})S
3330 V
(12842)210 648 A
(/*===========================================================================*)3276 1026 A
3420 V
(12843)210 648 A
1068(*)S
(tty_reply)378 2370 A
4260(*)S
3510 V
(12844)210 648 A
(*===========================================================================*/)3276 1068 A
3600 V
(12845)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(tty_reply\(code,)630 1530 A
(replyee,)336 2202 A
(proc_nr,)336 2580 A
(status\))294 2958 A
3690 V
(12846)210 648 A
(int)126 1026 A
(code;)210 1194 A
2370(/*)S
(TASK_REPLY)420 2496 A
2958(or)S
(REVIVE)252 3084 A
3378(*/)S
3780 V
(12847)210 648 A
(int)126 1026 A
(replyee;)336 1194 A
2370(/*)S
(destination)462 2496 A
(address)294 3000 A
(for)126 3336 A
(the)126 3504 A
(reply)210 3672 A
3924(*/)S
3870 V
(12848)210 648 A
(int)126 1026 A
(proc_nr;)336 1194 A
2370(/*)S
2496(to)S
(whom)168 2622 A
(should)252 2832 A
(the)126 3126 A
(reply)210 3294 A
(go?)126 3546 A
3714(*/)S
3960 V
(12849)210 648 A
(int)126 1026 A
(status;)294 1194 A
2370(/*)S
(reply)210 2496 A
(code)168 2748 A
2958(*/)S
4050 V
(12850)210 648 A
1026({)S
4140 V
(12851)210 648 A
1026(/*)S
(Send)168 1152 A
1362(a)S
(reply)210 1446 A
1698(to)S
1824(a)S
(process)294 1908 A
(that)168 2244 A
(wanted)252 2454 A
2748(to)S
(read)168 2874 A
3084(or)S
(write)210 3210 A
(data.)210 3462 A
3714(*/)S
4230 V
(12852)210 648 A
4320 V
(12853)210 648 A
(message)294 1110 A
(tty_mess;)378 1446 A
4410 V
(12854)210 648 A
4500 V
(12855)210 648 A
(tty_mess.m_type)630 1110 A
1782(=)S
(code;)210 1866 A
4590 V
(12856)210 648 A
(tty_mess.REP_PROC_NR)840 1110 A
1992(=)S
(proc_nr;)336 2076 A
4680 V
(12857)210 648 A
(tty_mess.REP_STATUS)798 1110 A
1950(=)S
(status;)294 2034 A
4770 V
(12858)210 648 A
1110(if)S
(\(\(status)336 1236 A
1614(=)S
(send\(replyee,)546 1698 A
(&tty_mess\)\))462 2286 A
2790(!=)S
(OK\))126 2916 A
4860 V
(12859)210 648 A
(panic\("tty_reply)672 1362 A
(failed,)294 2076 A
(status\\n",)420 2412 A
(status\);)336 2874 A
4950 V
(12860)210 648 A
1026(})S
5220 V
(12863)210 648 A
(/*===========================================================================*)3276 1026 A
5310 V
(12864)210 648 A
1068(*)S
(sigchar)294 2370 A
4260(*)S
5400 V
(12865)210 648 A
(*===========================================================================*/)3276 1068 A
5490 V
(12866)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(sigchar\(tp,)462 1530 A
(sig\))168 2034 A
5580 V
(12867)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
5670 V
(12868)210 648 A
(int)126 1026 A
(sig;)168 1194 A
2370(/*)S
(SIGINT,)294 2496 A
(SIGQUIT,)336 2832 A
(SIGKILL)294 3210 A
3546(or)S
(SIGHUP)252 3672 A
3966(*/)S
5760 V
(12869)210 648 A
1026({)S
5850 V
(12870)210 648 A
1026(/*)S
(Process)294 1152 A
1488(a)S
(SIGINT,)294 1572 A
(SIGQUIT)294 1908 A
2244(or)S
(SIGKILL)294 2370 A
(char)168 2706 A
(from)168 2916 A
(the)126 3126 A
(keyboard)336 3294 A
3672(or)S
(SIGHUP)252 3798 A
(from)168 4092 A
5940 V
(12871)210 648 A
1068(*)S
1152(a)S
(tty)126 1236 A
(close,)252 1404 A
("stty)210 1698 A
(0",)126 1950 A
2118(or)S
2244(a)S
(real)168 2328 A
(RS-232)252 2538 A
(hangup.)294 2832 A
3210(MM)S
(will)168 3336 A
(send)168 3546 A
(the)126 3756 A
(signal)252 3924 A
4218(to)S
6030 V
(12872)210 648 A
1068(*)S
(the)126 1152 A
(process)294 1320 A
(group)210 1656 A
(\(INT,)210 1908 A
(QUIT\),)252 2160 A
(all)126 2454 A
(processes)378 2622 A
(\(KILL\),)294 3042 A
3378(or)S
(the)126 3504 A
(session)294 3672 A
(leader)252 4008 A
6120 V
(12873)210 648 A
1068(*)S
(\(HUP\).)252 1152 A
6210 V
(12874)210 648 A
1068(*/)S
8418 V
EP
%%Page: 175 175
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
12 B
(175)180 4248 A
900 V
7 LST
(12875)210 648 A
990 V
(12876)210 648 A
1110(if)S
(\(tp->tty_pgrp)546 1236 A
1824(!=)S
1950(0\))S
(cause_sig\(tp->tty_pgrp,)966 2076 A
(sig\);)210 3084 A
1080 V
(12877)210 648 A
1170 V
(12878)210 648 A
1110(if)S
(\(!\(tp->tty_termios.c_lflag)1092 1236 A
2370(&)S
(NOFLSH\)\))336 2454 A
2832({)S
1260 V
(12879)210 648 A
(tp->tty_incount)630 1362 A
2034(=)S
(tp->tty_eotct)546 2118 A
2706(=)S
2790(0;)S
3042(/*)S
(kill)168 3168 A
(earlier)294 3378 A
(input)210 3714 A
3966(*/)S
1350 V
(12880)210 648 A
(tp->tty_intail)588 1362 A
1992(=)S
(tp->tty_inhead;)630 2076 A
1440 V
(12881)210 648 A
(\(*tp->tty_ocancel\)\(tp\);)966 1362 A
3042(/*)S
(kill)168 3168 A
(all)126 3378 A
(output)252 3546 A
3840(*/)S
1530 V
(12882)210 648 A
(tp->tty_inhibited)714 1362 A
2118(=)S
(RUNNING;)336 2202 A
1620 V
(12883)210 648 A
(tp->tty_events)588 1362 A
1992(=)S
2076(1;)S
1710 V
(12884)210 648 A
1110(})S
1800 V
(12885)210 648 A
1026(})S
2070 V
(12888)210 648 A
(/*==========================================================================*)3234 1026 A
2160 V
(12889)210 648 A
1068(*)S
(tty_icancel)462 2370 A
4218(*)S
2250 V
(12890)210 648 A
(*==========================================================================*/)3234 1068 A
2340 V
(12891)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(tty_icancel\(tp\))630 1572 A
2430 V
(12892)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
2520 V
(12893)210 648 A
1026({)S
2610 V
(12894)210 648 A
1026(/*)S
(Discard)294 1152 A
(all)126 1488 A
(pending)294 1656 A
(input,)252 1992 A
(tty)126 2286 A
(buffer)252 2454 A
2748(or)S
(device.)294 2874 A
3210(*/)S
2700 V
(12895)210 648 A
2790 V
(12896)210 648 A
(tp->tty_incount)630 1110 A
1782(=)S
(tp->tty_eotct)546 1866 A
2454(=)S
2538(0;)S
2880 V
(12897)210 648 A
(tp->tty_intail)588 1110 A
1740(=)S
(tp->tty_inhead;)630 1824 A
2970 V
(12898)210 648 A
(\(*tp->tty_icancel\)\(tp\);)966 1110 A
3060 V
(12899)210 648 A
1026(})S
3330 V
(12902)210 648 A
(/*==========================================================================*)3234 1026 A
3420 V
(12903)210 648 A
1068(*)S
(tty_init)336 2370 A
4218(*)S
3510 V
(12904)210 648 A
(*==========================================================================*/)3234 1068 A
3600 V
(12905)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(tty_init\(tp\))504 1572 A
3690 V
(12906)210 648 A
(tty_t)210 1026 A
(*tp;)168 1278 A
2370(/*)S
(TTY)126 2496 A
(line)168 2664 A
2874(to)S
(initialize.)462 3000 A
3504(*/)S
3780 V
(12907)210 648 A
1026({)S
3870 V
(12908)210 648 A
1026(/*)S
(Initialize)420 1152 A
(tty)126 1614 A
(structure)378 1782 A
(and)126 2202 A
(call)168 2370 A
(device)252 2580 A
(initialization)588 2874 A
(routines.)378 3504 A
3924(*/)S
3960 V
(12909)210 648 A
4050 V
(12910)210 648 A
(tp->tty_intail)588 1110 A
1740(=)S
(tp->tty_inhead)588 1824 A
2454(=)S
(tp->tty_inbuf;)588 2538 A
4140 V
(12911)210 648 A
(tp->tty_min)462 1110 A
1614(=)S
1698(1;)S
4230 V
(12912)210 648 A
(tp->tty_termios)630 1110 A
1782(=)S
(termios_defaults;)714 1866 A
4320 V
(12913)210 648 A
(tp->tty_icancel)630 1110 A
1782(=)S
(tp->tty_ocancel)630 1866 A
2538(=)S
(tp->tty_ioctl)546 2622 A
3210(=)S
(tp->tty_close)546 3294 A
3882(=)S
4410 V
(12914)210 648 A
(tty_devnop;)462 3714 A
4500 V
(12915)210 648 A
1110(if)S
(\(tp)126 1236 A
1404(<)S
(tty_addr\(NR_CONS\)\))756 1488 A
2286({)S
4590 V
(12916)210 648 A
(scr_init\(tp\);)546 1362 A
4680 V
(12917)210 648 A
1110(})S
(else)168 1194 A
4770 V
(12918)210 648 A
1110(if)S
(\(tp)126 1236 A
1404(<)S
(tty_addr\(NR_CONS+NR_RS_LINES\)\))1260 1488 A
2790({)S
4860 V
(12919)210 648 A
(rs_init\(tp\);)504 1362 A
4950 V
(12920)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5040 V
(12921)210 648 A
(pty_init\(tp\);)546 1362 A
5130 V
(12922)210 648 A
1110(})S
5220 V
(12923)210 648 A
1026(})S
5490 V
(12926)210 648 A
(/*==========================================================================*)3234 1026 A
5580 V
(12927)210 648 A
1068(*)S
(tty_wakeup)420 2370 A
4218(*)S
5670 V
(12928)210 648 A
(*==========================================================================*/)3234 1068 A
5760 V
(12929)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(tty_wakeup\(now\))630 1530 A
5850 V
(12930)210 648 A
(clock_t)294 1026 A
(now;)168 1362 A
2706(/*)S
(current)294 2832 A
(time)168 3168 A
3378(*/)S
5940 V
(12931)210 648 A
1026({)S
6030 V
(12932)210 648 A
1026(/*)S
(Wake)168 1152 A
1362(up)S
(TTY)126 1488 A
(when)168 1656 A
(something)378 1866 A
(interesting)462 2286 A
2790(is)S
(happening)378 2916 A
3336(on)S
(one)126 3462 A
3630(of)S
(the)126 3756 A
(terminal)336 3924 A
6120 V
(12933)210 648 A
1068(*)S
(lines,)252 1152 A
(like)168 1446 A
1656(a)S
(character)378 1740 A
(arriving)336 2160 A
2538(on)S
2664(an)S
(RS232)210 2790 A
(line,)210 3042 A
3294(a)S
(key)126 3378 A
(being)210 3546 A
(typed,)252 3798 A
4092(or)S
6210 V
(12934)210 648 A
1068(*)S
1152(a)S
(timer)210 1236 A
1488(on)S
1614(a)S
(line)168 1698 A
(expiring)336 1908 A
2286(by)S
(TIME.)210 2412 A
8418 V
EP
%%Page: 176 176
BP
/slant 0 def
/height 0 def
630 V
12 B
(176)180 648 A
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(12935)210 648 A
1068(*/)S
990 V
(12936)210 648 A
(tty_t)210 1110 A
(*tp;)168 1362 A
1080 V
(12937)210 648 A
1170 V
(12938)210 648 A
1110(/*)S
(Scan)168 1236 A
(the)126 1446 A
(timerlist)378 1614 A
(for)126 2034 A
(expired)294 2202 A
(timers)252 2538 A
(and)126 2832 A
(compute)294 3000 A
(the)126 3336 A
(next)168 3504 A
(timeout)294 3714 A
(time.)210 4050 A
4302(*/)S
1260 V
(12939)210 648 A
(tty_timeout)462 1110 A
1614(=)S
(TIME_NEVER;)462 1698 A
1350 V
(12940)210 648 A
(while)210 1110 A
(\(\(tp)168 1362 A
1572(=)S
(tty_timelist\))546 1656 A
2244(!=)S
(NULL\))210 2370 A
2622({)S
1440 V
(12941)210 648 A
1362(if)S
(\(tp->tty_time)546 1488 A
2076(>)S
(now\))168 2160 A
2370({)S
1530 V
(12942)210 648 A
(tty_timeout)462 1698 A
2202(=)S
(tp->tty_time;)546 2286 A
3042(/*)S
(this)168 3168 A
(timer)210 3378 A
3630(is)S
(next)168 3756 A
3966(*/)S
1620 V
(12943)210 648 A
(break;)252 1698 A
1710 V
(12944)210 648 A
1362(})S
1800 V
(12945)210 648 A
(tp->tty_min)462 1362 A
1866(=)S
1950(0;)S
3042(/*)S
(force)210 3168 A
(read)168 3420 A
3630(to)S
(succeed)294 3756 A
4092(*/)S
1890 V
(12946)210 648 A
(tp->tty_events)588 1362 A
1992(=)S
2076(1;)S
1980 V
(12947)210 648 A
(tty_timelist)504 1362 A
1908(=)S
(tp->tty_timenext;)714 1992 A
2070 V
(12948)210 648 A
1110(})S
2160 V
(12949)210 648 A
2250 V
(12950)210 648 A
1110(/*)S
(Let)126 1236 A
(TTY)126 1404 A
(know)168 1572 A
(there)210 1782 A
2034(is)S
(something)378 2160 A
(afoot.)252 2580 A
2874(*/)S
2340 V
(12951)210 648 A
(interrupt\(TTY\);)630 1110 A
2430 V
(12952)210 648 A
1026(})S
2700 V
(12955)210 648 A
(/*===========================================================================*)3276 1026 A
2790 V
(12956)210 648 A
1068(*)S
(settimer)336 2370 A
4260(*)S
2880 V
(12957)210 648 A
(*===========================================================================*/)3276 1068 A
2970 V
(12958)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(settimer\(tp,)504 1572 A
(on\))126 2118 A
3060 V
(12959)210 648 A
(tty_t)210 1026 A
(*tp;)168 1278 A
2370(/*)S
(line)168 2496 A
2706(to)S
(set)126 2832 A
3000(or)S
(unset)210 3126 A
3378(a)S
(timer)210 3462 A
3714(on)S
3840(*/)S
3150 V
(12960)210 648 A
(int)126 1026 A
(on;)126 1194 A
2370(/*)S
(set)126 2496 A
(timer)210 2664 A
2916(if)S
(true,)210 3042 A
(otherwise)378 3294 A
(unset)210 3714 A
3966(*/)S
3240 V
(12961)210 648 A
1026({)S
3330 V
(12962)210 648 A
1026(/*)S
(Set)126 1152 A
1320(or)S
(unset)210 1446 A
1698(a)S
(TIME)168 1782 A
(inspired)336 1992 A
(timer.)252 2370 A
(This)168 2706 A
(function)336 2916 A
3294(is)S
(interrupt)378 3420 A
(sensitive)378 3840 A
3420 V
(12963)210 648 A
1068(*)S
(due)126 1152 A
1320(to)S
(tty_wakeup\(\),)546 1446 A
2034(so)S
2160(it)S
(must)168 2286 A
2496(be)S
(called)252 2622 A
(from)168 2916 A
(within)252 3126 A
(lock\(\)/unlock\(\).)672 3420 A
3510 V
(12964)210 648 A
1068(*/)S
3600 V
(12965)210 648 A
(tty_t)210 1110 A
(**ptp;)252 1362 A
3690 V
(12966)210 648 A
3780 V
(12967)210 648 A
1110(/*)S
(Take)168 1236 A
1446(tp)S
(out)126 1572 A
1740(of)S
(the)126 1866 A
(timerlist)378 2034 A
2454(if)S
(present.)336 2580 A
2958(*/)S
3870 V
(12968)210 648 A
(for)126 1110 A
(\(ptp)168 1278 A
1488(=)S
(&tty_timelist;)588 1572 A
(*ptp)168 2202 A
2412(!=)S
(NULL;)210 2538 A
(ptp)126 2790 A
2958(=)S
(&\(*ptp\)->tty_timenext\))924 3042 A
4008({)S
3960 V
(12969)210 648 A
1362(if)S
(\(tp)126 1488 A
1656(==)S
(*ptp\))210 1782 A
2034({)S
4050 V
(12970)210 648 A
(*ptp)168 1698 A
1908(=)S
(tp->tty_timenext;)714 1992 A
3042(/*)S
(take)168 3168 A
3378(tp)S
(out)126 3504 A
3672(of)S
(the)126 3798 A
(list)168 3966 A
4176(*/)S
4140 V
(12971)210 648 A
(break;)252 1698 A
4230 V
(12972)210 648 A
1362(})S
4320 V
(12973)210 648 A
1110(})S
4410 V
(12974)210 648 A
1110(if)S
(\(!on\))210 1236 A
(return;)294 1488 A
3042(/*)S
(unsetting)378 3168 A
3588(it)S
3714(is)S
(enough)252 3840 A
4134(*/)S
4500 V
(12975)210 648 A
4590 V
(12976)210 648 A
1110(/*)S
(Timeout)294 1236 A
(occurs)252 1572 A
(TIME)168 1866 A
(deciseconds)462 2076 A
(from)168 2580 A
(now.)168 2790 A
3000(*/)S
4680 V
(12977)210 648 A
(tp->tty_time)504 1110 A
1656(=)S
(get_uptime\(\))504 1740 A
2286(+)S
(tp->tty_termios.c_cc[VTIME])1134 2370 A
3546(*)S
(\(HZ/10\);)336 3630 A
4770 V
(12978)210 648 A
4860 V
(12979)210 648 A
1110(/*)S
(Find)168 1236 A
1446(a)S
(new)126 1530 A
(place)210 1698 A
1950(in)S
(the)126 2076 A
(list.)210 2244 A
2496(*/)S
4950 V
(12980)210 648 A
(for)126 1110 A
(\(ptp)168 1278 A
1488(=)S
(&tty_timelist;)588 1572 A
(*ptp)168 2202 A
2412(!=)S
(NULL;)210 2538 A
(ptp)126 2790 A
2958(=)S
(&\(*ptp\)->tty_timenext\))924 3042 A
4008({)S
5040 V
(12981)210 648 A
1362(if)S
(\(tp->tty_time)546 1488 A
2076(<=)S
(\(*ptp\)->tty_time\))714 2202 A
(break;)252 2958 A
5130 V
(12982)210 648 A
1110(})S
5220 V
(12983)210 648 A
(tp->tty_timenext)672 1110 A
1824(=)S
(*ptp;)210 1908 A
5310 V
(12984)210 648 A
(*ptp)168 1110 A
1320(=)S
(tp;)126 1404 A
5400 V
(12985)210 648 A
1110(if)S
(\(tp->tty_time)546 1236 A
1824(<)S
(tty_timeout\))504 1908 A
(tty_timeout)462 2454 A
2958(=)S
(tp->tty_time;)546 3042 A
5490 V
(12986)210 648 A
1026(})S
5760 V
(12989)210 648 A
(/*==========================================================================*)3234 1026 A
5850 V
(12990)210 648 A
1068(*)S
(tty_devnop)420 2370 A
4218(*)S
5940 V
(12991)210 648 A
(*==========================================================================*/)3234 1068 A
6030 V
(12992)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(tty_devnop\(tp\))588 1530 A
6120 V
(12993)210 648 A
(tty_t)210 1026 A
(*tp;)168 1278 A
6210 V
(12994)210 648 A
1026({)S
8418 V
EP
%%Page: 177 177
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
(src/kernel/tty.c)665 2322 A
12 B
(177)180 4248 A
900 V
7 LST
(12995)210 648 A
1110(/*)S
(Some)168 1236 A
(functions)378 1446 A
(need)168 1866 A
(not)126 2076 A
2244(be)S
(implemented)462 2370 A
2874(at)S
(the)126 3000 A
(device)252 3168 A
(level.)252 3462 A
3756(*/)S
990 V
(12996)210 648 A
1026(})S
1440 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1530 V
(src/kernel/keyboard.c)882 2034 A
1620 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1800 V
(13000)210 648 A
1026(/*)S
(Keyboard)336 1152 A
(driver)252 1530 A
(for)126 1824 A
(PC's)168 1992 A
(and)126 2202 A
(AT's.)210 2370 A
1890 V
(13001)210 648 A
1068(*)S
1980 V
(13002)210 648 A
1068(*)S
(Changed)294 1152 A
1488(by)S
(Marcus)252 1614 A
(Hampel)252 1908 A
(\(04/02/1994\))504 2370 A
2070 V
(13003)210 648 A
1068(*)S
1194(-)S
(Loadable)336 1278 A
(keymaps)294 1656 A
2160 V
(13004)210 648 A
1068(*/)S
2250 V
(13005)210 648 A
2340 V
(13006)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
2430 V
(13007)210 648 A
(#include)336 1026 A
(<termios.h>)462 1404 A
2520 V
(13008)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
2610 V
(13009)210 648 A
(#include)336 1026 A
(<unistd.h>)420 1404 A
2700 V
(13010)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
2790 V
(13011)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
2880 V
(13012)210 648 A
(#include)336 1026 A
(<minix/keymap.h>)672 1404 A
2970 V
(13013)210 648 A
(#include)336 1026 A
("tty.h")294 1404 A
3060 V
(13014)210 648 A
(#include)336 1026 A
("keymaps/us-std.src")840 1404 A
3150 V
(13015)210 648 A
3240 V
(13016)210 648 A
1026(/*)S
(Standard)336 1152 A
(and)126 1530 A
1698(AT)S
(keyboard.)378 1824 A
(\(PS/2)210 2286 A
(MCA)126 2538 A
(implies)294 2706 A
3042(AT)S
(throughout.\))504 3168 A
3714(*/)S
3330 V
(13017)210 648 A
(#define)294 1026 A
(KEYBD)210 1362 A
(0x60)168 2034 A
2370(/*)S
(I/O)126 2496 A
(port)168 2664 A
(for)126 2874 A
(keyboard)336 3042 A
(data)168 3420 A
3630(*/)S
3420 V
(13018)210 648 A
3510 V
(13019)210 648 A
1026(/*)S
1152(AT)S
(keyboard.)378 1278 A
1698(*/)S
3600 V
(13020)210 648 A
(#define)294 1026 A
(KB_COMMAND)420 1362 A
(0x64)168 2034 A
2370(/*)S
(I/O)126 2496 A
(port)168 2664 A
(for)126 2874 A
(commands)336 3042 A
3420(on)S
3546(AT)S
3672(*/)S
3690 V
(13021)210 648 A
(#define)294 1026 A
(KB_GATE_A20)462 1362 A
(0x02)168 2034 A
2370(/*)S
(bit)126 2496 A
2664(in)S
(output)252 2790 A
(port)168 3084 A
3294(to)S
(enable)252 3420 A
(A20)126 3714 A
(line)168 3882 A
4092(*/)S
3780 V
(13022)210 648 A
(#define)294 1026 A
(KB_PULSE_OUTPUT)630 1362 A
(0xF0)168 2034 A
2370(/*)S
(base)168 2496 A
(for)126 2706 A
(commands)336 2874 A
3252(to)S
(pulse)210 3378 A
(output)252 3630 A
(port)168 3924 A
4134(*/)S
3870 V
(13023)210 648 A
(#define)294 1026 A
(KB_RESET)336 1362 A
(0x01)168 2034 A
2370(/*)S
(bit)126 2496 A
2664(in)S
(output)252 2790 A
(port)168 3084 A
3294(to)S
(reset)210 3420 A
(CPU)126 3672 A
3840(*/)S
3960 V
(13024)210 648 A
(#define)294 1026 A
(KB_STATUS)378 1362 A
(0x64)168 2034 A
2370(/*)S
(I/O)126 2496 A
(port)168 2664 A
(for)126 2874 A
(status)252 3042 A
3336(on)S
3462(AT)S
3588(*/)S
4050 V
(13025)210 648 A
(#define)294 1026 A
(KB_ACK)252 1362 A
(0xFA)168 2034 A
2370(/*)S
(keyboard)336 2496 A
(ack)126 2874 A
(response)336 3042 A
3420(*/)S
4140 V
(13026)210 648 A
(#define)294 1026 A
(KB_BUSY)294 1362 A
(0x02)168 2034 A
2370(/*)S
(status)252 2496 A
(bit)126 2790 A
(set)126 2958 A
(when)168 3126 A
(KEYBD)210 3336 A
(port)168 3588 A
(ready)210 3798 A
4050(*/)S
4230 V
(13027)210 648 A
(#define)294 1026 A
(LED_CODE)336 1362 A
(0xED)168 2034 A
2370(/*)S
(command)294 2496 A
2832(to)S
(keyboard)336 2958 A
3336(to)S
(set)126 3462 A
(LEDs)168 3630 A
3840(*/)S
4320 V
(13028)210 648 A
(#define)294 1026 A
(MAX_KB_ACK_RETRIES)756 1362 A
(0x1000)252 2160 A
2706(/*)S
(max)126 2832 A
(#times)252 3000 A
3294(to)S
(wait)168 3420 A
(for)126 3630 A
3798(kb)S
(ack)126 3924 A
4092(*/)S
4410 V
(13029)210 648 A
(#define)294 1026 A
(MAX_KB_BUSY_RETRIES)798 1362 A
(0x1000)252 2202 A
2706(/*)S
(max)126 2832 A
(#times)252 3000 A
3294(to)S
(loop)168 3420 A
(while)210 3630 A
3882(kb)S
(busy)168 4008 A
4218(*/)S
4500 V
(13030)210 648 A
(#define)294 1026 A
(KBIT)168 1362 A
(0x80)168 2034 A
2370(/*)S
(bit)126 2496 A
(used)168 2664 A
2874(to)S
(ack)126 3000 A
(characters)420 3168 A
3630(to)S
(keyboard)336 3756 A
4134(*/)S
4590 V
(13031)210 648 A
4680 V
(13032)210 648 A
1026(/*)S
(Miscellaneous.)588 1152 A
1782(*/)S
4770 V
(13033)210 648 A
(#define)294 1026 A
(ESC_SCAN)336 1362 A
2160(1)S
2370(/*)S
(Reboot)252 2496 A
(key)126 2790 A
(when)168 2958 A
(panicking)378 3168 A
3588(*/)S
4860 V
(13034)210 648 A
(#define)294 1026 A
(SLASH_SCAN)420 1362 A
2118(53)S
2370(/*)S
2496(to)S
(recognize)378 2622 A
(numeric)294 3042 A
(slash)210 3378 A
3630(*/)S
4950 V
(13035)210 648 A
(#define)294 1026 A
(HOME_SCAN)378 1362 A
2118(71)S
2370(/*)S
(first)210 2496 A
(key)126 2748 A
2916(on)S
(the)126 3042 A
(numeric)294 3210 A
(keypad)252 3546 A
3840(*/)S
5040 V
(13036)210 648 A
(#define)294 1026 A
(DEL_SCAN)336 1362 A
2118(83)S
2370(/*)S
(DEL)126 2496 A
(for)126 2664 A
(use)126 2832 A
3000(in)S
(CTRL-ALT-DEL)504 3126 A
(reboot)252 3672 A
3966(*/)S
5130 V
(13037)210 648 A
(#define)294 1026 A
(CONSOLE)294 1362 A
2160(0)S
2370(/*)S
(line)168 2496 A
(number)252 2706 A
(for)126 3000 A
(console)294 3168 A
3504(*/)S
5220 V
(13038)210 648 A
(#define)294 1026 A
(MEMCHECK_ADR)504 1362 A
(0x472)210 1992 A
2370(/*)S
(address)294 2496 A
2832(to)S
(stop)168 2958 A
(memory)252 3168 A
(check)210 3462 A
(after)210 3714 A
(reboot)252 3966 A
4260(*/)S
5310 V
(13039)210 648 A
(#define)294 1026 A
(MEMCHECK_MAG)504 1362 A
(0x1234)252 1950 A
2370(/*)S
(magic)210 2496 A
(number)252 2748 A
3042(to)S
(stop)168 3168 A
(memory)252 3378 A
(check)210 3672 A
3924(*/)S
5400 V
(13040)210 648 A
5490 V
(13041)210 648 A
(#define)294 1026 A
(kb_addr\(\))378 1362 A
(\(&kb_lines[0]\))588 2034 A
2706(/*)S
(there)210 2832 A
3084(is)S
(only)168 3210 A
(one)126 3420 A
(keyboard)336 3588 A
3966(*/)S
5580 V
(13042)210 648 A
(#define)294 1026 A
(KB_IN_BYTES)462 1362 A
2118(32)S
2370(/*)S
(size)168 2496 A
2706(of)S
(keyboard)336 2832 A
(input)210 3210 A
(buffer)252 3462 A
3756(*/)S
5670 V
(13043)210 648 A
5760 V
(13044)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(alt1;)210 1530 A
2370(/*)S
(left)168 2496 A
(alt)126 2706 A
(key)126 2874 A
(state)210 3042 A
3294(*/)S
5850 V
(13045)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(alt2;)210 1530 A
2370(/*)S
(right)210 2496 A
(alt)126 2748 A
(key)126 2916 A
(state)210 3084 A
3336(*/)S
5940 V
(13046)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(capslock;)378 1530 A
2370(/*)S
(caps)168 2496 A
(lock)168 2706 A
(key)126 2916 A
(state)210 3084 A
3336(*/)S
6030 V
(13047)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(esc;)168 1530 A
2370(/*)S
(escape)252 2496 A
(scan)168 2790 A
(code)168 3000 A
(detected?)378 3210 A
3630(*/)S
6120 V
(13048)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(control;)336 1530 A
2370(/*)S
(control)294 2496 A
(key)126 2832 A
(state)210 3000 A
3252(*/)S
6210 V
(13049)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(caps_off;)378 1530 A
2370(/*)S
2496(1)S
2580(=)S
(normal)252 2664 A
(position,)378 2958 A
3378(0)S
3462(=)S
(depressed)378 3546 A
3966(*/)S
8418 V
EP
%%Page: 178 178
BP
/slant 0 def
/height 0 def
630 V
12 B
(178)180 648 A
11 R
1941(File:)S
(src/kernel/keyboard.c)960 2174 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(13050)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(numlock;)336 1530 A
2370(/*)S
(number)252 2496 A
(lock)168 2790 A
(key)126 3000 A
(state)210 3168 A
3420(*/)S
990 V
(13051)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(num_off;)336 1530 A
2370(/*)S
2496(1)S
2580(=)S
(normal)252 2664 A
(position,)378 2958 A
3378(0)S
3462(=)S
(depressed)378 3546 A
3966(*/)S
1080 V
(13052)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(slock;)252 1530 A
2370(/*)S
(scroll)252 2496 A
(lock)168 2790 A
(key)126 3000 A
(state)210 3168 A
3420(*/)S
1170 V
(13053)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(slock_off;)420 1530 A
2370(/*)S
2496(1)S
2580(=)S
(normal)252 2664 A
(position,)378 2958 A
3378(0)S
3462(=)S
(depressed)378 3546 A
3966(*/)S
1260 V
(13054)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(shift;)252 1530 A
2370(/*)S
(shift)210 2496 A
(key)126 2748 A
(state)210 2916 A
3168(*/)S
1350 V
(13055)210 648 A
1440 V
(13056)210 648 A
(PRIVATE)294 1026 A
(char)168 1362 A
(numpad_map[])504 1572 A
2118(=)S
1530 V
(13057)210 648 A
({'H',)210 1698 A
('Y',)168 1950 A
('A',)168 2160 A
('B',)168 2370 A
('D',)168 2580 A
('C',)168 2790 A
('V',)168 3000 A
('U',)168 3210 A
('G',)168 3420 A
('S',)168 3630 A
('T',)168 3840 A
('@'};)210 4050 A
1620 V
(13058)210 648 A
1710 V
(13059)210 648 A
1026(/*)S
(Keyboard)336 1152 A
(structure,)420 1530 A
1992(1)S
(per)126 2076 A
(console.)336 2244 A
2622(*/)S
1800 V
(13060)210 648 A
(struct)252 1026 A
(kb_s)168 1320 A
1530({)S
1890 V
(13061)210 648 A
(char)168 1110 A
(*ihead;)294 1320 A
2370(/*)S
(next)168 2496 A
(free)168 2706 A
(spot)168 2916 A
3126(in)S
(input)210 3252 A
(buffer)252 3504 A
3798(*/)S
1980 V
(13062)210 648 A
(char)168 1110 A
(*itail;)294 1320 A
2370(/*)S
(scan)168 2496 A
(code)168 2706 A
2916(to)S
(return)252 3042 A
3336(to)S
(TTY)126 3462 A
3630(*/)S
2070 V
(13063)210 648 A
(int)126 1110 A
(icount;)294 1278 A
2370(/*)S
2496(#)S
(codes)210 2580 A
2832(in)S
(buffer)252 2958 A
3252(*/)S
2160 V
(13064)210 648 A
(char)168 1110 A
(ibuf[KB_IN_BYTES];)756 1320 A
2370(/*)S
(input)210 2496 A
(buffer)252 2748 A
3042(*/)S
2250 V
(13065)210 648 A
1026(};)S
2340 V
(13066)210 648 A
2430 V
(13067)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(kb_s)168 1656 A
(kb_lines[NR_CONS];)756 1866 A
2520 V
(13068)210 648 A
2610 V
(13069)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(kb_ack,)294 2034 A
(\(void\))252 2370 A
2664(\);)S
2700 V
(13070)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(kb_wait,)336 2034 A
(\(void\))252 2412 A
2706(\);)S
2790 V
(13071)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(func_key,)378 2034 A
(\(int)168 2454 A
(scode\))252 2664 A
2958(\);)S
2880 V
(13072)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(scan_keyboard,)588 2034 A
(\(void\))252 2664 A
2958(\);)S
2970 V
(13073)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(unsigned)336 1866 A
(make_break,)462 2244 A
(\(int)168 2748 A
(scode\))252 2958 A
3252(\);)S
3060 V
(13074)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(set_leds,)378 2076 A
(\(void\))252 2496 A
2790(\);)S
3150 V
(13075)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(kbd_hw_int,)462 2034 A
(\(int)168 2538 A
(irq\))168 2748 A
2958(\);)S
3240 V
(13076)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(kb_read,)336 2076 A
(\(struct)294 2454 A
(tty)126 2790 A
(*tp\))168 2958 A
3168(\);)S
3330 V
(13077)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(unsigned)336 1866 A
(map_key,)336 2244 A
(\(int)168 2622 A
(scode\))252 2832 A
3126(\);)S
3420 V
(13078)210 648 A
3510 V
(13079)210 648 A
3600 V
(13080)210 648 A
(/*===========================================================================*)3276 1026 A
3690 V
(13081)210 648 A
1068(*)S
(map_key0)336 2370 A
4260(*)S
3780 V
(13082)210 648 A
(*===========================================================================*/)3276 1068 A
3870 V
(13083)210 648 A
1026(/*)S
(Map)126 1152 A
1320(a)S
(scan)168 1404 A
(code)168 1614 A
1824(to)S
1950(an)S
(ASCII)210 2076 A
(code)168 2328 A
(ignoring)336 2538 A
(modifiers.)420 2916 A
3378(*/)S
3960 V
(13084)210 648 A
(#define)294 1026 A
(map_key0\(scode\))630 1362 A
2076(\\)S
4050 V
(13085)210 648 A
(\(\(unsigned\))462 1362 A
(keymap[\(scode\))588 1866 A
2496(*)S
(MAP_COLS]\))420 2580 A
4140 V
(13086)210 648 A
4230 V
(13087)210 648 A
4320 V
(13088)210 648 A
(/*===========================================================================*)3276 1026 A
4410 V
(13089)210 648 A
1068(*)S
(map_key)294 2370 A
4260(*)S
4500 V
(13090)210 648 A
(*===========================================================================*/)3276 1068 A
4590 V
(13091)210 648 A
(PRIVATE)294 1026 A
(unsigned)336 1362 A
(map_key\(scode\))588 1740 A
4680 V
(13092)210 648 A
(int)126 1026 A
(scode;)252 1194 A
4770 V
(13093)210 648 A
1026({)S
4860 V
(13094)210 648 A
1026(/*)S
(Map)126 1152 A
1320(a)S
(scan)168 1404 A
(code)168 1614 A
1824(to)S
1950(an)S
(ASCII)210 2076 A
(code.)210 2328 A
2580(*/)S
4950 V
(13095)210 648 A
5040 V
(13096)210 648 A
(int)126 1110 A
(caps,)210 1278 A
(column;)294 1530 A
5130 V
(13097)210 648 A
(u16_t)210 1110 A
(*keyrow;)336 1362 A
5220 V
(13098)210 648 A
5310 V
(13099)210 648 A
1110(if)S
(\(scode)252 1236 A
1530(==)S
(SLASH_SCAN)420 1656 A
2118(&&)S
(esc\))168 2244 A
(return)252 2454 A
('/';)168 2748 A
3042(/*)S
(don't)210 3168 A
(map)126 3420 A
(numeric)294 3588 A
(slash)210 3924 A
4176(*/)S
5400 V
(13100)210 648 A
5490 V
(13101)210 648 A
(keyrow)252 1110 A
1404(=)S
(&keymap[scode)546 1488 A
2076(*)S
(MAP_COLS];)420 2160 A
5580 V
(13102)210 648 A
5670 V
(13103)210 648 A
(caps)168 1110 A
1320(=)S
(shift;)252 1404 A
5760 V
(13104)210 648 A
1110(if)S
(\(numlock)336 1236 A
1614(&&)S
(HOME_SCAN)378 1740 A
2160(<=)S
(scode)210 2286 A
2538(&&)S
(scode)210 2664 A
2916(<=)S
(DEL_SCAN\))378 3042 A
(caps)168 3462 A
3672(=)S
(!caps;)252 3756 A
5850 V
(13105)210 648 A
1110(if)S
(\(capslock)378 1236 A
1656(&&)S
(\(keyrow[0])420 1782 A
2244(&)S
(HASCAPS\)\))378 2328 A
(caps)168 2748 A
2958(=)S
(!caps;)252 3042 A
5940 V
(13106)210 648 A
6030 V
(13107)210 648 A
1110(if)S
(\(alt1)210 1236 A
1488(||)S
(alt2\))210 1614 A
1866({)S
6120 V
(13108)210 648 A
(column)252 1362 A
1656(=)S
1740(2;)S
6210 V
(13109)210 648 A
1362(if)S
(\(control)336 1488 A
1866(||)S
(alt2\))210 1992 A
(column)252 2244 A
2538(=)S
2622(3;)S
3042(/*)S
(Ctrl)168 3168 A
3378(+)S
(Alt1)168 3462 A
3672(==)S
(Alt2)168 3798 A
4008(*/)S
8418 V
EP
%%Page: 179 179
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1941(File:)S
(src/kernel/keyboard.c)960 2174 A
12 B
(179)180 4248 A
900 V
7 LST
(13110)210 648 A
1362(if)S
(\(caps\))252 1488 A
(column)252 1782 A
2076(=)S
2160(4;)S
990 V
(13111)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1080 V
(13112)210 648 A
(column)252 1362 A
1656(=)S
1740(0;)S
1170 V
(13113)210 648 A
1362(if)S
(\(caps\))252 1488 A
(column)252 1782 A
2076(=)S
2160(1;)S
1260 V
(13114)210 648 A
1362(if)S
(\(control\))378 1488 A
(column)252 1908 A
2202(=)S
2286(5;)S
1350 V
(13115)210 648 A
1110(})S
1440 V
(13116)210 648 A
(return)252 1110 A
(keyrow[column])588 1404 A
2034(&)S
(\304HASCAPS;)378 2118 A
1530 V
(13117)210 648 A
1026(})S
1800 V
(13120)210 648 A
(/*===========================================================================*)3276 1026 A
1890 V
(13121)210 648 A
1068(*)S
(kbd_hw_int)420 2370 A
4260(*)S
1980 V
(13122)210 648 A
(*===========================================================================*/)3276 1068 A
2070 V
(13123)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(kbd_hw_int\(irq\))630 1530 A
2160 V
(13124)210 648 A
(int)126 1026 A
(irq;)168 1194 A
2250 V
(13125)210 648 A
1026({)S
2340 V
(13126)210 648 A
1026(/*)S
1152(A)S
(keyboard)336 1236 A
(interrupt)378 1614 A
(has)126 2034 A
(occurred.)378 2202 A
(Process)294 2664 A
(it.)126 3000 A
3168(*/)S
2430 V
(13127)210 648 A
2520 V
(13128)210 648 A
(int)126 1110 A
(code;)210 1278 A
2610 V
(13129)210 648 A
(unsigned)336 1110 A
(km;)126 1488 A
2700 V
(13130)210 648 A
(register)336 1110 A
(struct)252 1488 A
(kb_s)168 1782 A
(*kb;)168 1992 A
2790 V
(13131)210 648 A
2880 V
(13132)210 648 A
1110(/*)S
(Fetch)210 1236 A
(the)126 1488 A
(character)378 1656 A
(from)168 2076 A
(the)126 2286 A
(keyboard)336 2454 A
(hardware)336 2832 A
(and)126 3210 A
(acknowledge)462 3378 A
(it.)126 3882 A
4050(*/)S
2970 V
(13133)210 648 A
(code)168 1110 A
1320(=)S
(scan_keyboard\(\);)672 1404 A
3060 V
(13134)210 648 A
3150 V
(13135)210 648 A
1110(/*)S
(The)126 1236 A
(IBM)126 1404 A
(keyboard)336 1572 A
(interrupts)420 1950 A
(twice)210 2412 A
(per)126 2664 A
(key,)168 2832 A
(once)168 3042 A
(when)168 3252 A
(depressed,)420 3462 A
(once)168 3924 A
(when)168 4134 A
3240 V
(13136)210 648 A
1152(*)S
(released.)378 1236 A
(Filter)252 1698 A
(out)126 1992 A
(the)126 2160 A
(latter,)294 2328 A
(ignoring)336 2664 A
(all)126 3042 A
(but)126 3210 A
(the)126 3378 A
(shift-type)420 3546 A
(keys.)210 4008 A
3330 V
(13137)210 648 A
1152(*)S
(The)126 1236 A
(shift-type)420 1404 A
(keys)168 1866 A
(29,)126 2076 A
(42,)126 2244 A
(54,)126 2412 A
(56,)126 2580 A
(58,)126 2748 A
(and)126 2916 A
3084(69)S
(must)168 3210 A
3420(be)S
(processed)378 3546 A
(normally.)378 3966 A
3420 V
(13138)210 648 A
1152(*/)S
3510 V
(13139)210 648 A
3600 V
(13140)210 648 A
1110(if)S
(\(code)210 1236 A
1488(&)S
(0200\))210 1572 A
1824({)S
3690 V
(13141)210 648 A
1362(/*)S
1488(A)S
(key)126 1572 A
(has)126 1740 A
(been)168 1908 A
(released)336 2118 A
(\(high)210 2496 A
(bit)126 2748 A
2916(is)S
(set\).)210 3042 A
3294(*/)S
3780 V
(13142)210 648 A
1362(km)S
1488(=)S
(map_key0\(code)546 1572 A
2160(&)S
(0177\);)252 2244 A
3870 V
(13143)210 648 A
1362(if)S
(\(km)126 1488 A
1656(!=)S
(CTRL)168 1782 A
1992(&&)S
2118(km)S
2244(!=)S
(SHIFT)210 2370 A
2622(&&)S
2748(km)S
2874(!=)S
(ALT)126 3000 A
3168(&&)S
3294(km)S
3420(!=)S
(CALOCK)252 3546 A
3960 V
(13144)210 648 A
2034(&&)S
2160(km)S
2286(!=)S
(NLOCK)210 2412 A
2664(&&)S
2790(km)S
2916(!=)S
(SLOCK)210 3042 A
3294(&&)S
3420(km)S
3546(!=)S
(EXTKEY\))294 3672 A
4050 V
(13145)210 648 A
(return)252 1698 A
1992(1;)S
4140 V
(13146)210 648 A
1110(})S
4230 V
(13147)210 648 A
4320 V
(13148)210 648 A
1110(/*)S
(Store)210 1236 A
(the)126 1488 A
(character)378 1656 A
2076(in)S
(memory)252 2202 A
2496(so)S
(the)126 2622 A
(task)168 2790 A
(can)126 3000 A
(get)126 3168 A
3336(at)S
3462(it)S
(later.)252 3588 A
3882(*/)S
4410 V
(13149)210 648 A
1110(kb)S
1236(=)S
(kb_addr\(\);)420 1320 A
4500 V
(13150)210 648 A
1110(if)S
(\(kb->icount)462 1236 A
1740(<)S
(KB_IN_BYTES\))504 1824 A
2370({)S
4590 V
(13151)210 648 A
(*kb->ihead++)504 1362 A
1908(=)S
(code;)210 1992 A
4680 V
(13152)210 648 A
1362(if)S
(\(kb->ihead)420 1488 A
1950(==)S
(kb->ibuf)336 2076 A
2454(+)S
(KB_IN_BYTES\))504 2538 A
(kb->ihead)378 3084 A
3504(=)S
(kb->ibuf;)378 3588 A
4770 V
(13153)210 648 A
(kb->icount++;)546 1362 A
4860 V
(13154)210 648 A
(tty_table[current].tty_events)1218 1362 A
2622(=)S
2706(1;)S
4950 V
(13155)210 648 A
(force_timeout\(\);)672 1362 A
5040 V
(13156)210 648 A
1110(})S
5130 V
(13157)210 648 A
1110(/*)S
(Else)168 1236 A
1446(it)S
(doesn't)294 1572 A
(fit)126 1908 A
2076(-)S
(discard)294 2160 A
(it.)126 2496 A
2664(*/)S
5220 V
(13158)210 648 A
(return)252 1110 A
1404(1;)S
1698(/*)S
(Reenable)336 1824 A
(keyboard)336 2202 A
(interrupt)378 2580 A
3000(*/)S
5310 V
(13159)210 648 A
1026(})S
5580 V
(13162)210 648 A
(/*==========================================================================*)3234 1026 A
5670 V
(13163)210 648 A
1068(*)S
(kb_read)294 2370 A
4218(*)S
5760 V
(13164)210 648 A
(*==========================================================================*/)3234 1068 A
5850 V
(13165)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(kb_read\(tp\))462 1572 A
5940 V
(13166)210 648 A
(tty_t)210 1026 A
(*tp;)168 1278 A
6030 V
(13167)210 648 A
1026({)S
6120 V
(13168)210 648 A
1026(/*)S
(Process)294 1152 A
(characters)420 1488 A
(from)168 1950 A
(the)126 2160 A
(circular)336 2328 A
(keyboard)336 2706 A
(buffer.)294 3084 A
3420(*/)S
6210 V
(13169)210 648 A
8418 V
EP
%%Page: 180 180
BP
/slant 0 def
/height 0 def
630 V
12 B
(180)180 648 A
11 R
1941(File:)S
(src/kernel/keyboard.c)960 2174 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(13170)210 648 A
(struct)252 1110 A
(kb_s)168 1404 A
(*kb;)168 1614 A
990 V
(13171)210 648 A
(char)168 1110 A
(buf[3];)294 1320 A
1080 V
(13172)210 648 A
(int)126 1110 A
(scode;)252 1278 A
1170 V
(13173)210 648 A
(unsigned)336 1110 A
(ch;)126 1488 A
1260 V
(13174)210 648 A
1350 V
(13175)210 648 A
1110(kb)S
1236(=)S
(kb_addr\(\);)420 1320 A
1440 V
(13176)210 648 A
1110(tp)S
1236(=)S
(&tty_table[current];)840 1320 A
2706(/*)S
(always)252 2832 A
(use)126 3126 A
(the)126 3294 A
(current)294 3462 A
(console)294 3798 A
4134(*/)S
1530 V
(13177)210 648 A
1620 V
(13178)210 648 A
(while)210 1110 A
(\(kb->icount)462 1362 A
1866(>)S
1950(0\))S
2076({)S
1710 V
(13179)210 648 A
(scode)210 1362 A
1614(=)S
(*kb->itail++;)546 1698 A
3042(/*)S
(take)168 3168 A
(one)126 3378 A
(key)126 3546 A
(scan)168 3714 A
(code)168 3924 A
4134(*/)S
1800 V
(13180)210 648 A
1362(if)S
(\(kb->itail)420 1488 A
1950(==)S
(kb->ibuf)336 2076 A
2454(+)S
(KB_IN_BYTES\))504 2538 A
(kb->itail)378 3084 A
3504(=)S
(kb->ibuf;)378 3588 A
1890 V
(13181)210 648 A
(lock\(\);)294 1362 A
1980 V
(13182)210 648 A
(kb->icount--;)546 1362 A
2070 V
(13183)210 648 A
(unlock\(\);)378 1362 A
2160 V
(13184)210 648 A
2250 V
(13185)210 648 A
1362(/*)S
(Function)336 1488 A
(keys)168 1866 A
(are)126 2076 A
(being)210 2244 A
(used)168 2496 A
(for)126 2706 A
(debug)210 2874 A
(dumps.)252 3126 A
3420(*/)S
2340 V
(13186)210 648 A
1362(if)S
(\(func_key\(scode\)\))714 1488 A
(continue;)378 2244 A
2430 V
(13187)210 648 A
2520 V
(13188)210 648 A
1362(/*)S
(Perform)294 1488 A
(make/break)420 1824 A
(processing.)462 2286 A
2790(*/)S
2610 V
(13189)210 648 A
1362(ch)S
1488(=)S
(make_break\(scode\);)756 1572 A
2700 V
(13190)210 648 A
2790 V
(13191)210 648 A
1362(if)S
(\(ch)126 1488 A
1656(<=)S
(0xFF\))210 1782 A
2034({)S
2880 V
(13192)210 648 A
1698(/*)S
1824(A)S
(normal)252 1908 A
(character.)420 2202 A
2664(*/)S
2970 V
(13193)210 648 A
(buf[0])252 1698 A
1992(=)S
(ch;)126 2076 A
3060 V
(13194)210 648 A
(\(void\))252 1698 A
(in_process\(tp,)588 1992 A
(buf,)168 2622 A
(1\);)126 2832 A
3150 V
(13195)210 648 A
1362(})S
(else)168 1446 A
3240 V
(13196)210 648 A
1362(if)S
(\(HOME)210 1488 A
1740(<=)S
1866(ch)S
1992(&&)S
2118(ch)S
2244(<=)S
(INSRT\))252 2370 A
2664({)S
3330 V
(13197)210 648 A
1698(/*)S
1824(An)S
(ASCII)210 1950 A
(escape)252 2202 A
(sequence)336 2496 A
(generated)378 2874 A
3294(by)S
(the)126 3420 A
(numeric)294 3588 A
(pad.)168 3924 A
4134(*/)S
3420 V
(13198)210 648 A
(buf[0])252 1698 A
1992(=)S
(ESC;)168 2076 A
3510 V
(13199)210 648 A
(buf[1])252 1698 A
1992(=)S
('[';)168 2076 A
3600 V
(13200)210 648 A
(buf[2])252 1698 A
1992(=)S
(numpad_map[ch)546 2076 A
2664(-)S
(HOME];)252 2748 A
3690 V
(13201)210 648 A
(\(void\))252 1698 A
(in_process\(tp,)588 1992 A
(buf,)168 2622 A
(3\);)126 2832 A
3780 V
(13202)210 648 A
1362(})S
(else)168 1446 A
3870 V
(13203)210 648 A
1362(if)S
(\(ch)126 1488 A
1656(==)S
(ALEFT\))252 1782 A
2076({)S
3960 V
(13204)210 648 A
1698(/*)S
(Choose)252 1824 A
(lower)210 2118 A
(numbered)336 2370 A
(console)294 2748 A
3084(as)S
(current)294 3210 A
(console.)336 3546 A
3924(*/)S
4050 V
(13205)210 648 A
(select_console\(current)924 1698 A
2664(-)S
(1\);)126 2748 A
4140 V
(13206)210 648 A
1362(})S
(else)168 1446 A
4230 V
(13207)210 648 A
1362(if)S
(\(ch)126 1488 A
1656(==)S
(ARIGHT\))294 1782 A
2118({)S
4320 V
(13208)210 648 A
1698(/*)S
(Choose)252 1824 A
(higher)252 2118 A
(numbered)336 2412 A
(console)294 2790 A
3126(as)S
(current)294 3252 A
(console.)336 3588 A
3966(*/)S
4410 V
(13209)210 648 A
(select_console\(current)924 1698 A
2664(+)S
(1\);)126 2748 A
4500 V
(13210)210 648 A
1362(})S
(else)168 1446 A
4590 V
(13211)210 648 A
1362(if)S
(\(AF1)168 1488 A
1698(<=)S
1824(ch)S
1950(&&)S
2076(ch)S
2202(<=)S
(AF12\))210 2328 A
2580({)S
4680 V
(13212)210 648 A
1698(/*)S
(Alt-F1)252 1824 A
2118(is)S
(console,)336 2244 A
(Alt-F2)252 2622 A
2916(is)S
(ttyc1,)252 3042 A
(etc.)168 3336 A
3546(*/)S
4770 V
(13213)210 648 A
(select_console\(ch)714 1698 A
2454(-)S
(AF1\);)210 2538 A
4860 V
(13214)210 648 A
1362(})S
4950 V
(13215)210 648 A
1110(})S
5040 V
(13216)210 648 A
1026(})S
5310 V
(13219)210 648 A
(/*===========================================================================*)3276 1026 A
5400 V
(13220)210 648 A
1068(*)S
(make_break)420 2370 A
4260(*)S
5490 V
(13221)210 648 A
(*===========================================================================*/)3276 1068 A
5580 V
(13222)210 648 A
(PRIVATE)294 1026 A
(unsigned)336 1362 A
(make_break\(scode\))714 1740 A
5670 V
(13223)210 648 A
(int)126 1026 A
(scode;)252 1194 A
2370(/*)S
(scan)168 2496 A
(code)168 2706 A
2916(of)S
(key)126 3042 A
(just)168 3210 A
(struck)252 3420 A
3714(or)S
(released)336 3840 A
4218(*/)S
5760 V
(13224)210 648 A
1026({)S
5850 V
(13225)210 648 A
1026(/*)S
(This)168 1152 A
(routine)294 1362 A
(can)126 1698 A
(handle)252 1866 A
(keyboards)378 2160 A
(that)168 2580 A
(interrupt)378 2790 A
(only)168 3210 A
3420(on)S
(key)126 3546 A
(depression,)462 3714 A
5940 V
(13226)210 648 A
1068(*)S
1152(as)S
(well)168 1278 A
1488(as)S
(keyboards)378 1614 A
(that)168 2034 A
(interrupt)378 2244 A
2664(on)S
(key)126 2790 A
(depression)420 2958 A
(and)126 3420 A
(key)126 3588 A
(release.)336 3756 A
6030 V
(13227)210 648 A
1068(*)S
(For)126 1152 A
(efficiency,)462 1320 A
(the)126 1824 A
(interrupt)378 1992 A
(routine)294 2412 A
(filters)294 2748 A
(out)126 3084 A
(most)168 3252 A
(key)126 3462 A
(releases.)378 3630 A
6120 V
(13228)210 648 A
1068(*/)S
6210 V
(13229)210 648 A
(int)126 1110 A
(ch,)126 1278 A
(make;)210 1446 A
8418 V
EP
%%Page: 181 181
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1941(File:)S
(src/kernel/keyboard.c)960 2174 A
12 B
(181)180 4248 A
900 V
7 LST
(13230)210 648 A
(static)252 1110 A
(int)126 1404 A
(CAD_count)378 1572 A
1992(=)S
2076(0;)S
990 V
(13231)210 648 A
1080 V
(13232)210 648 A
1110(/*)S
(Check)210 1236 A
(for)126 1488 A
(CTRL-ALT-DEL,)546 1656 A
(and)126 2244 A
2412(if)S
(found,)252 2538 A
(halt)168 2832 A
(the)126 3042 A
(computer.)378 3210 A
(This)168 3630 A
(would)210 3840 A
1170 V
(13233)210 648 A
1152(*)S
1236(be)S
(better)252 1362 A
(done)168 1656 A
1866(in)S
(keyboard\(\))420 1992 A
2454(in)S
(case)168 2580 A
(TTY)126 2790 A
2958(is)S
(hung,)210 3084 A
(except)252 3336 A
(control)294 3630 A
(and)126 3966 A
1260 V
(13234)210 648 A
1152(*)S
(alt)126 1236 A
(are)126 1404 A
(set)126 1572 A
1740(in)S
(the)126 1866 A
(high)168 2034 A
(level)210 2244 A
(code.)210 2496 A
1350 V
(13235)210 648 A
1152(*/)S
1440 V
(13236)210 648 A
1110(if)S
(\(control)336 1236 A
1614(&&)S
(\(alt1)210 1740 A
1992(||)S
(alt2\))210 2118 A
2370(&&)S
(scode)210 2496 A
2748(==)S
(DEL_SCAN\))378 2874 A
1530 V
(13237)210 648 A
1110({)S
1620 V
(13238)210 648 A
1362(if)S
(\(++CAD_count)504 1488 A
2034(==)S
2160(3\))S
(wreboot\(RBT_HALT\);)756 2286 A
1710 V
(13239)210 648 A
(cause_sig\(INIT_PROC_NR,)966 1362 A
(SIGABRT\);)378 2370 A
1800 V
(13240)210 648 A
(return)252 1362 A
(-1;)126 1656 A
1890 V
(13241)210 648 A
1110(})S
1980 V
(13242)210 648 A
2070 V
(13243)210 648 A
1110(/*)S
(High-order)420 1236 A
(bit)126 1698 A
(set)126 1866 A
2034(on)S
(key)126 2160 A
(release.)336 2328 A
2706(*/)S
2160 V
(13244)210 648 A
(make)168 1110 A
1320(=)S
(\(scode)252 1404 A
1698(&)S
(0200)168 1782 A
1992(?)S
2076(0)S
2160(:)S
(1\);)126 2244 A
2706(/*)S
2832(0)S
2916(=)S
(release,)336 3000 A
3378(1)S
3462(=)S
(press)210 3546 A
3798(*/)S
2250 V
(13245)210 648 A
2340 V
(13246)210 648 A
1110(ch)S
1236(=)S
(map_key\(scode)546 1320 A
1908(&)S
(0177\);)252 1992 A
2706(/*)S
(map)126 2832 A
3000(to)S
(ASCII)210 3126 A
3378(*/)S
2430 V
(13247)210 648 A
2520 V
(13248)210 648 A
(switch)252 1110 A
(\(ch\))168 1404 A
1614({)S
2610 V
(13249)210 648 A
(case)168 1362 A
(CTRL:)210 1572 A
2700 V
(13250)210 648 A
(control)294 1698 A
2034(=)S
(make;)210 2118 A
2790 V
(13251)210 648 A
1698(ch)S
1824(=)S
(-1;)126 1908 A
2880 V
(13252)210 648 A
(break;)252 1698 A
2970 V
(13253)210 648 A
(case)168 1362 A
(SHIFT:)252 1572 A
3060 V
(13254)210 648 A
(shift)210 1698 A
1950(=)S
(make;)210 2034 A
3150 V
(13255)210 648 A
1698(ch)S
1824(=)S
(-1;)126 1908 A
3240 V
(13256)210 648 A
(break;)252 1698 A
3330 V
(13257)210 648 A
(case)168 1362 A
(ALT:)168 1572 A
3420 V
(13258)210 648 A
1698(if)S
(\(make\))252 1824 A
2118({)S
3510 V
(13259)210 648 A
2034(if)S
(\(esc\))210 2160 A
(alt2)168 2412 A
2622(=)S
2706(1;)S
(else)168 2832 A
(alt1)168 3042 A
3252(=)S
3336(1;)S
3600 V
(13260)210 648 A
1698(})S
(else)168 1782 A
1992({)S
3690 V
(13261)210 648 A
(alt1)168 2034 A
2244(=)S
(alt2)168 2328 A
2538(=)S
2622(0;)S
3780 V
(13262)210 648 A
1698(})S
3870 V
(13263)210 648 A
1698(ch)S
1824(=)S
(-1;)126 1908 A
3960 V
(13264)210 648 A
(break;)252 1698 A
4050 V
(13265)210 648 A
(case)168 1362 A
(CALOCK:)294 1572 A
4140 V
(13266)210 648 A
1698(if)S
(\(make)210 1824 A
2076(&&)S
(caps_off\))378 2202 A
2622({)S
4230 V
(13267)210 648 A
(capslock)336 2034 A
2412(=)S
2496(1)S
2580(-)S
(capslock;)378 2664 A
4320 V
(13268)210 648 A
(set_leds\(\);)462 2034 A
4410 V
(13269)210 648 A
1698(})S
4500 V
(13270)210 648 A
(caps_off)336 1698 A
2076(=)S
2160(1)S
2244(-)S
(make;)210 2328 A
4590 V
(13271)210 648 A
1698(ch)S
1824(=)S
(-1;)126 1908 A
4680 V
(13272)210 648 A
(break;)252 1698 A
4770 V
(13273)210 648 A
(case)168 1362 A
(NLOCK:)252 1572 A
4860 V
(13274)210 648 A
1698(if)S
(\(make)210 1824 A
2076(&&)S
(num_off\))336 2202 A
2580({)S
4950 V
(13275)210 648 A
(numlock)294 2034 A
2370(=)S
2454(1)S
2538(-)S
(numlock;)336 2622 A
5040 V
(13276)210 648 A
(set_leds\(\);)462 2034 A
5130 V
(13277)210 648 A
1698(})S
5220 V
(13278)210 648 A
(num_off)294 1698 A
2034(=)S
2118(1)S
2202(-)S
(make;)210 2286 A
5310 V
(13279)210 648 A
1698(ch)S
1824(=)S
(-1;)126 1908 A
5400 V
(13280)210 648 A
(break;)252 1698 A
5490 V
(13281)210 648 A
(case)168 1362 A
(SLOCK:)252 1572 A
5580 V
(13282)210 648 A
1698(if)S
(\(make)210 1824 A
2076(&)S
(slock_off\))420 2160 A
2622({)S
5670 V
(13283)210 648 A
(slock)210 2034 A
2286(=)S
2370(1)S
2454(-)S
(slock;)252 2538 A
5760 V
(13284)210 648 A
(set_leds\(\);)462 2034 A
5850 V
(13285)210 648 A
1698(})S
5940 V
(13286)210 648 A
(slock_off)378 1698 A
2118(=)S
2202(1)S
2286(-)S
(make;)210 2370 A
6030 V
(13287)210 648 A
1698(ch)S
1824(=)S
(-1;)126 1908 A
6120 V
(13288)210 648 A
(break;)252 1698 A
6210 V
(13289)210 648 A
(case)168 1362 A
(EXTKEY:)294 1572 A
8418 V
EP
%%Page: 182 182
BP
/slant 0 def
/height 0 def
630 V
12 B
(182)180 648 A
11 R
1941(File:)S
(src/kernel/keyboard.c)960 2174 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(13290)210 648 A
(esc)126 1698 A
1866(=)S
1950(1;)S
990 V
(13291)210 648 A
(return\(-1\);)462 1698 A
1080 V
(13292)210 648 A
(default:)336 1362 A
1170 V
(13293)210 648 A
1698(if)S
(\(!make\))294 1824 A
2160(ch)S
2286(=)S
(-1;)126 2370 A
1260 V
(13294)210 648 A
1110(})S
1350 V
(13295)210 648 A
(esc)126 1110 A
1278(=)S
1362(0;)S
1440 V
(13296)210 648 A
(return\(ch\);)462 1110 A
1530 V
(13297)210 648 A
1026(})S
1800 V
(13300)210 648 A
(/*===========================================================================*)3276 1026 A
1890 V
(13301)210 648 A
1068(*)S
(set_leds)336 2370 A
4260(*)S
1980 V
(13302)210 648 A
(*===========================================================================*/)3276 1068 A
2070 V
(13303)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(set_leds\(\))420 1572 A
2160 V
(13304)210 648 A
1026({)S
2250 V
(13305)210 648 A
1026(/*)S
(Set)126 1152 A
(the)126 1320 A
(LEDs)168 1488 A
1698(on)S
(the)126 1824 A
(caps)168 1992 A
(lock)168 2202 A
(and)126 2412 A
(num)126 2580 A
(lock)168 2748 A
(keys)168 2958 A
3168(*/)S
2340 V
(13306)210 648 A
2430 V
(13307)210 648 A
(unsigned)336 1110 A
(leds;)210 1488 A
2520 V
(13308)210 648 A
2610 V
(13309)210 648 A
1110(if)S
(\(!pc_at\))336 1236 A
(return;)294 1614 A
2034(/*)S
(PC/XT)210 2160 A
(doesn't)294 2412 A
(have)168 2748 A
(LEDs)168 2958 A
3168(*/)S
2700 V
(13310)210 648 A
2790 V
(13311)210 648 A
1110(/*)S
(encode)252 1236 A
(LED)126 1530 A
(bits)168 1698 A
1908(*/)S
2880 V
(13312)210 648 A
(leds)168 1110 A
1320(=)S
(\(slock)252 1404 A
1698(<<)S
1824(0\))S
1950(|)S
(\(numlock)336 2034 A
2412(<<)S
2538(1\))S
2664(|)S
(\(capslock)378 2748 A
3168(<<)S
(2\);)126 3294 A
2970 V
(13313)210 648 A
3060 V
(13314)210 648 A
(kb_wait\(\);)420 1110 A
2370(/*)S
(wait)168 2496 A
(for)126 2706 A
(buffer)252 2874 A
(empty)210 3168 A
3462(*/)S
3150 V
(13315)210 648 A
(out_byte\(KEYBD,)630 1110 A
(LED_CODE\);)420 1782 A
2370(/*)S
(prepare)294 2496 A
(keyboard)336 2832 A
3210(to)S
(accept)252 3336 A
(LED)126 3630 A
(values)252 3798 A
4092(*/)S
3240 V
(13316)210 648 A
(kb_ack\(\);)378 1110 A
2370(/*)S
(wait)168 2496 A
(for)126 2706 A
(ack)126 2874 A
(response)336 3042 A
3462(*/)S
3330 V
(13317)210 648 A
3420 V
(13318)210 648 A
(kb_wait\(\);)420 1110 A
2370(/*)S
(wait)168 2496 A
(for)126 2706 A
(buffer)252 2874 A
(empty)210 3168 A
3462(*/)S
3510 V
(13319)210 648 A
(out_byte\(KEYBD,)630 1110 A
(leds\);)252 1782 A
2370(/*)S
(give)168 2496 A
(keyboard)336 2706 A
(LED)126 3084 A
(values)252 3252 A
3546(*/)S
3600 V
(13320)210 648 A
(kb_ack\(\);)378 1110 A
2370(/*)S
(wait)168 2496 A
(for)126 2706 A
(ack)126 2874 A
(response)336 3042 A
3462(*/)S
3690 V
(13321)210 648 A
1026(})S
3960 V
(13324)210 648 A
(/*==========================================================================*)3234 1026 A
4050 V
(13325)210 648 A
1068(*)S
(kb_wait)294 2370 A
4218(*)S
4140 V
(13326)210 648 A
(*==========================================================================*/)3234 1068 A
4230 V
(13327)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(kb_wait\(\))378 1530 A
4320 V
(13328)210 648 A
1026({)S
4410 V
(13329)210 648 A
1026(/*)S
(Wait)168 1152 A
(until)210 1362 A
(the)126 1614 A
(controller)420 1782 A
2244(is)S
(ready;)252 2370 A
(return)252 2664 A
(zero)168 2958 A
3168(if)S
(this)168 3294 A
(times)210 3504 A
(out.)168 3756 A
3966(*/)S
4500 V
(13330)210 648 A
4590 V
(13331)210 648 A
(int)126 1110 A
(retries;)336 1278 A
4680 V
(13332)210 648 A
4770 V
(13333)210 648 A
(retries)294 1110 A
1446(=)S
(MAX_KB_BUSY_RETRIES)798 1530 A
2370(+)S
2454(1;)S
4860 V
(13334)210 648 A
(while)210 1110 A
(\(--retries)420 1362 A
1824(!=)S
1950(0)S
2034(&&)S
(in_byte\(KB_STATUS\))756 2160 A
2958(&)S
(KB_BUSY\))336 3042 A
4950 V
(13335)210 648 A
1362(;)S
2370(/*)S
(wait)168 2496 A
(until)210 2706 A
(not)126 2958 A
(busy)168 3126 A
3336(*/)S
5040 V
(13336)210 648 A
(return\(retries\);)672 1110 A
2370(/*)S
(nonzero)294 2496 A
2832(if)S
(ready)210 2958 A
3210(*/)S
5130 V
(13337)210 648 A
1026(})S
5400 V
(13340)210 648 A
(/*==========================================================================*)3234 1026 A
5490 V
(13341)210 648 A
1068(*)S
(kb_ack)252 2370 A
4218(*)S
5580 V
(13342)210 648 A
(*==========================================================================*/)3234 1068 A
5670 V
(13343)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(kb_ack\(\))336 1530 A
5760 V
(13344)210 648 A
1026({)S
5850 V
(13345)210 648 A
1026(/*)S
(Wait)168 1152 A
(until)210 1362 A
(kbd)126 1614 A
(acknowledges)504 1782 A
(last)168 2328 A
(command;)336 2538 A
(return)252 2916 A
(zero)168 3210 A
3420(if)S
(this)168 3546 A
(times)210 3756 A
(out.)168 4008 A
4218(*/)S
5940 V
(13346)210 648 A
6030 V
(13347)210 648 A
(int)126 1110 A
(retries;)336 1278 A
6120 V
(13348)210 648 A
6210 V
(13349)210 648 A
(retries)294 1110 A
1446(=)S
(MAX_KB_ACK_RETRIES)756 1530 A
2328(+)S
2412(1;)S
8418 V
EP
%%Page: 183 183
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1941(File:)S
(src/kernel/keyboard.c)960 2174 A
12 B
(183)180 4248 A
900 V
7 LST
(13350)210 648 A
(while)210 1110 A
(\(--retries)420 1362 A
1824(!=)S
1950(0)S
2034(&&)S
(in_byte\(KEYBD\))588 2160 A
2790(!=)S
(KB_ACK\))294 2916 A
990 V
(13351)210 648 A
1362(;)S
2370(/*)S
(wait)168 2496 A
(for)126 2706 A
(ack)126 2874 A
3042(*/)S
1080 V
(13352)210 648 A
(return\(retries\);)672 1110 A
2370(/*)S
(nonzero)294 2496 A
2832(if)S
(ack)126 2958 A
(received)336 3126 A
3504(*/)S
1170 V
(13353)210 648 A
1026(})S
1440 V
(13356)210 648 A
(/*===========================================================================*)3276 1026 A
1530 V
(13357)210 648 A
1068(*)S
(kb_init)294 2370 A
4260(*)S
1620 V
(13358)210 648 A
(*===========================================================================*/)3276 1068 A
1710 V
(13359)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(kb_init\(tp\))462 1530 A
1800 V
(13360)210 648 A
(tty_t)210 1026 A
(*tp;)168 1278 A
1890 V
(13361)210 648 A
1026({)S
1980 V
(13362)210 648 A
1026(/*)S
(Initialize)420 1152 A
(the)126 1614 A
(keyboard)336 1782 A
(driver.)294 2160 A
2496(*/)S
2070 V
(13363)210 648 A
2160 V
(13364)210 648 A
(register)336 1110 A
(struct)252 1488 A
(kb_s)168 1782 A
(*kb;)168 1992 A
2250 V
(13365)210 648 A
2340 V
(13366)210 648 A
1110(/*)S
(Input)210 1236 A
(function.)378 1488 A
1908(*/)S
2430 V
(13367)210 648 A
(tp->tty_devread)630 1110 A
1782(=)S
(kb_read;)336 1866 A
2520 V
(13368)210 648 A
2610 V
(13369)210 648 A
1110(kb)S
1236(=)S
(kb_addr\(\);)420 1320 A
2700 V
(13370)210 648 A
2790 V
(13371)210 648 A
1110(/*)S
(Set)126 1236 A
1404(up)S
(input)210 1530 A
(queue.)252 1782 A
2076(*/)S
2880 V
(13372)210 648 A
(kb->ihead)378 1110 A
1530(=)S
(kb->itail)378 1614 A
2034(=)S
(kb->ibuf;)378 2118 A
2970 V
(13373)210 648 A
3060 V
(13374)210 648 A
1110(/*)S
(Set)126 1236 A
(initial)294 1404 A
(values.)294 1740 A
2076(*/)S
3150 V
(13375)210 648 A
(caps_off)336 1110 A
1488(=)S
1572(1;)S
3240 V
(13376)210 648 A
(num_off)294 1110 A
1446(=)S
1530(1;)S
3330 V
(13377)210 648 A
(slock_off)378 1110 A
1530(=)S
1614(1;)S
3420 V
(13378)210 648 A
(esc)126 1110 A
1278(=)S
1362(0;)S
3510 V
(13379)210 648 A
3600 V
(13380)210 648 A
(set_leds\(\);)462 1110 A
2370(/*)S
(turn)168 2496 A
(off)126 2706 A
(numlock)294 2874 A
(led)126 3210 A
3378(*/)S
3690 V
(13381)210 648 A
3780 V
(13382)210 648 A
(scan_keyboard\(\);)672 1110 A
2370(/*)S
(stop)168 2496 A
(lockup)252 2706 A
(from)168 3000 A
(leftover)336 3210 A
(keystroke)378 3588 A
4008(*/)S
3870 V
(13383)210 648 A
3960 V
(13384)210 648 A
(put_irq_handler\(KEYBOARD_IRQ,)1218 1110 A
(kbd_hw_int\);)504 2370 A
3042(/*)S
(set)126 3168 A
(the)126 3336 A
(interrupt)378 3504 A
(handler)294 3924 A
4260(*/)S
4050 V
(13385)210 648 A
(enable_irq\(KEYBOARD_IRQ\);)1050 1110 A
2370(/*)S
(safe)168 2496 A
(now)126 2706 A
(everything)420 2874 A
(initialised!)504 3336 A
3882(*/)S
4140 V
(13386)210 648 A
1026(})S
4410 V
(13389)210 648 A
(/*===========================================================================*)3276 1026 A
4500 V
(13390)210 648 A
1068(*)S
(kbd_loadmap)462 2370 A
4260(*)S
4590 V
(13391)210 648 A
(*===========================================================================*/)3276 1068 A
4680 V
(13392)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(kbd_loadmap\(user_phys\))924 1488 A
4770 V
(13393)210 648 A
(phys_bytes)420 1026 A
(user_phys;)420 1488 A
4860 V
(13394)210 648 A
1026({)S
4950 V
(13395)210 648 A
1026(/*)S
(Load)168 1152 A
1362(a)S
(new)126 1446 A
(keymap.)294 1614 A
1950(*/)S
5040 V
(13396)210 648 A
5130 V
(13397)210 648 A
(phys_copy\(user_phys,)840 1110 A
(vir2phys\(keymap\),)714 1992 A
(\(phys_bytes\))504 2748 A
(sizeof\(keymap\)\);)672 3294 A
5220 V
(13398)210 648 A
(return\(OK\);)462 1110 A
5310 V
(13399)210 648 A
1026(})S
5580 V
(13402)210 648 A
(/*===========================================================================*)3276 1026 A
5670 V
(13403)210 648 A
1068(*)S
(func_key)336 2370 A
4260(*)S
5760 V
(13404)210 648 A
(*===========================================================================*/)3276 1068 A
5850 V
(13405)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(func_key\(scode\))630 1530 A
5940 V
(13406)210 648 A
(int)126 1026 A
(scode;)252 1194 A
2370(/*)S
(scan)168 2496 A
(code)168 2706 A
(for)126 2916 A
3084(a)S
(function)336 3168 A
(key)126 3546 A
3714(*/)S
6030 V
(13407)210 648 A
1026({)S
6120 V
(13408)210 648 A
1026(/*)S
(This)168 1152 A
(procedure)378 1362 A
(traps)210 1782 A
(function)336 2034 A
(keys)168 2412 A
(for)126 2622 A
(debugging)378 2790 A
(and)126 3210 A
(control)294 3378 A
(purposes.)378 3714 A
4134(*/)S
6210 V
(13409)210 648 A
8418 V
EP
%%Page: 184 184
BP
/slant 0 def
/height 0 def
630 V
12 B
(184)180 648 A
11 R
1941(File:)S
(src/kernel/keyboard.c)960 2174 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(13410)210 648 A
(unsigned)336 1110 A
(code;)210 1488 A
990 V
(13411)210 648 A
1080 V
(13412)210 648 A
(code)168 1110 A
1320(=)S
(map_key0\(scode\);)672 1404 A
3042(/*)S
(first)210 3168 A
(ignore)252 3420 A
(modifiers)378 3714 A
4134(*/)S
1170 V
(13413)210 648 A
1110(if)S
(\(code)210 1236 A
1488(<)S
1572(F1)S
1698(||)S
(code)168 1824 A
2034(>)S
(F12\))168 2118 A
(return\(FALSE\);)588 2328 A
3042(/*)S
(not)126 3168 A
(our)126 3336 A
(job)126 3504 A
3672(*/)S
1260 V
(13414)210 648 A
1350 V
(13415)210 648 A
(switch)252 1110 A
(\(map_key\(scode\)\))672 1404 A
2118({)S
3042(/*)S
(include)294 3168 A
(modifiers)378 3504 A
3924(*/)S
1440 V
(13416)210 648 A
1530 V
(13417)210 648 A
(case)168 1110 A
(F1:)126 1320 A
(p_dmp\(\);)336 1698 A
(break;)252 2076 A
2706(/*)S
(print)210 2832 A
(process)294 3084 A
(table)210 3420 A
3672(*/)S
1620 V
(13418)210 648 A
(case)168 1110 A
(F2:)126 1320 A
(map_dmp\(\);)420 1698 A
(break;)252 2160 A
2706(/*)S
(print)210 2832 A
(memory)252 3084 A
(map)126 3378 A
3546(*/)S
1710 V
(13419)210 648 A
(case)168 1110 A
(F3:)126 1320 A
(toggle_scroll\(\);)672 1698 A
(break;)252 2412 A
2706(/*)S
(hardware)336 2832 A
(vs.)126 3210 A
(software)336 3378 A
(scrolling)378 3756 A
4176(*/)S
1800 V
(13420)210 648 A
(case)168 1110 A
(CF7:)168 1320 A
(sigchar\(&tty_table[CONSOLE],)1176 1698 A
(SIGQUIT\);)378 2916 A
(break;)252 3336 A
1890 V
(13421)210 648 A
(case)168 1110 A
(CF8:)168 1320 A
(sigchar\(&tty_table[CONSOLE],)1176 1698 A
(SIGINT\);)336 2916 A
(break;)252 3294 A
1980 V
(13422)210 648 A
(case)168 1110 A
(CF9:)168 1320 A
(sigchar\(&tty_table[CONSOLE],)1176 1698 A
(SIGKILL\);)378 2916 A
(break;)252 3336 A
2070 V
(13423)210 648 A
(default:)336 1110 A
(return\(FALSE\);)588 1698 A
2160 V
(13424)210 648 A
1110(})S
2250 V
(13425)210 648 A
(return\(TRUE\);)546 1110 A
2340 V
(13426)210 648 A
1026(})S
2610 V
(13429)210 648 A
(/*==========================================================================*)3234 1026 A
2700 V
(13430)210 648 A
1068(*)S
(scan_keyboard)546 2370 A
4218(*)S
2790 V
(13431)210 648 A
(*==========================================================================*/)3234 1068 A
2880 V
(13432)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(scan_keyboard\(\))630 1530 A
2970 V
(13433)210 648 A
1026({)S
3060 V
(13434)210 648 A
1026(/*)S
(Fetch)210 1152 A
(the)126 1404 A
(character)378 1572 A
(from)168 1992 A
(the)126 2202 A
(keyboard)336 2370 A
(hardware)336 2748 A
(and)126 3126 A
(acknowledge)462 3294 A
(it.)126 3798 A
3966(*/)S
3150 V
(13435)210 648 A
3240 V
(13436)210 648 A
(int)126 1110 A
(code;)210 1278 A
3330 V
(13437)210 648 A
(int)126 1110 A
(val;)168 1278 A
3420 V
(13438)210 648 A
3510 V
(13439)210 648 A
(code)168 1110 A
1320(=)S
(in_byte\(KEYBD\);)630 1404 A
2370(/*)S
(get)126 2496 A
(the)126 2664 A
(scan)168 2832 A
(code)168 3042 A
(for)126 3252 A
(the)126 3420 A
(key)126 3588 A
(struck)252 3756 A
4050(*/)S
3600 V
(13440)210 648 A
(val)126 1110 A
1278(=)S
(in_byte\(PORT_B\);)672 1362 A
2370(/*)S
(strobe)252 2496 A
(the)126 2790 A
(keyboard)336 2958 A
3336(to)S
(ack)126 3462 A
(the)126 3630 A
(char)168 3798 A
4008(*/)S
3690 V
(13441)210 648 A
(out_byte\(PORT_B,)672 1110 A
(val)126 1824 A
1992(|)S
(KBIT\);)252 2076 A
2370(/*)S
(strobe)252 2496 A
(the)126 2790 A
(bit)126 2958 A
(high)168 3126 A
3336(*/)S
3780 V
(13442)210 648 A
(out_byte\(PORT_B,)672 1110 A
(val\);)210 1824 A
2370(/*)S
(now)126 2496 A
(strobe)252 2664 A
2958(it)S
(low)126 3084 A
3252(*/)S
3870 V
(13443)210 648 A
(return)252 1110 A
(code;)210 1404 A
3960 V
(13444)210 648 A
1026(})S
4230 V
(13447)210 648 A
(/*==========================================================================*)3234 1026 A
4320 V
(13448)210 648 A
1068(*)S
(wreboot)294 2370 A
4218(*)S
4410 V
(13449)210 648 A
(*==========================================================================*/)3234 1068 A
4500 V
(13450)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(wreboot\(how\))504 1530 A
4590 V
(13451)210 648 A
(int)126 1026 A
(how;)168 1194 A
2034(/*)S
2160(0)S
2244(=)S
(halt,)210 2328 A
2580(1)S
2664(=)S
(reboot,)294 2748 A
3084(2)S
3168(=)S
(panic!,)294 3252 A
(...)126 3588 A
3756(*/)S
4680 V
(13452)210 648 A
1026({)S
4770 V
(13453)210 648 A
1026(/*)S
(Wait)168 1152 A
(for)126 1362 A
(keystrokes)420 1530 A
(for)126 1992 A
(printing)336 2160 A
(debugging)378 2538 A
(info)168 2958 A
(and)126 3168 A
(reboot.)294 3336 A
3672(*/)S
4860 V
(13454)210 648 A
4950 V
(13455)210 648 A
(int)126 1110 A
(quiet,)252 1278 A
(code;)210 1572 A
5040 V
(13456)210 648 A
(static)252 1110 A
(u16_t)210 1404 A
(magic)210 1656 A
1908(=)S
(MEMCHECK_MAG;)546 1992 A
5130 V
(13457)210 648 A
(struct)252 1110 A
(tasktab)294 1404 A
(*ttp;)210 1740 A
5220 V
(13458)210 648 A
5310 V
(13459)210 648 A
1110(/*)S
(Mask)168 1236 A
(all)126 1446 A
(interrupts.)462 1614 A
2118(*/)S
5400 V
(13460)210 648 A
(out_byte\(INT_CTLMASK,)882 1110 A
(\3040\);)168 2034 A
5490 V
(13461)210 648 A
5580 V
(13462)210 648 A
1110(/*)S
(Tell)168 1236 A
(several)294 1446 A
(tasks)210 1782 A
2034(to)S
(stop.)210 2160 A
2412(*/)S
5670 V
(13463)210 648 A
(cons_stop\(\);)504 1110 A
5760 V
(13464)210 648 A
(floppy_stop\(\);)588 1110 A
5850 V
(13465)210 648 A
(clock_stop\(\);)546 1110 A
5940 V
(13466)210 648 A
6030 V
(13467)210 648 A
1110(if)S
(\(how)168 1236 A
1446(==)S
(RBT_HALT\))378 1572 A
1992({)S
6120 V
(13468)210 648 A
(printf\("System)588 1362 A
(Halted\\n"\);)462 1992 A
6210 V
(13469)210 648 A
1362(if)S
(\(!mon_return\))546 1488 A
(how)126 2076 A
2244(=)S
(RBT_PANIC;)420 2328 A
8418 V
EP
%%Page: 185 185
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1941(File:)S
(src/kernel/keyboard.c)960 2174 A
12 B
(185)180 4248 A
900 V
7 LST
(13470)210 648 A
1110(})S
990 V
(13471)210 648 A
1080 V
(13472)210 648 A
1110(if)S
(\(how)168 1236 A
1446(==)S
(RBT_PANIC\))420 1572 A
2034({)S
1170 V
(13473)210 648 A
1362(/*)S
1488(A)S
(panic!)252 1572 A
1866(*/)S
1260 V
(13474)210 648 A
(printf\("Hit)462 1362 A
(ESC)126 1866 A
2034(to)S
(reboot,)294 2160 A
(F-keys)252 2496 A
(for)126 2790 A
(debug)210 2958 A
(dumps\\n"\);)420 3210 A
1350 V
(13475)210 648 A
1440 V
(13476)210 648 A
(\(void\))252 1362 A
(scan_keyboard\(\);)672 1656 A
2370(/*)S
(ack)126 2496 A
(any)126 2664 A
(old)126 2832 A
(input)210 3000 A
3252(*/)S
1530 V
(13477)210 648 A
(quiet)210 1362 A
1614(=)S
(scan_keyboard\(\);/*)756 1698 A
(quiescent)378 2496 A
(value)210 2916 A
3168(\(0)S
3294(on)S
(PC,)126 3420 A
(last)168 3588 A
(code)168 3798 A
4008(on)S
(AT\)*/)210 4134 A
1620 V
(13478)210 648 A
(for)126 1362 A
(\(;;\))168 1530 A
1740({)S
1710 V
(13479)210 648 A
(milli_delay\(100\);)714 1698 A
2706(/*)S
(pause)210 2832 A
(for)126 3084 A
3252(a)S
(decisecond)420 3336 A
3798(*/)S
1800 V
(13480)210 648 A
(code)168 1698 A
1908(=)S
(scan_keyboard\(\);)672 1992 A
1890 V
(13481)210 648 A
1698(if)S
(\(code)210 1824 A
2076(!=)S
(quiet\))252 2202 A
2496({)S
1980 V
(13482)210 648 A
2034(/*)S
2160(A)S
(key)126 2244 A
(has)126 2412 A
(been)168 2580 A
(pressed.)336 2790 A
3168(*/)S
2070 V
(13483)210 648 A
2034(if)S
(\(code)210 2160 A
2412(==)S
(ESC_SCAN\))378 2538 A
(break;)252 2958 A
3252(/*)S
(reboot)252 3378 A
3672(if)S
(ESC)126 3798 A
(typed)210 3966 A
4218(*/)S
2160 V
(13484)210 648 A
(\(void\))252 2034 A
(func_key\(code\);)630 2328 A
3252(/*)S
(process)294 3378 A
(function)336 3714 A
(key)126 4092 A
4260(*/)S
2250 V
(13485)210 648 A
(quiet)210 2034 A
2286(=)S
(scan_keyboard\(\);)672 2370 A
2340 V
(13486)210 648 A
1698(})S
2430 V
(13487)210 648 A
1362(})S
2520 V
(13488)210 648 A
(how)126 1362 A
1530(=)S
(RBT_REBOOT;)462 1614 A
2610 V
(13489)210 648 A
1110(})S
2700 V
(13490)210 648 A
2790 V
(13491)210 648 A
1110(if)S
(\(how)168 1236 A
1446(==)S
(RBT_REBOOT\))462 1572 A
(printf\("Rebooting\\n"\);)924 2076 A
2880 V
(13492)210 648 A
2970 V
(13493)210 648 A
1110(if)S
(\(mon_return)462 1236 A
1740(&&)S
(how)126 1866 A
2034(!=)S
(RBT_RESET\))420 2160 A
2622({)S
3060 V
(13494)210 648 A
1362(/*)S
(Reinitialize)504 1488 A
(the)126 2034 A
(interrupt)378 2202 A
(controllers)462 2622 A
3126(to)S
(the)126 3252 A
(BIOS)168 3420 A
(defaults.)378 3630 A
4050(*/)S
3150 V
(13495)210 648 A
(intr_init\(0\);)546 1362 A
3240 V
(13496)210 648 A
(out_byte\(INT_CTLMASK,)882 1362 A
(0\);)126 2286 A
3330 V
(13497)210 648 A
(out_byte\(INT2_CTLMASK,)924 1362 A
(0\);)126 2328 A
3420 V
(13498)210 648 A
3510 V
(13499)210 648 A
1362(/*)S
(Return)252 1488 A
1782(to)S
(the)126 1908 A
(boot)168 2076 A
(monitor.)336 2286 A
2664(*/)S
3600 V
(13500)210 648 A
1362(if)S
(\(how)168 1488 A
1698(==)S
(RBT_HALT\))378 1824 A
2244({)S
3690 V
(13501)210 648 A
(reboot_code)462 1698 A
2202(=)S
(vir2phys\(""\);)546 2286 A
3780 V
(13502)210 648 A
1362(})S
(else)168 1446 A
3870 V
(13503)210 648 A
1362(if)S
(\(how)168 1488 A
1698(==)S
(RBT_REBOOT\))462 1824 A
2328({)S
3960 V
(13504)210 648 A
(reboot_code)462 1698 A
2202(=)S
(vir2phys\("delay;boot"\);)966 2286 A
4050 V
(13505)210 648 A
1362(})S
4140 V
(13506)210 648 A
(level0\(monitor\);)672 1362 A
4230 V
(13507)210 648 A
1110(})S
4320 V
(13508)210 648 A
4410 V
(13509)210 648 A
1110(/*)S
(Stop)168 1236 A
(BIOS)168 1446 A
(memory)252 1656 A
(test.)210 1950 A
2202(*/)S
4500 V
(13510)210 648 A
(phys_copy\(vir2phys\(&magic\),)1134 1110 A
(\(phys_bytes\))504 2286 A
(MEMCHECK_ADR,)546 2832 A
4590 V
(13511)210 648 A
(\(phys_bytes\))504 3042 A
(sizeof\(magic\)\);)630 3588 A
4680 V
(13512)210 648 A
4770 V
(13513)210 648 A
1110(if)S
(\(protected_mode\))672 1236 A
1950({)S
4860 V
(13514)210 648 A
1362(/*)S
(Use)126 1488 A
(the)126 1656 A
1824(AT)S
(keyboard)336 1950 A
(controller)420 2328 A
2790(to)S
(reset)210 2916 A
(the)126 3168 A
(processor.)420 3336 A
4950 V
(13515)210 648 A
1404(*)S
(The)126 1488 A
(A20)126 1656 A
(line)168 1824 A
2034(is)S
(kept)168 2160 A
(enabled)294 2370 A
2706(in)S
(case)168 2832 A
(this)168 3042 A
(code)168 3252 A
3462(is)S
(ever)168 3588 A
5040 V
(13516)210 648 A
1404(*)S
(run)126 1488 A
(from)168 1656 A
(extended)336 1866 A
(memory,)294 2244 A
(and)126 2580 A
(because)294 2748 A
(some)168 3084 A
(machines)336 3294 A
5130 V
(13517)210 648 A
1404(*)S
(appear)252 1488 A
1782(to)S
(drive)210 1908 A
(the)126 2160 A
(fake)168 2328 A
(A20)126 2538 A
(high)168 2706 A
(instead)294 2916 A
3252(of)S
(low)126 3378 A
(just)168 3546 A
5220 V
(13518)210 648 A
1404(*)S
(after)210 1488 A
(reset,)252 1740 A
(leading)294 2034 A
2370(to)S
2496(an)S
(illegal)294 2622 A
(opode)210 2958 A
(trap.)210 3210 A
(This)168 3504 A
(bug)126 3714 A
5310 V
(13519)210 648 A
1404(*)S
1488(is)S
(more)168 1614 A
1824(of)S
1950(a)S
(problem)294 2034 A
2370(if)S
(the)126 2496 A
(fake)168 2664 A
(A20)126 2874 A
3042(is)S
3168(in)S
(use,)168 3294 A
3504(as)S
3630(it)S
5400 V
(13520)210 648 A
1404(*)S
(would)210 1488 A
1740(be)S
1866(if)S
(the)126 1992 A
(keyboard)336 2160 A
(reset)210 2538 A
(were)168 2790 A
(used)168 3000 A
(for)126 3210 A
(real)168 3378 A
(mode.)210 3588 A
5490 V
(13521)210 648 A
1404(*/)S
5580 V
(13522)210 648 A
(kb_wait\(\);)420 1362 A
5670 V
(13523)210 648 A
(out_byte\(KB_COMMAND,)840 1362 A
5760 V
(13524)210 648 A
(KB_PULSE_OUTPUT)630 1740 A
2412(|)S
(\(0x0F)210 2496 A
2748(&)S
(\304\(KB_GATE_A20)546 2832 A
3420(|)S
(KB_RESET\)\)\);)504 3504 A
5850 V
(13525)210 648 A
(milli_delay\(10\);)672 1362 A
5940 V
(13526)210 648 A
6030 V
(13527)210 648 A
1362(/*)S
1488(If)S
(the)126 1614 A
(nice)168 1782 A
(method)252 1992 A
(fails)210 2286 A
(then)168 2538 A
2748(do)S
2874(a)S
(reset.)252 2958 A
3294(In)S
(protected)378 3420 A
6120 V
(13528)210 648 A
1404(*)S
(mode)168 1488 A
(this)168 1698 A
(means)210 1908 A
2160(a)S
(processor)378 2244 A
(shutdown.)378 2664 A
6210 V
(13529)210 648 A
1404(*/)S
8418 V
EP
%%Page: 186 186
BP
/slant 0 def
/height 0 def
630 V
12 B
(186)180 648 A
11 R
1941(File:)S
(src/kernel/keyboard.c)960 2174 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(13530)210 648 A
(printf\("Hard)504 1362 A
(reset...\\n"\);)546 1908 A
990 V
(13531)210 648 A
(milli_delay\(250\);)714 1362 A
1080 V
(13532)210 648 A
1110(})S
1170 V
(13533)210 648 A
1110(/*)S
1236(In)S
(real)168 1362 A
(mode,)210 1572 A
(jumping)294 1824 A
2160(to)S
(the)126 2286 A
(reset)210 2454 A
(address)294 2706 A
3042(is)S
(good)168 3168 A
(enough.)294 3378 A
3714(*/)S
1260 V
(13534)210 648 A
(level0\(reset\);)588 1110 A
1350 V
(13535)210 648 A
1026(})S
1890 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1980 V
(src/kernel/console.c)840 2034 A
2070 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2250 V
(13600)210 648 A
1026(/*)S
(Code)168 1152 A
(and)126 1362 A
(data)168 1530 A
(for)126 1740 A
(the)126 1908 A
(IBM)126 2076 A
(console)294 2244 A
(driver.)294 2580 A
2340 V
(13601)210 648 A
1068(*)S
2430 V
(13602)210 648 A
1068(*)S
(The)126 1152 A
(6845)168 1320 A
(video)210 1530 A
(controller)420 1782 A
(used)168 2244 A
2454(by)S
(the)126 2580 A
(IBM)126 2748 A
2916(PC)S
(shares)252 3042 A
(its)126 3336 A
(video)210 3504 A
(memory)252 3756 A
(with)168 4050 A
2520 V
(13603)210 648 A
1068(*)S
(the)126 1152 A
(CPU)126 1320 A
(somewhere)378 1488 A
1908(in)S
(the)126 2034 A
(0xB0000)294 2202 A
(memory)252 2538 A
(bank.)210 2832 A
3126(To)S
(the)126 3252 A
(6845)168 3420 A
(this)168 3630 A
(memory)252 3840 A
2610 V
(13604)210 648 A
1068(*)S
(consists)336 1152 A
1530(of)S
(16-bit)252 1656 A
(words.)252 1950 A
(Each)168 2286 A
(word)168 2496 A
(has)126 2706 A
2874(a)S
(character)378 2958 A
(code)168 3378 A
3588(in)S
(the)126 3714 A
(low)126 3882 A
(byte)168 4050 A
2700 V
(13605)210 648 A
1068(*)S
(and)126 1152 A
1320(a)S
(so-called)378 1404 A
(attribute)378 1824 A
(byte)168 2244 A
2454(in)S
(the)126 2580 A
(high)168 2748 A
(byte.)210 2958 A
(The)126 3252 A
(CPU)126 3420 A
(directly)336 3588 A
(modifies)336 3966 A
2790 V
(13606)210 648 A
1068(*)S
(video)210 1152 A
(memory)252 1404 A
1698(to)S
(display)294 1824 A
(characters,)462 2160 A
(and)126 2664 A
(sets)168 2832 A
(two)126 3042 A
(registers)378 3210 A
3630(on)S
(the)126 3756 A
(6845)168 3924 A
(that)168 4134 A
2880 V
(13607)210 648 A
1068(*)S
(specify)294 1152 A
(the)126 1488 A
(video)210 1656 A
(origin)252 1908 A
(and)126 2202 A
(the)126 2370 A
(cursor)252 2538 A
(position.)378 2832 A
(The)126 3294 A
(video)210 3462 A
(origin)252 3714 A
4008(is)S
(the)126 4134 A
2970 V
(13608)210 648 A
1068(*)S
(place)210 1152 A
1404(in)S
(video)210 1530 A
(memory)252 1782 A
(where)210 2076 A
(the)126 2328 A
(first)210 2496 A
(character)378 2748 A
(\(upper)252 3168 A
(left)168 3462 A
(corner\))294 3672 A
(can)126 4008 A
3060 V
(13609)210 648 A
1068(*)S
1152(be)S
(found.)252 1278 A
(Moving)252 1614 A
(the)126 1908 A
(origin)252 2076 A
2370(is)S
2496(a)S
(fast)168 2580 A
(way)126 2790 A
2958(to)S
(scroll)252 3084 A
(the)126 3378 A
(screen.)294 3546 A
(Some)168 3924 A
3150 V
(13610)210 648 A
1068(*)S
(video)210 1152 A
(adapters)336 1404 A
(wrap)168 1782 A
(around)252 1992 A
(the)126 2286 A
(top)126 2454 A
2622(of)S
(video)210 2748 A
(memory,)294 3000 A
3336(so)S
(the)126 3462 A
(origin)252 3630 A
(can)126 3924 A
3240 V
(13611)210 648 A
1068(*)S
(move)168 1152 A
(without)294 1362 A
(bounds.)294 1698 A
(For)126 2076 A
(other)210 2244 A
(adapters)336 2496 A
(screen)252 2874 A
(memory)252 3168 A
(must)168 3462 A
(sometimes)378 3672 A
4092(be)S
3330 V
(13612)210 648 A
1068(*)S
(moved)210 1152 A
1404(to)S
(reset)210 1530 A
(the)126 1782 A
(origin.)294 1950 A
(All)126 2328 A
(computations)504 2496 A
3042(on)S
(video)210 3168 A
(memory)252 3420 A
(use)126 3714 A
(character)378 3882 A
3420 V
(13613)210 648 A
1068(*)S
(\(word\))252 1152 A
(addresses)378 1446 A
(for)126 1866 A
(simplicity)420 2034 A
(and)126 2496 A
(assume)252 2664 A
(there)210 2958 A
3210(is)S
3336(no)S
(wrapping.)378 3462 A
(The)126 3924 A
3510 V
(13614)210 648 A
1068(*)S
(assembly)336 1152 A
(support)294 1530 A
(functions)378 1866 A
(translate)378 2286 A
(the)126 2706 A
(word)168 2874 A
(addresses)378 3084 A
3504(to)S
(byte)168 3630 A
(addresses)378 3840 A
3600 V
(13615)210 648 A
1068(*)S
(and)126 1152 A
(the)126 1320 A
(scrolling)378 1488 A
(function)336 1908 A
(worries)294 2286 A
(about)210 2622 A
(wrapping.)378 2874 A
3690 V
(13616)210 648 A
1068(*/)S
3780 V
(13617)210 648 A
3870 V
(13618)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
3960 V
(13619)210 648 A
(#include)336 1026 A
(<termios.h>)462 1404 A
4050 V
(13620)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
4140 V
(13621)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
4230 V
(13622)210 648 A
(#include)336 1026 A
("protect.h")462 1404 A
4320 V
(13623)210 648 A
(#include)336 1026 A
("tty.h")294 1404 A
4410 V
(13624)210 648 A
(#include)336 1026 A
("proc.h")336 1404 A
4500 V
(13625)210 648 A
4590 V
(13626)210 648 A
1026(/*)S
(Definitions)462 1152 A
(used)168 1656 A
1866(by)S
(the)126 1992 A
(console)294 2160 A
(driver.)294 2496 A
2832(*/)S
4680 V
(13627)210 648 A
(#define)294 1026 A
(MONO_BASE)378 1362 A
(0xB0000L)336 1908 A
2370(/*)S
(base)168 2496 A
2706(of)S
(mono)168 2832 A
(video)210 3042 A
(memory)252 3294 A
3588(*/)S
4770 V
(13628)210 648 A
(#define)294 1026 A
(COLOR_BASE)420 1362 A
(0xB8000L)336 1908 A
2370(/*)S
(base)168 2496 A
2706(of)S
(color)210 2832 A
(video)210 3084 A
(memory)252 3336 A
3630(*/)S
4860 V
(13629)210 648 A
(#define)294 1026 A
(MONO_SIZE)378 1362 A
(0x1000)252 1950 A
2370(/*)S
2496(4K)S
(mono)168 2622 A
(video)210 2832 A
(memory)252 3084 A
3378(*/)S
4950 V
(13630)210 648 A
(#define)294 1026 A
(COLOR_SIZE)420 1362 A
(0x4000)252 1950 A
2370(/*)S
(16K)126 2496 A
(color)210 2664 A
(video)210 2916 A
(memory)252 3168 A
3462(*/)S
5040 V
(13631)210 648 A
(#define)294 1026 A
(EGA_SIZE)336 1362 A
(0x8000)252 1950 A
2370(/*)S
(EGA)126 2496 A
2664(&)S
(VGA)126 2748 A
(have)168 2916 A
3126(at)S
(least)210 3252 A
(32K)126 3504 A
3672(*/)S
5130 V
(13632)210 648 A
(#define)294 1026 A
(BLANK_COLOR)462 1362 A
(0x0700)252 1950 A
2370(/*)S
(determines)420 2496 A
(cursor)252 2958 A
(color)210 3252 A
3504(on)S
(blank)210 3630 A
(screen)252 3882 A
4176(*/)S
5220 V
(13633)210 648 A
(#define)294 1026 A
(SCROLL_UP)378 1362 A
2160(0)S
2370(/*)S
(scroll)252 2496 A
(forward)294 2790 A
3126(*/)S
5310 V
(13634)210 648 A
(#define)294 1026 A
(SCROLL_DOWN)462 1362 A
2160(1)S
2370(/*)S
(scroll)252 2496 A
(backward)336 2790 A
3168(*/)S
5400 V
(13635)210 648 A
(#define)294 1026 A
(BLANK_MEM)378 1362 A
(\(\(u16_t)294 1782 A
2118(*\))S
2244(0\))S
2370(/*)S
(tells)210 2496 A
(mem_vid_copy\(\))588 2748 A
3378(to)S
(blank)210 3504 A
(the)126 3756 A
(screen)252 3924 A
4218(*/)S
5490 V
(13636)210 648 A
(#define)294 1026 A
(CONS_RAM_WORDS)588 1362 A
2118(80)S
2370(/*)S
(video)210 2496 A
(ram)126 2748 A
(buffer)252 2916 A
(size)168 3210 A
3420(*/)S
5580 V
(13637)210 648 A
(#define)294 1026 A
(MAX_ESC_PARMS)546 1362 A
2160(2)S
2370(/*)S
(number)252 2496 A
2790(of)S
(escape)252 2916 A
(sequence)336 3210 A
(params)252 3588 A
(allowed)294 3882 A
4218(*/)S
5670 V
(13638)210 648 A
5760 V
(13639)210 648 A
1026(/*)S
(Constants)378 1152 A
(relating)336 1572 A
1950(to)S
(the)126 2076 A
(controller)420 2244 A
(chips.)252 2706 A
3000(*/)S
5850 V
(13640)210 648 A
(#define)294 1026 A
(M_6845)252 1362 A
(0x3B4)210 1992 A
2370(/*)S
(port)168 2496 A
(for)126 2706 A
(6845)168 2874 A
(mono)168 3084 A
3294(*/)S
5940 V
(13641)210 648 A
(#define)294 1026 A
(C_6845)252 1362 A
(0x3D4)210 1992 A
2370(/*)S
(port)168 2496 A
(for)126 2706 A
(6845)168 2874 A
(color)210 3084 A
3336(*/)S
6030 V
(13642)210 648 A
(#define)294 1026 A
(EGA)126 1362 A
(0x3C4)210 1992 A
2370(/*)S
(port)168 2496 A
(for)126 2706 A
(EGA)126 2874 A
3042(or)S
(VGA)126 3168 A
(card)168 3336 A
3546(*/)S
6120 V
(13643)210 648 A
(#define)294 1026 A
(INDEX)210 1362 A
2160(0)S
2370(/*)S
(6845's)252 2496 A
(index)210 2790 A
(register)336 3042 A
3420(*/)S
6210 V
(13644)210 648 A
(#define)294 1026 A
(DATA)168 1362 A
2160(1)S
2370(/*)S
(6845's)252 2496 A
(data)168 2790 A
(register)336 3000 A
3378(*/)S
8418 V
EP
%%Page: 187 187
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1978(File:)S
2211(src/kernel/console.c)S
12 B
(187)180 4248 A
900 V
7 LST
(13645)210 648 A
(#define)294 1026 A
(VID_ORG)294 1362 A
2118(12)S
2370(/*)S
(6845's)252 2496 A
(origin)252 2790 A
(register)336 3084 A
3462(*/)S
990 V
(13646)210 648 A
(#define)294 1026 A
(CURSOR)252 1362 A
2118(14)S
2370(/*)S
(6845's)252 2496 A
(cursor)252 2790 A
(register)336 3084 A
3462(*/)S
1080 V
(13647)210 648 A
1170 V
(13648)210 648 A
1026(/*)S
(Beeper.)294 1152 A
1488(*/)S
1260 V
(13649)210 648 A
(#define)294 1026 A
(BEEP_FREQ)378 1362 A
(0x0533)252 1950 A
2370(/*)S
(value)210 2496 A
2748(to)S
(put)126 2874 A
(into)168 3042 A
(timer)210 3252 A
3504(to)S
(set)126 3630 A
(beep)168 3798 A
(freq)168 4008 A
4218(*/)S
1350 V
(13650)210 648 A
(#define)294 1026 A
(B_TIME)252 1362 A
2160(3)S
2370(/*)S
(length)252 2496 A
2790(of)S
(CTRL-G)252 2916 A
(beep)168 3210 A
3420(is)S
(ticks)210 3546 A
3798(*/)S
1440 V
(13651)210 648 A
1530 V
(13652)210 648 A
1026(/*)S
(definitions)462 1152 A
(used)168 1656 A
(for)126 1866 A
(font)168 2034 A
(management)420 2244 A
2706(*/)S
1620 V
(13653)210 648 A
(#define)294 1026 A
(GA_SEQUENCER_INDEX)756 1362 A
(0x3C4)210 2370 A
1710 V
(13654)210 648 A
(#define)294 1026 A
(GA_SEQUENCER_DATA)714 1362 A
(0x3C5)210 2370 A
1800 V
(13655)210 648 A
(#define)294 1026 A
(GA_GRAPHICS_INDEX)714 1362 A
(0x3CE)210 2370 A
1890 V
(13656)210 648 A
(#define)294 1026 A
(GA_GRAPHICS_DATA)672 1362 A
(0x3CF)210 2370 A
1980 V
(13657)210 648 A
(#define)294 1026 A
(GA_VIDEO_ADDRESS)672 1362 A
(0xA0000L)336 2370 A
2070 V
(13658)210 648 A
(#define)294 1026 A
(GA_FONT_SIZE)504 1362 A
(8192)168 2370 A
2160 V
(13659)210 648 A
2250 V
(13660)210 648 A
1026(/*)S
(Global)252 1152 A
(variables)378 1446 A
(used)168 1866 A
2076(by)S
(the)126 2202 A
(console)294 2370 A
(driver.)294 2706 A
3042(*/)S
2340 V
(13661)210 648 A
(PUBLIC)252 1026 A
(unsigned)336 1320 A
(vid_seg;)336 1698 A
2370(/*)S
(video)210 2496 A
(ram)126 2748 A
(selector)336 2916 A
(\(0xB0000)336 3294 A
3672(or)S
(0xB8000\))336 3798 A
4176(*/)S
2430 V
(13662)210 648 A
(PUBLIC)252 1026 A
(unsigned)336 1320 A
(vid_size;)378 1698 A
2370(/*)S
(0x2000)252 2496 A
(for)126 2790 A
(color)210 2958 A
3210(or)S
(0x0800)252 3336 A
(for)126 3630 A
(mono)168 3798 A
4008(*/)S
2520 V
(13663)210 648 A
(PUBLIC)252 1026 A
(unsigned)336 1320 A
(vid_mask;)378 1698 A
2370(/*)S
(0x1FFF)252 2496 A
(for)126 2790 A
(color)210 2958 A
3210(or)S
(0x07FF)252 3336 A
(for)126 3630 A
(mono)168 3798 A
4008(*/)S
2610 V
(13664)210 648 A
(PUBLIC)252 1026 A
(unsigned)336 1320 A
(blank_color)462 1698 A
2202(=)S
(BLANK_COLOR;)504 2286 A
2832(/*)S
(display)294 2958 A
(code)168 3294 A
(for)126 3504 A
(blank)210 3672 A
3924(*/)S
2700 V
(13665)210 648 A
2790 V
(13666)210 648 A
1026(/*)S
(Private)294 1152 A
(variables)378 1488 A
(used)168 1908 A
2118(by)S
(the)126 2244 A
(console)294 2412 A
(driver.)294 2748 A
3084(*/)S
2880 V
(13667)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(vid_port;)378 1530 A
2370(/*)S
(I/O)126 2496 A
(port)168 2664 A
(for)126 2874 A
(accessing)378 3042 A
(6845)168 3462 A
3672(*/)S
2970 V
(13668)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(wrap;)210 1530 A
2370(/*)S
(hardware)336 2496 A
(can)126 2874 A
(wrap?)210 3042 A
3294(*/)S
3060 V
(13669)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(softscroll;)462 1530 A
2370(/*)S
2496(1)S
2580(=)S
(software)336 2664 A
(scrolling,)420 3042 A
3504(0)S
3588(=)S
(hardware)336 3672 A
4050(*/)S
3150 V
(13670)210 648 A
(PRIVATE)294 1026 A
(unsigned)336 1362 A
(vid_base;)378 1740 A
2370(/*)S
(base)168 2496 A
2706(of)S
(video)210 2832 A
(ram)126 3084 A
(\(0xB000)294 3252 A
3588(or)S
(0xB800\))294 3714 A
4050(*/)S
3240 V
(13671)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(beeping;)336 1530 A
2370(/*)S
(speaker)294 2496 A
2832(is)S
(beeping?)336 2958 A
3336(*/)S
3330 V
(13672)210 648 A
(#define)294 1026 A
(scr_width)378 1362 A
2034(80)S
2370(/*)S
2496(#)S
(characters)420 2580 A
3042(on)S
3168(a)S
(line)168 3252 A
3462(*/)S
3420 V
(13673)210 648 A
(#define)294 1026 A
(scr_lines)378 1362 A
2034(25)S
2370(/*)S
2496(#)S
(lines)210 2580 A
2832(on)S
(the)126 2958 A
(screen)252 3126 A
3420(*/)S
3510 V
(13674)210 648 A
(#define)294 1026 A
(scr_size)336 1362 A
(\(80*25\))294 2034 A
2370(/*)S
2496(#)S
(characters)420 2580 A
3042(on)S
(the)126 3168 A
(screen)252 3336 A
3630(*/)S
3600 V
(13675)210 648 A
3690 V
(13676)210 648 A
1026(/*)S
(Per)126 1152 A
(console)294 1320 A
(data.)210 1656 A
1908(*/)S
3780 V
(13677)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
(console)294 1656 A
1992({)S
3870 V
(13678)210 648 A
(tty_t)210 1110 A
(*c_tty;)294 1362 A
2370(/*)S
(associated)420 2496 A
(TTY)126 2958 A
(struct)252 3126 A
3420(*/)S
3960 V
(13679)210 648 A
(int)126 1110 A
(c_column;)378 1278 A
2370(/*)S
(current)294 2496 A
(column)252 2832 A
(number)252 3126 A
(\(0-origin\))420 3420 A
3882(*/)S
4050 V
(13680)210 648 A
(int)126 1110 A
(c_row;)252 1278 A
2370(/*)S
(current)294 2496 A
(row)126 2832 A
3000(\(0)S
3126(at)S
(top)126 3252 A
3420(of)S
(screen\))294 3546 A
3882(*/)S
4140 V
(13681)210 648 A
(int)126 1110 A
(c_rwords;)378 1278 A
2370(/*)S
(number)252 2496 A
2790(of)S
(WORDS)210 2916 A
(\(not)168 3168 A
(bytes\))252 3378 A
3672(in)S
(outqueue)336 3798 A
4176(*/)S
4230 V
(13682)210 648 A
(unsigned)336 1110 A
(c_start;)336 1488 A
2370(/*)S
(start)210 2496 A
2748(of)S
(video)210 2874 A
(memory)252 3126 A
3420(of)S
(this)168 3546 A
(console)294 3756 A
4092(*/)S
4320 V
(13683)210 648 A
(unsigned)336 1110 A
(c_limit;)336 1488 A
2370(/*)S
(limit)210 2496 A
2748(of)S
(this)168 2874 A
(console's)378 3084 A
(video)210 3504 A
(memory)252 3756 A
4050(*/)S
4410 V
(13684)210 648 A
(unsigned)336 1110 A
(c_org;)252 1488 A
2370(/*)S
(location)336 2496 A
2874(in)S
(RAM)126 3000 A
(where)210 3168 A
(6845)168 3420 A
(base)168 3630 A
(points)252 3840 A
4134(*/)S
4500 V
(13685)210 648 A
(unsigned)336 1110 A
(c_cur;)252 1488 A
2370(/*)S
(current)294 2496 A
(position)336 2832 A
3210(of)S
(cursor)252 3336 A
3630(in)S
(video)210 3756 A
(RAM)126 4008 A
4176(*/)S
4590 V
(13686)210 648 A
(unsigned)336 1110 A
(c_attr;)294 1488 A
2370(/*)S
(character)378 2496 A
(attribute)378 2916 A
3336(*/)S
4680 V
(13687)210 648 A
(unsigned)336 1110 A
(c_blank;)336 1488 A
2370(/*)S
(blank)210 2496 A
(attribute)378 2748 A
3168(*/)S
4770 V
(13688)210 648 A
(char)168 1110 A
(c_esc_state;)504 1320 A
2370(/*)S
(0=normal,)378 2496 A
(1=ESC,)252 2916 A
(2=ESC[)252 3210 A
3504(*/)S
4860 V
(13689)210 648 A
(char)168 1110 A
(c_esc_intro;)504 1320 A
2370(/*)S
(Distinguishing)588 2496 A
(character)378 3126 A
(following)378 3546 A
(ESC)126 3966 A
4134(*/)S
4950 V
(13690)210 648 A
(int)126 1110 A
(*c_esc_parmp;)546 1278 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(current)294 2958 A
(escape)252 3294 A
(parameter)378 3588 A
4008(*/)S
5040 V
(13691)210 648 A
(int)126 1110 A
(c_esc_parmv[MAX_ESC_PARMS];)1134 1278 A
2706(/*)S
(list)168 2832 A
3042(of)S
(escape)252 3168 A
(parameters)420 3462 A
3924(*/)S
5130 V
(13692)210 648 A
(u16_t)210 1110 A
(c_ramqueue[CONS_RAM_WORDS];)1134 1362 A
2706(/*)S
(buffer)252 2832 A
(for)126 3126 A
(video)210 3294 A
(RAM)126 3546 A
3714(*/)S
5220 V
(13693)210 648 A
1026(})S
(console_t;)420 1110 A
5310 V
(13694)210 648 A
5400 V
(13695)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(nr_cons=)336 1530 A
1908(1;)S
2370(/*)S
(actual)252 2496 A
(number)252 2790 A
3084(of)S
(consoles)336 3210 A
3588(*/)S
5490 V
(13696)210 648 A
(PRIVATE)294 1026 A
(console_t)378 1362 A
(cons_table[NR_CONS];)840 1782 A
5580 V
(13697)210 648 A
(PRIVATE)294 1026 A
(console_t)378 1362 A
(*curcons;)378 1782 A
2370(/*)S
(currently)378 2496 A
(visible)294 2916 A
3252(*/)S
5670 V
(13698)210 648 A
5760 V
(13699)210 648 A
1026(/*)S
(Color)210 1152 A
1404(if)S
(using)210 1530 A
1782(a)S
(color)210 1866 A
(controller.)462 2118 A
2622(*/)S
5850 V
(13700)210 648 A
(#define)294 1026 A
(color)210 1362 A
(\(vid_port)378 1698 A
2118(==)S
(C_6845\))294 2244 A
5940 V
(13701)210 648 A
6030 V
(13702)210 648 A
1026(/*)S
(Map)126 1152 A
(from)168 1320 A
(ANSI)168 1530 A
(colors)252 1740 A
2034(to)S
(the)126 2160 A
(attributes)420 2328 A
(used)168 2790 A
3000(by)S
(the)126 3126 A
3294(PC)S
3420(*/)S
6120 V
(13703)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(ansi_colors[8])588 1530 A
2160(=)S
({0,)126 2244 A
2412(4,)S
2538(2,)S
2664(6,)S
2790(1,)S
2916(5,)S
3042(3,)S
(7};)126 3168 A
6210 V
(13704)210 648 A
8418 V
EP
%%Page: 188 188
BP
/slant 0 def
/height 0 def
630 V
12 B
(188)180 648 A
11 R
1978(File:)S
2211(src/kernel/console.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(13705)210 648 A
1026(/*)S
(Structure)378 1152 A
(used)168 1572 A
(for)126 1782 A
(font)168 1950 A
(management)420 2160 A
2622(*/)S
990 V
(13706)210 648 A
(struct)252 1026 A
(sequence)336 1320 A
1698({)S
1080 V
(13707)210 648 A
(unsigned)336 1362 A
(short)210 1740 A
(index;)252 1992 A
1170 V
(13708)210 648 A
(unsigned)336 1362 A
(char)168 1740 A
(port;)210 1950 A
1260 V
(13709)210 648 A
(unsigned)336 1362 A
(char)168 1740 A
(value;)252 1950 A
1350 V
(13710)210 648 A
1026(};)S
1440 V
(13711)210 648 A
1530 V
(13712)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(cons_write,)462 2076 A
(\(struct)294 2580 A
(tty)126 2916 A
(*tp\))168 3084 A
4050(\);)S
1620 V
(13713)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(cons_echo,)420 2076 A
(\(tty_t)252 2538 A
(*tp,)168 2832 A
(int)126 3042 A
3210(c\))S
4050(\);)S
1710 V
(13714)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(out_char,)378 2076 A
(\(console_t)420 2496 A
(*cons,)252 2958 A
(int)126 3252 A
3420(c\))S
4050(\);)S
1800 V
(13715)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(beep,)210 2076 A
(\(void\))252 2328 A
4050(\);)S
1890 V
(13716)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(do_escape,)420 2076 A
(\(console_t)420 2538 A
(*cons,)252 3000 A
(int)126 3294 A
3462(c\))S
4050(\);)S
1980 V
(13717)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(flush,)252 2076 A
(\(console_t)420 2370 A
(*cons\))252 2832 A
4050(\);)S
2070 V
(13718)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(parse_escape,)546 2076 A
(\(console_t)420 2664 A
(*cons,)252 3126 A
(int)126 3420 A
3588(c\))S
4050(\);)S
2160 V
(13719)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(scroll_screen,)588 2076 A
(\(console_t)420 2706 A
(*cons,)252 3168 A
(int)126 3462 A
(dir\))168 3630 A
4050(\);)S
2250 V
(13720)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(set_6845,)378 2076 A
(\(int)168 2496 A
(reg,)168 2706 A
(unsigned)336 2916 A
(val\))168 3294 A
4050(\);)S
2340 V
(13721)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(stop_beep,)420 2076 A
(\(void\))252 2538 A
4050(\);)S
2430 V
(13722)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(cons_org0,)420 2076 A
(\(void\))252 2538 A
4050(\);)S
2520 V
(13723)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(ga_program,)462 2076 A
(\(struct)294 2580 A
(sequence)336 2916 A
(*seq\))210 3294 A
3546(\);)S
2610 V
(13724)210 648 A
2700 V
(13725)210 648 A
2790 V
(13726)210 648 A
(/*===========================================================================*)3276 1026 A
2880 V
(13727)210 648 A
1068(*)S
(cons_write)420 2370 A
4260(*)S
2970 V
(13728)210 648 A
(*===========================================================================*/)3276 1068 A
3060 V
(13729)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(cons_write\(tp\))588 1572 A
3150 V
(13730)210 648 A
(register)336 1026 A
(struct)252 1404 A
(tty)126 1698 A
(*tp;)168 1866 A
2370(/*)S
(tells)210 2496 A
(which)210 2748 A
(terminal)336 3000 A
3378(is)S
3504(to)S
3630(be)S
(used)168 3756 A
3966(*/)S
3240 V
(13731)210 648 A
1026({)S
3330 V
(13732)210 648 A
1026(/*)S
(Copy)168 1152 A
1362(as)S
(much)168 1488 A
(data)168 1698 A
1908(as)S
(possible)336 2034 A
2412(to)S
(the)126 2538 A
(output)252 2706 A
(queue,)252 3000 A
(then)168 3294 A
(start)210 3504 A
(I/O.)168 3756 A
4008(On)S
3420 V
(13733)210 648 A
1068(*)S
(memory-mapped)546 1152 A
(terminals,)420 1740 A
(such)168 2202 A
2412(as)S
(the)126 2538 A
(IBM)126 2706 A
(console,)336 2874 A
(the)126 3252 A
(I/O)126 3420 A
(will)168 3588 A
(also)168 3798 A
4008(be)S
3510 V
(13734)210 648 A
1068(*)S
(finished,)378 1152 A
(and)126 1572 A
(the)126 1740 A
(counts)252 1908 A
(updated.)336 2202 A
(Keep)168 2622 A
(repeating)378 2832 A
(until)210 3252 A
(all)126 3504 A
(I/O)126 3672 A
(done.)210 3840 A
3600 V
(13735)210 648 A
1068(*/)S
3690 V
(13736)210 648 A
3780 V
(13737)210 648 A
(int)126 1110 A
(count;)252 1278 A
3870 V
(13738)210 648 A
(register)336 1110 A
(char)168 1488 A
(*tbuf;)252 1698 A
3960 V
(13739)210 648 A
(char)168 1110 A
(buf[64];)336 1320 A
4050 V
(13740)210 648 A
(phys_bytes)420 1110 A
(user_phys;)420 1572 A
4140 V
(13741)210 648 A
(console_t)378 1110 A
(*cons)210 1530 A
1782(=)S
(tp->tty_priv;)546 1866 A
4230 V
(13742)210 648 A
4320 V
(13743)210 648 A
1110(/*)S
(Check)210 1236 A
(quickly)294 1488 A
(for)126 1824 A
(nothing)294 1992 A
2328(to)S
(do,)126 2454 A
2622(so)S
(this)168 2748 A
(can)126 2958 A
3126(be)S
(called)252 3252 A
(often)210 3546 A
(without)294 3798 A
4410 V
(13744)210 648 A
1152(*)S
(unmodular)378 1236 A
(tests)210 1656 A
(elsewhere.)420 1908 A
4500 V
(13745)210 648 A
1152(*/)S
4590 V
(13746)210 648 A
1110(if)S
(\(\(count)294 1236 A
1572(=)S
(tp->tty_outleft\))672 1656 A
2370(==)S
2496(0)S
2580(||)S
(tp->tty_inhibited\))756 2706 A
(return;)294 3504 A
4680 V
(13747)210 648 A
4770 V
(13748)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(user)168 1614 A
(bytes)210 1824 A
2076(to)S
(buf[])210 2202 A
(for)126 2454 A
(decent)252 2622 A
(addressing.)462 2916 A
(Loop)168 3420 A
(over)168 3630 A
(the)126 3840 A
4860 V
(13749)210 648 A
1152(*)S
(copies,)294 1236 A
(since)210 1572 A
(the)126 1824 A
(user)168 1992 A
(buffer)252 2202 A
(may)126 2496 A
2664(be)S
(much)168 2790 A
(larger)252 3000 A
(than)168 3294 A
(buf[].)252 3504 A
4950 V
(13750)210 648 A
1152(*/)S
5040 V
(13751)210 648 A
1110(do)S
1236({)S
5130 V
(13752)210 648 A
1362(if)S
(\(count)252 1488 A
1782(>)S
(sizeof\(buf\)\))504 1866 A
(count)210 2412 A
2664(=)S
(sizeof\(buf\);)504 2748 A
5220 V
(13753)210 648 A
(user_phys)378 1362 A
1782(=)S
(proc_vir2phys\(proc_addr\(tp->tty_outproc\),)1722 1866 A
(tp->tty_out_vir\);)714 3630 A
5310 V
(13754)210 648 A
(phys_copy\(user_phys,)840 1362 A
(vir2phys\(buf\),)588 2244 A
(\(phys_bytes\))504 2874 A
(count\);)294 3420 A
5400 V
(13755)210 648 A
(tbuf)168 1362 A
1572(=)S
(buf;)168 1656 A
5490 V
(13756)210 648 A
5580 V
(13757)210 648 A
1362(/*)S
(Update)252 1488 A
(terminal)336 1782 A
(data)168 2160 A
(structure.)420 2370 A
2832(*/)S
5670 V
(13758)210 648 A
(tp->tty_out_vir)630 1362 A
2034(+=)S
(count;)252 2160 A
5760 V
(13759)210 648 A
(tp->tty_outcum)588 1362 A
1992(+=)S
(count;)252 2118 A
5850 V
(13760)210 648 A
(tp->tty_outleft)630 1362 A
2034(-=)S
(count;)252 2160 A
5940 V
(13761)210 648 A
6030 V
(13762)210 648 A
1362(/*)S
(Output)252 1488 A
(each)168 1782 A
(byte)168 1992 A
2202(of)S
(the)126 2328 A
(copy)168 2496 A
2706(to)S
(the)126 2832 A
(screen.)294 3000 A
(Avoid)210 3378 A
(calling)294 3630 A
6120 V
(13763)210 648 A
1404(*)S
(out_char\(\))420 1488 A
(for)126 1950 A
(the)126 2118 A
("easy")252 2286 A
(characters,)462 2580 A
(put)126 3084 A
(them)168 3252 A
(into)168 3462 A
(the)126 3672 A
(buffer)252 3840 A
6210 V
(13764)210 648 A
1404(*)S
(directly.)378 1488 A
8418 V
EP
%%Page: 189 189
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1978(File:)S
2211(src/kernel/console.c)S
12 B
(189)180 4248 A
900 V
7 LST
(13765)210 648 A
1404(*/)S
990 V
(13766)210 648 A
1362(do)S
1488({)S
1080 V
(13767)210 648 A
1698(if)S
(\(\(unsigned\))462 1824 A
(*tbuf)210 2328 A
2580(<)S
2664(')S
2748(')S
2832(||)S
(cons->c_esc_state)714 2958 A
3714(>)S
3798(0)S
1170 V
(13768)210 648 A
2034(||)S
(cons->c_column)588 2160 A
2790(>=)S
(scr_width)378 2916 A
1260 V
(13769)210 648 A
2034(||)S
(cons->c_rwords)588 2160 A
2790(>=)S
(buflen\(cons->c_ramqueue\)\))1050 2916 A
1350 V
(13770)210 648 A
1698({)S
1440 V
(13771)210 648 A
(out_char\(cons,)588 2034 A
(*tbuf++\);)378 2664 A
1530 V
(13772)210 648 A
1698(})S
(else)168 1782 A
1992({)S
1620 V
(13773)210 648 A
(cons->c_ramqueue[cons->c_rwords++])1428 2034 A
3504(=)S
1710 V
(13774)210 648 A
(cons->c_attr)504 2706 A
3252(|)S
(\(*tbuf++)336 3336 A
3714(&)S
(BYTE\);)252 3798 A
1800 V
(13775)210 648 A
(cons->c_column++;)714 2034 A
1890 V
(13776)210 648 A
1698(})S
1980 V
(13777)210 648 A
1362(})S
(while)210 1446 A
(\(--count)336 1698 A
2076(!=)S
(0\);)126 2202 A
2070 V
(13778)210 648 A
1110(})S
(while)210 1194 A
(\(\(count)294 1446 A
1782(=)S
(tp->tty_outleft\))672 1866 A
2580(!=)S
2706(0)S
2790(&&)S
(!tp->tty_inhibited\);)840 2916 A
2160 V
(13779)210 648 A
2250 V
(13780)210 648 A
(flush\(cons\);)504 1110 A
2370(/*)S
(transfer)336 2496 A
(anything)336 2874 A
(buffered)336 3252 A
3630(to)S
(the)126 3756 A
(screen)252 3924 A
4218(*/)S
2340 V
(13781)210 648 A
2430 V
(13782)210 648 A
1110(/*)S
(Reply)210 1236 A
1488(to)S
(the)126 1614 A
(writer)252 1782 A
2076(if)S
(all)126 2202 A
(output)252 2370 A
2664(is)S
(finished.)378 2790 A
3210(*/)S
2520 V
(13783)210 648 A
1110(if)S
(\(tp->tty_outleft)672 1236 A
1950(==)S
2076(0\))S
2202({)S
2610 V
(13784)210 648 A
(tty_reply\(tp->tty_outrepcode,)1218 1362 A
(tp->tty_outcaller,)756 2622 A
(tp->tty_outproc,)672 3420 A
2700 V
(13785)210 648 A
(tp->tty_outcum\);)672 3378 A
2790 V
(13786)210 648 A
(tp->tty_outcum)588 1362 A
1992(=)S
2076(0;)S
2880 V
(13787)210 648 A
1110(})S
2970 V
(13788)210 648 A
1026(})S
3240 V
(13791)210 648 A
(/*===========================================================================*)3276 1026 A
3330 V
(13792)210 648 A
1068(*)S
(cons_echo)378 2370 A
4260(*)S
3420 V
(13793)210 648 A
(*===========================================================================*/)3276 1068 A
3510 V
(13794)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(cons_echo\(tp,)546 1572 A
2160(c\))S
3600 V
(13795)210 648 A
(register)336 1026 A
(tty_t)210 1404 A
(*tp;)168 1656 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(tty)126 2958 A
(struct)252 3126 A
3420(*/)S
3690 V
(13796)210 648 A
(int)126 1026 A
1194(c;)S
2370(/*)S
(character)378 2496 A
2916(to)S
3042(be)S
(echoed)252 3168 A
3462(*/)S
3780 V
(13797)210 648 A
1026({)S
3870 V
(13798)210 648 A
1026(/*)S
(Echo)168 1152 A
(keyboard)336 1362 A
(input)210 1740 A
(\(print)252 1992 A
2286(&)S
(flush\).)294 2370 A
2706(*/)S
3960 V
(13799)210 648 A
(console_t)378 1110 A
(*cons)210 1530 A
1782(=)S
(tp->tty_priv;)546 1866 A
4050 V
(13800)210 648 A
4140 V
(13801)210 648 A
(out_char\(cons,)588 1110 A
(c\);)126 1740 A
4230 V
(13802)210 648 A
(flush\(cons\);)504 1110 A
4320 V
(13803)210 648 A
1026(})S
4590 V
(13806)210 648 A
(/*===========================================================================*)3276 1026 A
4680 V
(13807)210 648 A
1068(*)S
(out_char)336 2370 A
4260(*)S
4770 V
(13808)210 648 A
(*===========================================================================*/)3276 1068 A
4860 V
(13809)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(out_char\(cons,)588 1572 A
2202(c\))S
4950 V
(13810)210 648 A
(register)336 1026 A
(console_t)378 1404 A
(*cons;)252 1824 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(console)294 2958 A
(struct)252 3294 A
3588(*/)S
5040 V
(13811)210 648 A
(int)126 1026 A
1194(c;)S
2370(/*)S
(character)378 2496 A
2916(to)S
3042(be)S
(output)252 3168 A
3462(*/)S
5130 V
(13812)210 648 A
1026({)S
5220 V
(13813)210 648 A
1026(/*)S
(Output)252 1152 A
1446(a)S
(character)378 1530 A
1950(on)S
(the)126 2076 A
(console.)336 2244 A
(Check)210 2664 A
(for)126 2916 A
(escape)252 3084 A
(sequences)378 3378 A
(first.)252 3798 A
4092(*/)S
5310 V
(13814)210 648 A
1110(if)S
(\(cons->c_esc_state)756 1236 A
2034(>)S
2118(0\))S
2244({)S
5400 V
(13815)210 648 A
(parse_escape\(cons,)756 1362 A
(c\);)126 2160 A
5490 V
(13816)210 648 A
(return;)294 1362 A
5580 V
(13817)210 648 A
1110(})S
5670 V
(13818)210 648 A
5760 V
(13819)210 648 A
(switch\(c\))378 1110 A
1530({)S
5850 V
(13820)210 648 A
(case)168 1362 A
(000:)168 1572 A
2370(/*)S
(null)168 2496 A
2706(is)S
(typically)378 2832 A
(used)168 3252 A
(for)126 3462 A
(padding)294 3630 A
3966(*/)S
5940 V
(13821)210 648 A
(return;)294 1698 A
2370(/*)S
(better)252 2496 A
(not)126 2790 A
2958(do)S
(anything)336 3084 A
3462(*/)S
6030 V
(13822)210 648 A
6120 V
(13823)210 648 A
(case)168 1362 A
(007:)168 1572 A
2370(/*)S
(ring)168 2496 A
(the)126 2706 A
(bell)168 2874 A
3084(*/)S
6210 V
(13824)210 648 A
(flush\(cons\);)504 1698 A
2370(/*)S
(print)210 2496 A
(any)126 2748 A
(chars)210 2916 A
(queued)252 3168 A
(for)126 3462 A
(output)252 3630 A
3924(*/)S
8418 V
EP
%%Page: 190 190
BP
/slant 0 def
/height 0 def
630 V
12 B
(190)180 648 A
11 R
1978(File:)S
2211(src/kernel/console.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(13825)210 648 A
(beep\(\);)294 1698 A
990 V
(13826)210 648 A
(return;)294 1698 A
1080 V
(13827)210 648 A
1170 V
(13828)210 648 A
(case)168 1362 A
('\\b':)210 1572 A
2370(/*)S
(backspace)378 2496 A
2916(*/)S
1260 V
(13829)210 648 A
1698(if)S
(\(--cons->c_column)714 1824 A
2580(<)S
2664(0\))S
2790({)S
1350 V
(13830)210 648 A
2034(if)S
(\(--cons->c_row)588 2160 A
2790(>=)S
2916(0\))S
(cons->c_column)588 3042 A
3672(+=)S
(scr_width;)420 3798 A
1440 V
(13831)210 648 A
1698(})S
1530 V
(13832)210 648 A
(flush\(cons\);)504 1698 A
1620 V
(13833)210 648 A
(return;)294 1698 A
1710 V
(13834)210 648 A
1800 V
(13835)210 648 A
(case)168 1362 A
('\\n':)210 1572 A
2370(/*)S
(line)168 2496 A
(feed)168 2706 A
2916(*/)S
1890 V
(13836)210 648 A
1698(if)S
(\(\(cons->c_tty->tty_termios.c_oflag)1428 1824 A
3294(&)S
(\(OPOST|ONLCR\)\))588 3378 A
1980 V
(13837)210 648 A
3042(==)S
(\(OPOST|ONLCR\)\))588 3168 A
3798({)S
2070 V
(13838)210 648 A
(cons->c_column)588 2034 A
2664(=)S
2748(0;)S
2160 V
(13839)210 648 A
1698(})S
2250 V
(13840)210 648 A
(/*FALL)252 1698 A
(THROUGH*/)378 1992 A
2340 V
(13841)210 648 A
(case)168 1362 A
(013:)168 1572 A
2370(/*)S
(CTRL-K)252 2496 A
2790(*/)S
2430 V
(13842)210 648 A
(case)168 1362 A
(014:)168 1572 A
2370(/*)S
(CTRL-L)252 2496 A
2790(*/)S
2520 V
(13843)210 648 A
1698(if)S
(\(cons->c_row)504 1824 A
2370(==)S
(scr_lines-1\))504 2496 A
3042({)S
2610 V
(13844)210 648 A
(scroll_screen\(cons,)798 2034 A
(SCROLL_UP\);)462 2874 A
2700 V
(13845)210 648 A
1698(})S
(else)168 1782 A
1992({)S
2790 V
(13846)210 648 A
(cons->c_row++;)588 2034 A
2880 V
(13847)210 648 A
1698(})S
2970 V
(13848)210 648 A
(flush\(cons\);)504 1698 A
3060 V
(13849)210 648 A
(return;)294 1698 A
3150 V
(13850)210 648 A
3240 V
(13851)210 648 A
(case)168 1362 A
('\\r':)210 1572 A
2370(/*)S
(carriage)336 2496 A
(return)252 2874 A
3168(*/)S
3330 V
(13852)210 648 A
(cons->c_column)588 1698 A
2328(=)S
2412(0;)S
3420 V
(13853)210 648 A
(flush\(cons\);)504 1698 A
3510 V
(13854)210 648 A
(return;)294 1698 A
3600 V
(13855)210 648 A
3690 V
(13856)210 648 A
(case)168 1362 A
('\\t':)210 1572 A
2370(/*)S
(tab)126 2496 A
2664(*/)S
3780 V
(13857)210 648 A
(cons->c_column)588 1698 A
2328(=)S
(\(cons->c_column)630 2412 A
3084(+)S
(TAB_SIZE\))378 3168 A
3588(&)S
(\304TAB_MASK;)420 3672 A
3870 V
(13858)210 648 A
1698(if)S
(\(cons->c_column)630 1824 A
2496(>)S
(scr_width\))420 2580 A
3042({)S
3960 V
(13859)210 648 A
(cons->c_column)588 2034 A
2664(-=)S
(scr_width;)420 2790 A
4050 V
(13860)210 648 A
2034(if)S
(\(cons->c_row)504 2160 A
2706(==)S
(scr_lines-1\))504 2832 A
3378({)S
4140 V
(13861)210 648 A
(scroll_screen\(cons,)798 2370 A
(SCROLL_UP\);)462 3210 A
4230 V
(13862)210 648 A
2034(})S
(else)168 2118 A
2328({)S
4320 V
(13863)210 648 A
(cons->c_row++;)588 2370 A
4410 V
(13864)210 648 A
2034(})S
4500 V
(13865)210 648 A
1698(})S
4590 V
(13866)210 648 A
(flush\(cons\);)504 1698 A
4680 V
(13867)210 648 A
(return;)294 1698 A
4770 V
(13868)210 648 A
4860 V
(13869)210 648 A
(case)168 1362 A
(033:)168 1572 A
2370(/*)S
(ESC)126 2496 A
2664(-)S
(start)210 2748 A
3000(of)S
3126(an)S
(escape)252 3252 A
(sequence)336 3546 A
3924(*/)S
4950 V
(13870)210 648 A
(flush\(cons\);)504 1698 A
2370(/*)S
(print)210 2496 A
(any)126 2748 A
(chars)210 2916 A
(queued)252 3168 A
(for)126 3462 A
(output)252 3630 A
3924(*/)S
5040 V
(13871)210 648 A
(cons->c_esc_state)714 1698 A
2454(=)S
2538(1;)S
2706(/*)S
(mark)168 2832 A
(ESC)126 3042 A
3210(as)S
(seen)168 3336 A
3546(*/)S
5130 V
(13872)210 648 A
(return;)294 1698 A
5220 V
(13873)210 648 A
5310 V
(13874)210 648 A
(default:)336 1362 A
2370(/*)S
(printable)378 2496 A
(chars)210 2916 A
(are)126 3168 A
(stored)252 3336 A
3630(in)S
(ramqueue)336 3756 A
4134(*/)S
5400 V
(13875)210 648 A
1698(if)S
(\(cons->c_column)630 1824 A
2496(>=)S
(scr_width\))420 2622 A
3084({)S
5490 V
(13876)210 648 A
2034(if)S
(\(!LINEWRAP\))462 2160 A
(return;)294 2664 A
5580 V
(13877)210 648 A
2034(if)S
(\(cons->c_row)504 2160 A
2706(==)S
(scr_lines-1\))504 2832 A
3378({)S
5670 V
(13878)210 648 A
(scroll_screen\(cons,)798 2370 A
(SCROLL_UP\);)462 3210 A
5760 V
(13879)210 648 A
2034(})S
(else)168 2118 A
2328({)S
5850 V
(13880)210 648 A
(cons->c_row++;)588 2370 A
5940 V
(13881)210 648 A
2034(})S
6030 V
(13882)210 648 A
(cons->c_column)588 2034 A
2664(=)S
2748(0;)S
6120 V
(13883)210 648 A
(flush\(cons\);)504 2034 A
6210 V
(13884)210 648 A
1698(})S
8418 V
EP
%%Page: 191 191
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1978(File:)S
2211(src/kernel/console.c)S
12 B
(191)180 4248 A
900 V
7 LST
(13885)210 648 A
1698(if)S
(\(cons->c_rwords)630 1824 A
2496(==)S
(buflen\(cons->c_ramqueue\)\))1050 2622 A
(flush\(cons\);)504 3714 A
990 V
(13886)210 648 A
(cons->c_ramqueue[cons->c_rwords++])1428 1698 A
3168(=)S
(cons->c_attr)504 3252 A
3798(|)S
3882(\(c)S
4008(&)S
(BYTE\);)252 4092 A
1080 V
(13887)210 648 A
(cons->c_column++;)714 1698 A
3378(/*)S
(next)168 3504 A
(column)252 3714 A
4008(*/)S
1170 V
(13888)210 648 A
(return;)294 1698 A
1260 V
(13889)210 648 A
1110(})S
1350 V
(13890)210 648 A
1026(})S
1620 V
(13893)210 648 A
(/*===========================================================================*)3276 1026 A
1710 V
(13894)210 648 A
1068(*)S
(scroll_screen)546 2370 A
4260(*)S
1800 V
(13895)210 648 A
(*===========================================================================*/)3276 1068 A
1890 V
(13896)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(scroll_screen\(cons,)798 1572 A
(dir\))168 2412 A
1980 V
(13897)210 648 A
(register)336 1026 A
(console_t)378 1404 A
(*cons;)252 1824 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(console)294 2958 A
(struct)252 3294 A
3588(*/)S
2070 V
(13898)210 648 A
(int)126 1026 A
(dir;)168 1194 A
2370(/*)S
(SCROLL_UP)378 2496 A
2916(or)S
(SCROLL_DOWN)462 3042 A
3546(*/)S
2160 V
(13899)210 648 A
1026({)S
2250 V
(13900)210 648 A
(unsigned)336 1110 A
(new_line,)378 1488 A
(new_org,)336 1908 A
(chars;)252 2286 A
2340 V
(13901)210 648 A
2430 V
(13902)210 648 A
(flush\(cons\);)504 1110 A
2520 V
(13903)210 648 A
(chars)210 1110 A
1362(=)S
(scr_size)336 1446 A
1824(-)S
(scr_width;)420 1908 A
2706(/*)S
(one)126 2832 A
(screen)252 3000 A
(minus)210 3294 A
(one)126 3546 A
(line)168 3714 A
3924(*/)S
2610 V
(13904)210 648 A
2700 V
(13905)210 648 A
1110(/*)S
(Scrolling)378 1236 A
(the)126 1656 A
(screen)252 1824 A
2118(is)S
2244(a)S
(real)168 2328 A
(nuisance)336 2538 A
(due)126 2916 A
3084(to)S
(the)126 3210 A
(various)294 3378 A
(incompatible)504 3714 A
2790 V
(13906)210 648 A
1152(*)S
(video)210 1236 A
(cards.)252 1488 A
(This)168 1824 A
(driver)252 2034 A
(supports)336 2328 A
(software)336 2706 A
(scrolling)378 3084 A
(\(Hercules?\),)504 3504 A
2880 V
(13907)210 648 A
1152(*)S
(hardware)336 1236 A
(scrolling)378 1614 A
(\(mono)210 2034 A
(and)126 2286 A
(CGA)126 2454 A
(cards\))252 2622 A
(and)126 2916 A
(hardware)336 3084 A
(scrolling)378 3462 A
(without)294 3882 A
2970 V
(13908)210 648 A
1152(*)S
(wrapping)336 1236 A
(\(EGA)168 1614 A
(and)126 1824 A
(VGA)126 1992 A
(cards\).)294 2160 A
2538(In)S
(the)126 2664 A
(latter)252 2832 A
(case)168 3126 A
3336(we)S
(must)168 3462 A
(make)168 3672 A
(sure)168 3882 A
(that)168 4092 A
3060 V
(13909)210 648 A
1152(*)S
(c_start)294 1698 A
2034(<=)S
(c_org)210 2160 A
2412(&&)S
(c_org)210 2538 A
2790(+)S
(scr_size)336 2874 A
3252(<=)S
(c_limit)294 3378 A
3150 V
(13910)210 648 A
1152(*)S
(holds,)252 1236 A
(because)294 1530 A
(EGA)126 1866 A
(and)126 2034 A
(VGA)126 2202 A
(don't)210 2370 A
(wrap)168 2622 A
(around)252 2832 A
(the)126 3126 A
(end)126 3294 A
3462(of)S
(video)210 3588 A
(memory.)294 3840 A
3240 V
(13911)210 648 A
1152(*/)S
3330 V
(13912)210 648 A
1110(if)S
(\(dir)168 1236 A
1446(==)S
(SCROLL_UP\))420 1572 A
2034({)S
3420 V
(13913)210 648 A
1362(/*)S
(Scroll)252 1488 A
(one)126 1782 A
(line)168 1950 A
2160(up)S
2286(in)S
2412(3)S
(ways:)210 2496 A
(soft,)210 2748 A
(avoid)210 3000 A
(wrap,)210 3252 A
(use)126 3504 A
(origin.)294 3672 A
4008(*/)S
3510 V
(13914)210 648 A
1362(if)S
(\(softscroll\))504 1488 A
2034({)S
3600 V
(13915)210 648 A
(vid_vid_copy\(cons->c_start)1092 1698 A
2832(+)S
(scr_width,)420 2916 A
(cons->c_start,)588 3378 A
(chars\);)294 4008 A
3690 V
(13916)210 648 A
1362(})S
(else)168 1446 A
3780 V
(13917)210 648 A
1362(if)S
(\(!wrap)252 1488 A
1782(&&)S
(cons->c_org)462 1908 A
2412(+)S
(scr_size)336 2496 A
2874(+)S
(scr_width)378 2958 A
3378(>=)S
(cons->c_limit\))588 3504 A
4134({)S
3870 V
(13918)210 648 A
(vid_vid_copy\(cons->c_org)1008 1698 A
2748(+)S
(scr_width,)420 2832 A
(cons->c_start,)588 3294 A
(chars\);)294 3924 A
3960 V
(13919)210 648 A
(cons->c_org)462 1698 A
2202(=)S
(cons->c_start;)588 2286 A
4050 V
(13920)210 648 A
1362(})S
(else)168 1446 A
1656({)S
4140 V
(13921)210 648 A
(cons->c_org)462 1698 A
2202(=)S
(\(cons->c_org)504 2286 A
2832(+)S
(scr_width\))420 2916 A
3378(&)S
(vid_mask;)378 3462 A
4230 V
(13922)210 648 A
1362(})S
4320 V
(13923)210 648 A
(new_line)336 1362 A
1740(=)S
(\(cons->c_org)504 1824 A
2370(+)S
(chars\))252 2454 A
2748(&)S
(vid_mask;)378 2832 A
4410 V
(13924)210 648 A
1110(})S
(else)168 1194 A
1404({)S
4500 V
(13925)210 648 A
1362(/*)S
(Scroll)252 1488 A
(one)126 1782 A
(line)168 1950 A
(down)168 2160 A
2370(in)S
2496(3)S
(ways:)210 2580 A
(soft,)210 2832 A
(avoid)210 3084 A
(wrap,)210 3336 A
(use)126 3588 A
(origin.)294 3756 A
4092(*/)S
4590 V
(13926)210 648 A
1362(if)S
(\(softscroll\))504 1488 A
2034({)S
4680 V
(13927)210 648 A
(vid_vid_copy\(cons->c_start,)1134 1698 A
(cons->c_start)546 2874 A
3462(+)S
(scr_width,)420 3546 A
(chars\);)294 4008 A
4770 V
(13928)210 648 A
1362(})S
(else)168 1446 A
4860 V
(13929)210 648 A
1362(if)S
(\(!wrap)252 1488 A
1782(&&)S
(cons->c_org)462 1908 A
2412(<)S
(cons->c_start)546 2496 A
3084(+)S
(scr_width\))420 3168 A
3630({)S
4950 V
(13930)210 648 A
(new_org)294 1698 A
2034(=)S
(cons->c_limit)546 2118 A
2706(-)S
(scr_size;)378 2790 A
5040 V
(13931)210 648 A
(vid_vid_copy\(cons->c_org,)1050 1698 A
(new_org)294 2790 A
3126(+)S
(scr_width,)420 3210 A
(chars\);)294 3672 A
5130 V
(13932)210 648 A
(cons->c_org)462 1698 A
2202(=)S
(new_org;)336 2286 A
5220 V
(13933)210 648 A
1362(})S
(else)168 1446 A
1656({)S
5310 V
(13934)210 648 A
(cons->c_org)462 1698 A
2202(=)S
(\(cons->c_org)504 2286 A
2832(-)S
(scr_width\))420 2916 A
3378(&)S
(vid_mask;)378 3462 A
5400 V
(13935)210 648 A
1362(})S
5490 V
(13936)210 648 A
(new_line)336 1362 A
1740(=)S
(cons->c_org;)504 1824 A
5580 V
(13937)210 648 A
1110(})S
5670 V
(13938)210 648 A
1110(/*)S
(Blank)210 1236 A
(the)126 1488 A
(new)126 1656 A
(line)168 1824 A
2034(at)S
(top)126 2160 A
2328(or)S
(bottom.)294 2454 A
2790(*/)S
5760 V
(13939)210 648 A
(blank_color)462 1110 A
1614(=)S
(cons->c_blank;)588 1698 A
5850 V
(13940)210 648 A
(mem_vid_copy\(BLANK_MEM,)966 1110 A
(new_line,)378 2118 A
(scr_width\);)462 2538 A
5940 V
(13941)210 648 A
6030 V
(13942)210 648 A
1110(/*)S
(Set)126 1236 A
(the)126 1404 A
(new)126 1572 A
(video)210 1740 A
(origin.)294 1992 A
2328(*/)S
6120 V
(13943)210 648 A
1110(if)S
(\(cons)210 1236 A
1488(==)S
(curcons\))336 1614 A
(set_6845\(VID_ORG,)714 1992 A
(cons->c_org\);)546 2748 A
6210 V
(13944)210 648 A
(flush\(cons\);)504 1110 A
8418 V
EP
%%Page: 192 192
BP
/slant 0 def
/height 0 def
630 V
12 B
(192)180 648 A
11 R
1978(File:)S
2211(src/kernel/console.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(13945)210 648 A
1026(})S
1170 V
(13948)210 648 A
(/*===========================================================================*)3276 1026 A
1260 V
(13949)210 648 A
1068(*)S
(flush)210 2370 A
4260(*)S
1350 V
(13950)210 648 A
(*===========================================================================*/)3276 1068 A
1440 V
(13951)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(flush\(cons\))462 1572 A
1530 V
(13952)210 648 A
(register)336 1026 A
(console_t)378 1404 A
(*cons;)252 1824 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(console)294 2958 A
(struct)252 3294 A
3588(*/)S
1620 V
(13953)210 648 A
1026({)S
1710 V
(13954)210 648 A
1026(/*)S
(Send)168 1152 A
(characters)420 1362 A
(buffered)336 1824 A
2202(in)S
('ramqueue')420 2328 A
2790(to)S
(screen)252 2916 A
(memory,)294 3210 A
(check)210 3546 A
(the)126 3798 A
(new)126 3966 A
1800 V
(13955)210 648 A
1068(*)S
(cursor)252 1152 A
(position,)378 1446 A
(compute)294 1866 A
(the)126 2202 A
(new)126 2370 A
(hardware)336 2538 A
(cursor)252 2916 A
(position)336 3210 A
(and)126 3588 A
(set)126 3756 A
(it.)126 3924 A
1890 V
(13956)210 648 A
1068(*/)S
1980 V
(13957)210 648 A
(unsigned)336 1110 A
(cur;)168 1488 A
2070 V
(13958)210 648 A
(tty_t)210 1110 A
(*tp)126 1362 A
1530(=)S
(cons->c_tty;)504 1614 A
2160 V
(13959)210 648 A
2250 V
(13960)210 648 A
1110(/*)S
(Have)168 1236 A
(the)126 1446 A
(characters)420 1614 A
2076(in)S
('ramqueue')420 2202 A
(transferred)462 2664 A
3168(to)S
(the)126 3294 A
(screen.)294 3462 A
3798(*/)S
2340 V
(13961)210 648 A
1110(if)S
(\(cons->c_rwords)630 1236 A
1908(>)S
1992(0\))S
2118({)S
2430 V
(13962)210 648 A
(mem_vid_copy\(cons->c_ramqueue,)1260 1362 A
(cons->c_cur,)504 2664 A
(cons->c_rwords\);)672 3210 A
2520 V
(13963)210 648 A
(cons->c_rwords)588 1362 A
1992(=)S
2076(0;)S
2610 V
(13964)210 648 A
2700 V
(13965)210 648 A
1362(/*)S
(TTY)126 1488 A
(likes)210 1656 A
1908(to)S
(know)168 2034 A
(the)126 2244 A
(current)294 2412 A
(column)252 2748 A
(and)126 3042 A
3210(if)S
(echoing)294 3336 A
(messed)252 3672 A
(up.)126 3966 A
4134(*/)S
2790 V
(13966)210 648 A
(tp->tty_position)672 1362 A
2076(=)S
(cons->c_column;)630 2160 A
2880 V
(13967)210 648 A
(tp->tty_reprint)630 1362 A
2034(=)S
(TRUE;)210 2118 A
2970 V
(13968)210 648 A
1110(})S
3060 V
(13969)210 648 A
3150 V
(13970)210 648 A
1110(/*)S
(Check)210 1236 A
(and)126 1488 A
(update)252 1656 A
(the)126 1950 A
(cursor)252 2118 A
(position.)378 2412 A
2832(*/)S
3240 V
(13971)210 648 A
1110(if)S
(\(cons->c_column)630 1236 A
1908(<)S
1992(0\))S
(cons->c_column)588 2118 A
2748(=)S
2832(0;)S
3330 V
(13972)210 648 A
1110(if)S
(\(cons->c_column)630 1236 A
1908(>)S
(scr_width\))420 1992 A
(cons->c_column)588 2454 A
3084(=)S
(scr_width;)420 3168 A
3420 V
(13973)210 648 A
1110(if)S
(\(cons->c_row)504 1236 A
1782(<)S
1866(0\))S
(cons->c_row)462 1992 A
2496(=)S
2580(0;)S
3510 V
(13974)210 648 A
1110(if)S
(\(cons->c_row)504 1236 A
1782(>=)S
(scr_lines\))420 1908 A
(cons->c_row)462 2370 A
2874(=)S
(scr_lines)378 2958 A
3378(-)S
3462(1;)S
3600 V
(13975)210 648 A
(cur)126 1110 A
1278(=)S
(cons->c_org)462 1362 A
1866(+)S
(cons->c_row)462 1950 A
2454(*)S
(scr_width)378 2538 A
2958(+)S
(cons->c_column;)630 3042 A
3690 V
(13976)210 648 A
1110(if)S
(\(cur)168 1236 A
1446(!=)S
(cons->c_cur\))504 1572 A
2118({)S
3780 V
(13977)210 648 A
1362(if)S
(\(cons)210 1488 A
1740(==)S
(curcons\))336 1866 A
(set_6845\(CURSOR,)672 2244 A
(cur\);)210 2958 A
3870 V
(13978)210 648 A
(cons->c_cur)462 1362 A
1866(=)S
(cur;)168 1950 A
3960 V
(13979)210 648 A
1110(})S
4050 V
(13980)210 648 A
1026(})S
4320 V
(13983)210 648 A
(/*===========================================================================*)3276 1026 A
4410 V
(13984)210 648 A
1068(*)S
(parse_escape)504 2370 A
4260(*)S
4500 V
(13985)210 648 A
(*===========================================================================*/)3276 1068 A
4590 V
(13986)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(parse_escape\(cons,)756 1572 A
2370(c\))S
4680 V
(13987)210 648 A
(register)336 1026 A
(console_t)378 1404 A
(*cons;)252 1824 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(console)294 2958 A
(struct)252 3294 A
3588(*/)S
4770 V
(13988)210 648 A
(char)168 1026 A
1236(c;)S
2370(/*)S
(next)168 2496 A
(character)378 2706 A
3126(in)S
(escape)252 3252 A
(sequence)336 3546 A
3924(*/)S
4860 V
(13989)210 648 A
1026({)S
4950 V
(13990)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(ANSI)168 1740 A
(escape)252 1950 A
(sequences)378 2244 A
(are)126 2664 A
(currently)378 2832 A
(supported.)420 3252 A
5040 V
(13991)210 648 A
1068(*)S
1152(If)S
1278(n)S
(and/or)252 1362 A
1656(m)S
(are)126 1740 A
(omitted,)336 1908 A
(they)168 2286 A
(default)294 2496 A
2832(to)S
2958(1.)S
(Omitted)294 3084 A
3420(s)S
(defaults)336 3504 A
3882(to)S
4008(0.)S
5130 V
(13992)210 648 A
1068(*)S
(ESC)126 1236 A
([nA)126 1404 A
(moves)210 1572 A
1824(up)S
1950(n)S
(lines)210 2034 A
5220 V
(13993)210 648 A
1068(*)S
(ESC)126 1236 A
([nB)126 1404 A
(moves)210 1572 A
(down)168 1824 A
2034(n)S
(lines)210 2118 A
5310 V
(13994)210 648 A
1068(*)S
(ESC)126 1236 A
([nC)126 1404 A
(moves)210 1572 A
(right)210 1824 A
2076(n)S
(spaces)252 2160 A
5400 V
(13995)210 648 A
1068(*)S
(ESC)126 1236 A
([nD)126 1404 A
(moves)210 1572 A
(left)168 1824 A
2034(n)S
(spaces)252 2118 A
5490 V
(13996)210 648 A
1068(*)S
(ESC)126 1236 A
([m;nH)210 1404 A
(moves)210 1656 A
(cursor)252 1908 A
2202(to)S
(\(m,n\))210 2328 A
5580 V
(13997)210 648 A
1068(*)S
(ESC)126 1236 A
([sJ)126 1404 A
(clears)252 1572 A
(screen)252 1866 A
(relative)336 2160 A
2538(to)S
(cursor)252 2664 A
2958(\(0)S
3084(to)S
(end,)168 3210 A
3420(1)S
(from)168 3504 A
(start,)252 3714 A
4008(2)S
(all\))168 4092 A
5670 V
(13998)210 648 A
1068(*)S
(ESC)126 1236 A
([sK)126 1404 A
(clears)252 1572 A
(line)168 1866 A
(relative)336 2076 A
2454(to)S
(cursor)252 2580 A
2874(\(0)S
3000(to)S
(end,)168 3126 A
3336(1)S
(from)168 3420 A
(start,)252 3630 A
3924(2)S
(all\))168 4008 A
5760 V
(13999)210 648 A
1068(*)S
(ESC)126 1236 A
([nL)126 1404 A
(inserts)294 1572 A
1908(n)S
(lines)210 1992 A
2244(at)S
(cursor)252 2370 A
5850 V
(14000)210 648 A
1068(*)S
(ESC)126 1236 A
([nM)126 1404 A
(deletes)294 1572 A
1908(n)S
(lines)210 1992 A
2244(at)S
(cursor)252 2370 A
5940 V
(14001)210 648 A
1068(*)S
(ESC)126 1236 A
([nP)126 1404 A
(deletes)294 1572 A
1908(n)S
(chars)210 1992 A
2244(at)S
(cursor)252 2370 A
6030 V
(14002)210 648 A
1068(*)S
(ESC)126 1236 A
([n@)126 1404 A
(inserts)294 1572 A
1908(n)S
(chars)210 1992 A
2244(at)S
(cursor)252 2370 A
6120 V
(14003)210 648 A
1068(*)S
(ESC)126 1236 A
([nm)126 1404 A
(enables)294 1572 A
(rendition)378 1908 A
2328(n)S
(\(0=)126 2412 A
(normal,)294 2580 A
(1=bold,)294 2916 A
(4=underline,)504 3252 A
(5=blinking,)462 3798 A
6210 V
(14004)210 648 A
1068(*)S
(7=reverse,)420 1404 A
(30..37)252 1866 A
(set)126 2160 A
(foreground)420 2328 A
(color,)252 2790 A
(40..47)252 3084 A
(set)126 3378 A
(background)420 3546 A
(color\))252 4008 A
8418 V
EP
%%Page: 193 193
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1978(File:)S
2211(src/kernel/console.c)S
12 B
(193)180 4248 A
900 V
7 LST
(14005)210 648 A
1068(*)S
(ESC)126 1236 A
1404(M)S
(scrolls)294 1488 A
(the)126 1824 A
(screen)252 1992 A
(backwards)378 2286 A
2706(if)S
(the)126 2832 A
(cursor)252 3000 A
3294(is)S
3420(on)S
(the)126 3546 A
(top)126 3714 A
(line)168 3882 A
990 V
(14006)210 648 A
1068(*/)S
1080 V
(14007)210 648 A
1170 V
(14008)210 648 A
(switch)252 1110 A
(\(cons->c_esc_state\))798 1404 A
2244({)S
1260 V
(14009)210 648 A
(case)168 1194 A
1404(1:)S
2370(/*)S
(ESC)126 2496 A
(seen)168 2664 A
2874(*/)S
1350 V
(14010)210 648 A
(cons->c_esc_intro)714 1362 A
2118(=)S
('\\0';)210 2202 A
1440 V
(14011)210 648 A
(cons->c_esc_parmp)714 1362 A
2118(=)S
(cons->c_esc_parmv;)756 2202 A
1530 V
(14012)210 648 A
(cons->c_esc_parmv[0])840 1362 A
2244(=)S
(cons->c_esc_parmv[1])840 2328 A
3210(=)S
3294(0;)S
1620 V
(14013)210 648 A
(switch)252 1362 A
(\(c\))126 1656 A
1824({)S
1710 V
(14014)210 648 A
(case)168 1530 A
('[':)168 1740 A
2034(/*)S
(Control)294 2160 A
(Sequence)336 2496 A
(Introducer)420 2874 A
3336(*/)S
1800 V
(14015)210 648 A
(cons->c_esc_intro)714 1698 A
2454(=)S
2538(c;)S
1890 V
(14016)210 648 A
(cons->c_esc_state)714 1698 A
2454(=)S
2538(2;)S
1980 V
(14017)210 648 A
(break;)252 1698 A
2070 V
(14018)210 648 A
(case)168 1530 A
('M':)168 1740 A
2034(/*)S
(Reverse)294 2160 A
(Index)210 2496 A
2748(*/)S
2160 V
(14019)210 648 A
(do_escape\(cons,)630 1698 A
(c\);)126 2370 A
2250 V
(14020)210 648 A
(break;)252 1698 A
2340 V
(14021)210 648 A
(default:)336 1530 A
2430 V
(14022)210 648 A
(cons->c_esc_state)714 1698 A
2454(=)S
2538(0;)S
2520 V
(14023)210 648 A
1362(})S
2610 V
(14024)210 648 A
(break;)252 1362 A
2700 V
(14025)210 648 A
2790 V
(14026)210 648 A
(case)168 1194 A
1404(2:)S
2370(/*)S
(ESC)126 2496 A
2664([)S
(seen)168 2748 A
2958(*/)S
2880 V
(14027)210 648 A
1362(if)S
1488(\(c)S
1614(>=)S
('0')126 1740 A
1908(&&)S
2034(c)S
2118(<=)S
('9'\))168 2244 A
2454({)S
2970 V
(14028)210 648 A
1698(if)S
(\(cons->c_esc_parmp)756 1824 A
2622(<)S
(bufend\(cons->c_esc_parmv\)\))1092 2706 A
3060 V
(14029)210 648 A
(*cons->c_esc_parmp)756 2034 A
2832(=)S
(*cons->c_esc_parmp)756 2916 A
3714(*)S
3798(10)S
3924(+)S
(\(c-'0'\);)336 4008 A
3150 V
(14030)210 648 A
1362(})S
(else)168 1446 A
3240 V
(14031)210 648 A
1362(if)S
1488(\(c)S
1614(==)S
(';'\))168 1740 A
1950({)S
3330 V
(14032)210 648 A
1698(if)S
(\(++cons->c_esc_parmp)840 1824 A
2706(<)S
(bufend\(cons->c_esc_parmv\)\))1092 2790 A
3420 V
(14033)210 648 A
(*cons->c_esc_parmp)756 2034 A
2832(=)S
2916(0;)S
3510 V
(14034)210 648 A
1362(})S
(else)168 1446 A
1656({)S
3600 V
(14035)210 648 A
(do_escape\(cons,)630 1698 A
(c\);)126 2370 A
3690 V
(14036)210 648 A
1362(})S
3780 V
(14037)210 648 A
(break;)252 1362 A
3870 V
(14038)210 648 A
1110(})S
3960 V
(14039)210 648 A
1026(})S
4230 V
(14042)210 648 A
(/*===========================================================================*)3276 1026 A
4320 V
(14043)210 648 A
1068(*)S
(do_escape)378 2370 A
4260(*)S
4410 V
(14044)210 648 A
(*===========================================================================*/)3276 1068 A
4500 V
(14045)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(do_escape\(cons,)630 1572 A
2244(c\))S
4590 V
(14046)210 648 A
(register)336 1026 A
(console_t)378 1404 A
(*cons;)252 1824 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(console)294 2958 A
(struct)252 3294 A
3588(*/)S
4680 V
(14047)210 648 A
(char)168 1026 A
1236(c;)S
2370(/*)S
(next)168 2496 A
(character)378 2706 A
3126(in)S
(escape)252 3252 A
(sequence)336 3546 A
3924(*/)S
4770 V
(14048)210 648 A
1026({)S
4860 V
(14049)210 648 A
(int)126 1110 A
(value,)252 1278 A
1572(n;)S
4950 V
(14050)210 648 A
(unsigned)336 1110 A
(src,)168 1488 A
(dst,)168 1698 A
(count;)252 1908 A
5040 V
(14051)210 648 A
5130 V
(14052)210 648 A
1110(/*)S
(Some)168 1236 A
1446(of)S
(these)210 1572 A
(things)252 1824 A
(hack)168 2118 A
2328(on)S
(screen)252 2454 A
(RAM,)168 2748 A
2958(so)S
3084(it)S
(had)126 3210 A
(better)252 3378 A
3672(be)S
3798(up)S
3924(to)S
(date)168 4050 A
4260(*/)S
5220 V
(14053)210 648 A
(flush\(cons\);)504 1110 A
5310 V
(14054)210 648 A
5400 V
(14055)210 648 A
1110(if)S
(\(cons->c_esc_intro)756 1236 A
2034(==)S
('\\0'\))210 2160 A
2412({)S
5490 V
(14056)210 648 A
1362(/*)S
(Handle)252 1488 A
1782(a)S
(sequence)336 1866 A
(beginning)378 2244 A
(with)168 2664 A
(just)168 2874 A
(ESC)126 3084 A
3252(*/)S
5580 V
(14057)210 648 A
(switch)252 1362 A
(\(c\))126 1656 A
1824({)S
5670 V
(14058)210 648 A
(case)168 1530 A
('M':)168 1740 A
2370(/*)S
(Reverse)294 2496 A
(Index)210 2832 A
3084(*/)S
5760 V
(14059)210 648 A
1698(if)S
(\(cons->c_row)504 1824 A
2370(==)S
2496(0\))S
2622({)S
5850 V
(14060)210 648 A
(scroll_screen\(cons,)798 2034 A
(SCROLL_DOWN\);)546 2874 A
5940 V
(14061)210 648 A
1698(})S
(else)168 1782 A
1992({)S
6030 V
(14062)210 648 A
(cons->c_row--;)588 2034 A
6120 V
(14063)210 648 A
1698(})S
6210 V
(14064)210 648 A
(flush\(cons\);)504 1698 A
8418 V
EP
%%Page: 194 194
BP
/slant 0 def
/height 0 def
630 V
12 B
(194)180 648 A
11 R
1978(File:)S
2211(src/kernel/console.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(14065)210 648 A
(break;)252 1698 A
990 V
(14066)210 648 A
1080 V
(14067)210 648 A
(default:)336 1530 A
(break;)252 1908 A
1170 V
(14068)210 648 A
1362(})S
1260 V
(14069)210 648 A
1110(})S
(else)168 1194 A
1350 V
(14070)210 648 A
1110(if)S
(\(cons->c_esc_intro)756 1236 A
2034(==)S
('['\))168 2160 A
2370({)S
1440 V
(14071)210 648 A
1362(/*)S
(Handle)252 1488 A
1782(a)S
(sequence)336 1866 A
(beginning)378 2244 A
(with)168 2664 A
(ESC)126 2874 A
3042([)S
(and)126 3126 A
(parameters)420 3294 A
3756(*/)S
1530 V
(14072)210 648 A
(value)210 1362 A
1614(=)S
(cons->c_esc_parmv[0];)882 1698 A
1620 V
(14073)210 648 A
(switch)252 1362 A
(\(c\))126 1656 A
1824({)S
1710 V
(14074)210 648 A
(case)168 1530 A
('A':)168 1740 A
2370(/*)S
(ESC)126 2496 A
([nA)126 2664 A
(moves)210 2832 A
3084(up)S
3210(n)S
(lines)210 3294 A
3546(*/)S
1800 V
(14075)210 648 A
1698(n)S
1782(=)S
(\(value)252 1866 A
2160(==)S
2286(0)S
2370(?)S
2454(1)S
2538(:)S
(value\);)294 2622 A
1890 V
(14076)210 648 A
(cons->c_row)462 1698 A
2202(-=)S
2328(n;)S
1980 V
(14077)210 648 A
(flush\(cons\);)504 1698 A
2070 V
(14078)210 648 A
(break;)252 1698 A
2160 V
(14079)210 648 A
2250 V
(14080)210 648 A
(case)168 1530 A
('B':)168 1740 A
2370(/*)S
(ESC)126 2496 A
([nB)126 2664 A
(moves)210 2832 A
(down)168 3084 A
3294(n)S
(lines)210 3378 A
3630(*/)S
2340 V
(14081)210 648 A
1698(n)S
1782(=)S
(\(value)252 1866 A
2160(==)S
2286(0)S
2370(?)S
2454(1)S
2538(:)S
(value\);)294 2622 A
2430 V
(14082)210 648 A
(cons->c_row)462 1698 A
2202(+=)S
2328(n;)S
2520 V
(14083)210 648 A
(flush\(cons\);)504 1698 A
2610 V
(14084)210 648 A
(break;)252 1698 A
2700 V
(14085)210 648 A
2790 V
(14086)210 648 A
(case)168 1530 A
('C':)168 1740 A
2370(/*)S
(ESC)126 2496 A
([nC)126 2664 A
(moves)210 2832 A
(right)210 3084 A
3336(n)S
(spaces)252 3420 A
3714(*/)S
2880 V
(14087)210 648 A
1698(n)S
1782(=)S
(\(value)252 1866 A
2160(==)S
2286(0)S
2370(?)S
2454(1)S
2538(:)S
(value\);)294 2622 A
2970 V
(14088)210 648 A
(cons->c_column)588 1698 A
2328(+=)S
2454(n;)S
3060 V
(14089)210 648 A
(flush\(cons\);)504 1698 A
3150 V
(14090)210 648 A
(break;)252 1698 A
3240 V
(14091)210 648 A
3330 V
(14092)210 648 A
(case)168 1530 A
('D':)168 1740 A
2370(/*)S
(ESC)126 2496 A
([nD)126 2664 A
(moves)210 2832 A
(left)168 3084 A
3294(n)S
(spaces)252 3378 A
3672(*/)S
3420 V
(14093)210 648 A
1698(n)S
1782(=)S
(\(value)252 1866 A
2160(==)S
2286(0)S
2370(?)S
2454(1)S
2538(:)S
(value\);)294 2622 A
3510 V
(14094)210 648 A
(cons->c_column)588 1698 A
2328(-=)S
2454(n;)S
3600 V
(14095)210 648 A
(flush\(cons\);)504 1698 A
3690 V
(14096)210 648 A
(break;)252 1698 A
3780 V
(14097)210 648 A
3870 V
(14098)210 648 A
(case)168 1530 A
('H':)168 1740 A
2370(/*)S
(ESC)126 2496 A
([m;nH")252 2664 A
(moves)210 2958 A
(cursor)252 3210 A
3504(to)S
(\(m,n\))210 3630 A
3882(*/)S
3960 V
(14099)210 648 A
(cons->c_row)462 1698 A
2202(=)S
(cons->c_esc_parmv[0])840 2286 A
3168(-)S
3252(1;)S
4050 V
(14100)210 648 A
(cons->c_column)588 1698 A
2328(=)S
(cons->c_esc_parmv[1])840 2412 A
3294(-)S
3378(1;)S
4140 V
(14101)210 648 A
(flush\(cons\);)504 1698 A
4230 V
(14102)210 648 A
(break;)252 1698 A
4320 V
(14103)210 648 A
4410 V
(14104)210 648 A
(case)168 1530 A
('J':)168 1740 A
2370(/*)S
(ESC)126 2496 A
([sJ)126 2664 A
(clears)252 2832 A
3126(in)S
(display)294 3252 A
3588(*/)S
4500 V
(14105)210 648 A
(switch)252 1698 A
(\(value\))294 1992 A
2328({)S
4590 V
(14106)210 648 A
(case)168 1866 A
2076(0:)S
2370(/*)S
(Clear)210 2496 A
(from)168 2748 A
(cursor)252 2958 A
3252(to)S
(end)126 3378 A
3546(of)S
(screen)252 3672 A
3966(*/)S
4680 V
(14107)210 648 A
(count)210 2034 A
2286(=)S
(scr_size)336 2370 A
2748(-)S
(\(cons->c_cur)504 2832 A
3378(-)S
(cons->c_org\);)546 3462 A
4770 V
(14108)210 648 A
(dst)126 2034 A
2202(=)S
(cons->c_cur;)504 2286 A
4860 V
(14109)210 648 A
(break;)252 2034 A
4950 V
(14110)210 648 A
(case)168 1866 A
2076(1:)S
2370(/*)S
(Clear)210 2496 A
(from)168 2748 A
(start)210 2958 A
3210(of)S
(screen)252 3336 A
3630(to)S
(cursor)252 3756 A
4050(*/)S
5040 V
(14111)210 648 A
(count)210 2034 A
2286(=)S
(cons->c_cur)462 2370 A
2874(-)S
(cons->c_org;)504 2958 A
5130 V
(14112)210 648 A
(dst)126 2034 A
2202(=)S
(cons->c_org;)504 2286 A
5220 V
(14113)210 648 A
(break;)252 2034 A
5310 V
(14114)210 648 A
(case)168 1866 A
2076(2:)S
2370(/*)S
(Clear)210 2496 A
(entire)252 2748 A
(screen)252 3042 A
3336(*/)S
5400 V
(14115)210 648 A
(count)210 2034 A
2286(=)S
(scr_size;)378 2370 A
5490 V
(14116)210 648 A
(dst)126 2034 A
2202(=)S
(cons->c_org;)504 2286 A
5580 V
(14117)210 648 A
(break;)252 2034 A
5670 V
(14118)210 648 A
(default:)336 1866 A
2370(/*)S
2496(Do)S
(nothing)294 2622 A
2958(*/)S
5760 V
(14119)210 648 A
(count)210 2034 A
2286(=)S
2370(0;)S
5850 V
(14120)210 648 A
(dst)126 2034 A
2202(=)S
(cons->c_org;)504 2286 A
5940 V
(14121)210 648 A
1698(})S
6030 V
(14122)210 648 A
(blank_color)462 1698 A
2202(=)S
(cons->c_blank;)588 2286 A
6120 V
(14123)210 648 A
(mem_vid_copy\(BLANK_MEM,)966 1698 A
(dst,)168 2706 A
(count\);)294 2916 A
6210 V
(14124)210 648 A
(break;)252 1698 A
8418 V
EP
%%Page: 195 195
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1978(File:)S
2211(src/kernel/console.c)S
12 B
(195)180 4248 A
900 V
7 LST
(14125)210 648 A
990 V
(14126)210 648 A
(case)168 1530 A
('K':)168 1740 A
2370(/*)S
(ESC)126 2496 A
([sK)126 2664 A
(clears)252 2832 A
(line)168 3126 A
(from)168 3336 A
(cursor)252 3546 A
3840(*/)S
1080 V
(14127)210 648 A
(switch)252 1698 A
(\(value\))294 1992 A
2328({)S
1170 V
(14128)210 648 A
(case)168 1866 A
2076(0:)S
2370(/*)S
(Clear)210 2496 A
(from)168 2748 A
(cursor)252 2958 A
3252(to)S
(end)126 3378 A
3546(of)S
(line)168 3672 A
3882(*/)S
1260 V
(14129)210 648 A
(count)210 2034 A
2286(=)S
(scr_width)378 2370 A
2790(-)S
(cons->c_column;)630 2874 A
1350 V
(14130)210 648 A
(dst)126 2034 A
2202(=)S
(cons->c_cur;)504 2286 A
1440 V
(14131)210 648 A
(break;)252 2034 A
1530 V
(14132)210 648 A
(case)168 1866 A
2076(1:)S
2370(/*)S
(Clear)210 2496 A
(from)168 2748 A
(beginning)378 2958 A
3378(of)S
(line)168 3504 A
3714(to)S
(cursor)252 3840 A
4134(*/)S
1620 V
(14133)210 648 A
(count)210 2034 A
2286(=)S
(cons->c_column;)630 2370 A
1710 V
(14134)210 648 A
(dst)126 2034 A
2202(=)S
(cons->c_cur)462 2286 A
2790(-)S
(cons->c_column;)630 2874 A
1800 V
(14135)210 648 A
(break;)252 2034 A
1890 V
(14136)210 648 A
(case)168 1866 A
2076(2:)S
2370(/*)S
(Clear)210 2496 A
(entire)252 2748 A
(line)168 3042 A
3252(*/)S
1980 V
(14137)210 648 A
(count)210 2034 A
2286(=)S
(scr_width;)420 2370 A
2070 V
(14138)210 648 A
(dst)126 2034 A
2202(=)S
(cons->c_cur)462 2286 A
2790(-)S
(cons->c_column;)630 2874 A
2160 V
(14139)210 648 A
(break;)252 2034 A
2250 V
(14140)210 648 A
(default:)336 1866 A
2370(/*)S
2496(Do)S
(nothing)294 2622 A
2958(*/)S
2340 V
(14141)210 648 A
(count)210 2034 A
2286(=)S
2370(0;)S
2430 V
(14142)210 648 A
(dst)126 2034 A
2202(=)S
(cons->c_cur;)504 2286 A
2520 V
(14143)210 648 A
1698(})S
2610 V
(14144)210 648 A
(blank_color)462 1698 A
2202(=)S
(cons->c_blank;)588 2286 A
2700 V
(14145)210 648 A
(mem_vid_copy\(BLANK_MEM,)966 1698 A
(dst,)168 2706 A
(count\);)294 2916 A
2790 V
(14146)210 648 A
(break;)252 1698 A
2880 V
(14147)210 648 A
2970 V
(14148)210 648 A
(case)168 1530 A
('L':)168 1740 A
2370(/*)S
(ESC)126 2496 A
([nL)126 2664 A
(inserts)294 2832 A
3168(n)S
(lines)210 3252 A
3504(at)S
(cursor)252 3630 A
3924(*/)S
3060 V
(14149)210 648 A
1698(n)S
1782(=)S
(value;)252 1866 A
3150 V
(14150)210 648 A
1698(if)S
1824(\(n)S
1950(<)S
2034(1\))S
2160(n)S
2244(=)S
2328(1;)S
3240 V
(14151)210 648 A
1698(if)S
1824(\(n)S
1950(>)S
(\(scr_lines)420 2034 A
2496(-)S
(cons->c_row\)\))546 2580 A
3330 V
(14152)210 648 A
2034(n)S
2118(=)S
(scr_lines)378 2202 A
2622(-)S
(cons->c_row;)504 2706 A
3420 V
(14153)210 648 A
3510 V
(14154)210 648 A
(src)126 1698 A
1866(=)S
(cons->c_org)462 1950 A
2454(+)S
(cons->c_row)462 2538 A
3042(*)S
(scr_width;)420 3126 A
3600 V
(14155)210 648 A
(dst)126 1698 A
1866(=)S
(src)126 1950 A
2118(+)S
2202(n)S
2286(*)S
(scr_width;)420 2370 A
3690 V
(14156)210 648 A
(count)210 1698 A
1950(=)S
(\(scr_lines)420 2034 A
2496(-)S
(cons->c_row)462 2580 A
3084(-)S
3168(n\))S
3294(*)S
(scr_width;)420 3378 A
3780 V
(14157)210 648 A
(vid_vid_copy\(src,)714 1698 A
(dst,)168 2454 A
(count\);)294 2664 A
3870 V
(14158)210 648 A
(blank_color)462 1698 A
2202(=)S
(cons->c_blank;)588 2286 A
3960 V
(14159)210 648 A
(mem_vid_copy\(BLANK_MEM,)966 1698 A
(src,)168 2706 A
2916(n)S
3000(*)S
(scr_width\);)462 3084 A
4050 V
(14160)210 648 A
(break;)252 1698 A
4140 V
(14161)210 648 A
4230 V
(14162)210 648 A
(case)168 1530 A
('M':)168 1740 A
2370(/*)S
(ESC)126 2496 A
([nM)126 2664 A
(deletes)294 2832 A
3168(n)S
(lines)210 3252 A
3504(at)S
(cursor)252 3630 A
3924(*/)S
4320 V
(14163)210 648 A
1698(n)S
1782(=)S
(value;)252 1866 A
4410 V
(14164)210 648 A
1698(if)S
1824(\(n)S
1950(<)S
2034(1\))S
2160(n)S
2244(=)S
2328(1;)S
4500 V
(14165)210 648 A
1698(if)S
1824(\(n)S
1950(>)S
(\(scr_lines)420 2034 A
2496(-)S
(cons->c_row\)\))546 2580 A
4590 V
(14166)210 648 A
2034(n)S
2118(=)S
(scr_lines)378 2202 A
2622(-)S
(cons->c_row;)504 2706 A
4680 V
(14167)210 648 A
4770 V
(14168)210 648 A
(dst)126 1698 A
1866(=)S
(cons->c_org)462 1950 A
2454(+)S
(cons->c_row)462 2538 A
3042(*)S
(scr_width;)420 3126 A
4860 V
(14169)210 648 A
(src)126 1698 A
1866(=)S
(dst)126 1950 A
2118(+)S
2202(n)S
2286(*)S
(scr_width;)420 2370 A
4950 V
(14170)210 648 A
(count)210 1698 A
1950(=)S
(\(scr_lines)420 2034 A
2496(-)S
(cons->c_row)462 2580 A
3084(-)S
3168(n\))S
3294(*)S
(scr_width;)420 3378 A
5040 V
(14171)210 648 A
(vid_vid_copy\(src,)714 1698 A
(dst,)168 2454 A
(count\);)294 2664 A
5130 V
(14172)210 648 A
(blank_color)462 1698 A
2202(=)S
(cons->c_blank;)588 2286 A
5220 V
(14173)210 648 A
(mem_vid_copy\(BLANK_MEM,)966 1698 A
(dst)126 2706 A
2874(+)S
(count,)252 2958 A
3252(n)S
3336(*)S
(scr_width\);)462 3420 A
5310 V
(14174)210 648 A
(break;)252 1698 A
5400 V
(14175)210 648 A
5490 V
(14176)210 648 A
(case)168 1530 A
('@':)168 1740 A
2370(/*)S
(ESC)126 2496 A
([n@)126 2664 A
(inserts)294 2832 A
3168(n)S
(chars)210 3252 A
3504(at)S
(cursor)252 3630 A
3924(*/)S
5580 V
(14177)210 648 A
1698(n)S
1782(=)S
(value;)252 1866 A
5670 V
(14178)210 648 A
1698(if)S
1824(\(n)S
1950(<)S
2034(1\))S
2160(n)S
2244(=)S
2328(1;)S
5760 V
(14179)210 648 A
1698(if)S
1824(\(n)S
1950(>)S
(\(scr_width)420 2034 A
2496(-)S
(cons->c_column\)\))672 2580 A
5850 V
(14180)210 648 A
2034(n)S
2118(=)S
(scr_width)378 2202 A
2622(-)S
(cons->c_column;)630 2706 A
5940 V
(14181)210 648 A
6030 V
(14182)210 648 A
(src)126 1698 A
1866(=)S
(cons->c_cur;)504 1950 A
6120 V
(14183)210 648 A
(dst)126 1698 A
1866(=)S
(src)126 1950 A
2118(+)S
2202(n;)S
6210 V
(14184)210 648 A
(count)210 1698 A
1950(=)S
(scr_width)378 2034 A
2454(-)S
(cons->c_column)588 2538 A
3168(-)S
3252(n;)S
8418 V
EP
%%Page: 196 196
BP
/slant 0 def
/height 0 def
630 V
12 B
(196)180 648 A
11 R
1978(File:)S
2211(src/kernel/console.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(14185)210 648 A
(vid_vid_copy\(src,)714 1698 A
(dst,)168 2454 A
(count\);)294 2664 A
990 V
(14186)210 648 A
(blank_color)462 1698 A
2202(=)S
(cons->c_blank;)588 2286 A
1080 V
(14187)210 648 A
(mem_vid_copy\(BLANK_MEM,)966 1698 A
(src,)168 2706 A
(n\);)126 2916 A
1170 V
(14188)210 648 A
(break;)252 1698 A
1260 V
(14189)210 648 A
1350 V
(14190)210 648 A
(case)168 1530 A
('P':)168 1740 A
2370(/*)S
(ESC)126 2496 A
([nP)126 2664 A
(deletes)294 2832 A
3168(n)S
(chars)210 3252 A
3504(at)S
(cursor)252 3630 A
3924(*/)S
1440 V
(14191)210 648 A
1698(n)S
1782(=)S
(value;)252 1866 A
1530 V
(14192)210 648 A
1698(if)S
1824(\(n)S
1950(<)S
2034(1\))S
2160(n)S
2244(=)S
2328(1;)S
1620 V
(14193)210 648 A
1698(if)S
1824(\(n)S
1950(>)S
(\(scr_width)420 2034 A
2496(-)S
(cons->c_column\)\))672 2580 A
1710 V
(14194)210 648 A
2034(n)S
2118(=)S
(scr_width)378 2202 A
2622(-)S
(cons->c_column;)630 2706 A
1800 V
(14195)210 648 A
1890 V
(14196)210 648 A
(dst)126 1698 A
1866(=)S
(cons->c_cur;)504 1950 A
1980 V
(14197)210 648 A
(src)126 1698 A
1866(=)S
(dst)126 1950 A
2118(+)S
2202(n;)S
2070 V
(14198)210 648 A
(count)210 1698 A
1950(=)S
(scr_width)378 2034 A
2454(-)S
(cons->c_column)588 2538 A
3168(-)S
3252(n;)S
2160 V
(14199)210 648 A
(vid_vid_copy\(src,)714 1698 A
(dst,)168 2454 A
(count\);)294 2664 A
2250 V
(14200)210 648 A
(blank_color)462 1698 A
2202(=)S
(cons->c_blank;)588 2286 A
2340 V
(14201)210 648 A
(mem_vid_copy\(BLANK_MEM,)966 1698 A
(dst)126 2706 A
2874(+)S
(count,)252 2958 A
(n\);)126 3252 A
2430 V
(14202)210 648 A
(break;)252 1698 A
2520 V
(14203)210 648 A
2610 V
(14204)210 648 A
(case)168 1530 A
('m':)168 1740 A
2370(/*)S
(ESC)126 2496 A
([nm)126 2664 A
(enables)294 2832 A
(rendition)378 3168 A
3588(n)S
3672(*/)S
2700 V
(14205)210 648 A
(switch)252 1698 A
(\(value\))294 1992 A
2328({)S
2790 V
(14206)210 648 A
(case)168 1866 A
2076(1:)S
2370(/*)S
(BOLD)168 2496 A
2748(*/)S
2880 V
(14207)210 648 A
2034(if)S
(\(color\))294 2160 A
2496({)S
2970 V
(14208)210 648 A
2370(/*)S
(Can't)210 2496 A
2748(do)S
(bold,)210 2874 A
3126(so)S
(use)126 3252 A
(yellow)252 3420 A
3714(*/)S
3060 V
(14209)210 648 A
(cons->c_attr)504 2370 A
2916(=)S
(\(cons->c_attr)546 3000 A
3588(&)S
(0xf0ff\))294 3672 A
4008(|)S
(0x0E00;)294 4092 A
3150 V
(14210)210 648 A
2034(})S
(else)168 2118 A
2328({)S
3240 V
(14211)210 648 A
2370(/*)S
(Set)126 2496 A
(intensity)378 2664 A
(bit)126 3084 A
3252(*/)S
3330 V
(14212)210 648 A
(cons->c_attr)504 2370 A
2916(|=)S
(0x0800;)294 3042 A
3420 V
(14213)210 648 A
2034(})S
3510 V
(14214)210 648 A
(break;)252 2034 A
3600 V
(14215)210 648 A
3690 V
(14216)210 648 A
(case)168 1866 A
2076(4:)S
2370(/*)S
(UNDERLINE)378 2496 A
2916(*/)S
3780 V
(14217)210 648 A
2034(if)S
(\(color\))294 2160 A
2496({)S
3870 V
(14218)210 648 A
2370(/*)S
(Use)126 2496 A
(light)210 2664 A
(green)210 2916 A
3168(*/)S
3960 V
(14219)210 648 A
(cons->c_attr)504 2370 A
2916(=)S
(\(cons->c_attr)546 3000 A
3588(&)S
(0xf0ff\))294 3672 A
4008(|)S
(0x0A00;)294 4092 A
4050 V
(14220)210 648 A
2034(})S
(else)168 2118 A
2328({)S
4140 V
(14221)210 648 A
(cons->c_attr)504 2370 A
2916(=)S
(\(cons->c_attr)546 3000 A
3588(&)S
(0x8900\);)336 3672 A
4230 V
(14222)210 648 A
2034(})S
4320 V
(14223)210 648 A
(break;)252 2034 A
4410 V
(14224)210 648 A
4500 V
(14225)210 648 A
(case)168 1866 A
2076(5:)S
2370(/*)S
(BLINKING)336 2496 A
2874(*/)S
4590 V
(14226)210 648 A
2034(if)S
(\(color\))294 2160 A
2496({)S
4680 V
(14227)210 648 A
2370(/*)S
(Use)126 2496 A
(magenta)294 2664 A
3000(*/)S
4770 V
(14228)210 648 A
(cons->c_attr)504 2370 A
2916(=)S
(\(cons->c_attr)546 3000 A
3588(&)S
(0xf0ff\))294 3672 A
4008(|)S
(0x0500;)294 4092 A
4860 V
(14229)210 648 A
2034(})S
(else)168 2118 A
2328({)S
4950 V
(14230)210 648 A
2370(/*)S
(Set)126 2496 A
(the)126 2664 A
(blink)210 2832 A
(bit)126 3084 A
3252(*/)S
5040 V
(14231)210 648 A
(cons->c_attr)504 2370 A
2916(|=)S
(0x8000;)294 3042 A
5130 V
(14232)210 648 A
2034(})S
5220 V
(14233)210 648 A
(break;)252 2034 A
5310 V
(14234)210 648 A
5400 V
(14235)210 648 A
(case)168 1866 A
2076(7:)S
2370(/*)S
(REVERSE)294 2496 A
2832(*/)S
5490 V
(14236)210 648 A
2034(if)S
(\(color\))294 2160 A
2496({)S
5580 V
(14237)210 648 A
2370(/*)S
(Swap)168 2496 A
2706(fg)S
(and)126 2832 A
3000(bg)S
(colors)252 3126 A
3420(*/)S
5670 V
(14238)210 648 A
(cons->c_attr)504 2370 A
2916(=)S
5760 V
(14239)210 648 A
(\(\(cons->c_attr)588 2706 A
3336(&)S
(0xf000\))294 3420 A
3756(>>)S
3882(4\))S
4008(|)S
5850 V
(14240)210 648 A
(\(\(cons->c_attr)588 2706 A
3336(&)S
(0x0f00\))294 3420 A
3756(<<)S
(4\);)126 3882 A
5940 V
(14241)210 648 A
2034(})S
(else)168 2118 A
6030 V
(14242)210 648 A
2034(if)S
(\(\(cons->c_attr)588 2160 A
2790(&)S
(0x7000\))294 2874 A
3210(==)S
3336(0\))S
3462({)S
6120 V
(14243)210 648 A
(cons->c_attr)504 2370 A
2916(=)S
(\(cons->c_attr)546 3000 A
3588(&)S
(0x8800\))294 3672 A
4008(|)S
(0x7000;)294 4092 A
6210 V
(14244)210 648 A
2034(})S
(else)168 2118 A
2328({)S
8418 V
EP
%%Page: 197 197
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1978(File:)S
2211(src/kernel/console.c)S
12 B
(197)180 4248 A
900 V
7 LST
(14245)210 648 A
(cons->c_attr)504 2370 A
2916(=)S
(\(cons->c_attr)546 3000 A
3588(&)S
(0x8800\))294 3672 A
4008(|)S
(0x0700;)294 4092 A
990 V
(14246)210 648 A
2034(})S
1080 V
(14247)210 648 A
(break;)252 2034 A
1170 V
(14248)210 648 A
1260 V
(14249)210 648 A
(default:)336 1866 A
2370(/*)S
(COLOR)210 2496 A
2748(*/)S
1350 V
(14250)210 648 A
2034(if)S
(\(30)126 2160 A
2328(<=)S
(value)210 2454 A
2706(&&)S
(value)210 2832 A
3084(<=)S
(37\))126 3210 A
3378({)S
1440 V
(14251)210 648 A
(cons->c_attr)504 2370 A
2916(=)S
1530 V
(14252)210 648 A
(\(cons->c_attr)546 2706 A
3294(&)S
(0xf0ff\))294 3378 A
3714(|)S
1620 V
(14253)210 648 A
(\(ansi_colors[\(value)798 2706 A
3546(-)S
(30\)])168 3630 A
3840(<<)S
(8\);)126 3966 A
1710 V
(14254)210 648 A
(cons->c_blank)546 2370 A
2958(=)S
1800 V
(14255)210 648 A
(\(cons->c_blank)588 2706 A
3336(&)S
(0xf0ff\))294 3420 A
3756(|)S
1890 V
(14256)210 648 A
(\(ansi_colors[\(value)798 2706 A
3546(-)S
(30\)])168 3630 A
3840(<<)S
(8\);)126 3966 A
1980 V
(14257)210 648 A
2034(})S
(else)168 2118 A
2070 V
(14258)210 648 A
2034(if)S
(\(40)126 2160 A
2328(<=)S
(value)210 2454 A
2706(&&)S
(value)210 2832 A
3084(<=)S
(47\))126 3210 A
3378({)S
2160 V
(14259)210 648 A
(cons->c_attr)504 2370 A
2916(=)S
2250 V
(14260)210 648 A
(\(cons->c_attr)546 2706 A
3294(&)S
(0x0fff\))294 3378 A
3714(|)S
2340 V
(14261)210 648 A
(\(ansi_colors[\(value)798 2706 A
3546(-)S
(40\)])168 3630 A
3840(<<)S
(12\);)168 3966 A
2430 V
(14262)210 648 A
(cons->c_blank)546 2370 A
2958(=)S
2520 V
(14263)210 648 A
(\(cons->c_blank)588 2706 A
3336(&)S
(0x0fff\))294 3420 A
3756(|)S
2610 V
(14264)210 648 A
(\(ansi_colors[\(value)798 2706 A
3546(-)S
(40\)])168 3630 A
3840(<<)S
(12\);)168 3966 A
2700 V
(14265)210 648 A
2034(})S
(else)168 2118 A
2328({)S
2790 V
(14266)210 648 A
(cons->c_attr)504 2370 A
2916(=)S
(cons->c_blank;)588 3000 A
2880 V
(14267)210 648 A
2034(})S
2970 V
(14268)210 648 A
(break;)252 2034 A
3060 V
(14269)210 648 A
1698(})S
3150 V
(14270)210 648 A
(break;)252 1698 A
3240 V
(14271)210 648 A
1362(})S
3330 V
(14272)210 648 A
1110(})S
3420 V
(14273)210 648 A
(cons->c_esc_state)714 1110 A
1866(=)S
1950(0;)S
3510 V
(14274)210 648 A
1026(})S
3780 V
(14277)210 648 A
(/*===========================================================================*)3276 1026 A
3870 V
(14278)210 648 A
1068(*)S
(set_6845)336 2370 A
4260(*)S
3960 V
(14279)210 648 A
(*===========================================================================*/)3276 1068 A
4050 V
(14280)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(set_6845\(reg,)546 1572 A
(val\))168 2160 A
4140 V
(14281)210 648 A
(int)126 1026 A
(reg;)168 1194 A
2370(/*)S
(which)210 2496 A
(register)336 2748 A
(pair)168 3126 A
3336(to)S
(set)126 3462 A
3630(*/)S
4230 V
(14282)210 648 A
(unsigned)336 1026 A
(val;)168 1404 A
2370(/*)S
(16-bit)252 2496 A
(value)210 2790 A
3042(to)S
(set)126 3168 A
3336(it)S
3462(to)S
3588(*/)S
4320 V
(14283)210 648 A
1026({)S
4410 V
(14284)210 648 A
1026(/*)S
(Set)126 1152 A
1320(a)S
(register)336 1404 A
(pair)168 1782 A
(inside)252 1992 A
(the)126 2286 A
(6845.)210 2454 A
4500 V
(14285)210 648 A
1068(*)S
(Registers)378 1152 A
(12-13)210 1572 A
(tell)168 1824 A
(the)126 2034 A
(6845)168 2202 A
(where)210 2412 A
2664(in)S
(video)210 2790 A
(ram)126 3042 A
3210(to)S
(start)210 3336 A
4590 V
(14286)210 648 A
1068(*)S
(Registers)378 1152 A
(14-15)210 1572 A
(tell)168 1824 A
(the)126 2034 A
(6845)168 2202 A
(where)210 2412 A
2664(to)S
(put)126 2790 A
(the)126 2958 A
(cursor)252 3126 A
4680 V
(14287)210 648 A
1068(*/)S
4770 V
(14288)210 648 A
(lock\(\);)294 1110 A
2370(/*)S
(try)126 2496 A
2664(to)S
(stop)168 2790 A
(h/w)126 3000 A
(loading)294 3168 A
(in-between)420 3504 A
(value)210 3966 A
4218(*/)S
4860 V
(14289)210 648 A
(out_byte\(vid_port)714 1110 A
1866(+)S
(INDEX,)252 1950 A
(reg\);)210 2244 A
3042(/*)S
(set)126 3168 A
(the)126 3336 A
(index)210 3504 A
(register)336 3756 A
4134(*/)S
4950 V
(14290)210 648 A
(out_byte\(vid_port)714 1110 A
1866(+)S
(DATA,)210 1950 A
(\(val>>8\))336 2202 A
2580(&)S
(BYTE\);)252 2664 A
3042(/*)S
(output)252 3168 A
(high)168 3462 A
(byte)168 3672 A
3882(*/)S
5040 V
(14291)210 648 A
(out_byte\(vid_port)714 1110 A
1866(+)S
(INDEX,)252 1950 A
(reg)126 2244 A
2412(+)S
(1\);)126 2496 A
3042(/*)S
(again)210 3168 A
3420(*/)S
5130 V
(14292)210 648 A
(out_byte\(vid_port)714 1110 A
1866(+)S
(DATA,)210 1950 A
(val&BYTE\);)420 2202 A
3042(/*)S
(output)252 3168 A
(low)126 3462 A
(byte)168 3630 A
3840(*/)S
5220 V
(14293)210 648 A
(unlock\(\);)378 1110 A
5310 V
(14294)210 648 A
1026(})S
5580 V
(14297)210 648 A
(/*===========================================================================*)3276 1026 A
5670 V
(14298)210 648 A
1068(*)S
(beep)168 2370 A
4260(*)S
5760 V
(14299)210 648 A
(*===========================================================================*/)3276 1068 A
5850 V
(14300)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(beep\(\))252 1572 A
5940 V
(14301)210 648 A
1026({)S
6030 V
(14302)210 648 A
1026(/*)S
(Making)252 1152 A
1446(a)S
(beeping)294 1530 A
(sound)210 1866 A
2118(on)S
(the)126 2244 A
(speaker)294 2412 A
(\(output)294 2748 A
(for)126 3084 A
(CRTL-G\).)336 3252 A
6120 V
(14303)210 648 A
1068(*)S
(This)168 1152 A
(routine)294 1362 A
(works)210 1698 A
1950(by)S
(turning)294 2076 A
2412(on)S
(the)126 2538 A
(bits)168 2706 A
2916(0)S
(and)126 3000 A
3168(1)S
3252(in)S
(port)168 3378 A
3588(B)S
3672(of)S
(the)126 3798 A
(8255)168 3966 A
6210 V
(14304)210 648 A
1068(*)S
(chip)168 1152 A
(that)168 1362 A
(drives)252 1572 A
(the)126 1866 A
(speaker.)336 2034 A
8418 V
EP
%%Page: 198 198
BP
/slant 0 def
/height 0 def
630 V
12 B
(198)180 648 A
11 R
1978(File:)S
2211(src/kernel/console.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(14305)210 648 A
1068(*/)S
990 V
(14306)210 648 A
1080 V
(14307)210 648 A
(message)294 1110 A
(mess;)210 1446 A
1170 V
(14308)210 648 A
1260 V
(14309)210 648 A
1110(if)S
(\(beeping\))378 1236 A
(return;)294 1656 A
1350 V
(14310)210 648 A
(out_byte\(TIMER_MODE,)840 1110 A
(0xB6\);)252 1992 A
2370(/*)S
(set)126 2496 A
2664(up)S
(timer)210 2790 A
(channel)294 3042 A
3378(2)S
(\(square)294 3462 A
(wave\))210 3798 A
4050(*/)S
1440 V
(14311)210 648 A
(out_byte\(TIMER2,)672 1110 A
(BEEP_FREQ)378 1824 A
2244(&)S
(BYTE\);)252 2328 A
2706(/*)S
(load)168 2832 A
(low-order)378 3042 A
(bits)168 3462 A
3672(of)S
(frequency)378 3798 A
4218(*/)S
1530 V
(14312)210 648 A
(out_byte\(TIMER2,)672 1110 A
(\(BEEP_FREQ)420 1824 A
2286(>>)S
2412(8\))S
2538(&)S
(BYTE\);)252 2622 A
3042(/*)S
(now)126 3168 A
(high-order)420 3336 A
(bits)168 3798 A
4008(*/)S
1620 V
(14313)210 648 A
(lock\(\);)294 1110 A
2370(/*)S
(guard)210 2496 A
(PORT_B)252 2748 A
(from)168 3042 A
(keyboard)336 3252 A
(intr)168 3630 A
(handler)294 3840 A
4176(*/)S
1710 V
(14314)210 648 A
(out_byte\(PORT_B,)672 1110 A
(in_byte\(PORT_B\))630 1824 A
2496(|)S
(3\);)126 2580 A
3042(/*)S
(turn)168 3168 A
3378(on)S
(beep)168 3504 A
(bits)168 3714 A
3924(*/)S
1800 V
(14315)210 648 A
(unlock\(\);)378 1110 A
1890 V
(14316)210 648 A
(beeping)294 1110 A
1446(=)S
(TRUE;)210 1530 A
1980 V
(14317)210 648 A
2070 V
(14318)210 648 A
(mess.m_type)462 1110 A
1614(=)S
(SET_ALARM;)420 1698 A
2160 V
(14319)210 648 A
(mess.CLOCK_PROC_NR)756 1110 A
1908(=)S
(TTY;)168 1992 A
2250 V
(14320)210 648 A
(mess.DELTA_TICKS)672 1110 A
1824(=)S
(B_TIME;)294 1908 A
2340 V
(14321)210 648 A
(mess.FUNC_TO_CALL)714 1110 A
1866(=)S
(\(sighandler_t\))588 1950 A
(stop_beep;)420 2580 A
2430 V
(14322)210 648 A
(sendrec\(CLOCK,)588 1110 A
(&mess\);)294 1740 A
2520 V
(14323)210 648 A
1026(})S
2790 V
(14326)210 648 A
(/*===========================================================================*)3276 1026 A
2880 V
(14327)210 648 A
1068(*)S
(stop_beep)378 2370 A
4260(*)S
2970 V
(14328)210 648 A
(*===========================================================================*/)3276 1068 A
3060 V
(14329)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(stop_beep\(\))462 1572 A
3150 V
(14330)210 648 A
1026({)S
3240 V
(14331)210 648 A
1026(/*)S
(Turn)168 1152 A
(off)126 1362 A
(the)126 1530 A
(beeper)252 1698 A
1992(by)S
(turning)294 2118 A
(off)126 2454 A
(bits)168 2622 A
2832(0)S
(and)126 2916 A
3084(1)S
3168(in)S
(PORT_B.)294 3294 A
3630(*/)S
3330 V
(14332)210 648 A
3420 V
(14333)210 648 A
(lock\(\);)294 1110 A
2370(/*)S
(guard)210 2496 A
(PORT_B)252 2748 A
(from)168 3042 A
(keyboard)336 3252 A
(intr)168 3630 A
(handler)294 3840 A
4176(*/)S
3510 V
(14334)210 648 A
(out_byte\(PORT_B,)672 1110 A
(in_byte\(PORT_B\))630 1824 A
2496(&)S
(\3043\);)168 2580 A
3600 V
(14335)210 648 A
(beeping)294 1110 A
1446(=)S
(FALSE;)252 1530 A
3690 V
(14336)210 648 A
(unlock\(\);)378 1110 A
3780 V
(14337)210 648 A
1026(})S
4050 V
(14340)210 648 A
(/*===========================================================================*)3276 1026 A
4140 V
(14341)210 648 A
1068(*)S
(scr_init)336 2370 A
4260(*)S
4230 V
(14342)210 648 A
(*===========================================================================*/)3276 1068 A
4320 V
(14343)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(scr_init\(tp\))504 1530 A
4410 V
(14344)210 648 A
(tty_t)210 1026 A
(*tp;)168 1278 A
4500 V
(14345)210 648 A
1026({)S
4590 V
(14346)210 648 A
1026(/*)S
(Initialize)420 1152 A
(the)126 1614 A
(screen)252 1782 A
(driver.)294 2076 A
2412(*/)S
4680 V
(14347)210 648 A
(console_t)378 1110 A
(*cons;)252 1530 A
4770 V
(14348)210 648 A
(phys_bytes)420 1110 A
(vid_base;)378 1572 A
4860 V
(14349)210 648 A
(u16_t)210 1110 A
(bios_crtbase;)546 1362 A
4950 V
(14350)210 648 A
(int)126 1110 A
(line;)210 1278 A
5040 V
(14351)210 648 A
(unsigned)336 1110 A
(page_size;)420 1488 A
5130 V
(14352)210 648 A
5220 V
(14353)210 648 A
1110(/*)S
(Associate)378 1236 A
(console)294 1656 A
(and)126 1992 A
(TTY.)168 2160 A
2370(*/)S
5310 V
(14354)210 648 A
(line)168 1110 A
1320(=)S
1404(tp)S
1530(-)S
(&tty_table[0];)588 1614 A
5400 V
(14355)210 648 A
1110(if)S
(\(line)210 1236 A
1488(>=)S
(nr_cons\))336 1614 A
(return;)294 1992 A
5490 V
(14356)210 648 A
(cons)168 1110 A
1320(=)S
(&cons_table[line];)756 1404 A
5580 V
(14357)210 648 A
(cons->c_tty)462 1110 A
1614(=)S
(tp;)126 1698 A
5670 V
(14358)210 648 A
(tp->tty_priv)504 1110 A
1656(=)S
(cons;)210 1740 A
5760 V
(14359)210 648 A
5850 V
(14360)210 648 A
1110(/*)S
(Initialize)420 1236 A
(the)126 1698 A
(keyboard)336 1866 A
(driver.)294 2244 A
2580(*/)S
5940 V
(14361)210 648 A
(kb_init\(tp\);)504 1110 A
6030 V
(14362)210 648 A
6120 V
(14363)210 648 A
1110(/*)S
(Output)252 1236 A
(functions.)420 1530 A
1992(*/)S
6210 V
(14364)210 648 A
(tp->tty_devwrite)672 1110 A
1824(=)S
(cons_write;)462 1908 A
8418 V
EP
%%Page: 199 199
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1978(File:)S
2211(src/kernel/console.c)S
12 B
(199)180 4248 A
900 V
7 LST
(14365)210 648 A
(tp->tty_echo)504 1110 A
1656(=)S
(cons_echo;)420 1740 A
990 V
(14366)210 648 A
1080 V
(14367)210 648 A
1110(/*)S
(Get)126 1236 A
(the)126 1404 A
(BIOS)168 1572 A
(parameters)420 1782 A
(that)168 2244 A
(tells)210 2454 A
(the)126 2706 A
(VDU)126 2874 A
(I/O)126 3042 A
(base)168 3210 A
(register.)378 3420 A
3840(*/)S
1170 V
(14368)210 648 A
(phys_copy\(0x463L,)714 1110 A
(vir2phys\(&bios_crtbase\),)1008 1866 A
(2L\);)168 2916 A
1260 V
(14369)210 648 A
1350 V
(14370)210 648 A
(vid_port)336 1110 A
1488(=)S
(bios_crtbase;)546 1572 A
1440 V
(14371)210 648 A
1530 V
(14372)210 648 A
1110(if)S
(\(color\))294 1236 A
1572({)S
1620 V
(14373)210 648 A
(vid_base)336 1362 A
1740(=)S
(COLOR_BASE;)462 1824 A
1710 V
(14374)210 648 A
(vid_size)336 1362 A
1740(=)S
(COLOR_SIZE;)462 1824 A
1800 V
(14375)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1890 V
(14376)210 648 A
(vid_base)336 1362 A
1740(=)S
(MONO_BASE;)420 1824 A
1980 V
(14377)210 648 A
(vid_size)336 1362 A
1740(=)S
(MONO_SIZE;)420 1824 A
2070 V
(14378)210 648 A
1110(})S
2160 V
(14379)210 648 A
1110(if)S
(\(ega\))210 1236 A
(vid_size)336 1488 A
1866(=)S
(EGA_SIZE;)378 1950 A
2370(/*)S
(for)126 2496 A
(both)168 2664 A
(EGA)126 2874 A
(and)126 3042 A
(VGA)126 3210 A
3378(*/)S
2250 V
(14380)210 648 A
(wrap)168 1110 A
1320(=)S
(!ega;)210 1404 A
2340 V
(14381)210 648 A
2430 V
(14382)210 648 A
(vid_seg)294 1110 A
1446(=)S
(protected_mode)588 1530 A
2160(?)S
(VIDEO_SELECTOR)588 2244 A
2874(:)S
(physb_to_hclick\(vid_base\);)1092 2958 A
2520 V
(14383)210 648 A
(init_dataseg\(&gdt[VIDEO_INDEX],)1302 1110 A
(vid_base,)378 2454 A
(\(phys_bytes\))504 2874 A
(vid_size,)378 3420 A
2610 V
(14384)210 648 A
(TASK_PRIVILEGE\);)672 3378 A
2700 V
(14385)210 648 A
(vid_size)336 1110 A
(>>=)126 1488 A
1656(1;)S
2370(/*)S
(word)168 2496 A
(count)210 2706 A
2958(*/)S
2790 V
(14386)210 648 A
(vid_mask)336 1110 A
1488(=)S
(vid_size)336 1572 A
1950(-)S
2034(1;)S
2880 V
(14387)210 648 A
2970 V
(14388)210 648 A
1110(/*)S
(There)210 1236 A
(can)126 1488 A
1656(be)S
1782(as)S
(many)168 1908 A
(consoles)336 2118 A
2496(as)S
(video)210 2622 A
(memory)252 2874 A
(allows.)294 3168 A
3504(*/)S
3060 V
(14389)210 648 A
(nr_cons)294 1110 A
1446(=)S
(vid_size)336 1530 A
1908(/)S
(scr_size;)378 1992 A
3150 V
(14390)210 648 A
1110(if)S
(\(nr_cons)336 1236 A
1614(>)S
(NR_CONS\))336 1698 A
(nr_cons)294 2076 A
2412(=)S
(NR_CONS;)336 2496 A
3240 V
(14391)210 648 A
1110(if)S
(\(nr_cons)336 1236 A
1614(>)S
1698(1\))S
(wrap)168 1824 A
2034(=)S
2118(0;)S
3330 V
(14392)210 648 A
(page_size)378 1110 A
1530(=)S
(vid_size)336 1614 A
1992(/)S
(nr_cons;)336 2076 A
3420 V
(14393)210 648 A
(cons->c_start)546 1110 A
1698(=)S
(line)168 1782 A
1992(*)S
(page_size;)420 2076 A
3510 V
(14394)210 648 A
(cons->c_limit)546 1110 A
1698(=)S
(cons->c_start)546 1782 A
2370(+)S
(page_size;)420 2454 A
3600 V
(14395)210 648 A
(cons->c_org)462 1110 A
1614(=)S
(cons->c_start;)588 1698 A
3690 V
(14396)210 648 A
(cons->c_attr)504 1110 A
1656(=)S
(cons->c_blank)546 1740 A
2328(=)S
(BLANK_COLOR;)504 2412 A
3780 V
(14397)210 648 A
3870 V
(14398)210 648 A
1110(/*)S
(Clear)210 1236 A
(the)126 1488 A
(screen.)294 1656 A
1992(*/)S
3960 V
(14399)210 648 A
(blank_color)462 1110 A
1614(=)S
(BLANK_COLOR;)504 1698 A
4050 V
(14400)210 648 A
(mem_vid_copy\(BLANK_MEM,)966 1110 A
(cons->c_start,)588 2118 A
(scr_size\);)420 2748 A
4140 V
(14401)210 648 A
(select_console\(0\);)756 1110 A
4230 V
(14402)210 648 A
1026(})S
4500 V
(14405)210 648 A
(/*===========================================================================*)3276 1026 A
4590 V
(14406)210 648 A
1068(*)S
(putk)168 2370 A
4260(*)S
4680 V
(14407)210 648 A
(*===========================================================================*/)3276 1068 A
4770 V
(14408)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(putk\(c\))294 1530 A
4860 V
(14409)210 648 A
(int)126 1026 A
1194(c;)S
2370(/*)S
(character)378 2496 A
2916(to)S
(print)210 3042 A
3294(*/)S
4950 V
(14410)210 648 A
1026({)S
5040 V
(14411)210 648 A
1026(/*)S
(This)168 1152 A
(procedure)378 1362 A
1782(is)S
(used)168 1908 A
2118(by)S
(the)126 2244 A
(version)294 2412 A
2748(of)S
(printf\(\))336 2874 A
(that)168 3252 A
3462(is)S
(linked)252 3588 A
(with)168 3882 A
5130 V
(14412)210 648 A
1068(*)S
(the)126 1152 A
(kernel)252 1320 A
(itself.)294 1614 A
(The)126 1992 A
(one)126 2160 A
2328(in)S
(the)126 2454 A
(library)294 2622 A
(sends)210 2958 A
3210(a)S
(message)294 3294 A
3630(to)S
(FS,)126 3756 A
(which)210 3924 A
4176(is)S
5220 V
(14413)210 648 A
1068(*)S
(not)126 1152 A
(what)168 1320 A
1530(is)S
(needed)252 1656 A
(for)126 1950 A
(printing)336 2118 A
(within)252 2496 A
(the)126 2790 A
(kernel.)294 2958 A
(This)168 3336 A
(version)294 3546 A
(just)168 3882 A
(queues)252 4092 A
5310 V
(14414)210 648 A
1068(*)S
(the)126 1152 A
(character)378 1320 A
(and)126 1740 A
(starts)252 1908 A
(the)126 2202 A
(output.)294 2370 A
5400 V
(14415)210 648 A
1068(*/)S
5490 V
(14416)210 648 A
5580 V
(14417)210 648 A
1110(if)S
1236(\(c)S
1362(!=)S
1488(0\))S
1614({)S
5670 V
(14418)210 648 A
1362(if)S
1488(\(c)S
1614(==)S
('\\n'\))210 1740 A
(putk\('\\r'\);)462 1992 A
5760 V
(14419)210 648 A
(out_char\(&cons_table[0],)1008 1362 A
(\(int\))210 2412 A
(c\);)126 2664 A
5850 V
(14420)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5940 V
(14421)210 648 A
(flush\(&cons_table[0]\);)924 1362 A
6030 V
(14422)210 648 A
1110(})S
6120 V
(14423)210 648 A
1026(})S
8418 V
EP
%%Page: 200 200
BP
/slant 0 def
/height 0 def
630 V
12 B
(200)180 648 A
11 R
1978(File:)S
2211(src/kernel/console.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(14426)210 648 A
(/*===========================================================================*)3276 1026 A
1080 V
(14427)210 648 A
1068(*)S
(toggle_scroll)546 2370 A
4260(*)S
1170 V
(14428)210 648 A
(*===========================================================================*/)3276 1068 A
1260 V
(14429)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(toggle_scroll\(\))630 1530 A
1350 V
(14430)210 648 A
1026({)S
1440 V
(14431)210 648 A
1026(/*)S
(Toggle)252 1152 A
(between)294 1446 A
(hardware)336 1782 A
(and)126 2160 A
(software)336 2328 A
(scroll.)294 2706 A
3042(*/)S
1530 V
(14432)210 648 A
1620 V
(14433)210 648 A
(cons_org0\(\);)504 1110 A
1710 V
(14434)210 648 A
(softscroll)420 1110 A
1572(=)S
(!softscroll;)504 1656 A
1800 V
(14435)210 648 A
(printf\("%sware)588 1110 A
(scrolling)378 1740 A
(enabled.\\n",)504 2160 A
(softscroll)420 2706 A
3168(?)S
("Soft")252 3252 A
3546(:)S
("Hard"\);)336 3630 A
1890 V
(14436)210 648 A
1026(})S
2160 V
(14439)210 648 A
(/*===========================================================================*)3276 1026 A
2250 V
(14440)210 648 A
1068(*)S
(cons_stop)378 2370 A
4260(*)S
2340 V
(14441)210 648 A
(*===========================================================================*/)3276 1068 A
2430 V
(14442)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(cons_stop\(\))462 1530 A
2520 V
(14443)210 648 A
1026({)S
2610 V
(14444)210 648 A
1026(/*)S
(Prepare)294 1152 A
(for)126 1488 A
(halt)168 1656 A
1866(or)S
(reboot.)294 1992 A
2328(*/)S
2700 V
(14445)210 648 A
2790 V
(14446)210 648 A
(cons_org0\(\);)504 1110 A
2880 V
(14447)210 648 A
(softscroll)420 1110 A
1572(=)S
1656(1;)S
2970 V
(14448)210 648 A
(select_console\(0\);)756 1110 A
3060 V
(14449)210 648 A
(cons_table[0].c_attr)840 1110 A
1992(=)S
(cons_table[0].c_blank)882 2076 A
3000(=)S
(BLANK_COLOR;)504 3084 A
3150 V
(14450)210 648 A
1026(})S
3420 V
(14453)210 648 A
(/*===========================================================================*)3276 1026 A
3510 V
(14454)210 648 A
1068(*)S
(cons_org0)378 2370 A
4260(*)S
3600 V
(14455)210 648 A
(*===========================================================================*/)3276 1068 A
3690 V
(14456)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(cons_org0\(\))462 1572 A
3780 V
(14457)210 648 A
1026({)S
3870 V
(14458)210 648 A
1026(/*)S
(Scroll)252 1152 A
(video)210 1446 A
(memory)252 1698 A
(back)168 1992 A
2202(to)S
(put)126 2328 A
(the)126 2496 A
(origin)252 2664 A
2958(at)S
3084(0.)S
3210(*/)S
3960 V
(14459)210 648 A
4050 V
(14460)210 648 A
(int)126 1110 A
(cons_line;)420 1278 A
4140 V
(14461)210 648 A
(console_t)378 1110 A
(*cons;)252 1530 A
4230 V
(14462)210 648 A
(unsigned)336 1110 A
1488(n;)S
4320 V
(14463)210 648 A
4410 V
(14464)210 648 A
(for)126 1110 A
(\(cons_line)420 1278 A
1740(=)S
1824(0;)S
(cons_line)378 1950 A
2370(<)S
(nr_cons;)336 2454 A
(cons_line++\))504 2832 A
3378({)S
4500 V
(14465)210 648 A
(cons)168 1362 A
1572(=)S
(&cons_table[cons_line];)966 1656 A
4590 V
(14466)210 648 A
(while)210 1362 A
(\(cons->c_org)504 1614 A
2160(>)S
(cons->c_start\))588 2244 A
2874({)S
4680 V
(14467)210 648 A
1698(n)S
1782(=)S
(vid_size)336 1866 A
2244(-)S
(scr_size;)378 2328 A
3042(/*)S
(amount)252 3168 A
3462(of)S
(unused)252 3588 A
(memory)252 3882 A
4176(*/)S
4770 V
(14468)210 648 A
1698(if)S
1824(\(n)S
1950(>)S
(cons->c_org)462 2034 A
2538(-)S
(cons->c_start\))588 2622 A
4860 V
(14469)210 648 A
2034(n)S
2118(=)S
(cons->c_org)462 2202 A
2706(-)S
(cons->c_start;)588 2790 A
4950 V
(14470)210 648 A
(vid_vid_copy\(cons->c_org,)1050 1698 A
(cons->c_org)462 2790 A
3294(-)S
3378(n,)S
(scr_size\);)420 3504 A
5040 V
(14471)210 648 A
(cons->c_org)462 1698 A
2202(-=)S
2328(n;)S
5130 V
(14472)210 648 A
1362(})S
5220 V
(14473)210 648 A
(flush\(cons\);)504 1362 A
5310 V
(14474)210 648 A
1110(})S
5400 V
(14475)210 648 A
(select_console\(current\);)1008 1110 A
5490 V
(14476)210 648 A
1026(})S
5760 V
(14479)210 648 A
(/*===========================================================================*)3276 1026 A
5850 V
(14480)210 648 A
1068(*)S
(select_console)588 2370 A
4260(*)S
5940 V
(14481)210 648 A
(*===========================================================================*/)3276 1068 A
6030 V
(14482)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(select_console\(int)756 1530 A
(cons_line\))420 2328 A
6120 V
(14483)210 648 A
1026({)S
6210 V
(14484)210 648 A
1026(/*)S
(Set)126 1152 A
(the)126 1320 A
(current)294 1488 A
(console)294 1824 A
2160(to)S
(console)294 2286 A
(number)252 2622 A
('cons_line'.)504 2916 A
3462(*/)S
8418 V
EP
%%Page: 201 201
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1978(File:)S
2211(src/kernel/console.c)S
12 B
(201)180 4248 A
900 V
7 LST
(14485)210 648 A
990 V
(14486)210 648 A
1110(if)S
(\(cons_line)420 1236 A
1698(<)S
1782(0)S
1866(||)S
(cons_line)378 1992 A
2412(>=)S
(nr_cons\))336 2538 A
(return;)294 2916 A
1080 V
(14487)210 648 A
(current)294 1110 A
1446(=)S
(cons_line;)420 1530 A
1170 V
(14488)210 648 A
(curcons)294 1110 A
1446(=)S
(&cons_table[cons_line];)966 1530 A
1260 V
(14489)210 648 A
(set_6845\(VID_ORG,)714 1110 A
(curcons->c_org\);)672 1866 A
1350 V
(14490)210 648 A
(set_6845\(CURSOR,)672 1110 A
(curcons->c_cur\);)672 1824 A
1440 V
(14491)210 648 A
1026(})S
1710 V
(14494)210 648 A
(/*===========================================================================*)3276 1026 A
1800 V
(14495)210 648 A
1068(*)S
(con_loadfont)504 2370 A
4260(*)S
1890 V
(14496)210 648 A
(*===========================================================================*/)3276 1068 A
1980 V
(14497)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(con_loadfont\(user_phys\))966 1488 A
2070 V
(14498)210 648 A
(phys_bytes)420 1026 A
(user_phys;)420 1488 A
2160 V
(14499)210 648 A
1026({)S
2250 V
(14500)210 648 A
1026(/*)S
(Load)168 1152 A
1362(a)S
(font)168 1446 A
(into)168 1656 A
(the)126 1866 A
(EGA)126 2034 A
2202(or)S
(VGA)126 2328 A
(adapter.)336 2496 A
2874(*/)S
2340 V
(14501)210 648 A
2430 V
(14502)210 648 A
(static)252 1110 A
(struct)252 1404 A
(sequence)336 1698 A
(seq1[7])294 2076 A
2412(=)S
2496({)S
2520 V
(14503)210 648 A
1362({)S
(GA_SEQUENCER_INDEX,)798 1446 A
(0x00,)210 2286 A
(0x01)168 2538 A
2748(},)S
2610 V
(14504)210 648 A
1362({)S
(GA_SEQUENCER_INDEX,)798 1446 A
(0x02,)210 2286 A
(0x04)168 2538 A
2748(},)S
2700 V
(14505)210 648 A
1362({)S
(GA_SEQUENCER_INDEX,)798 1446 A
(0x04,)210 2286 A
(0x07)168 2538 A
2748(},)S
2790 V
(14506)210 648 A
1362({)S
(GA_SEQUENCER_INDEX,)798 1446 A
(0x00,)210 2286 A
(0x03)168 2538 A
2748(},)S
2880 V
(14507)210 648 A
1362({)S
(GA_GRAPHICS_INDEX,)756 1446 A
(0x04,)210 2244 A
(0x02)168 2496 A
2706(},)S
2970 V
(14508)210 648 A
1362({)S
(GA_GRAPHICS_INDEX,)756 1446 A
(0x05,)210 2244 A
(0x00)168 2496 A
2706(},)S
3060 V
(14509)210 648 A
1362({)S
(GA_GRAPHICS_INDEX,)756 1446 A
(0x06,)210 2244 A
(0x00)168 2496 A
2706(},)S
3150 V
(14510)210 648 A
1110(};)S
3240 V
(14511)210 648 A
(static)252 1110 A
(struct)252 1404 A
(sequence)336 1698 A
(seq2[7])294 2076 A
2412(=)S
2496({)S
3330 V
(14512)210 648 A
1362({)S
(GA_SEQUENCER_INDEX,)798 1446 A
(0x00,)210 2286 A
(0x01)168 2538 A
2748(},)S
3420 V
(14513)210 648 A
1362({)S
(GA_SEQUENCER_INDEX,)798 1446 A
(0x02,)210 2286 A
(0x03)168 2538 A
2748(},)S
3510 V
(14514)210 648 A
1362({)S
(GA_SEQUENCER_INDEX,)798 1446 A
(0x04,)210 2286 A
(0x03)168 2538 A
2748(},)S
3600 V
(14515)210 648 A
1362({)S
(GA_SEQUENCER_INDEX,)798 1446 A
(0x00,)210 2286 A
(0x03)168 2538 A
2748(},)S
3690 V
(14516)210 648 A
1362({)S
(GA_GRAPHICS_INDEX,)756 1446 A
(0x04,)210 2244 A
(0x00)168 2496 A
2706(},)S
3780 V
(14517)210 648 A
1362({)S
(GA_GRAPHICS_INDEX,)756 1446 A
(0x05,)210 2244 A
(0x10)168 2496 A
2706(},)S
3870 V
(14518)210 648 A
1362({)S
(GA_GRAPHICS_INDEX,)756 1446 A
(0x06,)210 2244 A
2622(0)S
2706(},)S
3960 V
(14519)210 648 A
1110(};)S
4050 V
(14520)210 648 A
4140 V
(14521)210 648 A
(seq2[6].value=)588 1110 A
(color)210 1740 A
1992(?)S
(0x0E)168 2076 A
2286(:)S
(0x0A;)210 2370 A
4230 V
(14522)210 648 A
4320 V
(14523)210 648 A
1110(if)S
(\(!ega\))252 1236 A
(return\(ENOTTY\);)630 1530 A
4410 V
(14524)210 648 A
4500 V
(14525)210 648 A
(lock\(\);)294 1110 A
4590 V
(14526)210 648 A
(ga_program\(seq1\);)714 1110 A
2034(/*)S
(bring)210 2160 A
(font)168 2412 A
(memory)252 2622 A
(into)168 2916 A
(view)168 3126 A
3336(*/)S
4680 V
(14527)210 648 A
4770 V
(14528)210 648 A
(phys_copy\(user_phys,)840 1110 A
(\(phys_bytes\)GA_VIDEO_ADDRESS,)1218 1992 A
(\(phys_bytes\)GA_FONT_SIZE\);)1092 3252 A
4860 V
(14529)210 648 A
4950 V
(14530)210 648 A
(ga_program\(seq2\);)714 1110 A
2034(/*)S
(restore)294 2160 A
2496(*/)S
5040 V
(14531)210 648 A
(unlock\(\);)378 1110 A
5130 V
(14532)210 648 A
5220 V
(14533)210 648 A
(return\(OK\);)462 1110 A
5310 V
(14534)210 648 A
1026(})S
5580 V
(14537)210 648 A
(/*===========================================================================*)3276 1026 A
5670 V
(14538)210 648 A
1068(*)S
(ga_program)420 2370 A
4260(*)S
5760 V
(14539)210 648 A
(*===========================================================================*/)3276 1068 A
5850 V
(14540)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(ga_program\(seq\))630 1572 A
5940 V
(14541)210 648 A
(struct)252 1026 A
(sequence)336 1320 A
(*seq;)210 1698 A
6030 V
(14542)210 648 A
1026({)S
6120 V
(14543)210 648 A
1026(/*)S
(support)294 1152 A
(function)336 1488 A
(for)126 1866 A
(con_loadfont)504 2034 A
2580(*/)S
6210 V
(14544)210 648 A
8418 V
EP
%%Page: 202 202
BP
/slant 0 def
/height 0 def
630 V
12 B
(202)180 648 A
11 R
1978(File:)S
2211(src/kernel/console.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(14545)210 648 A
(int)126 1110 A
(len=)168 1278 A
1488(7;)S
990 V
(14546)210 648 A
1110(do)S
1236({)S
1080 V
(14547)210 648 A
(out_byte\(seq->index,)840 1362 A
(seq->port\);)462 2244 A
1170 V
(14548)210 648 A
(out_byte\(seq->index+1,)924 1362 A
(seq->value\);)504 2328 A
1260 V
(14549)210 648 A
(seq++;)252 1362 A
1350 V
(14550)210 648 A
1110(})S
(while)210 1194 A
(\(--len)252 1446 A
1740(>)S
(0\);)126 1824 A
1440 V
(14551)210 648 A
1026(})S
1890 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1980 V
(src/kernel/dmp.c)672 2034 A
2070 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2250 V
(14600)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(some)168 1950 A
(dumping)294 2160 A
(routines)336 2496 A
(for)126 2874 A
(debugging.)420 3042 A
3504(*/)S
2340 V
(14601)210 648 A
2430 V
(14602)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
2520 V
(14603)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
2610 V
(14604)210 648 A
(#include)336 1026 A
("proc.h")336 1404 A
2700 V
(14605)210 648 A
2790 V
(14606)210 648 A
(char)168 1026 A
(*vargv;)294 1236 A
2880 V
(14607)210 648 A
2970 V
(14608)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\(char)630 1362 A
(*proc_name,)462 2034 A
(\(int)168 2538 A
(proc_nr\)\);)420 2748 A
3060 V
(14609)210 648 A
3150 V
(14610)210 648 A
(/*===========================================================================*)3276 1026 A
3240 V
(14611)210 648 A
1068(*)S
(p_dmp)210 2370 A
4260(*)S
3330 V
(14612)210 648 A
(*===========================================================================*/)3276 1068 A
3420 V
(14613)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(p_dmp\(\))294 1530 A
3510 V
(14614)210 648 A
1026({)S
3600 V
(14615)210 648 A
1026(/*)S
(Proc)168 1152 A
(table)210 1362 A
(dump)168 1614 A
1824(*/)S
3690 V
(14616)210 648 A
3780 V
(14617)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
3870 V
(14618)210 648 A
(static)252 1110 A
(struct)252 1404 A
(proc)168 1698 A
(*oldrp)252 1908 A
2202(=)S
(BEG_PROC_ADDR;)588 2286 A
3960 V
(14619)210 648 A
(int)126 1110 A
1278(n)S
1362(=)S
1446(0;)S
4050 V
(14620)210 648 A
(phys_clicks)462 1110 A
(text,)210 1614 A
(data,)210 1866 A
(size;)210 2118 A
4140 V
(14621)210 648 A
(int)126 1110 A
(proc_nr;)336 1278 A
4230 V
(14622)210 648 A
4320 V
(14623)210 648 A
(printf\("\\n--pid)630 1110 A
(--pc-)210 1782 A
(---sp-)252 2034 A
(flag)168 2328 A
(-user)210 2538 A
(--sys--)294 2790 A
(-text-)252 3126 A
(-data-)252 3420 A
(-size-)252 3714 A
(-recv-)252 4008 A
(command\\n"\);)504 4302 A
4410 V
(14624)210 648 A
4500 V
(14625)210 648 A
(for)126 1110 A
(\(rp)126 1278 A
1446(=)S
(oldrp;)252 1530 A
1824(rp)S
1950(<)S
(END_PROC_ADDR;)588 2034 A
(rp++\))210 2664 A
2916({)S
4590 V
(14626)210 648 A
(proc_nr)294 1362 A
1698(=)S
(proc_number\(rp\);)672 1782 A
4680 V
(14627)210 648 A
1362(if)S
(\(rp->p_flags)504 1488 A
2034(&)S
(P_SLOT_FREE\))504 2118 A
(continue;)378 2664 A
4770 V
(14628)210 648 A
1362(if)S
(\(++n)168 1488 A
1698(>)S
(20\))126 1782 A
(break;)252 1950 A
4860 V
(14629)210 648 A
(text)168 1362 A
1572(=)S
(rp->p_map[T].mem_phys;)924 1656 A
4950 V
(14630)210 648 A
(data)168 1362 A
1572(=)S
(rp->p_map[D].mem_phys;)924 1656 A
5040 V
(14631)210 648 A
(size)168 1362 A
1572(=)S
(rp->p_map[T].mem_len)840 1656 A
5130 V
(14632)210 648 A
1698(+)S
(\(\(rp->p_map[S].mem_phys)966 1782 A
2790(+)S
(rp->p_map[S].mem_len\))882 2874 A
3798(-)S
(data\);)252 3882 A
5220 V
(14633)210 648 A
(printf\("%5d)462 1362 A
(%5lx)168 1866 A
(%6lx)168 2076 A
(%2x)126 2286 A
(%7U)126 2454 A
(%7U)126 2622 A
(%5uK)168 2790 A
(%5uK)168 3000 A
(%5uK)168 3210 A
3420(",)S
5310 V
(14634)210 648 A
(proc_nr)294 1656 A
1992(<)S
2076(0)S
2160(?)S
(proc_nr)294 2244 A
2580(:)S
(rp->p_pid,)420 2664 A
5400 V
(14635)210 648 A
(\(unsigned)378 1656 A
(long\))210 2076 A
(rp->p_reg.pc,)546 2328 A
5490 V
(14636)210 648 A
(\(unsigned)378 1656 A
(long\))210 2076 A
(rp->p_reg.sp,)546 2328 A
5580 V
(14637)210 648 A
(rp->p_flags,)504 1656 A
5670 V
(14638)210 648 A
(rp->user_time,)588 1656 A
(rp->sys_time,)546 2286 A
5760 V
(14639)210 648 A
(click_to_round_k\(text\),)966 1656 A
(click_to_round_k\(data\),)966 2664 A
5850 V
(14640)210 648 A
(click_to_round_k\(size\)\);)1008 1656 A
5940 V
(14641)210 648 A
1362(if)S
(\(rp->p_flags)504 1488 A
2034(&)S
(RECEIVING\))420 2118 A
2580({)S
6030 V
(14642)210 648 A
(printf\("%-7.7s",)672 1698 A
(proc_name\(rp->p_getfrom\)\);)1092 2412 A
6120 V
(14643)210 648 A
1362(})S
(else)168 1446 A
6210 V
(14644)210 648 A
1362(if)S
(\(rp->p_flags)504 1488 A
2034(&)S
(SENDING\))336 2118 A
2496({)S
8418 V
EP
%%Page: 203 203
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2049(File:)S
2282(src/kernel/dmp.c)S
12 B
(203)180 4248 A
900 V
7 LST
(14645)210 648 A
(printf\("S:%-5.5s",)756 1698 A
(proc_name\(rp->p_sendto\)\);)1050 2496 A
990 V
(14646)210 648 A
1362(})S
(else)168 1446 A
1080 V
(14647)210 648 A
1362(if)S
(\(rp->p_flags)504 1488 A
2034(==)S
2160(0\))S
2286({)S
1170 V
(14648)210 648 A
(printf\(")336 1698 A
("\);)126 2328 A
1260 V
(14649)210 648 A
1362(})S
1350 V
(14650)210 648 A
(printf\("%s\\n",)588 1362 A
(rp->p_name\);)504 1992 A
1440 V
(14651)210 648 A
1110(})S
1530 V
(14652)210 648 A
1110(if)S
(\(rp)126 1236 A
1404(==)S
(END_PROC_ADDR\))588 1530 A
2160(rp)S
2286(=)S
(BEG_PROC_ADDR;)588 2370 A
(else)168 3000 A
(printf\("--more--\\r"\);)882 3210 A
1620 V
(14653)210 648 A
(oldrp)210 1110 A
1362(=)S
(rp;)126 1446 A
1710 V
(14654)210 648 A
1026(})S
1980 V
(14657)210 648 A
(/*===========================================================================*)3276 1026 A
2070 V
(14658)210 648 A
1068(*)S
(map_dmp)294 2370 A
4260(*)S
2160 V
(14659)210 648 A
(*===========================================================================*/)3276 1068 A
2250 V
(14660)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(map_dmp\(\))378 1530 A
2340 V
(14661)210 648 A
1026({)S
2430 V
(14662)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
2520 V
(14663)210 648 A
(static)252 1110 A
(struct)252 1404 A
(proc)168 1698 A
(*oldrp)252 1908 A
2202(=)S
(cproc_addr\(HARDWARE\);)882 2286 A
2610 V
(14664)210 648 A
(int)126 1110 A
1278(n)S
1362(=)S
1446(0;)S
2700 V
(14665)210 648 A
(phys_clicks)462 1110 A
(size;)210 1614 A
2790 V
(14666)210 648 A
2880 V
(14667)210 648 A
(printf\("\\nPROC)588 1110 A
(NAME-)210 1740 A
(-----TEXT-----)588 2034 A
(-----DATA-----)588 2706 A
(----STACK-----)588 3378 A
(-SIZE-\\n"\);)462 4050 A
2970 V
(14668)210 648 A
(for)126 1110 A
(\(rp)126 1278 A
1446(=)S
(oldrp;)252 1530 A
1824(rp)S
1950(<)S
(END_PROC_ADDR;)588 2034 A
(rp++\))210 2664 A
2916({)S
3060 V
(14669)210 648 A
1362(if)S
(\(rp->p_flags)504 1488 A
2034(&)S
(P_SLOT_FREE\))504 2118 A
(continue;)378 2664 A
3150 V
(14670)210 648 A
1362(if)S
(\(++n)168 1488 A
1698(>)S
(20\))126 1782 A
(break;)252 1950 A
3240 V
(14671)210 648 A
(size)168 1362 A
1572(=)S
(rp->p_map[T].mem_len)840 1656 A
3330 V
(14672)210 648 A
1698(+)S
(\(\(rp->p_map[S].mem_phys)966 1782 A
2790(+)S
(rp->p_map[S].mem_len\))882 2874 A
3420 V
(14673)210 648 A
3042(-)S
(rp->p_map[D].mem_phys\);)966 3126 A
3510 V
(14674)210 648 A
(printf\("%3d)462 1362 A
(%-6.6s)252 1866 A
(%4x)126 2202 A
(%4x)126 2370 A
(%4x)126 2538 A
(%4x)126 2748 A
(%4x)126 2916 A
(%4x)126 3084 A
(%4x)126 3294 A
(%4x)126 3462 A
(%4x)126 3630 A
(%5uK\\n",)336 3840 A
3600 V
(14675)210 648 A
(proc_number\(rp\),)672 1656 A
3690 V
(14676)210 648 A
(rp->p_name,)462 1656 A
3780 V
(14677)210 648 A
(rp->p_map[T].mem_vir,)882 1656 A
(rp->p_map[T].mem_phys,)924 2580 A
(rp->p_map[T].mem_len,)882 3546 A
3870 V
(14678)210 648 A
(rp->p_map[D].mem_vir,)882 1656 A
(rp->p_map[D].mem_phys,)924 2580 A
(rp->p_map[D].mem_len,)882 3546 A
3960 V
(14679)210 648 A
(rp->p_map[S].mem_vir,)882 1656 A
(rp->p_map[S].mem_phys,)924 2580 A
(rp->p_map[S].mem_len,)882 3546 A
4050 V
(14680)210 648 A
(click_to_round_k\(size\)\);)1008 1656 A
4140 V
(14681)210 648 A
1110(})S
4230 V
(14682)210 648 A
1110(if)S
(\(rp)126 1236 A
1404(==)S
(END_PROC_ADDR\))588 1530 A
2160(rp)S
2286(=)S
(cproc_addr\(HARDWARE\);)882 2370 A
(else)168 3294 A
(printf\("--more--\\r"\);)882 3504 A
4320 V
(14683)210 648 A
(oldrp)210 1110 A
1362(=)S
(rp;)126 1446 A
4410 V
(14684)210 648 A
1026(})S
4680 V
(14687)210 648 A
(/*===========================================================================*)3276 1026 A
4770 V
(14688)210 648 A
1068(*)S
(proc_name)378 2370 A
4260(*)S
4860 V
(14689)210 648 A
(*===========================================================================*/)3276 1068 A
4950 V
(14690)210 648 A
(PRIVATE)294 1026 A
(char)168 1362 A
(*proc_name\(proc_nr\))798 1572 A
5040 V
(14691)210 648 A
(int)126 1026 A
(proc_nr;)336 1194 A
5130 V
(14692)210 648 A
1026({)S
5220 V
(14693)210 648 A
1110(if)S
(\(proc_nr)336 1236 A
1614(==)S
(ANY\))168 1740 A
(return)252 1950 A
("ANY";)252 2244 A
5310 V
(14694)210 648 A
(return)252 1110 A
(proc_addr\(proc_nr\)->p_name;)1134 1404 A
5400 V
(14695)210 648 A
1026(})S
8418 V
EP
%%Page: 204 204
BP
/slant 0 def
/height 0 def
630 V
12 B
(204)180 648 A
11 R
1993(File:)S
2226(src/kernel/system.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/kernel/system.c)798 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(14700)210 648 A
1026(/*)S
(This)168 1152 A
(task)168 1362 A
(handles)294 1572 A
(the)126 1908 A
(interface)378 2076 A
(between)294 2496 A
(file)168 2832 A
(system)252 3042 A
(and)126 3336 A
(kernel)252 3504 A
3798(as)S
(well)168 3924 A
4134(as)S
1440 V
(14701)210 648 A
1068(*)S
(between)294 1152 A
(memory)252 1488 A
(manager)294 1782 A
(and)126 2118 A
(kernel.)294 2286 A
(System)252 2664 A
(services)336 2958 A
(are)126 3336 A
(obtained)336 3504 A
3882(by)S
(sending)294 4008 A
1530 V
(14702)210 648 A
1068(*)S
(sys_task\(\))420 1152 A
1614(a)S
(message)294 1698 A
(specifying)420 2034 A
(what)168 2496 A
2706(is)S
(needed.)294 2832 A
3210(To)S
(make)168 3336 A
(life)168 3546 A
(easier)252 3756 A
(for)126 4050 A
1620 V
(14703)210 648 A
1068(*)S
1152(MM)S
(and)126 1278 A
(FS,)126 1446 A
1614(a)S
(library)294 1698 A
2034(is)S
(provided)336 2160 A
(with)168 2538 A
(routines)336 2748 A
(whose)210 3126 A
(names)210 3378 A
(are)126 3630 A
3798(of)S
(the)126 3924 A
1710 V
(14704)210 648 A
1068(*)S
(form)168 1152 A
(sys_xxx,)336 1362 A
(e.g.)168 1740 A
(sys_xit)294 1950 A
(sends)210 2286 A
(the)126 2538 A
(SYS_XIT)294 2706 A
(message)294 3042 A
3378(to)S
(sys_task.)378 3504 A
(The)126 3966 A
1800 V
(14705)210 648 A
1068(*)S
(message)294 1152 A
(types)210 1488 A
(and)126 1740 A
(parameters)420 1908 A
(are:)168 2370 A
1890 V
(14706)210 648 A
1068(*)S
1980 V
(14707)210 648 A
1068(*)S
(SYS_FORK)336 1236 A
(informs)294 1740 A
(kernel)252 2076 A
(that)168 2370 A
2580(a)S
(process)294 2664 A
(has)126 3000 A
(forked)252 3168 A
2070 V
(14708)210 648 A
1068(*)S
(SYS_NEWMAP)420 1236 A
(allows)252 1740 A
2034(MM)S
2160(to)S
(set)126 2286 A
2454(up)S
2580(a)S
(process)294 2664 A
(memory)252 3000 A
(map)126 3294 A
2160 V
(14709)210 648 A
1068(*)S
(SYS_GETMAP)420 1236 A
(allows)252 1740 A
2034(MM)S
2160(to)S
(get)126 2286 A
2454(a)S
(process')336 2538 A
(memory)252 2916 A
(map)126 3210 A
2250 V
(14710)210 648 A
1068(*)S
(SYS_EXEC)336 1236 A
(sets)168 1740 A
(program)294 1950 A
(counter)294 2286 A
(and)126 2622 A
(stack)210 2790 A
(pointer)294 3042 A
(after)210 3378 A
(EXEC)168 3630 A
2340 V
(14711)210 648 A
1068(*)S
(SYS_XIT)294 1236 A
(informs)294 1740 A
(kernel)252 2076 A
(that)168 2370 A
2580(a)S
(process)294 2664 A
(has)126 3000 A
(exited)252 3168 A
2430 V
(14712)210 648 A
1068(*)S
(SYS_GETSP)378 1236 A
(caller)252 1740 A
(wants)210 2034 A
2286(to)S
(read)168 2412 A
(out)126 2622 A
(some)168 2790 A
(process')336 3000 A
(stack)210 3378 A
(pointer)294 3630 A
2520 V
(14713)210 648 A
1068(*)S
(SYS_TIMES)378 1236 A
(caller)252 1740 A
(wants)210 2034 A
2286(to)S
(get)126 2412 A
(accounting)420 2580 A
(times)210 3042 A
(for)126 3294 A
3462(a)S
(process)294 3546 A
2610 V
(14714)210 648 A
1068(*)S
(SYS_ABORT)378 1236 A
1740(MM)S
1866(or)S
1992(FS)S
(cannot)252 2118 A
2412(go)S
(on;)126 2538 A
(abort)210 2706 A
(MINIX)210 2958 A
2700 V
(14715)210 648 A
1068(*)S
(SYS_FRESH)378 1236 A
(start)210 1740 A
(with)168 1992 A
2202(a)S
(fresh)210 2286 A
(process)294 2538 A
(image)210 2874 A
(during)252 3126 A
(EXEC)168 3420 A
(\(68000)252 3630 A
(only\))210 3924 A
2790 V
(14716)210 648 A
1068(*)S
(SYS_SENDSIG)462 1236 A
(send)168 1740 A
1950(a)S
(signal)252 2034 A
2328(to)S
2454(a)S
(process)294 2538 A
(\(POSIX)252 2874 A
(style\))252 3168 A
2880 V
(14717)210 648 A
1068(*)S
(SYS_SIGRETURN)546 1236 A
(complete)336 1824 A
(POSIX-style)462 2202 A
(signalling)420 2706 A
2970 V
(14718)210 648 A
1068(*)S
(SYS_KILL)336 1236 A
(cause)210 1740 A
1992(a)S
(signal)252 2076 A
2370(to)S
2496(be)S
(sent)168 2622 A
(via)126 2832 A
3000(MM)S
3060 V
(14719)210 648 A
1068(*)S
(SYS_ENDSIG)420 1236 A
(finish)252 1740 A
2034(up)S
(after)210 2160 A
(SYS_KILL-type)546 2412 A
(signal)252 3000 A
3150 V
(14720)210 648 A
1068(*)S
(SYS_COPY)336 1236 A
(request)294 1740 A
2076(a)S
(block)210 2160 A
2412(of)S
(data)168 2538 A
2748(to)S
2874(be)S
(copied)252 3000 A
(between)294 3294 A
(processes)378 3630 A
3240 V
(14721)210 648 A
1068(*)S
(SYS_VCOPY)378 1236 A
(request)294 1740 A
2076(a)S
(series)252 2160 A
2454(of)S
(data)168 2580 A
(blocks)252 2790 A
3084(to)S
3210(be)S
(copied)252 3336 A
(between)294 3630 A
(procs)210 3966 A
3330 V
(14722)210 648 A
1068(*)S
(SYS_GBOOT)378 1236 A
(copies)252 1740 A
(the)126 2034 A
(boot)168 2202 A
(parameters)420 2412 A
2874(to)S
3000(a)S
(process)294 3084 A
3420 V
(14723)210 648 A
1068(*)S
(SYS_MEM)294 1236 A
(returns)294 1740 A
(the)126 2076 A
(next)168 2244 A
(free)168 2454 A
(chunk)210 2664 A
2916(of)S
(physical)336 3042 A
(memory)252 3420 A
3510 V
(14724)210 648 A
1068(*)S
(SYS_UMAP)336 1236 A
(compute)294 1740 A
(the)126 2076 A
(physical)336 2244 A
(address)294 2622 A
(for)126 2958 A
3126(a)S
(given)210 3210 A
(virtual)294 3462 A
(address)294 3798 A
3600 V
(14725)210 648 A
1068(*)S
(SYS_TRACE)378 1236 A
(request)294 1740 A
2076(a)S
(trace)210 2160 A
(operation)378 2412 A
3690 V
(14726)210 648 A
1068(*)S
3780 V
(14727)210 648 A
1068(*)S
(Message)294 1152 A
(types)210 1488 A
(and)126 1740 A
(parameters:)462 1908 A
3870 V
(14728)210 648 A
1068(*)S
3960 V
(14729)210 648 A
1068(*)S
(m_type)252 1278 A
(PROC1)210 1824 A
(PROC2)210 2244 A
(PID)126 2706 A
(MEM_PTR)294 3042 A
4050 V
(14730)210 648 A
1068(*)S
(------------------------------------------------------)2268 1152 A
4140 V
(14731)210 648 A
1068(*)S
1152(|)S
(SYS_FORK)336 1236 A
1698(|)S
(parent)252 1782 A
2118(|)S
(child)210 2244 A
2538(|)S
(pid)126 2706 A
2958(|)S
3378(|)S
4230 V
(14732)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------|)2268 1152 A
4320 V
(14733)210 648 A
1068(*)S
1152(|)S
(SYS_NEWMAP)420 1236 A
1698(|)S
(proc)168 1782 A
1992(nr)S
2118(|)S
2538(|)S
2958(|)S
(map)126 3042 A
(ptr)126 3210 A
3378(|)S
4410 V
(14734)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------|)2268 1152 A
4500 V
(14735)210 648 A
1068(*)S
1152(|)S
(SYS_EXEC)336 1236 A
1698(|)S
(proc)168 1782 A
1992(nr)S
2118(|)S
(traced)252 2202 A
2538(|)S
(new)126 2622 A
2790(sp)S
2958(|)S
3378(|)S
4590 V
(14736)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------|)2268 1152 A
4680 V
(14737)210 648 A
1068(*)S
1152(|)S
(SYS_XIT)294 1236 A
1698(|)S
(parent)252 1782 A
2118(|)S
(exitee)252 2202 A
2538(|)S
2958(|)S
3378(|)S
4770 V
(14738)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------|)2268 1152 A
4860 V
(14739)210 648 A
1068(*)S
1152(|)S
(SYS_GETSP)378 1236 A
1698(|)S
(proc)168 1782 A
1992(nr)S
2118(|)S
2538(|)S
2958(|)S
3378(|)S
4950 V
(14740)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------|)2268 1152 A
5040 V
(14741)210 648 A
1068(*)S
1152(|)S
(SYS_TIMES)378 1236 A
1698(|)S
(proc)168 1782 A
1992(nr)S
2118(|)S
2538(|)S
(buf)126 2622 A
(ptr)126 2790 A
2958(|)S
3378(|)S
5130 V
(14742)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------|)2268 1152 A
5220 V
(14743)210 648 A
1068(*)S
1152(|)S
(SYS_ABORT)378 1236 A
1698(|)S
2118(|)S
2538(|)S
2958(|)S
3378(|)S
5310 V
(14744)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------|)2268 1152 A
5400 V
(14745)210 648 A
1068(*)S
1152(|)S
(SYS_FRESH)378 1236 A
1698(|)S
(proc)168 1782 A
1992(nr)S
2118(|)S
(data_cl)294 2202 A
2538(|)S
2958(|)S
3378(|)S
5490 V
(14746)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------|)2268 1152 A
5580 V
(14747)210 648 A
1068(*)S
1152(|)S
(SYS_GBOOT)378 1236 A
1698(|)S
(proc)168 1782 A
1992(nr)S
2118(|)S
2538(|)S
2958(|)S
(bootptr)294 3042 A
3378(|)S
5670 V
(14748)210 648 A
1068(*)S
(|------------+---------+---------+---------+---------|)2268 1152 A
5760 V
(14749)210 648 A
1068(*)S
1152(|)S
(SYS_GETMAP)420 1236 A
1698(|)S
(proc)168 1782 A
1992(nr)S
2118(|)S
2538(|)S
2958(|)S
(map)126 3042 A
(ptr)126 3210 A
3378(|)S
5850 V
(14750)210 648 A
1068(*)S
(------------------------------------------------------)2268 1152 A
5940 V
(14751)210 648 A
1068(*)S
6030 V
(14752)210 648 A
1068(*)S
(m_type)252 1278 A
(m1_i1)210 1950 A
(m1_i2)210 2370 A
(m1_i3)210 2790 A
(m1_p1)210 3294 A
6120 V
(14753)210 648 A
1068(*)S
(----------------+---------+---------+---------+--------------)2562 1152 A
6210 V
(14754)210 648 A
1068(*)S
1152(|)S
(SYS_VCOPY)378 1236 A
1824(|)S
(src)126 1950 A
2118(p)S
2244(|)S
(dst)126 2370 A
2538(p)S
2664(|)S
(vec)126 2748 A
(siz)126 2916 A
3084(|)S
3168(vc)S
(addr)168 3294 A
3672(|)S
8418 V
EP
%%Page: 205 205
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1993(File:)S
2226(src/kernel/system.c)S
12 B
(205)180 4248 A
900 V
7 LST
(14755)210 648 A
1068(*)S
(|---------------+---------+---------+---------+-------------|)2562 1152 A
990 V
(14756)210 648 A
1068(*)S
1152(|)S
(SYS_SENDSIG)462 1236 A
1824(|)S
(proc)168 1908 A
2118(nr)S
2244(|)S
2664(|)S
3084(|)S
(smp)126 3168 A
3672(|)S
1080 V
(14757)210 648 A
1068(*)S
(|---------------+---------+---------+---------+-------------|)2562 1152 A
1170 V
(14758)210 648 A
1068(*)S
1152(|)S
(SYS_SIGRETURN)546 1236 A
1824(|)S
(proc)168 1908 A
2118(nr)S
2244(|)S
2664(|)S
3084(|)S
(scp)126 3168 A
3672(|)S
1260 V
(14759)210 648 A
1068(*)S
(|---------------+---------+---------+---------+-------------|)2562 1152 A
1350 V
(14760)210 648 A
1068(*)S
1152(|)S
(SYS_ENDSIG)420 1236 A
1824(|)S
(proc)168 1908 A
2118(nr)S
2244(|)S
2664(|)S
3084(|)S
3672(|)S
1440 V
(14761)210 648 A
1068(*)S
(-------------------------------------------------------------)2562 1152 A
1530 V
(14762)210 648 A
1068(*)S
1620 V
(14763)210 648 A
1068(*)S
(m_type)252 1278 A
(m2_i1)210 1824 A
(m2_i2)210 2244 A
(m2_l1)210 2664 A
(m2_l2)210 3084 A
1710 V
(14764)210 648 A
1068(*)S
(------------------------------------------------------)2268 1152 A
1800 V
(14765)210 648 A
1068(*)S
1152(|)S
(SYS_TRACE)378 1236 A
1698(|)S
(proc_nr)294 1782 A
2118(|)S
(request)294 2202 A
2538(|)S
(addr)168 2664 A
2958(|)S
(data)168 3084 A
3378(|)S
1890 V
(14766)210 648 A
1068(*)S
(------------------------------------------------------)2268 1152 A
1980 V
(14767)210 648 A
1068(*)S
2070 V
(14768)210 648 A
1068(*)S
2160 V
(14769)210 648 A
1068(*)S
(m_type)252 1278 A
(m6_i1)210 1824 A
(m6_i2)210 2244 A
(m6_i3)210 2664 A
(m6_f1)210 3084 A
2250 V
(14770)210 648 A
1068(*)S
(------------------------------------------------------)2268 1152 A
2340 V
(14771)210 648 A
1068(*)S
1152(|)S
(SYS_KILL)336 1236 A
1698(|)S
(proc_nr)294 1782 A
2160(|)S
(sig)126 2286 A
2580(|)S
3000(|)S
3420(|)S
2430 V
(14772)210 648 A
1068(*)S
(------------------------------------------------------)2268 1152 A
2520 V
(14773)210 648 A
1068(*)S
2610 V
(14774)210 648 A
1068(*)S
2700 V
(14775)210 648 A
1068(*)S
(m_type)252 1278 A
(m5_c1)210 1782 A
(m5_i1)210 2118 A
(m5_l1)210 2496 A
(m5_c2)210 2832 A
(m5_i2)210 3168 A
(m5_l2)210 3546 A
(m5_l3)210 3882 A
2790 V
(14776)210 648 A
1068(*)S
(--------------------------------------------------------------------------)3108 1152 A
2880 V
(14777)210 648 A
1068(*)S
1152(|)S
(SYS_COPY)336 1236 A
(|src)168 1698 A
(seg|src)294 1908 A
(proc|src)336 2244 A
(vir|dst)294 2622 A
(seg|dst)294 2958 A
(proc|dst)336 3294 A
(vir|)168 3672 A
(byte)168 3882 A
4092(ct)S
4218(|)S
2970 V
(14778)210 648 A
1068(*)S
(--------------------------------------------------------------------------)3108 1152 A
3060 V
(14779)210 648 A
1068(*)S
1152(|)S
(SYS_UMAP)336 1236 A
1698(|)S
(seg)126 1824 A
(|proc)210 2034 A
2286(nr)S
(|vir)168 2412 A
(adr|)168 2622 A
3084(|)S
3462(|)S
3798(|)S
(byte)168 3882 A
4092(ct)S
4218(|)S
3150 V
(14780)210 648 A
1068(*)S
(--------------------------------------------------------------------------)3108 1152 A
3240 V
(14781)210 648 A
1068(*)S
3330 V
(14782)210 648 A
1068(*)S
3420 V
(14783)210 648 A
1068(*)S
(m_type)252 1278 A
(m1_i1)210 1782 A
(m1_i2)210 2244 A
(m1_i3)210 2706 A
3510 V
(14784)210 648 A
1068(*)S
(|------------+----------+----------+----------)1932 1152 A
3600 V
(14785)210 648 A
1068(*)S
1152(|)S
(SYS_MEM)294 1236 A
1698(|)S
(mem)126 1782 A
(base)168 1950 A
2160(|)S
(mem)126 2244 A
(size)168 2412 A
2622(|)S
(tot)126 2706 A
(mem)126 2874 A
3042(|)S
3690 V
(14786)210 648 A
1068(*)S
(----------------------------------------------)1932 1152 A
3780 V
(14787)210 648 A
1068(*)S
3870 V
(14788)210 648 A
1068(*)S
1152(In)S
(addition)336 1278 A
1656(to)S
(the)126 1782 A
(main)168 1950 A
(sys_task\(\))420 2160 A
(entry)210 2622 A
(point,)252 2874 A
(there)210 3168 A
(are)126 3420 A
3588(5)S
(other)210 3672 A
(minor)210 3924 A
3960 V
(14789)210 648 A
1068(*)S
(entry)210 1152 A
(points:)294 1404 A
4050 V
(14790)210 648 A
1068(*)S
(cause_sig:)420 1236 A
(take)168 1698 A
(action)252 1908 A
2202(to)S
(cause)210 2328 A
2580(a)S
(signal)252 2664 A
2958(to)S
(occur,)252 3084 A
(sooner)252 3378 A
3672(or)S
(later)210 3798 A
4140 V
(14791)210 648 A
1068(*)S
(inform:)294 1236 A
(tell)168 1698 A
1908(MM)S
(about)210 2034 A
(pending)294 2286 A
(signals)294 2622 A
4230 V
(14792)210 648 A
1068(*)S
(numap:)252 1236 A
(umap)168 1698 A
1908(D)S
(segment)294 1992 A
(starting)336 2328 A
(from)168 2706 A
(process)294 2916 A
(number)252 3252 A
(instead)294 3546 A
3882(of)S
(pointer)294 4008 A
4320 V
(14793)210 648 A
1068(*)S
(umap:)210 1236 A
(compute)294 1698 A
(the)126 2034 A
(physical)336 2202 A
(address)294 2580 A
(for)126 2916 A
3084(a)S
(given)210 3168 A
(virtual)294 3420 A
(address)294 3756 A
4410 V
(14794)210 648 A
1068(*)S
(alloc_segments:)630 1236 A
(allocate)336 1908 A
(segments)336 2286 A
(for)126 2664 A
(8088)168 2832 A
3042(or)S
(higher)252 3168 A
(processor)378 3462 A
4500 V
(14795)210 648 A
1068(*/)S
4590 V
(14796)210 648 A
4680 V
(14797)210 648 A
(#include)336 1026 A
("kernel.h")420 1404 A
4770 V
(14798)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
4860 V
(14799)210 648 A
(#include)336 1026 A
(<unistd.h>)420 1404 A
4950 V
(14800)210 648 A
(#include)336 1026 A
(<sys/sigcontext.h>)756 1404 A
5040 V
(14801)210 648 A
(#include)336 1026 A
(<sys/ptrace.h>)588 1404 A
5130 V
(14802)210 648 A
(#include)336 1026 A
(<minix/boot.h>)588 1404 A
5220 V
(14803)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
5310 V
(14804)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
5400 V
(14805)210 648 A
(#include)336 1026 A
("proc.h")336 1404 A
5490 V
(14806)210 648 A
(#include)336 1026 A
("protect.h")462 1404 A
5580 V
(14807)210 648 A
5670 V
(14808)210 648 A
1026(/*)S
(PSW)126 1152 A
(masks.)252 1320 A
1614(*/)S
5760 V
(14809)210 648 A
(#define)294 1026 A
(IF_MASK)294 1362 A
(0x00000200)420 1698 A
5850 V
(14810)210 648 A
(#define)294 1026 A
(IOPL_MASK)378 1362 A
(0x003000)336 1782 A
5940 V
(14811)210 648 A
6030 V
(14812)210 648 A
(PRIVATE)294 1026 A
(message)294 1362 A
1698(m;)S
6120 V
(14813)210 648 A
6210 V
(14814)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_abort,)378 2034 A
(\(message)336 2454 A
(*m_ptr\))294 2832 A
3168(\);)S
8418 V
EP
%%Page: 206 206
BP
/slant 0 def
/height 0 def
630 V
12 B
(206)180 648 A
11 R
1993(File:)S
2226(src/kernel/system.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(14815)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_copy,)336 2034 A
(\(message)336 2412 A
(*m_ptr\))294 2790 A
3126(\);)S
990 V
(14816)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_exec,)336 2034 A
(\(message)336 2412 A
(*m_ptr\))294 2790 A
3126(\);)S
1080 V
(14817)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_fork,)336 2034 A
(\(message)336 2412 A
(*m_ptr\))294 2790 A
3126(\);)S
1170 V
(14818)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_gboot,)378 2034 A
(\(message)336 2454 A
(*m_ptr\))294 2832 A
3168(\);)S
1260 V
(14819)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_getsp,)378 2034 A
(\(message)336 2454 A
(*m_ptr\))294 2832 A
3168(\);)S
1350 V
(14820)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_kill,)336 2034 A
(\(message)336 2412 A
(*m_ptr\))294 2790 A
3126(\);)S
1440 V
(14821)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_mem,)294 2034 A
(\(message)336 2370 A
(*m_ptr\))294 2748 A
3084(\);)S
1530 V
(14822)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_newmap,)420 2034 A
(\(message)336 2496 A
(*m_ptr\))294 2874 A
3210(\);)S
1620 V
(14823)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_sendsig,)462 2034 A
(\(message)336 2538 A
(*m_ptr\))294 2916 A
3252(\);)S
1710 V
(14824)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_sigreturn,)546 2034 A
(\(message)336 2622 A
(*m_ptr\))294 3000 A
3336(\);)S
1800 V
(14825)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_endsig,)420 2034 A
(\(message)336 2496 A
(*m_ptr\))294 2874 A
3210(\);)S
1890 V
(14826)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_times,)378 2034 A
(\(message)336 2454 A
(*m_ptr\))294 2832 A
3168(\);)S
1980 V
(14827)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_trace,)378 2034 A
(\(message)336 2454 A
(*m_ptr\))294 2832 A
3168(\);)S
2070 V
(14828)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_umap,)336 2034 A
(\(message)336 2412 A
(*m_ptr\))294 2790 A
3126(\);)S
2160 V
(14829)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_xit,)294 2034 A
(\(message)336 2370 A
(*m_ptr\))294 2748 A
3084(\);)S
2250 V
(14830)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_vcopy,)378 2034 A
(\(message)336 2454 A
(*m_ptr\))294 2832 A
3168(\);)S
2340 V
(14831)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(do_getmap,)420 2034 A
(\(message)336 2496 A
(*m_ptr\))294 2874 A
3210(\);)S
2430 V
(14832)210 648 A
2520 V
(14833)210 648 A
2610 V
(14834)210 648 A
(/*===========================================================================*)3276 1026 A
2700 V
(14835)210 648 A
1068(*)S
(sys_task)336 2370 A
4260(*)S
2790 V
(14836)210 648 A
(*===========================================================================*/)3276 1068 A
2880 V
(14837)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(sys_task\(\))420 1530 A
2970 V
(14838)210 648 A
1026({)S
3060 V
(14839)210 648 A
1026(/*)S
(Main)168 1152 A
(entry)210 1362 A
(point)210 1614 A
1866(of)S
(sys_task.)378 1992 A
(Get)126 2454 A
(the)126 2622 A
(message)294 2790 A
(and)126 3126 A
(dispatch)336 3294 A
3672(on)S
(type.)210 3798 A
4050(*/)S
3150 V
(14840)210 648 A
3240 V
(14841)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(r;)S
3330 V
(14842)210 648 A
3420 V
(14843)210 648 A
(while)210 1110 A
(\(TRUE\))252 1362 A
1656({)S
3510 V
(14844)210 648 A
(receive\(ANY,)504 1362 A
(&m\);)168 1908 A
3600 V
(14845)210 648 A
3690 V
(14846)210 648 A
(switch)252 1362 A
(\(m.m_type\))420 1656 A
2118({)S
2370(/*)S
(which)210 2496 A
(system)252 2748 A
(call)168 3042 A
3252(*/)S
3780 V
(14847)210 648 A
(case)168 1530 A
(SYS_FORK:)378 1740 A
2370(r)S
2454(=)S
(do_fork\(&m\);)504 2538 A
(break;)252 3378 A
3870 V
(14848)210 648 A
(case)168 1530 A
(SYS_NEWMAP:)462 1740 A
2370(r)S
2454(=)S
(do_newmap\(&m\);)588 2538 A
(break;)252 3378 A
3960 V
(14849)210 648 A
(case)168 1530 A
(SYS_GETMAP:)462 1740 A
2370(r)S
2454(=)S
(do_getmap\(&m\);)588 2538 A
(break;)252 3378 A
4050 V
(14850)210 648 A
(case)168 1530 A
(SYS_EXEC:)378 1740 A
2370(r)S
2454(=)S
(do_exec\(&m\);)504 2538 A
(break;)252 3378 A
4140 V
(14851)210 648 A
(case)168 1530 A
(SYS_XIT:)336 1740 A
2370(r)S
2454(=)S
(do_xit\(&m\);)462 2538 A
(break;)252 3378 A
4230 V
(14852)210 648 A
(case)168 1530 A
(SYS_GETSP:)420 1740 A
2370(r)S
2454(=)S
(do_getsp\(&m\);)546 2538 A
(break;)252 3378 A
4320 V
(14853)210 648 A
(case)168 1530 A
(SYS_TIMES:)420 1740 A
2370(r)S
2454(=)S
(do_times\(&m\);)546 2538 A
(break;)252 3378 A
4410 V
(14854)210 648 A
(case)168 1530 A
(SYS_ABORT:)420 1740 A
2370(r)S
2454(=)S
(do_abort\(&m\);)546 2538 A
(break;)252 3378 A
4500 V
(14855)210 648 A
(case)168 1530 A
(SYS_SENDSIG:)504 1740 A
2370(r)S
2454(=)S
(do_sendsig\(&m\);)630 2538 A
(break;)252 3378 A
4590 V
(14856)210 648 A
(case)168 1530 A
(SYS_SIGRETURN:)588 1740 A
2370(r)S
2454(=)S
(do_sigreturn\(&m\);)714 2538 A
(break;)252 3378 A
4680 V
(14857)210 648 A
(case)168 1530 A
(SYS_KILL:)378 1740 A
2370(r)S
2454(=)S
(do_kill\(&m\);)504 2538 A
(break;)252 3378 A
4770 V
(14858)210 648 A
(case)168 1530 A
(SYS_ENDSIG:)462 1740 A
2370(r)S
2454(=)S
(do_endsig\(&m\);)588 2538 A
(break;)252 3378 A
4860 V
(14859)210 648 A
(case)168 1530 A
(SYS_COPY:)378 1740 A
2370(r)S
2454(=)S
(do_copy\(&m\);)504 2538 A
(break;)252 3378 A
4950 V
(14860)210 648 A
(case)168 1530 A
(SYS_VCOPY:)420 1740 A
2370(r)S
2454(=)S
(do_vcopy\(&m\);)546 2538 A
(break;)252 3378 A
5040 V
(14861)210 648 A
(case)168 1530 A
(SYS_GBOOT:)420 1740 A
2370(r)S
2454(=)S
(do_gboot\(&m\);)546 2538 A
(break;)252 3378 A
5130 V
(14862)210 648 A
(case)168 1530 A
(SYS_MEM:)336 1740 A
2370(r)S
2454(=)S
(do_mem\(&m\);)462 2538 A
(break;)252 3378 A
5220 V
(14863)210 648 A
(case)168 1530 A
(SYS_UMAP:)378 1740 A
2370(r)S
2454(=)S
(do_umap\(&m\);)504 2538 A
(break;)252 3378 A
5310 V
(14864)210 648 A
(case)168 1530 A
(SYS_TRACE:)420 1740 A
2370(r)S
2454(=)S
(do_trace\(&m\);)546 2538 A
(break;)252 3378 A
5400 V
(14865)210 648 A
(default:)336 1530 A
2370(r)S
2454(=)S
(E_BAD_FCN;)420 2538 A
5490 V
(14866)210 648 A
1362(})S
5580 V
(14867)210 648 A
5670 V
(14868)210 648 A
(m.m_type)336 1362 A
1740(=)S
1824(r;)S
2370(/*)S
('r')126 2496 A
(reports)294 2664 A
(status)252 3000 A
3294(of)S
(call)168 3420 A
3630(*/)S
5760 V
(14869)210 648 A
(send\(m.m_source,)672 1362 A
(&m\);)168 2076 A
2370(/*)S
(send)168 2496 A
(reply)210 2706 A
2958(to)S
(caller)252 3084 A
3378(*/)S
5850 V
(14870)210 648 A
1110(})S
5940 V
(14871)210 648 A
1026(})S
6210 V
(14874)210 648 A
(/*===========================================================================*)3276 1026 A
8418 V
EP
%%Page: 207 207
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1993(File:)S
2226(src/kernel/system.c)S
12 B
(207)180 4248 A
900 V
7 LST
(14875)210 648 A
1068(*)S
(do_fork)294 2370 A
4260(*)S
990 V
(14876)210 648 A
(*===========================================================================*/)3276 1068 A
1080 V
(14877)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_fork\(m_ptr\))588 1530 A
1170 V
(14878)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
1260 V
(14879)210 648 A
1026({)S
1350 V
(14880)210 648 A
1026(/*)S
(Handle)252 1152 A
(sys_fork\(\).)462 1446 A
(m_ptr->PROC1)504 1992 A
(has)126 2538 A
(forked.)294 2706 A
(The)126 3084 A
(child)210 3252 A
3504(is)S
(m_ptr->PROC2.)546 3630 A
4218(*/)S
1440 V
(14881)210 648 A
1530 V
(14882)210 648 A
(reg_t)210 1110 A
(old_ldt_sel;)504 1362 A
1620 V
(14883)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rpc;)210 1992 A
1710 V
(14884)210 648 A
(struct)252 1110 A
(proc)168 1404 A
(*rpp;)210 1614 A
1800 V
(14885)210 648 A
1890 V
(14886)210 648 A
1110(if)S
(\(!isoksusern\(m_ptr->PROC1\))1092 1236 A
2370(||)S
(!isoksusern\(m_ptr->PROC2\)\))1092 2496 A
1980 V
(14887)210 648 A
(return\(E_BAD_PROC\);)798 1362 A
2070 V
(14888)210 648 A
(rpp)126 1110 A
1278(=)S
(proc_addr\(m_ptr->PROC1\);)1008 1362 A
2160 V
(14889)210 648 A
(rpc)126 1110 A
1278(=)S
(proc_addr\(m_ptr->PROC2\);)1008 1362 A
2250 V
(14890)210 648 A
2340 V
(14891)210 648 A
1110(/*)S
(Copy)168 1236 A
(parent)252 1446 A
('proc')252 1740 A
(struct)252 2034 A
2328(to)S
(child.)252 2454 A
2748(*/)S
2430 V
(14892)210 648 A
(old_ldt_sel)462 1110 A
1614(=)S
(rpc->p_ldt_sel;)630 1698 A
2370(/*)S
(stop)168 2496 A
(this)168 2706 A
(being)210 2916 A
(obliterated)462 3168 A
3672(by)S
(copy)168 3798 A
4008(*/)S
2520 V
(14893)210 648 A
2610 V
(14894)210 648 A
(*rpc)168 1110 A
1320(=)S
(*rpp;)210 1404 A
2370(/*)S
(copy)168 2496 A
('proc')252 2706 A
(struct)252 3000 A
3294(*/)S
2700 V
(14895)210 648 A
2790 V
(14896)210 648 A
(rpc->p_ldt_sel)588 1110 A
1740(=)S
(old_ldt_sel;)504 1824 A
2880 V
(14897)210 648 A
(rpc->p_nr)378 1110 A
1530(=)S
(m_ptr->PROC2;)546 1614 A
2370(/*)S
(this)168 2496 A
(was)126 2706 A
(obliterated)462 2874 A
3378(by)S
(copy)168 3504 A
3714(*/)S
2970 V
(14898)210 648 A
3060 V
(14899)210 648 A
(rpc->p_flags)504 1110 A
1656(|=)S
(NO_MAP;)294 1782 A
2370(/*)S
(inhibit)294 2496 A
(the)126 2832 A
(process)294 3000 A
(from)168 3336 A
(running)294 3546 A
3882(*/)S
3150 V
(14900)210 648 A
3240 V
(14901)210 648 A
(rpc->p_flags)504 1110 A
1656(&=)S
(\304\(PENDING)378 1782 A
2202(|)S
(SIG_PENDING)462 2286 A
2790(|)S
(P_STOP\);)336 2874 A
3330 V
(14902)210 648 A
3420 V
(14903)210 648 A
1110(/*)S
(Only)168 1236 A
1446(1)S
1530(in)S
(group)210 1656 A
(should)252 1908 A
(have)168 2202 A
(PENDING,)336 2412 A
(child)210 2790 A
(does)168 3042 A
(not)126 3252 A
(inherit)294 3420 A
(trace)210 3756 A
(status*/)336 4008 A
3510 V
(14904)210 648 A
(sigemptyset\(&rpc->p_pending\);)1218 1110 A
3600 V
(14905)210 648 A
(rpc->p_pendcount)672 1110 A
1824(=)S
1908(0;)S
3690 V
(14906)210 648 A
(rpc->p_pid)420 1110 A
1572(=)S
(m_ptr->PID;)462 1656 A
2370(/*)S
(install)294 2496 A
(child's)294 2832 A
(pid)126 3168 A
3336(*/)S
3780 V
(14907)210 648 A
(rpc->p_reg.retreg)714 1110 A
1866(=)S
1950(0;)S
2370(/*)S
(child)210 2496 A
(sees)168 2748 A
(pid)126 2958 A
3126(=)S
3210(0)S
3294(to)S
(know)168 3420 A
3630(it)S
3756(is)S
(child)210 3882 A
4134(*/)S
3870 V
(14908)210 648 A
3960 V
(14909)210 648 A
(rpc->user_time)588 1110 A
1740(=)S
1824(0;)S
2370(/*)S
(set)126 2496 A
(all)126 2664 A
(the)126 2832 A
(accounting)420 3000 A
(times)210 3462 A
3714(to)S
3840(0)S
3924(*/)S
4050 V
(14910)210 648 A
(rpc->sys_time)546 1110 A
1698(=)S
1782(0;)S
4140 V
(14911)210 648 A
(rpc->child_utime)672 1110 A
1824(=)S
1908(0;)S
4230 V
(14912)210 648 A
(rpc->child_stime)672 1110 A
1824(=)S
1908(0;)S
4320 V
(14913)210 648 A
4410 V
(14914)210 648 A
(return\(OK\);)462 1110 A
4500 V
(14915)210 648 A
1026(})S
4770 V
(14918)210 648 A
(/*===========================================================================*)3276 1026 A
4860 V
(14919)210 648 A
1068(*)S
(do_newmap)378 2370 A
4260(*)S
4950 V
(14920)210 648 A
(*===========================================================================*/)3276 1068 A
5040 V
(14921)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_newmap\(m_ptr\))672 1530 A
5130 V
(14922)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
5220 V
(14923)210 648 A
1026({)S
5310 V
(14924)210 648 A
1026(/*)S
(Handle)252 1152 A
(sys_newmap\(\).)546 1446 A
(Fetch)210 2076 A
(the)126 2328 A
(memory)252 2496 A
(map)126 2790 A
(from)168 2958 A
(MM.)126 3168 A
3336(*/)S
5400 V
(14925)210 648 A
5490 V
(14926)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
5580 V
(14927)210 648 A
(phys_bytes)420 1110 A
(src_phys;)378 1572 A
5670 V
(14928)210 648 A
(int)126 1110 A
(caller;)294 1278 A
2370(/*)S
(whose)210 2496 A
(space)210 2748 A
(has)126 3000 A
(the)126 3168 A
(new)126 3336 A
(map)126 3504 A
(\(usually)336 3672 A
(MM\))126 4050 A
4218(*/)S
5760 V
(14929)210 648 A
(int)126 1110 A
1278(k;)S
2370(/*)S
(process)294 2496 A
(whose)210 2832 A
(map)126 3084 A
3252(is)S
3378(to)S
3504(be)S
(loaded)252 3630 A
3924(*/)S
5850 V
(14930)210 648 A
(int)126 1110 A
(old_flags;)420 1278 A
2370(/*)S
(value)210 2496 A
2748(of)S
(flags)210 2874 A
(before)252 3126 A
(modification)504 3420 A
3966(*/)S
5940 V
(14931)210 648 A
(struct)252 1110 A
(mem_map)294 1404 A
(*map_ptr;)378 1740 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
3168(of)S
(map)126 3294 A
(inside)252 3462 A
(caller)252 3756 A
(\(MM\))168 4050 A
4260(*/)S
6030 V
(14932)210 648 A
6120 V
(14933)210 648 A
1110(/*)S
(Extract)294 1236 A
(message)294 1572 A
(parameters)420 1908 A
(and)126 2370 A
(copy)168 2538 A
(new)126 2748 A
(memory)252 2916 A
(map)126 3210 A
(from)168 3378 A
(MM.)126 3588 A
3756(*/)S
6210 V
(14934)210 648 A
(caller)252 1110 A
1404(=)S
(m_ptr->m_source;)672 1488 A
8418 V
EP
%%Page: 208 208
BP
/slant 0 def
/height 0 def
630 V
12 B
(208)180 648 A
11 R
1993(File:)S
2226(src/kernel/system.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(14935)210 648 A
1110(k)S
1194(=)S
(m_ptr->PROC1;)546 1278 A
990 V
(14936)210 648 A
(map_ptr)294 1110 A
1446(=)S
(\(struct)294 1530 A
(mem_map)294 1866 A
2202(*\))S
(m_ptr->MEM_PTR;)630 2328 A
1080 V
(14937)210 648 A
1110(if)S
(\(!isokprocn\(k\)\))630 1236 A
(return\(E_BAD_PROC\);)798 1908 A
1170 V
(14938)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(k\);)546 1320 A
2370(/*)S
(ptr)126 2496 A
2664(to)S
(entry)210 2790 A
3042(of)S
(user)168 3168 A
(getting)294 3378 A
(new)126 3714 A
(map)126 3882 A
4050(*/)S
1260 V
(14939)210 648 A
1350 V
(14940)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(map)126 1614 A
(from)168 1782 A
(MM.)126 1992 A
2160(*/)S
1440 V
(14941)210 648 A
(src_phys)336 1110 A
1488(=)S
(umap\(proc_addr\(caller\),)966 1572 A
2580(D,)S
(\(vir_bytes\))462 2706 A
(map_ptr,)336 3210 A
(sizeof\(rp->p_map\)\);)798 3588 A
1530 V
(14942)210 648 A
1110(if)S
(\(src_phys)378 1236 A
1656(==)S
1782(0\))S
(panic\("bad)420 1908 A
(call)168 2370 A
2580(to)S
(sys_newmap",)504 2706 A
(NO_NUM\);)336 3252 A
1620 V
(14943)210 648 A
(phys_copy\(src_phys,)798 1110 A
(vir2phys\(rp->p_map\),)840 1950 A
(\(phys_bytes\))504 2832 A
(sizeof\(rp->p_map\)\);)798 3378 A
1710 V
(14944)210 648 A
1800 V
(14945)210 648 A
(alloc_segments\(rp\);)798 1110 A
1890 V
(14946)210 648 A
(old_flags)378 1110 A
1530(=)S
(rp->p_flags;)504 1614 A
2370(/*)S
(save)168 2496 A
(the)126 2706 A
(previous)336 2874 A
(value)210 3252 A
3504(of)S
(the)126 3630 A
(flags)210 3798 A
4050(*/)S
1980 V
(14947)210 648 A
(rp->p_flags)462 1110 A
1614(&=)S
(\304NO_MAP;)336 1740 A
2070 V
(14948)210 648 A
1110(if)S
(\(old_flags)420 1236 A
1698(!=)S
1824(0)S
1908(&&)S
(rp->p_flags)462 2034 A
2538(==)S
2664(0\))S
(lock_ready\(rp\);)630 2790 A
2160 V
(14949)210 648 A
2250 V
(14950)210 648 A
(return\(OK\);)462 1110 A
2340 V
(14951)210 648 A
1026(})S
2610 V
(14954)210 648 A
(/*===========================================================================*)3276 1026 A
2700 V
(14955)210 648 A
1068(*)S
(do_getmap)378 2370 A
4260(*)S
2790 V
(14956)210 648 A
(*===========================================================================*/)3276 1068 A
2880 V
(14957)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_getmap\(m_ptr\))672 1530 A
2970 V
(14958)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
3060 V
(14959)210 648 A
1026({)S
3150 V
(14960)210 648 A
1026(/*)S
(Handle)252 1152 A
(sys_getmap\(\).)546 1446 A
(Report)252 2076 A
(the)126 2370 A
(memory)252 2538 A
(map)126 2832 A
3000(to)S
(MM.)126 3126 A
3294(*/)S
3240 V
(14961)210 648 A
3330 V
(14962)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
3420 V
(14963)210 648 A
(phys_bytes)420 1110 A
(dst_phys;)378 1572 A
3510 V
(14964)210 648 A
(int)126 1110 A
(caller;)294 1278 A
2370(/*)S
(where)210 2496 A
(the)126 2748 A
(map)126 2916 A
(has)126 3084 A
3252(to)S
3378(be)S
(stored)252 3504 A
3798(*/)S
3600 V
(14965)210 648 A
(int)126 1110 A
1278(k;)S
2370(/*)S
(process)294 2496 A
(whose)210 2832 A
(map)126 3084 A
3252(is)S
3378(to)S
3504(be)S
(loaded)252 3630 A
3924(*/)S
3690 V
(14966)210 648 A
(struct)252 1110 A
(mem_map)294 1404 A
(*map_ptr;)378 1740 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
3168(of)S
(map)126 3294 A
(inside)252 3462 A
(caller)252 3756 A
(\(MM\))168 4050 A
4260(*/)S
3780 V
(14967)210 648 A
3870 V
(14968)210 648 A
1110(/*)S
(Extract)294 1236 A
(message)294 1572 A
(parameters)420 1908 A
(and)126 2370 A
(copy)168 2538 A
(new)126 2748 A
(memory)252 2916 A
(map)126 3210 A
3378(to)S
(MM.)126 3504 A
3672(*/)S
3960 V
(14969)210 648 A
(caller)252 1110 A
1404(=)S
(m_ptr->m_source;)672 1488 A
4050 V
(14970)210 648 A
1110(k)S
1194(=)S
(m_ptr->PROC1;)546 1278 A
4140 V
(14971)210 648 A
(map_ptr)294 1110 A
1446(=)S
(\(struct)294 1530 A
(mem_map)294 1866 A
2202(*\))S
(m_ptr->MEM_PTR;)630 2328 A
4230 V
(14972)210 648 A
4320 V
(14973)210 648 A
1110(if)S
(\(!isokprocn\(k\)\))630 1236 A
4410 V
(14974)210 648 A
(panic\("do_getmap)672 1362 A
(got)126 2076 A
(bad)126 2244 A
(proc:)210 2412 A
2664(",)S
(m_ptr->PROC1\);)588 2790 A
4500 V
(14975)210 648 A
4590 V
(14976)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(k\);)546 1320 A
2370(/*)S
(ptr)126 2496 A
2664(to)S
(entry)210 2790 A
3042(of)S
(the)126 3168 A
(map)126 3336 A
3504(*/)S
4680 V
(14977)210 648 A
4770 V
(14978)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(map)126 1614 A
1782(to)S
(MM.)126 1908 A
2076(*/)S
4860 V
(14979)210 648 A
(dst_phys)336 1110 A
1488(=)S
(umap\(proc_addr\(caller\),)966 1572 A
2580(D,)S
(\(vir_bytes\))462 2706 A
(map_ptr,)336 3210 A
(sizeof\(rp->p_map\)\);)798 3588 A
4950 V
(14980)210 648 A
1110(if)S
(\(dst_phys)378 1236 A
1656(==)S
1782(0\))S
(panic\("bad)420 1908 A
(call)168 2370 A
2580(to)S
(sys_getmap",)504 2706 A
(NO_NUM\);)336 3252 A
5040 V
(14981)210 648 A
(phys_copy\(vir2phys\(rp->p_map\),)1260 1110 A
(dst_phys,)378 2412 A
(sizeof\(rp->p_map\)\);)798 2832 A
5130 V
(14982)210 648 A
5220 V
(14983)210 648 A
(return\(OK\);)462 1110 A
5310 V
(14984)210 648 A
1026(})S
5580 V
(14987)210 648 A
(/*===========================================================================*)3276 1026 A
5670 V
(14988)210 648 A
1068(*)S
(do_exec)294 2370 A
4260(*)S
5760 V
(14989)210 648 A
(*===========================================================================*/)3276 1068 A
5850 V
(14990)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_exec\(m_ptr\))588 1530 A
5940 V
(14991)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
6030 V
(14992)210 648 A
1026({)S
6120 V
(14993)210 648 A
1026(/*)S
(Handle)252 1152 A
(sys_exec\(\).)462 1446 A
1992(A)S
(process)294 2076 A
(has)126 2412 A
(done)168 2580 A
2790(a)S
(successful)420 2874 A
(EXEC.)210 3336 A
(Patch)210 3588 A
3840(it)S
(up.)126 3966 A
4134(*/)S
6210 V
(14994)210 648 A
8418 V
EP
%%Page: 209 209
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1993(File:)S
2226(src/kernel/system.c)S
12 B
(209)180 4248 A
900 V
7 LST
(14995)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
990 V
(14996)210 648 A
(reg_t)210 1110 A
(sp;)126 1362 A
2370(/*)S
(new)126 2496 A
2664(sp)S
2790(*/)S
1080 V
(14997)210 648 A
(phys_bytes)420 1110 A
(phys_name;)420 1572 A
1170 V
(14998)210 648 A
(char)168 1110 A
(*np;)168 1320 A
1260 V
(14999)210 648 A
(#define)294 1026 A
(NLEN)168 1362 A
(\(sizeof\(rp->p_name\)-1\))924 1572 A
1350 V
(15000)210 648 A
1440 V
(15001)210 648 A
1110(if)S
(\(!isoksusern\(m_ptr->PROC1\)\))1134 1236 A
(return)252 2412 A
(E_BAD_PROC;)462 2706 A
1530 V
(15002)210 648 A
1110(/*)S
(PROC2)210 1236 A
(field)210 1488 A
1740(is)S
(used)168 1866 A
2076(as)S
(flag)168 2202 A
2412(to)S
(indicate)336 2538 A
(process)294 2916 A
3252(is)S
(being)210 3378 A
(traced)252 3630 A
3924(*/)S
1620 V
(15003)210 648 A
1110(if)S
(\(m_ptr->PROC2\))588 1236 A
(cause_sig\(m_ptr->PROC1,)966 1866 A
(SIGTRAP\);)378 2874 A
1710 V
(15004)210 648 A
1110(sp)S
1236(=)S
(\(reg_t\))294 1320 A
(m_ptr->STACK_PTR;)714 1656 A
1800 V
(15005)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(m_ptr->PROC1\);)1008 1320 A
1890 V
(15006)210 648 A
(rp->p_reg.sp)504 1110 A
1656(=)S
(sp;)126 1740 A
2370(/*)S
(set)126 2496 A
(the)126 2664 A
(stack)210 2832 A
(pointer)294 3084 A
3420(*/)S
1980 V
(15007)210 648 A
(rp->p_reg.pc)504 1110 A
1656(=)S
(\(reg_t\))294 1740 A
(m_ptr->IP_PTR;)588 2076 A
2706(/*)S
(set)126 2832 A
3000(pc)S
3126(*/)S
2070 V
(15008)210 648 A
(rp->p_alarm)462 1110 A
1614(=)S
1698(0;)S
2370(/*)S
(reset)210 2496 A
(alarm)210 2748 A
(timer)210 3000 A
3252(*/)S
2160 V
(15009)210 648 A
(rp->p_flags)462 1110 A
1614(&=)S
(\304RECEIVING;)462 1740 A
2370(/*)S
2496(MM)S
(does)168 2622 A
(not)126 2832 A
(reply)210 3000 A
3252(to)S
(EXEC)168 3378 A
(call)168 3588 A
3798(*/)S
2250 V
(15010)210 648 A
1110(if)S
(\(rp->p_flags)504 1236 A
1782(==)S
1908(0\))S
(lock_ready\(rp\);)630 2034 A
2340 V
(15011)210 648 A
2430 V
(15012)210 648 A
1110(/*)S
(Save)168 1236 A
(command)294 1446 A
(name)168 1782 A
(for)126 1992 A
(debugging,)420 2160 A
(ps\(1\))210 2622 A
(output,)294 2874 A
(etc.)168 3210 A
3420(*/)S
2520 V
(15013)210 648 A
(phys_name)378 1110 A
1530(=)S
(numap\(m_ptr->m_source,)924 1614 A
(\(vir_bytes\))462 2580 A
(m_ptr->NAME_PTR,)672 3084 A
2610 V
(15014)210 648 A
(\(vir_bytes\))462 3378 A
(NLEN\);)252 3882 A
2700 V
(15015)210 648 A
1110(if)S
(\(phys_name)420 1236 A
1698(!=)S
1824(0\))S
1950({)S
2790 V
(15016)210 648 A
(phys_copy\(phys_name,)840 1362 A
(vir2phys\(rp->p_name\),)882 2244 A
(\(phys_bytes\))504 3168 A
(NLEN\);)252 3714 A
2880 V
(15017)210 648 A
(for)126 1362 A
(\(np)126 1530 A
1698(=)S
(rp->p_name;)462 1782 A
(\(*np)168 2286 A
2496(&)S
(BYTE\))210 2580 A
2832(>=)S
2958(')S
3042(';)S
(np++\))210 3168 A
3420({})S
2970 V
(15018)210 648 A
(*np)126 1362 A
1530(=)S
1614(0;)S
3060 V
(15019)210 648 A
1110(})S
3150 V
(15020)210 648 A
(return\(OK\);)462 1110 A
3240 V
(15021)210 648 A
1026(})S
3510 V
(15024)210 648 A
(/*===========================================================================*)3276 1026 A
3600 V
(15025)210 648 A
1068(*)S
(do_xit)252 2370 A
4260(*)S
3690 V
(15026)210 648 A
(*===========================================================================*/)3276 1068 A
3780 V
(15027)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_xit\(m_ptr\))546 1530 A
3870 V
(15028)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
3960 V
(15029)210 648 A
1026({)S
4050 V
(15030)210 648 A
1026(/*)S
(Handle)252 1152 A
(sys_xit\(\).)420 1446 A
1950(A)S
(process)294 2034 A
(has)126 2370 A
(exited.)294 2538 A
2874(*/)S
4140 V
(15031)210 648 A
4230 V
(15032)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp,)168 1992 A
(*rc;)168 2202 A
4320 V
(15033)210 648 A
(struct)252 1110 A
(proc)168 1404 A
(*np,)168 1614 A
(*xp;)168 1824 A
4410 V
(15034)210 648 A
(int)126 1110 A
(parent;)294 1278 A
2370(/*)S
(number)252 2496 A
2790(of)S
(exiting)294 2916 A
(proc's)252 3252 A
(parent)252 3546 A
3840(*/)S
4500 V
(15035)210 648 A
(int)126 1110 A
(proc_nr;)336 1278 A
2370(/*)S
(number)252 2496 A
2790(of)S
(process)294 2916 A
(doing)210 3252 A
(the)126 3504 A
(exit)168 3672 A
3882(*/)S
4590 V
(15036)210 648 A
(phys_clicks)462 1110 A
(base,)210 1614 A
(size;)210 1866 A
4680 V
(15037)210 648 A
4770 V
(15038)210 648 A
(parent)252 1110 A
1404(=)S
(m_ptr->PROC1;)546 1488 A
2370(/*)S
(slot)168 2496 A
(number)252 2706 A
3000(of)S
(parent)252 3126 A
(process)294 3420 A
3756(*/)S
4860 V
(15039)210 648 A
(proc_nr)294 1110 A
1446(=)S
(m_ptr->PROC2;)546 1530 A
2370(/*)S
(slot)168 2496 A
(number)252 2706 A
3000(of)S
(exiting)294 3126 A
(process)294 3462 A
3798(*/)S
4950 V
(15040)210 648 A
1110(if)S
(\(!isoksusern\(parent\))840 1236 A
2118(||)S
(!isoksusern\(proc_nr\)\))882 2244 A
(return\(E_BAD_PROC\);)798 3168 A
5040 V
(15041)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(parent\);)756 1320 A
5130 V
(15042)210 648 A
1110(rc)S
1236(=)S
(proc_addr\(proc_nr\);)798 1320 A
5220 V
(15043)210 648 A
(lock\(\);)294 1110 A
5310 V
(15044)210 648 A
(rp->child_utime)630 1110 A
1782(+=)S
(rc->user_time)546 1908 A
2496(+)S
(rc->child_utime;)672 2580 A
3378(/*)S
(accum)210 3504 A
(child)210 3756 A
(times)210 4008 A
4260(*/)S
5400 V
(15045)210 648 A
(rp->child_stime)630 1110 A
1782(+=)S
(rc->sys_time)504 1908 A
2454(+)S
(rc->child_stime;)672 2538 A
5490 V
(15046)210 648 A
(unlock\(\);)378 1110 A
5580 V
(15047)210 648 A
(rc->p_alarm)462 1110 A
1614(=)S
1698(0;)S
2370(/*)S
(turn)168 2496 A
(off)126 2706 A
(alarm)210 2874 A
(timer)210 3126 A
3378(*/)S
5670 V
(15048)210 648 A
1110(if)S
(\(rc->p_flags)504 1236 A
1782(==)S
1908(0\))S
(lock_unready\(rc\);)714 2034 A
5760 V
(15049)210 648 A
5850 V
(15050)210 648 A
(strcpy\(rc->p_name,)756 1110 A
("<noname>"\);)504 1908 A
2706(/*)S
(process)294 2832 A
3168(no)S
(longer)252 3294 A
(has)126 3588 A
3756(a)S
(name)168 3840 A
4050(*/)S
5940 V
(15051)210 648 A
6030 V
(15052)210 648 A
1110(/*)S
1236(If)S
(the)126 1362 A
(process)294 1530 A
(being)210 1866 A
(terminated)420 2118 A
(happens)294 2580 A
2916(to)S
3042(be)S
(queued)252 3168 A
(trying)252 3462 A
3756(to)S
(send)168 3882 A
4092(a)S
6120 V
(15053)210 648 A
1152(*)S
(message)294 1236 A
(\(i.e.,)252 1572 A
(the)126 1866 A
(process)294 2034 A
(was)126 2370 A
(killed)252 2538 A
2832(by)S
2958(a)S
(signal,)294 3042 A
(rather)252 3378 A
(than)168 3672 A
3882(it)S
(doing)210 4008 A
4260(an)S
6210 V
(15054)210 648 A
1152(*)S
(EXIT\),)252 1236 A
(then)168 1530 A
1740(it)S
(must)168 1866 A
2076(be)S
(removed)294 2202 A
(from)168 2538 A
(the)126 2748 A
(message)294 2916 A
(queues.)294 3252 A
8418 V
EP
%%Page: 210 210
BP
/slant 0 def
/height 0 def
630 V
12 B
(210)180 648 A
11 R
1993(File:)S
2226(src/kernel/system.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(15055)210 648 A
1152(*/)S
990 V
(15056)210 648 A
1110(if)S
(\(rc->p_flags)504 1236 A
1782(&)S
(SENDING\))336 1866 A
2244({)S
1080 V
(15057)210 648 A
1362(/*)S
(Check)210 1488 A
(all)126 1740 A
(proc)168 1908 A
(slots)210 2118 A
2370(to)S
(see)126 2496 A
2664(if)S
(the)126 2790 A
(exiting)294 2958 A
(process)294 3294 A
3630(is)S
(queued.)294 3756 A
4092(*/)S
1170 V
(15058)210 648 A
(for)126 1362 A
(\(rp)126 1530 A
1698(=)S
(BEG_PROC_ADDR;)588 1782 A
2412(rp)S
2538(<)S
(END_PROC_ADDR;)588 2622 A
(rp++\))210 3252 A
3504({)S
1260 V
(15059)210 648 A
1698(if)S
(\(rp->p_callerq)588 1824 A
2454(==)S
(NIL_PROC\))378 2580 A
(continue;)378 3000 A
1350 V
(15060)210 648 A
1698(if)S
(\(rp->p_callerq)588 1824 A
2454(==)S
(rc\))126 2580 A
2748({)S
1440 V
(15061)210 648 A
2034(/*)S
(Exiting)294 2160 A
(process)294 2496 A
2832(is)S
2958(on)S
(front)210 3084 A
3336(of)S
(this)168 3462 A
(queue.)252 3672 A
3966(*/)S
1530 V
(15062)210 648 A
(rp->p_callerq)546 2034 A
2622(=)S
(rc->p_sendlink;)630 2706 A
1620 V
(15063)210 648 A
(break;)252 2034 A
1710 V
(15064)210 648 A
1698(})S
(else)168 1782 A
1992({)S
1800 V
(15065)210 648 A
2034(/*)S
(See)126 2160 A
2328(if)S
(exiting)294 2454 A
(process)294 2790 A
3126(is)S
3252(in)S
(middle)252 3378 A
3672(of)S
(queue.)252 3798 A
4092(*/)S
1890 V
(15066)210 648 A
2034(np)S
2160(=)S
(rp->p_callerq;)588 2244 A
1980 V
(15067)210 648 A
(while)210 2034 A
2286(\()S
2370(\()S
2454(xp)S
2580(=)S
(np->p_sendlink\))630 2664 A
3336(!=)S
(NIL_PROC\))378 3462 A
2070 V
(15068)210 648 A
2370(if)S
(\(xp)126 2496 A
2664(==)S
(rc\))126 2790 A
2958({)S
2160 V
(15069)210 648 A
(np->p_sendlink)588 2706 A
3336(=)S
(xp->p_sendlink;)630 3420 A
2250 V
(15070)210 648 A
(break;)252 2706 A
2340 V
(15071)210 648 A
2370(})S
(else)168 2454 A
2664({)S
2430 V
(15072)210 648 A
2706(np)S
2832(=)S
(xp;)126 2916 A
2520 V
(15073)210 648 A
2370(})S
2610 V
(15074)210 648 A
1698(})S
2700 V
(15075)210 648 A
1362(})S
2790 V
(15076)210 648 A
1110(})S
2880 V
(15077)210 648 A
2970 V
(15078)210 648 A
1110(if)S
(\(rc->p_flags)504 1236 A
1782(&)S
(PENDING\))336 1866 A
(--sig_procs;)504 2244 A
3060 V
(15079)210 648 A
(sigemptyset\(&rc->p_pending\);)1176 1110 A
3150 V
(15080)210 648 A
(rc->p_pendcount)630 1110 A
1782(=)S
1866(0;)S
3240 V
(15081)210 648 A
(rc->p_flags)462 1110 A
1614(=)S
(P_SLOT_FREE;)504 1698 A
3330 V
(15082)210 648 A
(return\(OK\);)462 1110 A
3420 V
(15083)210 648 A
1026(})S
3690 V
(15086)210 648 A
(/*===========================================================================*)3276 1026 A
3780 V
(15087)210 648 A
1068(*)S
(do_getsp)336 2370 A
4260(*)S
3870 V
(15088)210 648 A
(*===========================================================================*/)3276 1068 A
3960 V
(15089)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_getsp\(m_ptr\))630 1530 A
4050 V
(15090)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
4140 V
(15091)210 648 A
1026({)S
4230 V
(15092)210 648 A
1026(/*)S
(Handle)252 1152 A
(sys_getsp\(\).)504 1446 A
2034(MM)S
(wants)210 2160 A
2412(to)S
(know)168 2538 A
(what)168 2748 A
2958(sp)S
(is.)126 3084 A
3252(*/)S
4320 V
(15093)210 648 A
4410 V
(15094)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
4500 V
(15095)210 648 A
4590 V
(15096)210 648 A
1110(if)S
(\(!isoksusern\(m_ptr->PROC1\)\))1134 1236 A
(return\(E_BAD_PROC\);)798 2412 A
4680 V
(15097)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(m_ptr->PROC1\);)1008 1320 A
4770 V
(15098)210 648 A
(m_ptr->STACK_PTR)672 1110 A
1824(=)S
(\(char)210 1908 A
2160(*\))S
(rp->p_reg.sp;)546 2286 A
3042(/*)S
(return)252 3168 A
3462(sp)S
(here)168 3588 A
(\(bad)168 3798 A
(type\))210 4008 A
4260(*/)S
4860 V
(15099)210 648 A
(return\(OK\);)462 1110 A
4950 V
(15100)210 648 A
1026(})S
5220 V
(15103)210 648 A
(/*===========================================================================*)3276 1026 A
5310 V
(15104)210 648 A
1068(*)S
(do_times)336 2370 A
4260(*)S
5400 V
(15105)210 648 A
(*===========================================================================*/)3276 1068 A
5490 V
(15106)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_times\(m_ptr\))630 1530 A
5580 V
(15107)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
5670 V
(15108)210 648 A
1026({)S
5760 V
(15109)210 648 A
1026(/*)S
(Handle)252 1152 A
(sys_times\(\).)504 1446 A
(Retrieve)336 2034 A
(the)126 2412 A
(accounting)420 2580 A
(information.)504 3042 A
3588(*/)S
5850 V
(15110)210 648 A
5940 V
(15111)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
6030 V
(15112)210 648 A
6120 V
(15113)210 648 A
1110(if)S
(\(!isoksusern\(m_ptr->PROC1\)\))1134 1236 A
(return)252 2412 A
(E_BAD_PROC;)462 2706 A
6210 V
(15114)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(m_ptr->PROC1\);)1008 1320 A
8418 V
EP
%%Page: 211 211
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1993(File:)S
2226(src/kernel/system.c)S
12 B
(211)180 4248 A
900 V
7 LST
(15115)210 648 A
990 V
(15116)210 648 A
1110(/*)S
(Insert)252 1236 A
(the)126 1530 A
(times)210 1698 A
(needed)252 1950 A
2244(by)S
(the)126 2370 A
(TIMES)210 2538 A
(system)252 2790 A
(call)168 3084 A
3294(in)S
(the)126 3420 A
(message.)336 3588 A
3966(*/)S
1080 V
(15117)210 648 A
(lock\(\);)294 1110 A
2370(/*)S
(halt)168 2496 A
(the)126 2706 A
(volatile)336 2874 A
(time)168 3252 A
(counters)336 3462 A
3840(in)S
3966(rp)S
4092(*/)S
1170 V
(15118)210 648 A
(m_ptr->USER_TIME)672 1110 A
1908(=)S
(rp->user_time;)588 1992 A
1260 V
(15119)210 648 A
(m_ptr->SYSTEM_TIME)756 1110 A
1908(=)S
(rp->sys_time;)546 1992 A
1350 V
(15120)210 648 A
(unlock\(\);)378 1110 A
1440 V
(15121)210 648 A
(m_ptr->CHILD_UTIME)756 1110 A
1908(=)S
(rp->child_utime;)672 1992 A
1530 V
(15122)210 648 A
(m_ptr->CHILD_STIME)756 1110 A
1908(=)S
(rp->child_stime;)672 1992 A
1620 V
(15123)210 648 A
(m_ptr->BOOT_TICKS)714 1110 A
1908(=)S
(get_uptime\(\);)546 1992 A
1710 V
(15124)210 648 A
(return\(OK\);)462 1110 A
1800 V
(15125)210 648 A
1026(})S
2070 V
(15128)210 648 A
(/*===========================================================================*)3276 1026 A
2160 V
(15129)210 648 A
1068(*)S
(do_abort)336 2370 A
4260(*)S
2250 V
(15130)210 648 A
(*===========================================================================*/)3276 1068 A
2340 V
(15131)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_abort\(m_ptr\))630 1530 A
2430 V
(15132)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
2520 V
(15133)210 648 A
1026({)S
2610 V
(15134)210 648 A
1026(/*)S
(Handle)252 1152 A
(sys_abort.)420 1446 A
(MINIX)210 1950 A
2202(is)S
(unable)252 2328 A
2622(to)S
(continue.)378 2748 A
(Terminate)378 3210 A
(operation.)420 3630 A
4092(*/)S
2700 V
(15135)210 648 A
(char)168 1110 A
(monitor_code[64];)714 1320 A
2790 V
(15136)210 648 A
(phys_bytes)420 1110 A
(src_phys;)378 1572 A
2880 V
(15137)210 648 A
2970 V
(15138)210 648 A
1110(if)S
(\(m_ptr->m1_i1)546 1236 A
1824(==)S
(RBT_MONITOR\))504 1950 A
2496({)S
3060 V
(15139)210 648 A
1362(/*)S
(The)126 1488 A
(monitor)294 1656 A
1992(is)S
2118(to)S
(run)126 2244 A
(user)168 2412 A
(specified)378 2622 A
(instructions.)546 3042 A
3630(*/)S
3150 V
(15140)210 648 A
(src_phys)336 1362 A
1740(=)S
(numap\(m_ptr->m_source,)924 1824 A
(\(vir_bytes\))462 2790 A
(m_ptr->m1_p1,)546 3294 A
3240 V
(15141)210 648 A
(\(vir_bytes\))462 2706 A
(sizeof\(monitor_code\)\);)924 3210 A
3330 V
(15142)210 648 A
1362(if)S
(\(src_phys)378 1488 A
1908(==)S
2034(0\))S
(panic\("bad)420 2160 A
(monitor)294 2622 A
(code)168 2958 A
(from",)252 3168 A
(m_ptr->m_source\);)714 3462 A
3420 V
(15143)210 648 A
(phys_copy\(src_phys,)798 1362 A
(vir2phys\(monitor_code\),)966 2202 A
3510 V
(15144)210 648 A
(\(phys_bytes\))504 2706 A
(sizeof\(monitor_code\)\);)924 3252 A
3600 V
(15145)210 648 A
(reboot_code)462 1362 A
1866(=)S
(vir2phys\(monitor_code\);)966 1950 A
3690 V
(15146)210 648 A
1110(})S
3780 V
(15147)210 648 A
(wreboot\(m_ptr->m1_i1\);)924 1110 A
3870 V
(15148)210 648 A
(return\(OK\);)462 1110 A
2370(/*)S
(pro-forma)378 2496 A
(\(really)294 2916 A
(EDISASTER\))420 3252 A
3714(*/)S
3960 V
(15149)210 648 A
1026(})S
4410 V
(15154)210 648 A
(/*===========================================================================*)3276 1026 A
4500 V
(15155)210 648 A
1068(*)S
(do_sendsig)420 2286 A
4260(*)S
4590 V
(15156)210 648 A
(*===========================================================================*/)3276 1068 A
4680 V
(15157)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_sendsig\(m_ptr\))714 1530 A
4770 V
(15158)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
4860 V
(15159)210 648 A
1026({)S
4950 V
(15160)210 648 A
1026(/*)S
(Handle)252 1152 A
(sys_sendsig,)504 1446 A
(POSIX-style)462 1992 A
(signal)252 2496 A
2790(*/)S
5040 V
(15161)210 648 A
5130 V
(15162)210 648 A
(struct)252 1110 A
(sigmsg)252 1404 A
(smsg;)210 1698 A
5220 V
(15163)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
5310 V
(15164)210 648 A
(phys_bytes)420 1110 A
(src_phys,)378 1572 A
(dst_phys;)378 1992 A
5400 V
(15165)210 648 A
(struct)252 1110 A
(sigcontext)420 1404 A
(sc,)126 1866 A
(*scp;)210 2034 A
5490 V
(15166)210 648 A
(struct)252 1110 A
(sigframe)336 1404 A
(fr,)126 1782 A
(*frp;)210 1950 A
5580 V
(15167)210 648 A
5670 V
(15168)210 648 A
1110(if)S
(\(!isokusern\(m_ptr->PROC1\)\))1092 1236 A
(return\(E_BAD_PROC\);)798 2370 A
5760 V
(15169)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(m_ptr->PROC1\);)1008 1320 A
5850 V
(15170)210 648 A
5940 V
(15171)210 648 A
1110(/*)S
(Get)126 1236 A
(the)126 1404 A
(sigmsg)252 1572 A
(structure)378 1866 A
(into)168 2286 A
(our)126 2496 A
(address)294 2664 A
(space.)252 3000 A
3336(*/)S
6030 V
(15172)210 648 A
(src_phys)336 1110 A
1488(=)S
(umap\(proc_addr\(MM_PROC_NR\),)1134 1572 A
2748(D,)S
(\(vir_bytes\))462 2874 A
(m_ptr->SIG_CTXT_PTR,)840 3378 A
6120 V
(15173)210 648 A
(\(vir_bytes\))462 1782 A
(sizeof\(struct)546 2286 A
(sigmsg\)\);)378 2874 A
6210 V
(15174)210 648 A
1110(if)S
(\(src_phys)378 1236 A
1656(==)S
1782(0\))S
8418 V
EP
%%Page: 212 212
BP
/slant 0 def
/height 0 def
630 V
12 B
(212)180 648 A
11 R
1993(File:)S
2226(src/kernel/system.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(15175)210 648 A
(panic\("do_sendsig)714 1362 A
(can't)210 2118 A
(signal:)294 2370 A
(bad)126 2706 A
(sigmsg)252 2874 A
(address)294 3168 A
(from)168 3504 A
(MM",)168 3714 A
(NO_NUM\);)336 3924 A
990 V
(15176)210 648 A
(phys_copy\(src_phys,)798 1110 A
(vir2phys\(&smsg\),)672 1950 A
(\(phys_bytes\))504 2664 A
(sizeof\(struct)546 3210 A
(sigmsg\)\);)378 3798 A
1080 V
(15177)210 648 A
1170 V
(15178)210 648 A
1110(/*)S
(Compute)294 1236 A
(the)126 1572 A
(usr)126 1740 A
(stack)210 1908 A
(pointer)294 2160 A
(value)210 2496 A
(where)210 2748 A
(sigcontext)420 3000 A
(will)168 3462 A
3672(be)S
(stored.)294 3798 A
4134(*/)S
1260 V
(15179)210 648 A
(scp)126 1110 A
1278(=)S
(\(struct)294 1362 A
(sigcontext)420 1698 A
2160(*\))S
(smsg.sm_stkptr)588 2286 A
2916(-)S
3000(1;)S
1350 V
(15180)210 648 A
1440 V
(15181)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(registers)378 1614 A
2034(to)S
(the)126 2160 A
(sigcontext)420 2328 A
(structure.)420 2790 A
3252(*/)S
1530 V
(15182)210 648 A
(memcpy\(&sc.sc_regs,)798 1110 A
(&rp->p_reg,)462 1950 A
(sizeof\(struct)546 2454 A
(sigregs\)\);)420 3042 A
1620 V
(15183)210 648 A
1710 V
(15184)210 648 A
1110(/*)S
(Finish)252 1236 A
(the)126 1530 A
(sigcontext)420 1698 A
(initialization.)630 2160 A
2832(*/)S
1800 V
(15185)210 648 A
(sc.sc_flags)462 1110 A
1614(=)S
(SC_SIGCONTEXT;)588 1698 A
1890 V
(15186)210 648 A
1980 V
(15187)210 648 A
(sc.sc_mask)420 1110 A
1572(=)S
(smsg.sm_mask;)546 1656 A
2070 V
(15188)210 648 A
2160 V
(15189)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(sigcontext)420 1614 A
(structure)378 2076 A
2496(to)S
(the)126 2622 A
(user's)252 2790 A
(stack.)252 3084 A
3378(*/)S
2250 V
(15190)210 648 A
(dst_phys)336 1110 A
1488(=)S
(umap\(rp,)336 1572 A
1950(D,)S
(\(vir_bytes\))462 2076 A
(scp,)168 2580 A
2340 V
(15191)210 648 A
(\(vir_bytes\))462 1782 A
(sizeof\(struct)546 2286 A
(sigcontext\)\);)546 2874 A
2430 V
(15192)210 648 A
1110(if)S
(\(dst_phys)378 1236 A
1656(==)S
1782(0\))S
(return\(EFAULT\);)630 1908 A
2520 V
(15193)210 648 A
(phys_copy\(vir2phys\(&sc\),)1008 1110 A
(dst_phys,)378 2160 A
(\(phys_bytes\))504 2580 A
(sizeof\(struct)546 3126 A
(sigcontext\)\);)546 3714 A
2610 V
(15194)210 648 A
2700 V
(15195)210 648 A
1110(/*)S
(Initialize)420 1236 A
(the)126 1698 A
(sigframe)336 1866 A
(structure.)420 2244 A
2706(*/)S
2790 V
(15196)210 648 A
(frp)126 1110 A
1278(=)S
(\(struct)294 1362 A
(sigframe)336 1698 A
2076(*\))S
(scp)126 2202 A
2370(-)S
2454(1;)S
2880 V
(15197)210 648 A
(fr.sf_scpcopy)546 1110 A
1698(=)S
(scp;)168 1782 A
2970 V
(15198)210 648 A
(fr.sf_retadr2=)588 1110 A
(\(void)210 1740 A
(\(*\)\(\)\))252 1992 A
(rp->p_reg.pc;)546 2286 A
3060 V
(15199)210 648 A
(fr.sf_fp)336 1110 A
1488(=)S
(rp->p_reg.fp;)546 1572 A
3150 V
(15200)210 648 A
(rp->p_reg.fp)504 1110 A
1656(=)S
(\(reg_t\))294 1740 A
(&frp->sf_fp;)504 2076 A
3240 V
(15201)210 648 A
(fr.sf_scp)378 1110 A
1530(=)S
(scp;)168 1614 A
3330 V
(15202)210 648 A
(fr.sf_code)420 1110 A
1572(=)S
1656(0;)S
2034(/*)S
(XXX)126 2160 A
2328(-)S
(should)252 2412 A
2706(be)S
(used)168 2832 A
(for)126 3042 A
(type)168 3210 A
3420(of)S
3546(FP)S
(exception)378 3672 A
4092(*/)S
3420 V
(15203)210 648 A
(fr.sf_signo)462 1110 A
1614(=)S
(smsg.sm_signo;)588 1698 A
3510 V
(15204)210 648 A
(fr.sf_retadr)504 1110 A
1656(=)S
(\(void)210 1740 A
(\(*\)\(\)\))252 1992 A
(smsg.sm_sigreturn;)756 2286 A
3600 V
(15205)210 648 A
3690 V
(15206)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(sigframe)336 1614 A
(structure)378 1992 A
2412(to)S
(the)126 2538 A
(user's)252 2706 A
(stack.)252 3000 A
3294(*/)S
3780 V
(15207)210 648 A
(dst_phys)336 1110 A
1488(=)S
(umap\(rp,)336 1572 A
1950(D,)S
(\(vir_bytes\))462 2076 A
(frp,)168 2580 A
(\(vir_bytes\))462 2790 A
(sizeof\(struct)546 3294 A
(sigframe\)\);)462 3882 A
3870 V
(15208)210 648 A
1110(if)S
(\(dst_phys)378 1236 A
1656(==)S
1782(0\))S
(return\(EFAULT\);)630 1908 A
3960 V
(15209)210 648 A
(phys_copy\(vir2phys\(&fr\),)1008 1110 A
(dst_phys,)378 2160 A
(\(phys_bytes\))504 2580 A
(sizeof\(struct)546 3126 A
(sigframe\)\);)462 3714 A
4050 V
(15210)210 648 A
4140 V
(15211)210 648 A
1110(/*)S
(Reset)210 1236 A
(user)168 1488 A
(registers)378 1698 A
2118(to)S
(execute)294 2244 A
(the)126 2580 A
(signal)252 2748 A
(handler.)336 3042 A
3420(*/)S
4230 V
(15212)210 648 A
(rp->p_reg.sp)504 1110 A
1656(=)S
(\(reg_t\))294 1740 A
(frp;)168 2076 A
4320 V
(15213)210 648 A
(rp->p_reg.pc)504 1110 A
1656(=)S
(\(reg_t\))294 1740 A
(smsg.sm_sighandler;)798 2076 A
4410 V
(15214)210 648 A
4500 V
(15215)210 648 A
(return\(OK\);)462 1110 A
4590 V
(15216)210 648 A
1026(})S
4770 V
(15218)210 648 A
(/*===========================================================================*)3276 1026 A
4860 V
(15219)210 648 A
1068(*)S
(do_sigreturn)504 2286 A
4260(*)S
4950 V
(15220)210 648 A
(*===========================================================================*/)3276 1068 A
5040 V
(15221)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_sigreturn\(m_ptr\))798 1530 A
5130 V
(15222)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
5220 V
(15223)210 648 A
1026({)S
5310 V
(15224)210 648 A
1026(/*)S
(POSIX)210 1152 A
(style)210 1404 A
(signals)294 1656 A
(require)294 1992 A
(sys_sigreturn)546 2328 A
2916(to)S
(put)126 3042 A
(things)252 3210 A
3504(in)S
(order)210 3630 A
(before)252 3882 A
(the)126 4176 A
5400 V
(15225)210 648 A
1068(*)S
(signalled)378 1152 A
(process)294 1572 A
(can)126 1908 A
(resume)252 2076 A
(execution)378 2370 A
5490 V
(15226)210 648 A
1068(*/)S
5580 V
(15227)210 648 A
5670 V
(15228)210 648 A
(struct)252 1110 A
(sigcontext)420 1404 A
(sc;)126 1866 A
5760 V
(15229)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
5850 V
(15230)210 648 A
(phys_bytes)420 1110 A
(src_phys;)378 1572 A
5940 V
(15231)210 648 A
6030 V
(15232)210 648 A
1110(if)S
(\(!isokusern\(m_ptr->PROC1\)\))1092 1236 A
(return\(E_BAD_PROC\);)798 2370 A
6120 V
(15233)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(m_ptr->PROC1\);)1008 1320 A
6210 V
(15234)210 648 A
8418 V
EP
%%Page: 213 213
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1993(File:)S
2226(src/kernel/system.c)S
12 B
(213)180 4248 A
900 V
7 LST
(15235)210 648 A
1110(/*)S
(Copy)168 1236 A
1446(in)S
(the)126 1572 A
(sigcontext)420 1740 A
(structure.)420 2202 A
2664(*/)S
990 V
(15236)210 648 A
(src_phys)336 1110 A
1488(=)S
(umap\(rp,)336 1572 A
1950(D,)S
(\(vir_bytes\))462 2076 A
(m_ptr->SIG_CTXT_PTR,)840 2580 A
1080 V
(15237)210 648 A
(\(vir_bytes\))462 1782 A
(sizeof\(struct)546 2286 A
(sigcontext\)\);)546 2874 A
1170 V
(15238)210 648 A
1110(if)S
(\(src_phys)378 1236 A
1656(==)S
1782(0\))S
(return\(EFAULT\);)630 1908 A
1260 V
(15239)210 648 A
(phys_copy\(src_phys,)798 1110 A
(vir2phys\(&sc\),)588 1950 A
(\(phys_bytes\))504 2580 A
(sizeof\(struct)546 3126 A
(sigcontext\)\);)546 3714 A
1350 V
(15240)210 648 A
1440 V
(15241)210 648 A
1110(/*)S
(Make)168 1236 A
(sure)168 1446 A
(that)168 1656 A
(this)168 1866 A
2076(is)S
(not)126 2202 A
(just)168 2370 A
2580(a)S
(jmp_buf.)336 2664 A
3042(*/)S
1530 V
(15242)210 648 A
1110(if)S
(\(\(sc.sc_flags)546 1236 A
1824(&)S
(SC_SIGCONTEXT\))588 1908 A
2538(==)S
2664(0\))S
(return\(EINVAL\);)630 2790 A
1620 V
(15243)210 648 A
1710 V
(15244)210 648 A
1110(/*)S
(Fix)126 1236 A
1404(up)S
(only)168 1530 A
(certain)294 1740 A
(key)126 2076 A
(registers)378 2244 A
2664(if)S
(the)126 2790 A
(compiler)336 2958 A
(doesn't)294 3336 A
(use)126 3672 A
1800 V
(15245)210 648 A
1152(*)S
(register)336 1236 A
(variables)378 1614 A
(within)252 2034 A
(functions)378 2328 A
(containing)420 2748 A
(setjmp.)294 3210 A
1890 V
(15246)210 648 A
1152(*/)S
1980 V
(15247)210 648 A
1110(if)S
(\(sc.sc_flags)504 1236 A
1782(&)S
(SC_NOREGLOCALS\))630 1866 A
2538({)S
2070 V
(15248)210 648 A
(rp->p_reg.retreg)672 1362 A
2076(=)S
(sc.sc_retreg;)546 2160 A
2160 V
(15249)210 648 A
(rp->p_reg.fp)504 1362 A
1908(=)S
(sc.sc_fp;)378 1992 A
2250 V
(15250)210 648 A
(rp->p_reg.pc)504 1362 A
1908(=)S
(sc.sc_pc;)378 1992 A
2340 V
(15251)210 648 A
(rp->p_reg.sp)504 1362 A
1908(=)S
(sc.sc_sp;)378 1992 A
2430 V
(15252)210 648 A
(return)252 1362 A
(\(OK\);)210 1656 A
2520 V
(15253)210 648 A
1110(})S
2610 V
(15254)210 648 A
(sc.sc_psw)378 1110 A
1572(=)S
(rp->p_reg.psw;)588 1656 A
2700 V
(15255)210 648 A
2790 V
(15256)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
2880 V
(15257)210 648 A
1110(/*)S
(Don't)210 1236 A
(panic)210 1488 A
(kernel)252 1740 A
2034(if)S
(user)168 2160 A
(gave)168 2370 A
(bad)126 2580 A
(selectors.)420 2748 A
3210(*/)S
2970 V
(15258)210 648 A
(sc.sc_cs)336 1110 A
1488(=)S
(rp->p_reg.cs;)546 1572 A
3060 V
(15259)210 648 A
(sc.sc_ds)336 1110 A
1488(=)S
(rp->p_reg.ds;)546 1572 A
3150 V
(15260)210 648 A
(sc.sc_es)336 1110 A
1488(=)S
(rp->p_reg.es;)546 1572 A
3240 V
(15261)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(4)S
3330 V
(15262)210 648 A
(sc.sc_fs)336 1110 A
1488(=)S
(rp->p_reg.fs;)546 1572 A
3420 V
(15263)210 648 A
(sc.sc_gs)336 1110 A
1488(=)S
(rp->p_reg.gs;)546 1572 A
3510 V
(15264)210 648 A
(#endif)252 1026 A
3600 V
(15265)210 648 A
(#endif)252 1026 A
3690 V
(15266)210 648 A
3780 V
(15267)210 648 A
1110(/*)S
(Restore)294 1236 A
(the)126 1572 A
(registers.)420 1740 A
2202(*/)S
3870 V
(15268)210 648 A
(memcpy\(&rp->p_reg,)756 1110 A
(\(char)210 1908 A
(*\)&sc.sc_regs,)588 2160 A
(sizeof\(struct)546 2790 A
(sigregs\)\);)420 3378 A
3960 V
(15269)210 648 A
4050 V
(15270)210 648 A
(return\(OK\);)462 1110 A
4140 V
(15271)210 648 A
1026(})S
4320 V
(15273)210 648 A
(/*===========================================================================*)3276 1026 A
4410 V
(15274)210 648 A
1068(*)S
(do_kill)294 2370 A
4260(*)S
4500 V
(15275)210 648 A
(*===========================================================================*/)3276 1068 A
4590 V
(15276)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_kill\(m_ptr\))588 1530 A
4680 V
(15277)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
4770 V
(15278)210 648 A
1026({)S
4860 V
(15279)210 648 A
1026(/*)S
(Handle)252 1152 A
(sys_kill\(\).)462 1446 A
(Cause)210 1950 A
2202(a)S
(signal)252 2286 A
2580(to)S
2706(be)S
(sent)168 2832 A
3042(to)S
3168(a)S
(process)294 3252 A
(via)126 3588 A
(MM.)126 3756 A
4950 V
(15280)210 648 A
1068(*)S
(Note)168 1152 A
(that)168 1362 A
(this)168 1572 A
(has)126 1782 A
(nothing)294 1950 A
2286(to)S
2412(do)S
(with)168 2538 A
(the)126 2748 A
(kill)168 2916 A
(\(2\))126 3126 A
(system)252 3294 A
(call,)210 3588 A
(this)168 3840 A
5040 V
(15281)210 648 A
1068(*)S
1152(is)S
(how)126 1278 A
(the)126 1446 A
1614(FS)S
(\(and)168 1740 A
(possibly)336 1950 A
(other)210 2328 A
(servers\))336 2580 A
(get)126 2958 A
(access)252 3126 A
3420(to)S
(cause_sig)378 3546 A
3966(to)S
5130 V
(15282)210 648 A
1068(*)S
(send)168 1152 A
1362(a)S
(KSIG)168 1446 A
(message)294 1656 A
1992(to)S
2118(MM)S
5220 V
(15283)210 648 A
1068(*/)S
5310 V
(15284)210 648 A
5400 V
(15285)210 648 A
1110(if)S
(\(!isokusern\(m_ptr->PR\)\))966 1236 A
(return\(E_BAD_PROC\);)798 2244 A
5490 V
(15286)210 648 A
(cause_sig\(m_ptr->PR,)840 1110 A
(m_ptr->SIGNUM\);)630 1992 A
5580 V
(15287)210 648 A
(return\(OK\);)462 1110 A
5670 V
(15288)210 648 A
1026(})S
5940 V
(15291)210 648 A
(/*===========================================================================*)3276 1026 A
6030 V
(15292)210 648 A
1068(*)S
(do_endsig)378 2286 A
4260(*)S
6120 V
(15293)210 648 A
(*===========================================================================*/)3276 1068 A
6210 V
(15294)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_endsig\(m_ptr\))672 1530 A
8418 V
EP
%%Page: 214 214
BP
/slant 0 def
/height 0 def
630 V
12 B
(214)180 648 A
11 R
1993(File:)S
2226(src/kernel/system.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(15295)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
990 V
(15296)210 648 A
1026({)S
1080 V
(15297)210 648 A
1026(/*)S
(Finish)252 1152 A
1446(up)S
(after)210 1572 A
1824(a)S
(KSIG-type)378 1908 A
(signal,)294 2328 A
(caused)252 2664 A
2958(by)S
3084(a)S
(SYS_KILL)336 3168 A
(message)294 3546 A
3882(or)S
4008(a)S
(call)168 4092 A
1170 V
(15298)210 648 A
1068(*)S
1152(to)S
(cause_sig)378 1278 A
1698(by)S
1824(a)S
(task)168 1908 A
1260 V
(15299)210 648 A
1068(*/)S
1350 V
(15300)210 648 A
1440 V
(15301)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
1530 V
(15302)210 648 A
1620 V
(15303)210 648 A
1110(if)S
(\(!isokusern\(m_ptr->PROC1\)\))1092 1236 A
(return\(E_BAD_PROC\);)798 2370 A
1710 V
(15304)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(m_ptr->PROC1\);)1008 1320 A
1800 V
(15305)210 648 A
1890 V
(15306)210 648 A
1110(/*)S
1236(MM)S
(has)126 1362 A
(finished)336 1530 A
(one)126 1908 A
(KSIG.)210 2076 A
2328(*/)S
1980 V
(15307)210 648 A
1110(if)S
(\(rp->p_pendcount)672 1236 A
1950(!=)S
2076(0)S
2160(&&)S
(--rp->p_pendcount)714 2286 A
3042(==)S
3168(0)S
2070 V
(15308)210 648 A
1278(&&)S
(\(rp->p_flags)504 1404 A
1950(&=)S
(\304SIG_PENDING\))546 2076 A
2664(==)S
2790(0\))S
2160 V
(15309)210 648 A
(lock_ready\(rp\);)630 1362 A
2250 V
(15310)210 648 A
(return\(OK\);)462 1110 A
2340 V
(15311)210 648 A
1026(})S
2520 V
(15313)210 648 A
(/*===========================================================================*)3276 1026 A
2610 V
(15314)210 648 A
1068(*)S
(do_copy)294 2370 A
4260(*)S
2700 V
(15315)210 648 A
(*===========================================================================*/)3276 1068 A
2790 V
(15316)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_copy\(m_ptr\))588 1530 A
2880 V
(15317)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
2970 V
(15318)210 648 A
1026({)S
3060 V
(15319)210 648 A
1026(/*)S
(Handle)252 1152 A
(sys_copy\(\).)462 1446 A
(Copy)168 1992 A
(data)168 2202 A
(for)126 2412 A
2580(MM)S
2706(or)S
(FS.)126 2832 A
3000(*/)S
3150 V
(15320)210 648 A
3240 V
(15321)210 648 A
(int)126 1110 A
(src_proc,)378 1278 A
(dst_proc,)378 1698 A
(src_space,)420 2118 A
(dst_space;)420 2580 A
3330 V
(15322)210 648 A
(vir_bytes)378 1110 A
(src_vir,)336 1530 A
(dst_vir;)336 1908 A
3420 V
(15323)210 648 A
(phys_bytes)420 1110 A
(src_phys,)378 1572 A
(dst_phys,)378 1992 A
(bytes;)252 2412 A
3510 V
(15324)210 648 A
3600 V
(15325)210 648 A
1110(/*)S
(Dismember)378 1236 A
(the)126 1656 A
(command)294 1824 A
(message.)336 2160 A
2538(*/)S
3690 V
(15326)210 648 A
(src_proc)336 1110 A
1488(=)S
(m_ptr->SRC_PROC_NR;)798 1572 A
3780 V
(15327)210 648 A
(dst_proc)336 1110 A
1488(=)S
(m_ptr->DST_PROC_NR;)798 1572 A
3870 V
(15328)210 648 A
(src_space)378 1110 A
1530(=)S
(m_ptr->SRC_SPACE;)714 1614 A
3960 V
(15329)210 648 A
(dst_space)378 1110 A
1530(=)S
(m_ptr->DST_SPACE;)714 1614 A
4050 V
(15330)210 648 A
(src_vir)294 1110 A
1446(=)S
(\(vir_bytes\))462 1530 A
(m_ptr->SRC_BUFFER;)756 2034 A
4140 V
(15331)210 648 A
(dst_vir)294 1110 A
1446(=)S
(\(vir_bytes\))462 1530 A
(m_ptr->DST_BUFFER;)756 2034 A
4230 V
(15332)210 648 A
(bytes)210 1110 A
1362(=)S
(\(phys_bytes\))504 1446 A
(m_ptr->COPY_BYTES;)756 1992 A
4320 V
(15333)210 648 A
4410 V
(15334)210 648 A
1110(/*)S
(Compute)294 1236 A
(the)126 1572 A
(source)252 1740 A
(and)126 2034 A
(destination)462 2202 A
(addresses)378 2706 A
(and)126 3126 A
3294(do)S
(the)126 3420 A
(copy.)210 3588 A
3840(*/)S
4500 V
(15335)210 648 A
1110(if)S
(\(src_proc)378 1236 A
1656(==)S
(ABS\))168 1782 A
4590 V
(15336)210 648 A
(src_phys)336 1362 A
1740(=)S
(\(phys_bytes\))504 1824 A
(m_ptr->SRC_BUFFER;)756 2370 A
4680 V
(15337)210 648 A
(else)168 1110 A
1320({)S
4770 V
(15338)210 648 A
1362(if)S
(\(bytes)252 1488 A
1782(!=)S
(\(vir_bytes\))462 1908 A
(bytes\))252 2412 A
4860 V
(15339)210 648 A
1698(/*)S
(This)168 1824 A
(would)210 2034 A
(happen)252 2286 A
(for)126 2580 A
(64K)126 2748 A
(segments)336 2916 A
(and)126 3294 A
(16-bit)252 3462 A
(vir_bytes.)420 3756 A
4950 V
(15340)210 648 A
1740(*)S
1824(It)S
(would)210 1950 A
(happen)252 2202 A
2496(a)S
(lot)126 2580 A
(for)126 2748 A
(do_fork)294 2916 A
(except)252 3252 A
3546(MM)S
(uses)168 3672 A
(ABS)126 3882 A
5040 V
(15341)210 648 A
1740(*)S
(copies)252 1824 A
(for)126 2118 A
(that)168 2286 A
(case.)210 2496 A
5130 V
(15342)210 648 A
1740(*/)S
5220 V
(15343)210 648 A
(panic\("overflow)630 1698 A
2370(in)S
(count)210 2496 A
2748(in)S
(do_copy",)378 2874 A
(NO_NUM\);)336 3294 A
5310 V
(15344)210 648 A
5400 V
(15345)210 648 A
(src_phys)336 1362 A
1740(=)S
(umap\(proc_addr\(src_proc\),)1050 1824 A
(src_space,)420 2916 A
(src_vir,)336 3378 A
5490 V
(15346)210 648 A
(\(vir_bytes\))462 2034 A
(bytes\);)294 2538 A
5580 V
(15347)210 648 A
1362(})S
5670 V
(15348)210 648 A
5760 V
(15349)210 648 A
1110(if)S
(\(dst_proc)378 1236 A
1656(==)S
(ABS\))168 1782 A
5850 V
(15350)210 648 A
(dst_phys)336 1362 A
1740(=)S
(\(phys_bytes\))504 1824 A
(m_ptr->DST_BUFFER;)756 2370 A
5940 V
(15351)210 648 A
(else)168 1110 A
6030 V
(15352)210 648 A
(dst_phys)336 1362 A
1740(=)S
(umap\(proc_addr\(dst_proc\),)1050 1824 A
(dst_space,)420 2916 A
(dst_vir,)336 3378 A
6120 V
(15353)210 648 A
(\(vir_bytes\))462 2034 A
(bytes\);)294 2538 A
6210 V
(15354)210 648 A
8418 V
EP
%%Page: 215 215
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1993(File:)S
2226(src/kernel/system.c)S
12 B
(215)180 4248 A
900 V
7 LST
(15355)210 648 A
1110(if)S
(\(src_phys)378 1236 A
1656(==)S
1782(0)S
1866(||)S
(dst_phys)336 1992 A
2370(==)S
2496(0\))S
(return\(EFAULT\);)630 2622 A
990 V
(15356)210 648 A
(phys_copy\(src_phys,)798 1110 A
(dst_phys,)378 1950 A
(bytes\);)294 2370 A
1080 V
(15357)210 648 A
(return\(OK\);)462 1110 A
1170 V
(15358)210 648 A
1026(})S
1440 V
(15361)210 648 A
(/*===========================================================================*)3276 1026 A
1530 V
(15362)210 648 A
1068(*)S
(do_vcopy)336 2370 A
4260(*)S
1620 V
(15363)210 648 A
(*===========================================================================*/)3276 1068 A
1710 V
(15364)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_vcopy\(m_ptr\))630 1530 A
1800 V
(15365)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
1890 V
(15366)210 648 A
1026({)S
1980 V
(15367)210 648 A
1026(/*)S
(Handle)252 1152 A
(sys_vcopy\(\).)504 1446 A
(Copy)168 1992 A
(multiple)336 2202 A
(blocks)252 2580 A
2874(of)S
(memory)252 3000 A
3294(*/)S
2070 V
(15368)210 648 A
2160 V
(15369)210 648 A
(int)126 1110 A
(src_proc,)378 1278 A
(dst_proc,)378 1698 A
(vect_s,)294 2118 A
2454(i;)S
2250 V
(15370)210 648 A
(vir_bytes)378 1110 A
(src_vir,)336 1530 A
(dst_vir,)336 1908 A
(vect_addr;)420 2286 A
2340 V
(15371)210 648 A
(phys_bytes)420 1110 A
(src_phys,)378 1572 A
(dst_phys,)378 1992 A
(bytes;)252 2412 A
2430 V
(15372)210 648 A
(cpvec_t)294 1110 A
(cpvec_table[CPVEC_NR];)924 1446 A
2520 V
(15373)210 648 A
2610 V
(15374)210 648 A
1110(/*)S
(Dismember)378 1236 A
(the)126 1656 A
(command)294 1824 A
(message.)336 2160 A
2538(*/)S
2700 V
(15375)210 648 A
(src_proc)336 1110 A
1488(=)S
(m_ptr->m1_i1;)546 1572 A
2790 V
(15376)210 648 A
(dst_proc)336 1110 A
1488(=)S
(m_ptr->m1_i2;)546 1572 A
2880 V
(15377)210 648 A
(vect_s)252 1110 A
1404(=)S
(m_ptr->m1_i3;)546 1488 A
2970 V
(15378)210 648 A
(vect_addr)378 1110 A
1530(=)S
(\(vir_bytes\)m_ptr->m1_p1;)1008 1614 A
3060 V
(15379)210 648 A
3150 V
(15380)210 648 A
1110(if)S
(\(vect_s)294 1236 A
1572(>)S
(CPVEC_NR\))378 1656 A
(return)252 2076 A
(EDOM;)210 2370 A
3240 V
(15381)210 648 A
3330 V
(15382)210 648 A
(src_phys=)378 1110 A
(numap)210 1530 A
(\(m_ptr->m_source,)714 1782 A
(vect_addr,)420 2538 A
(vect_s)252 3000 A
3294(*)S
(sizeof\(cpvec_t\)\);)714 3378 A
3420 V
(15383)210 648 A
1110(if)S
(\(!src_phys\))462 1236 A
(return)252 1740 A
(EFAULT;)294 2034 A
3510 V
(15384)210 648 A
(phys_copy\(src_phys,)798 1110 A
(vir2phys\(cpvec_table\),)924 1950 A
3600 V
(15385)210 648 A
(\(phys_bytes\))504 2370 A
(\(vect_s)294 2916 A
3252(*)S
(sizeof\(cpvec_t\)\)\);)756 3336 A
3690 V
(15386)210 648 A
3780 V
(15387)210 648 A
(for)126 1110 A
1278(\(i)S
1404(=)S
1488(0;)S
1614(i)S
1698(<)S
(vect_s;)294 1782 A
(i++\))168 2118 A
2328({)S
3870 V
(15388)210 648 A
(src_vir=)336 1362 A
(cpvec_table[i].cpv_src;)966 1740 A
3960 V
(15389)210 648 A
(dst_vir=)336 1362 A
(cpvec_table[i].cpv_dst;)966 1740 A
4050 V
(15390)210 648 A
(bytes=)252 1362 A
(cpvec_table[i].cpv_size;)1008 1656 A
4140 V
(15391)210 648 A
(src_phys)336 1362 A
1740(=)S
(numap\(src_proc,src_vir,\(vir_bytes\)bytes\);)1722 1824 A
4230 V
(15392)210 648 A
(dst_phys)336 1362 A
1740(=)S
(numap\(dst_proc,dst_vir,\(vir_bytes\)bytes\);)1722 1824 A
4320 V
(15393)210 648 A
1362(if)S
(\(src_phys)378 1488 A
1908(==)S
2034(0)S
2118(||)S
(dst_phys)336 2244 A
2622(==)S
2748(0\))S
(return\(EFAULT\);)630 2874 A
4410 V
(15394)210 648 A
(phys_copy\(src_phys,)798 1362 A
(dst_phys,)378 2202 A
(bytes\);)294 2622 A
4500 V
(15395)210 648 A
1110(})S
4590 V
(15396)210 648 A
(return\(OK\);)462 1110 A
4680 V
(15397)210 648 A
1026(})S
4950 V
(15400)210 648 A
(/*==========================================================================*)3234 1026 A
5040 V
(15401)210 648 A
1068(*)S
(do_gboot)336 2370 A
4218(*)S
5130 V
(15402)210 648 A
(*==========================================================================*/)3234 1068 A
5220 V
(15403)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(bparam_s)336 1614 A
(boot_parameters;)672 1992 A
5310 V
(15404)210 648 A
5400 V
(15405)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_gboot\(m_ptr\))630 1530 A
5490 V
(15406)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
5580 V
(15407)210 648 A
1026({)S
5670 V
(15408)210 648 A
1026(/*)S
(Copy)168 1152 A
(the)126 1362 A
(boot)168 1530 A
(parameters.)462 1740 A
(Normally)336 2286 A
(only)168 2664 A
(called)252 2874 A
(during)252 3168 A
3462(fs)S
(init.)210 3588 A
3840(*/)S
5760 V
(15409)210 648 A
5850 V
(15410)210 648 A
(phys_bytes)420 1110 A
(dst_phys;)378 1572 A
5940 V
(15411)210 648 A
6030 V
(15412)210 648 A
(dst_phys)336 1110 A
1488(=)S
(umap\(proc_addr\(m_ptr->PROC1\),)1218 1572 A
2832(D,)S
(\(vir_bytes\))462 2958 A
(m_ptr->MEM_PTR,)630 3462 A
6120 V
(15413)210 648 A
(\(vir_bytes\))462 2370 A
(sizeof\(boot_parameters\)\);)1050 2874 A
6210 V
(15414)210 648 A
1110(if)S
(\(dst_phys)378 1236 A
1656(==)S
1782(0\))S
(panic\("bad)420 1908 A
(call)168 2370 A
2580(to)S
(SYS_GBOOT",)462 2706 A
(NO_NUM\);)336 3210 A
8418 V
EP
%%Page: 216 216
BP
/slant 0 def
/height 0 def
630 V
12 B
(216)180 648 A
11 R
1993(File:)S
2226(src/kernel/system.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(15415)210 648 A
(phys_copy\(vir2phys\(&boot_parameters\),)1554 1110 A
(dst_phys,)378 2706 A
990 V
(15416)210 648 A
(\(phys_bytes\))504 2370 A
(sizeof\(boot_parameters\)\);)1050 2916 A
1080 V
(15417)210 648 A
(return\(OK\);)462 1110 A
1170 V
(15418)210 648 A
1026(})S
1440 V
(15421)210 648 A
(/*===========================================================================*)3276 1026 A
1530 V
(15422)210 648 A
1068(*)S
(do_mem)252 2370 A
4260(*)S
1620 V
(15423)210 648 A
(*===========================================================================*/)3276 1068 A
1710 V
(15424)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_mem\(m_ptr\))546 1530 A
1800 V
(15425)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
1890 V
(15426)210 648 A
1026({)S
1980 V
(15427)210 648 A
1026(/*)S
(Return)252 1152 A
(the)126 1446 A
(base)168 1614 A
(and)126 1824 A
(size)168 1992 A
2202(of)S
(the)126 2328 A
(next)168 2496 A
(chunk)210 2706 A
2958(of)S
(memory.)294 3084 A
3420(*/)S
2070 V
(15428)210 648 A
2160 V
(15429)210 648 A
(struct)252 1110 A
(memory)252 1404 A
(*memp;)252 1698 A
2250 V
(15430)210 648 A
2340 V
(15431)210 648 A
(for)126 1110 A
(\(memp)210 1278 A
1530(=)S
(mem;)168 1614 A
(memp)168 1824 A
2034(<)S
(&mem[NR_MEMS];)588 2118 A
(++memp\))294 2748 A
3084({)S
2430 V
(15432)210 648 A
(m_ptr->m1_i1)504 1362 A
1908(=)S
(memp->base;)462 1992 A
2520 V
(15433)210 648 A
(m_ptr->m1_i2)504 1362 A
1908(=)S
(memp->size;)462 1992 A
2610 V
(15434)210 648 A
(m_ptr->m1_i3)504 1362 A
1908(=)S
(tot_mem_size;)546 1992 A
2700 V
(15435)210 648 A
(memp->size)420 1362 A
1824(=)S
1908(0;)S
2790 V
(15436)210 648 A
1362(if)S
(\(m_ptr->m1_i2)546 1488 A
2076(!=)S
2202(0\))S
(break;)252 2328 A
3042(/*)S
(found)210 3168 A
3420(a)S
(chunk)210 3504 A
3756(*/)S
2880 V
(15437)210 648 A
1110(})S
2970 V
(15438)210 648 A
(return\(OK\);)462 1110 A
3060 V
(15439)210 648 A
1026(})S
3330 V
(15442)210 648 A
(/*==========================================================================*)3234 1026 A
3420 V
(15443)210 648 A
1068(*)S
(do_umap)294 2370 A
4218(*)S
3510 V
(15444)210 648 A
(*==========================================================================*/)3234 1068 A
3600 V
(15445)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_umap\(m_ptr\))588 1530 A
3690 V
(15446)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(request)294 2958 A
(message)294 3294 A
3630(*/)S
3780 V
(15447)210 648 A
1026({)S
3870 V
(15448)210 648 A
1026(/*)S
(Same)168 1152 A
1362(as)S
(umap\(\),)294 1488 A
(for)126 1824 A
(non-kernel)420 1992 A
(processes.)420 2454 A
2916(*/)S
3960 V
(15449)210 648 A
4050 V
(15450)210 648 A
(m_ptr->SRC_BUFFER)714 1110 A
1866(=)S
(umap\(proc_addr\(\(int\))840 1950 A
(m_ptr->SRC_PROC_NR\),)840 2832 A
4140 V
(15451)210 648 A
(\(int\))210 2160 A
(m_ptr->SRC_SPACE,)714 2412 A
4230 V
(15452)210 648 A
(\(vir_bytes\))462 2160 A
(m_ptr->SRC_BUFFER,)756 2664 A
4320 V
(15453)210 648 A
(\(vir_bytes\))462 2160 A
(m_ptr->COPY_BYTES\);)798 2664 A
4410 V
(15454)210 648 A
(return\(OK\);)462 1110 A
4500 V
(15455)210 648 A
1026(})S
4770 V
(15458)210 648 A
(/*==========================================================================*)3234 1026 A
4860 V
(15459)210 648 A
1068(*)S
(do_trace)336 2370 A
4218(*)S
4950 V
(15460)210 648 A
(*==========================================================================*/)3234 1068 A
5040 V
(15461)210 648 A
(#define)294 1026 A
(TR_PROCNR)378 1362 A
(\(m_ptr->m2_i1\))588 2034 A
5130 V
(15462)210 648 A
(#define)294 1026 A
(TR_REQUEST)420 1362 A
(\(m_ptr->m2_i2\))588 2034 A
5220 V
(15463)210 648 A
(#define)294 1026 A
(TR_ADDR)294 1362 A
(\(\(vir_bytes\))504 2034 A
(m_ptr->m2_l1\))546 2580 A
5310 V
(15464)210 648 A
(#define)294 1026 A
(TR_DATA)294 1362 A
(\(m_ptr->m2_l2\))588 2034 A
5400 V
(15465)210 648 A
(#define)294 1026 A
(TR_VLSIZE)378 1362 A
(\(\(vir_bytes\))504 2034 A
(sizeof\(long\)\))546 2580 A
5490 V
(15466)210 648 A
5580 V
(15467)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(do_trace\(m_ptr\))630 1530 A
5670 V
(15468)210 648 A
(register)336 1026 A
(message)294 1404 A
(*m_ptr;)294 1740 A
5760 V
(15469)210 648 A
1026({)S
5850 V
(15470)210 648 A
1026(/*)S
(Handle)252 1152 A
(the)126 1446 A
(debugging)378 1614 A
(commands)336 2034 A
(supported)378 2412 A
2832(by)S
(the)126 2958 A
(ptrace)252 3126 A
(system)252 3420 A
(call)168 3714 A
5940 V
(15471)210 648 A
1068(*)S
(The)126 1152 A
(commands)336 1320 A
(are:)168 1698 A
6030 V
(15472)210 648 A
1068(*)S
(T_STOP)252 1152 A
(stop)168 1698 A
(the)126 1908 A
(process)294 2076 A
6120 V
(15473)210 648 A
1068(*)S
(T_OK)168 1152 A
(enable)252 1698 A
(tracing)294 1992 A
2328(by)S
(parent)252 2454 A
(for)126 2748 A
(this)168 2916 A
(process)294 3126 A
6210 V
(15474)210 648 A
1068(*)S
(T_GETINS)336 1152 A
(return)252 1698 A
(value)210 1992 A
(from)168 2244 A
(instruction)462 2454 A
(space)210 2958 A
8418 V
EP
%%Page: 217 217
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1993(File:)S
2226(src/kernel/system.c)S
12 B
(217)180 4248 A
900 V
7 LST
(15475)210 648 A
1068(*)S
(T_GETDATA)378 1152 A
(return)252 1698 A
(value)210 1992 A
(from)168 2244 A
(data)168 2454 A
(space)210 2664 A
990 V
(15476)210 648 A
1068(*)S
(T_GETUSER)378 1152 A
(return)252 1698 A
(value)210 1992 A
(from)168 2244 A
(user)168 2454 A
(process)294 2664 A
(table)210 3000 A
1080 V
(15477)210 648 A
1068(*)S
(T_SETINS)336 1152 A
(set)126 1698 A
(value)210 1866 A
(from)168 2118 A
(instruction)462 2328 A
(space)210 2832 A
1170 V
(15478)210 648 A
1068(*)S
(T_SETDATA)378 1152 A
(set)126 1698 A
(value)210 1866 A
(from)168 2118 A
(data)168 2328 A
(space)210 2538 A
1260 V
(15479)210 648 A
1068(*)S
(T_SETUSER)378 1152 A
(set)126 1698 A
(value)210 1866 A
2118(in)S
(user)168 2244 A
(process)294 2454 A
(table)210 2790 A
1350 V
(15480)210 648 A
1068(*)S
(T_RESUME)336 1152 A
(resume)252 1698 A
(execution)378 1992 A
1440 V
(15481)210 648 A
1068(*)S
(T_EXIT)252 1152 A
(exit)168 1698 A
1530 V
(15482)210 648 A
1068(*)S
(T_STEP)252 1152 A
(set)126 1698 A
(trace)210 1866 A
(bit)126 2118 A
1620 V
(15483)210 648 A
1068(*)S
1710 V
(15484)210 648 A
1068(*)S
(The)126 1152 A
(T_OK)168 1320 A
(and)126 1530 A
(T_EXIT)252 1698 A
(commands)336 1992 A
(are)126 2370 A
(handled)294 2538 A
(completely)420 2874 A
3336(by)S
(the)126 3462 A
(memory)252 3630 A
(manager,)336 3924 A
1800 V
(15485)210 648 A
1068(*)S
(all)126 1152 A
(others)252 1320 A
(come)168 1614 A
(here.)210 1824 A
1890 V
(15486)210 648 A
1068(*/)S
1980 V
(15487)210 648 A
2070 V
(15488)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
2160 V
(15489)210 648 A
(phys_bytes)420 1110 A
(src,)168 1572 A
(dst;)168 1782 A
2250 V
(15490)210 648 A
(int)126 1110 A
1278(i;)S
2340 V
(15491)210 648 A
2430 V
(15492)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(TR_PROCNR\);)882 1320 A
2520 V
(15493)210 648 A
1110(if)S
(\(rp->p_flags)504 1236 A
1782(&)S
(P_SLOT_FREE\))504 1866 A
(return\(EIO\);)504 2412 A
2610 V
(15494)210 648 A
(switch)252 1110 A
(\(TR_REQUEST\))504 1404 A
1950({)S
2700 V
(15495)210 648 A
(case)168 1110 A
(T_STOP:)294 1320 A
2370(/*)S
(stop)168 2496 A
(process)294 2706 A
3042(*/)S
2790 V
(15496)210 648 A
1362(if)S
(\(rp->p_flags)504 1488 A
2034(==)S
2160(0\))S
(lock_unready\(rp\);)714 2286 A
2880 V
(15497)210 648 A
(rp->p_flags)462 1362 A
1866(|=)S
(P_STOP;)294 1992 A
2970 V
(15498)210 648 A
(rp->p_reg.psw)546 1362 A
1950(&=)S
(\304TRACEBIT;)420 2076 A
2706(/*)S
(clear)210 2832 A
(trace)210 3084 A
(bit)126 3336 A
3504(*/)S
3060 V
(15499)210 648 A
(return\(OK\);)462 1362 A
3150 V
(15500)210 648 A
3240 V
(15501)210 648 A
(case)168 1110 A
(T_GETINS:)378 1320 A
2370(/*)S
(return)252 2496 A
(value)210 2790 A
(from)168 3042 A
(instruction)462 3252 A
(space)210 3756 A
4008(*/)S
3330 V
(15502)210 648 A
1362(if)S
(\(rp->p_map[T].mem_len)882 1488 A
2412(!=)S
2538(0\))S
2664({)S
3420 V
(15503)210 648 A
1698(if)S
(\(\(src)210 1824 A
2076(=)S
(umap\(rp,)336 2160 A
2538(T,)S
(TR_ADDR,)336 2664 A
(TR_VLSIZE\)\))462 3042 A
3546(==)S
3672(0\))S
(return\(EIO\);)504 3798 A
3510 V
(15504)210 648 A
(phys_copy\(src,)588 1698 A
(vir2phys\(&TR_DATA\),)798 2328 A
(\(phys_bytes\))504 3168 A
(sizeof\(long\)\);)588 3714 A
3600 V
(15505)210 648 A
(break;)252 1698 A
3690 V
(15506)210 648 A
1362(})S
3780 V
(15507)210 648 A
1362(/*)S
(Text)168 1488 A
(space)210 1698 A
1950(is)S
(actually)336 2076 A
(data)168 2454 A
(space)210 2664 A
2916(-)S
(fall)168 3000 A
(through.)336 3210 A
3588(*/)S
3870 V
(15508)210 648 A
3960 V
(15509)210 648 A
(case)168 1110 A
(T_GETDATA:)420 1320 A
2370(/*)S
(return)252 2496 A
(value)210 2790 A
(from)168 3042 A
(data)168 3252 A
(space)210 3462 A
3714(*/)S
4050 V
(15510)210 648 A
1362(if)S
(\(\(src)210 1488 A
1740(=)S
(umap\(rp,)336 1824 A
2202(D,)S
(TR_ADDR,)336 2328 A
(TR_VLSIZE\)\))462 2706 A
3210(==)S
3336(0\))S
(return\(EIO\);)504 3462 A
4140 V
(15511)210 648 A
(phys_copy\(src,)588 1362 A
(vir2phys\(&TR_DATA\),)798 1992 A
(\(phys_bytes\))504 2832 A
(sizeof\(long\)\);)588 3378 A
4230 V
(15512)210 648 A
(break;)252 1362 A
4320 V
(15513)210 648 A
4410 V
(15514)210 648 A
(case)168 1110 A
(T_GETUSER:)420 1320 A
2370(/*)S
(return)252 2496 A
(value)210 2790 A
(from)168 3042 A
(process)294 3252 A
(table)210 3588 A
3840(*/)S
4500 V
(15515)210 648 A
1362(if)S
(\(\(TR_ADDR)378 1488 A
1908(&)S
(\(sizeof\(long\))546 1992 A
2580(-)S
(1\)\))126 2664 A
2832(!=)S
2958(0)S
3042(||)S
4590 V
(15516)210 648 A
(TR_ADDR)294 1530 A
1866(>)S
(sizeof\(struct)546 1950 A
(proc\))210 2538 A
2790(-)S
(sizeof\(long\)\))546 2874 A
4680 V
(15517)210 648 A
(return\(EIO\);)504 1698 A
4770 V
(15518)210 648 A
(TR_DATA)294 1362 A
1698(=)S
(*\(long)252 1782 A
2076(*\))S
(\(\(char)252 2202 A
2496(*\))S
2622(rp)S
2748(+)S
(\(int\))210 2832 A
(TR_ADDR\);)378 3084 A
4860 V
(15519)210 648 A
(break;)252 1362 A
4950 V
(15520)210 648 A
5040 V
(15521)210 648 A
(case)168 1110 A
(T_SETINS:)378 1320 A
2370(/*)S
(set)126 2496 A
(value)210 2664 A
2916(in)S
(instruction)462 3042 A
(space)210 3546 A
3798(*/)S
5130 V
(15522)210 648 A
1362(if)S
(\(rp->p_map[T].mem_len)882 1488 A
2412(!=)S
2538(0\))S
2664({)S
5220 V
(15523)210 648 A
1698(if)S
(\(\(dst)210 1824 A
2076(=)S
(umap\(rp,)336 2160 A
2538(T,)S
(TR_ADDR,)336 2664 A
(TR_VLSIZE\)\))462 3042 A
3546(==)S
3672(0\))S
(return\(EIO\);)504 3798 A
5310 V
(15524)210 648 A
(phys_copy\(vir2phys\(&TR_DATA\),)1218 1698 A
(dst,)168 2958 A
(\(phys_bytes\))504 3168 A
(sizeof\(long\)\);)588 3714 A
5400 V
(15525)210 648 A
(TR_DATA)294 1698 A
2034(=)S
2118(0;)S
5490 V
(15526)210 648 A
(break;)252 1698 A
5580 V
(15527)210 648 A
1362(})S
5670 V
(15528)210 648 A
1362(/*)S
(Text)168 1488 A
(space)210 1698 A
1950(is)S
(actually)336 2076 A
(data)168 2454 A
(space)210 2664 A
2916(-)S
(fall)168 3000 A
(through.)336 3210 A
3588(*/)S
5760 V
(15529)210 648 A
5850 V
(15530)210 648 A
(case)168 1110 A
(T_SETDATA:)420 1320 A
2706(/*)S
(set)126 2832 A
(value)210 3000 A
3252(in)S
(data)168 3378 A
(space)210 3588 A
3840(*/)S
5940 V
(15531)210 648 A
1362(if)S
(\(\(dst)210 1488 A
1740(=)S
(umap\(rp,)336 1824 A
2202(D,)S
(TR_ADDR,)336 2328 A
(TR_VLSIZE\)\))462 2706 A
3210(==)S
3336(0\))S
(return\(EIO\);)504 3462 A
6030 V
(15532)210 648 A
(phys_copy\(vir2phys\(&TR_DATA\),)1218 1362 A
(dst,)168 2622 A
(\(phys_bytes\))504 2832 A
(sizeof\(long\)\);)588 3378 A
6120 V
(15533)210 648 A
(TR_DATA)294 1362 A
1698(=)S
1782(0;)S
6210 V
(15534)210 648 A
(break;)252 1362 A
8418 V
EP
%%Page: 218 218
BP
/slant 0 def
/height 0 def
630 V
12 B
(218)180 648 A
11 R
1993(File:)S
2226(src/kernel/system.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(15535)210 648 A
990 V
(15536)210 648 A
(case)168 1110 A
(T_SETUSER:)420 1320 A
2706(/*)S
(set)126 2832 A
(value)210 3000 A
3252(in)S
(process)294 3378 A
(table)210 3714 A
3966(*/)S
1080 V
(15537)210 648 A
1362(if)S
(\(\(TR_ADDR)378 1488 A
1908(&)S
(\(sizeof\(reg_t\))588 1992 A
2622(-)S
(1\)\))126 2706 A
2874(!=)S
3000(0)S
3084(||)S
1170 V
(15538)210 648 A
(TR_ADDR)294 1572 A
1908(>)S
(sizeof\(struct)546 1992 A
(stackframe_s\))546 2580 A
3168(-)S
(sizeof\(reg_t\)\))588 3252 A
1260 V
(15539)210 648 A
(return\(EIO\);)504 1698 A
1350 V
(15540)210 648 A
1362(i)S
1446(=)S
(\(int\))210 1530 A
(TR_ADDR;)336 1782 A
1440 V
(15541)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
1530 V
(15542)210 648 A
1362(/*)S
(Altering)336 1488 A
(segment)294 1866 A
(registers)378 2202 A
(might)210 2622 A
(crash)210 2874 A
(the)126 3126 A
(kernel)252 3294 A
(when)168 3588 A
3798(it)S
1620 V
(15543)210 648 A
1404(*)S
(tries)210 1488 A
1740(to)S
(load)168 1866 A
(them)168 2076 A
(prior)210 2286 A
2538(to)S
(restarting)420 2664 A
3126(a)S
(process,)336 3210 A
3588(so)S
3714(do)S
1710 V
(15544)210 648 A
1404(*)S
(not)126 1488 A
(allow)210 1656 A
(it.)126 1908 A
1800 V
(15545)210 648 A
1404(*/)S
1890 V
(15546)210 648 A
1362(if)S
1488(\(i)S
1614(==)S
(\(int\))210 1740 A
(&\(\(struct)378 1992 A
(proc)168 2412 A
2622(*\))S
(0\)->p_reg.cs)504 2748 A
3294(||)S
1980 V
(15547)210 648 A
1530(i)S
1614(==)S
(\(int\))210 1740 A
(&\(\(struct)378 1992 A
(proc)168 2412 A
2622(*\))S
(0\)->p_reg.ds)504 2748 A
3294(||)S
2070 V
(15548)210 648 A
1530(i)S
1614(==)S
(\(int\))210 1740 A
(&\(\(struct)378 1992 A
(proc)168 2412 A
2622(*\))S
(0\)->p_reg.es)504 2748 A
3294(||)S
2160 V
(15549)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(4)S
2250 V
(15550)210 648 A
1530(i)S
1614(==)S
(\(int\))210 1740 A
(&\(\(struct)378 1992 A
(proc)168 2412 A
2622(*\))S
(0\)->p_reg.gs)504 2748 A
3294(||)S
2340 V
(15551)210 648 A
1530(i)S
1614(==)S
(\(int\))210 1740 A
(&\(\(struct)378 1992 A
(proc)168 2412 A
2622(*\))S
(0\)->p_reg.fs)504 2748 A
3294(||)S
2430 V
(15552)210 648 A
(#endif)252 1026 A
2520 V
(15553)210 648 A
1530(i)S
1614(==)S
(\(int\))210 1740 A
(&\(\(struct)378 1992 A
(proc)168 2412 A
2622(*\))S
(0\)->p_reg.ss\))546 2748 A
2610 V
(15554)210 648 A
(return\(EIO\);)504 1698 A
2700 V
(15555)210 648 A
(#endif)252 1026 A
2790 V
(15556)210 648 A
1362(if)S
1488(\(i)S
1614(==)S
(\(int\))210 1740 A
(&\(\(struct)378 1992 A
(proc)168 2412 A
2622(*\))S
(0\)->p_reg.psw\))588 2748 A
2880 V
(15557)210 648 A
1698(/*)S
(only)168 1824 A
(selected)336 2034 A
(bits)168 2412 A
(are)126 2622 A
(changeable)420 2790 A
3252(*/)S
2970 V
(15558)210 648 A
(SETPSW\(rp,)420 1698 A
(TR_DATA\);)378 2160 A
3060 V
(15559)210 648 A
(else)168 1362 A
3150 V
(15560)210 648 A
(*\(reg_t)294 1698 A
2034(*\))S
(\(\(char)252 2160 A
2454(*\))S
(&rp->p_reg)420 2580 A
3042(+)S
3126(i\))S
3252(=)S
(\(reg_t\))294 3336 A
(TR_DATA;)336 3672 A
3240 V
(15561)210 648 A
(TR_DATA)294 1362 A
1698(=)S
1782(0;)S
3330 V
(15562)210 648 A
(break;)252 1362 A
3420 V
(15563)210 648 A
3510 V
(15564)210 648 A
(case)168 1110 A
(T_RESUME:)378 1320 A
2370(/*)S
(resume)252 2496 A
(execution)378 2790 A
3210(*/)S
3600 V
(15565)210 648 A
(rp->p_flags)462 1362 A
1866(&=)S
(\304P_STOP;)336 1992 A
3690 V
(15566)210 648 A
1362(if)S
(\(rp->p_flags)504 1488 A
2034(==)S
2160(0\))S
(lock_ready\(rp\);)630 2286 A
3780 V
(15567)210 648 A
(TR_DATA)294 1362 A
1698(=)S
1782(0;)S
3870 V
(15568)210 648 A
(break;)252 1362 A
3960 V
(15569)210 648 A
4050 V
(15570)210 648 A
(case)168 1110 A
(T_STEP:)294 1320 A
2370(/*)S
(set)126 2496 A
(trace)210 2664 A
(bit)126 2916 A
3084(*/)S
4140 V
(15571)210 648 A
(rp->p_reg.psw)546 1362 A
1950(|=)S
(TRACEBIT;)378 2076 A
4230 V
(15572)210 648 A
(rp->p_flags)462 1362 A
1866(&=)S
(\304P_STOP;)336 1992 A
4320 V
(15573)210 648 A
1362(if)S
(\(rp->p_flags)504 1488 A
2034(==)S
2160(0\))S
(lock_ready\(rp\);)630 2286 A
4410 V
(15574)210 648 A
(TR_DATA)294 1362 A
1698(=)S
1782(0;)S
4500 V
(15575)210 648 A
(break;)252 1362 A
4590 V
(15576)210 648 A
4680 V
(15577)210 648 A
(default:)336 1110 A
4770 V
(15578)210 648 A
(return\(EIO\);)504 1362 A
4860 V
(15579)210 648 A
1110(})S
4950 V
(15580)210 648 A
(return\(OK\);)462 1110 A
5040 V
(15581)210 648 A
1026(})S
5220 V
(15583)210 648 A
(/*===========================================================================*)3276 1026 A
5310 V
(15584)210 648 A
1068(*)S
(cause_sig)378 2370 A
4260(*)S
5400 V
(15585)210 648 A
(*===========================================================================*/)3276 1068 A
5490 V
(15586)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(cause_sig\(proc_nr,)756 1530 A
(sig_nr\))294 2328 A
5580 V
(15587)210 648 A
(int)126 1026 A
(proc_nr;)336 1194 A
2370(/*)S
(process)294 2496 A
2832(to)S
2958(be)S
(signalled)378 3084 A
3504(*/)S
5670 V
(15588)210 648 A
(int)126 1026 A
(sig_nr;)294 1194 A
2370(/*)S
(signal)252 2496 A
2790(to)S
2916(be)S
(sent,)210 3042 A
3294(1)S
3378(to)S
(_NSIG)210 3504 A
3756(*/)S
5760 V
(15589)210 648 A
1026({)S
5850 V
(15590)210 648 A
1026(/*)S
1152(A)S
(task)168 1236 A
(wants)210 1446 A
1698(to)S
(send)168 1824 A
2034(a)S
(signal)252 2118 A
2412(to)S
2538(a)S
(process.)336 2622 A
(Examples)336 3084 A
3462(of)S
(such)168 3588 A
(tasks)210 3798 A
(are:)168 4050 A
5940 V
(15591)210 648 A
1068(*)S
(TTY)126 1236 A
(wanting)294 1404 A
1740(to)S
(cause)210 1866 A
(SIGINT)252 2118 A
(upon)168 2412 A
(getting)294 2622 A
2958(a)S
(DEL)126 3042 A
6030 V
(15592)210 648 A
1068(*)S
(CLOCK)210 1236 A
(wanting)294 1488 A
1824(to)S
(cause)210 1950 A
(SIGALRM)294 2202 A
(when)168 2538 A
(timer)210 2748 A
(expires)294 3000 A
6120 V
(15593)210 648 A
1068(*)S
1152(FS)S
(also)168 1278 A
(uses)168 1488 A
(this)168 1698 A
1908(to)S
(send)168 2034 A
2244(a)S
(signal,)294 2328 A
(via)126 2664 A
(the)126 2832 A
(SYS_KILL)336 3000 A
(message.)336 3378 A
6210 V
(15594)210 648 A
1068(*)S
(Signals)294 1152 A
(are)126 1488 A
(handled)294 1656 A
1992(by)S
(sending)294 2118 A
2454(a)S
(message)294 2538 A
2874(to)S
(MM.)126 3000 A
(The)126 3210 A
(tasks)210 3378 A
(don't)210 3630 A
(dare)168 3882 A
4092(do)S
8418 V
EP
%%Page: 219 219
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1993(File:)S
2226(src/kernel/system.c)S
12 B
(219)180 4248 A
900 V
7 LST
(15595)210 648 A
1068(*)S
(that)168 1152 A
(directly,)378 1362 A
(for)126 1782 A
(fear)168 1950 A
2160(of)S
(what)168 2286 A
(would)210 2496 A
(happen)252 2748 A
3042(if)S
3168(MM)S
(were)168 3294 A
(busy.)210 3504 A
(Instead)294 3798 A
(they)168 4134 A
990 V
(15596)210 648 A
1068(*)S
(call)168 1152 A
(cause_sig,)420 1362 A
(which)210 1824 A
(sets)168 2076 A
(bits)168 2286 A
2496(in)S
(p_pending,)420 2622 A
(and)126 3084 A
(then)168 3252 A
(carefully)378 3462 A
(checks)252 3882 A
4176(to)S
1080 V
(15597)210 648 A
1068(*)S
(see)126 1152 A
1320(if)S
1446(MM)S
1572(is)S
(free.)210 1698 A
1992(If)S
(so,)126 2118 A
2286(a)S
(message)294 2370 A
2706(is)S
(sent)168 2832 A
3042(to)S
(it.)126 3168 A
3378(If)S
(not,)168 3504 A
(when)168 3714 A
3924(it)S
(becomes)294 4050 A
1170 V
(15598)210 648 A
1068(*)S
(free,)210 1152 A
1404(a)S
(message)294 1488 A
1824(is)S
(sent.)210 1950 A
(The)126 2244 A
(process)294 2412 A
(being)210 2748 A
(signaled)336 3000 A
3378(is)S
(blocked)294 3504 A
(while)210 3840 A
4092(MM)S
1260 V
(15599)210 648 A
1068(*)S
(has)126 1152 A
(not)126 1320 A
(seen)168 1488 A
1698(or)S
(finished)336 1824 A
(with)168 2202 A
(all)126 2412 A
(signals)294 2580 A
(for)126 2916 A
(it.)126 3084 A
(These)210 3294 A
(signals)294 3546 A
(are)126 3882 A
1350 V
(15600)210 648 A
1068(*)S
(counted)294 1152 A
1488(in)S
(p_pendcount,)504 1614 A
(and)126 2160 A
(the)126 2328 A
(SIG_PENDING)462 2496 A
(flag)168 3000 A
3210(is)S
(kept)168 3336 A
(nonzero)294 3546 A
(while)210 3882 A
1440 V
(15601)210 648 A
1068(*)S
(there)210 1152 A
(are)126 1404 A
(some.)210 1572 A
1866(It)S
1992(is)S
(not)126 2118 A
(sufficient)420 2286 A
2748(to)S
(ready)210 2874 A
(the)126 3126 A
(process)294 3294 A
(when)168 3630 A
3840(MM)S
3966(is)S
1530 V
(15602)210 648 A
1068(*)S
(informed,)378 1152 A
(because)294 1572 A
1908(MM)S
(can)126 2034 A
(block)210 2202 A
(waiting)294 2454 A
(for)126 2790 A
2958(FS)S
3084(to)S
3210(do)S
3336(a)S
(core)168 3420 A
(dump.)210 3630 A
1620 V
(15603)210 648 A
1068(*/)S
1710 V
(15604)210 648 A
1800 V
(15605)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp,)168 1992 A
(*mmp;)210 2202 A
1890 V
(15606)210 648 A
1980 V
(15607)210 648 A
1110(rp)S
1236(=)S
(proc_addr\(proc_nr\);)798 1320 A
2070 V
(15608)210 648 A
1110(if)S
(\(sigismember\(&rp->p_pending,)1176 1236 A
(sig_nr\)\))336 2454 A
2160 V
(15609)210 648 A
(return;)294 1362 A
2370(/*)S
(this)168 2496 A
(signal)252 2706 A
(already)294 3000 A
(pending)294 3336 A
3672(*/)S
2250 V
(15610)210 648 A
(sigaddset\(&rp->p_pending,)1050 1110 A
(sig_nr\);)336 2202 A
2340 V
(15611)210 648 A
(++rp->p_pendcount;)756 1110 A
2370(/*)S
(count)210 2496 A
(new)126 2748 A
(signal)252 2916 A
(pending)294 3210 A
3546(*/)S
2430 V
(15612)210 648 A
1110(if)S
(\(rp->p_flags)504 1236 A
1782(&)S
(PENDING\))336 1866 A
2520 V
(15613)210 648 A
(return;)294 1362 A
2370(/*)S
(another)294 2496 A
(signal)252 2832 A
(already)294 3126 A
(pending)294 3462 A
3798(*/)S
2610 V
(15614)210 648 A
1110(if)S
(\(rp->p_flags)504 1236 A
1782(==)S
1908(0\))S
(lock_unready\(rp\);)714 2034 A
2700 V
(15615)210 648 A
(rp->p_flags)462 1110 A
1614(|=)S
(PENDING)294 1740 A
2076(|)S
(SIG_PENDING;)504 2160 A
2790 V
(15616)210 648 A
(++sig_procs;)504 1110 A
2370(/*)S
(count)210 2496 A
(new)126 2748 A
(process)294 2916 A
(pending)294 3252 A
3588(*/)S
2880 V
(15617)210 648 A
2970 V
(15618)210 648 A
(mmp)126 1110 A
1278(=)S
(proc_addr\(MM_PROC_NR\);)924 1362 A
3060 V
(15619)210 648 A
1110(if)S
1236(\()S
(\(\(mmp->p_flags)588 1320 A
1950(&)S
(RECEIVING\))420 2034 A
2496(==)S
2622(0\))S
2748(||)S
(mmp->p_getfrom)588 2874 A
3504(!=)S
(ANY\))168 3630 A
(return;)294 3840 A
3150 V
(15620)210 648 A
(inform\(\);)378 1110 A
3240 V
(15621)210 648 A
1026(})S
3510 V
(15624)210 648 A
(/*===========================================================================*)3276 1026 A
3600 V
(15625)210 648 A
1068(*)S
(inform)252 2370 A
4260(*)S
3690 V
(15626)210 648 A
(*===========================================================================*/)3276 1068 A
3780 V
(15627)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(inform\(\))336 1530 A
3870 V
(15628)210 648 A
1026({)S
3960 V
(15629)210 648 A
1026(/*)S
(When)168 1152 A
1362(a)S
(signal)252 1446 A
1740(is)S
(detected)336 1866 A
2244(by)S
(the)126 2370 A
(kernel)252 2538 A
(\(e.g.,)252 2832 A
(DEL\),)210 3126 A
3378(or)S
(generated)378 3504 A
3924(by)S
4050(a)S
(task)168 4134 A
4050 V
(15630)210 648 A
1068(*)S
(\(e.g.)210 1152 A
(clock)210 1404 A
(task)168 1656 A
(for)126 1866 A
(SIGALRM\),)378 2034 A
(cause_sig\(\))462 2454 A
2958(is)S
(called)252 3084 A
3378(to)S
(set)126 3504 A
3672(a)S
(bit)126 3756 A
3924(in)S
(the)126 4050 A
4140 V
(15631)210 648 A
1068(*)S
(p_pending)378 1152 A
(field)210 1572 A
1824(of)S
(the)126 1950 A
(process)294 2118 A
2454(to)S
(signal.)294 2580 A
(Then)168 2958 A
(inform\(\))336 3168 A
3546(is)S
(called)252 3672 A
3966(to)S
(see)126 4092 A
4230 V
(15632)210 648 A
1068(*)S
1152(if)S
1278(MM)S
1404(is)S
(idle)168 1530 A
(and)126 1740 A
(can)126 1908 A
2076(be)S
(told)168 2202 A
(about)210 2412 A
(it.)126 2664 A
(Whenever)336 2874 A
3252(MM)S
(blocks,)294 3378 A
3714(a)S
(check)210 3798 A
4050(is)S
4320 V
(15633)210 648 A
1068(*)S
(made)168 1152 A
1362(to)S
(see)126 1488 A
1656(if)S
('sig_procs')462 1782 A
2286(is)S
(nonzero;)336 2412 A
2790(if)S
(so,)126 2916 A
(inform\(\))336 3084 A
3462(is)S
(called.)294 3588 A
4410 V
(15634)210 648 A
1068(*/)S
4500 V
(15635)210 648 A
4590 V
(15636)210 648 A
(register)336 1110 A
(struct)252 1488 A
(proc)168 1782 A
(*rp;)168 1992 A
4680 V
(15637)210 648 A
4770 V
(15638)210 648 A
1110(/*)S
1236(MM)S
1362(is)S
(waiting)294 1488 A
(for)126 1824 A
(new)126 1992 A
(input.)252 2160 A
(Find)168 2496 A
2706(a)S
(process)294 2790 A
(with)168 3126 A
(pending)294 3336 A
(signals.)336 3672 A
4050(*/)S
4860 V
(15639)210 648 A
(for)126 1110 A
(\(rp)126 1278 A
1446(=)S
(BEG_SERV_ADDR;)588 1530 A
2160(rp)S
2286(<)S
(END_PROC_ADDR;)588 2370 A
(rp++\))210 3000 A
4950 V
(15640)210 648 A
1362(if)S
(\(rp->p_flags)504 1488 A
2034(&)S
(PENDING\))336 2118 A
2496({)S
5040 V
(15641)210 648 A
(m.m_type)336 1698 A
2076(=)S
(KSIG;)210 2160 A
5130 V
(15642)210 648 A
(m.SIG_PROC)420 1698 A
2160(=)S
(proc_number\(rp\);)672 2244 A
5220 V
(15643)210 648 A
(m.SIG_MAP)378 1698 A
2118(=)S
(rp->p_pending;)588 2202 A
5310 V
(15644)210 648 A
(sig_procs--;)504 1698 A
5400 V
(15645)210 648 A
1698(if)S
(\(lock_mini_send\(proc_addr\(HARDWARE\),)1512 1824 A
(MM_PROC_NR,)462 3378 A
(&m\))126 3882 A
4050(!=)S
(OK\))126 4176 A
5490 V
(15646)210 648 A
(panic\("can't)504 2034 A
(inform)252 2580 A
(MM",)168 2874 A
(NO_NUM\);)336 3084 A
5580 V
(15647)210 648 A
(sigemptyset\(&rp->p_pending\);)1176 1698 A
2916(/*)S
(the)126 3042 A
(ball)168 3210 A
3420(is)S
(now)126 3546 A
3714(in)S
(MM's)168 3840 A
(court)210 4050 A
4302(*/)S
5670 V
(15648)210 648 A
(rp->p_flags)462 1698 A
2202(&=)S
(\304PENDING;/*)462 2328 A
(remains)294 2832 A
(inhibited)378 3168 A
3588(by)S
(SIG_PENDING)462 3714 A
4218(*/)S
5760 V
(15649)210 648 A
(lock_pick_proc\(\);)714 1698 A
2706(/*)S
(avoid)210 2832 A
(delay)210 3084 A
3336(in)S
(scheduling)420 3462 A
3924(MM)S
4050(*/)S
5850 V
(15650)210 648 A
(return;)294 1698 A
5940 V
(15651)210 648 A
1362(})S
6030 V
(15652)210 648 A
1026(})S
8418 V
EP
%%Page: 220 220
BP
/slant 0 def
/height 0 def
630 V
12 B
(220)180 648 A
11 R
1993(File:)S
2226(src/kernel/system.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(15655)210 648 A
(/*===========================================================================*)3276 1026 A
990 V
(15656)210 648 A
1068(*)S
(umap)168 2370 A
4260(*)S
1080 V
(15657)210 648 A
(*===========================================================================*/)3276 1068 A
1170 V
(15658)210 648 A
(PUBLIC)252 1026 A
(phys_bytes)420 1320 A
(umap\(rp,)336 1782 A
(seg,)168 2160 A
(vir_addr,)378 2370 A
(bytes\))252 2790 A
1260 V
(15659)210 648 A
(register)336 1026 A
(struct)252 1404 A
(proc)168 1698 A
(*rp;)168 1908 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(proc)168 2958 A
(table)210 3168 A
(entry)210 3420 A
(for)126 3672 A
(process)294 3840 A
4176(*/)S
1350 V
(15660)210 648 A
(int)126 1026 A
(seg;)168 1194 A
2370(/*)S
2496(T,)S
2622(D,)S
2748(or)S
2874(S)S
(segment)294 2958 A
3294(*/)S
1440 V
(15661)210 648 A
(vir_bytes)378 1026 A
(vir_addr;)378 1446 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
3168(in)S
(bytes)210 3294 A
(within)252 3546 A
(the)126 3840 A
(seg)126 4008 A
4176(*/)S
1530 V
(15662)210 648 A
(vir_bytes)378 1026 A
(bytes;)252 1446 A
2370(/*)S
2496(#)S
2580(of)S
(bytes)210 2706 A
2958(to)S
3084(be)S
(copied)252 3210 A
3504(*/)S
1620 V
(15663)210 648 A
1026({)S
1710 V
(15664)210 648 A
1026(/*)S
(Calculate)378 1152 A
(the)126 1572 A
(physical)336 1740 A
(memory)252 2118 A
(address)294 2412 A
(for)126 2748 A
2916(a)S
(given)210 3000 A
(virtual)294 3252 A
(address.)336 3588 A
3966(*/)S
1800 V
(15665)210 648 A
1890 V
(15666)210 648 A
(vir_clicks)420 1110 A
(vc;)126 1572 A
2370(/*)S
(the)126 2496 A
(virtual)294 2664 A
(address)294 3000 A
3336(in)S
(clicks)252 3462 A
3756(*/)S
1980 V
(15667)210 648 A
(phys_bytes)420 1110 A
(pa;)126 1572 A
2370(/*)S
(intermediate)504 2496 A
(variables)378 3042 A
3462(as)S
(phys_bytes)420 3588 A
4050(*/)S
2070 V
(15668)210 648 A
(phys_bytes)420 1110 A
(seg_base;)378 1572 A
2160 V
(15669)210 648 A
2250 V
(15670)210 648 A
1110(/*)S
1236(If)S
('seg')210 1362 A
1614(is)S
1740(D)S
1824(it)S
(could)210 1950 A
(really)252 2202 A
2496(be)S
2622(S)S
(and)126 2706 A
(vice)168 2874 A
(versa.)252 3084 A
3420(T)S
(really)252 3504 A
(means)210 3798 A
4050(T.)S
2340 V
(15671)210 648 A
1152(*)S
1236(If)S
(the)126 1362 A
(virtual)294 1530 A
(address)294 1866 A
(falls)210 2202 A
2454(in)S
(the)126 2580 A
(gap,)168 2748 A
3000(it)S
(causes)252 3126 A
3420(a)S
(problem.)336 3504 A
3882(On)S
(the)126 4008 A
2430 V
(15672)210 648 A
1152(*)S
(8088)168 1236 A
1446(it)S
1572(is)S
(probably)336 1698 A
2076(a)S
(legal)210 2160 A
(stack)210 2412 A
(reference,)420 2664 A
(since)210 3126 A
("stackfaults")546 3378 A
(are)126 3966 A
2520 V
(15673)210 648 A
1152(*)S
(not)126 1236 A
(detected)336 1404 A
1782(by)S
(the)126 1908 A
(hardware.)378 2076 A
2538(On)S
(8088s,)252 2664 A
(the)126 2958 A
(gap)126 3126 A
3294(is)S
(called)252 3420 A
3714(S)S
(and)126 3798 A
2610 V
(15674)210 648 A
1152(*)S
(accepted,)378 1236 A
(but)126 1656 A
1824(on)S
(other)210 1950 A
(machines)336 2202 A
2580(it)S
2706(is)S
(called)252 2832 A
3126(D)S
(and)126 3210 A
(rejected.)378 3378 A
2700 V
(15675)210 648 A
1152(*)S
(The)126 1236 A
(Atari)210 1404 A
1656(ST)S
(behaves)294 1782 A
(like)168 2118 A
(the)126 2328 A
(8088)168 2496 A
2706(in)S
(this)168 2832 A
(respect.)336 3042 A
2790 V
(15676)210 648 A
1152(*/)S
2880 V
(15677)210 648 A
2970 V
(15678)210 648 A
1110(if)S
(\(bytes)252 1236 A
1530(<=)S
1656(0\))S
(return\()294 1782 A
(\(phys_bytes\))504 2118 A
(0\);)126 2664 A
3060 V
(15679)210 648 A
1110(vc)S
1236(=)S
(\(vir_addr)378 1320 A
1740(+)S
(bytes)210 1824 A
2076(-)S
2160(1\))S
2286(>>)S
(CLICK_SHIFT;)504 2412 A
3042(/*)S
(last)168 3168 A
(click)210 3378 A
3630(of)S
(data)168 3756 A
3966(*/)S
3150 V
(15680)210 648 A
3240 V
(15681)210 648 A
1110(if)S
(\(seg)168 1236 A
1446(!=)S
1572(T\))S
3330 V
(15682)210 648 A
(seg)126 1362 A
1530(=)S
(\(vc)126 1614 A
1782(<)S
(rp->p_map[D].mem_vir)840 1866 A
2748(+)S
(rp->p_map[D].mem_len)840 2832 A
3714(?)S
3798(D)S
3882(:)S
(S\);)126 3966 A
3420 V
(15683)210 648 A
3510 V
(15684)210 648 A
(if\(\(vir_addr>>CLICK_SHIFT\))1092 1110 A
2244(>=)S
(rp->p_map[seg].mem_vir+)966 2370 A
(rp->p_map[seg].mem_len\))966 3378 A
3600 V
(15685)210 648 A
(return\()294 1362 A
(\(phys_bytes\))504 1698 A
2244(0)S
2328(\);)S
3690 V
(15686)210 648 A
(seg_base)336 1110 A
1488(=)S
(\(phys_bytes\))504 1572 A
(rp->p_map[seg].mem_phys;)1008 2118 A
3780 V
(15687)210 648 A
(seg_base)336 1110 A
1488(=)S
(seg_base)336 1572 A
1950(<<)S
(CLICK_SHIFT;)504 2076 A
2706(/*)S
(segment)294 2832 A
(origin)252 3168 A
3462(in)S
(bytes)210 3588 A
3840(*/)S
3870 V
(15688)210 648 A
1110(pa)S
1236(=)S
(\(phys_bytes\))504 1320 A
(vir_addr;)378 1866 A
3960 V
(15689)210 648 A
1110(pa)S
1236(-=)S
(rp->p_map[seg].mem_vir)924 1362 A
2328(<<)S
(CLICK_SHIFT;)504 2454 A
4050 V
(15690)210 648 A
(return\(seg_base)630 1110 A
1782(+)S
(pa\);)168 1866 A
4140 V
(15691)210 648 A
1026(})S
4410 V
(15694)210 648 A
(/*==========================================================================*)3234 1026 A
4500 V
(15695)210 648 A
1068(*)S
(numap)210 2370 A
4218(*)S
4590 V
(15696)210 648 A
(*==========================================================================*/)3234 1068 A
4680 V
(15697)210 648 A
(PUBLIC)252 1026 A
(phys_bytes)420 1320 A
(numap\(proc_nr,)588 1782 A
(vir_addr,)378 2412 A
(bytes\))252 2832 A
4770 V
(15698)210 648 A
(int)126 1026 A
(proc_nr;)336 1194 A
2370(/*)S
(process)294 2496 A
(number)252 2832 A
3126(to)S
3252(be)S
(mapped)252 3378 A
3672(*/)S
4860 V
(15699)210 648 A
(vir_bytes)378 1026 A
(vir_addr;)378 1446 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
3168(in)S
(bytes)210 3294 A
(within)252 3546 A
3840(D)S
(seg)126 3924 A
4092(*/)S
4950 V
(15700)210 648 A
(vir_bytes)378 1026 A
(bytes;)252 1446 A
2370(/*)S
2496(#)S
2580(of)S
(bytes)210 2706 A
(required)336 2958 A
3336(in)S
(segment)294 3462 A
3840(*/)S
5040 V
(15701)210 648 A
1026({)S
5130 V
(15702)210 648 A
1026(/*)S
1152(Do)S
(umap\(\))252 1278 A
(starting)336 1572 A
(from)168 1950 A
2160(a)S
(process)294 2244 A
(number)252 2580 A
(instead)294 2874 A
3210(of)S
3336(a)S
(pointer.)336 3420 A
(This)168 3840 A
5220 V
(15703)210 648 A
1068(*)S
(function)336 1152 A
1530(is)S
(used)168 1656 A
1866(by)S
(device)252 1992 A
(drivers,)336 2286 A
2664(so)S
(they)168 2790 A
(need)168 3000 A
(not)126 3210 A
(know)168 3378 A
(about)210 3588 A
(the)126 3840 A
5310 V
(15704)210 648 A
1068(*)S
(process)294 1152 A
(table.)252 1488 A
1824(To)S
(save)168 1950 A
(time,)210 2160 A
(there)210 2412 A
2664(is)S
2790(no)S
('seg')210 2916 A
(parameter.)420 3168 A
(The)126 3630 A
(segment)294 3798 A
5400 V
(15705)210 648 A
1068(*)S
1152(is)S
(always)252 1278 A
1572(D.)S
5490 V
(15706)210 648 A
1068(*/)S
5580 V
(15707)210 648 A
5670 V
(15708)210 648 A
(return\(umap\(proc_addr\(proc_nr\),)1302 1110 A
2454(D,)S
(vir_addr,)378 2580 A
(bytes\)\);)336 3000 A
5760 V
(15709)210 648 A
1026(})S
5940 V
(15711)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL\))252 1572 A
6030 V
(15712)210 648 A
(/*==========================================================================*)3234 1026 A
6120 V
(15713)210 648 A
1068(*)S
(alloc_segments)588 2370 A
4218(*)S
6210 V
(15714)210 648 A
(*==========================================================================*/)3234 1068 A
8418 V
EP
%%Page: 221 221
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
1993(File:)S
2226(src/kernel/system.c)S
12 B
(221)180 4248 A
900 V
7 LST
(15715)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(alloc_segments\(rp\))756 1530 A
990 V
(15716)210 648 A
(register)336 1026 A
(struct)252 1404 A
(proc)168 1698 A
(*rp;)168 1908 A
1080 V
(15717)210 648 A
1026({)S
1170 V
(15718)210 648 A
1026(/*)S
(This)168 1152 A
1362(is)S
(called)252 1488 A
(only)168 1782 A
1992(by)S
(do_newmap,)420 2118 A
(but)126 2580 A
2748(is)S
(broken)252 2874 A
(out)126 3168 A
3336(as)S
3462(a)S
(separate)336 3546 A
(function)336 3924 A
1260 V
(15719)210 648 A
1068(*)S
(because)294 1152 A
1488(so)S
(much)168 1614 A
1824(is)S
(hardware-dependent.)798 1950 A
1350 V
(15720)210 648 A
1068(*/)S
1440 V
(15721)210 648 A
1530 V
(15722)210 648 A
(phys_bytes)420 1110 A
(code_bytes;)462 1572 A
1620 V
(15723)210 648 A
(phys_bytes)420 1110 A
(data_bytes;)462 1572 A
1710 V
(15724)210 648 A
(int)126 1110 A
(privilege;)420 1278 A
1800 V
(15725)210 648 A
1890 V
(15726)210 648 A
1110(if)S
(\(protected_mode\))672 1236 A
1950({)S
1980 V
(15727)210 648 A
(data_bytes)420 1362 A
1824(=)S
(\(phys_bytes\))504 1908 A
(\(rp->p_map[S].mem_vir)882 2454 A
3378(+)S
(rp->p_map[S].mem_len\))882 3462 A
2070 V
(15728)210 648 A
1908(<<)S
(CLICK_SHIFT;)504 2034 A
2160 V
(15729)210 648 A
1362(if)S
(\(rp->p_map[T].mem_len)882 1488 A
2412(==)S
2538(0\))S
2250 V
(15730)210 648 A
(code_bytes)420 1698 A
2160(=)S
(data_bytes;)462 2244 A
3042(/*)S
(common)252 3168 A
(I&D,)168 3462 A
(poor)168 3672 A
(protect)294 3882 A
4218(*/)S
2340 V
(15731)210 648 A
(else)168 1362 A
2430 V
(15732)210 648 A
(code_bytes)420 1698 A
2160(=)S
(\(phys_bytes\))504 2244 A
(rp->p_map[T].mem_len)840 2790 A
3672(<<)S
(CLICK_SHIFT;)504 3798 A
2520 V
(15733)210 648 A
(privilege)378 1362 A
1782(=)S
(istaskp\(rp\))462 1866 A
2370(?)S
(TASK_PRIVILEGE)588 2454 A
3084(:)S
(USER_PRIVILEGE;)630 3168 A
2610 V
(15734)210 648 A
(init_codeseg\(&rp->p_ldt[CS_LDT_INDEX],)1596 1362 A
2700 V
(15735)210 648 A
(\(phys_bytes\))504 1908 A
(rp->p_map[T].mem_phys)882 2454 A
3378(<<)S
(CLICK_SHIFT,)504 3504 A
2790 V
(15736)210 648 A
(code_bytes,)462 1908 A
(privilege\);)462 2412 A
2880 V
(15737)210 648 A
(init_dataseg\(&rp->p_ldt[DS_LDT_INDEX],)1596 1362 A
2970 V
(15738)210 648 A
(\(phys_bytes\))504 1908 A
(rp->p_map[D].mem_phys)882 2454 A
3378(<<)S
(CLICK_SHIFT,)504 3504 A
3060 V
(15739)210 648 A
(data_bytes,)462 1908 A
(privilege\);)462 2412 A
3150 V
(15740)210 648 A
(rp->p_reg.cs)504 1362 A
1908(=)S
(\(CS_LDT_INDEX)546 1992 A
2580(*)S
(DESC_SIZE\))420 2664 A
3126(|)S
3210(TI)S
3336(|)S
(privilege;)420 3420 A
3240 V
(15741)210 648 A
(#if)126 1026 A
(_WORD_SIZE)420 1194 A
1656(==)S
1782(4)S
3330 V
(15742)210 648 A
(rp->p_reg.gs)504 1362 A
1908(=)S
3420 V
(15743)210 648 A
(rp->p_reg.fs)504 1362 A
1908(=)S
3510 V
(15744)210 648 A
(#endif)252 1026 A
3600 V
(15745)210 648 A
(rp->p_reg.ss)504 1362 A
1908(=)S
3690 V
(15746)210 648 A
(rp->p_reg.es)504 1362 A
1908(=)S
3780 V
(15747)210 648 A
(rp->p_reg.ds)504 1362 A
1908(=)S
(\(DS_LDT_INDEX*DESC_SIZE\))1008 1992 A
3042(|)S
3126(TI)S
3252(|)S
(privilege;)420 3336 A
3870 V
(15748)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3960 V
(15749)210 648 A
(rp->p_reg.cs)504 1362 A
1908(=)S
(click_to_hclick\(rp->p_map[T].mem_phys\);)1638 1992 A
4050 V
(15750)210 648 A
(rp->p_reg.ss)504 1362 A
1908(=)S
4140 V
(15751)210 648 A
(rp->p_reg.es)504 1362 A
1908(=)S
4230 V
(15752)210 648 A
(rp->p_reg.ds)504 1362 A
1908(=)S
(click_to_hclick\(rp->p_map[D].mem_phys\);)1638 1992 A
4320 V
(15753)210 648 A
1110(})S
4410 V
(15754)210 648 A
1026(})S
4500 V
(15755)210 648 A
(#endif)252 1026 A
1320(/*)S
(\(CHIP)210 1446 A
1698(==)S
(INTEL\))252 1824 A
2118(*/)S
5040 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5130 V
(src/mm/mm.h)462 2034 A
5220 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5400 V
(15800)210 648 A
1026(/*)S
(This)168 1152 A
1362(is)S
(the)126 1488 A
(master)252 1656 A
(header)252 1950 A
(for)126 2244 A
(mm.)126 2412 A
2622(It)S
(includes)336 2748 A
(some)168 3126 A
(other)210 3336 A
(files)210 3588 A
5490 V
(15801)210 648 A
1068(*)S
(and)126 1152 A
(defines)294 1320 A
(the)126 1656 A
(principal)378 1824 A
(constants.)420 2244 A
5580 V
(15802)210 648 A
1068(*/)S
5670 V
(15803)210 648 A
(#define)294 1026 A
(_POSIX_SOURCE)546 1362 A
2160(1)S
2370(/*)S
(tell)168 2496 A
(headers)294 2706 A
3042(to)S
(include)294 3168 A
(POSIX)210 3504 A
(stuff)210 3756 A
4008(*/)S
5760 V
(15804)210 648 A
(#define)294 1026 A
(_MINIX)252 1362 A
2160(1)S
2370(/*)S
(tell)168 2496 A
(headers)294 2706 A
3042(to)S
(include)294 3168 A
(MINIX)210 3504 A
(stuff)210 3756 A
4008(*/)S
5850 V
(15805)210 648 A
(#define)294 1026 A
(_SYSTEM)294 1362 A
2160(1)S
2370(/*)S
(tell)168 2496 A
(headers)294 2706 A
(that)168 3042 A
(this)168 3252 A
3462(is)S
(the)126 3588 A
(kernel)252 3756 A
4050(*/)S
5940 V
(15806)210 648 A
6030 V
(15807)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(are)126 1740 A
1908(so)S
(basic,)252 2034 A
(all)126 2328 A
(the)126 2496 A
(*.c)126 2664 A
(files)210 2832 A
(get)126 3084 A
(them)168 3252 A
(automatically.)588 3462 A
4092(*/)S
6120 V
(15808)210 648 A
(#include)336 1026 A
(<minix/config.h>)672 1404 A
2370(/*)S
(MUST)168 2496 A
2706(be)S
(first)210 2832 A
3084(*/)S
6210 V
(15809)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
2370(/*)S
(MUST)168 2496 A
2706(be)S
(second)252 2832 A
3126(*/)S
8418 V
EP
%%Page: 222 222
BP
/slant 0 def
/height 0 def
630 V
12 B
(222)180 648 A
11 R
2112(File:)S
2345(src/mm/mm.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(15810)210 648 A
(#include)336 1026 A
(<sys/types.h>)546 1404 A
990 V
(15811)210 648 A
(#include)336 1026 A
(<minix/const.h>)630 1404 A
1080 V
(15812)210 648 A
(#include)336 1026 A
(<minix/type.h>)588 1404 A
1170 V
(15813)210 648 A
1260 V
(15814)210 648 A
(#include)336 1026 A
(<fcntl.h>)378 1404 A
1350 V
(15815)210 648 A
(#include)336 1026 A
(<unistd.h>)420 1404 A
1440 V
(15816)210 648 A
(#include)336 1026 A
(<minix/syslib.h>)672 1404 A
1530 V
(15817)210 648 A
1620 V
(15818)210 648 A
(#include)336 1026 A
(<limits.h>)420 1404 A
1710 V
(15819)210 648 A
(#include)336 1026 A
(<errno.h>)378 1404 A
1800 V
(15820)210 648 A
1890 V
(15821)210 648 A
(#include)336 1026 A
("const.h")378 1404 A
1980 V
(15822)210 648 A
(#include)336 1026 A
("type.h")336 1404 A
2070 V
(15823)210 648 A
(#include)336 1026 A
("proto.h")378 1404 A
2160 V
(15824)210 648 A
(#include)336 1026 A
("glo.h")294 1404 A
2790 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2880 V
(src/mm/const.h)588 2034 A
2970 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3150 V
(15900)210 648 A
1026(/*)S
(Constants)378 1152 A
(used)168 1572 A
1782(by)S
(the)126 1908 A
(Memory)252 2076 A
(Manager.)336 2370 A
2748(*/)S
3240 V
(15901)210 648 A
3330 V
(15902)210 648 A
(#define)294 1026 A
(NO_MEM)252 1362 A
(\(\(phys_clicks\))588 1656 A
2286(0\))S
2454(/*)S
(returned)336 2580 A
2958(by)S
(alloc_mem\(\))462 3084 A
(with)168 3588 A
(mem)126 3798 A
3966(is)S
4092(up)S
4218(*/)S
3420 V
(15903)210 648 A
3510 V
(15904)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL)210 1572 A
1824(&&)S
(_WORD_SIZE)420 1950 A
2412(==)S
2538(2\))S
3600 V
(15905)210 648 A
1026(/*)S
(These)210 1152 A
(definitions)462 1404 A
(are)126 1908 A
(used)168 2076 A
2286(in)S
(size_ok)294 2412 A
(and)126 2748 A
(are)126 2916 A
(not)126 3084 A
(needed)252 3252 A
(for)126 3546 A
(386.)168 3714 A
3690 V
(15906)210 648 A
1068(*)S
(The)126 1152 A
(386)126 1320 A
(segment)294 1488 A
(granularity)462 1824 A
2328(is)S
2454(1)S
(for)126 2538 A
(segments)336 2706 A
(smaller)294 3084 A
(than)168 3420 A
3630(1M)S
(and)126 3756 A
(4096)168 3924 A
3780 V
(15907)210 648 A
1068(*)S
(above)210 1152 A
(that.)210 1404 A
3870 V
(15908)210 648 A
1068(*/)S
3960 V
(15909)210 648 A
(#define)294 1026 A
(PAGE_SIZE)378 1362 A
2118(16)S
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(bytes)210 2874 A
3126(in)S
3252(a)S
(page)168 3336 A
(\(s.b.HCLICK_SIZE\)*/)798 3546 A
4050 V
(15910)210 648 A
(#define)294 1026 A
(MAX_PAGES)378 1362 A
(4096)168 2034 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(pages)210 2874 A
3126(in)S
(the)126 3252 A
(virtual)294 3420 A
(addr)168 3756 A
(space)210 3966 A
4218(*/)S
4140 V
(15911)210 648 A
(#endif)252 1026 A
4230 V
(15912)210 648 A
4320 V
(15913)210 648 A
(#define)294 1026 A
(printf)252 1362 A
(printk)252 1950 A
4410 V
(15914)210 648 A
4500 V
(15915)210 648 A
(#define)294 1026 A
(INIT_PID)336 1362 A
2160(1)S
2370(/*)S
(init's)252 2496 A
(process)294 2790 A
3126(id)S
(number)252 3252 A
3546(*/)S
5040 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5130 V
(src/mm/type.h)546 2034 A
5220 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5400 V
(16000)210 648 A
1026(/*)S
1152(If)S
(there)210 1278 A
(were)168 1530 A
(any)126 1740 A
(type)168 1908 A
(definitions)462 2118 A
(local)210 2622 A
2874(to)S
(the)126 3000 A
(Memory)252 3168 A
(Manager,)336 3462 A
(they)168 3840 A
(would)210 4050 A
5490 V
(16001)210 648 A
1068(*)S
1152(be)S
(here.)210 1278 A
(This)168 1572 A
(file)168 1782 A
1992(is)S
(included)336 2118 A
(only)168 2496 A
(for)126 2706 A
(symmetry)336 2874 A
(with)168 3252 A
(the)126 3462 A
(kernel)252 3630 A
(and)126 3924 A
(File)168 4092 A
5580 V
(16002)210 648 A
1068(*)S
(System,)294 1152 A
(which)210 1488 A
1740(do)S
(have)168 1866 A
(some)168 2076 A
(local)210 2286 A
(type)168 2538 A
(definitions.)504 2748 A
5670 V
(16003)210 648 A
1068(*/)S
5760 V
(16004)210 648 A
8418 V
EP
%%Page: 223 223
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2081(File:)S
2314(src/mm/proto.h)S
12 B
(223)180 4248 A
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/mm/proto.h)588 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(16100)210 648 A
1026(/*)S
(Function)336 1152 A
(prototypes.)462 1530 A
2034(*/)S
1440 V
(16101)210 648 A
1530 V
(16102)210 648 A
(struct)252 1026 A
(mproc;)252 1320 A
2034(/*)S
(need)168 2160 A
(types)210 2370 A
(outside)294 2622 A
2958(of)S
(parameter)378 3084 A
(list)168 3504 A
(--kub)210 3714 A
3966(*/)S
1620 V
(16103)210 648 A
(struct)252 1026 A
(stat;)210 1320 A
1710 V
(16104)210 648 A
1800 V
(16105)210 648 A
1026(/*)S
(alloc.c)294 1152 A
1488(*/)S
1890 V
(16106)210 648 A
(_PROTOTYPE\()462 1026 A
(phys_clicks)462 1530 A
(alloc_mem,)420 2034 A
(\(phys_clicks)504 2496 A
(clicks\))294 3042 A
4050(\);)S
1980 V
(16107)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(free_mem,)378 1740 A
(\(phys_clicks)504 2160 A
(base,)210 2706 A
(phys_clicks)462 2958 A
(clicks\))294 3462 A
4050(\);)S
2070 V
(16108)210 648 A
(_PROTOTYPE\()462 1026 A
(phys_clicks)462 1530 A
(max_hole,)378 2034 A
(\(void\))252 2454 A
4050(\);)S
2160 V
(16109)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(mem_init,)378 1740 A
(\(phys_clicks)504 2160 A
(*total,)294 2706 A
(phys_clicks)462 3042 A
(*free\))252 3546 A
4050(\);)S
2250 V
(16110)210 648 A
(_PROTOTYPE\()462 1026 A
(phys_clicks)462 1530 A
(mem_left,)378 2034 A
(\(void\))252 2454 A
4050(\);)S
2340 V
(16111)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_brk3,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
2430 V
(16112)210 648 A
2520 V
(16113)210 648 A
1026(/*)S
(break.c)294 1152 A
1488(*/)S
2610 V
(16114)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(adjust,)294 1698 A
(\(struct)294 2034 A
(mproc)210 2370 A
(*rmp,)210 2622 A
2700 V
(16115)210 648 A
(vir_clicks)420 2034 A
(data_clicks,)504 2496 A
(vir_bytes)378 3042 A
(sp\))126 3462 A
4050(\);)S
2790 V
(16116)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_brk,)294 1698 A
(\(void\))252 2034 A
4050(\);)S
2880 V
(16117)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(size_ok,)336 1698 A
(\(int)168 2076 A
(file_type,)420 2286 A
(vir_clicks)420 2748 A
(tc,)126 3210 A
(vir_clicks)420 3378 A
(dc,)126 3840 A
2970 V
(16118)210 648 A
(vir_clicks)420 2034 A
(sc,)126 2496 A
(vir_clicks)420 2664 A
(dvir,)210 3126 A
(vir_clicks)420 3378 A
(s_vir\))252 3840 A
4134(\);)S
3060 V
(16119)210 648 A
3150 V
(16120)210 648 A
1026(/*)S
(exec.c)252 1152 A
1446(*/)S
3240 V
(16121)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_exec,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
3330 V
(16122)210 648 A
(_PROTOTYPE\()462 1026 A
(struct)252 1530 A
(mproc)210 1824 A
(*find_share,)504 2076 A
(\(struct)294 2622 A
(mproc)210 2958 A
(*mp_ign,)336 3210 A
(Ino_t)210 3588 A
(ino,)168 3840 A
3420 V
(16123)210 648 A
(Dev_t)210 2034 A
(dev,)168 2286 A
(time_t)252 2496 A
(ctime\))252 2790 A
4050(\);)S
3510 V
(16124)210 648 A
3600 V
(16125)210 648 A
1026(/*)S
(forkexit.c)420 1152 A
1614(*/)S
3690 V
(16126)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_fork,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
3780 V
(16127)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_mm_exit,)462 1698 A
(\(void\))252 2202 A
4050(\);)S
3870 V
(16128)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_waitpid,)462 1698 A
(\(void\))252 2202 A
4050(\);)S
3960 V
(16129)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(mm_exit,)336 1740 A
(\(struct)294 2118 A
(mproc)210 2454 A
(*rmp,)210 2706 A
(int)126 2958 A
(exit_status\))504 3126 A
4050(\);)S
4050 V
(16130)210 648 A
4140 V
(16131)210 648 A
1026(/*)S
(getset.c)336 1152 A
1530(*/)S
4230 V
(16132)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_getset,)420 1698 A
(\(void\))252 2160 A
4050(\);)S
4320 V
(16133)210 648 A
4410 V
(16134)210 648 A
1026(/*)S
(main.c)252 1152 A
1446(*/)S
4500 V
(16135)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(main,)210 1740 A
(\(void\))252 1992 A
4050(\);)S
4590 V
(16136)210 648 A
4680 V
(16137)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(MACINTOSH\))420 1698 A
4770 V
(16138)210 648 A
(_PROTOTYPE\()462 1026 A
(phys_clicks)462 1530 A
(start_click,)504 2034 A
(\(void\))252 2580 A
4050(\);)S
4860 V
(16139)210 648 A
(#endif)252 1026 A
4950 V
(16140)210 648 A
5040 V
(16141)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(reply,)252 1740 A
(\(int)168 2034 A
(proc_nr,)336 2244 A
(int)126 2622 A
(result,)294 2790 A
(int)126 3126 A
(res2,)210 3294 A
(char)168 3546 A
(*respt\)\);)378 3756 A
5130 V
(16142)210 648 A
5220 V
(16143)210 648 A
1026(/*)S
(putk.c)252 1152 A
1446(*/)S
5310 V
(16144)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(putk,)210 1740 A
(\(int)168 1992 A
2202(c\))S
4050(\);)S
5400 V
(16145)210 648 A
5490 V
(16146)210 648 A
1026(/*)S
(signal.c)336 1152 A
1530(*/)S
5580 V
(16147)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_alarm,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
5670 V
(16148)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_kill,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
5760 V
(16149)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_ksig,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
5850 V
(16150)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_pause,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
5940 V
(16151)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(set_alarm,)420 1698 A
(\(int)168 2160 A
(proc_nr,)336 2370 A
(int)126 2748 A
(sec\))168 2916 A
4050(\);)S
6030 V
(16152)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(check_sig,)420 1698 A
(\(pid_t)252 2160 A
(proc_id,)336 2454 A
(int)126 2832 A
(signo\))252 3000 A
4050(\);)S
6120 V
(16153)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(sig_proc,)378 1740 A
(\(struct)294 2160 A
(mproc)210 2496 A
(*rmp,)210 2748 A
(int)126 3000 A
(sig_nr\))294 3168 A
4050(\);)S
6210 V
(16154)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_sigaction,)546 1698 A
(\(void\))252 2286 A
4050(\);)S
8418 V
EP
%%Page: 224 224
BP
/slant 0 def
/height 0 def
630 V
12 B
(224)180 648 A
11 R
2081(File:)S
2314(src/mm/proto.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(16155)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_sigpending,)588 1698 A
(\(void\))252 2328 A
4050(\);)S
990 V
(16156)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_sigprocmask,)630 1698 A
(\(void\))252 2370 A
4050(\);)S
1080 V
(16157)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_sigreturn,)546 1698 A
(\(void\))252 2286 A
4050(\);)S
1170 V
(16158)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_sigsuspend,)588 1698 A
(\(void\))252 2328 A
4050(\);)S
1260 V
(16159)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_reboot,)420 1698 A
(\(void\))252 2160 A
4050(\);)S
1350 V
(16160)210 648 A
1440 V
(16161)210 648 A
1026(/*)S
(trace.c)294 1152 A
1488(*/)S
1530 V
(16162)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_trace,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
1620 V
(16163)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(stop_proc,)420 1740 A
(\(struct)294 2202 A
(mproc)210 2538 A
(*rmp,)210 2790 A
(int)126 3042 A
(sig_nr\))294 3210 A
4050(\);)S
1710 V
(16164)210 648 A
1800 V
(16165)210 648 A
1026(/*)S
(utility.c)378 1152 A
1572(*/)S
1890 V
(16166)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(allowed,)336 1698 A
(\(char)210 2076 A
(*name_buf,)420 2328 A
(struct)252 2790 A
(stat)168 3084 A
(*s_buf,)294 3294 A
(int)126 3630 A
(mask\))210 3798 A
4050(\);)S
1980 V
(16167)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(no_sys,)294 1698 A
(\(void\))252 2034 A
4050(\);)S
2070 V
(16168)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(panic,)252 1740 A
(\(char)210 2034 A
(*format,)336 2286 A
(int)126 2664 A
(num\))168 2832 A
4050(\);)S
2160 V
(16169)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(tell_fs,)336 1740 A
(\(int)168 2118 A
(what,)210 2328 A
(int)126 2580 A
(p1,)126 2748 A
(int)126 2916 A
(p2,)126 3084 A
(int)126 3252 A
(p3\))126 3420 A
4050(\);)S
2790 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2880 V
(src/mm/glo.h)504 2034 A
2970 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3150 V
(16200)210 648 A
1026(/*)S
(EXTERN)252 1152 A
(should)252 1446 A
1740(be)S
(extern)252 1866 A
(except)252 2160 A
2454(in)S
(table.c)294 2580 A
2916(*/)S
3240 V
(16201)210 648 A
(#ifdef)252 1026 A
(_TABLE)252 1320 A
3330 V
(16202)210 648 A
(#undef)252 1026 A
(EXTERN)252 1320 A
3420 V
(16203)210 648 A
(#define)294 1026 A
(EXTERN)252 1362 A
3510 V
(16204)210 648 A
(#endif)252 1026 A
3600 V
(16205)210 648 A
3690 V
(16206)210 648 A
1026(/*)S
(Global)252 1152 A
(variables.)420 1446 A
1908(*/)S
3780 V
(16207)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(mproc)210 1614 A
(*mp;)168 1866 A
2370(/*)S
(ptr)126 2496 A
2664(to)S
('mproc')294 2790 A
(slot)168 3126 A
3336(of)S
(current)294 3462 A
(process)294 3798 A
4134(*/)S
3870 V
(16208)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(dont_reply;)462 1488 A
2370(/*)S
(normally)336 2496 A
2874(0;)S
(set)126 3000 A
3168(to)S
3294(1)S
3378(to)S
(inhibit)294 3504 A
(reply)210 3840 A
4092(*/)S
3960 V
(16209)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(procs_in_use;)546 1488 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(processes)378 2874 A
(are)126 3294 A
(marked)252 3462 A
3756(as)S
(IN_USE)252 3882 A
4176(*/)S
4050 V
(16210)210 648 A
4140 V
(16211)210 648 A
1026(/*)S
(The)126 1152 A
(parameters)420 1320 A
1782(of)S
(the)126 1908 A
(call)168 2076 A
(are)126 2286 A
(kept)168 2454 A
(here.)210 2664 A
2916(*/)S
4230 V
(16212)210 648 A
(EXTERN)252 1026 A
(message)294 1320 A
(mm_in;)252 1656 A
2370(/*)S
(the)126 2496 A
(incoming)336 2664 A
(message)294 3042 A
(itself)252 3378 A
3672(is)S
(kept)168 3798 A
(here.)210 4008 A
4260(*/)S
4320 V
(16213)210 648 A
(EXTERN)252 1026 A
(message)294 1320 A
(mm_out;)294 1656 A
2370(/*)S
(the)126 2496 A
(reply)210 2664 A
(message)294 2916 A
3252(is)S
(built)210 3378 A
3630(up)S
(here.)210 3756 A
4008(*/)S
4410 V
(16214)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(who;)168 1488 A
2370(/*)S
(caller's)336 2496 A
(proc)168 2874 A
(number)252 3084 A
3378(*/)S
4500 V
(16215)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(mm_call;)336 1488 A
2370(/*)S
(system)252 2496 A
(call)168 2790 A
(number)252 3000 A
3294(*/)S
4590 V
(16216)210 648 A
4680 V
(16217)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(variables)378 1740 A
(are)126 2160 A
(used)168 2328 A
(for)126 2538 A
(returning)378 2706 A
(results)294 3126 A
3462(to)S
(the)126 3588 A
(caller.)294 3756 A
4092(*/)S
4770 V
(16218)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(err_code;)378 1488 A
2370(/*)S
(temporary)378 2496 A
(storage)294 2916 A
(for)126 3252 A
(error)210 3420 A
(number)252 3672 A
3966(*/)S
4860 V
(16219)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(result2;)336 1488 A
2370(/*)S
(secondary)378 2496 A
(result)252 2916 A
3210(*/)S
4950 V
(16220)210 648 A
(EXTERN)252 1026 A
(char)168 1320 A
(*res_ptr;)378 1530 A
2370(/*)S
(result,)294 2496 A
2832(if)S
(pointer)294 2958 A
3294(*/)S
5040 V
(16221)210 648 A
5130 V
(16222)210 648 A
(extern)252 1026 A
(_PROTOTYPE)420 1320 A
(\(int)168 1782 A
(\(*call_vec[]\),)588 1992 A
(\(void\))252 2622 A
2916(\);)S
3042(/*)S
(system)252 3168 A
(call)168 3462 A
(handlers)336 3672 A
4050(*/)S
5220 V
(16223)210 648 A
(extern)252 1026 A
(char)168 1320 A
(core_name[];)504 1530 A
2370(/*)S
(file)168 2496 A
(name)168 2706 A
(where)210 2916 A
(core)168 3168 A
(images)252 3378 A
(are)126 3672 A
(produced)336 3840 A
4218(*/)S
5310 V
(16224)210 648 A
(EXTERN)252 1026 A
(sigset_t)336 1320 A
(core_sset;)420 1698 A
2370(/*)S
(which)210 2496 A
(signals)294 2748 A
(cause)210 3084 A
(core)168 3336 A
(images)252 3546 A
3840(*/)S
8418 V
EP
%%Page: 225 225
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2056(File:)S
2289(src/mm/mproc.h)S
12 B
(225)180 4248 A
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/mm/mproc.h)588 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(16300)210 648 A
1026(/*)S
(This)168 1152 A
(table)210 1362 A
(has)126 1614 A
(one)126 1782 A
(slot)168 1950 A
(per)126 2160 A
(process.)336 2328 A
2748(It)S
(contains)336 2874 A
(all)126 3252 A
(the)126 3420 A
(memory)252 3588 A
(management)420 3882 A
1440 V
(16301)210 648 A
1068(*)S
(information)462 1152 A
(for)126 1656 A
(each)168 1824 A
(process.)336 2034 A
(Among)210 2454 A
(other)210 2706 A
(things,)294 2958 A
3294(it)S
(defines)294 3420 A
(the)126 3756 A
(text,)210 3924 A
(data)168 4176 A
1530 V
(16302)210 648 A
1068(*)S
(and)126 1152 A
(stack)210 1320 A
(segments,)378 1572 A
(uids)168 1992 A
(and)126 2202 A
(gids,)210 2370 A
(and)126 2622 A
(various)294 2790 A
(flags.)252 3126 A
(The)126 3462 A
(kernel)252 3630 A
(and)126 3924 A
(file)168 4092 A
1620 V
(16303)210 648 A
1068(*)S
(systems)294 1152 A
(have)168 1488 A
(tables)252 1698 A
(that)168 1992 A
(are)126 2202 A
(also)168 2370 A
(indexed)294 2580 A
2916(by)S
(process,)336 3042 A
(with)168 3420 A
(the)126 3630 A
(contents)336 3798 A
1710 V
(16304)210 648 A
1068(*)S
1152(of)S
(corresponding)546 1278 A
(slots)210 1866 A
(referring)378 2118 A
2538(to)S
(the)126 2664 A
(same)168 2832 A
(process)294 3042 A
3378(in)S
(all)126 3504 A
(three.)252 3672 A
1800 V
(16305)210 648 A
1068(*/)S
1890 V
(16306)210 648 A
1980 V
(16307)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(mproc)210 1614 A
1866({)S
2070 V
(16308)210 648 A
(struct)252 1110 A
(mem_map)294 1404 A
(mp_seg[NR_SEGS];/*)756 1740 A
(points)252 2538 A
2832(to)S
(text,)210 2958 A
(data,)210 3210 A
(stack)210 3462 A
3714(*/)S
2160 V
(16309)210 648 A
(char)168 1110 A
(mp_exitstatus;)588 1320 A
2370(/*)S
(storage)294 2496 A
(for)126 2832 A
(status)252 3000 A
(when)168 3294 A
(process)294 3504 A
(exits)210 3840 A
4092(*/)S
2250 V
(16310)210 648 A
(char)168 1110 A
(mp_sigstatus;)546 1320 A
2370(/*)S
(storage)294 2496 A
(for)126 2832 A
(signal)252 3000 A
3294(#)S
(for)126 3378 A
(killed)252 3546 A
(procs)210 3840 A
4092(*/)S
2340 V
(16311)210 648 A
(pid_t)210 1110 A
(mp_pid;)294 1362 A
2370(/*)S
(process)294 2496 A
2832(id)S
2958(*/)S
2430 V
(16312)210 648 A
(pid_t)210 1110 A
(mp_procgrp;)462 1362 A
2370(/*)S
(pid)126 2496 A
2664(of)S
(process)294 2790 A
(group)210 3126 A
(\(used)210 3378 A
(for)126 3630 A
(signals\))336 3798 A
4176(*/)S
2520 V
(16313)210 648 A
(pid_t)210 1110 A
(mp_wpid;)336 1362 A
2370(/*)S
(pid)126 2496 A
(this)168 2664 A
(process)294 2874 A
3210(is)S
(waiting)294 3336 A
(for)126 3672 A
3840(*/)S
2610 V
(16314)210 648 A
(int)126 1110 A
(mp_parent;)420 1278 A
2370(/*)S
(index)210 2496 A
2748(of)S
(parent)252 2874 A
(process)294 3168 A
3504(*/)S
2700 V
(16315)210 648 A
2790 V
(16316)210 648 A
1110(/*)S
(Real)168 1236 A
(and)126 1446 A
(effective)378 1614 A
(uids)168 2034 A
(and)126 2244 A
(gids.)210 2412 A
2664(*/)S
2880 V
(16317)210 648 A
(uid_t)210 1110 A
(mp_realuid;)462 1362 A
2370(/*)S
(process')336 2496 A
(real)168 2874 A
(uid)126 3084 A
3252(*/)S
2970 V
(16318)210 648 A
(uid_t)210 1110 A
(mp_effuid;)420 1362 A
2370(/*)S
(process')336 2496 A
(effective)378 2874 A
(uid)126 3294 A
3462(*/)S
3060 V
(16319)210 648 A
(gid_t)210 1110 A
(mp_realgid;)462 1362 A
2370(/*)S
(process')336 2496 A
(real)168 2874 A
(gid)126 3084 A
3252(*/)S
3150 V
(16320)210 648 A
(gid_t)210 1110 A
(mp_effgid;)420 1362 A
2370(/*)S
(process')336 2496 A
(effective)378 2874 A
(gid)126 3294 A
3462(*/)S
3240 V
(16321)210 648 A
3330 V
(16322)210 648 A
1110(/*)S
(File)168 1236 A
(identification)588 1446 A
(for)126 2076 A
(sharing.)336 2244 A
2622(*/)S
3420 V
(16323)210 648 A
(ino_t)210 1110 A
(mp_ino;)294 1362 A
2370(/*)S
(inode)210 2496 A
(number)252 2748 A
3042(of)S
(file)168 3168 A
3378(*/)S
3510 V
(16324)210 648 A
(dev_t)210 1110 A
(mp_dev;)294 1362 A
2370(/*)S
(device)252 2496 A
(number)252 2790 A
3084(of)S
(file)168 3210 A
(system)252 3420 A
3714(*/)S
3600 V
(16325)210 648 A
(time_t)252 1110 A
(mp_ctime;)378 1404 A
2370(/*)S
(inode)210 2496 A
(changed)294 2748 A
(time)168 3084 A
3294(*/)S
3690 V
(16326)210 648 A
3780 V
(16327)210 648 A
1110(/*)S
(Signal)252 1236 A
(handling)336 1530 A
(information.)504 1908 A
2454(*/)S
3870 V
(16328)210 648 A
(sigset_t)336 1110 A
(mp_ignore;)420 1488 A
2370(/*)S
2496(1)S
(means)210 2580 A
(ignore)252 2832 A
(the)126 3126 A
(signal,)294 3294 A
3630(0)S
(means)210 3714 A
(don't)210 3966 A
4218(*/)S
3960 V
(16329)210 648 A
(sigset_t)336 1110 A
(mp_catch;)378 1488 A
2370(/*)S
2496(1)S
(means)210 2580 A
(catch)210 2832 A
(the)126 3084 A
(signal,)294 3252 A
3588(0)S
(means)210 3672 A
(don't)210 3924 A
4176(*/)S
4050 V
(16330)210 648 A
(sigset_t)336 1110 A
(mp_sigmask;)462 1488 A
2370(/*)S
(signals)294 2496 A
2832(to)S
2958(be)S
(blocked)294 3084 A
3420(*/)S
4140 V
(16331)210 648 A
(sigset_t)336 1110 A
(mp_sigmask2;)504 1488 A
2370(/*)S
(saved)210 2496 A
(copy)168 2748 A
2958(of)S
(mp_sigmask)420 3084 A
3546(*/)S
4230 V
(16332)210 648 A
(sigset_t)336 1110 A
(mp_sigpending;)588 1488 A
2370(/*)S
(signals)294 2496 A
(being)210 2832 A
(blocked)294 3084 A
3420(*/)S
4320 V
(16333)210 648 A
(struct)252 1110 A
(sigaction)378 1404 A
(mp_sigact[_NSIG)630 1824 A
2496(+)S
(1];)126 2580 A
2748(/*)S
2874(as)S
3000(in)S
(sigaction\(2\))504 3126 A
3672(*/)S
4410 V
(16334)210 648 A
(vir_bytes)378 1110 A
(mp_sigreturn;)546 1530 A
2370(/*)S
(address)294 2496 A
2832(of)S
2958(C)S
(library)294 3042 A
(__sigreturn)462 3378 A
(function)336 3882 A
4260(*/)S
4500 V
(16335)210 648 A
4590 V
(16336)210 648 A
1110(/*)S
(Backwards)378 1236 A
(compatibility)546 1656 A
(for)126 2244 A
(signals.)336 2412 A
2790(*/)S
4680 V
(16337)210 648 A
(sighandler_t)504 1110 A
(mp_func;)336 1656 A
2370(/*)S
(all)126 2496 A
(sigs)168 2664 A
(vectored)336 2874 A
3252(to)S
3378(a)S
(single)252 3462 A
(user)168 3756 A
(fcn)126 3966 A
4134(*/)S
4770 V
(16338)210 648 A
4860 V
(16339)210 648 A
(unsigned)336 1110 A
(mp_flags;)378 1488 A
2370(/*)S
(flag)168 2496 A
(bits)168 2706 A
2916(*/)S
4950 V
(16340)210 648 A
(vir_bytes)378 1110 A
(mp_procargs;)504 1530 A
2370(/*)S
(ptr)126 2496 A
2664(to)S
(proc's)252 2790 A
(initial)294 3084 A
(stack)210 3420 A
(arguments)378 3672 A
4092(*/)S
5040 V
(16341)210 648 A
1026(})S
(mproc[NR_PROCS];)672 1110 A
5130 V
(16342)210 648 A
5220 V
(16343)210 648 A
1026(/*)S
(Flag)168 1152 A
(values)252 1362 A
1656(*/)S
5310 V
(16344)210 648 A
(#define)294 1026 A
(IN_USE)252 1362 A
(001)126 2076 A
2370(/*)S
(set)126 2496 A
(when)168 2664 A
('mproc')294 2874 A
(slot)168 3210 A
3420(in)S
(use)126 3546 A
3714(*/)S
5400 V
(16345)210 648 A
(#define)294 1026 A
(WAITING)294 1362 A
(002)126 2076 A
2370(/*)S
(set)126 2496 A
2664(by)S
(WAIT)168 2790 A
(system)252 3000 A
(call)168 3294 A
3504(*/)S
5490 V
(16346)210 648 A
(#define)294 1026 A
(HANGING)294 1362 A
(004)126 2076 A
2370(/*)S
(set)126 2496 A
2664(by)S
(EXIT)168 2790 A
(system)252 3000 A
(call)168 3294 A
3504(*/)S
5580 V
(16347)210 648 A
(#define)294 1026 A
(PAUSED)252 1362 A
(010)126 2076 A
2370(/*)S
(set)126 2496 A
2664(by)S
(PAUSE)210 2790 A
(system)252 3042 A
(call)168 3336 A
3546(*/)S
5670 V
(16348)210 648 A
(#define)294 1026 A
(ALARM_ON)336 1362 A
(020)126 2076 A
2370(/*)S
(set)126 2496 A
(when)168 2664 A
(SIGALRM)294 2874 A
(timer)210 3210 A
(started)294 3462 A
3798(*/)S
5760 V
(16349)210 648 A
(#define)294 1026 A
(SEPARATE)336 1362 A
(040)126 2076 A
2370(/*)S
(set)126 2496 A
2664(if)S
(file)168 2790 A
3000(is)S
(separate)336 3126 A
3504(I)S
3588(&)S
3672(D)S
(space)210 3756 A
4008(*/)S
5850 V
(16350)210 648 A
(#define)294 1026 A
(TRACED)252 1362 A
(0100)168 2034 A
2370(/*)S
(set)126 2496 A
2664(if)S
(process)294 2790 A
3126(is)S
3252(to)S
3378(be)S
(traced)252 3504 A
3798(*/)S
5940 V
(16351)210 648 A
(#define)294 1026 A
(STOPPED)294 1362 A
(0200)168 2034 A
2370(/*)S
(set)126 2496 A
2664(if)S
(process)294 2790 A
(stopped)294 3126 A
(for)126 3462 A
(tracing)294 3630 A
3966(*/)S
6030 V
(16352)210 648 A
(#define)294 1026 A
(SIGSUSPENDED)504 1362 A
(0400)168 2034 A
2370(/*)S
(set)126 2496 A
2664(by)S
(SIGSUSPEND)420 2790 A
(system)252 3252 A
(call)168 3546 A
3756(*/)S
6120 V
(16353)210 648 A
6210 V
(16354)210 648 A
(#define)294 1026 A
(NIL_MPROC)378 1362 A
(\(\(struct)336 1782 A
(mproc)210 2160 A
2412(*\))S
2538(0\))S
8418 V
EP
%%Page: 226 226
BP
/slant 0 def
/height 0 def
630 V
12 B
(226)180 648 A
11 R
2059(File:)S
2292(src/mm/param.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/mm/param.h)588 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(16400)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(names)210 1740 A
(are)126 1992 A
(synonyms)336 2160 A
(for)126 2538 A
(the)126 2706 A
(variables)378 2874 A
3294(in)S
(the)126 3420 A
(input)210 3588 A
(message.)336 3840 A
4218(*/)S
1440 V
(16401)210 648 A
(#define)294 1026 A
(addr)168 1362 A
(mm_in.m1_p1)462 2034 A
1530 V
(16402)210 648 A
(#define)294 1026 A
(exec_name)378 1362 A
(mm_in.m1_p1)462 2034 A
1620 V
(16403)210 648 A
(#define)294 1026 A
(exec_len)336 1362 A
(mm_in.m1_i1)462 2034 A
1710 V
(16404)210 648 A
(#define)294 1026 A
(func)168 1362 A
(mm_in.m6_f1)462 2034 A
1800 V
(16405)210 648 A
(#define)294 1026 A
(grpid)210 1362 A
(\(gid_t\))294 2034 A
(mm_in.m1_i1)462 2370 A
1890 V
(16406)210 648 A
(#define)294 1026 A
(namelen)294 1362 A
(mm_in.m1_i1)462 2034 A
1980 V
(16407)210 648 A
(#define)294 1026 A
(pid)126 1362 A
(mm_in.m1_i1)462 2034 A
2070 V
(16408)210 648 A
(#define)294 1026 A
(seconds)294 1362 A
(mm_in.m1_i1)462 2034 A
2160 V
(16409)210 648 A
(#define)294 1026 A
(sig)126 1362 A
(mm_in.m6_i1)462 2034 A
2250 V
(16410)210 648 A
(#define)294 1026 A
(stack_bytes)462 1362 A
(mm_in.m1_i2)462 2034 A
2340 V
(16411)210 648 A
(#define)294 1026 A
(stack_ptr)378 1362 A
(mm_in.m1_p2)462 2034 A
2430 V
(16412)210 648 A
(#define)294 1026 A
(status)252 1362 A
(mm_in.m1_i1)462 2034 A
2520 V
(16413)210 648 A
(#define)294 1026 A
(usr_id)252 1362 A
(\(uid_t\))294 2034 A
(mm_in.m1_i1)462 2370 A
2610 V
(16414)210 648 A
(#define)294 1026 A
(request)294 1362 A
(mm_in.m2_i2)462 2034 A
2700 V
(16415)210 648 A
(#define)294 1026 A
(taddr)210 1362 A
(mm_in.m2_l1)462 2034 A
2790 V
(16416)210 648 A
(#define)294 1026 A
(data)168 1362 A
(mm_in.m2_l2)462 2034 A
2880 V
(16417)210 648 A
(#define)294 1026 A
(sig_nr)252 1362 A
(mm_in.m1_i2)462 2034 A
2970 V
(16418)210 648 A
(#define)294 1026 A
(sig_nsa)294 1362 A
(mm_in.m1_p1)462 2034 A
3060 V
(16419)210 648 A
(#define)294 1026 A
(sig_osa)294 1362 A
(mm_in.m1_p2)462 2034 A
3150 V
(16420)210 648 A
(#define)294 1026 A
(sig_ret)294 1362 A
(mm_in.m1_p3)462 2034 A
3240 V
(16421)210 648 A
(#define)294 1026 A
(sig_set)294 1362 A
(mm_in.m2_l1)462 2034 A
3330 V
(16422)210 648 A
(#define)294 1026 A
(sig_how)294 1362 A
(mm_in.m2_i1)462 2034 A
3420 V
(16423)210 648 A
(#define)294 1026 A
(sig_flags)378 1362 A
(mm_in.m2_i2)462 2034 A
3510 V
(16424)210 648 A
(#define)294 1026 A
(sig_context)462 1362 A
(mm_in.m2_p1)462 2034 A
3600 V
(16425)210 648 A
(#ifdef)252 1026 A
(_SIGMESSAGE)462 1320 A
3690 V
(16426)210 648 A
(#define)294 1026 A
(sig_msg)294 1362 A
(mm_in.m1_i1)462 2034 A
3780 V
(16427)210 648 A
(#endif)252 1026 A
3870 V
(16428)210 648 A
(#define)294 1026 A
(reboot_flag)462 1362 A
(mm_in.m1_i1)462 2034 A
3960 V
(16429)210 648 A
(#define)294 1026 A
(reboot_code)462 1362 A
(mm_in.m1_p1)462 2034 A
4050 V
(16430)210 648 A
(#define)294 1026 A
(reboot_size)462 1362 A
(mm_in.m1_i2)462 2034 A
4140 V
(16431)210 648 A
4230 V
(16432)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(names)210 1740 A
(are)126 1992 A
(synonyms)336 2160 A
(for)126 2538 A
(the)126 2706 A
(variables)378 2874 A
3294(in)S
(the)126 3420 A
(output)252 3588 A
(message.)336 3882 A
4260(*/)S
4320 V
(16433)210 648 A
(#define)294 1026 A
(reply_type)420 1362 A
(mm_out.m_type)546 2034 A
4410 V
(16434)210 648 A
(#define)294 1026 A
(reply_i1)336 1362 A
(mm_out.m2_i1)504 2034 A
4500 V
(16435)210 648 A
(#define)294 1026 A
(reply_p1)336 1362 A
(mm_out.m2_p1)504 2034 A
4590 V
(16436)210 648 A
(#define)294 1026 A
(ret_mask)336 1362 A
(mm_out.m2_l1)504 2034 A
4680 V
(16437)210 648 A
5040 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5130 V
(src/mm/table.c)588 2034 A
5220 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5400 V
(16500)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(table)210 2118 A
(used)168 2370 A
2580(to)S
(map)126 2706 A
(system)252 2874 A
(call)168 3168 A
(numbers)294 3378 A
(onto)168 3714 A
(the)126 3924 A
5490 V
(16501)210 648 A
1068(*)S
(routines)336 1152 A
(that)168 1530 A
(perform)294 1740 A
(them.)210 2076 A
5580 V
(16502)210 648 A
1068(*/)S
5670 V
(16503)210 648 A
5760 V
(16504)210 648 A
(#define)294 1026 A
(_TABLE)252 1362 A
5850 V
(16505)210 648 A
5940 V
(16506)210 648 A
(#include)336 1026 A
("mm.h")252 1404 A
6030 V
(16507)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
6120 V
(16508)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
6210 V
(16509)210 648 A
(#include)336 1026 A
("mproc.h")378 1404 A
8418 V
EP
%%Page: 227 227
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2092(File:)S
2325(src/mm/table.c)S
12 B
(227)180 4248 A
900 V
7 LST
(16510)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
990 V
(16511)210 648 A
1080 V
(16512)210 648 A
1026(/*)S
(Miscellaneous)546 1152 A
1740(*/)S
1170 V
(16513)210 648 A
(char)168 1026 A
(core_name[])462 1236 A
1740(=)S
("core";)294 1824 A
2370(/*)S
(file)168 2496 A
(name)168 2706 A
(where)210 2916 A
(core)168 3168 A
(images)252 3378 A
(are)126 3672 A
(produced)336 3840 A
4218(*/)S
1260 V
(16514)210 648 A
1350 V
(16515)210 648 A
(_PROTOTYPE)420 1026 A
(\(int)168 1488 A
(\(*call_vec[NCALLS]\),)840 1698 A
(\(void\))252 2580 A
2874(\))S
2958(=)S
3042({)S
1440 V
(16516)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2202(0)S
2286(=)S
(unused)252 2370 A
2706(*/)S
1530 V
(16517)210 648 A
(do_mm_exit,)462 1362 A
2034(/*)S
2202(1)S
2286(=)S
(exit)168 2370 A
2706(*/)S
1620 V
(16518)210 648 A
(do_fork,)336 1362 A
2034(/*)S
2202(2)S
2286(=)S
(fork)168 2370 A
2706(*/)S
1710 V
(16519)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2202(3)S
2286(=)S
(read)168 2370 A
2706(*/)S
1800 V
(16520)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2202(4)S
2286(=)S
(write)210 2370 A
2706(*/)S
1890 V
(16521)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2202(5)S
2286(=)S
(open)168 2370 A
2706(*/)S
1980 V
(16522)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2202(6)S
2286(=)S
(close)210 2370 A
2706(*/)S
2070 V
(16523)210 648 A
(do_waitpid,)462 1362 A
2034(/*)S
2202(7)S
2286(=)S
(wait)168 2370 A
2706(*/)S
2160 V
(16524)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2202(8)S
2286(=)S
(creat)210 2370 A
2706(*/)S
2250 V
(16525)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2202(9)S
2286(=)S
(link)168 2370 A
2706(*/)S
2340 V
(16526)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(10)S
2286(=)S
(unlink)252 2370 A
2706(*/)S
2430 V
(16527)210 648 A
(do_waitpid,)462 1362 A
2034(/*)S
2160(11)S
2286(=)S
(waitpid)294 2370 A
2706(*/)S
2520 V
(16528)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(12)S
2286(=)S
(chdir)210 2370 A
2706(*/)S
2610 V
(16529)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(13)S
2286(=)S
(time)168 2370 A
2706(*/)S
2700 V
(16530)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(14)S
2286(=)S
(mknod)210 2370 A
2706(*/)S
2790 V
(16531)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(15)S
2286(=)S
(chmod)210 2370 A
2706(*/)S
2880 V
(16532)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(16)S
2286(=)S
(chown)210 2370 A
2706(*/)S
2970 V
(16533)210 648 A
(do_brk,)294 1362 A
2034(/*)S
2160(17)S
2286(=)S
(break)210 2370 A
2706(*/)S
3060 V
(16534)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(18)S
2286(=)S
(stat)168 2370 A
2706(*/)S
3150 V
(16535)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(19)S
2286(=)S
(lseek)210 2370 A
2706(*/)S
3240 V
(16536)210 648 A
(do_getset,)420 1362 A
2034(/*)S
2160(20)S
2286(=)S
(getpid)252 2370 A
2706(*/)S
3330 V
(16537)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(21)S
2286(=)S
(mount)210 2370 A
2706(*/)S
3420 V
(16538)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(22)S
2286(=)S
(umount)252 2370 A
2706(*/)S
3510 V
(16539)210 648 A
(do_getset,)420 1362 A
2034(/*)S
2160(23)S
2286(=)S
(setuid)252 2370 A
2706(*/)S
3600 V
(16540)210 648 A
(do_getset,)420 1362 A
2034(/*)S
2160(24)S
2286(=)S
(getuid)252 2370 A
2706(*/)S
3690 V
(16541)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(25)S
2286(=)S
(stime)210 2370 A
2706(*/)S
3780 V
(16542)210 648 A
(do_trace,)378 1362 A
2034(/*)S
2160(26)S
2286(=)S
(ptrace)252 2370 A
2706(*/)S
3870 V
(16543)210 648 A
(do_alarm,)378 1362 A
2034(/*)S
2160(27)S
2286(=)S
(alarm)210 2370 A
2706(*/)S
3960 V
(16544)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(28)S
2286(=)S
(fstat)210 2370 A
2706(*/)S
4050 V
(16545)210 648 A
(do_pause,)378 1362 A
2034(/*)S
2160(29)S
2286(=)S
(pause)210 2370 A
2706(*/)S
4140 V
(16546)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(30)S
2286(=)S
(utime)210 2370 A
2706(*/)S
4230 V
(16547)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(31)S
2286(=)S
(\(stty\))252 2370 A
2706(*/)S
4320 V
(16548)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(32)S
2286(=)S
(\(gtty\))252 2370 A
2706(*/)S
4410 V
(16549)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(33)S
2286(=)S
(access)252 2370 A
2706(*/)S
4500 V
(16550)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(34)S
2286(=)S
(\(nice\))252 2370 A
2706(*/)S
4590 V
(16551)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(35)S
2286(=)S
(\(ftime\))294 2370 A
2706(*/)S
4680 V
(16552)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(36)S
2286(=)S
(sync)168 2370 A
2706(*/)S
4770 V
(16553)210 648 A
(do_kill,)336 1362 A
2034(/*)S
2160(37)S
2286(=)S
(kill)168 2370 A
2706(*/)S
4860 V
(16554)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(38)S
2286(=)S
(rename)252 2370 A
2706(*/)S
4950 V
(16555)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(39)S
2286(=)S
(mkdir)210 2370 A
2706(*/)S
5040 V
(16556)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(40)S
2286(=)S
(rmdir)210 2370 A
2706(*/)S
5130 V
(16557)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(41)S
2286(=)S
(dup)126 2370 A
2706(*/)S
5220 V
(16558)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(42)S
2286(=)S
(pipe)168 2370 A
2706(*/)S
5310 V
(16559)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(43)S
2286(=)S
(times)210 2370 A
2706(*/)S
5400 V
(16560)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(44)S
2286(=)S
(\(prof\))252 2370 A
2706(*/)S
5490 V
(16561)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(45)S
2286(=)S
(unused)252 2370 A
2706(*/)S
5580 V
(16562)210 648 A
(do_getset,)420 1362 A
2034(/*)S
2160(46)S
2286(=)S
(setgid)252 2370 A
2706(*/)S
5670 V
(16563)210 648 A
(do_getset,)420 1362 A
2034(/*)S
2160(47)S
2286(=)S
(getgid)252 2370 A
2706(*/)S
5760 V
(16564)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(48)S
2286(=)S
(\(signal\)*/)420 2370 A
5850 V
(16565)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(49)S
2286(=)S
(unused)252 2370 A
2706(*/)S
5940 V
(16566)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(50)S
2286(=)S
(unused)252 2370 A
2706(*/)S
6030 V
(16567)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(51)S
2286(=)S
(\(acct\))252 2370 A
2706(*/)S
6120 V
(16568)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(52)S
2286(=)S
(\(phys\))252 2370 A
2706(*/)S
6210 V
(16569)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(53)S
2286(=)S
(\(lock\))252 2370 A
2706(*/)S
8418 V
EP
%%Page: 228 228
BP
/slant 0 def
/height 0 def
630 V
12 B
(228)180 648 A
11 R
2092(File:)S
2325(src/mm/table.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(16570)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(54)S
2286(=)S
(ioctl)210 2370 A
2706(*/)S
990 V
(16571)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(55)S
2286(=)S
(fcntl)210 2370 A
2706(*/)S
1080 V
(16572)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(56)S
2286(=)S
(\(mpx\))210 2370 A
2706(*/)S
1170 V
(16573)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(57)S
2286(=)S
(unused)252 2370 A
2706(*/)S
1260 V
(16574)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(58)S
2286(=)S
(unused)252 2370 A
2706(*/)S
1350 V
(16575)210 648 A
(do_exec,)336 1362 A
2034(/*)S
2160(59)S
2286(=)S
(execve)252 2370 A
2706(*/)S
1440 V
(16576)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(60)S
2286(=)S
(umask)210 2370 A
2706(*/)S
1530 V
(16577)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(61)S
2286(=)S
(chroot)252 2370 A
2706(*/)S
1620 V
(16578)210 648 A
(do_getset,)420 1362 A
2034(/*)S
2160(62)S
2286(=)S
(setsid)252 2370 A
2706(*/)S
1710 V
(16579)210 648 A
(do_getset,)420 1362 A
2034(/*)S
2160(63)S
2286(=)S
(getpgrp)294 2370 A
2706(*/)S
1800 V
(16580)210 648 A
1890 V
(16581)210 648 A
(do_ksig,)336 1362 A
2034(/*)S
2160(64)S
2286(=)S
(KSIG:)210 2370 A
(signals)294 2622 A
(originating)462 2958 A
3462(in)S
(the)126 3588 A
(kernel)252 3756 A
4050(*/)S
1980 V
(16582)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(65)S
2286(=)S
(UNPAUSE)294 2370 A
2706(*/)S
2070 V
(16583)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(66)S
2286(=)S
(unused)252 2370 A
2706(*/)S
2160 V
(16584)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(67)S
2286(=)S
(REVIVE)252 2370 A
2706(*/)S
2250 V
(16585)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(68)S
2286(=)S
(TASK_REPLY)420 2370 A
2874(*/)S
2340 V
(16586)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(69)S
2286(=)S
(unused)252 2370 A
2706(*/)S
2430 V
(16587)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(70)S
2286(=)S
(unused)252 2370 A
2706(*/)S
2520 V
(16588)210 648 A
(do_sigaction,)546 1362 A
2034(/*)S
2160(71)S
2286(=)S
(sigaction)378 2370 A
2874(*/)S
2610 V
(16589)210 648 A
(do_sigsuspend,)588 1362 A
2034(/*)S
2160(72)S
2286(=)S
(sigsuspend)420 2370 A
2874(*/)S
2700 V
(16590)210 648 A
(do_sigpending,)588 1362 A
2034(/*)S
2160(73)S
2286(=)S
(sigpending)420 2370 A
2874(*/)S
2790 V
(16591)210 648 A
(do_sigprocmask,)630 1362 A
2034(/*)S
2160(74)S
2286(=)S
(sigprocmask)462 2370 A
2874(*/)S
2880 V
(16592)210 648 A
(do_sigreturn,)546 1362 A
2034(/*)S
2160(75)S
2286(=)S
(sigreturn)378 2370 A
2874(*/)S
2970 V
(16593)210 648 A
(do_reboot,)420 1362 A
2034(/*)S
2160(76)S
2286(=)S
(reboot)252 2370 A
2706(*/)S
3060 V
(16594)210 648 A
1026(};)S
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(src/mm/main.c)546 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(16600)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(main)168 2118 A
(program)294 2328 A
2664(of)S
(the)126 2790 A
(memory)252 2958 A
(manager)294 3252 A
(and)126 3588 A
(some)168 3756 A
(related)294 3966 A
4140 V
(16601)210 648 A
1068(*)S
(procedures.)462 1152 A
(When)168 1698 A
(MINIX)210 1908 A
(starts)252 2160 A
(up,)126 2454 A
(the)126 2622 A
(kernel)252 2790 A
(runs)168 3084 A
(for)126 3294 A
3462(a)S
(little)252 3546 A
(while,)252 3840 A
4230 V
(16602)210 648 A
1068(*)S
(initializing)504 1152 A
(itself)252 1698 A
(and)126 1992 A
(its)126 2160 A
(tasks,)252 2328 A
(and)126 2622 A
(then)168 2790 A
3000(it)S
(runs)168 3126 A
3336(MM)S
(and)126 3462 A
(FS.)126 3630 A
(Both)168 3840 A
4050(MM)S
4320 V
(16603)210 648 A
1068(*)S
(and)126 1152 A
1320(FS)S
(initialize)420 1446 A
(themselves)420 1908 A
2370(as)S
(far)126 2496 A
2664(as)S
(they)168 2790 A
(can.)168 3000 A
3252(FS)S
(then)168 3378 A
(makes)210 3588 A
3840(a)S
(call)168 3924 A
4134(to)S
4410 V
(16604)210 648 A
1068(*)S
(MM,)126 1152 A
(because)294 1320 A
1656(MM)S
(has)126 1782 A
1950(to)S
(wait)168 2076 A
(for)126 2286 A
2454(FS)S
2580(to)S
(acquire)294 2706 A
3042(a)S
(RAM)126 3126 A
(disk.)210 3294 A
3588(MM)S
(asks)168 3714 A
(the)126 3924 A
4500 V
(16605)210 648 A
1068(*)S
(kernel)252 1152 A
(for)126 1446 A
(all)126 1614 A
(free)168 1782 A
(memory)252 1992 A
(and)126 2286 A
(starts)252 2454 A
(serving)294 2748 A
(requests.)378 3084 A
4590 V
(16606)210 648 A
1068(*)S
4680 V
(16607)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are:)168 2496 A
4770 V
(16608)210 648 A
1068(*)S
(main:)210 1236 A
(starts)252 1698 A
1992(MM)S
(running)294 2118 A
4860 V
(16609)210 648 A
1068(*)S
(reply:)252 1236 A
(reply)210 1698 A
1950(to)S
2076(a)S
(process)294 2160 A
(making)252 2496 A
2790(an)S
2916(MM)S
(system)252 3042 A
(call)168 3336 A
4950 V
(16610)210 648 A
1068(*/)S
5040 V
(16611)210 648 A
5130 V
(16612)210 648 A
(#include)336 1026 A
("mm.h")252 1404 A
5220 V
(16613)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
5310 V
(16614)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
5400 V
(16615)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
5490 V
(16616)210 648 A
(#include)336 1026 A
(<fcntl.h>)378 1404 A
5580 V
(16617)210 648 A
(#include)336 1026 A
(<sys/ioctl.h>)546 1404 A
5670 V
(16618)210 648 A
(#include)336 1026 A
("mproc.h")378 1404 A
5760 V
(16619)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
5850 V
(16620)210 648 A
5940 V
(16621)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(get_work,)378 2076 A
(\(void\))252 2496 A
4050(\);)S
6030 V
(16622)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(mm_init,)336 2076 A
(\(void\))252 2454 A
4050(\);)S
6120 V
(16623)210 648 A
6210 V
(16624)210 648 A
(/*===========================================================================*)3276 1026 A
8418 V
EP
%%Page: 229 229
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
2322(src/mm/main.c)S
12 B
(229)180 4248 A
900 V
7 LST
(16625)210 648 A
1068(*)S
(main)168 2370 A
4260(*)S
990 V
(16626)210 648 A
(*===========================================================================*/)3276 1068 A
1080 V
(16627)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(main\(\))252 1530 A
1170 V
(16628)210 648 A
1026({)S
1260 V
(16629)210 648 A
1026(/*)S
(Main)168 1152 A
(routine)294 1362 A
1698(of)S
(the)126 1824 A
(memory)252 1992 A
(manager.)336 2286 A
2664(*/)S
1350 V
(16630)210 648 A
1440 V
(16631)210 648 A
(int)126 1110 A
(error;)252 1278 A
1530 V
(16632)210 648 A
1620 V
(16633)210 648 A
(mm_init\(\);)420 1110 A
2370(/*)S
(initialize)420 2496 A
(memory)252 2958 A
(manager)294 3252 A
(tables)252 3588 A
3882(*/)S
1710 V
(16634)210 648 A
1800 V
(16635)210 648 A
1110(/*)S
(This)168 1236 A
1446(is)S
(MM's)168 1572 A
(main)168 1782 A
(loop-)210 1992 A
(get)126 2286 A
(work)168 2454 A
(and)126 2664 A
2832(do)S
(it,)126 2958 A
(forever)294 3126 A
(and)126 3462 A
(forever.)336 3630 A
4008(*/)S
1890 V
(16636)210 648 A
(while)210 1110 A
(\(TRUE\))252 1362 A
1656({)S
1980 V
(16637)210 648 A
1362(/*)S
(Wait)168 1488 A
(for)126 1698 A
(message.)336 1866 A
2244(*/)S
2070 V
(16638)210 648 A
(get_work\(\);)462 1362 A
2370(/*)S
(wait)168 2496 A
(for)126 2706 A
2874(an)S
3000(MM)S
(system)252 3126 A
(call)168 3420 A
3630(*/)S
2160 V
(16639)210 648 A
1362(mp)S
1488(=)S
(&mproc[who];)504 1572 A
2250 V
(16640)210 648 A
2340 V
(16641)210 648 A
1362(/*)S
(Set)126 1488 A
(some)168 1656 A
(flags.)252 1866 A
2160(*/)S
2430 V
(16642)210 648 A
(error)210 1362 A
1614(=)S
(OK;)126 1698 A
2520 V
(16643)210 648 A
(dont_reply)420 1362 A
1824(=)S
(FALSE;)252 1908 A
2610 V
(16644)210 648 A
(err_code)336 1362 A
1740(=)S
(-999;)210 1824 A
2700 V
(16645)210 648 A
2790 V
(16646)210 648 A
1362(/*)S
1488(If)S
(the)126 1614 A
(call)168 1782 A
(number)252 1992 A
2286(is)S
(valid,)252 2412 A
(perform)294 2706 A
(the)126 3042 A
(call.)210 3210 A
3462(*/)S
2880 V
(16647)210 648 A
1362(if)S
(\(mm_call)336 1488 A
1866(<)S
1950(0)S
2034(||)S
(mm_call)294 2160 A
2496(>=)S
(NCALLS\))294 2622 A
2970 V
(16648)210 648 A
(error)210 1698 A
1950(=)S
(EBADCALL;)378 2034 A
3060 V
(16649)210 648 A
(else)168 1362 A
3150 V
(16650)210 648 A
(error)210 1698 A
1950(=)S
(\(*call_vec[mm_call]\)\(\);)966 2034 A
3240 V
(16651)210 648 A
3330 V
(16652)210 648 A
1362(/*)S
(Send)168 1488 A
(the)126 1698 A
(results)294 1866 A
(back)168 2202 A
2412(to)S
(the)126 2538 A
(user)168 2706 A
2916(to)S
(indicate)336 3042 A
(completion.)462 3420 A
3924(*/)S
3420 V
(16653)210 648 A
1362(if)S
(\(dont_reply\))504 1488 A
(continue;)378 2034 A
2706(/*)S
2832(no)S
(reply)210 2958 A
(for)126 3210 A
(EXIT)168 3378 A
(and)126 3588 A
(WAIT)168 3756 A
3966(*/)S
3510 V
(16654)210 648 A
1362(if)S
(\(mm_call)336 1488 A
1866(==)S
(EXEC)168 1992 A
2202(&&)S
(error)210 2328 A
2580(==)S
(OK\))126 2706 A
(continue;)378 2874 A
3600 V
(16655)210 648 A
(reply\(who,)420 1362 A
(error,)252 1824 A
(result2,)336 2118 A
(res_ptr\);)378 2496 A
3690 V
(16656)210 648 A
1110(})S
3780 V
(16657)210 648 A
1026(})S
4050 V
(16660)210 648 A
(/*===========================================================================*)3276 1026 A
4140 V
(16661)210 648 A
1068(*)S
(get_work)336 2370 A
4260(*)S
4230 V
(16662)210 648 A
(*===========================================================================*/)3276 1068 A
4320 V
(16663)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(get_work\(\))420 1572 A
4410 V
(16664)210 648 A
1026({)S
4500 V
(16665)210 648 A
1026(/*)S
(Wait)168 1152 A
(for)126 1362 A
(the)126 1530 A
(next)168 1698 A
(message)294 1908 A
(and)126 2244 A
(extract)294 2412 A
(useful)252 2748 A
(information)462 3042 A
(from)168 3546 A
(it.)126 3756 A
3924(*/)S
4590 V
(16666)210 648 A
4680 V
(16667)210 648 A
1110(if)S
(\(receive\(ANY,)546 1236 A
(&mm_in\))294 1824 A
2160(!=)S
(OK\))126 2286 A
(panic\("MM)378 2454 A
(receive)294 2874 A
(error",)294 3210 A
(NO_NUM\);)336 3546 A
4770 V
(16668)210 648 A
(who)126 1110 A
1278(=)S
(mm_in.m_source;)630 1362 A
2370(/*)S
(who)126 2496 A
(sent)168 2664 A
(the)126 2874 A
(message)294 3042 A
3378(*/)S
4860 V
(16669)210 648 A
(mm_call)294 1110 A
1446(=)S
(mm_in.m_type;)546 1530 A
2370(/*)S
(system)252 2496 A
(call)168 2790 A
(number)252 3000 A
3294(*/)S
4950 V
(16670)210 648 A
1026(})S
5220 V
(16673)210 648 A
(/*===========================================================================*)3276 1026 A
5310 V
(16674)210 648 A
1068(*)S
(reply)210 2370 A
4260(*)S
5400 V
(16675)210 648 A
(*===========================================================================*/)3276 1068 A
5490 V
(16676)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(reply\(proc_nr,)588 1530 A
(result,)294 2160 A
(res2,)210 2496 A
(respt\))252 2748 A
5580 V
(16677)210 648 A
(int)126 1026 A
(proc_nr;)336 1194 A
2370(/*)S
(process)294 2496 A
2832(to)S
(reply)210 2958 A
3210(to)S
3336(*/)S
5670 V
(16678)210 648 A
(int)126 1026 A
(result;)294 1194 A
2370(/*)S
(result)252 2496 A
2790(of)S
(the)126 2916 A
(call)168 3084 A
(\(usually)336 3294 A
3672(OK)S
3798(or)S
(error)210 3924 A
(#\)*/)168 4176 A
5760 V
(16679)210 648 A
(int)126 1026 A
(res2;)210 1194 A
2370(/*)S
(secondary)378 2496 A
(result)252 2916 A
3210(*/)S
5850 V
(16680)210 648 A
(char)168 1026 A
(*respt;)294 1236 A
2370(/*)S
(result)252 2496 A
2790(if)S
(pointer)294 2916 A
3252(*/)S
5940 V
(16681)210 648 A
1026({)S
6030 V
(16682)210 648 A
1026(/*)S
(Send)168 1152 A
1362(a)S
(reply)210 1446 A
1698(to)S
1824(a)S
(user)168 1908 A
(process.)336 2118 A
2496(*/)S
6120 V
(16683)210 648 A
6210 V
(16684)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*proc_ptr;)420 2034 A
8418 V
EP
%%Page: 230 230
BP
/slant 0 def
/height 0 def
630 V
12 B
(230)180 648 A
11 R
2089(File:)S
2322(src/mm/main.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(16685)210 648 A
990 V
(16686)210 648 A
(proc_ptr)336 1110 A
1488(=)S
(&mproc[proc_nr];)672 1572 A
1080 V
(16687)210 648 A
1110(/*)S
1170 V
(16688)210 648 A
1152(*)S
1236(To)S
(make)168 1362 A
1572(MM)S
(robust,)294 1698 A
(check)210 2034 A
2286(to)S
(see)126 2412 A
2580(if)S
(destination)462 2706 A
3210(is)S
(still)210 3336 A
(alive.)252 3588 A
(This)168 3924 A
1260 V
(16689)210 648 A
1152(*)S
(validy)252 1236 A
(check)210 1530 A
(must)168 1782 A
1992(be)S
(skipped)294 2118 A
2454(if)S
(the)126 2580 A
(caller)252 2748 A
3042(is)S
3168(a)S
(task.)210 3252 A
1350 V
(16690)210 648 A
1152(*/)S
1440 V
(16691)210 648 A
1110(if)S
(\(\(who)210 1236 A
(>=0\))168 1488 A
1698(&&)S
(\(\(proc_ptr->mp_flags&IN_USE\))1176 1824 A
3042(==)S
3168(0)S
3252(||)S
1530 V
(16692)210 648 A
(\(proc_ptr->mp_flags&HANGING\)\)\))1260 1362 A
(return;)294 2664 A
1620 V
(16693)210 648 A
1710 V
(16694)210 648 A
(reply_type)420 1110 A
1572(=)S
(result;)294 1656 A
1800 V
(16695)210 648 A
(reply_i1)336 1110 A
1488(=)S
(res2;)210 1572 A
1890 V
(16696)210 648 A
(reply_p1)336 1110 A
1488(=)S
(respt;)252 1572 A
1980 V
(16697)210 648 A
1110(if)S
(\(send\(proc_nr,)588 1236 A
(&mm_out\))336 1866 A
2244(!=)S
(OK\))126 2370 A
(panic\("MM)378 2538 A
(can't)210 2958 A
(reply",)294 3210 A
(NO_NUM\);)336 3546 A
2070 V
(16698)210 648 A
1026(})S
2340 V
(16701)210 648 A
(/*===========================================================================*)3276 1026 A
2430 V
(16702)210 648 A
1068(*)S
(mm_init)294 2370 A
4260(*)S
2520 V
(16703)210 648 A
(*===========================================================================*/)3276 1068 A
2610 V
(16704)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(mm_init\(\))378 1572 A
2700 V
(16705)210 648 A
1026({)S
2790 V
(16706)210 648 A
1026(/*)S
(Initialize)420 1152 A
(the)126 1614 A
(memory)252 1782 A
(manager.)336 2076 A
2454(*/)S
2880 V
(16707)210 648 A
2970 V
(16708)210 648 A
(static)252 1110 A
(char)168 1404 A
(core_sigs[])462 1614 A
2118(=)S
2202({)S
3060 V
(16709)210 648 A
(SIGQUIT,)336 1362 A
(SIGILL,)294 1740 A
(SIGTRAP,)336 2076 A
(SIGABRT,)336 2454 A
3150 V
(16710)210 648 A
(SIGEMT,)294 1362 A
(SIGFPE,)294 1698 A
(SIGUSR1,)336 2034 A
(SIGSEGV,)336 2412 A
3240 V
(16711)210 648 A
(SIGUSR2,)336 1362 A
1740(0)S
1824(};)S
3330 V
(16712)210 648 A
(register)336 1110 A
(int)126 1488 A
(proc_nr;)336 1656 A
3420 V
(16713)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rmp;)210 2034 A
3510 V
(16714)210 648 A
(register)336 1110 A
(char)168 1488 A
(*sig_ptr;)378 1698 A
3600 V
(16715)210 648 A
(phys_clicks)462 1110 A
(ram_clicks,)462 1614 A
(total_clicks,)546 2118 A
(minix_clicks,)546 2706 A
(free_clicks,)504 3294 A
(dummy;)252 3840 A
3690 V
(16716)210 648 A
(message)294 1110 A
(mess;)210 1446 A
3780 V
(16717)210 648 A
(struct)252 1110 A
(mem_map)294 1404 A
(kernel_map[NR_SEGS];)840 1740 A
3870 V
(16718)210 648 A
(int)126 1110 A
(mem;)168 1278 A
3960 V
(16719)210 648 A
4050 V
(16720)210 648 A
1110(/*)S
(Build)210 1236 A
(the)126 1488 A
(set)126 1656 A
1824(of)S
(signals)294 1950 A
(which)210 2286 A
(cause)210 2538 A
(core)168 2790 A
(dumps.)252 3000 A
3294(Do)S
3420(it)S
(the)126 3546 A
(Posix)210 3714 A
4140 V
(16721)210 648 A
1152(*)S
(way,)168 1236 A
1446(so)S
1572(no)S
(knowledge)378 1698 A
2118(of)S
(bit)126 2244 A
(positions)378 2412 A
2832(is)S
(needed.)294 2958 A
4230 V
(16722)210 648 A
1152(*/)S
4320 V
(16723)210 648 A
(sigemptyset\(&core_sset\);)1008 1110 A
4410 V
(16724)210 648 A
(for)126 1110 A
(\(sig_ptr)336 1278 A
1656(=)S
(core_sigs;)420 1740 A
(*sig_ptr)336 2202 A
2580(!=)S
2706(0;)S
(sig_ptr++\))420 2832 A
4500 V
(16725)210 648 A
(sigaddset\(&core_sset,)882 1362 A
(*sig_ptr\);)420 2286 A
4590 V
(16726)210 648 A
4680 V
(16727)210 648 A
1110(/*)S
(Get)126 1236 A
(the)126 1404 A
(memory)252 1572 A
(map)126 1866 A
2034(of)S
(the)126 2160 A
(kernel)252 2328 A
2622(to)S
(see)126 2748 A
(how)126 2916 A
(much)168 3084 A
(memory)252 3294 A
3588(it)S
(uses,)210 3714 A
4770 V
(16728)210 648 A
1152(*)S
(including)378 1236 A
(the)126 1656 A
(gap)126 1824 A
(between)294 1992 A
(address)294 2328 A
2664(0)S
(and)126 2748 A
(the)126 2916 A
(start)210 3084 A
3336(of)S
(the)126 3462 A
(kernel.)294 3630 A
4860 V
(16729)210 648 A
1152(*/)S
4950 V
(16730)210 648 A
(sys_getmap\(SYSTASK,)798 1110 A
(kernel_map\);)504 1950 A
5040 V
(16731)210 648 A
(minix_clicks)504 1110 A
1656(=)S
(kernel_map[S].mem_phys)924 1740 A
2706(+)S
(kernel_map[S].mem_len;)924 2790 A
5130 V
(16732)210 648 A
5220 V
(16733)210 648 A
1110(/*)S
(Initialize)420 1236 A
(MM's)168 1698 A
(tables.)294 1908 A
2244(*/)S
5310 V
(16734)210 648 A
(for)126 1110 A
(\(proc_nr)336 1278 A
1656(=)S
1740(0;)S
(proc_nr)294 1866 A
2202(<=)S
(INIT_PROC_NR;)546 2328 A
(proc_nr++\))420 2916 A
3378({)S
5400 V
(16735)210 648 A
(rmp)126 1362 A
1530(=)S
(&mproc[proc_nr];)672 1614 A
5490 V
(16736)210 648 A
(rmp->mp_flags)546 1362 A
1950(|=)S
(IN_USE;)294 2076 A
5580 V
(16737)210 648 A
(sys_getmap\(proc_nr,)798 1362 A
(rmp->mp_seg\);)546 2202 A
5670 V
(16738)210 648 A
1362(if)S
(\(rmp->mp_seg[T].mem_len)966 1488 A
2496(!=)S
2622(0\))S
(rmp->mp_flags)546 2748 A
3336(|=)S
(SEPARATE;)378 3462 A
5760 V
(16739)210 648 A
(minix_clicks)504 1362 A
1908(+=)S
(\(rmp->mp_seg[S].mem_phys)1008 2034 A
3084(+)S
(rmp->mp_seg[S].mem_len\))966 3168 A
5850 V
(16740)210 648 A
2370(-)S
(rmp->mp_seg[T].mem_phys;)1008 2454 A
5940 V
(16741)210 648 A
1110(})S
6030 V
(16742)210 648 A
(mproc[INIT_PROC_NR].mp_pid)1092 1110 A
2244(=)S
(INIT_PID;)378 2328 A
6120 V
(16743)210 648 A
(sigemptyset\(&mproc[INIT_PROC_NR].mp_ignore\);)1848 1110 A
6210 V
(16744)210 648 A
(sigemptyset\(&mproc[INIT_PROC_NR].mp_catch\);)1806 1110 A
8418 V
EP
%%Page: 231 231
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2089(File:)S
2322(src/mm/main.c)S
12 B
(231)180 4248 A
900 V
7 LST
(16745)210 648 A
(procs_in_use)504 1110 A
1656(=)S
(LOW_USER)336 1740 A
2118(+)S
2202(1;)S
990 V
(16746)210 648 A
1080 V
(16747)210 648 A
1110(/*)S
(Wait)168 1236 A
(for)126 1446 A
1614(FS)S
1740(to)S
(send)168 1866 A
2076(a)S
(message)294 2160 A
(telling)294 2496 A
(the)126 2832 A
(RAM)126 3000 A
(disk)168 3168 A
(size)168 3378 A
(then)168 3588 A
3798(go)S
("on-line".)420 3924 A
1170 V
(16748)210 648 A
1152(*/)S
1260 V
(16749)210 648 A
1110(if)S
(\(receive\(FS_PROC_NR,)840 1236 A
(&mess\))252 2118 A
2412(!=)S
(OK\))126 2538 A
1350 V
(16750)210 648 A
(panic\("MM)378 1362 A
(can't)210 1782 A
(obtain)252 2034 A
(RAM)126 2328 A
(disk)168 2496 A
(size)168 2706 A
(from)168 2916 A
(FS",)168 3126 A
(NO_NUM\);)336 3336 A
1440 V
(16751)210 648 A
1530 V
(16752)210 648 A
(ram_clicks)420 1110 A
1572(=)S
(mess.m1_i1;)462 1656 A
1620 V
(16753)210 648 A
1710 V
(16754)210 648 A
1110(/*)S
(Initialize)420 1236 A
(tables)252 1698 A
1992(to)S
(all)126 2118 A
(physical)336 2286 A
(mem.)168 2664 A
2874(*/)S
1800 V
(16755)210 648 A
(mem_init\(&total_clicks,)966 1110 A
(&free_clicks\);)588 2118 A
1890 V
(16756)210 648 A
1980 V
(16757)210 648 A
1110(/*)S
(Print)210 1236 A
(memory)252 1488 A
(information.)504 1782 A
2328(*/)S
2070 V
(16758)210 648 A
(printf\("\\nMemory)672 1110 A
(size)168 1824 A
(=%5dK)210 2034 A
2370(",)S
(click_to_round_k\(total_clicks\)\);)1344 2496 A
2160 V
(16759)210 648 A
(printf\("MINIX)546 1110 A
(=%4dK)210 1698 A
2034(",)S
(click_to_round_k\(minix_clicks\)\);)1344 2160 A
2250 V
(16760)210 648 A
(printf\("RAM)462 1110 A
(disk)168 1614 A
(=%5dK)210 1824 A
2160(",)S
(click_to_round_k\(ram_clicks\)\);)1260 2286 A
2340 V
(16761)210 648 A
(printf\("Available)714 1110 A
(=%5dK\\n\\n",)462 1866 A
(click_to_round_k\(free_clicks\)\);)1302 2370 A
2430 V
(16762)210 648 A
2520 V
(16763)210 648 A
1110(/*)S
(Tell)168 1236 A
1446(FS)S
1572(to)S
(continue.)378 1698 A
2118(*/)S
2610 V
(16764)210 648 A
1110(if)S
(\(send\(FS_PROC_NR,)714 1236 A
(&mess\))252 1992 A
2286(!=)S
(OK\))126 2412 A
2700 V
(16765)210 648 A
(panic\("MM)378 1362 A
(can't)210 1782 A
(sync)168 2034 A
2244(up)S
(with)168 2370 A
(FS",)168 2580 A
(NO_NUM\);)336 2790 A
2790 V
(16766)210 648 A
2880 V
(16767)210 648 A
1110(/*)S
(Tell)168 1236 A
(the)126 1446 A
(memory)252 1614 A
(task)168 1908 A
(where)210 2118 A
2370(my)S
(process)294 2496 A
(table)210 2832 A
3084(is)S
(for)126 3210 A
(the)126 3378 A
(sake)168 3546 A
3756(of)S
(ps\(1\).)252 3882 A
4176(*/)S
2970 V
(16768)210 648 A
1110(if)S
(\(\(mem)210 1236 A
1488(=)S
(open\("/dev/mem",)672 1572 A
(O_RDWR\)\))336 2286 A
2664(!=)S
(-1\))126 2790 A
2958({)S
3060 V
(16769)210 648 A
(ioctl\(mem,)420 1362 A
(MIOCSPSINFO,)504 1824 A
(\(void)210 2370 A
2622(*\))S
(mproc\);)294 2748 A
3150 V
(16770)210 648 A
(close\(mem\);)462 1362 A
3240 V
(16771)210 648 A
1110(})S
3330 V
(16772)210 648 A
1026(})S
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(src/mm/forkexit.c)714 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(16800)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(deals)210 1572 A
(with)168 1824 A
(creating)336 2034 A
(processes)378 2412 A
(\(via)168 2832 A
(FORK\))210 3042 A
(and)126 3294 A
(deleting)336 3462 A
(them)168 3840 A
(\(via)168 4050 A
4140 V
(16801)210 648 A
1068(*)S
(EXIT/WAIT\).)462 1152 A
(When)168 1698 A
1908(a)S
(process)294 1992 A
(forks,)252 2328 A
2622(a)S
(new)126 2706 A
(slot)168 2874 A
3084(in)S
(the)126 3210 A
('mproc')294 3378 A
(table)210 3714 A
3966(is)S
4230 V
(16802)210 648 A
1068(*)S
(allocated)378 1152 A
(for)126 1572 A
(it,)126 1740 A
(and)126 1908 A
2076(a)S
(copy)168 2160 A
2370(of)S
(the)126 2496 A
(parent's)336 2664 A
(core)168 3042 A
(image)210 3252 A
3504(is)S
(made)168 3630 A
(for)126 3840 A
(the)126 4008 A
4320 V
(16803)210 648 A
1068(*)S
(child.)252 1152 A
(Then)168 1488 A
(the)126 1698 A
(kernel)252 1866 A
(and)126 2160 A
(file)168 2328 A
(system)252 2538 A
(are)126 2832 A
(informed.)378 3000 A
3462(A)S
(process)294 3546 A
3882(is)S
(removed)294 4008 A
4410 V
(16804)210 648 A
1068(*)S
(from)168 1152 A
(the)126 1362 A
('mproc')294 1530 A
(table)210 1866 A
(when)168 2118 A
(two)126 2328 A
(events)252 2496 A
(have)168 2790 A
(occurred:)378 3000 A
(\(1\))126 3420 A
3588(it)S
(has)126 3714 A
(exited)252 3882 A
4176(or)S
4500 V
(16805)210 648 A
1068(*)S
(been)168 1152 A
(killed)252 1362 A
1656(by)S
1782(a)S
(signal,)294 1866 A
(and)126 2202 A
(\(2\))126 2370 A
(the)126 2538 A
(parent)252 2706 A
(has)126 3000 A
(done)168 3168 A
3378(a)S
(WAIT.)210 3462 A
3756(If)S
(the)126 3882 A
(process)294 4050 A
4590 V
(16806)210 648 A
1068(*)S
(exits)210 1152 A
(first,)252 1404 A
1698(it)S
(continues)378 1824 A
2244(to)S
(occupy)252 2370 A
2664(a)S
(slot)168 2748 A
(until)210 2958 A
(the)126 3210 A
(parent)252 3378 A
(does)168 3672 A
3882(a)S
(WAIT.)210 3966 A
4680 V
(16807)210 648 A
1068(*)S
4770 V
(16808)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are:)168 2496 A
4860 V
(16809)210 648 A
1068(*)S
(do_fork:)336 1236 A
(perform)294 1740 A
(the)126 2076 A
(FORK)168 2244 A
(system)252 2454 A
(call)168 2748 A
4950 V
(16810)210 648 A
1068(*)S
(do_mm_exit:)462 1236 A
(perform)294 1740 A
(the)126 2076 A
(EXIT)168 2244 A
(system)252 2454 A
(call)168 2748 A
(\(by)126 2958 A
(calling)294 3126 A
(mm_exit\(\)\))420 3462 A
5040 V
(16811)210 648 A
1068(*)S
(mm_exit:)336 1236 A
(actually)336 1740 A
2118(do)S
(the)126 2244 A
(exiting)294 2412 A
5130 V
(16812)210 648 A
1068(*)S
(do_wait:)336 1236 A
(perform)294 1740 A
(the)126 2076 A
(WAITPID)294 2244 A
2580(or)S
(WAIT)168 2706 A
(system)252 2916 A
(call)168 3210 A
5220 V
(16813)210 648 A
1068(*/)S
5310 V
(16814)210 648 A
5400 V
(16815)210 648 A
5490 V
(16816)210 648 A
(#include)336 1026 A
("mm.h")252 1404 A
5580 V
(16817)210 648 A
(#include)336 1026 A
(<sys/wait.h>)504 1404 A
5670 V
(16818)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
5760 V
(16819)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
5850 V
(16820)210 648 A
(#include)336 1026 A
("mproc.h")378 1404 A
5940 V
(16821)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
6030 V
(16822)210 648 A
6120 V
(16823)210 648 A
(#define)294 1026 A
(LAST_FEW)336 1362 A
2202(2)S
2370(/*)S
(last)168 2496 A
(few)126 2706 A
(slots)210 2874 A
(reserved)336 3126 A
(for)126 3504 A
(superuser)378 3672 A
4092(*/)S
6210 V
(16824)210 648 A
8418 V
EP
%%Page: 232 232
BP
/slant 0 def
/height 0 def
630 V
12 B
(232)180 648 A
11 R
2025(File:)S
2258(src/mm/forkexit.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(16825)210 648 A
(PRIVATE)294 1026 A
(pid_t)210 1362 A
(next_pid)336 1614 A
1992(=)S
(INIT_PID+1;)462 2076 A
2706(/*)S
(next)168 2832 A
(pid)126 3042 A
3210(to)S
3336(be)S
(assigned)336 3462 A
3840(*/)S
990 V
(16826)210 648 A
1080 V
(16827)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE)420 1362 A
(\(void)210 1824 A
(cleanup,)336 2076 A
(\(register)378 2454 A
(struct)252 2874 A
(mproc)210 3168 A
(*child\))294 3420 A
3756(\);)S
1170 V
(16828)210 648 A
1260 V
(16829)210 648 A
(/*===========================================================================*)3276 1026 A
1350 V
(16830)210 648 A
1068(*)S
(do_fork)294 2370 A
4260(*)S
1440 V
(16831)210 648 A
(*===========================================================================*/)3276 1068 A
1530 V
(16832)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_fork\(\))378 1488 A
1620 V
(16833)210 648 A
1026({)S
1710 V
(16834)210 648 A
1026(/*)S
(The)126 1152 A
(process)294 1320 A
(pointed)294 1656 A
1992(to)S
2118(by)S
('mp')168 2244 A
(has)126 2454 A
(forked.)294 2622 A
(Create)252 3000 A
3294(a)S
(child)210 3378 A
(process.)336 3630 A
4008(*/)S
1800 V
(16835)210 648 A
1890 V
(16836)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rmp;)210 2034 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(parent)252 2958 A
3252(*/)S
1980 V
(16837)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rmc;)210 2034 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(child)210 2958 A
3210(*/)S
2070 V
(16838)210 648 A
(int)126 1110 A
1278(i,)S
(child_nr,)378 1404 A
1824(t;)S
2160 V
(16839)210 648 A
(phys_clicks)462 1110 A
(prog_clicks,)504 1614 A
(child_base)420 2160 A
2622(=)S
2706(0;)S
2250 V
(16840)210 648 A
(phys_bytes)420 1110 A
(prog_bytes,)462 1572 A
(parent_abs,)462 2076 A
(child_abs;)420 2580 A
3042(/*)S
(Intel)210 3168 A
(only)168 3420 A
3630(*/)S
2340 V
(16841)210 648 A
2430 V
(16842)210 648 A
1068(/*)S
1194(If)S
(tables)252 1320 A
(might)210 1614 A
(fill)168 1866 A
2076(up)S
(during)252 2202 A
(FORK,)210 2496 A
(don't)210 2748 A
(even)168 3000 A
(start)210 3210 A
(since)210 3462 A
(recovery)336 3714 A
(half)168 4092 A
2520 V
(16843)210 648 A
1110(*)S
(way)126 1194 A
(through)294 1362 A
1698(is)S
(such)168 1824 A
2034(a)S
(nuisance.)378 2118 A
2610 V
(16844)210 648 A
1110(*/)S
2700 V
(16845)210 648 A
(rmp)126 1110 A
1278(=)S
(mp;)126 1362 A
2790 V
(16846)210 648 A
1110(if)S
(\(procs_in_use)546 1236 A
1824(==)S
(NR_PROCS\))378 1950 A
(return\(EAGAIN\);)630 2370 A
2880 V
(16847)210 648 A
1110(if)S
(\(procs_in_use)546 1236 A
1824(>=)S
(NR_PROCS-LAST_FEW)714 1950 A
2706(&&)S
(rmp->mp_effuid)588 2832 A
3462(!=)S
(0\)return\(EAGAIN\);)714 3588 A
2970 V
(16848)210 648 A
3060 V
(16849)210 648 A
1110(/*)S
(Determine)378 1236 A
(how)126 1656 A
(much)168 1824 A
(memory)252 2034 A
2328(to)S
(allocate.)378 2454 A
(Only)168 2916 A
(the)126 3126 A
(data)168 3294 A
(and)126 3504 A
(stack)210 3672 A
(need)168 3924 A
4134(to)S
3150 V
(16850)210 648 A
1152(*)S
1236(be)S
(copied,)294 1362 A
(because)294 1698 A
(the)126 2034 A
(text)168 2202 A
(segment)294 2412 A
2748(is)S
(either)252 2874 A
(shared)252 3168 A
3462(or)S
3588(of)S
(zero)168 3714 A
(length.)294 3924 A
3240 V
(16851)210 648 A
1152(*/)S
3330 V
(16852)210 648 A
(prog_clicks)462 1110 A
1614(=)S
(\(phys_clicks\))546 1698 A
(rmp->mp_seg[S].mem_len;)966 2286 A
3420 V
(16853)210 648 A
(prog_clicks)462 1110 A
1614(+=)S
(\(rmp->mp_seg[S].mem_vir)966 1740 A
2748(-)S
(rmp->mp_seg[D].mem_vir\);)1008 2832 A
3510 V
(16854)210 648 A
(prog_bytes)420 1110 A
1572(=)S
(\(phys_bytes\))504 1656 A
(prog_clicks)462 2202 A
2706(<<)S
(CLICK_SHIFT;)504 2832 A
3600 V
(16855)210 648 A
1110(if)S
1236(\()S
(\(child_base)462 1320 A
1824(=)S
(alloc_mem\(prog_clicks\)\))966 1908 A
2916(==)S
(NO_MEM\))294 3042 A
(return\(EAGAIN\);)630 3378 A
3690 V
(16856)210 648 A
3780 V
(16857)210 648 A
1110(/*)S
(Create)252 1236 A
1530(a)S
(copy)168 1614 A
1824(of)S
(the)126 1950 A
(parent's)336 2118 A
(core)168 2496 A
(image)210 2706 A
(for)126 2958 A
(the)126 3126 A
(child.)252 3294 A
3588(*/)S
3870 V
(16858)210 648 A
(child_abs)378 1110 A
1530(=)S
(\(phys_bytes\))504 1614 A
(child_base)420 2160 A
2622(<<)S
(CLICK_SHIFT;)504 2748 A
3960 V
(16859)210 648 A
(parent_abs)420 1110 A
1572(=)S
(\(phys_bytes\))504 1656 A
(rmp->mp_seg[D].mem_phys)966 2202 A
3210(<<)S
(CLICK_SHIFT;)504 3336 A
4050 V
(16860)210 648 A
1110(i)S
1194(=)S
(sys_copy\(ABS,)546 1278 A
1866(0,)S
(parent_abs,)462 1992 A
(ABS,)168 2496 A
2706(0,)S
(child_abs,)420 2832 A
(prog_bytes\);)504 3294 A
4140 V
(16861)210 648 A
1110(if)S
1236(\(i)S
1362(<)S
1446(0\))S
(panic\("do_fork)588 1572 A
(can't)210 2202 A
(copy",)252 2454 A
(i\);)126 2748 A
4230 V
(16862)210 648 A
4320 V
(16863)210 648 A
1110(/*)S
(Find)168 1236 A
1446(a)S
(slot)168 1530 A
1740(in)S
('mproc')294 1866 A
(for)126 2202 A
(the)126 2370 A
(child)210 2538 A
(process.)336 2790 A
3210(A)S
(slot)168 3294 A
(must)168 3504 A
(exist.)252 3714 A
4008(*/)S
4410 V
(16864)210 648 A
(for)126 1110 A
(\(rmc)168 1278 A
1488(=)S
(&mproc[0];)420 1572 A
(rmc)126 2034 A
2202(<)S
(&mproc[NR_PROCS];)714 2286 A
(rmc++\))252 3042 A
4500 V
(16865)210 648 A
1362(if)S
1488(\()S
(\(rmc->mp_flags)588 1572 A
2202(&)S
(IN_USE\))294 2286 A
2622(==)S
2748(0\))S
(break;)252 2874 A
4590 V
(16866)210 648 A
4680 V
(16867)210 648 A
1110(/*)S
(Set)126 1236 A
1404(up)S
(the)126 1530 A
(child)210 1698 A
(and)126 1950 A
(its)126 2118 A
(memory)252 2286 A
(map;)168 2580 A
(copy)168 2790 A
(its)126 3000 A
('mproc')294 3168 A
(slot)168 3504 A
(from)168 3714 A
(parent.)294 3924 A
4260(*/)S
4770 V
(16868)210 648 A
(child_nr)336 1110 A
1488(=)S
(\(int\)\(rmc)378 1572 A
1992(-)S
(mproc\);)294 2076 A
2706(/*)S
(slot)168 2832 A
(number)252 3042 A
3336(of)S
(the)126 3462 A
(child)210 3630 A
3882(*/)S
4860 V
(16869)210 648 A
(procs_in_use++;)630 1110 A
4950 V
(16870)210 648 A
(*rmc)168 1110 A
1320(=)S
(*rmp;)210 1404 A
2370(/*)S
(copy)168 2496 A
(parent's)336 2706 A
(process)294 3084 A
(slot)168 3420 A
3630(to)S
(child's)294 3756 A
4092(*/)S
5040 V
(16871)210 648 A
5130 V
(16872)210 648 A
(rmc->mp_parent)588 1110 A
1740(=)S
(who;)168 1824 A
2370(/*)S
(record)252 2496 A
(child's)294 2790 A
(parent)252 3126 A
3420(*/)S
5220 V
(16873)210 648 A
(rmc->mp_flags)546 1110 A
1698(&=)S
(\304TRACED;)336 1824 A
2370(/*)S
(child)210 2496 A
(does)168 2748 A
(not)126 2958 A
(inherit)294 3126 A
(trace)210 3462 A
(status)252 3714 A
4008(*/)S
5310 V
(16874)210 648 A
1110(/*)S
1236(A)S
(separate)336 1320 A
(I&D)126 1698 A
(child)210 1866 A
(keeps)210 2118 A
(the)126 2370 A
(parents)294 2538 A
(text)168 2874 A
(segment.)336 3084 A
(The)126 3504 A
(data)168 3672 A
(and)126 3882 A
(stack)210 4050 A
5400 V
(16875)210 648 A
1152(*)S
(segments)336 1236 A
(must)168 1614 A
(refer)210 1824 A
2076(to)S
(the)126 2202 A
(new)126 2370 A
(copy.)210 2538 A
5490 V
(16876)210 648 A
1152(*/)S
5580 V
(16877)210 648 A
1110(if)S
(\(!\(rmc->mp_flags)672 1236 A
1950(&)S
(SEPARATE\)\))420 2034 A
(rmc->mp_seg[T].mem_phys)966 2496 A
3504(=)S
(child_base;)462 3588 A
5670 V
(16878)210 648 A
(rmc->mp_seg[D].mem_phys)966 1110 A
2118(=)S
(child_base;)462 2202 A
5760 V
(16879)210 648 A
(rmc->mp_seg[S].mem_phys)966 1110 A
2118(=)S
(rmc->mp_seg[D].mem_phys)966 2202 A
3210(+)S
5850 V
(16880)210 648 A
(\(rmp->mp_seg[S].mem_vir)966 2034 A
3042(-)S
(rmp->mp_seg[D].mem_vir\);)1008 3126 A
5940 V
(16881)210 648 A
(rmc->mp_exitstatus)756 1110 A
1908(=)S
1992(0;)S
6030 V
(16882)210 648 A
(rmc->mp_sigstatus)714 1110 A
1866(=)S
1950(0;)S
6120 V
(16883)210 648 A
6210 V
(16884)210 648 A
1110(/*)S
(Find)168 1236 A
1446(a)S
(free)168 1530 A
(pid)126 1740 A
(for)126 1908 A
(the)126 2076 A
(child)210 2244 A
(and)126 2496 A
(put)126 2664 A
2832(it)S
2958(in)S
(the)126 3084 A
(table.)252 3252 A
3546(*/)S
8418 V
EP
%%Page: 233 233
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2025(File:)S
2258(src/mm/forkexit.c)S
12 B
(233)180 4248 A
900 V
7 LST
(16885)210 648 A
1110(do)S
1236({)S
990 V
(16886)210 648 A
1362(t)S
1446(=)S
1530(0;)S
2370(/*)S
('t')126 2496 A
2664(=)S
2748(0)S
(means)210 2832 A
(pid)126 3084 A
(still)210 3252 A
(free)168 3504 A
3714(*/)S
1080 V
(16887)210 648 A
(next_pid)336 1362 A
1740(=)S
(\(next_pid)378 1824 A
2244(<)S
(30000)210 2328 A
2580(?)S
(next_pid)336 2664 A
3042(+)S
3126(1)S
3210(:)S
(INIT_PID)336 3294 A
3672(+)S
(1\);)126 3756 A
1170 V
(16888)210 648 A
(for)126 1362 A
(\(rmp)168 1530 A
1740(=)S
(&mproc[0];)420 1824 A
(rmp)126 2286 A
2454(<)S
(&mproc[NR_PROCS];)714 2538 A
(rmp++\))252 3294 A
1260 V
(16889)210 648 A
1698(if)S
(\(rmp->mp_pid)504 1824 A
2370(==)S
(next_pid)336 2496 A
2874(||)S
(rmp->mp_procgrp)630 3000 A
3672(==)S
(next_pid\))378 3798 A
4218({)S
1350 V
(16890)210 648 A
2034(t)S
2118(=)S
2202(1;)S
1440 V
(16891)210 648 A
(break;)252 2034 A
1530 V
(16892)210 648 A
1698(})S
1620 V
(16893)210 648 A
(rmc->mp_pid)462 1362 A
1866(=)S
(next_pid;)378 1950 A
2370(/*)S
(assign)252 2496 A
(pid)126 2790 A
2958(to)S
(child)210 3084 A
3336(*/)S
1710 V
(16894)210 648 A
1110(})S
(while)210 1194 A
(\(t\);)168 1446 A
1800 V
(16895)210 648 A
1890 V
(16896)210 648 A
1110(/*)S
(Tell)168 1236 A
(kernel)252 1446 A
(and)126 1740 A
(file)168 1908 A
(system)252 2118 A
(about)210 2412 A
(the)126 2664 A
(\(now)168 2832 A
(successful\))462 3042 A
(FORK.)210 3546 A
3798(*/)S
1980 V
(16897)210 648 A
(sys_fork\(who,)546 1110 A
(child_nr,)378 1698 A
(rmc->mp_pid,)504 2118 A
(child_base\);)504 2664 A
3210(/*)S
(child_base)420 3336 A
3798(is)S
(68K)126 3924 A
(only*/)252 4092 A
2070 V
(16898)210 648 A
(tell_fs\(FORK,)546 1110 A
(who,)168 1698 A
(child_nr,)378 1908 A
(rmc->mp_pid\);)546 2328 A
2160 V
(16899)210 648 A
2250 V
(16900)210 648 A
1110(/*)S
(Report)252 1236 A
(child's)294 1530 A
(memory)252 1866 A
(map)126 2160 A
2328(to)S
(kernel.)294 2454 A
2790(*/)S
2340 V
(16901)210 648 A
(sys_newmap\(child_nr,)840 1110 A
(rmc->mp_seg\);)546 1992 A
2430 V
(16902)210 648 A
2520 V
(16903)210 648 A
1110(/*)S
(Reply)210 1236 A
1488(to)S
(child)210 1614 A
1866(to)S
(wake)168 1992 A
2202(it)S
(up.)126 2328 A
2496(*/)S
2610 V
(16904)210 648 A
(reply\(child_nr,)630 1110 A
1782(0,)S
1908(0,)S
(NIL_PTR\);)378 2034 A
2700 V
(16905)210 648 A
(return\(next_pid\);)714 1110 A
2412(/*)S
(child's)294 2538 A
(pid)126 2874 A
3042(*/)S
2790 V
(16906)210 648 A
1026(})S
3060 V
(16909)210 648 A
(/*===========================================================================*)3276 1026 A
3150 V
(16910)210 648 A
1068(*)S
(do_mm_exit)420 2370 A
4260(*)S
3240 V
(16911)210 648 A
(*===========================================================================*/)3276 1068 A
3330 V
(16912)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_mm_exit\(\))504 1488 A
3420 V
(16913)210 648 A
1026({)S
3510 V
(16914)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(exit\(status\))504 1656 A
(system)252 2202 A
(call.)210 2496 A
(The)126 2748 A
(real)168 2916 A
(work)168 3126 A
3336(is)S
(done)168 3462 A
3672(by)S
(mm_exit\(\),)420 3798 A
3600 V
(16915)210 648 A
1068(*)S
(which)210 1152 A
1404(is)S
(also)168 1530 A
(called)252 1740 A
(when)168 2034 A
2244(a)S
(process)294 2328 A
2664(is)S
(killed)252 2790 A
3084(by)S
3210(a)S
(signal.)294 3294 A
3690 V
(16916)210 648 A
1068(*/)S
3780 V
(16917)210 648 A
3870 V
(16918)210 648 A
(mm_exit\(mp,)462 1110 A
(status\);)336 1614 A
3960 V
(16919)210 648 A
(dont_reply)420 1110 A
1572(=)S
(TRUE;)210 1656 A
2370(/*)S
(don't)210 2496 A
(reply)210 2748 A
3000(to)S
(newly)210 3126 A
(terminated)420 3378 A
(process)294 3840 A
4176(*/)S
4050 V
(16920)210 648 A
(return\(OK\);)462 1110 A
2370(/*)S
(pro)126 2496 A
(forma)210 2664 A
(return)252 2916 A
(code)168 3210 A
3420(*/)S
4140 V
(16921)210 648 A
1026(})S
4410 V
(16924)210 648 A
(/*===========================================================================*)3276 1026 A
4500 V
(16925)210 648 A
1068(*)S
(mm_exit)294 2370 A
4260(*)S
4590 V
(16926)210 648 A
(*===========================================================================*/)3276 1068 A
4680 V
(16927)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(mm_exit\(rmp,)504 1530 A
(exit_status\))504 2076 A
4770 V
(16928)210 648 A
(register)336 1026 A
(struct)252 1404 A
(mproc)210 1698 A
(*rmp;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(the)126 2958 A
(process)294 3126 A
3462(to)S
3588(be)S
(terminated)420 3714 A
4176(*/)S
4860 V
(16929)210 648 A
(int)126 1026 A
(exit_status;)504 1194 A
2370(/*)S
(the)126 2496 A
(process')336 2664 A
(exit)168 3042 A
(status)252 3252 A
(\(for)168 3546 A
(parent\))294 3756 A
4092(*/)S
4950 V
(16930)210 648 A
1026({)S
5040 V
(16931)210 648 A
1026(/*)S
1152(A)S
(process)294 1236 A
1572(is)S
(done.)210 1698 A
(Release)294 1992 A
(most)168 2328 A
2538(of)S
(the)126 2664 A
(process')336 2832 A
(possessions.)504 3210 A
3798(If)S
(its)126 3924 A
5130 V
(16932)210 648 A
1068(*)S
(parent)252 1152 A
1446(is)S
(waiting,)336 1572 A
(release)294 1950 A
(the)126 2286 A
(rest,)210 2454 A
(else)168 2706 A
(hang.)210 2916 A
5220 V
(16933)210 648 A
1068(*/)S
5310 V
(16934)210 648 A
5400 V
(16935)210 648 A
(register)336 1110 A
(int)126 1488 A
(proc_nr;)336 1656 A
5490 V
(16936)210 648 A
(int)126 1110 A
(parent_waiting,)630 1278 A
(right_child;)504 1950 A
5580 V
(16937)210 648 A
(pid_t)210 1110 A
(pidarg,)294 1362 A
(procgrp;)336 1698 A
5670 V
(16938)210 648 A
(phys_clicks)462 1110 A
(base,)210 1614 A
(size,)210 1866 A
2118(s;)S
2706(/*)S
(base)168 2832 A
(and)126 3042 A
(size)168 3210 A
(used)168 3420 A
3630(on)S
(68000)210 3756 A
(only)168 4008 A
4218(*/)S
5760 V
(16939)210 648 A
5850 V
(16940)210 648 A
(proc_nr)294 1110 A
1446(=)S
(\(int\))210 1530 A
(\(rmp)168 1782 A
1992(-)S
(mproc\);)294 2076 A
2706(/*)S
(get)126 2832 A
(process)294 3000 A
(slot)168 3336 A
(number)252 3546 A
3840(*/)S
5940 V
(16941)210 648 A
6030 V
(16942)210 648 A
1110(/*)S
(Remember)336 1236 A
1614(a)S
(session)294 1698 A
(leader's)336 2034 A
(process)294 2412 A
(group.)252 2748 A
3042(*/)S
6120 V
(16943)210 648 A
(procgrp)294 1110 A
1446(=)S
(\(rmp->mp_pid)504 1530 A
2076(==)S
(mp->mp_procgrp\))630 2202 A
2874(?)S
(mp->mp_procgrp)588 2958 A
3588(:)S
3672(0;)S
6210 V
(16944)210 648 A
8418 V
EP
%%Page: 234 234
BP
/slant 0 def
/height 0 def
630 V
12 B
(234)180 648 A
11 R
2025(File:)S
2258(src/mm/forkexit.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(16945)210 648 A
1110(/*)S
1236(If)S
(the)126 1362 A
(exited)252 1530 A
(process)294 1824 A
(has)126 2160 A
2328(a)S
(timer)210 2412 A
(pending,)336 2664 A
(kill)168 3042 A
(it.)126 3252 A
3420(*/)S
990 V
(16946)210 648 A
1110(if)S
(\(rmp->mp_flags)588 1236 A
1866(&)S
(ALARM_ON\))378 1950 A
(set_alarm\(proc_nr,)756 2370 A
(\(unsigned\))420 3168 A
(0\);)126 3630 A
1080 V
(16947)210 648 A
1170 V
(16948)210 648 A
1110(/*)S
(Tell)168 1236 A
(the)126 1446 A
(kernel)252 1614 A
(and)126 1908 A
2076(FS)S
(that)168 2202 A
(the)126 2412 A
(process)294 2580 A
2916(is)S
3042(no)S
(longer)252 3168 A
(runnable.)378 3462 A
3882(*/)S
1260 V
(16949)210 648 A
(tell_fs\(EXIT,)546 1110 A
(proc_nr,)336 1698 A
2076(0,)S
(0\);)126 2202 A
2412(/*)S
(file)168 2538 A
(system)252 2748 A
(can)126 3042 A
(free)168 3210 A
(the)126 3420 A
(proc)168 3588 A
(slot)168 3798 A
4008(*/)S
1350 V
(16950)210 648 A
(sys_xit\(rmp->mp_parent,)966 1110 A
(proc_nr,)336 2118 A
(&base,)252 2496 A
(&size\);)294 2790 A
1440 V
(16951)210 648 A
1530 V
(16952)210 648 A
1110(/*)S
(Release)294 1236 A
(the)126 1572 A
(memory)252 1740 A
(occupied)336 2034 A
2412(by)S
(the)126 2538 A
(child.)252 2706 A
3000(*/)S
1620 V
(16953)210 648 A
1110(if)S
(\(find_share\(rmp,)672 1236 A
(rmp->mp_ino,)504 1950 A
(rmp->mp_dev,)504 2496 A
(rmp->mp_ctime\))588 3042 A
3672(==)S
(NULL\))210 3798 A
4050({)S
1710 V
(16954)210 648 A
1362(/*)S
1488(No)S
(other)210 1614 A
(process)294 1866 A
(shares)252 2202 A
(the)126 2496 A
(text)168 2664 A
(segment,)336 2874 A
3252(so)S
(free)168 3378 A
(it.)126 3588 A
3756(*/)S
1800 V
(16955)210 648 A
(free_mem\(rmp->mp_seg[T].mem_phys,)1386 1362 A
(rmp->mp_seg[T].mem_len\);)1008 2790 A
1890 V
(16956)210 648 A
1110(})S
1980 V
(16957)210 648 A
1110(/*)S
(Free)168 1236 A
(the)126 1446 A
(data)168 1614 A
(and)126 1824 A
(stack)210 1992 A
(segments.)378 2244 A
2664(*/)S
2070 V
(16958)210 648 A
(free_mem\(rmp->mp_seg[D].mem_phys,)1386 1110 A
2160 V
(16959)210 648 A
(rmp->mp_seg[S].mem_vir)924 1278 A
2244(+)S
(rmp->mp_seg[S].mem_len)924 2328 A
3294(-)S
(rmp->mp_seg[D].mem_vir\);)1008 3378 A
2250 V
(16960)210 648 A
2340 V
(16961)210 648 A
1110(/*)S
(The)126 1236 A
(process)294 1404 A
(slot)168 1740 A
(can)126 1950 A
(only)168 2118 A
2328(be)S
(freed)210 2454 A
2706(if)S
(the)126 2832 A
(parent)252 3000 A
(has)126 3294 A
(done)168 3462 A
3672(a)S
(WAIT.)210 3756 A
4008(*/)S
2430 V
(16962)210 648 A
(rmp->mp_exitstatus)756 1110 A
1908(=)S
(\(char\))252 1992 A
(exit_status;)504 2286 A
2520 V
(16963)210 648 A
(pidarg)252 1110 A
1404(=)S
(mproc[rmp->mp_parent].mp_wpid;)1260 1488 A
3042(/*)S
(who's)210 3168 A
(being)210 3420 A
(waited)252 3672 A
(for?)168 3966 A
4176(*/)S
2610 V
(16964)210 648 A
(parent_waiting)588 1110 A
1740(=)S
(mproc[rmp->mp_parent].mp_flags)1260 1824 A
3126(&)S
(WAITING;)336 3210 A
2700 V
(16965)210 648 A
1110(if)S
(\(pidarg)294 1236 A
1572(==)S
1698(-1)S
1824(||)S
(pidarg)252 1950 A
2244(==)S
(rmp->mp_pid)462 2370 A
2874(||)S
(-pidarg)294 3000 A
3336(==)S
(rmp->mp_procgrp\))672 3462 A
2790 V
(16966)210 648 A
(right_child)462 1362 A
1866(=)S
(TRUE;)210 1950 A
2706(/*)S
(child)210 2832 A
(meets)210 3084 A
(one)126 3336 A
3504(of)S
(the)126 3630 A
3798(3)S
(tests)210 3882 A
4134(*/)S
2880 V
(16967)210 648 A
(else)168 1110 A
2970 V
(16968)210 648 A
(right_child)462 1362 A
1866(=)S
(FALSE;)252 1950 A
2706(/*)S
(child)210 2832 A
(fails)210 3084 A
(all)126 3336 A
3504(3)S
(tests)210 3588 A
3840(*/)S
3060 V
(16969)210 648 A
1110(if)S
(\(parent_waiting)630 1236 A
1908(&&)S
(right_child\))504 2034 A
3150 V
(16970)210 648 A
(cleanup\(rmp\);)546 1362 A
2706(/*)S
(tell)168 2832 A
(parent)252 3042 A
(and)126 3336 A
(release)294 3504 A
(child)210 3840 A
(slot)168 4092 A
4302(*/)S
3240 V
(16971)210 648 A
(else)168 1110 A
3330 V
(16972)210 648 A
(rmp->mp_flags)546 1362 A
1950(|=)S
(HANGING;)336 2076 A
2706(/*)S
(parent)252 2832 A
(not)126 3126 A
(waiting,)336 3294 A
(suspend)294 3672 A
(child)210 4008 A
4260(*/)S
3420 V
(16973)210 648 A
3510 V
(16974)210 648 A
1110(/*)S
1236(If)S
(the)126 1362 A
(process)294 1530 A
(has)126 1866 A
(children,)378 2034 A
(disinherit)420 2454 A
(them.)210 2916 A
(INIT)168 3210 A
3420(is)S
(the)126 3546 A
(new)126 3714 A
(parent.)294 3882 A
4218(*/)S
3600 V
(16975)210 648 A
(for)126 1110 A
(\(rmp)168 1278 A
1488(=)S
(&mproc[0];)420 1572 A
(rmp)126 2034 A
2202(<)S
(&mproc[NR_PROCS];)714 2286 A
(rmp++\))252 3042 A
3336({)S
3690 V
(16976)210 648 A
1362(if)S
(\(rmp->mp_flags)588 1488 A
2118(&)S
(IN_USE)252 2202 A
2496(&&)S
(rmp->mp_parent)588 2622 A
3252(==)S
(proc_nr\))336 3378 A
3756({)S
3780 V
(16977)210 648 A
1698(/*)S
('rmp')210 1824 A
(now)126 2076 A
(points)252 2244 A
2538(to)S
2664(a)S
(child)210 2748 A
3000(to)S
3126(be)S
(disinherited.)546 3252 A
3840(*/)S
3870 V
(16978)210 648 A
(rmp->mp_parent)588 1698 A
2328(=)S
(INIT_PROC_NR;)546 2412 A
3960 V
(16979)210 648 A
(parent_waiting)588 1698 A
2328(=)S
(mproc[INIT_PROC_NR].mp_flags)1176 2412 A
3630(&)S
(WAITING;)336 3714 A
4050 V
(16980)210 648 A
1698(if)S
(\(parent_waiting)630 1824 A
2496(&&)S
(\(rmp->mp_flags)588 2622 A
3252(&)S
(HANGING\)\))378 3336 A
(cleanup\(rmp\);)546 3756 A
4140 V
(16981)210 648 A
1362(})S
4230 V
(16982)210 648 A
1110(})S
4320 V
(16983)210 648 A
4410 V
(16984)210 648 A
1110(/*)S
(Send)168 1236 A
1446(a)S
(hangup)252 1530 A
1824(to)S
(the)126 1950 A
(process')336 2118 A
(process)294 2496 A
(group)210 2832 A
3084(if)S
3210(it)S
(was)126 3336 A
3504(a)S
(session)294 3588 A
(leader.)294 3924 A
4260(*/)S
4500 V
(16985)210 648 A
1110(if)S
(\(procgrp)336 1236 A
1614(!=)S
1740(0\))S
(check_sig\(-procgrp,)798 1866 A
(SIGHUP\);)336 2706 A
4590 V
(16986)210 648 A
1026(})S
4860 V
(16989)210 648 A
(/*===========================================================================*)3276 1026 A
4950 V
(16990)210 648 A
1068(*)S
(do_waitpid)420 2370 A
4260(*)S
5040 V
(16991)210 648 A
(*===========================================================================*/)3276 1068 A
5130 V
(16992)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_waitpid\(\))504 1488 A
5220 V
(16993)210 648 A
1026({)S
5310 V
(16994)210 648 A
1026(/*)S
1152(A)S
(process)294 1236 A
(wants)210 1572 A
1824(to)S
(wait)168 1950 A
(for)126 2160 A
2328(a)S
(child)210 2412 A
2664(to)S
(terminate.)420 2790 A
3252(If)S
(one)126 3378 A
3546(is)S
(already)294 3672 A
(waiting,)336 4008 A
5400 V
(16995)210 648 A
1068(*)S
1152(go)S
(clean)210 1278 A
1530(it)S
1656(up)S
(and)126 1782 A
(let)126 1950 A
(this)168 2118 A
(WAIT)168 2328 A
(call)168 2538 A
(terminate.)420 2748 A
(Otherwise,)420 3252 A
(really)252 3714 A
(wait.)210 4008 A
5490 V
(16996)210 648 A
1068(*)S
(Both)168 1152 A
(WAIT)168 1362 A
(and)126 1572 A
(WAITPID)294 1740 A
(are)126 2076 A
(handled)294 2244 A
2580(by)S
(this)168 2706 A
(code.)210 2916 A
5580 V
(16997)210 648 A
1068(*/)S
5670 V
(16998)210 648 A
5760 V
(16999)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rp;)168 2034 A
5850 V
(17000)210 648 A
(int)126 1110 A
(pidarg,)294 1278 A
(options,)336 1614 A
(children,)378 1992 A
(res2;)210 2412 A
5940 V
(17001)210 648 A
6030 V
(17002)210 648 A
1110(/*)S
1236(A)S
(process)294 1320 A
(calling)294 1656 A
(WAIT)168 1992 A
(never)210 2202 A
(gets)168 2454 A
2664(a)S
(reply)210 2748 A
3000(in)S
(the)126 3126 A
(usual)210 3294 A
(way)126 3546 A
(via)126 3714 A
(the)126 3882 A
6120 V
(17003)210 648 A
1152(*)S
(reply\(\))294 1236 A
1572(in)S
(the)126 1698 A
(main)168 1866 A
(loop)168 2076 A
(\(unless)294 2286 A
(WNOHANG)294 2622 A
2958(is)S
(set)126 3084 A
3252(or)S
3378(no)S
(qualifying)420 3504 A
(child)210 3966 A
6210 V
(17004)210 648 A
1152(*)S
(exists\).)336 1236 A
1656(If)S
1782(a)S
(child)210 1866 A
(has)126 2118 A
(already)294 2286 A
(exited,)294 2622 A
(the)126 2958 A
(routine)294 3126 A
(cleanup\(\))378 3462 A
(sends)210 3882 A
8418 V
EP
%%Page: 235 235
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2025(File:)S
2258(src/mm/forkexit.c)S
12 B
(235)180 4248 A
900 V
7 LST
(17005)210 648 A
1152(*)S
(the)126 1236 A
(reply)210 1404 A
1656(to)S
(awaken)252 1782 A
(the)126 2076 A
(caller.)294 2244 A
990 V
(17006)210 648 A
1152(*/)S
1080 V
(17007)210 648 A
1170 V
(17008)210 648 A
1110(/*)S
(Set)126 1236 A
(internal)336 1404 A
(variables,)420 1782 A
(depending)378 2244 A
2664(on)S
(whether)294 2790 A
(this)168 3126 A
3336(is)S
(WAIT)168 3462 A
3672(or)S
(WAITPID.)336 3798 A
4176(*/)S
1260 V
(17009)210 648 A
(pidarg)252 1110 A
1446(=)S
(\(mm_call)336 1530 A
1908(==)S
(WAIT)168 2034 A
2244(?)S
2328(-1)S
2454(:)S
(pid\);)210 2538 A
3042(/*)S
(first)210 3168 A
(param)210 3420 A
3672(of)S
(waitpid)294 3798 A
4134(*/)S
1350 V
(17010)210 648 A
(options)294 1110 A
1446(=)S
(\(mm_call)336 1530 A
1908(==)S
(WAIT)168 2034 A
2244(?)S
2370(0)S
2454(:)S
(sig_nr\);)336 2538 A
3042(/*)S
(third)210 3168 A
(param)210 3420 A
3672(of)S
(waitpid)294 3798 A
4134(*/)S
1440 V
(17011)210 648 A
1110(if)S
(\(pidarg)294 1236 A
1572(==)S
1698(0\))S
(pidarg)252 1824 A
2118(=)S
(-mp->mp_procgrp;)672 2202 A
3042(/*)S
(pidarg)252 3168 A
3462(<)S
3546(0)S
(==>)126 3630 A
(proc)168 3798 A
(grp)126 4008 A
4176(*/)S
1530 V
(17012)210 648 A
1620 V
(17013)210 648 A
1110(/*)S
1236(Is)S
(there)210 1362 A
1614(a)S
(child)210 1698 A
(waiting)294 1950 A
2286(to)S
2412(be)S
(collected?)420 2538 A
3000(At)S
(this)168 3126 A
(point,)252 3336 A
(pidarg)252 3630 A
3924(!=)S
4050(0:)S
1710 V
(17014)210 648 A
1152(*)S
(pidarg)252 1362 A
1698(>)S
1824(0)S
(means)210 1908 A
(pidarg)252 2160 A
2454(is)S
(pid)126 2580 A
2748(of)S
2874(a)S
(specific)336 2958 A
(process)294 3336 A
3672(to)S
(wait)168 3798 A
(for)126 4008 A
1800 V
(17015)210 648 A
1152(*)S
(pidarg)252 1362 A
1656(==)S
1782(-1)S
(means)210 1908 A
(wait)168 2160 A
(for)126 2370 A
(any)126 2538 A
(child)210 2706 A
1890 V
(17016)210 648 A
1152(*)S
(pidarg)252 1362 A
1698(<)S
1782(-1)S
(means)210 1908 A
(wait)168 2160 A
(for)126 2370 A
(any)126 2538 A
(child)210 2706 A
(whose)210 2958 A
(process)294 3210 A
(group)210 3546 A
3798(=)S
(-pidarg)294 3882 A
1980 V
(17017)210 648 A
1152(*/)S
2070 V
(17018)210 648 A
(children)336 1110 A
1488(=)S
1572(0;)S
2160 V
(17019)210 648 A
(for)126 1110 A
(\(rp)126 1278 A
1446(=)S
(&mproc[0];)420 1530 A
1992(rp)S
2118(<)S
(&mproc[NR_PROCS];)714 2202 A
(rp++\))210 2958 A
3210({)S
2250 V
(17020)210 648 A
1362(if)S
1488(\()S
(\(rp->mp_flags)546 1572 A
2160(&)S
(IN_USE\))294 2244 A
2580(&&)S
(rp->mp_parent)546 2706 A
3294(==)S
(who\))168 3420 A
3630({)S
2340 V
(17021)210 648 A
1698(/*)S
(The)126 1824 A
(value)210 1992 A
2244(of)S
(pidarg)252 2370 A
(determines)420 2664 A
(which)210 3126 A
(children)336 3378 A
(qualify.)336 3756 A
4134(*/)S
2430 V
(17022)210 648 A
1698(if)S
(\(pidarg)294 1824 A
2202(>)S
2286(0)S
2370(&&)S
(pidarg)252 2496 A
2790(!=)S
(rp->mp_pid\))462 2916 A
(continue;)378 3420 A
2520 V
(17023)210 648 A
1698(if)S
(\(pidarg)294 1824 A
2160(<)S
2244(-1)S
2370(&&)S
(-pidarg)294 2496 A
2832(!=)S
(rp->mp_procgrp\))630 2958 A
(continue;)378 3630 A
2610 V
(17024)210 648 A
2700 V
(17025)210 648 A
(children++;)462 1698 A
2706(/*)S
(this)168 2832 A
(child)210 3042 A
3294(is)S
(acceptable)420 3420 A
3882(*/)S
2790 V
(17026)210 648 A
1698(if)S
(\(rp->mp_flags)546 1824 A
2412(&)S
(HANGING\))336 2496 A
2874({)S
2880 V
(17027)210 648 A
2034(/*)S
(This)168 2160 A
(child)210 2370 A
(meets)210 2622 A
(the)126 2874 A
(pid)126 3042 A
(test)168 3210 A
(and)126 3420 A
(has)126 3588 A
(exited.)294 3756 A
4092(*/)S
2970 V
(17028)210 648 A
(cleanup\(rp\);)504 2034 A
2706(/*)S
(this)168 2832 A
(child)210 3042 A
(has)126 3294 A
(already)294 3462 A
(exited)252 3798 A
4092(*/)S
3060 V
(17029)210 648 A
(dont_reply)420 2034 A
2496(=)S
(TRUE;)210 2580 A
3150 V
(17030)210 648 A
(return\(OK\);)462 2034 A
3240 V
(17031)210 648 A
1698(})S
3330 V
(17032)210 648 A
1698(if)S
(\(\(rp->mp_flags)588 1824 A
2454(&)S
(STOPPED\))336 2538 A
2916(&&)S
(rp->mp_sigstatus\))714 3042 A
3798({)S
3420 V
(17033)210 648 A
2034(/*)S
(This)168 2160 A
(child)210 2370 A
(meets)210 2622 A
(the)126 2874 A
(pid)126 3042 A
(test)168 3210 A
(and)126 3420 A
3588(is)S
(being)210 3714 A
(traced.*/)378 3966 A
3510 V
(17034)210 648 A
(res2)168 2034 A
2244(=)S
(0177)168 2370 A
2580(|)S
(\(rp->mp_sigstatus)714 2664 A
3420(<<)S
(8\);)126 3546 A
3600 V
(17035)210 648 A
(reply\(who,)420 2034 A
(rp->mp_pid,)462 2496 A
(res2,)210 3000 A
(NIL_PTR\);)378 3252 A
3690 V
(17036)210 648 A
(dont_reply)420 2034 A
2496(=)S
(TRUE;)210 2580 A
3780 V
(17037)210 648 A
(rp->mp_sigstatus)672 2034 A
2748(=)S
2832(0;)S
3870 V
(17038)210 648 A
(return\(OK\);)462 2034 A
3960 V
(17039)210 648 A
1698(})S
4050 V
(17040)210 648 A
1362(})S
4140 V
(17041)210 648 A
1110(})S
4230 V
(17042)210 648 A
4320 V
(17043)210 648 A
1110(/*)S
1236(No)S
(qualifying)420 1362 A
(child)210 1824 A
(has)126 2076 A
(exited.)294 2244 A
(Wait)168 2622 A
(for)126 2832 A
(one,)168 3000 A
(unless)252 3210 A
(none)168 3504 A
(exists.)294 3714 A
4050(*/)S
4410 V
(17044)210 648 A
1110(if)S
(\(children)378 1236 A
1656(>)S
1740(0\))S
1866({)S
4500 V
(17045)210 648 A
1362(/*)S
1488(At)S
(least)210 1614 A
1866(1)S
(child)210 1950 A
(meets)210 2202 A
(the)126 2454 A
(pid)126 2622 A
(test)168 2790 A
(exists,)294 3000 A
(but)126 3336 A
(has)126 3504 A
(not)126 3672 A
(exited.)294 3840 A
4176(*/)S
4590 V
(17046)210 648 A
1362(if)S
(\(options)336 1488 A
1866(&)S
(WNOHANG\))336 1950 A
(return\(0\);)420 2328 A
2916(/*)S
(parent)252 3042 A
(does)168 3336 A
(not)126 3546 A
(want)168 3714 A
3924(to)S
(wait)168 4050 A
4260(*/)S
4680 V
(17047)210 648 A
(mp->mp_flags)504 1362 A
1908(|=)S
(WAITING;)336 2034 A
2916(/*)S
(parent)252 3042 A
(wants)210 3336 A
3588(to)S
(wait)168 3714 A
3924(*/)S
4770 V
(17048)210 648 A
(mp->mp_wpid)462 1362 A
1866(=)S
(\(pid_t\))294 1950 A
(pidarg;)294 2286 A
2916(/*)S
(save)168 3042 A
(pid)126 3252 A
(for)126 3420 A
(later)210 3588 A
3840(*/)S
4860 V
(17049)210 648 A
(dont_reply)420 1362 A
1824(=)S
(TRUE;)210 1908 A
2916(/*)S
3042(do)S
(not)126 3168 A
(reply)210 3336 A
(now)126 3588 A
(though)252 3756 A
4050(*/)S
4950 V
(17050)210 648 A
(return\(OK\);)462 1362 A
2916(/*)S
(yes)126 3042 A
3210(-)S
(wait)168 3294 A
(for)126 3504 A
(one)126 3672 A
3840(to)S
(exit)168 3966 A
4176(*/)S
5040 V
(17051)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5130 V
(17052)210 648 A
1362(/*)S
1488(No)S
(child)210 1614 A
(even)168 1866 A
(meets)210 2076 A
(the)126 2328 A
(pid)126 2496 A
(test.)210 2664 A
(Return)252 2958 A
(error)210 3252 A
(immediately.)504 3504 A
4050(*/)S
5220 V
(17053)210 648 A
(return\(ECHILD\);)630 1362 A
2916(/*)S
3042(no)S
3168(-)S
(parent)252 3252 A
(has)126 3546 A
3714(no)S
(children)336 3840 A
4218(*/)S
5310 V
(17054)210 648 A
1110(})S
5400 V
(17055)210 648 A
1026(})S
5670 V
(17058)210 648 A
(/*===========================================================================*)3276 1026 A
5760 V
(17059)210 648 A
1068(*)S
(cleanup)294 2370 A
4260(*)S
5850 V
(17060)210 648 A
(*===========================================================================*/)3276 1068 A
5940 V
(17061)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(cleanup\(child\))588 1572 A
6030 V
(17062)210 648 A
(register)336 1026 A
(struct)252 1404 A
(mproc)210 1698 A
(*child;)294 1950 A
2370(/*)S
(tells)210 2496 A
(which)210 2748 A
(process)294 3000 A
3336(is)S
(exiting)294 3462 A
3798(*/)S
6120 V
(17063)210 648 A
1026({)S
6210 V
(17064)210 648 A
1026(/*)S
(Finish)252 1152 A
(off)126 1446 A
(the)126 1614 A
(exit)168 1782 A
1992(of)S
2118(a)S
(process.)336 2202 A
(The)126 2622 A
(process)294 2790 A
(has)126 3126 A
(exited)252 3294 A
3588(or)S
(been)168 3714 A
(killed)252 3924 A
8418 V
EP
%%Page: 236 236
BP
/slant 0 def
/height 0 def
630 V
12 B
(236)180 648 A
11 R
2025(File:)S
2258(src/mm/forkexit.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(17065)210 648 A
1068(*)S
1152(by)S
1278(a)S
(signal,)294 1362 A
(and)126 1698 A
(its)126 1866 A
(parent)252 2034 A
2328(is)S
(waiting.)336 2454 A
990 V
(17066)210 648 A
1068(*/)S
1080 V
(17067)210 648 A
1170 V
(17068)210 648 A
(int)126 1110 A
(exitstatus;)462 1278 A
1260 V
(17069)210 648 A
1350 V
(17070)210 648 A
1110(/*)S
(Wake)168 1236 A
1446(up)S
(the)126 1572 A
(parent.)294 1740 A
2076(*/)S
1440 V
(17071)210 648 A
(exitstatus)420 1110 A
1572(=)S
(\(child->mp_exitstatus)882 1656 A
2580(<<)S
2706(8\))S
2832(|)S
(\(child->mp_sigstatus)840 2916 A
3798(&)S
(0377\);)252 3882 A
1530 V
(17072)210 648 A
(reply\(child->mp_parent,)966 1110 A
(child->mp_pid,)588 2118 A
(exitstatus,)462 2748 A
(NIL_PTR\);)378 3252 A
1620 V
(17073)210 648 A
(mproc[child->mp_parent].mp_flags)1344 1110 A
2496(&=)S
(\304WAITING;)378 2622 A
3042(/*)S
(parent)252 3168 A
3462(no)S
(longer)252 3588 A
(waiting)294 3882 A
4218(*/)S
1710 V
(17074)210 648 A
1800 V
(17075)210 648 A
1110(/*)S
(Release)294 1236 A
(the)126 1572 A
(process)294 1740 A
(table)210 2076 A
(entry.)252 2328 A
2622(*/)S
1890 V
(17076)210 648 A
(child->mp_flags)630 1110 A
1782(=)S
1866(0;)S
1980 V
(17077)210 648 A
(procs_in_use--;)630 1110 A
2070 V
(17078)210 648 A
1026(})S
2340 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2430 V
(src/mm/exec.c)546 2034 A
2520 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2700 V
(17100)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(handles)294 1572 A
(the)126 1908 A
(EXEC)168 2076 A
(system)252 2286 A
(call.)210 2580 A
2874(It)S
(performs)336 3000 A
(the)126 3378 A
(work)168 3546 A
3756(as)S
(follows:)336 3882 A
2790 V
(17101)210 648 A
1068(*)S
1278(-)S
(see)126 1362 A
1530(if)S
(the)126 1656 A
(permissions)462 1824 A
(allow)210 2328 A
(the)126 2580 A
(file)168 2748 A
2958(to)S
3084(be)S
(executed)336 3210 A
2880 V
(17102)210 648 A
1068(*)S
1278(-)S
(read)168 1362 A
(the)126 1572 A
(header)252 1740 A
(and)126 2034 A
(extract)294 2202 A
(the)126 2538 A
(sizes)210 2706 A
2970 V
(17103)210 648 A
1068(*)S
1278(-)S
(fetch)210 1362 A
(the)126 1614 A
(initial)294 1782 A
(args)168 2118 A
(and)126 2328 A
(environment)462 2496 A
(from)168 3000 A
(the)126 3210 A
(user)168 3378 A
(space)210 3588 A
3060 V
(17104)210 648 A
1068(*)S
1278(-)S
(allocate)336 1362 A
(the)126 1740 A
(memory)252 1908 A
(for)126 2202 A
(the)126 2370 A
(new)126 2538 A
(process)294 2706 A
3150 V
(17105)210 648 A
1068(*)S
1278(-)S
(copy)168 1362 A
(the)126 1572 A
(initial)294 1740 A
(stack)210 2076 A
(from)168 2328 A
2538(MM)S
2664(to)S
(the)126 2790 A
(process)294 2958 A
3240 V
(17106)210 648 A
1068(*)S
1278(-)S
(read)168 1362 A
1572(in)S
(the)126 1698 A
(text)168 1866 A
(and)126 2076 A
(data)168 2244 A
(segments)336 2454 A
(and)126 2832 A
(copy)168 3000 A
3210(to)S
(the)126 3336 A
(process)294 3504 A
3330 V
(17107)210 648 A
1068(*)S
1278(-)S
(take)168 1362 A
(care)168 1572 A
1782(of)S
(setuid)252 1908 A
(and)126 2202 A
(setgid)252 2370 A
(bits)168 2664 A
3420 V
(17108)210 648 A
1068(*)S
1278(-)S
(fix)126 1362 A
1530(up)S
('mproc')294 1656 A
(table)210 1992 A
3510 V
(17109)210 648 A
1068(*)S
1278(-)S
(tell)168 1362 A
(kernel)252 1572 A
(about)210 1866 A
(EXEC)168 2118 A
3600 V
(17110)210 648 A
1068(*)S
1278(-)S
(save)168 1362 A
(offset)252 1572 A
1866(to)S
(initial)294 1992 A
(argc)168 2328 A
(\(for)168 2538 A
(ps\))126 2748 A
3690 V
(17111)210 648 A
1068(*)S
3780 V
(17112)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are:)168 2496 A
3870 V
(17113)210 648 A
1068(*)S
(do_exec:)336 1236 A
(perform)294 1740 A
(the)126 2076 A
(EXEC)168 2244 A
(system)252 2454 A
(call)168 2748 A
3960 V
(17114)210 648 A
1068(*)S
(find_share:)462 1236 A
(find)168 1740 A
1950(a)S
(process)294 2034 A
(whose)210 2370 A
(text)168 2622 A
(segment)294 2832 A
(can)126 3168 A
3336(be)S
(shared)252 3462 A
4050 V
(17115)210 648 A
1068(*/)S
4140 V
(17116)210 648 A
4230 V
(17117)210 648 A
(#include)336 1026 A
("mm.h")252 1404 A
4320 V
(17118)210 648 A
(#include)336 1026 A
(<sys/stat.h>)504 1404 A
4410 V
(17119)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
4500 V
(17120)210 648 A
(#include)336 1026 A
(<a.out.h>)378 1404 A
4590 V
(17121)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
4680 V
(17122)210 648 A
(#include)336 1026 A
(<string.h>)420 1404 A
4770 V
(17123)210 648 A
(#include)336 1026 A
("mproc.h")378 1404 A
4860 V
(17124)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
4950 V
(17125)210 648 A
5040 V
(17126)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(load_seg,)378 2076 A
(\(int)168 2496 A
(fd,)126 2706 A
(int)126 2874 A
(seg,)168 3042 A
(vir_bytes)378 3252 A
(seg_bytes\))420 3672 A
4134(\);)S
5130 V
(17127)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(new_mem,)336 2034 A
(\(struct)294 2412 A
(mproc)210 2748 A
(*sh_mp,)294 3000 A
(vir_bytes)378 3336 A
(text_bytes,)462 3756 A
5220 V
(17128)210 648 A
(vir_bytes)378 1698 A
(data_bytes,)462 2118 A
(vir_bytes)378 2622 A
(bss_bytes,)420 3042 A
5310 V
(17129)210 648 A
(vir_bytes)378 1698 A
(stk_bytes,)420 2118 A
(phys_bytes)420 2580 A
(tot_bytes\))420 3042 A
4050(\);)S
5400 V
(17130)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(patch_ptr,)420 2076 A
(\(char)210 2538 A
(stack)210 2790 A
([ARG_MAX)336 3042 A
3420(],)S
(vir_bytes)378 3546 A
(base\))210 3966 A
4218(\);)S
5490 V
(17131)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(read_header,)504 2034 A
(\(int)168 2580 A
(fd,)126 2790 A
(int)126 2958 A
(*ft,)168 3126 A
(vir_bytes)378 3336 A
(*text_bytes,)504 3756 A
5580 V
(17132)210 648 A
(vir_bytes)378 1698 A
(*data_bytes,)504 2118 A
(vir_bytes)378 2664 A
(*bss_bytes,)462 3084 A
5670 V
(17133)210 648 A
(phys_bytes)420 1698 A
(*tot_bytes,)462 2160 A
(long)168 2664 A
(*sym_bytes,)462 2874 A
(vir_clicks)420 3378 A
(sc,)126 3840 A
5760 V
(17134)210 648 A
(vir_bytes)378 1698 A
(*pc\))168 2118 A
4050(\);)S
5850 V
(17135)210 648 A
5940 V
(17136)210 648 A
6030 V
(17137)210 648 A
(/*===========================================================================*)3276 1026 A
6120 V
(17138)210 648 A
1068(*)S
(do_exec)294 2370 A
4260(*)S
6210 V
(17139)210 648 A
(*===========================================================================*/)3276 1068 A
8418 V
EP
%%Page: 237 237
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2098(File:)S
2331(src/mm/exec.c)S
12 B
(237)180 4248 A
900 V
7 LST
(17140)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_exec\(\))378 1488 A
990 V
(17141)210 648 A
1026({)S
1080 V
(17142)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(execve\(name,)504 1656 A
(argv,)210 2202 A
(envp\))210 2454 A
(call.)210 2706 A
(The)126 3000 A
(user)168 3168 A
(library)294 3378 A
(builds)252 3714 A
4008(a)S
1170 V
(17143)210 648 A
1068(*)S
(complete)336 1152 A
(stack)210 1530 A
(image,)252 1782 A
(including)378 2076 A
(pointers,)378 2496 A
(args,)210 2916 A
(environ,)336 3168 A
(etc.)168 3546 A
(The)126 3798 A
(stack)210 3966 A
1260 V
(17144)210 648 A
1068(*)S
1152(is)S
(copied)252 1278 A
1572(to)S
1698(a)S
(buffer)252 1782 A
(inside)252 2076 A
(MM,)126 2370 A
(and)126 2538 A
(then)168 2706 A
2916(to)S
(the)126 3042 A
(new)126 3210 A
(core)168 3378 A
(image.)252 3588 A
1350 V
(17145)210 648 A
1068(*/)S
1440 V
(17146)210 648 A
1530 V
(17147)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rmp;)210 2034 A
1620 V
(17148)210 648 A
(struct)252 1110 A
(mproc)210 1404 A
(*sh_mp;)294 1656 A
1710 V
(17149)210 648 A
(int)126 1110 A
1278(m,)S
1404(r,)S
(fd,)126 1530 A
(ft,)126 1698 A
(sn;)126 1866 A
1800 V
(17150)210 648 A
(static)252 1110 A
(char)168 1404 A
(mbuf[ARG_MAX];)588 1614 A
2370(/*)S
(buffer)252 2496 A
(for)126 2790 A
(stack)210 2958 A
(and)126 3210 A
(zeroes)252 3378 A
3672(*/)S
1890 V
(17151)210 648 A
(static)252 1110 A
(char)168 1404 A
(name_buf[PATH_MAX];)798 1614 A
2454(/*)S
(the)126 2580 A
(name)168 2748 A
2958(of)S
(the)126 3084 A
(file)168 3252 A
3462(to)S
(exec)168 3588 A
3798(*/)S
1980 V
(17152)210 648 A
(char)168 1110 A
(*new_sp,)336 1320 A
(*basename;)420 1698 A
2070 V
(17153)210 648 A
(vir_bytes)378 1110 A
(src,)168 1530 A
(dst,)168 1740 A
(text_bytes,)462 1950 A
(data_bytes,)462 2454 A
(bss_bytes,)420 2958 A
(stk_bytes,)420 3420 A
(vsp;)168 3882 A
2160 V
(17154)210 648 A
(phys_bytes)420 1110 A
(tot_bytes;)420 1572 A
2370(/*)S
(total)210 2496 A
(space)210 2748 A
(for)126 3000 A
(program,)336 3168 A
(including)378 3546 A
(gap)126 3966 A
4134(*/)S
2250 V
(17155)210 648 A
(long)168 1110 A
(sym_bytes;)420 1320 A
2340 V
(17156)210 648 A
(vir_clicks)420 1110 A
(sc;)126 1572 A
2430 V
(17157)210 648 A
(struct)252 1110 A
(stat)168 1404 A
(s_buf;)252 1614 A
2520 V
(17158)210 648 A
(vir_bytes)378 1110 A
(pc;)126 1530 A
2610 V
(17159)210 648 A
2700 V
(17160)210 648 A
1110(/*)S
1236(Do)S
(some)168 1362 A
(validity)336 1572 A
(checks.)294 1950 A
2286(*/)S
2790 V
(17161)210 648 A
(rmp)126 1110 A
1278(=)S
(mp;)126 1362 A
2880 V
(17162)210 648 A
(stk_bytes)378 1110 A
1530(=)S
(\(vir_bytes\))462 1614 A
(stack_bytes;)504 2118 A
2970 V
(17163)210 648 A
1110(if)S
(\(stk_bytes)420 1236 A
1698(>)S
(ARG_MAX\))336 1782 A
(return\(ENOMEM\);)630 2160 A
3042(/*)S
(stack)210 3168 A
(too)126 3420 A
(big)126 3588 A
3756(*/)S
3060 V
(17164)210 648 A
1110(if)S
(\(exec_len)378 1236 A
1656(<=)S
1782(0)S
1866(||)S
(exec_len)336 1992 A
2370(>)S
(PATH_MAX\))378 2454 A
(return\(EINVAL\);)630 2874 A
3150 V
(17165)210 648 A
3240 V
(17166)210 648 A
1110(/*)S
(Get)126 1236 A
(the)126 1404 A
(exec)168 1572 A
(file)168 1782 A
(name)168 1992 A
(and)126 2202 A
(see)126 2370 A
2538(if)S
(the)126 2664 A
(file)168 2832 A
3042(is)S
(executable.)462 3168 A
3672(*/)S
3330 V
(17167)210 648 A
(src)126 1110 A
1278(=)S
(\(vir_bytes\))462 1362 A
(exec_name;)420 1866 A
3420 V
(17168)210 648 A
(dst)126 1110 A
1278(=)S
(\(vir_bytes\))462 1362 A
(name_buf;)378 1866 A
3510 V
(17169)210 648 A
1110(r)S
1194(=)S
(sys_copy\(who,)546 1278 A
1866(D,)S
(\(phys_bytes\))504 1992 A
(src,)168 2538 A
3600 V
(17170)210 648 A
(MM_PROC_NR,)462 1698 A
2202(D,)S
(\(phys_bytes\))504 2328 A
(dst,)168 2874 A
(\(phys_bytes\))504 3084 A
(exec_len\);)420 3630 A
3690 V
(17171)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
(return\(r\);)420 1656 A
2370(/*)S
(file)168 2496 A
(name)168 2706 A
(not)126 2916 A
3084(in)S
(user)168 3210 A
(data)168 3420 A
(segment)294 3630 A
3966(*/)S
3780 V
(17172)210 648 A
(tell_fs\(CHDIR,)588 1110 A
(who,)168 1740 A
(FALSE,)252 1950 A
(0\);)126 2244 A
2706(/*)S
(switch)252 2832 A
3126(to)S
(the)126 3252 A
(user's)252 3420 A
3714(FS)S
(environ.)336 3840 A
4218(*/)S
3870 V
(17173)210 648 A
1110(fd)S
1236(=)S
(allowed\(name_buf,)714 1320 A
(&s_buf,)294 2076 A
(X_BIT\);)294 2412 A
3042(/*)S
3168(is)S
(file)168 3294 A
(executable?)462 3504 A
4008(*/)S
3960 V
(17174)210 648 A
1110(if)S
(\(fd)126 1236 A
1404(<)S
1488(0\))S
(return\(fd\);)462 1614 A
2370(/*)S
(file)168 2496 A
(was)126 2706 A
(not)126 2874 A
(executable)420 3042 A
3504(*/)S
4050 V
(17175)210 648 A
4140 V
(17176)210 648 A
1110(/*)S
(Read)168 1236 A
(the)126 1446 A
(file)168 1614 A
(header)252 1824 A
(and)126 2118 A
(extract)294 2286 A
(the)126 2622 A
(segment)294 2790 A
(sizes.)252 3126 A
3420(*/)S
4230 V
(17177)210 648 A
1110(sc)S
1236(=)S
(\(stk_bytes)420 1320 A
1782(+)S
(CLICK_SIZE)420 1866 A
2328(-)S
2412(1\))S
2538(>>)S
(CLICK_SHIFT;)504 2664 A
4320 V
(17178)210 648 A
1110(m)S
1194(=)S
(read_header\(fd,)630 1278 A
(&ft,)168 1950 A
(&text_bytes,)504 2160 A
(&data_bytes,)504 2706 A
(&bss_bytes,)462 3252 A
4410 V
(17179)210 648 A
(&tot_bytes,)462 2706 A
(&sym_bytes,)462 3210 A
(sc,)126 3714 A
(&pc\);)210 3882 A
4500 V
(17180)210 648 A
1110(if)S
1236(\(m)S
1362(<)S
1446(0\))S
1572({)S
4590 V
(17181)210 648 A
(close\(fd\);)420 1362 A
2370(/*)S
(something)378 2496 A
(wrong)210 2916 A
(with)168 3168 A
(header)252 3378 A
3672(*/)S
4680 V
(17182)210 648 A
(return\(ENOEXEC\);)672 1362 A
4770 V
(17183)210 648 A
1110(})S
4860 V
(17184)210 648 A
4950 V
(17185)210 648 A
1110(/*)S
(Fetch)210 1236 A
(the)126 1488 A
(stack)210 1656 A
(from)168 1908 A
(the)126 2118 A
(user)168 2286 A
(before)252 2496 A
(destroying)420 2790 A
(the)126 3252 A
(old)126 3420 A
(core)168 3588 A
(image.)252 3798 A
4092(*/)S
5040 V
(17186)210 648 A
(src)126 1110 A
1278(=)S
(\(vir_bytes\))462 1362 A
(stack_ptr;)420 1866 A
5130 V
(17187)210 648 A
(dst)126 1110 A
1278(=)S
(\(vir_bytes\))462 1362 A
(mbuf;)210 1866 A
5220 V
(17188)210 648 A
1110(r)S
1194(=)S
(sys_copy\(who,)546 1278 A
1866(D,)S
(\(phys_bytes\))504 1992 A
(src,)168 2538 A
5310 V
(17189)210 648 A
(MM_PROC_NR,)462 2034 A
2538(D,)S
(\(phys_bytes\))504 2664 A
(dst,)168 3210 A
(\(phys_bytes\)stk_bytes\);)966 3420 A
5400 V
(17190)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
1656({)S
5490 V
(17191)210 648 A
(close\(fd\);)420 1362 A
2370(/*)S
(can't)210 2496 A
(fetch)210 2748 A
(stack)210 3000 A
(\(e.g.)210 3252 A
(bad)126 3504 A
(virtual)294 3672 A
(addr\))210 4008 A
4260(*/)S
5580 V
(17192)210 648 A
(return\(EACCES\);)630 1362 A
5670 V
(17193)210 648 A
1110(})S
5760 V
(17194)210 648 A
5850 V
(17195)210 648 A
1110(/*)S
(Can)126 1236 A
(the)126 1404 A
(process')336 1572 A
(text)168 1950 A
2160(be)S
(shared)252 2286 A
(with)168 2580 A
(that)168 2790 A
3000(of)S
(one)126 3126 A
(already)294 3294 A
(running?)336 3630 A
4008(*/)S
5940 V
(17196)210 648 A
(sh_mp)210 1110 A
1362(=)S
(find_share\(rmp,)630 1446 A
(s_buf.st_ino,)546 2118 A
(s_buf.st_dev,)546 2706 A
(s_buf.st_ctime\);)672 3294 A
6030 V
(17197)210 648 A
6120 V
(17198)210 648 A
1110(/*)S
(Allocate)336 1236 A
(new)126 1614 A
(memory)252 1782 A
(and)126 2076 A
(release)294 2244 A
(old)126 2580 A
(memory.)294 2748 A
(Fix)126 3126 A
(map)126 3294 A
(and)126 3462 A
(tell)168 3630 A
(kernel.)294 3840 A
4176(*/)S
6210 V
(17199)210 648 A
1110(r)S
1194(=)S
(new_mem\(sh_mp,)588 1278 A
(text_bytes,)462 1908 A
(data_bytes,)462 2412 A
(bss_bytes,)420 2916 A
(stk_bytes,)420 3378 A
(tot_bytes\);)462 3840 A
8418 V
EP
%%Page: 238 238
BP
/slant 0 def
/height 0 def
630 V
12 B
(238)180 648 A
11 R
2098(File:)S
2331(src/mm/exec.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(17200)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
1656({)S
990 V
(17201)210 648 A
(close\(fd\);)420 1362 A
2370(/*)S
(insufficient)504 2496 A
(core)168 3042 A
3252(or)S
(program)294 3378 A
(too)126 3714 A
(big)126 3882 A
4050(*/)S
1080 V
(17202)210 648 A
(return\(r\);)420 1362 A
1170 V
(17203)210 648 A
1110(})S
1260 V
(17204)210 648 A
1350 V
(17205)210 648 A
1110(/*)S
(Save)168 1236 A
(file)168 1446 A
(identification)588 1656 A
2286(to)S
(allow)210 2412 A
2664(it)S
2790(to)S
2916(be)S
(shared.)294 3042 A
3378(*/)S
1440 V
(17206)210 648 A
(rmp->mp_ino)462 1110 A
1614(=)S
(s_buf.st_ino;)546 1698 A
1530 V
(17207)210 648 A
(rmp->mp_dev)462 1110 A
1614(=)S
(s_buf.st_dev;)546 1698 A
1620 V
(17208)210 648 A
(rmp->mp_ctime)546 1110 A
1698(=)S
(s_buf.st_ctime;)630 1782 A
1710 V
(17209)210 648 A
1800 V
(17210)210 648 A
1110(/*)S
(Patch)210 1236 A
1488(up)S
(stack)210 1614 A
(and)126 1866 A
(copy)168 2034 A
2244(it)S
(from)168 2370 A
2580(MM)S
2706(to)S
(new)126 2832 A
(core)168 3000 A
(image.)252 3210 A
3504(*/)S
1890 V
(17211)210 648 A
(vsp)126 1110 A
1278(=)S
(\(vir_bytes\))462 1362 A
(rmp->mp_seg[S].mem_vir)924 1866 A
2832(<<)S
(CLICK_SHIFT;)504 2958 A
1980 V
(17212)210 648 A
(vsp)126 1110 A
1278(+=)S
(\(vir_bytes\))462 1404 A
(rmp->mp_seg[S].mem_len)924 1908 A
2874(<<)S
(CLICK_SHIFT;)504 3000 A
2070 V
(17213)210 648 A
(vsp)126 1110 A
1278(-=)S
(stk_bytes;)420 1404 A
2160 V
(17214)210 648 A
(patch_ptr\(mbuf,)630 1110 A
(vsp\);)210 1782 A
2250 V
(17215)210 648 A
(src)126 1110 A
1278(=)S
(\(vir_bytes\))462 1362 A
(mbuf;)210 1866 A
2340 V
(17216)210 648 A
1110(r)S
1194(=)S
(sys_copy\(MM_PROC_NR,)840 1278 A
2160(D,)S
(\(phys_bytes\))504 2286 A
(src,)168 2832 A
2430 V
(17217)210 648 A
(who,)168 2034 A
2244(D,)S
(\(phys_bytes\))504 2370 A
(vsp,)168 2916 A
(\(phys_bytes\)stk_bytes\);)966 3126 A
2520 V
(17218)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
(panic\("do_exec)588 1656 A
(stack)210 2286 A
(copy)168 2538 A
(err",)210 2748 A
(NO_NUM\);)336 3000 A
2610 V
(17219)210 648 A
2700 V
(17220)210 648 A
1110(/*)S
(Read)168 1236 A
1446(in)S
(text)168 1572 A
(and)126 1782 A
(data)168 1950 A
(segments.)378 2160 A
2580(*/)S
2790 V
(17221)210 648 A
1110(if)S
(\(sh_mp)252 1236 A
1530(!=)S
(NULL\))210 1656 A
1908({)S
2880 V
(17222)210 648 A
(lseek\(fd,)378 1362 A
(\(off_t\))294 1782 A
(text_bytes,)462 2118 A
(SEEK_CUR\);)420 2622 A
3126(/*)S
(shared:)294 3252 A
(skip)168 3588 A
(text)168 3798 A
4008(*/)S
2970 V
(17223)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3060 V
(17224)210 648 A
(load_seg\(fd,)504 1362 A
1908(T,)S
(text_bytes\);)504 2034 A
3150 V
(17225)210 648 A
1110(})S
3240 V
(17226)210 648 A
(load_seg\(fd,)504 1110 A
1656(D,)S
(data_bytes\);)504 1782 A
3330 V
(17227)210 648 A
3420 V
(17228)210 648 A
3510 V
(17229)210 648 A
(close\(fd\);)420 1110 A
2370(/*)S
(don't)210 2496 A
(need)168 2748 A
(exec)168 2958 A
(file)168 3168 A
(any)126 3378 A
(more)168 3546 A
3756(*/)S
3600 V
(17230)210 648 A
3690 V
(17231)210 648 A
1110(/*)S
(Take)168 1236 A
(care)168 1446 A
1656(of)S
(setuid/setgid)546 1782 A
(bits.)210 2370 A
2622(*/)S
3780 V
(17232)210 648 A
1110(if)S
(\(\(rmp->mp_flags)630 1236 A
1908(&)S
(TRACED\))294 1992 A
2328(==)S
2454(0\))S
2580({)S
2664(/*)S
(suppress)336 2790 A
3168(if)S
(tracing)294 3294 A
3630(*/)S
3870 V
(17233)210 648 A
1362(if)S
(\(s_buf.st_mode)588 1488 A
2118(&)S
(I_SET_UID_BIT\))588 2202 A
2832({)S
3960 V
(17234)210 648 A
(rmp->mp_effuid)588 1698 A
2328(=)S
(s_buf.st_uid;)546 2412 A
4050 V
(17235)210 648 A
(tell_fs\(SETUID,who,)798 1698 A
(\(int\)rmp->mp_realuid,)882 2538 A
(\(int\)rmp->mp_effuid\);)882 3462 A
4140 V
(17236)210 648 A
1362(})S
4230 V
(17237)210 648 A
1362(if)S
(\(s_buf.st_mode)588 1488 A
2118(&)S
(I_SET_GID_BIT\))588 2202 A
2832({)S
4320 V
(17238)210 648 A
(rmp->mp_effgid)588 1698 A
2328(=)S
(s_buf.st_gid;)546 2412 A
4410 V
(17239)210 648 A
(tell_fs\(SETGID,who,)798 1698 A
(\(int\)rmp->mp_realgid,)882 2538 A
(\(int\)rmp->mp_effgid\);)882 3462 A
4500 V
(17240)210 648 A
1362(})S
4590 V
(17241)210 648 A
1110(})S
4680 V
(17242)210 648 A
4770 V
(17243)210 648 A
1110(/*)S
(Save)168 1236 A
(offset)252 1446 A
1740(to)S
(initial)294 1866 A
(argc)168 2202 A
(\(for)168 2412 A
(ps\))126 2622 A
2790(*/)S
4860 V
(17244)210 648 A
(rmp->mp_procargs)672 1110 A
1824(=)S
(vsp;)168 1908 A
4950 V
(17245)210 648 A
5040 V
(17246)210 648 A
1110(/*)S
(Fix)126 1236 A
('mproc')294 1404 A
(fields,)294 1740 A
(tell)168 2076 A
(kernel)252 2286 A
(that)168 2580 A
(exec)168 2790 A
3000(is)S
(done,)210 3126 A
(reset)210 3420 A
(caught)252 3672 A
(sigs.)210 3966 A
4218(*/)S
5130 V
(17247)210 648 A
(for)126 1110 A
(\(sn)126 1278 A
1446(=)S
1530(1;)S
1656(sn)S
1782(<=)S
(_NSIG;)252 1908 A
(sn++\))210 2202 A
2454({)S
5220 V
(17248)210 648 A
1362(if)S
(\(sigismember\(&rmp->mp_catch,)1176 1488 A
(sn\)\))168 2706 A
2916({)S
5310 V
(17249)210 648 A
(sigdelset\(&rmp->mp_catch,)1050 1698 A
(sn\);)168 2790 A
5400 V
(17250)210 648 A
(rmp->mp_sigact[sn].sa_handler)1218 1698 A
2958(=)S
(SIG_DFL;)336 3042 A
5490 V
(17251)210 648 A
(sigemptyset\(&rmp->mp_sigact[sn].sa_mask\);)1722 1698 A
5580 V
(17252)210 648 A
1362(})S
5670 V
(17253)210 648 A
1110(})S
5760 V
(17254)210 648 A
5850 V
(17255)210 648 A
(rmp->mp_flags)546 1110 A
1698(&=)S
(\304SEPARATE;)420 1824 A
2370(/*)S
(turn)168 2496 A
(off)126 2706 A
(SEPARATE)336 2874 A
(bit)126 3252 A
3420(*/)S
5940 V
(17256)210 648 A
(rmp->mp_flags)546 1110 A
1698(|=)S
(ft;)126 1824 A
2370(/*)S
(turn)168 2496 A
2706(it)S
2832(on)S
(for)126 2958 A
(separate)336 3126 A
3504(I)S
3588(&)S
3672(D)S
(files)210 3756 A
4008(*/)S
6030 V
(17257)210 648 A
(new_sp)252 1110 A
1404(=)S
(\(char)210 1488 A
1740(*\))S
(vsp;)168 1866 A
6120 V
(17258)210 648 A
6210 V
(17259)210 648 A
(tell_fs\(EXEC,)546 1110 A
(who,)168 1698 A
1908(0,)S
(0\);)126 2034 A
2370(/*)S
(allow)210 2496 A
2748(FS)S
2874(to)S
(handle)252 3000 A
(FD_CLOEXEC)420 3294 A
(files)210 3756 A
4008(*/)S
8418 V
EP
%%Page: 239 239
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2098(File:)S
2331(src/mm/exec.c)S
12 B
(239)180 4248 A
900 V
7 LST
(17260)210 648 A
990 V
(17261)210 648 A
1110(/*)S
(System)252 1236 A
(will)168 1530 A
(save)168 1740 A
(command)294 1950 A
(line)168 2286 A
(for)126 2496 A
(debugging,)420 2664 A
(ps\(1\))210 3126 A
(output,)294 3378 A
(etc.)168 3714 A
3924(*/)S
1080 V
(17262)210 648 A
(basename)336 1110 A
1488(=)S
(strrchr\(name_buf,)714 1572 A
('/'\);)210 2328 A
1170 V
(17263)210 648 A
1110(if)S
(\(basename)378 1236 A
1656(==)S
(NULL\))210 1782 A
(basename)336 2034 A
2412(=)S
(name_buf;)378 2496 A
(else)168 2916 A
(basename++;)462 3126 A
1260 V
(17264)210 648 A
(sys_exec\(who,)546 1110 A
(new_sp,)294 1698 A
(rmp->mp_flags)546 2034 A
2622(&)S
(TRACED,)294 2706 A
(basename,)378 3042 A
(pc\);)168 3462 A
1350 V
(17265)210 648 A
(return\(OK\);)462 1110 A
1440 V
(17266)210 648 A
1026(})S
1710 V
(17269)210 648 A
(/*===========================================================================*)3276 1026 A
1800 V
(17270)210 648 A
1068(*)S
(read_header)462 2370 A
4260(*)S
1890 V
(17271)210 648 A
(*===========================================================================*/)3276 1068 A
1980 V
(17272)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(read_header\(fd,)630 1530 A
(ft,)126 2202 A
(text_bytes,)462 2370 A
(data_bytes,)462 2874 A
(bss_bytes,)420 3378 A
2070 V
(17273)210 648 A
(tot_bytes,)420 3042 A
(sym_bytes,)420 3504 A
(sc,)126 3966 A
(pc\))126 4134 A
2160 V
(17274)210 648 A
(int)126 1026 A
(fd;)126 1194 A
2370(/*)S
(file)168 2496 A
(descriptor)420 2706 A
(for)126 3168 A
(reading)294 3336 A
(exec)168 3672 A
(file)168 3882 A
4092(*/)S
2250 V
(17275)210 648 A
(int)126 1026 A
(*ft;)168 1194 A
2370(/*)S
(place)210 2496 A
2748(to)S
(return)252 2874 A
3168(ft)S
(number)252 3294 A
3588(*/)S
2340 V
(17276)210 648 A
(vir_bytes)378 1026 A
(*text_bytes;)504 1446 A
2370(/*)S
(place)210 2496 A
2748(to)S
(return)252 2874 A
(text)168 3168 A
(size)168 3378 A
3588(*/)S
2430 V
(17277)210 648 A
(vir_bytes)378 1026 A
(*data_bytes;)504 1446 A
2370(/*)S
(place)210 2496 A
2748(to)S
(return)252 2874 A
(initialized)462 3168 A
(data)168 3672 A
(size)168 3882 A
4092(*/)S
2520 V
(17278)210 648 A
(vir_bytes)378 1026 A
(*bss_bytes;)462 1446 A
2370(/*)S
(place)210 2496 A
2748(to)S
(return)252 2874 A
(bss)126 3168 A
(size)168 3336 A
3546(*/)S
2610 V
(17279)210 648 A
(phys_bytes)420 1026 A
(*tot_bytes;)462 1488 A
2370(/*)S
(place)210 2496 A
2748(to)S
(return)252 2874 A
(total)210 3168 A
(size)168 3420 A
3630(*/)S
2700 V
(17280)210 648 A
(long)168 1026 A
(*sym_bytes;)462 1236 A
2370(/*)S
(place)210 2496 A
2748(to)S
(return)252 2874 A
(symbol)252 3168 A
(table)210 3462 A
(size)168 3714 A
3924(*/)S
2790 V
(17281)210 648 A
(vir_clicks)420 1026 A
(sc;)126 1488 A
2370(/*)S
(stack)210 2496 A
(size)168 2748 A
2958(in)S
(clicks)252 3084 A
3378(*/)S
2880 V
(17282)210 648 A
(vir_bytes)378 1026 A
(*pc;)168 1446 A
2370(/*)S
(program)294 2496 A
(entry)210 2832 A
(point)210 3084 A
(\(initial)336 3336 A
(PC\))126 3714 A
3882(*/)S
2970 V
(17283)210 648 A
1026({)S
3060 V
(17284)210 648 A
1026(/*)S
(Read)168 1152 A
(the)126 1362 A
(header)252 1530 A
(and)126 1824 A
(extract)294 1992 A
(the)126 2328 A
(text,)210 2496 A
(data,)210 2748 A
(bss)126 3000 A
(and)126 3168 A
(total)210 3336 A
(sizes)210 3588 A
(from)168 3840 A
(it.)126 4050 A
4218(*/)S
3150 V
(17285)210 648 A
3240 V
(17286)210 648 A
(int)126 1110 A
1278(m,)S
(ct;)126 1404 A
3330 V
(17287)210 648 A
(vir_clicks)420 1110 A
(tc,)126 1572 A
(dc,)126 1740 A
(s_vir,)252 1908 A
(dvir;)210 2202 A
3420 V
(17288)210 648 A
(phys_clicks)462 1110 A
(totc;)210 1614 A
3510 V
(17289)210 648 A
(struct)252 1110 A
(exec)168 1404 A
(hdr;)168 1614 A
2370(/*)S
(a.out)210 2496 A
(header)252 2748 A
3042(is)S
(read)168 3168 A
3378(in)S
(here)168 3504 A
3714(*/)S
3600 V
(17290)210 648 A
3690 V
(17291)210 648 A
1110(/*)S
(Read)168 1236 A
(the)126 1446 A
(header)252 1614 A
(and)126 1908 A
(check)210 2076 A
(the)126 2328 A
(magic)210 2496 A
(number.)294 2748 A
(The)126 3126 A
(standard)336 3294 A
(MINIX)210 3672 A
(header)252 3924 A
3780 V
(17292)210 648 A
1152(*)S
1236(is)S
(defined)294 1362 A
1698(in)S
(<a.out.h>.)420 1824 A
2328(It)S
(consists)336 2454 A
2832(of)S
2958(8)S
(chars)210 3042 A
(followed)336 3294 A
3672(by)S
3798(6)S
(longs.)252 3882 A
3870 V
(17293)210 648 A
1152(*)S
(Then)168 1236 A
(come)168 1446 A
1656(4)S
(more)168 1740 A
(longs)210 1950 A
(that)168 2202 A
(are)126 2412 A
(not)126 2580 A
(used)168 2748 A
(here.)210 2958 A
3960 V
(17294)210 648 A
1152(*)S
(Byte)168 1362 A
1572(0:)S
(magic)210 1698 A
(number)252 1950 A
(0x01)168 2244 A
4050 V
(17295)210 648 A
1152(*)S
(Byte)168 1362 A
1572(1:)S
(magic)210 1698 A
(number)252 1950 A
(0x03)168 2244 A
4140 V
(17296)210 648 A
1152(*)S
(Byte)168 1362 A
1572(2:)S
(normal)252 1698 A
1992(=)S
(0x10)168 2076 A
(\(not)168 2286 A
(checked,)336 2496 A
2874(0)S
2958(is)S
(OK\),)168 3084 A
(separate)336 3294 A
(I/D)126 3672 A
3840(=)S
(0x20)168 3924 A
4230 V
(17297)210 648 A
1152(*)S
(Byte)168 1362 A
1572(3:)S
(CPU)126 1698 A
(type,)210 1866 A
(Intel)210 2118 A
2370(16)S
(bit)126 2496 A
2664(=)S
(0x04,)210 2748 A
(Intel)210 3000 A
3252(32)S
(bit)126 3378 A
3546(=)S
(0x10,)210 3630 A
4320 V
(17298)210 648 A
1152(*)S
(Motorola)336 1698 A
2076(=)S
(0x0B,)210 2160 A
(Sun)126 2412 A
(SPARC)210 2580 A
2832(=)S
(0x17)168 2916 A
4410 V
(17299)210 648 A
1152(*)S
(Byte)168 1362 A
1572(4:)S
(Header)252 1698 A
(length)252 1992 A
2286(=)S
(0x20)168 2370 A
4500 V
(17300)210 648 A
1152(*)S
(Bytes)210 1362 A
(5-7)126 1614 A
(are)126 1782 A
(not)126 1950 A
(used.)210 2118 A
4590 V
(17301)210 648 A
1152(*)S
4680 V
(17302)210 648 A
1152(*)S
(Now)126 1362 A
(come)168 1530 A
(the)126 1740 A
1908(6)S
(longs)210 1992 A
4770 V
(17303)210 648 A
1152(*)S
(Bytes)210 1362 A
(8-11:)210 1656 A
(size)168 1908 A
2118(of)S
(text)168 2244 A
(segments)336 2454 A
2832(in)S
(bytes)210 2958 A
4860 V
(17304)210 648 A
1152(*)S
(Bytes)210 1362 A
(12-15:)252 1614 A
(size)168 1908 A
2118(of)S
(initialized)462 2244 A
(data)168 2748 A
(segment)294 2958 A
3294(in)S
(bytes)210 3420 A
4950 V
(17305)210 648 A
1152(*)S
(Bytes)210 1362 A
(16-19:)252 1614 A
(size)168 1908 A
2118(of)S
(bss)126 2244 A
2412(in)S
(bytes)210 2538 A
5040 V
(17306)210 648 A
1152(*)S
(Bytes)210 1362 A
(20-23:)252 1614 A
(program)294 1908 A
(entry)210 2244 A
(point)210 2496 A
5130 V
(17307)210 648 A
1152(*)S
(Bytes)210 1362 A
(24-27:)252 1614 A
(total)210 1908 A
(memory)252 2160 A
(allocated)378 2454 A
2874(to)S
(program)294 3000 A
(\(text,)252 3336 A
(data)168 3630 A
3840(+)S
(stack\))252 3924 A
5220 V
(17308)210 648 A
1152(*)S
(Bytes)210 1362 A
(28-31:)252 1614 A
(size)168 1908 A
2118(of)S
(symbol)252 2244 A
(table)210 2538 A
2790(in)S
(bytes)210 2916 A
5310 V
(17309)210 648 A
1152(*)S
(The)126 1236 A
(longs)210 1404 A
(are)126 1656 A
(represented)462 1824 A
2328(in)S
2454(a)S
(machine)294 2538 A
(dependent)378 2874 A
(order,)252 3294 A
5400 V
(17310)210 648 A
1152(*)S
(little-endian)546 1236 A
1824(on)S
(the)126 1950 A
(8088,)210 2118 A
(big-endian)420 2370 A
2832(on)S
(the)126 2958 A
(68000.)252 3126 A
5490 V
(17311)210 648 A
1152(*)S
(The)126 1236 A
(header)252 1404 A
1698(is)S
(followed)336 1824 A
(directly)336 2202 A
2580(by)S
(the)126 2706 A
(text)168 2874 A
(and)126 3084 A
(data)168 3252 A
(segments,)378 3462 A
(and)126 3882 A
(the)126 4050 A
5580 V
(17312)210 648 A
1152(*)S
(symbol)252 1236 A
(table)210 1530 A
(\(if)126 1782 A
(any\).)210 1950 A
(The)126 2202 A
(sizes)210 2370 A
(are)126 2622 A
(given)210 2790 A
3042(in)S
(the)126 3168 A
(header.)294 3336 A
(Only)168 3672 A
(the)126 3882 A
5670 V
(17313)210 648 A
1152(*)S
(text)168 1236 A
(and)126 1446 A
(data)168 1614 A
(segments)336 1824 A
(are)126 2202 A
(copied)252 2370 A
(into)168 2664 A
(memory)252 2874 A
3168(by)S
(exec.)210 3294 A
(The)126 3546 A
(header)252 3714 A
4008(is)S
5760 V
(17314)210 648 A
1152(*)S
(used)168 1236 A
(here)168 1446 A
(only.)210 1656 A
(The)126 1908 A
(symbol)252 2076 A
(table)210 2370 A
2622(is)S
(for)126 2748 A
(the)126 2916 A
(benefit)294 3084 A
3420(of)S
3546(a)S
(debugger)336 3630 A
(and)126 4008 A
5850 V
(17315)210 648 A
1152(*)S
1236(is)S
(ignored)294 1362 A
(here.)210 1698 A
5940 V
(17316)210 648 A
1152(*/)S
6030 V
(17317)210 648 A
6120 V
(17318)210 648 A
1110(if)S
(\(read\(fd,)378 1236 A
(\(char)210 1656 A
1908(*\))S
(&hdr,)210 2034 A
(A_MINHDR\))378 2286 A
2706(!=)S
(A_MINHDR\))378 2832 A
(return\(ENOEXEC\);)672 3252 A
6210 V
(17319)210 648 A
8418 V
EP
%%Page: 240 240
BP
/slant 0 def
/height 0 def
630 V
12 B
(240)180 648 A
11 R
2098(File:)S
2331(src/mm/exec.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(17320)210 648 A
1110(/*)S
(Check)210 1236 A
(magic)210 1488 A
(number,)294 1740 A
(cpu)126 2076 A
(type,)210 2244 A
(and)126 2496 A
(flags.)252 2664 A
2958(*/)S
990 V
(17321)210 648 A
1110(if)S
(\(BADMAG\(hdr\)\))546 1236 A
(return\(ENOEXEC\);)672 1824 A
1080 V
(17322)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL)210 1572 A
1824(&&)S
(_WORD_SIZE)420 1950 A
2412(==)S
2538(2\))S
1170 V
(17323)210 648 A
1110(if)S
(\(hdr.a_cpu)420 1236 A
1698(!=)S
(A_I8086\))336 1824 A
(return\(ENOEXEC\);)672 2202 A
1260 V
(17324)210 648 A
(#endif)252 1026 A
1350 V
(17325)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL)210 1572 A
1824(&&)S
(_WORD_SIZE)420 1950 A
2412(==)S
2538(4\))S
1440 V
(17326)210 648 A
1110(if)S
(\(hdr.a_cpu)420 1236 A
1698(!=)S
(A_I80386\))378 1824 A
(return\(ENOEXEC\);)672 2244 A
1530 V
(17327)210 648 A
(#endif)252 1026 A
1620 V
(17328)210 648 A
1110(if)S
(\(\(hdr.a_flags)546 1236 A
1824(&)S
(\304\(A_NSYM)336 1908 A
2286(|)S
(A_EXEC)252 2370 A
2664(|)S
(A_SEP\)\))294 2748 A
3084(!=)S
3210(0\))S
(return\(ENOEXEC\);)672 3336 A
1710 V
(17329)210 648 A
1800 V
(17330)210 648 A
(*ft)126 1110 A
1278(=)S
1362(\()S
(\(hdr.a_flags)504 1446 A
1992(&)S
(A_SEP\))252 2076 A
2370(?)S
(SEPARATE)336 2454 A
2832(:)S
(0\);)126 2916 A
3210(/*)S
(separate)336 3336 A
3714(I)S
3798(&)S
3882(D)S
3966(or)S
(not)126 4092 A
4260(*/)S
1890 V
(17331)210 648 A
1980 V
(17332)210 648 A
1110(/*)S
(Get)126 1236 A
(text)168 1404 A
(and)126 1614 A
(data)168 1782 A
(sizes.)252 1992 A
2286(*/)S
2070 V
(17333)210 648 A
(*text_bytes)462 1110 A
1614(=)S
(\(vir_bytes\))462 1698 A
(hdr.a_text;)462 2202 A
2706(/*)S
(text)168 2832 A
(size)168 3042 A
3252(in)S
(bytes)210 3378 A
3630(*/)S
2160 V
(17334)210 648 A
(*data_bytes)462 1110 A
1614(=)S
(\(vir_bytes\))462 1698 A
(hdr.a_data;)462 2202 A
2706(/*)S
(data)168 2832 A
(size)168 3042 A
3252(in)S
(bytes)210 3378 A
3630(*/)S
2250 V
(17335)210 648 A
(*bss_bytes)420 1110 A
1614(=)S
(\(vir_bytes\))462 1698 A
(hdr.a_bss;)420 2202 A
2706(/*)S
(bss)126 2832 A
(size)168 3000 A
3210(in)S
(bytes)210 3336 A
3588(*/)S
2340 V
(17336)210 648 A
(*tot_bytes)420 1110 A
1614(=)S
(hdr.a_total;)504 1698 A
2706(/*)S
(total)210 2832 A
(bytes)210 3084 A
3336(to)S
(allocate)336 3462 A
(for)126 3840 A
(prog)168 4008 A
4218(*/)S
2430 V
(17337)210 648 A
(*sym_bytes)420 1110 A
1614(=)S
(hdr.a_syms;)462 1698 A
2706(/*)S
(symbol)252 2832 A
(table)210 3126 A
(size)168 3378 A
3588(in)S
(bytes)210 3714 A
3966(*/)S
2520 V
(17338)210 648 A
1110(if)S
(\(*tot_bytes)462 1236 A
1740(==)S
1866(0\))S
(return\(ENOEXEC\);)672 1992 A
2610 V
(17339)210 648 A
2700 V
(17340)210 648 A
1110(if)S
(\(*ft)168 1236 A
1446(!=)S
(SEPARATE\))378 1572 A
1992({)S
2790 V
(17341)210 648 A
2880 V
(17342)210 648 A
1362(/*)S
1488(If)S
1614(I)S
1698(&)S
1782(D)S
(space)210 1866 A
2118(is)S
(not)126 2244 A
(separated,)420 2412 A
2874(it)S
3000(is)S
(all)126 3126 A
(considered)420 3294 A
(data.)210 3756 A
(Text=0*/)336 4008 A
2970 V
(17343)210 648 A
(*data_bytes)462 1362 A
1866(+=)S
(*text_bytes;)504 1992 A
3060 V
(17344)210 648 A
(*text_bytes)462 1362 A
1866(=)S
1950(0;)S
3150 V
(17345)210 648 A
3240 V
(17346)210 648 A
1110(})S
3330 V
(17347)210 648 A
(*pc)126 1110 A
1278(=)S
(hdr.a_entry;)504 1362 A
2034(/*)S
(initial)294 2160 A
(address)294 2496 A
2832(to)S
(start)210 2958 A
(execution)378 3210 A
3630(*/)S
3420 V
(17348)210 648 A
3510 V
(17349)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
(segment)294 1908 A
(sizes)210 2244 A
(are)126 2496 A
(feasible.)378 2664 A
3084(*/)S
3600 V
(17350)210 648 A
1110(tc)S
1236(=)S
(\(\(unsigned)420 1320 A
(long\))210 1782 A
(*text_bytes)462 2034 A
2538(+)S
(CLICK_SIZE)420 2622 A
3084(-)S
3168(1\))S
3294(>>)S
(CLICK_SHIFT;)504 3420 A
3690 V
(17351)210 648 A
1110(dc)S
1236(=)S
(\(*data_bytes)504 1320 A
1866(+)S
(*bss_bytes)420 1950 A
2412(+)S
(CLICK_SIZE)420 2496 A
2958(-)S
3042(1\))S
3168(>>)S
(CLICK_SHIFT;)504 3294 A
3780 V
(17352)210 648 A
(totc)168 1110 A
1320(=)S
(\(*tot_bytes)462 1404 A
1908(+)S
(CLICK_SIZE)420 1992 A
2454(-)S
2538(1\))S
2664(>>)S
(CLICK_SHIFT;)504 2790 A
3870 V
(17353)210 648 A
1110(if)S
(\(dc)126 1236 A
1404(>=)S
(totc\))210 1530 A
(return\(ENOEXEC\);)672 1782 A
2706(/*)S
(stack)210 2832 A
(must)168 3084 A
3294(be)S
3420(at)S
(least)210 3546 A
3798(1)S
(click)210 3882 A
4134(*/)S
3960 V
(17354)210 648 A
(dvir)168 1110 A
1320(=)S
(\(*ft)168 1404 A
1614(==)S
(SEPARATE)336 1740 A
2118(?)S
2202(0)S
2286(:)S
(tc\);)168 2370 A
4050 V
(17355)210 648 A
(s_vir)210 1110 A
1362(=)S
(dvir)168 1446 A
1656(+)S
(\(totc)210 1740 A
1992(-)S
(sc\);)168 2076 A
4140 V
(17356)210 648 A
1110(m)S
1194(=)S
(size_ok\(*ft,)504 1278 A
(tc,)126 1824 A
(dc,)126 1992 A
(sc,)126 2160 A
(dvir,)210 2328 A
(s_vir\);)294 2580 A
4230 V
(17357)210 648 A
1110(ct)S
1236(=)S
(hdr.a_hdrlen)504 1320 A
1866(&)S
(BYTE;)210 1950 A
2706(/*)S
(header)252 2832 A
(length)252 3126 A
3420(*/)S
4320 V
(17358)210 648 A
1110(if)S
(\(ct)126 1236 A
1404(>)S
(A_MINHDR\))378 1488 A
(lseek\(fd,)378 1908 A
(\(off_t\))294 2328 A
(ct,)126 2664 A
(SEEK_SET\);)420 2832 A
3294(/*)S
(skip)168 3420 A
(unused)252 3630 A
(hdr)126 3924 A
4092(*/)S
4410 V
(17359)210 648 A
(return\(m\);)420 1110 A
4500 V
(17360)210 648 A
1026(})S
4770 V
(17363)210 648 A
(/*===========================================================================*)3276 1026 A
4860 V
(17364)210 648 A
1068(*)S
(new_mem)294 2370 A
4260(*)S
4950 V
(17365)210 648 A
(*===========================================================================*/)3276 1068 A
5040 V
(17366)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(new_mem\(sh_mp,)588 1530 A
(text_bytes,)462 2160 A
(data_bytes,bss_bytes,stk_bytes,tot_bytes\))1722 2664 A
5130 V
(17367)210 648 A
(struct)252 1026 A
(mproc)210 1320 A
(*sh_mp;)294 1572 A
2370(/*)S
(text)168 2496 A
(can)126 2706 A
2874(be)S
(shared)252 3000 A
(with)168 3294 A
(this)168 3504 A
(process)294 3714 A
4050(*/)S
5220 V
(17368)210 648 A
(vir_bytes)378 1026 A
(text_bytes;)462 1446 A
2370(/*)S
(text)168 2496 A
(segment)294 2706 A
(size)168 3042 A
3252(in)S
(bytes)210 3378 A
3630(*/)S
5310 V
(17369)210 648 A
(vir_bytes)378 1026 A
(data_bytes;)462 1446 A
2370(/*)S
(size)168 2496 A
2706(of)S
(initialized)462 2832 A
(data)168 3336 A
3546(in)S
(bytes)210 3672 A
3924(*/)S
5400 V
(17370)210 648 A
(vir_bytes)378 1026 A
(bss_bytes;)420 1446 A
2370(/*)S
(size)168 2496 A
2706(of)S
(bss)126 2832 A
3000(in)S
(bytes)210 3126 A
3378(*/)S
5490 V
(17371)210 648 A
(vir_bytes)378 1026 A
(stk_bytes;)420 1446 A
2370(/*)S
(size)168 2496 A
2706(of)S
(initial)294 2832 A
(stack)210 3168 A
(segment)294 3420 A
3756(in)S
(bytes)210 3882 A
4134(*/)S
5580 V
(17372)210 648 A
(phys_bytes)420 1026 A
(tot_bytes;)420 1488 A
2370(/*)S
(total)210 2496 A
(memory)252 2748 A
3042(to)S
(allocate,)378 3168 A
(including)378 3588 A
(gap)126 4008 A
4176(*/)S
5670 V
(17373)210 648 A
1026({)S
5760 V
(17374)210 648 A
1026(/*)S
(Allocate)336 1152 A
(new)126 1530 A
(memory)252 1698 A
(and)126 1992 A
(release)294 2160 A
(the)126 2496 A
(old)126 2664 A
(memory.)294 2832 A
(Change)252 3210 A
(the)126 3504 A
(map)126 3672 A
(and)126 3840 A
(report)252 4008 A
5850 V
(17375)210 648 A
1068(*)S
(the)126 1152 A
(new)126 1320 A
(map)126 1488 A
1656(to)S
(the)126 1782 A
(kernel.)294 1950 A
(Zero)168 2328 A
(the)126 2538 A
(new)126 2706 A
(core)168 2874 A
(image's)294 3084 A
(bss,)168 3420 A
(gap)126 3630 A
(and)126 3798 A
(stack.)252 3966 A
5940 V
(17376)210 648 A
1068(*/)S
6030 V
(17377)210 648 A
6120 V
(17378)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rmp;)210 2034 A
6210 V
(17379)210 648 A
(vir_clicks)420 1110 A
(text_clicks,)504 1572 A
(data_clicks,)504 2118 A
(gap_clicks,)462 2664 A
(stack_clicks,)546 3168 A
(tot_clicks;)462 3756 A
8418 V
EP
%%Page: 241 241
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2098(File:)S
2331(src/mm/exec.c)S
12 B
(241)180 4248 A
900 V
7 LST
(17380)210 648 A
(phys_clicks)462 1110 A
(new_base;)378 1614 A
990 V
(17381)210 648 A
1080 V
(17382)210 648 A
(static)252 1110 A
(char)168 1404 A
(zero[1024];)462 1614 A
2706(/*)S
(used)168 2832 A
3042(to)S
(zero)168 3168 A
(bss)126 3378 A
3546(*/)S
1170 V
(17383)210 648 A
(phys_bytes)420 1110 A
(bytes,)252 1572 A
(base,)210 1866 A
(count,)252 2118 A
(bss_offset;)462 2412 A
1260 V
(17384)210 648 A
1350 V
(17385)210 648 A
1110(/*)S
1236(No)S
(need)168 1362 A
1572(to)S
(allocate)336 1698 A
(text)168 2076 A
2286(if)S
2412(it)S
(can)126 2538 A
2706(be)S
(shared.)294 2832 A
3168(*/)S
1440 V
(17386)210 648 A
1110(if)S
(\(sh_mp)252 1236 A
1530(!=)S
(NULL\))210 1656 A
(text_bytes)420 1908 A
2370(=)S
2454(0;)S
1530 V
(17387)210 648 A
1620 V
(17388)210 648 A
1110(/*)S
(Acquire)294 1236 A
(the)126 1572 A
(new)126 1740 A
(memory.)294 1908 A
(Each)168 2286 A
2496(of)S
(the)126 2622 A
2790(4)S
(parts:)252 2874 A
(text,)210 3168 A
(\(data+bss\),)462 3420 A
(gap,)168 3924 A
1710 V
(17389)210 648 A
1152(*)S
(and)126 1236 A
(stack)210 1404 A
(occupies)336 1656 A
2034(an)S
(integral)336 2160 A
(number)252 2538 A
2832(of)S
(clicks,)294 2958 A
(starting)336 3294 A
3672(at)S
(click)210 3798 A
1800 V
(17390)210 648 A
1152(*)S
(boundary.)378 1236 A
(The)126 1698 A
(data)168 1866 A
(and)126 2076 A
(bss)126 2244 A
(parts)210 2412 A
(are)126 2664 A
(run)126 2832 A
(together)336 3000 A
(with)168 3378 A
3588(no)S
(space.)252 3714 A
1890 V
(17391)210 648 A
1152(*/)S
1980 V
(17392)210 648 A
2070 V
(17393)210 648 A
(text_clicks)462 1110 A
1614(=)S
(\(\(unsigned)420 1698 A
(long\))210 2160 A
(text_bytes)420 2412 A
2874(+)S
(CLICK_SIZE)420 2958 A
3420(-)S
3504(1\))S
3630(>>)S
(CLICK_SHIFT;)504 3756 A
2160 V
(17394)210 648 A
(data_clicks)462 1110 A
1614(=)S
(\(data_bytes)462 1698 A
2202(+)S
(bss_bytes)378 2286 A
2706(+)S
(CLICK_SIZE)420 2790 A
3252(-)S
3336(1\))S
3462(>>)S
(CLICK_SHIFT;)504 3588 A
2250 V
(17395)210 648 A
(stack_clicks)504 1110 A
1656(=)S
(\(stk_bytes)420 1740 A
2202(+)S
(CLICK_SIZE)420 2286 A
2748(-)S
2832(1\))S
2958(>>)S
(CLICK_SHIFT;)504 3084 A
2340 V
(17396)210 648 A
(tot_clicks)420 1110 A
1572(=)S
(\(tot_bytes)420 1656 A
2118(+)S
(CLICK_SIZE)420 2202 A
2664(-)S
2748(1\))S
2874(>>)S
(CLICK_SHIFT;)504 3000 A
2430 V
(17397)210 648 A
(gap_clicks)420 1110 A
1572(=)S
(tot_clicks)420 1656 A
2118(-)S
(data_clicks)462 2202 A
2706(-)S
(stack_clicks;)546 2790 A
2520 V
(17398)210 648 A
1110(if)S
1236(\()S
(\(int\))210 1320 A
(gap_clicks)420 1572 A
2034(<)S
2118(0\))S
(return\(ENOMEM\);)630 2244 A
2610 V
(17399)210 648 A
2700 V
(17400)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
(there)210 1908 A
2160(is)S
2286(a)S
(hole)168 2370 A
(big)126 2580 A
(enough.)294 2748 A
3126(If)S
(so,)126 3252 A
3420(we)S
(can)126 3546 A
(risk)168 3714 A
(first)210 3924 A
2790 V
(17401)210 648 A
1152(*)S
(releasing)378 1236 A
(the)126 1656 A
(old)126 1824 A
(core)168 1992 A
(image)210 2202 A
(before)252 2454 A
(allocating)420 2748 A
(the)126 3210 A
(new)126 3378 A
(one,)168 3546 A
(since)210 3756 A
4008(we)S
2880 V
(17402)210 648 A
1152(*)S
(know)168 1236 A
1446(it)S
(will)168 1572 A
(succeed.)336 1782 A
2202(If)S
(there)210 2328 A
2580(is)S
(not)126 2706 A
(enough,)294 2874 A
(return)252 3210 A
(failure.)336 3504 A
2970 V
(17403)210 648 A
1152(*/)S
3060 V
(17404)210 648 A
1110(if)S
(\(text_clicks)504 1236 A
1782(+)S
(tot_clicks)420 1866 A
2328(>)S
(max_hole\(\)\))462 2412 A
(return\(EAGAIN\);)630 2916 A
3150 V
(17405)210 648 A
3240 V
(17406)210 648 A
1110(/*)S
(There)210 1236 A
1488(is)S
(enough)252 1614 A
(memory)252 1908 A
(for)126 2202 A
(the)126 2370 A
(new)126 2538 A
(core)168 2706 A
(image.)252 2916 A
(Release)294 3252 A
(the)126 3588 A
(old)126 3756 A
(one.)168 3924 A
4134(*/)S
3330 V
(17407)210 648 A
(rmp)126 1110 A
1278(=)S
(mp;)126 1362 A
3420 V
(17408)210 648 A
3510 V
(17409)210 648 A
1110(if)S
(\(find_share\(rmp,)672 1236 A
(rmp->mp_ino,)504 1950 A
(rmp->mp_dev,)504 2496 A
(rmp->mp_ctime\))588 3042 A
3672(==)S
(NULL\))210 3798 A
4050({)S
3600 V
(17410)210 648 A
1362(/*)S
1488(No)S
(other)210 1614 A
(process)294 1866 A
(shares)252 2202 A
(the)126 2496 A
(text)168 2664 A
(segment,)336 2874 A
3252(so)S
(free)168 3378 A
(it.)126 3588 A
3756(*/)S
3690 V
(17411)210 648 A
(free_mem\(rmp->mp_seg[T].mem_phys,)1386 1362 A
(rmp->mp_seg[T].mem_len\);)1008 2790 A
3780 V
(17412)210 648 A
1110(})S
3870 V
(17413)210 648 A
1110(/*)S
(Free)168 1236 A
(the)126 1446 A
(data)168 1614 A
(and)126 1824 A
(stack)210 1992 A
(segments.)378 2244 A
2664(*/)S
3960 V
(17414)210 648 A
(free_mem\(rmp->mp_seg[D].mem_phys,)1386 1110 A
4050 V
(17415)210 648 A
(rmp->mp_seg[S].mem_vir)924 1278 A
2244(+)S
(rmp->mp_seg[S].mem_len)924 2328 A
3294(-)S
(rmp->mp_seg[D].mem_vir\);)1008 3378 A
4140 V
(17416)210 648 A
4230 V
(17417)210 648 A
1110(/*)S
1236(We)S
(have)168 1362 A
(now)126 1572 A
(passed)252 1740 A
(the)126 2034 A
(point)210 2202 A
2454(of)S
2580(no)S
(return.)294 2706 A
(The)126 3084 A
(old)126 3252 A
(core)168 3420 A
(image)210 3630 A
(has)126 3882 A
(been)168 4050 A
4320 V
(17418)210 648 A
1152(*)S
(forever)294 1236 A
(lost.)210 1572 A
(The)126 1866 A
(call)168 2034 A
(must)168 2244 A
2454(go)S
(through)294 2580 A
(now.)168 2916 A
(Set)126 3168 A
3336(up)S
(and)126 3462 A
(report)252 3630 A
(new)126 3924 A
(map.)168 4092 A
4410 V
(17419)210 648 A
1152(*/)S
4500 V
(17420)210 648 A
(new_base)336 1110 A
1488(=)S
(alloc_mem\(text_clicks)882 1572 A
2496(+)S
(tot_clicks\);)504 2580 A
3378(/*)S
(new)126 3504 A
(core)168 3672 A
(image)210 3882 A
4134(*/)S
4590 V
(17421)210 648 A
1110(if)S
(\(new_base)378 1236 A
1656(==)S
(NO_MEM\))294 1782 A
(panic\("MM)378 2118 A
(hole)168 2538 A
(list)168 2748 A
2958(is)S
(inconsistent",)588 3084 A
(NO_NUM\);)336 3714 A
4680 V
(17422)210 648 A
4770 V
(17423)210 648 A
1110(if)S
(\(sh_mp)252 1236 A
1530(!=)S
(NULL\))210 1656 A
1908({)S
4860 V
(17424)210 648 A
1362(/*)S
(Share)210 1488 A
(the)126 1740 A
(text)168 1908 A
(segment.)336 2118 A
2496(*/)S
4950 V
(17425)210 648 A
(rmp->mp_seg[T])588 1362 A
1992(=)S
(sh_mp->mp_seg[T];)714 2076 A
5040 V
(17426)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5130 V
(17427)210 648 A
(rmp->mp_seg[T].mem_phys)966 1362 A
2370(=)S
(new_base;)378 2454 A
5220 V
(17428)210 648 A
(rmp->mp_seg[T].mem_vir)924 1362 A
2328(=)S
2412(0;)S
5310 V
(17429)210 648 A
(rmp->mp_seg[T].mem_len)924 1362 A
2328(=)S
(text_clicks;)504 2412 A
5400 V
(17430)210 648 A
1110(})S
5490 V
(17431)210 648 A
(rmp->mp_seg[D].mem_phys)966 1110 A
2118(=)S
(new_base)336 2202 A
2580(+)S
(text_clicks;)504 2664 A
5580 V
(17432)210 648 A
(rmp->mp_seg[D].mem_vir)924 1110 A
2076(=)S
2160(0;)S
5670 V
(17433)210 648 A
(rmp->mp_seg[D].mem_len)924 1110 A
2076(=)S
(data_clicks;)504 2160 A
5760 V
(17434)210 648 A
(rmp->mp_seg[S].mem_phys)966 1110 A
2118(=)S
(rmp->mp_seg[D].mem_phys)966 2202 A
3210(+)S
(data_clicks)462 3294 A
3798(+)S
(gap_clicks;)462 3882 A
5850 V
(17435)210 648 A
(rmp->mp_seg[S].mem_vir)924 1110 A
2076(=)S
(rmp->mp_seg[D].mem_vir)924 2160 A
3126(+)S
(data_clicks)462 3210 A
3714(+)S
(gap_clicks;)462 3798 A
5940 V
(17436)210 648 A
(rmp->mp_seg[S].mem_len)924 1110 A
2076(=)S
(stack_clicks;)546 2160 A
6030 V
(17437)210 648 A
6120 V
(17438)210 648 A
6210 V
(17439)210 648 A
(sys_newmap\(who,)630 1110 A
(rmp->mp_seg\);)546 1782 A
2454(/*)S
(report)252 2580 A
(new)126 2874 A
(map)126 3042 A
3210(to)S
(the)126 3336 A
(kernel)252 3504 A
3798(*/)S
8418 V
EP
%%Page: 242 242
BP
/slant 0 def
/height 0 def
630 V
12 B
(242)180 648 A
11 R
2098(File:)S
2331(src/mm/exec.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(17440)210 648 A
990 V
(17441)210 648 A
1110(/*)S
(Zero)168 1236 A
(the)126 1446 A
(bss,)168 1614 A
(gap,)168 1824 A
(and)126 2034 A
(stack)210 2202 A
(segment.)336 2454 A
2832(*/)S
1080 V
(17442)210 648 A
(bytes)210 1110 A
1362(=)S
(\(phys_bytes\)\(data_clicks)1008 1446 A
2496(+)S
(gap_clicks)420 2580 A
3042(+)S
(stack_clicks\))546 3126 A
3714(<<)S
(CLICK_SHIFT;)504 3840 A
1170 V
(17443)210 648 A
(base)168 1110 A
1320(=)S
(\(phys_bytes\))504 1404 A
(rmp->mp_seg[D].mem_phys)966 1950 A
2958(<<)S
(CLICK_SHIFT;)504 3084 A
1260 V
(17444)210 648 A
(bss_offset)420 1110 A
1572(=)S
(\(data_bytes)462 1656 A
2160(>>)S
(CLICK_SHIFT\))504 2286 A
2832(<<)S
(CLICK_SHIFT;)504 2958 A
1350 V
(17445)210 648 A
(base)168 1110 A
1320(+=)S
(bss_offset;)462 1446 A
1440 V
(17446)210 648 A
(bytes)210 1110 A
1362(-=)S
(bss_offset;)462 1488 A
1530 V
(17447)210 648 A
1620 V
(17448)210 648 A
(while)210 1110 A
(\(bytes)252 1362 A
1656(>)S
1740(0\))S
1866({)S
1710 V
(17449)210 648 A
(count)210 1362 A
1614(=)S
(MIN\(bytes,)420 1698 A
(\(phys_bytes\))504 2160 A
(sizeof\(zero\)\);)588 2706 A
1800 V
(17450)210 648 A
1362(if)S
(\(sys_copy\(MM_PROC_NR,)882 1488 A
2412(D,)S
(\(phys_bytes\))504 2538 A
(zero,)210 3084 A
1890 V
(17451)210 648 A
(ABS,)168 3042 A
3252(0,)S
(base,)210 3378 A
(count\))252 3630 A
3924(!=)S
(OK\))126 4050 A
4218({)S
1980 V
(17452)210 648 A
(panic\("new_mem)588 1698 A
(can't)210 2328 A
(zero",)252 2580 A
(NO_NUM\);)336 2874 A
2070 V
(17453)210 648 A
1362(})S
2160 V
(17454)210 648 A
(base)168 1362 A
1572(+=)S
(count;)252 1698 A
2250 V
(17455)210 648 A
(bytes)210 1362 A
1614(-=)S
(count;)252 1740 A
2340 V
(17456)210 648 A
1110(})S
2430 V
(17457)210 648 A
2520 V
(17458)210 648 A
(return\(OK\);)462 1110 A
2610 V
(17459)210 648 A
1026(})S
2880 V
(17462)210 648 A
(/*===========================================================================*)3276 1026 A
2970 V
(17463)210 648 A
1068(*)S
(patch_ptr)378 2370 A
4260(*)S
3060 V
(17464)210 648 A
(*===========================================================================*/)3276 1068 A
3150 V
(17465)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(patch_ptr\(stack,)672 1572 A
(base\))210 2286 A
3240 V
(17466)210 648 A
(char)168 1026 A
(stack[ARG_MAX];)630 1236 A
2034(/*)S
(pointer)294 2160 A
2496(to)S
(stack)210 2622 A
(image)210 2874 A
(within)252 3126 A
3420(MM)S
3546(*/)S
3330 V
(17467)210 648 A
(vir_bytes)378 1026 A
(base;)210 1446 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
3168(of)S
(stack)210 3294 A
(base)168 3546 A
(inside)252 3756 A
(user)168 4050 A
4260(*/)S
3420 V
(17468)210 648 A
1026({)S
3510 V
(17469)210 648 A
1026(/*)S
(When)168 1152 A
(doing)210 1362 A
1614(an)S
(exec\(name,)420 1740 A
(argv,)210 2202 A
(envp\))210 2454 A
(call,)210 2706 A
(the)126 2958 A
(user)168 3126 A
(builds)252 3336 A
3630(up)S
3756(a)S
(stack)210 3840 A
3600 V
(17470)210 648 A
1068(*)S
(image)210 1152 A
(with)168 1404 A
(arg)126 1614 A
(and)126 1782 A
(env)126 1950 A
(pointers)336 2118 A
(relative)336 2496 A
2874(to)S
(the)126 3000 A
(start)210 3168 A
3420(of)S
(the)126 3546 A
(stack.)252 3714 A
(Now)126 4050 A
3690 V
(17471)210 648 A
1068(*)S
(these)210 1152 A
(pointers)336 1404 A
(must)168 1782 A
1992(be)S
(relocated,)420 2118 A
(since)210 2580 A
(the)126 2832 A
(stack)210 3000 A
3252(is)S
(not)126 3378 A
(positioned)420 3546 A
4008(at)S
3780 V
(17472)210 648 A
1068(*)S
(address)294 1152 A
1488(0)S
1572(in)S
(the)126 1698 A
(user's)252 1866 A
(address)294 2160 A
(space.)252 2496 A
3870 V
(17473)210 648 A
1068(*/)S
3960 V
(17474)210 648 A
4050 V
(17475)210 648 A
(char)168 1110 A
(**ap,)210 1320 A
(flag;)210 1572 A
4140 V
(17476)210 648 A
(vir_bytes)378 1110 A
1530(v;)S
4230 V
(17477)210 648 A
4320 V
(17478)210 648 A
(flag)168 1110 A
1320(=)S
1404(0;)S
2370(/*)S
(counts)252 2496 A
(number)252 2790 A
3084(of)S
(0-pointers)420 3210 A
(seen)168 3672 A
3882(*/)S
4410 V
(17479)210 648 A
1110(ap)S
1236(=)S
(\(char)210 1320 A
(**\))126 1572 A
(stack;)252 1740 A
2370(/*)S
(points)252 2496 A
(initially)378 2790 A
3210(to)S
('nargs')294 3336 A
3672(*/)S
4500 V
(17480)210 648 A
(ap++;)210 1110 A
2370(/*)S
(now)126 2496 A
(points)252 2664 A
2958(to)S
(argv[0])294 3084 A
3420(*/)S
4590 V
(17481)210 648 A
(while)210 1110 A
(\(flag)210 1362 A
1614(<)S
1698(2\))S
1824({)S
4680 V
(17482)210 648 A
1362(if)S
(\(ap)126 1488 A
1656(>=)S
(\(char)210 1782 A
(**\))126 2034 A
(&stack[ARG_MAX]\))672 2202 A
(return;)294 2916 A
3378(/*)S
(too)126 3504 A
(bad)126 3672 A
3840(*/)S
4770 V
(17483)210 648 A
1362(if)S
(\(*ap)168 1488 A
1698(!=)S
(NIL_PTR\))336 1824 A
2202({)S
4860 V
(17484)210 648 A
1698(v)S
1782(=)S
(\(vir_bytes\))462 1866 A
(*ap;)168 2370 A
2706(/*)S
2832(v)S
2916(is)S
(relative)336 3042 A
(pointer)294 3420 A
3756(*/)S
4950 V
(17485)210 648 A
1698(v)S
1782(+=)S
(base;)210 1908 A
2706(/*)S
(relocate)336 2832 A
3210(it)S
3336(*/)S
5040 V
(17486)210 648 A
(*ap)126 1698 A
1866(=)S
(\(char)210 1950 A
2202(*\))S
2328(v;)S
2706(/*)S
(put)126 2832 A
3000(it)S
(back)168 3126 A
3336(*/)S
5130 V
(17487)210 648 A
1362(})S
(else)168 1446 A
1656({)S
5220 V
(17488)210 648 A
(flag++;)294 1698 A
5310 V
(17489)210 648 A
1362(})S
5400 V
(17490)210 648 A
(ap++;)210 1362 A
5490 V
(17491)210 648 A
1110(})S
5580 V
(17492)210 648 A
1026(})S
5850 V
(17495)210 648 A
(/*===========================================================================*)3276 1026 A
5940 V
(17496)210 648 A
1068(*)S
(load_seg)336 2370 A
4260(*)S
6030 V
(17497)210 648 A
(*===========================================================================*/)3276 1068 A
6120 V
(17498)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(load_seg\(fd,)504 1572 A
(seg,)168 2118 A
(seg_bytes\))420 2328 A
6210 V
(17499)210 648 A
(int)126 1026 A
(fd;)126 1194 A
2370(/*)S
(file)168 2496 A
(descriptor)420 2706 A
3168(to)S
(read)168 3294 A
(from)168 3504 A
3714(*/)S
8418 V
EP
%%Page: 243 243
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2098(File:)S
2331(src/mm/exec.c)S
12 B
(243)180 4248 A
900 V
7 LST
(17500)210 648 A
(int)126 1026 A
(seg;)168 1194 A
2370(/*)S
2496(T)S
2580(or)S
2706(D)S
2790(*/)S
990 V
(17501)210 648 A
(vir_bytes)378 1026 A
(seg_bytes;)420 1446 A
2370(/*)S
(how)126 2496 A
(big)126 2664 A
2832(is)S
(the)126 2958 A
(segment)294 3126 A
3462(*/)S
1080 V
(17502)210 648 A
1026({)S
1170 V
(17503)210 648 A
1026(/*)S
(Read)168 1152 A
1362(in)S
(text)168 1488 A
1698(or)S
(data)168 1824 A
(from)168 2034 A
(the)126 2244 A
(exec)168 2412 A
(file)168 2622 A
(and)126 2832 A
(copy)168 3000 A
3210(to)S
(the)126 3336 A
(new)126 3504 A
(core)168 3672 A
(image.)252 3882 A
1260 V
(17504)210 648 A
1068(*)S
(This)168 1152 A
(procedure)378 1362 A
1782(is)S
1908(a)S
(little)252 1992 A
(bit)126 2286 A
(tricky.)294 2454 A
(The)126 2832 A
(logical)294 3000 A
(way)126 3336 A
3504(to)S
(load)168 3630 A
3840(a)S
(segment)294 3924 A
1350 V
(17505)210 648 A
1068(*)S
(would)210 1152 A
1404(be)S
1530(to)S
(read)168 1656 A
1866(it)S
(block)210 1992 A
2244(by)S
(block)210 2370 A
(and)126 2622 A
(copy)168 2790 A
(each)168 3000 A
(block)210 3210 A
3462(to)S
(the)126 3588 A
(user)168 3756 A
(space)210 3966 A
1440 V
(17506)210 648 A
1068(*)S
(one)126 1152 A
1320(at)S
1446(a)S
(time.)210 1530 A
(This)168 1824 A
2034(is)S
(too)126 2160 A
(slow,)210 2328 A
2580(so)S
2706(we)S
2832(do)S
(something)378 2958 A
(dirty)210 3378 A
(here,)210 3630 A
(namely)252 3882 A
1530 V
(17507)210 648 A
1068(*)S
(send)168 1152 A
(the)126 1362 A
(user)168 1530 A
(space)210 1740 A
(and)126 1992 A
(virtual)294 2160 A
(address)294 2496 A
2832(to)S
(the)126 2958 A
(file)168 3126 A
(system)252 3336 A
3630(in)S
(the)126 3756 A
(upper)210 3924 A
1620 V
(17508)210 648 A
1068(*)S
1152(10)S
(bits)168 1278 A
1488(of)S
(the)126 1614 A
(file)168 1782 A
(descriptor,)462 1992 A
(and)126 2496 A
(pass)168 2664 A
2874(it)S
(the)126 3000 A
(user)168 3168 A
(virtual)294 3378 A
(address)294 3714 A
1710 V
(17509)210 648 A
1068(*)S
(instead)294 1152 A
1488(of)S
1614(a)S
1698(MM)S
(address.)336 1824 A
(The)126 2244 A
(file)168 2412 A
(system)252 2622 A
(extracts)336 2916 A
(these)210 3294 A
(parameters)420 3546 A
(when)168 4008 A
1800 V
(17510)210 648 A
1068(*)S
(gets)168 1152 A
1362(a)S
(read)168 1446 A
(call)168 1656 A
(from)168 1866 A
(the)126 2076 A
(memory)252 2244 A
(manager,)336 2538 A
(which)210 2916 A
3168(is)S
(the)126 3294 A
(only)168 3462 A
(process)294 3672 A
(that)168 4008 A
1890 V
(17511)210 648 A
1068(*)S
1152(is)S
(permitted)378 1278 A
1698(to)S
(use)126 1824 A
(this)168 1992 A
(trick.)252 2202 A
(The)126 2538 A
(file)168 2706 A
(system)252 2916 A
(then)168 3210 A
(copies)252 3420 A
(the)126 3714 A
(whole)210 3882 A
1980 V
(17512)210 648 A
1068(*)S
(segment)294 1152 A
(directly)336 1488 A
1866(to)S
(user)168 1992 A
(space,)252 2202 A
(bypassing)378 2496 A
2916(MM)S
(completely.)462 3042 A
2070 V
(17513)210 648 A
1068(*/)S
2160 V
(17514)210 648 A
2250 V
(17515)210 648 A
(int)126 1110 A
(new_fd,)294 1278 A
(bytes;)252 1614 A
2340 V
(17516)210 648 A
(char)168 1110 A
(*ubuf_ptr;)420 1320 A
2430 V
(17517)210 648 A
2520 V
(17518)210 648 A
(new_fd)252 1110 A
1404(=)S
(\(who)168 1488 A
1698(<<)S
1824(8\))S
1950(|)S
(\(seg)168 2034 A
2244(<<)S
2370(6\))S
2496(|)S
(fd;)126 2580 A
2610 V
(17519)210 648 A
(ubuf_ptr)336 1110 A
1488(=)S
(\(char)210 1572 A
1824(*\))S
(\(\(vir_bytes\)mp->mp_seg[seg].mem_vir)1470 1950 A
3462(<<)S
(CLICK_SHIFT\);)546 3588 A
2700 V
(17520)210 648 A
(while)210 1110 A
(\(seg_bytes)420 1362 A
1824(!=)S
1950(0\))S
2076({)S
2790 V
(17521)210 648 A
(bytes)210 1362 A
1614(=)S
(\(INT_MAX)336 1698 A
2076(/)S
(BLOCK_SIZE\))462 2160 A
2664(*)S
(BLOCK_SIZE;)462 2748 A
2880 V
(17522)210 648 A
1362(if)S
(\(seg_bytes)420 1488 A
1950(<)S
(bytes\))252 2034 A
2970 V
(17523)210 648 A
(bytes)210 1698 A
1950(=)S
(\(int\)seg_bytes;)630 2034 A
3060 V
(17524)210 648 A
1362(if)S
(\(read\(new_fd,)546 1488 A
(ubuf_ptr,)378 2076 A
(bytes\))252 2496 A
2790(!=)S
(bytes\))252 2916 A
3150 V
(17525)210 648 A
(break;)252 1698 A
2370(/*)S
(error)210 2496 A
2748(*/)S
3240 V
(17526)210 648 A
(ubuf_ptr)336 1362 A
1740(+=)S
(bytes;)252 1866 A
3330 V
(17527)210 648 A
(seg_bytes)378 1362 A
1782(-=)S
(bytes;)252 1908 A
3420 V
(17528)210 648 A
1110(})S
3510 V
(17529)210 648 A
1026(})S
3780 V
(17532)210 648 A
(/*===========================================================================*)3276 1026 A
3870 V
(17533)210 648 A
1068(*)S
(find_share)420 2370 A
4260(*)S
3960 V
(17534)210 648 A
(*===========================================================================*/)3276 1068 A
4050 V
(17535)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(mproc)210 1614 A
(*find_share\(mp_ign,)798 1866 A
(ino,)168 2706 A
(dev,)168 2916 A
(ctime\))252 3126 A
4140 V
(17536)210 648 A
(struct)252 1026 A
(mproc)210 1320 A
(*mp_ign;)336 1572 A
2370(/*)S
(process)294 2496 A
(that)168 2832 A
(should)252 3042 A
(not)126 3336 A
3504(be)S
(looked)252 3630 A
3924(at)S
4050(*/)S
4230 V
(17537)210 648 A
(ino_t)210 1026 A
(ino;)168 1278 A
2370(/*)S
(parameters)420 2496 A
(that)168 2958 A
(uniquely)336 3168 A
(identify)336 3546 A
3924(a)S
(file)168 4008 A
4218(*/)S
4320 V
(17538)210 648 A
(dev_t)210 1026 A
(dev;)168 1278 A
4410 V
(17539)210 648 A
(time_t)252 1026 A
(ctime;)252 1320 A
4500 V
(17540)210 648 A
1026({)S
4590 V
(17541)210 648 A
1026(/*)S
(Look)168 1152 A
(for)126 1362 A
1530(a)S
(process)294 1614 A
(that)168 1950 A
2160(is)S
(the)126 2286 A
(file)168 2454 A
(<ino,)210 2664 A
(dev,)168 2916 A
(ctime>)252 3126 A
3420(in)S
(execution.)420 3546 A
(Don't)210 4050 A
4680 V
(17542)210 648 A
1068(*)S
(accidentally)504 1152 A
("find")252 1698 A
(mp_ign,)294 1992 A
(because)294 2328 A
2664(it)S
2790(is)S
(the)126 2916 A
(process)294 3084 A
3420(on)S
(whose)210 3546 A
(behalf)252 3798 A
(this)168 4092 A
4770 V
(17543)210 648 A
1068(*)S
(call)168 1152 A
1362(is)S
(made.)210 1488 A
4860 V
(17544)210 648 A
1068(*/)S
4950 V
(17545)210 648 A
(struct)252 1110 A
(mproc)210 1404 A
(*sh_mp;)294 1656 A
5040 V
(17546)210 648 A
5130 V
(17547)210 648 A
(for)126 1110 A
(\(sh_mp)252 1278 A
1572(=)S
(&mproc[INIT_PROC_NR];)882 1656 A
(sh_mp)210 2580 A
2832(<)S
(&mproc[NR_PROCS];)714 2916 A
(sh_mp++\))336 3672 A
4050({)S
5220 V
(17548)210 648 A
1362(if)S
(\(\(sh_mp->mp_flags)714 1488 A
2244(&)S
(\(IN_USE)294 2328 A
2664(|)S
(HANGING)294 2748 A
3084(|)S
(SEPARATE\)\))420 3168 A
5310 V
(17549)210 648 A
2706(!=)S
(\(IN_USE)294 2832 A
3168(|)S
(SEPARATE\)\))420 3252 A
(continue;)378 3714 A
5400 V
(17550)210 648 A
1362(if)S
(\(sh_mp)252 1488 A
1782(==)S
(mp_ign\))294 1908 A
(continue;)378 2244 A
5490 V
(17551)210 648 A
1362(if)S
(\(sh_mp->mp_ino)588 1488 A
2118(!=)S
(ino\))168 2244 A
(continue;)378 2454 A
5580 V
(17552)210 648 A
1362(if)S
(\(sh_mp->mp_dev)588 1488 A
2118(!=)S
(dev\))168 2244 A
(continue;)378 2454 A
5670 V
(17553)210 648 A
1362(if)S
(\(sh_mp->mp_ctime)672 1488 A
2202(!=)S
(ctime\))252 2328 A
(continue;)378 2622 A
5760 V
(17554)210 648 A
(return)252 1362 A
(sh_mp;)252 1656 A
5850 V
(17555)210 648 A
1110(})S
5940 V
(17556)210 648 A
(return\(NULL\);)546 1110 A
6030 V
(17557)210 648 A
1026(})S
8418 V
EP
%%Page: 244 244
BP
/slant 0 def
/height 0 def
630 V
12 B
(244)180 648 A
11 R
2077(File:)S
2310(src/mm/break.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/mm/break.c)588 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(17600)210 648 A
1026(/*)S
(The)126 1152 A
(MINIX)210 1320 A
(model)210 1572 A
1824(of)S
(memory)252 1950 A
(allocation)420 2244 A
(reserves)336 2706 A
3084(a)S
(fixed)210 3168 A
(amount)252 3420 A
3714(of)S
(memory)252 3840 A
(for)126 4134 A
1440 V
(17601)210 648 A
1068(*)S
(the)126 1152 A
(combined)336 1320 A
(text,)210 1698 A
(data,)210 1950 A
(and)126 2202 A
(stack)210 2370 A
(segments.)378 2622 A
(The)126 3084 A
(amount)252 3252 A
(used)168 3546 A
(for)126 3756 A
3924(a)S
(child)210 4008 A
1530 V
(17602)210 648 A
1068(*)S
(process)294 1152 A
(created)294 1488 A
1824(by)S
(FORK)168 1950 A
2160(is)S
(the)126 2286 A
(same)168 2454 A
2664(as)S
(the)126 2790 A
(parent)252 2958 A
(had.)168 3252 A
3504(If)S
(the)126 3630 A
(child)210 3798 A
(does)168 4050 A
1620 V
(17603)210 648 A
1068(*)S
1152(an)S
(EXEC)168 1278 A
(later,)252 1488 A
(the)126 1782 A
(new)126 1950 A
(size)168 2118 A
2328(is)S
(taken)210 2454 A
(from)168 2706 A
(the)126 2916 A
(header)252 3084 A
3378(of)S
(the)126 3504 A
(file)168 3672 A
(EXEC'ed.)336 3882 A
1710 V
(17604)210 648 A
1068(*)S
1800 V
(17605)210 648 A
1068(*)S
(The)126 1152 A
(layout)252 1320 A
1614(in)S
(memory)252 1740 A
(consists)336 2034 A
2412(of)S
(the)126 2538 A
(text)168 2706 A
(segment,)336 2916 A
(followed)336 3294 A
3672(by)S
(the)126 3798 A
(data)168 3966 A
1890 V
(17606)210 648 A
1068(*)S
(segment,)336 1152 A
(followed)336 1530 A
1908(by)S
2034(a)S
(gap)126 2118 A
(\(unused)294 2286 A
(memory\),)336 2622 A
(followed)336 3000 A
3378(by)S
(the)126 3504 A
(stack)210 3672 A
(segment.)336 3924 A
1980 V
(17607)210 648 A
1068(*)S
(The)126 1152 A
(data)168 1320 A
(segment)294 1530 A
(grows)210 1866 A
(upward)252 2118 A
(and)126 2412 A
(the)126 2580 A
(stack)210 2748 A
(grows)210 3000 A
(downward,)378 3252 A
3672(so)S
(each)168 3798 A
(can)126 4008 A
2070 V
(17608)210 648 A
1068(*)S
(take)168 1152 A
(memory)252 1362 A
(from)168 1656 A
(the)126 1866 A
(gap.)168 2034 A
2286(If)S
(they)168 2412 A
(meet,)210 2622 A
(the)126 2874 A
(process)294 3042 A
(must)168 3378 A
3588(be)S
(killed.)294 3714 A
(The)126 4092 A
2160 V
(17609)210 648 A
1068(*)S
(procedures)420 1152 A
1614(in)S
(this)168 1740 A
(file)168 1950 A
(deal)168 2160 A
(with)168 2370 A
(the)126 2580 A
(growth)252 2748 A
3042(of)S
(the)126 3168 A
(data)168 3336 A
(and)126 3546 A
(stack)210 3714 A
(segments.)378 3966 A
2250 V
(17610)210 648 A
1068(*)S
2340 V
(17611)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are:)168 2496 A
2430 V
(17612)210 648 A
1068(*)S
(do_brk:)294 1236 A
(BRK/SBRK)336 1782 A
(system)252 2160 A
(calls)210 2454 A
2706(to)S
(grow)168 2832 A
3042(or)S
(shrink)252 3168 A
(the)126 3462 A
(data)168 3630 A
(segment)294 3840 A
2520 V
(17613)210 648 A
1068(*)S
(adjust:)294 1236 A
(see)126 1782 A
1950(if)S
2076(a)S
(proposed)336 2160 A
(segment)294 2538 A
(adjustment)420 2874 A
3336(is)S
(allowed)294 3462 A
2610 V
(17614)210 648 A
1068(*)S
(size_ok:)336 1236 A
(see)126 1782 A
1950(if)S
(the)126 2076 A
(segment)294 2244 A
(sizes)210 2580 A
(are)126 2832 A
(feasible)336 3000 A
2700 V
(17615)210 648 A
1068(*/)S
2790 V
(17616)210 648 A
2880 V
(17617)210 648 A
(#include)336 1026 A
("mm.h")252 1404 A
2970 V
(17618)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
3060 V
(17619)210 648 A
(#include)336 1026 A
("mproc.h")378 1404 A
3150 V
(17620)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
3240 V
(17621)210 648 A
3330 V
(17622)210 648 A
(#define)294 1026 A
(DATA_CHANGED)504 1362 A
2160(1)S
2370(/*)S
(flag)168 2496 A
(value)210 2706 A
(when)168 2958 A
(data)168 3168 A
(segment)294 3378 A
(size)168 3714 A
(changed)294 3924 A
4260(*/)S
3420 V
(17623)210 648 A
(#define)294 1026 A
(STACK_CHANGED)546 1362 A
2160(2)S
2370(/*)S
(flag)168 2496 A
(value)210 2706 A
(when)168 2958 A
(stack)210 3168 A
(size)168 3420 A
(changed)294 3630 A
3966(*/)S
3510 V
(17624)210 648 A
3600 V
(17625)210 648 A
(/*===========================================================================*)3276 1026 A
3690 V
(17626)210 648 A
1068(*)S
(do_brk)252 2370 A
4260(*)S
3780 V
(17627)210 648 A
(*===========================================================================*/)3276 1068 A
3870 V
(17628)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_brk\(\))336 1488 A
3960 V
(17629)210 648 A
1026({)S
4050 V
(17630)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(brk\(addr\))378 1656 A
(system)252 2076 A
(call.)210 2370 A
4140 V
(17631)210 648 A
1068(*)S
4230 V
(17632)210 648 A
1068(*)S
(The)126 1152 A
(call)168 1320 A
1530(is)S
(complicated)462 1656 A
2160(by)S
(the)126 2286 A
(fact)168 2454 A
(that)168 2664 A
2874(on)S
(some)168 3000 A
(machines)336 3210 A
(\(e.g.,)252 3588 A
(8088\),)252 3882 A
4320 V
(17633)210 648 A
1068(*)S
(the)126 1152 A
(stack)210 1320 A
(pointer)294 1572 A
(can)126 1908 A
(grow)168 2076 A
(beyond)252 2286 A
(the)126 2580 A
(base)168 2748 A
2958(of)S
(the)126 3084 A
(stack)210 3252 A
(segment)294 3504 A
(without)294 3840 A
4410 V
(17634)210 648 A
1068(*)S
(anybody)294 1152 A
(noticing)336 1488 A
(it.)126 1866 A
4500 V
(17635)210 648 A
1068(*)S
(The)126 1152 A
(parameter,)420 1320 A
('addr')252 1782 A
2076(is)S
(the)126 2202 A
(new)126 2370 A
(virtual)294 2538 A
(address)294 2874 A
3210(in)S
3336(D)S
(space.)252 3420 A
4590 V
(17636)210 648 A
1068(*/)S
4680 V
(17637)210 648 A
4770 V
(17638)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rmp;)210 2034 A
4860 V
(17639)210 648 A
(int)126 1110 A
1278(r;)S
4950 V
(17640)210 648 A
(vir_bytes)378 1110 A
1530(v,)S
(new_sp;)294 1656 A
5040 V
(17641)210 648 A
(vir_clicks)420 1110 A
(new_clicks;)462 1572 A
5130 V
(17642)210 648 A
5220 V
(17643)210 648 A
(rmp)126 1110 A
1278(=)S
(mp;)126 1362 A
5310 V
(17644)210 648 A
1110(v)S
1194(=)S
(\(vir_bytes\))462 1278 A
(addr;)210 1782 A
5400 V
(17645)210 648 A
(new_clicks)420 1110 A
1572(=)S
(\(vir_clicks\))504 1656 A
2202(\()S
(\(\(long\))294 2286 A
2622(v)S
2706(+)S
(CLICK_SIZE)420 2790 A
3252(-)S
3336(1\))S
3462(>>)S
(CLICK_SHIFT\);)546 3588 A
5490 V
(17646)210 648 A
1110(if)S
(\(new_clicks)462 1236 A
1740(<)S
(rmp->mp_seg[D].mem_vir\))966 1824 A
2832({)S
5580 V
(17647)210 648 A
(res_ptr)294 1362 A
1698(=)S
(\(char)210 1782 A
2034(*\))S
(-1;)126 2160 A
5670 V
(17648)210 648 A
(return\(ENOMEM\);)630 1362 A
5760 V
(17649)210 648 A
1110(})S
5850 V
(17650)210 648 A
(new_clicks)420 1110 A
1572(-=)S
(rmp->mp_seg[D].mem_vir;)966 1698 A
5940 V
(17651)210 648 A
(sys_getsp\(who,)588 1110 A
(&new_sp\);)378 1740 A
2370(/*)S
(ask)126 2496 A
(kernel)252 2664 A
(for)126 2958 A
(current)294 3126 A
3462(sp)S
(value)210 3588 A
3840(*/)S
6030 V
(17652)210 648 A
1110(r)S
1194(=)S
(adjust\(rmp,)462 1278 A
(new_clicks,)462 1782 A
(new_sp\);)336 2286 A
6120 V
(17653)210 648 A
(res_ptr)294 1110 A
1446(=)S
1530(\(r)S
1656(==)S
1782(OK)S
1908(?)S
(addr)168 1992 A
2202(:)S
(\(char)210 2286 A
2538(*\))S
(-1\);)168 2664 A
6210 V
(17654)210 648 A
(return\(r\);)420 1110 A
2370(/*)S
(return)252 2496 A
(new)126 2790 A
(address)294 2958 A
3294(or)S
3420(-1)S
3546(*/)S
8418 V
EP
%%Page: 245 245
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2077(File:)S
2310(src/mm/break.c)S
12 B
(245)180 4248 A
900 V
7 LST
(17655)210 648 A
1026(})S
1170 V
(17658)210 648 A
(/*===========================================================================*)3276 1026 A
1260 V
(17659)210 648 A
1068(*)S
(adjust)252 2370 A
4260(*)S
1350 V
(17660)210 648 A
(*===========================================================================*/)3276 1068 A
1440 V
(17661)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(adjust\(rmp,)462 1488 A
(data_clicks,)504 1992 A
(sp\))126 2538 A
1530 V
(17662)210 648 A
(register)336 1026 A
(struct)252 1404 A
(mproc)210 1698 A
(*rmp;)210 1950 A
2370(/*)S
(whose)210 2496 A
(memory)252 2748 A
3042(is)S
(being)210 3168 A
(adjusted?)378 3420 A
3840(*/)S
1620 V
(17663)210 648 A
(vir_clicks)420 1026 A
(data_clicks;)504 1488 A
2370(/*)S
(how)126 2496 A
(big)126 2664 A
2832(is)S
(data)168 2958 A
(segment)294 3168 A
3504(to)S
(become?)294 3630 A
3966(*/)S
1710 V
(17664)210 648 A
(vir_bytes)378 1026 A
(sp;)126 1446 A
2370(/*)S
(new)126 2496 A
(value)210 2664 A
2916(of)S
3042(sp)S
3168(*/)S
1800 V
(17665)210 648 A
1026({)S
1890 V
(17666)210 648 A
1026(/*)S
(See)126 1152 A
1320(if)S
(data)168 1446 A
(and)126 1656 A
(stack)210 1824 A
(segments)336 2076 A
(can)126 2454 A
(coexist,)336 2622 A
(adjusting)378 3000 A
(them)168 3420 A
3630(if)S
(need)168 3756 A
(be.)126 3966 A
1980 V
(17667)210 648 A
1068(*)S
(Memory)252 1152 A
1446(is)S
(never)210 1572 A
(allocated)378 1824 A
2244(or)S
(freed.)252 2370 A
(Instead)294 2706 A
3042(it)S
3168(is)S
(added)210 3294 A
3546(or)S
(removed)294 3672 A
(from)168 4008 A
(the)126 4218 A
2070 V
(17668)210 648 A
1068(*)S
(gap)126 1152 A
(between)294 1320 A
(data)168 1656 A
(segment)294 1866 A
(and)126 2202 A
(stack)210 2370 A
(segment.)336 2622 A
3042(If)S
(the)126 3168 A
(gap)126 3336 A
(size)168 3504 A
(becomes)294 3714 A
2160 V
(17669)210 648 A
1068(*)S
(negative,)378 1152 A
(the)126 1572 A
(adjustment)420 1740 A
2202(of)S
(data)168 2328 A
2538(or)S
(stack)210 2664 A
(fails)210 2916 A
(and)126 3168 A
(ENOMEM)252 3336 A
3630(is)S
(returned.)378 3756 A
2250 V
(17670)210 648 A
1068(*/)S
2340 V
(17671)210 648 A
2430 V
(17672)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mem_map)294 1782 A
(*mem_sp,)336 2118 A
(*mem_dp;)336 2496 A
2520 V
(17673)210 648 A
(vir_clicks)420 1110 A
(sp_click,)378 1572 A
(gap_base,)378 1992 A
(lower,)252 2412 A
(old_clicks;)462 2706 A
2610 V
(17674)210 648 A
(int)126 1110 A
(changed,)336 1278 A
1656(r,)S
(ft;)126 1782 A
2700 V
(17675)210 648 A
(long)168 1110 A
(base_of_stack,)588 1320 A
(delta;)252 1950 A
2370(/*)S
(longs)210 2496 A
(avoid)210 2748 A
(certain)294 3000 A
(problems)336 3336 A
3714(*/)S
2790 V
(17676)210 648 A
2880 V
(17677)210 648 A
(mem_dp)252 1110 A
1404(=)S
(&rmp->mp_seg[D];)672 1488 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(data)168 2958 A
(segment)294 3168 A
(map)126 3504 A
3672(*/)S
2970 V
(17678)210 648 A
(mem_sp)252 1110 A
1404(=)S
(&rmp->mp_seg[S];)672 1488 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(stack)210 2958 A
(segment)294 3210 A
(map)126 3546 A
3714(*/)S
3060 V
(17679)210 648 A
(changed)294 1110 A
1446(=)S
1530(0;)S
2370(/*)S
(set)126 2496 A
(when)168 2664 A
(either)252 2874 A
(segment)294 3168 A
(changed)294 3504 A
3840(*/)S
3150 V
(17680)210 648 A
3240 V
(17681)210 648 A
1110(if)S
(\(mem_sp->mem_len)672 1236 A
1950(==)S
2076(0\))S
(return\(OK\);)462 2202 A
2706(/*)S
(don't)210 2832 A
(bother)252 3084 A
(init)168 3378 A
3588(*/)S
3330 V
(17682)210 648 A
3420 V
(17683)210 648 A
1110(/*)S
(See)126 1236 A
1404(if)S
(stack)210 1530 A
(size)168 1782 A
(has)126 1992 A
(gone)168 2160 A
(negative)336 2370 A
(\(i.e.,)252 2748 A
3042(sp)S
(too)126 3168 A
(close)210 3336 A
3588(to)S
(0xFFFF...\))420 3714 A
4176(*/)S
3510 V
(17684)210 648 A
(base_of_stack)546 1110 A
1698(=)S
(\(long\))252 1782 A
(mem_sp->mem_vir)630 2076 A
2748(+)S
(\(long\))252 2832 A
(mem_sp->mem_len;)672 3126 A
3600 V
(17685)210 648 A
(sp_click)336 1110 A
1488(=)S
1572(sp)S
1698(>>)S
(CLICK_SHIFT;)504 1824 A
2370(/*)S
(click)210 2496 A
(containing)420 2748 A
3210(sp)S
3336(*/)S
3690 V
(17686)210 648 A
1110(if)S
(\(sp_click)378 1236 A
1656(>=)S
(base_of_stack\))588 1782 A
(return\(ENOMEM\);)630 2412 A
3378(/*)S
3504(sp)S
(too)126 3630 A
(high)168 3798 A
4008(*/)S
3780 V
(17687)210 648 A
3870 V
(17688)210 648 A
1110(/*)S
(Compute)294 1236 A
(size)168 1572 A
1782(of)S
(gap)126 1908 A
(between)294 2076 A
(stack)210 2412 A
(and)126 2664 A
(data)168 2832 A
(segments.)378 3042 A
3462(*/)S
3960 V
(17689)210 648 A
(delta)210 1110 A
1362(=)S
(\(long\))252 1446 A
(mem_sp->mem_vir)630 1740 A
2412(-)S
(\(long\))252 2496 A
(sp_click;)378 2790 A
4050 V
(17690)210 648 A
(lower)210 1110 A
1362(=)S
(\(delta)252 1446 A
1740(>)S
1824(0)S
1908(?)S
(sp_click)336 1992 A
2370(:)S
(mem_sp->mem_vir\);)714 2454 A
4140 V
(17691)210 648 A
4230 V
(17692)210 648 A
1110(/*)S
(Add)126 1236 A
1404(a)S
(safety)252 1488 A
(margin)252 1782 A
(for)126 2076 A
(future)252 2244 A
(stack)210 2538 A
(growth.)294 2790 A
(Impossible)420 3126 A
3588(to)S
3714(do)S
(right.)252 3840 A
4134(*/)S
4320 V
(17693)210 648 A
(#define)294 1026 A
(SAFETY_BYTES)504 1362 A
(\(384)168 1950 A
2160(*)S
(sizeof\(char)462 2244 A
(*\)\))126 2748 A
4410 V
(17694)210 648 A
(#define)294 1026 A
(SAFETY_CLICKS)546 1362 A
(\(\(SAFETY_BYTES)588 1950 A
2580(+)S
(CLICK_SIZE)420 2664 A
3126(-)S
3210(1\))S
3336(/)S
(CLICK_SIZE\))462 3420 A
4500 V
(17695)210 648 A
(gap_base)336 1110 A
1488(=)S
(mem_dp->mem_vir)630 1572 A
2244(+)S
(data_clicks)462 2328 A
2832(+)S
(SAFETY_CLICKS;)588 2916 A
4590 V
(17696)210 648 A
1110(if)S
(\(lower)252 1236 A
1530(<)S
(gap_base\))378 1614 A
(return\(ENOMEM\);)630 2034 A
2706(/*)S
(data)168 2832 A
(and)126 3042 A
(stack)210 3210 A
(collided)336 3462 A
3840(*/)S
4680 V
(17697)210 648 A
4770 V
(17698)210 648 A
1110(/*)S
(Update)252 1236 A
(data)168 1530 A
(length)252 1740 A
(\(but)168 2034 A
(not)126 2244 A
(data)168 2412 A
(orgin\))252 2622 A
2916(on)S
(behalf)252 3042 A
3336(of)S
(brk\(\))210 3462 A
(system)252 3714 A
(call.)210 4008 A
4260(*/)S
4860 V
(17699)210 648 A
(old_clicks)420 1110 A
1572(=)S
(mem_dp->mem_len;)672 1656 A
4950 V
(17700)210 648 A
1110(if)S
(\(data_clicks)504 1236 A
1782(!=)S
(mem_dp->mem_len\))672 1908 A
2622({)S
5040 V
(17701)210 648 A
(mem_dp->mem_len)630 1362 A
2034(=)S
(data_clicks;)504 2118 A
5130 V
(17702)210 648 A
(changed)294 1362 A
1698(|=)S
(DATA_CHANGED;)546 1824 A
5220 V
(17703)210 648 A
1110(})S
5310 V
(17704)210 648 A
5400 V
(17705)210 648 A
1110(/*)S
(Update)252 1236 A
(stack)210 1530 A
(length)252 1782 A
(and)126 2076 A
(origin)252 2244 A
(due)126 2538 A
2706(to)S
(change)252 2832 A
3126(in)S
(stack)210 3252 A
(pointer.)336 3504 A
3882(*/)S
5490 V
(17706)210 648 A
1110(if)S
(\(delta)252 1236 A
1530(>)S
1614(0\))S
1740({)S
5580 V
(17707)210 648 A
(mem_sp->mem_vir)630 1362 A
2034(-=)S
(delta;)252 2160 A
5670 V
(17708)210 648 A
(mem_sp->mem_phys)672 1362 A
2076(-=)S
(delta;)252 2202 A
5760 V
(17709)210 648 A
(mem_sp->mem_len)630 1362 A
2034(+=)S
(delta;)252 2160 A
5850 V
(17710)210 648 A
(changed)294 1362 A
1698(|=)S
(STACK_CHANGED;)588 1824 A
5940 V
(17711)210 648 A
1110(})S
6030 V
(17712)210 648 A
6120 V
(17713)210 648 A
1110(/*)S
1236(Do)S
(the)126 1362 A
(new)126 1530 A
(data)168 1698 A
(and)126 1908 A
(stack)210 2076 A
(segment)294 2328 A
(sizes)210 2664 A
(fit)126 2916 A
3084(in)S
(the)126 3210 A
(address)294 3378 A
(space?)252 3714 A
4008(*/)S
6210 V
(17714)210 648 A
1110(ft)S
1236(=)S
(\(rmp->mp_flags)588 1320 A
1950(&)S
(SEPARATE\);)420 2034 A
8418 V
EP
%%Page: 246 246
BP
/slant 0 def
/height 0 def
630 V
12 B
(246)180 648 A
11 R
2077(File:)S
2310(src/mm/break.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(17715)210 648 A
1110(r)S
1194(=)S
(size_ok\(ft,)462 1278 A
(rmp->mp_seg[T].mem_len,)966 1782 A
(rmp->mp_seg[D].mem_len,)966 2790 A
990 V
(17716)210 648 A
(rmp->mp_seg[S].mem_len,)966 1320 A
(rmp->mp_seg[D].mem_vir,)966 2328 A
(rmp->mp_seg[S].mem_vir\);)1008 3336 A
1080 V
(17717)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
1170 V
(17718)210 648 A
1362(if)S
(\(changed\))378 1488 A
(sys_newmap\(\(int\)\(rmp)840 1908 A
2790(-)S
(mproc\),)294 2874 A
(rmp->mp_seg\);)546 3210 A
1260 V
(17719)210 648 A
(return\(OK\);)462 1362 A
1350 V
(17720)210 648 A
1110(})S
1440 V
(17721)210 648 A
1530 V
(17722)210 648 A
1110(/*)S
(New)126 1236 A
(sizes)210 1404 A
(don't)210 1656 A
(fit)126 1908 A
2076(or)S
(require)294 2202 A
(too)126 2538 A
(many)168 2706 A
(page/segment)504 2916 A
(registers.)420 3462 A
(Restore.*/)420 3924 A
1620 V
(17723)210 648 A
1110(if)S
(\(changed)336 1236 A
1614(&)S
(DATA_CHANGED\))546 1698 A
(mem_dp->mem_len)630 2286 A
2958(=)S
(old_clicks;)462 3042 A
1710 V
(17724)210 648 A
1110(if)S
(\(changed)336 1236 A
1614(&)S
(STACK_CHANGED\))588 1698 A
2328({)S
1800 V
(17725)210 648 A
(mem_sp->mem_vir)630 1362 A
2034(+=)S
(delta;)252 2160 A
1890 V
(17726)210 648 A
(mem_sp->mem_phys)672 1362 A
2076(+=)S
(delta;)252 2202 A
1980 V
(17727)210 648 A
(mem_sp->mem_len)630 1362 A
2034(-=)S
(delta;)252 2160 A
2070 V
(17728)210 648 A
1110(})S
2160 V
(17729)210 648 A
(return\(ENOMEM\);)630 1110 A
2250 V
(17730)210 648 A
1026(})S
2520 V
(17733)210 648 A
(/*===========================================================================*)3276 1026 A
2610 V
(17734)210 648 A
1068(*)S
(size_ok)294 2370 A
4260(*)S
2700 V
(17735)210 648 A
(*===========================================================================*/)3276 1068 A
2790 V
(17736)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(size_ok\(file_type,)756 1488 A
(tc,)126 2286 A
(dc,)126 2454 A
(sc,)126 2622 A
(dvir,)210 2790 A
(s_vir\))252 3042 A
2880 V
(17737)210 648 A
(int)126 1026 A
(file_type;)420 1194 A
2370(/*)S
(SEPARATE)336 2496 A
2874(or)S
3000(0)S
3084(*/)S
2970 V
(17738)210 648 A
(vir_clicks)420 1026 A
(tc;)126 1488 A
2370(/*)S
(text)168 2496 A
(size)168 2706 A
2916(in)S
(clicks)252 3042 A
3336(*/)S
3060 V
(17739)210 648 A
(vir_clicks)420 1026 A
(dc;)126 1488 A
2370(/*)S
(data)168 2496 A
(size)168 2706 A
2916(in)S
(clicks)252 3042 A
3336(*/)S
3150 V
(17740)210 648 A
(vir_clicks)420 1026 A
(sc;)126 1488 A
2370(/*)S
(stack)210 2496 A
(size)168 2748 A
2958(in)S
(clicks)252 3084 A
3378(*/)S
3240 V
(17741)210 648 A
(vir_clicks)420 1026 A
(dvir;)210 1488 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
(for)126 3168 A
(start)210 3336 A
3588(of)S
(data)168 3714 A
(seg)126 3924 A
4092(*/)S
3330 V
(17742)210 648 A
(vir_clicks)420 1026 A
(s_vir;)252 1488 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
(for)126 3168 A
(start)210 3336 A
3588(of)S
(stack)210 3714 A
(seg)126 3966 A
4134(*/)S
3420 V
(17743)210 648 A
1026({)S
3510 V
(17744)210 648 A
1026(/*)S
(Check)210 1152 A
1404(to)S
(see)126 1530 A
1698(if)S
(the)126 1824 A
(sizes)210 1992 A
(are)126 2244 A
(feasible)336 2412 A
(and)126 2790 A
(enough)252 2958 A
(segmentation)504 3252 A
(registers)378 3798 A
3600 V
(17745)210 648 A
1068(*)S
(exist.)252 1152 A
1488(On)S
1614(a)S
(machine)294 1698 A
(with)168 2034 A
(eight)210 2244 A
2496(8K)S
(pages,)252 2622 A
(text,)210 2916 A
(data,)210 3168 A
(stack)210 3420 A
(sizes)210 3672 A
3924(of)S
3690 V
(17746)210 648 A
1068(*)S
(\(32K,)210 1152 A
(16K,)168 1404 A
(16K\))168 1614 A
(will)168 1824 A
(fit,)168 2034 A
(but)126 2244 A
(\(33K,)210 2412 A
(17K,)168 2664 A
(13K\))168 2874 A
(will)168 3084 A
(not,)168 3294 A
(even)168 3504 A
(though)252 3714 A
(the)126 4008 A
3780 V
(17747)210 648 A
1068(*)S
(former)252 1152 A
1446(is)S
(bigger)252 1572 A
(\(64K\))210 1866 A
(than)168 2118 A
(the)126 2328 A
(latter)252 2496 A
(\(63K\).)252 2790 A
(Even)168 3126 A
3336(on)S
(the)126 3462 A
(8088)168 3630 A
(this)168 3840 A
(test)168 4050 A
3870 V
(17748)210 648 A
1068(*)S
1152(is)S
(needed,)294 1278 A
(since)210 1614 A
(the)126 1866 A
(data)168 2034 A
(and)126 2244 A
(stack)210 2412 A
(may)126 2664 A
(not)126 2832 A
(exceed)252 3000 A
(4096)168 3294 A
(clicks.)294 3504 A
3960 V
(17749)210 648 A
1068(*/)S
4050 V
(17750)210 648 A
4140 V
(17751)210 648 A
(#if)126 1026 A
(\(CHIP)210 1194 A
1446(==)S
(INTEL)210 1572 A
1824(&&)S
(_WORD_SIZE)420 1950 A
2412(==)S
2538(2\))S
4230 V
(17752)210 648 A
(int)126 1110 A
(pt,)126 1278 A
(pd,)126 1446 A
(ps;)126 1614 A
2370(/*)S
(segment)294 2496 A
(sizes)210 2832 A
3084(in)S
(pages)210 3210 A
3462(*/)S
4320 V
(17753)210 648 A
4410 V
(17754)210 648 A
1110(pt)S
1236(=)S
1320(\()S
(\(tc)126 1404 A
1572(<<)S
(CLICK_SHIFT\))504 1698 A
2244(+)S
(PAGE_SIZE)378 2328 A
2748(-)S
(1\)/PAGE_SIZE;)546 2832 A
4500 V
(17755)210 648 A
1110(pd)S
1236(=)S
1320(\()S
(\(dc)126 1404 A
1572(<<)S
(CLICK_SHIFT\))504 1698 A
2244(+)S
(PAGE_SIZE)378 2328 A
2748(-)S
(1\)/PAGE_SIZE;)546 2832 A
4590 V
(17756)210 648 A
1110(ps)S
1236(=)S
1320(\()S
(\(sc)126 1404 A
1572(<<)S
(CLICK_SHIFT\))504 1698 A
2244(+)S
(PAGE_SIZE)378 2328 A
2748(-)S
(1\)/PAGE_SIZE;)546 2832 A
4680 V
(17757)210 648 A
4770 V
(17758)210 648 A
1110(if)S
(\(file_type)420 1236 A
1698(==)S
(SEPARATE\))378 1824 A
2244({)S
4860 V
(17759)210 648 A
1362(if)S
(\(pt)126 1488 A
1656(>)S
(MAX_PAGES)378 1740 A
2160(||)S
2286(pd)S
2412(+)S
2496(ps)S
2622(>)S
(MAX_PAGES\))420 2706 A
(return\(ENOMEM\);)630 3168 A
4950 V
(17760)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5040 V
(17761)210 648 A
1362(if)S
(\(pt)126 1488 A
1656(+)S
1740(pd)S
1866(+)S
1950(ps)S
2076(>)S
(MAX_PAGES\))420 2160 A
(return\(ENOMEM\);)630 2622 A
5130 V
(17762)210 648 A
1110(})S
5220 V
(17763)210 648 A
(#endif)252 1026 A
5310 V
(17764)210 648 A
5400 V
(17765)210 648 A
1110(if)S
(\(dvir)210 1236 A
1488(+)S
1572(dc)S
1698(>)S
(s_vir\))252 1782 A
(return\(ENOMEM\);)630 2076 A
5490 V
(17766)210 648 A
5580 V
(17767)210 648 A
(return\(OK\);)462 1110 A
5670 V
(17768)210 648 A
1026(})S
8418 V
EP
%%Page: 247 247
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2068(File:)S
2301(src/mm/signal.c)S
12 B
(247)180 4248 A
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/mm/signal.c)630 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(17800)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(handles)294 1572 A
(signals,)336 1908 A
(which)210 2286 A
(are)126 2538 A
(asynchronous)504 2706 A
(events)252 3252 A
(and)126 3546 A
(are)126 3714 A
(generally)378 3882 A
1440 V
(17801)210 648 A
1068(*)S
1152(a)S
(messy)210 1236 A
(and)126 1488 A
(unpleasant)420 1656 A
(business.)378 2118 A
(Signals)294 2580 A
(can)126 2916 A
3084(be)S
(generated)378 3210 A
3630(by)S
(the)126 3756 A
(KILL)168 3924 A
1530 V
(17802)210 648 A
1068(*)S
(system)252 1152 A
(call,)210 1446 A
1698(or)S
(from)168 1824 A
(the)126 2034 A
(keyboard)336 2202 A
(\(SIGINT\))336 2580 A
2958(or)S
(from)168 3084 A
(the)126 3294 A
(clock)210 3462 A
(\(SIGALRM\).)420 3714 A
1620 V
(17803)210 648 A
1068(*)S
1152(In)S
(all)126 1278 A
(cases)210 1446 A
(control)294 1698 A
(eventually)420 2034 A
(passes)252 2496 A
2790(to)S
(check_sig\(\))462 2916 A
3420(to)S
(see)126 3546 A
(which)210 3714 A
(processes)378 3966 A
1710 V
(17804)210 648 A
1068(*)S
(can)126 1152 A
1320(be)S
(signaled.)378 1446 A
(The)126 1908 A
(actual)252 2076 A
(signaling)378 2370 A
2790(is)S
(done)168 2916 A
3126(by)S
(sig_proc\(\).)462 3252 A
1800 V
(17805)210 648 A
1068(*)S
1890 V
(17806)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are:)168 2496 A
1980 V
(17807)210 648 A
1068(*)S
(do_sigaction:)546 1236 A
(perform)294 1908 A
(the)126 2244 A
(SIGACTION)378 2412 A
(system)252 2832 A
(call)168 3126 A
2070 V
(17808)210 648 A
1068(*)S
(do_sigpending:)588 1236 A
(perform)294 1908 A
(the)126 2244 A
(SIGPENDING)420 2412 A
(system)252 2874 A
(call)168 3168 A
2160 V
(17809)210 648 A
1068(*)S
(do_sigprocmask:)630 1236 A
(perform)294 1908 A
(the)126 2244 A
(SIGPROCMASK)462 2412 A
(system)252 2916 A
(call)168 3210 A
2250 V
(17810)210 648 A
1068(*)S
(do_sigreturn:)546 1236 A
(perform)294 1908 A
(the)126 2244 A
(SIGRETURN)378 2412 A
(system)252 2832 A
(call)168 3126 A
2340 V
(17811)210 648 A
1068(*)S
(do_sigsuspend:)588 1236 A
(perform)294 1908 A
(the)126 2244 A
(SIGSUSPEND)420 2412 A
(system)252 2874 A
(call)168 3168 A
2430 V
(17812)210 648 A
1068(*)S
(do_kill:)336 1236 A
(perform)294 1698 A
(the)126 2034 A
(KILL)168 2202 A
(system)252 2412 A
(call)168 2706 A
2520 V
(17813)210 648 A
1068(*)S
(do_ksig:)336 1236 A
(accept)252 1698 A
1992(a)S
(signal)252 2076 A
(originating)462 2370 A
2874(in)S
(the)126 3000 A
(kernel)252 3168 A
(\(e.g.,)252 3462 A
(SIGINT\))294 3756 A
2610 V
(17814)210 648 A
1068(*)S
(do_alarm:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(ALARM)210 2202 A
(system)252 2454 A
(call)168 2748 A
2958(by)S
(calling)294 3084 A
(set_alarm\(\))462 3420 A
2700 V
(17815)210 648 A
1068(*)S
(set_alarm:)420 1236 A
(tell)168 1698 A
(the)126 1908 A
(clock)210 2076 A
(task)168 2328 A
2538(to)S
(start)210 2664 A
2916(or)S
(stop)168 3042 A
3252(a)S
(timer)210 3336 A
2790 V
(17816)210 648 A
1068(*)S
(do_pause:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(PAUSE)210 2202 A
(system)252 2454 A
(call)168 2748 A
2880 V
(17817)210 648 A
1068(*)S
(do_reboot:)420 1236 A
(kill)168 1698 A
(all)126 1908 A
(processes,)420 2076 A
(then)168 2538 A
(reboot)252 2748 A
(system)252 3042 A
2970 V
(17818)210 648 A
1068(*)S
(sig_proc:)378 1236 A
(interrupt)378 1698 A
2118(or)S
(terminate)378 2244 A
2664(a)S
(signaled)336 2748 A
(process)294 3126 A
3060 V
(17819)210 648 A
1068(*)S
(check_sig:)420 1236 A
(check)210 1698 A
(which)210 1950 A
(processes)378 2202 A
2622(to)S
(signal)252 2748 A
(with)168 3042 A
(sig_proc\(\))420 3252 A
3150 V
(17820)210 648 A
1068(*/)S
3240 V
(17821)210 648 A
3330 V
(17822)210 648 A
(#include)336 1026 A
("mm.h")252 1404 A
3420 V
(17823)210 648 A
(#include)336 1026 A
(<sys/stat.h>)504 1404 A
3510 V
(17824)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
3600 V
(17825)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
3690 V
(17826)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
3780 V
(17827)210 648 A
(#include)336 1026 A
(<sys/sigcontext.h>)756 1404 A
3870 V
(17828)210 648 A
(#include)336 1026 A
(<string.h>)420 1404 A
3960 V
(17829)210 648 A
(#include)336 1026 A
("mproc.h")378 1404 A
4050 V
(17830)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
4140 V
(17831)210 648 A
4230 V
(17832)210 648 A
(#define)294 1026 A
(CORE_MODE)378 1362 A
(0777)168 2034 A
2370(/*)S
(mode)168 2496 A
2706(to)S
(use)126 2832 A
3000(on)S
(core)168 3126 A
(image)210 3336 A
(files)210 3588 A
3840(*/)S
4320 V
(17833)210 648 A
(#define)294 1026 A
(DUMPED)252 1362 A
(0200)168 2034 A
2370(/*)S
(bit)126 2496 A
(set)126 2664 A
2832(in)S
(status)252 2958 A
(when)168 3252 A
(core)168 3462 A
(dumped)252 3672 A
3966(*/)S
4410 V
(17834)210 648 A
(#define)294 1026 A
(DUMP_SIZE)378 1362 A
(\(\(INT_MAX)378 2034 A
2454(/)S
(BLOCK_SIZE\))462 2538 A
3042(*)S
(BLOCK_SIZE\))462 3126 A
4500 V
(17835)210 648 A
2370(/*)S
(buffer)252 2496 A
(size)168 2790 A
(for)126 3000 A
(core)168 3168 A
(dumps)210 3378 A
3630(*/)S
4590 V
(17836)210 648 A
4680 V
(17837)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(check_pending,)588 2076 A
(\(void\))252 2706 A
4050(\);)S
4770 V
(17838)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(dump_core,)420 2076 A
(\(struct)294 2538 A
(mproc)210 2874 A
(*rmp\))210 3126 A
4050(\);)S
4860 V
(17839)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(unpause,)336 2076 A
(\(int)168 2454 A
(pro\))168 2664 A
4050(\);)S
4950 V
(17840)210 648 A
5040 V
(17841)210 648 A
5130 V
(17842)210 648 A
(/*===========================================================================*)3276 1026 A
5220 V
(17843)210 648 A
1068(*)S
(do_sigaction)504 2328 A
4260(*)S
5310 V
(17844)210 648 A
(*===========================================================================*/)3276 1068 A
5400 V
(17845)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_sigaction\(\))588 1488 A
5490 V
(17846)210 648 A
1026({)S
5580 V
(17847)210 648 A
(int)126 1110 A
1278(r;)S
5670 V
(17848)210 648 A
(struct)252 1110 A
(sigaction)378 1404 A
(svec;)210 1824 A
5760 V
(17849)210 648 A
(struct)252 1110 A
(sigaction)378 1404 A
(*svp;)210 1824 A
5850 V
(17850)210 648 A
5940 V
(17851)210 648 A
1110(if)S
(\(sig_nr)294 1236 A
1572(==)S
(SIGKILL\))336 1698 A
(return\(OK\);)462 2076 A
6030 V
(17852)210 648 A
1110(if)S
(\(sig_nr)294 1236 A
1572(<)S
1656(1)S
1740(||)S
(sig_nr)252 1866 A
2160(>)S
(_NSIG\))252 2244 A
(return)252 2538 A
(\(EINVAL\);)378 2832 A
6120 V
(17853)210 648 A
(svp)126 1110 A
1278(=)S
(&mp->mp_sigact[sig_nr];)966 1362 A
6210 V
(17854)210 648 A
1110(if)S
(\(\(struct)336 1236 A
(sigaction)378 1614 A
2034(*\))S
(sig_osa)294 2160 A
2496(!=)S
(\(struct)294 2622 A
(sigaction)378 2958 A
3378(*\))S
(NULL\))210 3504 A
3756({)S
8418 V
EP
%%Page: 248 248
BP
/slant 0 def
/height 0 def
630 V
12 B
(248)180 648 A
11 R
2068(File:)S
2301(src/mm/signal.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(17855)210 648 A
1362(r)S
1446(=)S
(sys_copy\(MM_PROC_NR,D,)924 1530 A
(\(phys_bytes\))504 2496 A
(svp,)168 3042 A
990 V
(17856)210 648 A
(who,)168 1698 A
1908(D,)S
(\(phys_bytes\))504 2034 A
(sig_osa,)336 2580 A
(\(phys_bytes\))504 2958 A
(sizeof\(svec\)\);)588 3504 A
1080 V
(17857)210 648 A
1362(if)S
1488(\(r)S
1614(!=)S
(OK\))126 1740 A
(return\(r\);)420 1908 A
1170 V
(17858)210 648 A
1110(})S
1260 V
(17859)210 648 A
1350 V
(17860)210 648 A
1110(if)S
(\(\(struct)336 1236 A
(sigaction)378 1614 A
2034(*\))S
(sig_nsa)294 2160 A
2496(==)S
(\(struct)294 2622 A
(sigaction)378 2958 A
3378(*\))S
(NULL\))210 3504 A
(return\(OK\);)462 3756 A
1440 V
(17861)210 648 A
1530 V
(17862)210 648 A
1110(/*)S
(Read)168 1236 A
1446(in)S
(the)126 1572 A
(sigaction)378 1740 A
(structure.)420 2160 A
2622(*/)S
1620 V
(17863)210 648 A
1110(r)S
1194(=)S
(sys_copy\(who,)546 1278 A
1866(D,)S
(\(phys_bytes\))504 1992 A
(sig_nsa,)336 2538 A
1710 V
(17864)210 648 A
(MM_PROC_NR,)462 1698 A
2202(D,)S
(\(phys_bytes\))504 2328 A
(&svec,)252 2874 A
(\(phys_bytes\))504 3168 A
(sizeof\(svec\)\);)588 3714 A
1800 V
(17865)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
(return\(r\);)420 1656 A
1890 V
(17866)210 648 A
1980 V
(17867)210 648 A
1110(if)S
(\(svec.sa_handler)672 1236 A
1950(==)S
(SIG_IGN\))336 2076 A
2454({)S
2070 V
(17868)210 648 A
(sigaddset\(&mp->mp_ignore,)1050 1362 A
(sig_nr\);)336 2454 A
2160 V
(17869)210 648 A
(sigdelset\(&mp->mp_sigpending,)1218 1362 A
(sig_nr\);)336 2622 A
2250 V
(17870)210 648 A
(sigdelset\(&mp->mp_catch,)1008 1362 A
(sig_nr\);)336 2412 A
2340 V
(17871)210 648 A
1110(})S
(else)168 1194 A
1404({)S
2430 V
(17872)210 648 A
(sigdelset\(&mp->mp_ignore,)1050 1362 A
(sig_nr\);)336 2454 A
2520 V
(17873)210 648 A
1362(if)S
(\(svec.sa_handler)672 1488 A
2202(==)S
(SIG_DFL\))336 2328 A
2610 V
(17874)210 648 A
(sigdelset\(&mp->mp_catch,)1008 1698 A
(sig_nr\);)336 2748 A
2700 V
(17875)210 648 A
(else)168 1362 A
2790 V
(17876)210 648 A
(sigaddset\(&mp->mp_catch,)1008 1698 A
(sig_nr\);)336 2748 A
2880 V
(17877)210 648 A
1110(})S
2970 V
(17878)210 648 A
(mp->mp_sigact[sig_nr].sa_handler)1344 1110 A
2496(=)S
(svec.sa_handler;)672 2580 A
3060 V
(17879)210 648 A
(sigdelset\(&svec.sa_mask,)1008 1110 A
(SIGKILL\);)378 2160 A
3150 V
(17880)210 648 A
(mp->mp_sigact[sig_nr].sa_mask)1218 1110 A
2370(=)S
(svec.sa_mask;)546 2454 A
3240 V
(17881)210 648 A
(mp->mp_sigact[sig_nr].sa_flags)1260 1110 A
2412(=)S
(svec.sa_flags;)588 2496 A
3330 V
(17882)210 648 A
(mp->mp_sigreturn)672 1110 A
1824(=)S
(\(vir_bytes\))462 1908 A
(sig_ret;)336 2412 A
3420 V
(17883)210 648 A
(return\(OK\);)462 1110 A
3510 V
(17884)210 648 A
1026(})S
3690 V
(17886)210 648 A
(/*===========================================================================*)3276 1026 A
3780 V
(17887)210 648 A
1068(*)S
(do_sigpending)546 2286 A
4260(*)S
3870 V
(17888)210 648 A
(*===========================================================================*/)3276 1068 A
3960 V
(17889)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_sigpending\(\))630 1488 A
4050 V
(17890)210 648 A
1026({)S
4140 V
(17891)210 648 A
(ret_mask)336 1110 A
1488(=)S
(\(long\))252 1572 A
(mp->mp_sigpending;)756 1866 A
4230 V
(17892)210 648 A
(return)252 1110 A
(OK;)126 1404 A
4320 V
(17893)210 648 A
1026(})S
4500 V
(17895)210 648 A
(/*===========================================================================*)3276 1026 A
4590 V
(17896)210 648 A
1068(*)S
(do_sigprocmask)588 2286 A
4260(*)S
4680 V
(17897)210 648 A
(*===========================================================================*/)3276 1068 A
4770 V
(17898)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_sigprocmask\(\))672 1488 A
4860 V
(17899)210 648 A
1026({)S
4950 V
(17900)210 648 A
1026(/*)S
(Note)168 1152 A
(that)168 1362 A
(the)126 1572 A
(library)294 1740 A
(interface)378 2076 A
(passes)252 2496 A
(the)126 2790 A
(actual)252 2958 A
(mask)168 3252 A
3462(in)S
(sigmask_set,)504 3588 A
5040 V
(17901)210 648 A
1068(*)S
(not)126 1152 A
1320(a)S
(pointer)294 1404 A
1740(to)S
(the)126 1866 A
(mask,)210 2034 A
2286(in)S
(order)210 2412 A
2664(to)S
(save)168 2790 A
3000(a)S
(sys_copy.)378 3084 A
(Similarly,)420 3546 A
5130 V
(17902)210 648 A
1068(*)S
(the)126 1152 A
(old)126 1320 A
(mask)168 1488 A
1698(is)S
(placed)252 1824 A
2118(in)S
(the)126 2244 A
(return)252 2412 A
(message)294 2706 A
(which)210 3042 A
(the)126 3294 A
(library)294 3462 A
5220 V
(17903)210 648 A
1068(*)S
(interface)378 1152 A
(copies)252 1572 A
(\(if)126 1866 A
(requested\))420 2034 A
2496(to)S
(the)126 2622 A
(user)168 2790 A
(specified)378 3000 A
(address.)336 3420 A
5310 V
(17904)210 648 A
1068(*)S
5400 V
(17905)210 648 A
1068(*)S
(The)126 1152 A
(library)294 1320 A
(interface)378 1656 A
(must)168 2076 A
(set)126 2286 A
(SIG_INQUIRE)462 2454 A
2958(if)S
(the)126 3084 A
('act')210 3252 A
(argument)336 3504 A
5490 V
(17906)210 648 A
1068(*)S
1152(is)S
(NULL.)210 1278 A
5580 V
(17907)210 648 A
1068(*/)S
5670 V
(17908)210 648 A
5760 V
(17909)210 648 A
(int)126 1110 A
1278(i;)S
5850 V
(17910)210 648 A
5940 V
(17911)210 648 A
(ret_mask)336 1110 A
1488(=)S
(\(long\))252 1572 A
(mp->mp_sigmask;)630 1866 A
6030 V
(17912)210 648 A
6120 V
(17913)210 648 A
(switch)252 1110 A
(\(sig_how\))378 1404 A
1824({)S
6210 V
(17914)210 648 A
(case)168 1278 A
(SIG_BLOCK:)420 1488 A
8418 V
EP
%%Page: 249 249
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2068(File:)S
2301(src/mm/signal.c)S
12 B
(249)180 4248 A
900 V
7 LST
(17915)210 648 A
(sigdelset\(\(sigset_t)798 1362 A
(*\)&sig_set,)462 2202 A
(SIGKILL\);)378 2706 A
990 V
(17916)210 648 A
(for)126 1362 A
1530(\(i)S
1656(=)S
1740(1;)S
1866(i)S
1950(<)S
(_NSIG;)252 2034 A
(i++\))168 2328 A
2538({)S
1080 V
(17917)210 648 A
1698(if)S
(\(sigismember\(\(sigset_t)924 1824 A
(*\)&sig_set,)462 2790 A
(i\)\))126 3294 A
1170 V
(17918)210 648 A
(sigaddset\(&mp->mp_sigmask,)1092 2034 A
(i\);)126 3168 A
1260 V
(17919)210 648 A
1362(})S
1350 V
(17920)210 648 A
(break;)252 1362 A
1440 V
(17921)210 648 A
1530 V
(17922)210 648 A
(case)168 1278 A
(SIG_UNBLOCK:)504 1488 A
1620 V
(17923)210 648 A
(for)126 1362 A
1530(\(i)S
1656(=)S
1740(1;)S
1866(i)S
1950(<)S
(_NSIG;)252 2034 A
(i++\))168 2328 A
2538({)S
1710 V
(17924)210 648 A
1698(if)S
(\(sigismember\(\(sigset_t)924 1824 A
(*\)&sig_set,)462 2790 A
(i\)\))126 3294 A
1800 V
(17925)210 648 A
(sigdelset\(&mp->mp_sigmask,)1092 2034 A
(i\);)126 3168 A
1890 V
(17926)210 648 A
1362(})S
1980 V
(17927)210 648 A
(check_pending\(\);)672 1362 A
2070 V
(17928)210 648 A
(break;)252 1362 A
2160 V
(17929)210 648 A
2250 V
(17930)210 648 A
(case)168 1278 A
(SIG_SETMASK:)504 1488 A
2340 V
(17931)210 648 A
(sigdelset\(\(sigset_t)798 1362 A
(*\)&sig_set,)462 2202 A
(SIGKILL\);)378 2706 A
2430 V
(17932)210 648 A
(mp->mp_sigmask)588 1362 A
1992(=)S
(\(sigset_t\)sig_set;)756 2076 A
2520 V
(17933)210 648 A
(check_pending\(\);)672 1362 A
2610 V
(17934)210 648 A
(break;)252 1362 A
2700 V
(17935)210 648 A
2790 V
(17936)210 648 A
(case)168 1278 A
(SIG_INQUIRE:)504 1488 A
2880 V
(17937)210 648 A
(break;)252 1362 A
2970 V
(17938)210 648 A
3060 V
(17939)210 648 A
(default:)336 1278 A
3150 V
(17940)210 648 A
(return\(EINVAL\);)630 1362 A
3240 V
(17941)210 648 A
(break;)252 1362 A
3330 V
(17942)210 648 A
1110(})S
3420 V
(17943)210 648 A
(return)252 1110 A
(OK;)126 1404 A
3510 V
(17944)210 648 A
1026(})S
3690 V
(17946)210 648 A
(/*===========================================================================*)3276 1026 A
3780 V
(17947)210 648 A
1068(*)S
(do_sigsuspend)546 2286 A
4260(*)S
3870 V
(17948)210 648 A
(*===========================================================================*/)3276 1068 A
3960 V
(17949)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_sigsuspend\(\))630 1488 A
4050 V
(17950)210 648 A
1026({)S
4140 V
(17951)210 648 A
(mp->mp_sigmask2)630 1110 A
1782(=)S
(mp->mp_sigmask;)630 1866 A
2706(/*)S
(save)168 2832 A
(the)126 3042 A
(old)126 3210 A
(mask)168 3378 A
3588(*/)S
4230 V
(17952)210 648 A
(mp->mp_sigmask)588 1110 A
1740(=)S
(\(sigset_t\))420 1824 A
(sig_set;)336 2286 A
4320 V
(17953)210 648 A
(sigdelset\(&mp->mp_sigmask,)1092 1110 A
(SIGKILL\);)378 2244 A
4410 V
(17954)210 648 A
(mp->mp_flags)504 1110 A
1656(|=)S
(SIGSUSPENDED;)546 1782 A
4500 V
(17955)210 648 A
(dont_reply)420 1110 A
1572(=)S
(TRUE;)210 1656 A
4590 V
(17956)210 648 A
(check_pending\(\);)672 1110 A
4680 V
(17957)210 648 A
(return)252 1110 A
(OK;)126 1404 A
4770 V
(17958)210 648 A
1026(})S
5040 V
(17961)210 648 A
(/*===========================================================================*)3276 1026 A
5130 V
(17962)210 648 A
1068(*)S
(do_sigreturn)504 2412 A
4260(*)S
5220 V
(17963)210 648 A
(*===========================================================================*/)3276 1068 A
5310 V
(17964)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_sigreturn\(\))588 1488 A
5400 V
(17965)210 648 A
1026({)S
5490 V
(17966)210 648 A
1026(/*)S
1152(A)S
(user)168 1236 A
(signal)252 1446 A
(handler)294 1740 A
2076(is)S
(done.)210 2202 A
(Restore)294 2496 A
(context)294 2832 A
(and)126 3168 A
(check)210 3336 A
(for)126 3588 A
5580 V
(17967)210 648 A
1068(*)S
(pending)294 1152 A
(unblocked)378 1488 A
(signals.)336 1908 A
5670 V
(17968)210 648 A
1068(*/)S
5760 V
(17969)210 648 A
5850 V
(17970)210 648 A
(int)126 1110 A
1278(r;)S
5940 V
(17971)210 648 A
6030 V
(17972)210 648 A
(mp->mp_sigmask)588 1110 A
1740(=)S
(\(sigset_t\))420 1824 A
(sig_set;)336 2286 A
6120 V
(17973)210 648 A
(sigdelset\(&mp->mp_sigmask,)1092 1110 A
(SIGKILL\);)378 2244 A
6210 V
(17974)210 648 A
8418 V
EP
%%Page: 250 250
BP
/slant 0 def
/height 0 def
630 V
12 B
(250)180 648 A
11 R
2068(File:)S
2301(src/mm/signal.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(17975)210 648 A
1110(r)S
1194(=)S
(sys_sigreturn\(who,)756 1278 A
(\(vir_bytes\)sig_context,)966 2076 A
(sig_flags\);)462 3084 A
990 V
(17976)210 648 A
(check_pending\(\);)672 1110 A
1080 V
(17977)210 648 A
(return\(r\);)420 1110 A
1170 V
(17978)210 648 A
1026(})S
1350 V
(17980)210 648 A
(/*===========================================================================*)3276 1026 A
1440 V
(17981)210 648 A
1068(*)S
(do_kill)294 2370 A
4260(*)S
1530 V
(17982)210 648 A
(*===========================================================================*/)3276 1068 A
1620 V
(17983)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_kill\(\))378 1488 A
1710 V
(17984)210 648 A
1026({)S
1800 V
(17985)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(kill\(pid,)378 1656 A
(signo\))252 2076 A
(system)252 2370 A
(call.)210 2664 A
2916(*/)S
1890 V
(17986)210 648 A
1980 V
(17987)210 648 A
(return)252 1110 A
(check_sig\(pid,)588 1404 A
(sig_nr\);)336 2034 A
2070 V
(17988)210 648 A
1026(})S
2340 V
(17991)210 648 A
(/*===========================================================================*)3276 1026 A
2430 V
(17992)210 648 A
1068(*)S
(do_ksig)294 2370 A
4260(*)S
2520 V
(17993)210 648 A
(*===========================================================================*/)3276 1068 A
2610 V
(17994)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_ksig\(\))378 1488 A
2700 V
(17995)210 648 A
1026({)S
2790 V
(17996)210 648 A
1026(/*)S
(Certain)294 1152 A
(signals,)336 1488 A
(such)168 1866 A
2076(as)S
(segmentation)504 2202 A
(violations)420 2748 A
(and)126 3210 A
(DEL,)168 3378 A
(originate)378 3588 A
4008(in)S
(the)126 4134 A
2880 V
(17997)210 648 A
1068(*)S
(kernel.)294 1152 A
(When)168 1530 A
(the)126 1740 A
(kernel)252 1908 A
(detects)294 2202 A
(such)168 2538 A
(signals,)336 2748 A
3126(it)S
(sets)168 3252 A
(bits)168 3462 A
3672(in)S
3798(a)S
(bit)126 3882 A
(map.)168 4050 A
2970 V
(17998)210 648 A
1068(*)S
1152(As)S
(soon)168 1278 A
1488(as)S
1614(MM)S
1740(is)S
(awaiting)336 1866 A
(new)126 2244 A
(work,)210 2412 A
(the)126 2664 A
(kernel)252 2832 A
(sends)210 3126 A
3378(MM)S
3504(a)S
(message)294 3588 A
(containing)420 3924 A
3060 V
(17999)210 648 A
1068(*)S
(the)126 1152 A
(process)294 1320 A
(slot)168 1656 A
(and)126 1866 A
(bit)126 2034 A
(map.)168 2202 A
(That)168 2454 A
(message)294 2664 A
(comes)210 3000 A
(here.)210 3252 A
(The)126 3546 A
(File)168 3714 A
(System)252 3924 A
3150 V
(18000)210 648 A
1068(*)S
(also)168 1152 A
(uses)168 1362 A
(this)168 1572 A
(mechanism)378 1782 A
2202(to)S
(signal)252 2328 A
(writing)294 2622 A
2958(on)S
(broken)252 3084 A
(pipes)210 3378 A
(\(SIGPIPE\).)420 3630 A
3240 V
(18001)210 648 A
1068(*/)S
3330 V
(18002)210 648 A
3420 V
(18003)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rmp;)210 2034 A
3510 V
(18004)210 648 A
(int)126 1110 A
1278(i,)S
(proc_nr;)336 1404 A
3600 V
(18005)210 648 A
(pid_t)210 1110 A
(proc_id,)336 1362 A
(id;)126 1740 A
3690 V
(18006)210 648 A
(sigset_t)336 1110 A
(sig_map;)336 1488 A
3780 V
(18007)210 648 A
3870 V
(18008)210 648 A
1110(/*)S
(Only)168 1236 A
(kernel)252 1446 A
(may)126 1740 A
(make)168 1908 A
(this)168 2118 A
(call.)210 2328 A
2580(*/)S
3960 V
(18009)210 648 A
1110(if)S
(\(who)168 1236 A
1446(!=)S
(HARDWARE\))378 1572 A
(return\(EPERM\);)588 1992 A
4050 V
(18010)210 648 A
(dont_reply)420 1110 A
1572(=)S
(TRUE;)210 1656 A
2370(/*)S
(don't)210 2496 A
(reply)210 2748 A
3000(to)S
(the)126 3126 A
(kernel)252 3294 A
3588(*/)S
4140 V
(18011)210 648 A
(proc_nr)294 1110 A
1446(=)S
(mm_in.SIG_PROC;)630 1530 A
4230 V
(18012)210 648 A
(rmp)126 1110 A
1278(=)S
(&mproc[proc_nr];)672 1362 A
4320 V
(18013)210 648 A
1110(if)S
1236(\()S
(\(rmp->mp_flags)588 1320 A
1950(&)S
(IN_USE\))294 2034 A
2370(==)S
2496(0)S
2580(||)S
(\(rmp->mp_flags)588 2706 A
3336(&)S
(HANGING\))336 3420 A
3798(\))S
(return\(OK\);)462 3882 A
4410 V
(18014)210 648 A
(proc_id)294 1110 A
1446(=)S
(rmp->mp_pid;)504 1530 A
4500 V
(18015)210 648 A
(sig_map)294 1110 A
1446(=)S
(\(sigset_t\))420 1530 A
(mm_in.SIG_MAP;)588 1992 A
4590 V
(18016)210 648 A
1110(mp)S
1236(=)S
(&mproc[0];)420 1320 A
2370(/*)S
(pretend)294 2496 A
(kernel)252 2832 A
(signals)294 3126 A
(are)126 3462 A
(from)168 3630 A
3840(MM)S
3966(*/)S
4680 V
(18017)210 648 A
(mp->mp_procgrp)588 1110 A
1740(=)S
(rmp->mp_procgrp;)672 1824 A
2706(/*)S
(get)126 2832 A
(process)294 3000 A
(group)210 3336 A
(right)210 3588 A
3840(*/)S
4770 V
(18018)210 648 A
4860 V
(18019)210 648 A
1110(/*)S
(Check)210 1236 A
(each)168 1488 A
(bit)126 1698 A
1866(in)S
(turn)168 1992 A
2202(to)S
(see)126 2328 A
2496(if)S
2622(a)S
(signal)252 2706 A
3000(is)S
3126(to)S
3252(be)S
(sent.)210 3378 A
(Unlike)252 3672 A
4950 V
(18020)210 648 A
1152(*)S
(kill\(\),)294 1236 A
(the)126 1572 A
(kernel)252 1740 A
(may)126 2034 A
(collect)294 2202 A
(several)294 2538 A
(unrelated)378 2874 A
(signals)294 3294 A
(for)126 3630 A
3798(a)S
5040 V
(18021)210 648 A
1152(*)S
(process)294 1236 A
(and)126 1572 A
(pass)168 1740 A
(them)168 1950 A
2160(to)S
2286(MM)S
2412(in)S
(one)126 2538 A
(blow.)210 2706 A
(Thus)168 3000 A
(loop)168 3210 A
3420(on)S
(the)126 3546 A
(bit)126 3714 A
5130 V
(18022)210 648 A
1152(*)S
(map.)168 1236 A
(For)126 1446 A
(SIGINT)252 1614 A
(and)126 1908 A
(SIGQUIT,)336 2076 A
(use)126 2454 A
(proc_id)294 2622 A
2958(0)S
3042(to)S
(indicate)336 3168 A
3546(a)S
(broadcast)378 3630 A
5220 V
(18023)210 648 A
1152(*)S
1236(to)S
(the)126 1362 A
(recipient's)462 1530 A
(process)294 2034 A
(group.)252 2370 A
(For)126 2706 A
(SIGKILL,)336 2874 A
(use)126 3252 A
(proc_id)294 3420 A
3756(-1)S
3882(to)S
5310 V
(18024)210 648 A
1152(*)S
(indicate)336 1236 A
1614(a)S
(systemwide)420 1698 A
(broadcast.)420 2160 A
5400 V
(18025)210 648 A
1152(*/)S
5490 V
(18026)210 648 A
(for)126 1110 A
1278(\(i)S
1404(=)S
1488(1;)S
1614(i)S
1698(<=)S
(_NSIG;)252 1824 A
(i++\))168 2118 A
2328({)S
5580 V
(18027)210 648 A
1362(if)S
(\(!sigismember\(&sig_map,)966 1488 A
(i\)\))126 2496 A
(continue;)378 2664 A
5670 V
(18028)210 648 A
(switch)252 1362 A
(\(i\))126 1656 A
1824({)S
5760 V
(18029)210 648 A
(case)168 1530 A
(SIGINT:)294 1740 A
5850 V
(18030)210 648 A
(case)168 1530 A
(SIGQUIT:)336 1740 A
5940 V
(18031)210 648 A
1698(id)S
1824(=)S
1908(0;)S
(break;)252 2034 A
2370(/*)S
(broadcast)378 2496 A
2916(to)S
(process)294 3042 A
(group)210 3378 A
3630(*/)S
6030 V
(18032)210 648 A
(case)168 1530 A
(SIGKILL:)336 1740 A
6120 V
(18033)210 648 A
1698(id)S
1824(=)S
(-1;)126 1908 A
(break;)252 2076 A
2370(/*)S
(broadcast)378 2496 A
2916(to)S
(all)126 3042 A
(except)252 3210 A
(INIT)168 3504 A
3714(*/)S
6210 V
(18034)210 648 A
(case)168 1530 A
(SIGALRM:)336 1740 A
8418 V
EP
%%Page: 251 251
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2068(File:)S
2301(src/mm/signal.c)S
12 B
(251)180 4248 A
900 V
7 LST
(18035)210 648 A
1698(/*)S
(Disregard)378 1824 A
(SIGALRM)294 2244 A
(when)168 2580 A
(the)126 2790 A
(target)252 2958 A
(process)294 3252 A
(has)126 3588 A
(not)126 3756 A
990 V
(18036)210 648 A
1740(*)S
(requested)378 1824 A
2244(an)S
(alarm.)252 2370 A
(This)168 2706 A
(only)168 2916 A
(applies)294 3126 A
(for)126 3462 A
3630(a)S
(KERNEL)252 3714 A
1080 V
(18037)210 648 A
1740(*)S
(generated)378 1824 A
(signal.)294 2244 A
1170 V
(18038)210 648 A
1740(*/)S
1260 V
(18039)210 648 A
1698(if)S
(\(\(rmp->mp_flags)630 1824 A
2496(&)S
(ALARM_ON\))378 2580 A
3000(==)S
3126(0\))S
(continue;)378 3252 A
1350 V
(18040)210 648 A
(rmp->mp_flags)546 1698 A
2286(&=)S
(\304ALARM_ON;)420 2412 A
1440 V
(18041)210 648 A
1698(/*)S
(fall)168 1824 A
(through)294 2034 A
2370(*/)S
1530 V
(18042)210 648 A
(default:)336 1530 A
1620 V
(18043)210 648 A
1698(id)S
1824(=)S
(proc_id;)336 1908 A
1710 V
(18044)210 648 A
(break;)252 1698 A
1800 V
(18045)210 648 A
1362(})S
1890 V
(18046)210 648 A
(check_sig\(id,)546 1362 A
(i\);)126 1950 A
1980 V
(18047)210 648 A
(sys_endsig\(proc_nr\);)840 1362 A
2370(/*)S
(tell)168 2496 A
(kernel)252 2706 A
(it's)168 3000 A
(done)168 3210 A
3420(*/)S
2070 V
(18048)210 648 A
1110(})S
2160 V
(18049)210 648 A
(return\(OK\);)462 1110 A
2250 V
(18050)210 648 A
1026(})S
2520 V
(18053)210 648 A
(/*===========================================================================*)3276 1026 A
2610 V
(18054)210 648 A
1068(*)S
(do_alarm)336 2370 A
4260(*)S
2700 V
(18055)210 648 A
(*===========================================================================*/)3276 1068 A
2790 V
(18056)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_alarm\(\))420 1488 A
2880 V
(18057)210 648 A
1026({)S
2970 V
(18058)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(alarm\(seconds\))588 1656 A
(system)252 2286 A
(call.)210 2580 A
2832(*/)S
3060 V
(18059)210 648 A
3150 V
(18060)210 648 A
(return\(set_alarm\(who,)882 1110 A
(seconds\)\);)420 2034 A
3240 V
(18061)210 648 A
1026(})S
3510 V
(18064)210 648 A
(/*===========================================================================*)3276 1026 A
3600 V
(18065)210 648 A
1068(*)S
(set_alarm)378 2370 A
4260(*)S
3690 V
(18066)210 648 A
(*===========================================================================*/)3276 1068 A
3780 V
(18067)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(set_alarm\(proc_nr,)756 1488 A
(sec\))168 2286 A
3870 V
(18068)210 648 A
(int)126 1026 A
(proc_nr;)336 1194 A
2370(/*)S
(process)294 2496 A
(that)168 2832 A
(wants)210 3042 A
(the)126 3294 A
(alarm)210 3462 A
3714(*/)S
3960 V
(18069)210 648 A
(int)126 1026 A
(sec;)168 1194 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(seconds)294 2874 A
(delay)210 3210 A
(before)252 3462 A
(the)126 3756 A
(signal)252 3924 A
4218(*/)S
4050 V
(18070)210 648 A
1026({)S
4140 V
(18071)210 648 A
1026(/*)S
(This)168 1152 A
(routine)294 1362 A
1698(is)S
(used)168 1824 A
2034(by)S
(do_alarm\(\))420 2160 A
2622(to)S
(set)126 2748 A
(the)126 2916 A
(alarm)210 3084 A
(timer.)252 3336 A
3672(It)S
3798(is)S
(also)168 3924 A
(used)168 4134 A
4230 V
(18072)210 648 A
1068(*)S
1152(to)S
(turn)168 1278 A
(the)126 1488 A
(timer)210 1656 A
(off)126 1908 A
(when)168 2076 A
2286(a)S
(process)294 2370 A
(exits)210 2706 A
(with)168 2958 A
(the)126 3168 A
(timer)210 3336 A
(still)210 3588 A
(on.)126 3840 A
4320 V
(18073)210 648 A
1068(*/)S
4410 V
(18074)210 648 A
4500 V
(18075)210 648 A
(message)294 1110 A
(m_sig;)252 1446 A
4590 V
(18076)210 648 A
(int)126 1110 A
(remaining;)420 1278 A
4680 V
(18077)210 648 A
4770 V
(18078)210 648 A
1110(if)S
(\(sec)168 1236 A
1446(!=)S
1572(0\))S
4860 V
(18079)210 648 A
(mproc[proc_nr].mp_flags)966 1362 A
2370(|=)S
(ALARM_ON;)378 2496 A
4950 V
(18080)210 648 A
(else)168 1110 A
5040 V
(18081)210 648 A
(mproc[proc_nr].mp_flags)966 1362 A
2370(&=)S
(\304ALARM_ON;)420 2496 A
5130 V
(18082)210 648 A
5220 V
(18083)210 648 A
1110(/*)S
(Tell)168 1236 A
(the)126 1446 A
(clock)210 1614 A
(task)168 1866 A
2076(to)S
(provide)294 2202 A
2538(a)S
(signal)252 2622 A
(message)294 2916 A
(when)168 3252 A
(the)126 3462 A
(time)168 3630 A
(comes.)252 3840 A
5310 V
(18084)210 648 A
1152(*)S
5400 V
(18085)210 648 A
1152(*)S
(Large)210 1236 A
(delays)252 1488 A
(cause)210 1782 A
2034(a)S
(lot)126 2118 A
2286(of)S
(problems.)378 2412 A
(First,)252 2874 A
(the)126 3168 A
(alarm)210 3336 A
(system)252 3588 A
(call)168 3882 A
5490 V
(18086)210 648 A
1152(*)S
(takes)210 1236 A
1488(an)S
(unsigned)336 1614 A
(seconds)294 1992 A
(count)210 2328 A
(and)126 2580 A
(the)126 2748 A
(library)294 2916 A
(has)126 3252 A
(cast)168 3420 A
3630(it)S
3756(to)S
3882(an)S
(int.)168 4008 A
5580 V
(18087)210 648 A
1152(*)S
(That)168 1236 A
(probably)336 1446 A
(works,)252 1824 A
(but)126 2118 A
2286(on)S
(return)252 2412 A
(the)126 2706 A
(library)294 2874 A
(will)168 3210 A
(convert)294 3420 A
("negative")420 3756 A
5670 V
(18088)210 648 A
1152(*)S
(unsigneds)378 1236 A
1656(to)S
(errors.)294 1782 A
(Presumably)420 2160 A
2622(no)S
(one)126 2748 A
(checks)252 2916 A
(for)126 3210 A
(these)210 3378 A
(errors,)294 3630 A
3966(so)S
5760 V
(18089)210 648 A
1152(*)S
(force)210 1236 A
(this)168 1488 A
(call)168 1698 A
(through.)336 1908 A
(Second,)294 2328 A
2664(If)S
(unsigned)336 2790 A
(and)126 3168 A
(long)168 3336 A
(have)168 3546 A
(the)126 3756 A
(same)168 3924 A
5850 V
(18090)210 648 A
1152(*)S
(size,)210 1236 A
(converting)420 1488 A
(from)168 1950 A
(seconds)294 2160 A
2496(to)S
(ticks)210 2622 A
(can)126 2874 A
(easily)252 3042 A
(overflow.)378 3336 A
(Finally,)336 3798 A
5940 V
(18091)210 648 A
1152(*)S
(the)126 1236 A
(kernel)252 1404 A
(has)126 1698 A
(similar)294 1866 A
(overflow)336 2202 A
(bugs)168 2580 A
(adding)252 2790 A
(ticks.)252 3084 A
6030 V
(18092)210 648 A
1152(*)S
6120 V
(18093)210 648 A
1152(*)S
(Fixing)252 1236 A
(this)168 1530 A
(requires)336 1740 A
2118(a)S
(lot)126 2202 A
2370(of)S
(ugly)168 2496 A
(casts)210 2706 A
2958(to)S
(fit)126 3084 A
(the)126 3252 A
(wrong)210 3420 A
(interface)378 3672 A
6210 V
(18094)210 648 A
1152(*)S
(types)210 1236 A
(and)126 1488 A
1656(to)S
(avoid)210 1782 A
(overflow)336 2034 A
(traps.)252 2412 A
(DELTA_TICKS)462 2748 A
(has)126 3252 A
(the)126 3420 A
(right)210 3588 A
(type)168 3840 A
8418 V
EP
%%Page: 252 252
BP
/slant 0 def
/height 0 def
630 V
12 B
(252)180 648 A
11 R
2068(File:)S
2301(src/mm/signal.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(18095)210 648 A
1152(*)S
(\(clock_t\))378 1236 A
(although)336 1656 A
2034(it)S
2160(is)S
(declared)336 2286 A
2664(as)S
(long.)210 2790 A
(How)126 3084 A
(can)126 3252 A
(variables)378 3420 A
(like)168 3840 A
990 V
(18096)210 648 A
1152(*)S
(this)168 1236 A
1446(be)S
(declared)336 1572 A
(properly)336 1950 A
(without)294 2328 A
(combinatorial)546 2664 A
(explosion)378 3252 A
3672(of)S
(message)294 3798 A
1080 V
(18097)210 648 A
1152(*)S
(types?)252 1236 A
1170 V
(18098)210 648 A
1152(*/)S
1260 V
(18099)210 648 A
(m_sig.m_type)504 1110 A
1656(=)S
(SET_ALARM;)420 1740 A
1350 V
(18100)210 648 A
(m_sig.CLOCK_PROC_NR)798 1110 A
1950(=)S
(proc_nr;)336 2034 A
1440 V
(18101)210 648 A
(m_sig.DELTA_TICKS)714 1110 A
1866(=)S
(\(clock_t\))378 1950 A
(\(HZ)126 2370 A
2538(*)S
(\(unsigned)378 2622 A
(long\))210 3042 A
(\(unsigned\))420 3294 A
(sec\);)210 3756 A
1530 V
(18102)210 648 A
1110(if)S
1236(\()S
(\(unsigned)378 1320 A
(long\))210 1740 A
(m_sig.DELTA_TICKS)714 1992 A
2748(/)S
2832(HZ)S
2958(!=)S
(\(unsigned\))420 3084 A
(sec\))168 3546 A
1620 V
(18103)210 648 A
(m_sig.DELTA_TICKS)714 1362 A
2118(=)S
(LONG_MAX;)378 2202 A
2706(/*)S
(eternity)336 2832 A
(\(really)294 3210 A
(CLOCK_T_MAX\))504 3546 A
4092(*/)S
1710 V
(18104)210 648 A
1110(if)S
(\(sendrec\(CLOCK,)630 1236 A
(&m_sig\))294 1908 A
2244(!=)S
(OK\))126 2370 A
(panic\("alarm)504 2538 A
(er",)168 3084 A
(NO_NUM\);)336 3294 A
1800 V
(18105)210 648 A
(remaining)378 1110 A
1530(=)S
(\(int\))210 1614 A
(m_sig.SECONDS_LEFT;)798 1866 A
1890 V
(18106)210 648 A
1110(if)S
(\(remaining)420 1236 A
1698(!=)S
(m_sig.SECONDS_LEFT)756 1824 A
2622(||)S
(remaining)378 2748 A
3168(<)S
3252(0\))S
1980 V
(18107)210 648 A
(remaining)378 1362 A
1782(=)S
(INT_MAX;)336 1866 A
2370(/*)S
(true)168 2496 A
(value)210 2706 A
2958(is)S
(not)126 3084 A
(representable)546 3252 A
3840(*/)S
2070 V
(18108)210 648 A
(return\(remaining\);)756 1110 A
2160 V
(18109)210 648 A
1026(})S
2430 V
(18112)210 648 A
(/*===========================================================================*)3276 1026 A
2520 V
(18113)210 648 A
1068(*)S
(do_pause)336 2370 A
4260(*)S
2610 V
(18114)210 648 A
(*===========================================================================*/)3276 1068 A
2700 V
(18115)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_pause\(\))420 1488 A
2790 V
(18116)210 648 A
1026({)S
2880 V
(18117)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(pause\(\))294 1656 A
(system)252 1992 A
(call.)210 2286 A
2538(*/)S
2970 V
(18118)210 648 A
3060 V
(18119)210 648 A
(mp->mp_flags)504 1110 A
1656(|=)S
(PAUSED;)294 1782 A
3150 V
(18120)210 648 A
(dont_reply)420 1110 A
1572(=)S
(TRUE;)210 1656 A
3240 V
(18121)210 648 A
(return\(OK\);)462 1110 A
3330 V
(18122)210 648 A
1026(})S
3600 V
(18125)210 648 A
(/*=====================================================================*)3024 1026 A
3690 V
(18126)210 648 A
1068(*)S
(do_reboot)378 2202 A
4008(*)S
3780 V
(18127)210 648 A
(*=====================================================================*/)3024 1068 A
3870 V
(18128)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_reboot\(\))462 1488 A
3960 V
(18129)210 648 A
1026({)S
4050 V
(18130)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rmp)168 2034 A
2244(=)S
(mp;)126 2328 A
4140 V
(18131)210 648 A
(char)168 1110 A
(monitor_code[64];)714 1320 A
4230 V
(18132)210 648 A
4320 V
(18133)210 648 A
1110(if)S
(\(rmp->mp_effuid)630 1236 A
1908(!=)S
(SUPER_USER\))462 2034 A
(return)252 2622 A
(EPERM;)252 2916 A
4410 V
(18134)210 648 A
4500 V
(18135)210 648 A
(switch)252 1110 A
(\(reboot_flag\))546 1404 A
1992({)S
4590 V
(18136)210 648 A
(case)168 1110 A
(RBT_HALT:)378 1320 A
4680 V
(18137)210 648 A
(case)168 1110 A
(RBT_REBOOT:)462 1320 A
4770 V
(18138)210 648 A
(case)168 1110 A
(RBT_PANIC:)420 1320 A
4860 V
(18139)210 648 A
(case)168 1110 A
(RBT_RESET:)420 1320 A
4950 V
(18140)210 648 A
(break;)252 1362 A
5040 V
(18141)210 648 A
(case)168 1110 A
(RBT_MONITOR:)504 1320 A
5130 V
(18142)210 648 A
1362(if)S
(\(reboot_size)504 1488 A
2034(>)S
(sizeof\(monitor_code\)\))882 2118 A
(return)252 3042 A
(EINVAL;)294 3336 A
5220 V
(18143)210 648 A
(memset\(monitor_code,)840 1362 A
2244(0,)S
(sizeof\(monitor_code\)\);)924 2370 A
5310 V
(18144)210 648 A
1362(if)S
(\(sys_copy\(who,)588 1488 A
2118(D,)S
(\(phys_bytes\))504 2244 A
(reboot_code,)504 2790 A
5400 V
(18145)210 648 A
(MM_PROC_NR,)462 1698 A
2202(D,)S
(\(phys_bytes\))504 2328 A
(monitor_code,)546 2874 A
5490 V
(18146)210 648 A
(\(phys_bytes\))504 1698 A
(reboot_size\))504 2244 A
2790(!=)S
(OK\))126 2916 A
(return)252 3084 A
(EFAULT;)294 3378 A
5580 V
(18147)210 648 A
1362(if)S
(\(monitor_code[sizeof\(monitor_code\)-1])1554 1488 A
3084(!=)S
3210(0\))S
(return)252 3336 A
(EINVAL;)294 3630 A
5670 V
(18148)210 648 A
(break;)252 1362 A
5760 V
(18149)210 648 A
(default:)336 1110 A
5850 V
(18150)210 648 A
(return)252 1362 A
(EINVAL;)294 1656 A
5940 V
(18151)210 648 A
1110(})S
6030 V
(18152)210 648 A
6120 V
(18153)210 648 A
1110(/*)S
(Kill)168 1236 A
(all)126 1446 A
(processes)378 1614 A
(except)252 2034 A
(init.)210 2328 A
2580(*/)S
6210 V
(18154)210 648 A
(check_sig\(-1,)546 1110 A
(SIGKILL\);)378 1698 A
8418 V
EP
%%Page: 253 253
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2068(File:)S
2301(src/mm/signal.c)S
12 B
(253)180 4248 A
900 V
7 LST
(18155)210 648 A
990 V
(18156)210 648 A
(tell_fs\(EXIT,)546 1110 A
(INIT_PROC_NR,)546 1698 A
2286(0,)S
(0\);)126 2412 A
2706(/*)S
(cleanup)294 2832 A
(init)168 3168 A
3378(*/)S
1080 V
(18157)210 648 A
1170 V
(18158)210 648 A
(tell_fs\(SYNC,0,0,0\);)840 1110 A
1260 V
(18159)210 648 A
1350 V
(18160)210 648 A
(sys_abort\(reboot_flag,)924 1110 A
(monitor_code\);)588 2076 A
1440 V
(18161)210 648 A
1110(/*)S
(NOTREACHED)420 1236 A
1698(*/)S
1530 V
(18162)210 648 A
1026(})S
1800 V
(18165)210 648 A
(/*===========================================================================*)3276 1026 A
1890 V
(18166)210 648 A
1068(*)S
(sig_proc)336 2370 A
4260(*)S
1980 V
(18167)210 648 A
(*===========================================================================*/)3276 1068 A
2070 V
(18168)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(sig_proc\(rmp,)546 1530 A
(signo\))252 2118 A
2160 V
(18169)210 648 A
(register)336 1026 A
(struct)252 1404 A
(mproc)210 1698 A
(*rmp;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(the)126 2958 A
(process)294 3126 A
3462(to)S
3588(be)S
(signaled)336 3714 A
4092(*/)S
2250 V
(18170)210 648 A
(int)126 1026 A
(signo;)252 1194 A
2370(/*)S
(signal)252 2496 A
2790(to)S
(send)168 2916 A
3126(to)S
(process)294 3252 A
3588(\(1)S
3714(to)S
(_NSIG\))252 3840 A
4134(*/)S
2340 V
(18171)210 648 A
1026({)S
2430 V
(18172)210 648 A
1026(/*)S
(Send)168 1152 A
1362(a)S
(signal)252 1446 A
1740(to)S
1866(a)S
(process.)336 1950 A
(Check)210 2370 A
2622(to)S
(see)126 2748 A
2916(if)S
(the)126 3042 A
(signal)252 3210 A
3504(is)S
3630(to)S
3756(be)S
(caught,)294 3882 A
2520 V
(18173)210 648 A
1068(*)S
(ignored,)336 1152 A
1530(or)S
(blocked.)336 1656 A
2076(If)S
(the)126 2202 A
(signal)252 2370 A
2664(is)S
2790(to)S
2916(be)S
(caught,)294 3042 A
(coordinate)420 3378 A
(with)168 3840 A
2610 V
(18174)210 648 A
1068(*)S
(KERNEL)252 1152 A
1446(to)S
(push)168 1572 A
1782(a)S
(sigcontext)420 1866 A
(structure)378 2328 A
(and)126 2748 A
2916(a)S
(sigframe)336 3000 A
(structure)378 3378 A
(onto)168 3798 A
2700 V
(18175)210 648 A
1068(*)S
(the)126 1152 A
(catcher's)378 1320 A
(stack.)252 1740 A
(Also,)210 2076 A
(KERNEL)252 2328 A
(will)168 2622 A
(reset)210 2832 A
(the)126 3084 A
(program)294 3252 A
(counter)294 3588 A
(and)126 3924 A
2790 V
(18176)210 648 A
1068(*)S
(stack)210 1152 A
(pointer,)336 1404 A
1782(so)S
(that)168 1908 A
(when)168 2118 A
(the)126 2328 A
(process)294 2496 A
(next)168 2832 A
(runs,)210 3042 A
3294(it)S
(will)168 3420 A
3630(be)S
(executing)378 3756 A
2880 V
(18177)210 648 A
1068(*)S
(the)126 1152 A
(signal)252 1320 A
(handler.)336 1614 A
(When)168 2034 A
(the)126 2244 A
(signal)252 2412 A
(handler)294 2706 A
(returns,)336 3042 A
(sigreturn\(2\))504 3462 A
2970 V
(18178)210 648 A
1068(*)S
(will)168 1152 A
1362(be)S
(called.)294 1488 A
(Then)168 1866 A
(KERNEL)252 2076 A
(will)168 2370 A
(restore)294 2580 A
(the)126 2916 A
(signal)252 3084 A
(context)294 3378 A
(from)168 3714 A
(the)126 3924 A
3060 V
(18179)210 648 A
1068(*)S
(sigcontext)420 1152 A
(structure.)420 1614 A
3150 V
(18180)210 648 A
1068(*)S
3240 V
(18181)210 648 A
1068(*)S
1152(If)S
(there)210 1278 A
1530(is)S
(insufficient)504 1656 A
(stack)210 2202 A
(space,)252 2454 A
(kill)168 2748 A
(the)126 2958 A
(process.)336 3126 A
3330 V
(18182)210 648 A
1068(*/)S
3420 V
(18183)210 648 A
3510 V
(18184)210 648 A
(vir_bytes)378 1110 A
(new_sp;)294 1530 A
3600 V
(18185)210 648 A
(int)126 1110 A
(slot;)210 1278 A
3690 V
(18186)210 648 A
(int)126 1110 A
(sigflags;)378 1278 A
3780 V
(18187)210 648 A
(struct)252 1110 A
(sigmsg)252 1404 A
(sm;)126 1698 A
3870 V
(18188)210 648 A
3960 V
(18189)210 648 A
(slot)168 1110 A
1320(=)S
(\(int\))210 1404 A
(\(rmp)168 1656 A
1866(-)S
(mproc\);)294 1950 A
4050 V
(18190)210 648 A
1110(if)S
(\(!\(rmp->mp_flags)672 1236 A
1950(&)S
(IN_USE\)\))336 2034 A
2412({)S
4140 V
(18191)210 648 A
(printf\("MM:)462 1362 A
(signal)252 1866 A
2160(%d)S
(sent)168 2286 A
2496(to)S
(dead)168 2622 A
(process)294 2832 A
(%d\\n",)252 3168 A
(signo,)252 3462 A
(slot\);)252 3756 A
4230 V
(18192)210 648 A
(panic\("",)378 1362 A
(NO_NUM\);)336 1782 A
4320 V
(18193)210 648 A
1110(})S
4410 V
(18194)210 648 A
1110(if)S
(\(rmp->mp_flags)588 1236 A
1866(&)S
(HANGING\))336 1950 A
2328({)S
4500 V
(18195)210 648 A
(printf\("MM:)462 1362 A
(signal)252 1866 A
2160(%d)S
(sent)168 2286 A
2496(to)S
(HANGING)294 2622 A
(process)294 2958 A
(%d\\n",)252 3294 A
(signo,)252 3588 A
(slot\);)252 3882 A
4590 V
(18196)210 648 A
(panic\("",)378 1362 A
(NO_NUM\);)336 1782 A
4680 V
(18197)210 648 A
1110(})S
4770 V
(18198)210 648 A
1110(if)S
(\(rmp->mp_flags)588 1236 A
1866(&)S
(TRACED)252 1950 A
2244(&&)S
(signo)210 2370 A
2622(!=)S
(SIGKILL\))336 2748 A
3126({)S
4860 V
(18199)210 648 A
1362(/*)S
1488(A)S
(traced)252 1572 A
(process)294 1866 A
(has)126 2202 A
(special)294 2370 A
(handling.)378 2706 A
3126(*/)S
4950 V
(18200)210 648 A
(unpause\(slot\);)588 1362 A
5040 V
(18201)210 648 A
(stop_proc\(rmp,)588 1362 A
(signo\);)294 1992 A
2370(/*)S
2496(a)S
(signal)252 2580 A
(causes)252 2874 A
3168(it)S
3294(to)S
(stop)168 3420 A
3630(*/)S
5130 V
(18202)210 648 A
(return;)294 1362 A
5220 V
(18203)210 648 A
1110(})S
5310 V
(18204)210 648 A
1110(/*)S
(Some)168 1236 A
(signals)294 1446 A
(are)126 1782 A
(ignored)294 1950 A
2286(by)S
(default.)336 2412 A
2790(*/)S
5400 V
(18205)210 648 A
1110(if)S
(\(sigismember\(&rmp->mp_ignore,)1218 1236 A
(signo\)\))294 2496 A
(return;)294 2832 A
5490 V
(18206)210 648 A
5580 V
(18207)210 648 A
1110(if)S
(\(sigismember\(&rmp->mp_sigmask,)1260 1236 A
(signo\)\))294 2538 A
2874({)S
5670 V
(18208)210 648 A
1362(/*)S
(Signal)252 1488 A
(should)252 1782 A
2076(be)S
(blocked.)336 2202 A
2580(*/)S
5760 V
(18209)210 648 A
(sigaddset\(&rmp->mp_sigpending,)1260 1362 A
(signo\);)294 2664 A
5850 V
(18210)210 648 A
(return;)294 1362 A
5940 V
(18211)210 648 A
1110(})S
6030 V
(18212)210 648 A
(sigflags)336 1110 A
1488(=)S
(rmp->mp_sigact[signo].sa_flags;)1302 1572 A
6120 V
(18213)210 648 A
1110(if)S
(\(sigismember\(&rmp->mp_catch,)1176 1236 A
(signo\)\))294 2454 A
2790({)S
6210 V
(18214)210 648 A
1362(if)S
(\(rmp->mp_flags)588 1488 A
2118(&)S
(SIGSUSPENDED\))546 2202 A
8418 V
EP
%%Page: 254 254
BP
/slant 0 def
/height 0 def
630 V
12 B
(254)180 648 A
11 R
2068(File:)S
2301(src/mm/signal.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(18215)210 648 A
(sm.sm_mask)420 1698 A
2160(=)S
(rmp->mp_sigmask2;)714 2244 A
990 V
(18216)210 648 A
(else)168 1362 A
1080 V
(18217)210 648 A
(sm.sm_mask)420 1698 A
2160(=)S
(rmp->mp_sigmask;)672 2244 A
1170 V
(18218)210 648 A
(sm.sm_signo)462 1362 A
1866(=)S
(signo;)252 1950 A
1260 V
(18219)210 648 A
(sm.sm_sighandler)672 1362 A
2076(=)S
(\(vir_bytes\))462 2160 A
(rmp->mp_sigact[signo].sa_handler;)1386 2664 A
1350 V
(18220)210 648 A
(sm.sm_sigreturn)630 1362 A
2034(=)S
(rmp->mp_sigreturn;)756 2118 A
1440 V
(18221)210 648 A
(sys_getsp\(slot,)630 1362 A
(&new_sp\);)378 2034 A
1530 V
(18222)210 648 A
(sm.sm_stkptr)504 1362 A
1908(=)S
(new_sp;)294 1992 A
1620 V
(18223)210 648 A
1710 V
(18224)210 648 A
1362(/*)S
(Make)168 1488 A
(room)168 1698 A
(for)126 1908 A
(the)126 2076 A
(sigcontext)420 2244 A
(and)126 2706 A
(sigframe)336 2874 A
(struct.)294 3252 A
3588(*/)S
1800 V
(18225)210 648 A
(new_sp)252 1362 A
1656(-=)S
(sizeof\(struct)546 1782 A
(sigcontext\))462 2370 A
1890 V
(18226)210 648 A
2412(+)S
2496(3)S
2580(*)S
(sizeof\(char)462 2664 A
3168(*\))S
3294(+)S
3378(2)S
3462(*)S
(sizeof\(int\);)504 3546 A
1980 V
(18227)210 648 A
2070 V
(18228)210 648 A
1362(if)S
(\(adjust\(rmp,)504 1488 A
(rmp->mp_seg[D].mem_len,)966 2034 A
(new_sp\))294 3042 A
3378(!=)S
(OK\))126 3504 A
2160 V
(18229)210 648 A
(goto)168 1698 A
(doterminate;)504 1908 A
2250 V
(18230)210 648 A
2340 V
(18231)210 648 A
(rmp->mp_sigmask)630 1362 A
2034(|=)S
(rmp->mp_sigact[signo].sa_mask;)1260 2160 A
2430 V
(18232)210 648 A
1362(if)S
(\(sigflags)378 1488 A
1908(&)S
(SA_NODEFER\))462 1992 A
2520 V
(18233)210 648 A
(sigdelset\(&rmp->mp_sigmask,)1134 1698 A
(signo\);)294 2874 A
2610 V
(18234)210 648 A
(else)168 1362 A
2700 V
(18235)210 648 A
(sigaddset\(&rmp->mp_sigmask,)1134 1698 A
(signo\);)294 2874 A
2790 V
(18236)210 648 A
2880 V
(18237)210 648 A
1362(if)S
(\(sigflags)378 1488 A
1908(&)S
(SA_RESETHAND\))546 1992 A
2580({)S
2970 V
(18238)210 648 A
(sigdelset\(&rmp->mp_catch,)1050 1698 A
(signo\);)294 2790 A
3060 V
(18239)210 648 A
(rmp->mp_sigact[signo].sa_handler)1344 1698 A
3084(=)S
(SIG_DFL;)336 3168 A
3150 V
(18240)210 648 A
1362(})S
3240 V
(18241)210 648 A
3330 V
(18242)210 648 A
(sys_sendsig\(slot,)714 1362 A
(&sm\);)210 2118 A
3420 V
(18243)210 648 A
(sigdelset\(&rmp->mp_sigpending,)1260 1362 A
(signo\);)294 2664 A
3510 V
(18244)210 648 A
1362(/*)S
1488(If)S
(process)294 1614 A
1950(is)S
(hanging)294 2076 A
2412(on)S
(PAUSE,)252 2538 A
(WAIT,)210 2832 A
(SIGSUSPEND,)462 3084 A
(tty,)168 3588 A
(pipe,)210 3798 A
(etc.,)210 4050 A
3600 V
(18245)210 648 A
1404(*)S
(release)294 1488 A
(it.)126 1824 A
3690 V
(18246)210 648 A
1404(*/)S
3780 V
(18247)210 648 A
(unpause\(slot\);)588 1362 A
3870 V
(18248)210 648 A
(return;)294 1362 A
3960 V
(18249)210 648 A
1110(})S
4050 V
(18250)210 648 A
(doterminate:)504 1026 A
4140 V
(18251)210 648 A
1110(/*)S
(Signal)252 1236 A
(should)252 1530 A
(not)126 1824 A
1992(or)S
(cannot)252 2118 A
2412(be)S
(caught.)294 2538 A
(Terminate)378 2916 A
(the)126 3336 A
(process.)336 3504 A
3882(*/)S
4230 V
(18252)210 648 A
(rmp->mp_sigstatus)714 1110 A
1866(=)S
(\(char\))252 1950 A
(signo;)252 2244 A
4320 V
(18253)210 648 A
1110(if)S
(\(sigismember\(&core_sset,)1008 1236 A
(signo\)\))294 2286 A
2622({)S
4410 V
(18254)210 648 A
1362(/*)S
(Switch)252 1488 A
1782(to)S
(the)126 1908 A
(user's)252 2076 A
2370(FS)S
(environment)462 2496 A
(and)126 3000 A
(dump)168 3168 A
(core.)210 3378 A
3630(*/)S
4500 V
(18255)210 648 A
(tell_fs\(CHDIR,)588 1362 A
(slot,)210 1992 A
(FALSE,)252 2244 A
(0\);)126 2538 A
4590 V
(18256)210 648 A
(dump_core\(rmp\);)630 1362 A
4680 V
(18257)210 648 A
1110(})S
4770 V
(18258)210 648 A
(mm_exit\(rmp,)504 1110 A
(0\);)126 1656 A
2370(/*)S
(terminate)378 2496 A
(process)294 2916 A
3252(*/)S
4860 V
(18259)210 648 A
1026(})S
5130 V
(18262)210 648 A
(/*===========================================================================*)3276 1026 A
5220 V
(18263)210 648 A
1068(*)S
(check_sig)378 2370 A
4260(*)S
5310 V
(18264)210 648 A
(*===========================================================================*/)3276 1068 A
5400 V
(18265)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(check_sig\(proc_id,)756 1488 A
(signo\))252 2286 A
5490 V
(18266)210 648 A
(pid_t)210 1026 A
(proc_id;)336 1278 A
2370(/*)S
(pid)126 2496 A
2664(of)S
(proc)168 2790 A
3000(to)S
(sig,)168 3126 A
3336(or)S
3462(0)S
3546(or)S
(-1,)126 3672 A
3840(or)S
(-pgrp)210 3966 A
4218(*/)S
5580 V
(18267)210 648 A
(int)126 1026 A
(signo;)252 1194 A
2370(/*)S
(signal)252 2496 A
2790(to)S
(send)168 2916 A
3126(to)S
(process)294 3252 A
3588(\(0)S
3714(to)S
(_NSIG\))252 3840 A
4134(*/)S
5670 V
(18268)210 648 A
1026({)S
5760 V
(18269)210 648 A
1026(/*)S
(Check)210 1152 A
1404(to)S
(see)126 1530 A
1698(if)S
1824(it)S
1950(is)S
(possible)336 2076 A
2454(to)S
(send)168 2580 A
2790(a)S
(signal.)294 2874 A
(The)126 3252 A
(signal)252 3420 A
(may)126 3714 A
(have)168 3882 A
4092(to)S
4218(be)S
5850 V
(18270)210 648 A
1068(*)S
(sent)168 1152 A
1362(to)S
1488(a)S
(group)210 1572 A
1824(of)S
(processes.)420 1950 A
(This)168 2454 A
(routine)294 2664 A
3000(is)S
(invoked)294 3126 A
3462(by)S
(the)126 3588 A
(KILL)168 3756 A
(system)252 3966 A
5940 V
(18271)210 648 A
1068(*)S
(call,)210 1152 A
(and)126 1404 A
(also)168 1572 A
(when)168 1782 A
(the)126 1992 A
(kernel)252 2160 A
(catches)294 2454 A
2790(a)S
(DEL)126 2874 A
3042(or)S
(other)210 3168 A
(signal.)294 3420 A
6030 V
(18272)210 648 A
1068(*/)S
6120 V
(18273)210 648 A
6210 V
(18274)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rmp;)210 2034 A
8418 V
EP
%%Page: 255 255
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2068(File:)S
2301(src/mm/signal.c)S
12 B
(255)180 4248 A
900 V
7 LST
(18275)210 648 A
(int)126 1110 A
(count;)252 1278 A
2370(/*)S
(count)210 2496 A
2748(#)S
2832(of)S
(signals)294 2958 A
(sent)168 3294 A
3504(*/)S
990 V
(18276)210 648 A
(int)126 1110 A
(error_code;)462 1278 A
1080 V
(18277)210 648 A
1170 V
(18278)210 648 A
1110(if)S
(\(signo)252 1236 A
1530(<)S
1614(0)S
1698(||)S
(signo)210 1824 A
2076(>)S
(_NSIG\))252 2160 A
(return\(EINVAL\);)630 2454 A
1260 V
(18279)210 648 A
1350 V
(18280)210 648 A
1110(/*)S
(Return)252 1236 A
(EINVAL)252 1530 A
(for)126 1824 A
(attempts)336 1992 A
2370(to)S
(send)168 2496 A
(SIGKILL)294 2706 A
3042(to)S
(INIT)168 3168 A
(alone.)252 3378 A
3672(*/)S
1440 V
(18281)210 648 A
1110(if)S
(\(proc_id)336 1236 A
1614(==)S
(INIT_PID)336 1740 A
2118(&&)S
(signo)210 2244 A
2496(==)S
(SIGKILL\))336 2622 A
(return\(EINVAL\);)630 3000 A
1530 V
(18282)210 648 A
1620 V
(18283)210 648 A
1110(/*)S
(Search)252 1236 A
(the)126 1530 A
(proc)168 1698 A
(table)210 1908 A
(for)126 2160 A
(processes)378 2328 A
2748(to)S
(signal.)294 2874 A
(\(See)168 3252 A
(forkexit.c)420 3462 A
(about)210 3924 A
1710 V
(18284)210 648 A
1152(*)S
(pid)126 1236 A
(magic.\))294 1404 A
1800 V
(18285)210 648 A
1152(*/)S
1890 V
(18286)210 648 A
(count)210 1110 A
1362(=)S
1446(0;)S
1980 V
(18287)210 648 A
(error_code)420 1110 A
1572(=)S
(ESRCH;)252 1656 A
2070 V
(18288)210 648 A
(for)126 1110 A
(\(rmp)168 1278 A
1488(=)S
(&mproc[INIT_PROC_NR];)882 1572 A
(rmp)126 2496 A
2664(<)S
(&mproc[NR_PROCS];)714 2748 A
(rmp++\))252 3504 A
3798({)S
2160 V
(18289)210 648 A
1362(if)S
1488(\()S
(\(rmp->mp_flags)588 1572 A
2202(&)S
(IN_USE\))294 2286 A
2622(==)S
2748(0\))S
(continue;)378 2874 A
2250 V
(18290)210 648 A
1362(if)S
(\(rmp->mp_flags)588 1488 A
2118(&)S
(HANGING)294 2202 A
2538(&&)S
(signo)210 2664 A
2916(!=)S
3042(0\))S
(continue;)378 3168 A
2340 V
(18291)210 648 A
2430 V
(18292)210 648 A
1362(/*)S
(Check)210 1488 A
(for)126 1740 A
(selection.)420 1908 A
2370(*/)S
2520 V
(18293)210 648 A
1362(if)S
(\(proc_id)336 1488 A
1866(>)S
1950(0)S
2034(&&)S
(proc_id)294 2160 A
2496(!=)S
(rmp->mp_pid\))504 2622 A
(continue;)378 3168 A
2610 V
(18294)210 648 A
1362(if)S
(\(proc_id)336 1488 A
1866(==)S
1992(0)S
2076(&&)S
(mp->mp_procgrp)588 2202 A
2832(!=)S
(rmp->mp_procgrp\))672 2958 A
(continue;)378 3672 A
2700 V
(18295)210 648 A
1362(if)S
(\(proc_id)336 1488 A
1866(==)S
1992(-1)S
2118(&&)S
(rmp->mp_pid)462 2244 A
2748(==)S
(INIT_PID\))378 2874 A
(continue;)378 3294 A
2790 V
(18296)210 648 A
1362(if)S
(\(proc_id)336 1488 A
1866(<)S
1950(-1)S
2076(&&)S
(rmp->mp_procgrp)630 2202 A
2874(!=)S
(-proc_id\))378 3000 A
(continue;)378 3420 A
2880 V
(18297)210 648 A
2970 V
(18298)210 648 A
1362(/*)S
(Check)210 1488 A
(for)126 1740 A
(permission.)462 1908 A
2412(*/)S
3060 V
(18299)210 648 A
1362(if)S
(\(mp->mp_effuid)588 1488 A
2118(!=)S
(SUPER_USER)420 2244 A
3150 V
(18300)210 648 A
1530(&&)S
(mp->mp_realuid)588 1656 A
2286(!=)S
(rmp->mp_realuid)630 2412 A
3240 V
(18301)210 648 A
1530(&&)S
(mp->mp_effuid)546 1656 A
2244(!=)S
(rmp->mp_realuid)630 2370 A
3330 V
(18302)210 648 A
1530(&&)S
(mp->mp_realuid)588 1656 A
2286(!=)S
(rmp->mp_effuid)588 2412 A
3420 V
(18303)210 648 A
1530(&&)S
(mp->mp_effuid)546 1656 A
2244(!=)S
(rmp->mp_effuid\))630 2370 A
3042({)S
3510 V
(18304)210 648 A
(error_code)420 1698 A
2160(=)S
(EPERM;)252 2244 A
3600 V
(18305)210 648 A
(continue;)378 1698 A
3690 V
(18306)210 648 A
1362(})S
3780 V
(18307)210 648 A
3870 V
(18308)210 648 A
(count++;)336 1362 A
3960 V
(18309)210 648 A
1362(if)S
(\(signo)252 1488 A
1782(==)S
1908(0\))S
(continue;)378 2034 A
4050 V
(18310)210 648 A
4140 V
(18311)210 648 A
1362(/*)S
('sig_proc')420 1488 A
(will)168 1950 A
(handle)252 2160 A
(the)126 2454 A
(disposition)462 2622 A
3126(of)S
(the)126 3252 A
(signal.)294 3420 A
(The)126 3798 A
4230 V
(18312)210 648 A
1404(*)S
(signal)252 1488 A
(may)126 1782 A
1950(be)S
(caught,)294 2076 A
(blocked,)336 2412 A
(ignored,)336 2790 A
3168(or)S
(cause)210 3294 A
(process)294 3546 A
4320 V
(18313)210 648 A
1404(*)S
(termination,)504 1488 A
(possibly)336 2034 A
(with)168 2412 A
(core)168 2622 A
(dump.)210 2832 A
4410 V
(18314)210 648 A
1404(*/)S
4500 V
(18315)210 648 A
(sig_proc\(rmp,)546 1362 A
(signo\);)294 1950 A
4590 V
(18316)210 648 A
4680 V
(18317)210 648 A
1362(if)S
(\(proc_id)336 1488 A
1866(>)S
1950(0\))S
(break;)252 2076 A
2370(/*)S
(only)168 2496 A
(one)126 2706 A
(process)294 2874 A
(being)210 3210 A
(signaled)336 3462 A
3840(*/)S
4770 V
(18318)210 648 A
1110(})S
4860 V
(18319)210 648 A
4950 V
(18320)210 648 A
1110(/*)S
1236(If)S
(the)126 1362 A
(calling)294 1530 A
(process)294 1866 A
(has)126 2202 A
(killed)252 2370 A
(itself,)294 2664 A
(don't)210 3000 A
(reply.)252 3252 A
3546(*/)S
5040 V
(18321)210 648 A
1110(if)S
(\(\(mp->mp_flags)588 1236 A
1866(&)S
(IN_USE\))294 1950 A
2286(==)S
2412(0)S
2496(||)S
(\(mp->mp_flags)546 2622 A
3210(&)S
(HANGING\)\))378 3294 A
5130 V
(18322)210 648 A
(dont_reply)420 1362 A
1824(=)S
(TRUE;)210 1908 A
5220 V
(18323)210 648 A
(return\(count)504 1110 A
1656(>)S
1740(0)S
1824(?)S
1908(OK)S
2034(:)S
(error_code\);)504 2118 A
5310 V
(18324)210 648 A
1026(})S
5580 V
(18327)210 648 A
(/*===========================================================================*)3276 1026 A
5670 V
(18328)210 648 A
1068(*)S
(check_pending)546 2412 A
4260(*)S
5760 V
(18329)210 648 A
(*===========================================================================*/)3276 1068 A
5850 V
(18330)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(check_pending\(\))630 1572 A
5940 V
(18331)210 648 A
1026({)S
6030 V
(18332)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
(any)126 1908 A
(pending)294 2076 A
(signals)294 2412 A
(have)168 2748 A
(been)168 2958 A
(unblocked.)420 3168 A
(The)126 3672 A
6120 V
(18333)210 648 A
1152(*)S
(first)210 1236 A
(such)168 1488 A
(signal)252 1698 A
(found)210 1992 A
2244(is)S
(delivered.)420 2370 A
6210 V
(18334)210 648 A
1152(*)S
8418 V
EP
%%Page: 256 256
BP
/slant 0 def
/height 0 def
630 V
12 B
(256)180 648 A
11 R
2068(File:)S
2301(src/mm/signal.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(18335)210 648 A
1152(*)S
1236(If)S
(multiple)336 1362 A
(pending)294 1740 A
(unmasked)336 2076 A
(signals)294 2454 A
(are)126 2790 A
(found,)252 2958 A
(they)168 3252 A
(will)168 3462 A
3672(be)S
990 V
(18336)210 648 A
1152(*)S
(delivered)378 1236 A
(sequentially.)546 1656 A
1080 V
(18337)210 648 A
1152(*)S
1170 V
(18338)210 648 A
1152(*)S
(There)210 1236 A
(are)126 1488 A
(several)294 1656 A
(places)252 1992 A
2286(in)S
(this)168 2412 A
(file)168 2622 A
(where)210 2832 A
(the)126 3084 A
(signal)252 3252 A
(mask)168 3546 A
3756(is)S
1260 V
(18339)210 648 A
1152(*)S
(changed.)336 1236 A
1656(At)S
(each)168 1782 A
(such)168 1992 A
(place,)252 2202 A
(check_pending\(\))630 2496 A
(should)252 3168 A
3462(be)S
(called)252 3588 A
3882(to)S
1350 V
(18340)210 648 A
1152(*)S
(check)210 1236 A
(for)126 1488 A
(newly)210 1656 A
(unblocked)378 1908 A
(signals.)336 2328 A
1440 V
(18341)210 648 A
1152(*/)S
1530 V
(18342)210 648 A
1620 V
(18343)210 648 A
(int)126 1110 A
1278(i;)S
1710 V
(18344)210 648 A
1800 V
(18345)210 648 A
(for)126 1110 A
1278(\(i)S
1404(=)S
1488(1;)S
1614(i)S
1698(<)S
(_NSIG;)252 1782 A
(i++\))168 2076 A
2286({)S
1890 V
(18346)210 648 A
1362(if)S
(\(sigismember\(&mp->mp_sigpending,)1344 1488 A
2874(i\))S
3000(&&)S
1980 V
(18347)210 648 A
(!sigismember\(&mp->mp_sigmask,)1218 1698 A
(i\)\))126 2958 A
3126({)S
2070 V
(18348)210 648 A
(sigdelset\(&mp->mp_sigpending,)1218 1698 A
(i\);)126 2958 A
2160 V
(18349)210 648 A
(sig_proc\(mp,)504 1698 A
(i\);)126 2244 A
2250 V
(18350)210 648 A
(break;)252 1698 A
2340 V
(18351)210 648 A
1362(})S
2430 V
(18352)210 648 A
1110(})S
2520 V
(18353)210 648 A
1026(})S
2790 V
(18356)210 648 A
(/*===========================================================================*)3276 1026 A
2880 V
(18357)210 648 A
1068(*)S
(unpause)294 2370 A
4260(*)S
2970 V
(18358)210 648 A
(*===========================================================================*/)3276 1068 A
3060 V
(18359)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(unpause\(pro\))504 1572 A
3150 V
(18360)210 648 A
(int)126 1026 A
(pro;)168 1194 A
2370(/*)S
(which)210 2496 A
(process)294 2748 A
(number)252 3084 A
3378(*/)S
3240 V
(18361)210 648 A
1026({)S
3330 V
(18362)210 648 A
1026(/*)S
1152(A)S
(signal)252 1236 A
1530(is)S
1656(to)S
1782(be)S
(sent)168 1908 A
2118(to)S
2244(a)S
(process.)336 2328 A
2748(If)S
(that)168 2874 A
(process)294 3084 A
3420(is)S
(hanging)294 3546 A
3882(on)S
4008(a)S
3420 V
(18363)210 648 A
1068(*)S
(system)252 1152 A
(call,)210 1446 A
(the)126 1698 A
(system)252 1866 A
(call)168 2160 A
(must)168 2370 A
2580(be)S
(terminated)420 2706 A
(with)168 3168 A
(EINTR.)252 3378 A
(Possible)336 3714 A
3510 V
(18364)210 648 A
1068(*)S
(calls)210 1152 A
(are)126 1404 A
(PAUSE,)252 1572 A
(WAIT,)210 1866 A
(READ)168 2118 A
(and)126 2328 A
(WRITE,)252 2496 A
(the)126 2790 A
(latter)252 2958 A
(two)126 3252 A
(for)126 3420 A
(pipes)210 3588 A
(and)126 3840 A
(ttys.)210 4008 A
3600 V
(18365)210 648 A
1068(*)S
(First)210 1152 A
(check)210 1404 A
1656(if)S
(the)126 1782 A
(process)294 1950 A
2286(is)S
(hanging)294 2412 A
2748(on)S
2874(an)S
3000(MM)S
(call.)210 3126 A
3420(If)S
(not,)168 3546 A
(tell)168 3756 A
(FS,)126 3966 A
3690 V
(18366)210 648 A
1068(*)S
1152(so)S
1278(it)S
(can)126 1404 A
(check)210 1572 A
(for)126 1824 A
(READs)210 1992 A
(and)126 2244 A
(WRITEs)252 2412 A
(from)168 2706 A
(pipes,)252 2916 A
(ttys)168 3210 A
(and)126 3420 A
(the)126 3588 A
(like.)210 3756 A
3780 V
(18367)210 648 A
1068(*/)S
3870 V
(18368)210 648 A
3960 V
(18369)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rmp;)210 2034 A
4050 V
(18370)210 648 A
4140 V
(18371)210 648 A
(rmp)126 1110 A
1278(=)S
(&mproc[pro];)504 1362 A
4230 V
(18372)210 648 A
4320 V
(18373)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
(process)294 1908 A
2244(is)S
(hanging)294 2370 A
2706(on)S
2832(a)S
(PAUSE)210 2916 A
(call.)210 3168 A
3420(*/)S
4410 V
(18374)210 648 A
1110(if)S
1236(\()S
(\(rmp->mp_flags)588 1320 A
1950(&)S
(PAUSED\))294 2034 A
2370(&&)S
(\(rmp->mp_flags)588 2496 A
3126(&)S
(HANGING\))336 3210 A
3588(==)S
3714(0\))S
3840({)S
4500 V
(18375)210 648 A
(rmp->mp_flags)546 1362 A
1950(&=)S
(\304PAUSED;)336 2076 A
4590 V
(18376)210 648 A
(reply\(pro,)420 1362 A
(EINTR,)252 1824 A
2118(0,)S
(NIL_PTR\);)378 2244 A
4680 V
(18377)210 648 A
(return;)294 1362 A
4770 V
(18378)210 648 A
1110(})S
4860 V
(18379)210 648 A
4950 V
(18380)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
(process)294 1908 A
2244(is)S
(hanging)294 2370 A
2706(on)S
2832(a)S
(WAIT)168 2916 A
(call.)210 3126 A
3378(*/)S
5040 V
(18381)210 648 A
1110(if)S
1236(\()S
(\(rmp->mp_flags)588 1320 A
1950(&)S
(WAITING\))336 2034 A
2412(&&)S
(\(rmp->mp_flags)588 2538 A
3168(&)S
(HANGING\))336 3252 A
3630(==)S
3756(0\))S
3882({)S
5130 V
(18382)210 648 A
(rmp->mp_flags)546 1362 A
1950(&=)S
(\304WAITING;)378 2076 A
5220 V
(18383)210 648 A
(reply\(pro,)420 1362 A
(EINTR,)252 1824 A
2118(0,)S
(NIL_PTR\);)378 2244 A
5310 V
(18384)210 648 A
(return;)294 1362 A
5400 V
(18385)210 648 A
1110(})S
5490 V
(18386)210 648 A
5580 V
(18387)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
(process)294 1908 A
2244(is)S
(hanging)294 2370 A
2706(on)S
2832(a)S
(SIGSUSPEND)420 2916 A
(call.)210 3378 A
3630(*/)S
5670 V
(18388)210 648 A
1110(if)S
(\(\(rmp->mp_flags)630 1236 A
1908(&)S
(SIGSUSPENDED\))546 1992 A
2580(&&)S
(\(rmp->mp_flags)588 2706 A
3336(&)S
(HANGING\))336 3420 A
3798(==)S
3924(0\))S
4050({)S
5760 V
(18389)210 648 A
(rmp->mp_flags)546 1362 A
1950(&=)S
(\304SIGSUSPENDED;)588 2076 A
5850 V
(18390)210 648 A
(reply\(pro,)420 1362 A
(EINTR,)252 1824 A
2118(0,)S
(NIL_PTR\);)378 2244 A
5940 V
(18391)210 648 A
(return;)294 1362 A
6030 V
(18392)210 648 A
1110(})S
6120 V
(18393)210 648 A
6210 V
(18394)210 648 A
1110(/*)S
(Process)294 1236 A
1572(is)S
(not)126 1698 A
(hanging)294 1866 A
2202(on)S
2328(an)S
2454(MM)S
(call.)210 2580 A
(Ask)126 2874 A
3042(FS)S
3168(to)S
(take)168 3294 A
3504(a)S
(look.)210 3588 A
3840(*/)S
8418 V
EP
%%Page: 257 257
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2068(File:)S
2301(src/mm/signal.c)S
12 B
(257)180 4248 A
900 V
7 LST
(18395)210 648 A
(tell_fs\(UNPAUSE,)672 1362 A
(pro,)168 2076 A
2286(0,)S
(0\);)126 2412 A
990 V
(18396)210 648 A
1026(})S
1260 V
(18399)210 648 A
(/*===========================================================================*)3276 1026 A
1350 V
(18400)210 648 A
1068(*)S
(dump_core)378 2370 A
4260(*)S
1440 V
(18401)210 648 A
(*===========================================================================*/)3276 1068 A
1530 V
(18402)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(dump_core\(rmp\))588 1572 A
1620 V
(18403)210 648 A
(register)336 1026 A
(struct)252 1404 A
(mproc)210 1698 A
(*rmp;)210 1950 A
2370(/*)S
(whose)210 2496 A
(core)168 2748 A
2958(is)S
3084(to)S
3210(be)S
(dumped)252 3336 A
3630(*/)S
1710 V
(18404)210 648 A
1026({)S
1800 V
(18405)210 648 A
1026(/*)S
(Make)168 1152 A
1362(a)S
(core)168 1446 A
(dump)168 1656 A
1866(on)S
(the)126 1992 A
(file)168 2160 A
("core",)294 2370 A
2706(if)S
(possible.)378 2832 A
3252(*/)S
1890 V
(18406)210 648 A
1980 V
(18407)210 648 A
(int)126 1110 A
(fd,)126 1278 A
(fake_fd,)336 1446 A
(nr_written,)462 1824 A
(seg,)168 2328 A
(slot;)210 2538 A
2070 V
(18408)210 648 A
(char)168 1110 A
(*buf;)210 1320 A
2160 V
(18409)210 648 A
(vir_bytes)378 1110 A
(current_sp;)462 1530 A
2250 V
(18410)210 648 A
(phys_bytes)420 1110 A
(left;)210 1572 A
2370(/*)S
(careful;)336 2496 A
(64K)126 2874 A
(might)210 3042 A
(overflow)336 3294 A
(vir_bytes)378 3672 A
4092(*/)S
2340 V
(18411)210 648 A
(unsigned)336 1110 A
(nr_to_write;)504 1488 A
2370(/*)S
(unsigned)336 2496 A
(for)126 2874 A
(arg)126 3042 A
3210(to)S
(write\(\))294 3336 A
(but)126 3672 A
3840(<)S
(INT_MAX)294 3924 A
4260(*/)S
2430 V
(18412)210 648 A
(long)168 1110 A
(trace_data,)462 1320 A
(trace_off;)420 1824 A
2520 V
(18413)210 648 A
2610 V
(18414)210 648 A
(slot)168 1110 A
1320(=)S
(\(int\))210 1404 A
(\(rmp)168 1656 A
1866(-)S
(mproc\);)294 1950 A
2700 V
(18415)210 648 A
2790 V
(18416)210 648 A
1110(/*)S
(Can)126 1236 A
(core)168 1404 A
(file)168 1614 A
1824(be)S
(written?)336 1950 A
2370(We)S
(are)126 2496 A
(operating)378 2664 A
3084(in)S
(the)126 3210 A
(user's)252 3378 A
3672(FS)S
(environment,)504 3798 A
2880 V
(18417)210 648 A
1152(*)S
1236(so)S
1362(no)S
(special)294 1488 A
(permission)420 1824 A
(checks)252 2286 A
(are)126 2580 A
(needed.)294 2748 A
2970 V
(18418)210 648 A
1152(*/)S
3060 V
(18419)210 648 A
1110(if)S
(\(rmp->mp_realuid)672 1236 A
1950(!=)S
(rmp->mp_effuid\))630 2076 A
(return;)294 2748 A
3150 V
(18420)210 648 A
1110(if)S
1236(\()S
(\(fd)126 1320 A
1488(=)S
(creat\(core_name,)672 1572 A
(CORE_MODE\)\))462 2286 A
2790(<)S
2874(0\))S
(return;)294 3000 A
3240 V
(18421)210 648 A
(rmp->mp_sigstatus)714 1110 A
1866(|=)S
(DUMPED;)294 1992 A
3330 V
(18422)210 648 A
3420 V
(18423)210 648 A
1110(/*)S
(Make)168 1236 A
(sure)168 1446 A
(the)126 1656 A
(stack)210 1824 A
(segment)294 2076 A
2412(is)S
2538(up)S
2664(to)S
(date.)210 2790 A
3510 V
(18424)210 648 A
1152(*)S
1236(We)S
(don't)210 1362 A
(want)168 1614 A
(adjust\(\))336 1824 A
2202(to)S
(fail)168 2328 A
(unless)252 2538 A
(current_sp)420 2832 A
3294(is)S
(preposterous,)546 3420 A
3600 V
(18425)210 648 A
1152(*)S
(but)126 1236 A
1404(it)S
(might)210 1530 A
(fail)168 1782 A
(due)126 1992 A
2160(to)S
(safety)252 2286 A
(checking.)378 2580 A
(Also,)210 3042 A
3294(we)S
(don't)210 3420 A
(really)252 3672 A
(want)168 3966 A
3690 V
(18426)210 648 A
1152(*)S
(the)126 1236 A
(adjust\(\))336 1404 A
(for)126 1782 A
(sending)294 1950 A
2286(a)S
(signal)252 2370 A
2664(to)S
(fail)168 2790 A
(due)126 3000 A
3168(to)S
(safety)252 3294 A
(checking.)378 3588 A
3780 V
(18427)210 648 A
1152(*)S
(Maybe)210 1236 A
(make)168 1488 A
(SAFETY_BYTES)504 1698 A
2244(a)S
(parameter.)420 2328 A
3870 V
(18428)210 648 A
1152(*/)S
3960 V
(18429)210 648 A
(sys_getsp\(slot,)630 1110 A
(&current_sp\);)546 1782 A
4050 V
(18430)210 648 A
(adjust\(rmp,)462 1110 A
(rmp->mp_seg[D].mem_len,)966 1614 A
(current_sp\);)504 2622 A
4140 V
(18431)210 648 A
4230 V
(18432)210 648 A
1110(/*)S
(Write)210 1236 A
(the)126 1488 A
(memory)252 1656 A
(map)126 1950 A
2118(of)S
(all)126 2244 A
(segments)336 2412 A
2790(to)S
(begin)210 2916 A
(the)126 3168 A
(core)168 3336 A
(file.)210 3546 A
3798(*/)S
4320 V
(18433)210 648 A
1110(if)S
(\(write\(fd,)420 1236 A
(\(char)210 1698 A
1950(*\))S
(rmp->mp_seg,)504 2076 A
(\(unsigned\))420 2622 A
(sizeof)252 3084 A
(rmp->mp_seg\))504 3378 A
4410 V
(18434)210 648 A
1278(!=)S
(\(unsigned\))420 1404 A
(sizeof)252 1866 A
(rmp->mp_seg\))504 2160 A
2706({)S
4500 V
(18435)210 648 A
(close\(fd\);)420 1362 A
4590 V
(18436)210 648 A
(return;)294 1362 A
4680 V
(18437)210 648 A
1110(})S
4770 V
(18438)210 648 A
4860 V
(18439)210 648 A
1110(/*)S
(Write)210 1236 A
(out)126 1488 A
(the)126 1656 A
(whole)210 1824 A
(kernel)252 2076 A
(process)294 2370 A
(table)210 2706 A
(entry)210 2958 A
3210(to)S
(get)126 3336 A
(the)126 3504 A
(regs.)210 3672 A
3924(*/)S
4950 V
(18440)210 648 A
(trace_off)378 1110 A
1530(=)S
1614(0;)S
5040 V
(18441)210 648 A
(while)210 1110 A
(\(sys_trace\(3,)546 1362 A
(slot,)210 1950 A
(trace_off,)420 2202 A
(&trace_data\))504 2664 A
3210(==)S
(OK\))126 3336 A
3504({)S
5130 V
(18442)210 648 A
1362(if)S
(\(write\(fd,)420 1488 A
(\(char)210 1950 A
2202(*\))S
(&trace_data,)504 2328 A
(\(unsigned\))420 2874 A
(sizeof)252 3336 A
(\(long\)\))294 3630 A
5220 V
(18443)210 648 A
1530(!=)S
(\(unsigned\))420 1656 A
(sizeof)252 2118 A
(\(long\)\))294 2412 A
2748({)S
5310 V
(18444)210 648 A
(close\(fd\);)420 1698 A
5400 V
(18445)210 648 A
(return;)294 1698 A
5490 V
(18446)210 648 A
1362(})S
5580 V
(18447)210 648 A
(trace_off)378 1362 A
1782(+=)S
(sizeof)252 1908 A
(\(long\);)294 2202 A
5670 V
(18448)210 648 A
1110(})S
5760 V
(18449)210 648 A
5850 V
(18450)210 648 A
1110(/*)S
(Loop)168 1236 A
(through)294 1446 A
(segments)336 1782 A
(and)126 2160 A
(write)210 2328 A
(the)126 2580 A
(segments)336 2748 A
(themselves)420 3126 A
(out.)168 3588 A
3798(*/)S
5940 V
(18451)210 648 A
(for)126 1110 A
(\(seg)168 1278 A
1488(=)S
1572(0;)S
(seg)126 1698 A
1866(<)S
(NR_SEGS;)336 1950 A
(seg++\))252 2328 A
2622({)S
6030 V
(18452)210 648 A
(buf)126 1362 A
1530(=)S
(\(char)210 1614 A
1866(*\))S
(\(\(vir_bytes\))504 1992 A
(rmp->mp_seg[seg].mem_vir)1008 2538 A
3588(<<)S
(CLICK_SHIFT\);)546 3714 A
6120 V
(18453)210 648 A
(left)168 1362 A
1572(=)S
(\(phys_bytes\))504 1656 A
(rmp->mp_seg[seg].mem_len)1008 2202 A
3252(<<)S
(CLICK_SHIFT;)504 3378 A
6210 V
(18454)210 648 A
(fake_fd)294 1362 A
1698(=)S
(\(slot)210 1782 A
2034(<<)S
2160(8\))S
2286(|)S
(\(seg)168 2370 A
2580(<<)S
2706(6\))S
2832(|)S
(fd;)126 2916 A
8418 V
EP
%%Page: 258 258
BP
/slant 0 def
/height 0 def
630 V
12 B
(258)180 648 A
11 R
2068(File:)S
2301(src/mm/signal.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(18455)210 648 A
990 V
(18456)210 648 A
1362(/*)S
(Loop)168 1488 A
(through)294 1698 A
2034(a)S
(segment,)336 2118 A
(dumping)294 2496 A
(it.)126 2832 A
3000(*/)S
1080 V
(18457)210 648 A
(while)210 1362 A
(\(left)210 1614 A
1866(!=)S
1992(0\))S
2118({)S
1170 V
(18458)210 648 A
(nr_to_write)462 1698 A
2202(=)S
(\(unsigned\))420 2286 A
(MIN\(left,)378 2748 A
(DUMP_SIZE\);)462 3168 A
1260 V
(18459)210 648 A
1698(if)S
1824(\()S
(\(nr_written)462 1908 A
2412(=)S
(write\(fake_fd,)588 2496 A
(buf,)168 3126 A
(nr_to_write\)\))546 3336 A
3924(<)S
4008(0\))S
4134({)S
1350 V
(18460)210 648 A
(close\(fd\);)420 2034 A
1440 V
(18461)210 648 A
(return;)294 2034 A
1530 V
(18462)210 648 A
1698(})S
1620 V
(18463)210 648 A
(buf)126 1698 A
1866(+=)S
(nr_written;)462 1992 A
1710 V
(18464)210 648 A
(left)168 1698 A
1908(-=)S
(nr_written;)462 2034 A
1800 V
(18465)210 648 A
1362(})S
1890 V
(18466)210 648 A
1110(})S
1980 V
(18467)210 648 A
(close\(fd\);)420 1110 A
2070 V
(18468)210 648 A
1026(})S
2340 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2430 V
(src/mm/getset.c)630 2034 A
2520 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2700 V
(18500)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(handles)294 1572 A
(the)126 1908 A
2076(4)S
(system)252 2160 A
(calls)210 2454 A
(that)168 2706 A
(get)126 2916 A
(and)126 3084 A
(set)126 3252 A
(uids)168 3420 A
(and)126 3630 A
(gids.)210 3798 A
2790 V
(18501)210 648 A
1068(*)S
1152(It)S
(also)168 1278 A
(handles)294 1488 A
(getpid\(\),)378 1824 A
(setsid\(\),)378 2244 A
(and)126 2664 A
(getpgrp\(\).)420 2832 A
(The)126 3336 A
(code)168 3504 A
(for)126 3714 A
(each)168 3882 A
2880 V
(18502)210 648 A
1068(*)S
(one)126 1152 A
1320(is)S
1446(so)S
(tiny)168 1572 A
(that)168 1782 A
1992(it)S
(hardly)252 2118 A
(seemed)252 2412 A
(worthwhile)420 2706 A
3168(to)S
(make)168 3294 A
(each)168 3504 A
3714(a)S
(separate)336 3798 A
2970 V
(18503)210 648 A
1068(*)S
(function.)378 1152 A
3060 V
(18504)210 648 A
1068(*/)S
3150 V
(18505)210 648 A
3240 V
(18506)210 648 A
(#include)336 1026 A
("mm.h")252 1404 A
3330 V
(18507)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
3420 V
(18508)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
3510 V
(18509)210 648 A
(#include)336 1026 A
("mproc.h")378 1404 A
3600 V
(18510)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
3690 V
(18511)210 648 A
3780 V
(18512)210 648 A
(/*===========================================================================*)3276 1026 A
3870 V
(18513)210 648 A
1068(*)S
(do_getset)378 2370 A
4260(*)S
3960 V
(18514)210 648 A
(*===========================================================================*/)3276 1068 A
4050 V
(18515)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_getset\(\))462 1488 A
4140 V
(18516)210 648 A
1026({)S
4230 V
(18517)210 648 A
1026(/*)S
(Handle)252 1152 A
(GETUID,)294 1446 A
(GETGID,)294 1782 A
(GETPID,)294 2118 A
(GETPGRP,)336 2454 A
(SETUID,)294 2832 A
(SETGID,)294 3168 A
(SETSID.)294 3504 A
(The)126 3882 A
(four)168 4050 A
4320 V
(18518)210 648 A
1068(*)S
(GETs)168 1152 A
(and)126 1362 A
(SETSID)252 1530 A
(return)252 1824 A
(their)210 2118 A
(primary)294 2370 A
(results)294 2706 A
3042(in)S
('r'.)168 3168 A
(GETUID,)294 3420 A
(GETGID,)294 3756 A
(and)126 4092 A
4410 V
(18519)210 648 A
1068(*)S
(GETPID)252 1152 A
(also)168 1446 A
(return)252 1656 A
(secondary)378 1950 A
(results)294 2370 A
(\(the)168 2706 A
(effective)378 2916 A
(IDs,)168 3336 A
3546(or)S
(the)126 3672 A
(parent)252 3840 A
4500 V
(18520)210 648 A
1068(*)S
(process)294 1152 A
(ID\))126 1488 A
1656(in)S
('result2',)420 1782 A
(which)210 2244 A
2496(is)S
(returned)336 2622 A
3000(to)S
(the)126 3126 A
(user.)210 3294 A
4590 V
(18521)210 648 A
1068(*/)S
4680 V
(18522)210 648 A
4770 V
(18523)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rmp)168 2034 A
2244(=)S
(mp;)126 2328 A
4860 V
(18524)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(r;)S
4950 V
(18525)210 648 A
5040 V
(18526)210 648 A
(switch\(mm_call\))630 1110 A
1782({)S
5130 V
(18527)210 648 A
(case)168 1362 A
(GETUID:)294 1572 A
5220 V
(18528)210 648 A
1698(r)S
1782(=)S
(rmp->mp_realuid;)672 1866 A
5310 V
(18529)210 648 A
(result2)294 1698 A
2034(=)S
(rmp->mp_effuid;)630 2118 A
5400 V
(18530)210 648 A
(break;)252 1698 A
5490 V
(18531)210 648 A
5580 V
(18532)210 648 A
(case)168 1362 A
(GETGID:)294 1572 A
5670 V
(18533)210 648 A
1698(r)S
1782(=)S
(rmp->mp_realgid;)672 1866 A
5760 V
(18534)210 648 A
(result2)294 1698 A
2034(=)S
(rmp->mp_effgid;)630 2118 A
5850 V
(18535)210 648 A
(break;)252 1698 A
5940 V
(18536)210 648 A
6030 V
(18537)210 648 A
(case)168 1362 A
(GETPID:)294 1572 A
6120 V
(18538)210 648 A
1698(r)S
1782(=)S
(mproc[who].mp_pid;)756 1866 A
6210 V
(18539)210 648 A
(result2)294 1698 A
2034(=)S
(mproc[rmp->mp_parent].mp_pid;)1218 2118 A
8418 V
EP
%%Page: 259 259
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2070(File:)S
2303(src/mm/getset.c)S
12 B
(259)180 4248 A
900 V
7 LST
(18540)210 648 A
(break;)252 1698 A
990 V
(18541)210 648 A
1080 V
(18542)210 648 A
(case)168 1362 A
(SETUID:)294 1572 A
1170 V
(18543)210 648 A
1698(if)S
(\(rmp->mp_realuid)672 1824 A
2538(!=)S
(usr_id)252 2664 A
2958(&&)S
(rmp->mp_effuid)588 3084 A
3714(!=)S
(SUPER_USER\))462 3840 A
1260 V
(18544)210 648 A
(return\(EPERM\);)588 2034 A
1350 V
(18545)210 648 A
(rmp->mp_realuid)630 1698 A
2370(=)S
(usr_id;)294 2454 A
1440 V
(18546)210 648 A
(rmp->mp_effuid)588 1698 A
2328(=)S
(usr_id;)294 2412 A
1530 V
(18547)210 648 A
(tell_fs\(SETUID,)630 1698 A
(who,)168 2370 A
(usr_id,)294 2580 A
(usr_id\);)336 2916 A
1620 V
(18548)210 648 A
1698(r)S
1782(=)S
(OK;)126 1866 A
1710 V
(18549)210 648 A
(break;)252 1698 A
1800 V
(18550)210 648 A
1890 V
(18551)210 648 A
(case)168 1362 A
(SETGID:)294 1572 A
1980 V
(18552)210 648 A
1698(if)S
(\(rmp->mp_realgid)672 1824 A
2538(!=)S
(grpid)210 2664 A
2916(&&)S
(rmp->mp_effuid)588 3042 A
3672(!=)S
(SUPER_USER\))462 3798 A
2070 V
(18553)210 648 A
(return\(EPERM\);)588 2034 A
2160 V
(18554)210 648 A
(rmp->mp_realgid)630 1698 A
2370(=)S
(grpid;)252 2454 A
2250 V
(18555)210 648 A
(rmp->mp_effgid)588 1698 A
2328(=)S
(grpid;)252 2412 A
2340 V
(18556)210 648 A
(tell_fs\(SETGID,)630 1698 A
(who,)168 2370 A
(grpid,)252 2580 A
(grpid\);)294 2874 A
2430 V
(18557)210 648 A
1698(r)S
1782(=)S
(OK;)126 1866 A
2520 V
(18558)210 648 A
(break;)252 1698 A
2610 V
(18559)210 648 A
2700 V
(18560)210 648 A
(case)168 1362 A
(SETSID:)294 1572 A
2790 V
(18561)210 648 A
1698(if)S
(\(rmp->mp_procgrp)672 1824 A
2538(==)S
(rmp->mp_pid\))504 2664 A
(return\(EPERM\);)588 3210 A
2880 V
(18562)210 648 A
(rmp->mp_procgrp)630 1698 A
2370(=)S
(rmp->mp_pid;)504 2454 A
2970 V
(18563)210 648 A
(tell_fs\(SETSID,)630 1698 A
(who,)168 2370 A
2580(0,)S
(0\);)126 2706 A
3060 V
(18564)210 648 A
(/*FALL)252 1698 A
(THROUGH*/)378 1992 A
3150 V
(18565)210 648 A
3240 V
(18566)210 648 A
(case)168 1362 A
(GETPGRP:)336 1572 A
3330 V
(18567)210 648 A
1698(r)S
1782(=)S
(rmp->mp_procgrp;)672 1866 A
3420 V
(18568)210 648 A
(break;)252 1698 A
3510 V
(18569)210 648 A
3600 V
(18570)210 648 A
(default:)336 1362 A
3690 V
(18571)210 648 A
1698(r)S
1782(=)S
(EINVAL;)294 1866 A
3780 V
(18572)210 648 A
(break;)252 1698 A
3870 V
(18573)210 648 A
1110(})S
3960 V
(18574)210 648 A
(return\(r\);)420 1110 A
4050 V
(18575)210 648 A
1026(})S
4590 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4680 V
(src/mm/trace.c)588 2034 A
4770 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4950 V
(18600)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(handles)294 1572 A
(the)126 1908 A
(memory)252 2076 A
(manager's)378 2370 A
(part)168 2790 A
3000(of)S
(debugging,)420 3126 A
(using)210 3588 A
(the)126 3840 A
5040 V
(18601)210 648 A
1068(*)S
(ptrace)252 1152 A
(system)252 1446 A
(call.)210 1740 A
(Most)168 1992 A
2202(of)S
(the)126 2328 A
(commands)336 2496 A
(are)126 2874 A
(passed)252 3042 A
3336(on)S
3462(to)S
(the)126 3588 A
(system)252 3756 A
5130 V
(18602)210 648 A
1068(*)S
(task)168 1152 A
(for)126 1362 A
(completion.)462 1530 A
5220 V
(18603)210 648 A
1068(*)S
5310 V
(18604)210 648 A
1068(*)S
(The)126 1152 A
(debugging)378 1320 A
(commands)336 1740 A
(available)378 2118 A
(are:)168 2538 A
5400 V
(18605)210 648 A
1068(*)S
(T_STOP)252 1152 A
(stop)168 1698 A
(the)126 1908 A
(process)294 2076 A
5490 V
(18606)210 648 A
1068(*)S
(T_OK)168 1152 A
(enable)252 1698 A
(tracing)294 1992 A
2328(by)S
(parent)252 2454 A
(for)126 2748 A
(this)168 2916 A
(process)294 3126 A
5580 V
(18607)210 648 A
1068(*)S
(T_GETINS)336 1152 A
(return)252 1698 A
(value)210 1992 A
(from)168 2244 A
(instruction)462 2454 A
(space)210 2958 A
5670 V
(18608)210 648 A
1068(*)S
(T_GETDATA)378 1152 A
(return)252 1698 A
(value)210 1992 A
(from)168 2244 A
(data)168 2454 A
(space)210 2664 A
5760 V
(18609)210 648 A
1068(*)S
(T_GETUSER)378 1152 A
(return)252 1698 A
(value)210 1992 A
(from)168 2244 A
(user)168 2454 A
(process)294 2664 A
(table)210 3000 A
5850 V
(18610)210 648 A
1068(*)S
(T_SETINS)336 1152 A
(set)126 1698 A
(value)210 1866 A
2118(in)S
(instruction)462 2244 A
(space)210 2748 A
5940 V
(18611)210 648 A
1068(*)S
(T_SETDATA)378 1152 A
(set)126 1698 A
(value)210 1866 A
2118(in)S
(data)168 2244 A
(space)210 2454 A
6030 V
(18612)210 648 A
1068(*)S
(T_SETUSER)378 1152 A
(set)126 1698 A
(value)210 1866 A
2118(in)S
(user)168 2244 A
(process)294 2454 A
(table)210 2790 A
6120 V
(18613)210 648 A
1068(*)S
(T_RESUME)336 1152 A
(resume)252 1698 A
(execution)378 1992 A
6210 V
(18614)210 648 A
1068(*)S
(T_EXIT)252 1152 A
(exit)168 1698 A
8418 V
EP
%%Page: 260 260
BP
/slant 0 def
/height 0 def
630 V
12 B
(260)180 648 A
11 R
2091(File:)S
(src/mm/trace.c)660 2324 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(18615)210 648 A
1068(*)S
(T_STEP)252 1152 A
(set)126 1698 A
(trace)210 1866 A
(bit)126 2118 A
990 V
(18616)210 648 A
1068(*)S
1080 V
(18617)210 648 A
1068(*)S
(The)126 1152 A
(T_OK)168 1320 A
(and)126 1530 A
(T_EXIT)252 1698 A
(commands)336 1992 A
(are)126 2370 A
(handled)294 2538 A
(here,)210 2874 A
(and)126 3126 A
(the)126 3294 A
(T_RESUME)336 3462 A
(and)126 3840 A
1170 V
(18618)210 648 A
1068(*)S
(T_STEP)252 1152 A
(commands)336 1446 A
(are)126 1824 A
(partially)378 1992 A
(handled)294 2412 A
(here)168 2748 A
(and)126 2958 A
(completed)378 3126 A
3546(by)S
(the)126 3672 A
(system)252 3840 A
1260 V
(18619)210 648 A
1068(*)S
(task.)210 1152 A
(The)126 1404 A
(rest)168 1572 A
(are)126 1782 A
(handled)294 1950 A
(entirely)336 2286 A
2664(by)S
(the)126 2790 A
(system)252 2958 A
(task.)210 3252 A
1350 V
(18620)210 648 A
1068(*/)S
1440 V
(18621)210 648 A
1530 V
(18622)210 648 A
(#include)336 1026 A
("mm.h")252 1404 A
1620 V
(18623)210 648 A
(#include)336 1026 A
(<sys/ptrace.h>)588 1404 A
1710 V
(18624)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
1800 V
(18625)210 648 A
(#include)336 1026 A
("mproc.h")378 1404 A
1890 V
(18626)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
1980 V
(18627)210 648 A
2070 V
(18628)210 648 A
(#define)294 1026 A
(NIL_MPROC)378 1362 A
(\(\(struct)336 2034 A
(mproc)210 2412 A
2664(*\))S
2790(0\))S
2160 V
(18629)210 648 A
2250 V
(18630)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(struct)252 1866 A
(mproc)210 2160 A
(*findproc,)420 2412 A
(\(pid_t)252 2874 A
(lpid\))210 3168 A
3420(\);)S
2340 V
(18631)210 648 A
2430 V
(18632)210 648 A
(/*===========================================================================*)3276 1026 A
2520 V
(18633)210 648 A
1068(*)S
(do_trace)336 2370 A
4260(*)S
2610 V
(18634)210 648 A
(*===========================================================================*/)3276 1068 A
2700 V
(18635)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_trace\(\))420 1488 A
2790 V
(18636)210 648 A
1026({)S
2880 V
(18637)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*child;)294 2034 A
2970 V
(18638)210 648 A
3060 V
(18639)210 648 A
1110(/*)S
(the)126 1236 A
(T_OK)168 1404 A
(call)168 1614 A
1824(is)S
(made)168 1950 A
2160(by)S
(the)126 2286 A
(child)210 2454 A
(fork)168 2706 A
2916(of)S
(the)126 3042 A
(debugger)336 3210 A
(before)252 3588 A
3882(it)S
(execs)210 4008 A
3150 V
(18640)210 648 A
1152(*)S
(the)126 1236 A
(process)294 1404 A
1740(to)S
1866(be)S
(traced)252 1992 A
3240 V
(18641)210 648 A
1152(*/)S
3330 V
(18642)210 648 A
1110(if)S
(\(request)336 1236 A
1614(==)S
(T_OK\))210 1740 A
({/*)126 1992 A
(enable)252 2160 A
(tracing)294 2454 A
2790(by)S
(parent)252 2916 A
(for)126 3210 A
(this)168 3378 A
(process)294 3588 A
3924(*/)S
3420 V
(18643)210 648 A
(mp->mp_flags)504 1362 A
1908(|=)S
(TRACED;)294 2034 A
3510 V
(18644)210 648 A
(mm_out.m2_l2)504 1362 A
1908(=)S
1992(0;)S
3600 V
(18645)210 648 A
(return\(OK\);)462 1362 A
3690 V
(18646)210 648 A
1110(})S
3780 V
(18647)210 648 A
1110(if)S
(\(\(child)294 1236 A
1572(=)S
(findproc\(pid\)\))588 1656 A
2286(==)S
(NIL_MPROC)378 2412 A
2832(||)S
(!\(child->mp_flags)714 2958 A
3714(&)S
(STOPPED\)\))378 3798 A
4218({)S
3870 V
(18648)210 648 A
(return\(ESRCH\);)588 1362 A
3960 V
(18649)210 648 A
1110(})S
4050 V
(18650)210 648 A
1110(/*)S
(all)126 1236 A
(the)126 1404 A
(other)210 1572 A
(calls)210 1824 A
(are)126 2076 A
(made)168 2244 A
2454(by)S
(the)126 2580 A
(parent)252 2748 A
(fork)168 3042 A
3252(of)S
(the)126 3378 A
(debugger)336 3546 A
3924(to)S
4140 V
(18651)210 648 A
1152(*)S
(control)294 1236 A
(execution)378 1572 A
1992(of)S
(the)126 2118 A
(child)210 2286 A
4230 V
(18652)210 648 A
1152(*/)S
4320 V
(18653)210 648 A
(switch)252 1110 A
(\(request\))378 1404 A
1824({)S
4410 V
(18654)210 648 A
(case)168 1110 A
(T_EXIT:)294 1320 A
2034(/*)S
(exit)168 2160 A
2370(*/)S
4500 V
(18655)210 648 A
(mm_exit\(child,)588 1362 A
(\(int\)data\);)462 1992 A
4590 V
(18656)210 648 A
(mm_out.m2_l2)504 1362 A
1908(=)S
1992(0;)S
4680 V
(18657)210 648 A
(return\(OK\);)462 1362 A
4770 V
(18658)210 648 A
(case)168 1110 A
(T_RESUME:)378 1320 A
4860 V
(18659)210 648 A
(case)168 1110 A
(T_STEP:)294 1320 A
2034(/*)S
(resume)252 2160 A
(execution)378 2454 A
2874(*/)S
4950 V
(18660)210 648 A
1362(if)S
(\(data)210 1488 A
1740(<)S
1824(0)S
1908(||)S
(data)168 2034 A
2244(>)S
(_NSIG\))252 2328 A
(return\(EIO\);)504 2622 A
5040 V
(18661)210 648 A
1362(if)S
(\(data)210 1488 A
1740(>)S
1824(0\))S
1950({)S
2370(/*)S
(issue)210 2496 A
(signal)252 2748 A
3042(*/)S
5130 V
(18662)210 648 A
(child->mp_flags)630 1698 A
2370(&=)S
(\304TRACED;)336 2496 A
2916(/*)S
3042(so)S
(signal)252 3168 A
3462(is)S
(not)126 3588 A
(diverted)336 3756 A
4134(*/)S
5220 V
(18663)210 648 A
(sig_proc\(child,)630 1698 A
(\(int\))210 2370 A
(data\);)252 2622 A
5310 V
(18664)210 648 A
(child->mp_flags)630 1698 A
2370(|=)S
(TRACED;)294 2496 A
5400 V
(18665)210 648 A
1362(})S
5490 V
(18666)210 648 A
(child->mp_flags)630 1362 A
2034(&=)S
(\304STOPPED;)378 2160 A
5580 V
(18667)210 648 A
(break;)252 1362 A
5670 V
(18668)210 648 A
1110(})S
5760 V
(18669)210 648 A
1110(if)S
(\(sys_trace\(request,)798 1236 A
(\(int\))210 2076 A
(\(child)252 2328 A
2622(-)S
(mproc\),)294 2706 A
(taddr,)252 3042 A
(&data\))252 3336 A
3630(!=)S
(OK\))126 3756 A
5850 V
(18670)210 648 A
(return\(-errno\);)630 1362 A
5940 V
(18671)210 648 A
(mm_out.m2_l2)504 1110 A
1656(=)S
(data;)210 1740 A
6030 V
(18672)210 648 A
(return\(OK\);)462 1110 A
6120 V
(18673)210 648 A
1026(})S
8418 V
EP
%%Page: 261 261
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2091(File:)S
(src/mm/trace.c)660 2324 A
12 B
(261)180 4248 A
900 V
7 LST
(18675)210 648 A
(/*===========================================================================*)3276 1026 A
990 V
(18676)210 648 A
1068(*)S
(findproc)336 2370 A
4260(*)S
1080 V
(18677)210 648 A
(*===========================================================================*/)3276 1068 A
1170 V
(18678)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(mproc)210 1656 A
(*findproc\(lpid\))630 1908 A
1260 V
(18679)210 648 A
(pid_t)210 1026 A
(lpid;)210 1278 A
1350 V
(18680)210 648 A
1026({)S
1440 V
(18681)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rmp;)210 2034 A
1530 V
(18682)210 648 A
1620 V
(18683)210 648 A
(for)126 1110 A
(\(rmp)168 1278 A
1488(=)S
(&mproc[INIT_PROC_NR)798 1572 A
2412(+)S
(1];)126 2496 A
(rmp)126 2664 A
2832(<)S
(&mproc[NR_PROCS];)714 2916 A
(rmp++\))252 3672 A
1710 V
(18684)210 648 A
1362(if)S
(\(rmp->mp_flags)588 1488 A
2118(&)S
(IN_USE)252 2202 A
2496(&&)S
(rmp->mp_pid)462 2622 A
3126(==)S
(lpid\))210 3252 A
(return\(rmp\);)504 3504 A
1800 V
(18685)210 648 A
(return\(NIL_MPROC\);)756 1110 A
1890 V
(18686)210 648 A
1026(})S
2070 V
(18688)210 648 A
(/*===========================================================================*)3276 1026 A
2160 V
(18689)210 648 A
1068(*)S
(stop_proc)378 2370 A
4260(*)S
2250 V
(18690)210 648 A
(*===========================================================================*/)3276 1068 A
2340 V
(18691)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(stop_proc\(rmp,)588 1530 A
(signo\))252 2160 A
2430 V
(18692)210 648 A
(register)336 1026 A
(struct)252 1404 A
(mproc)210 1698 A
(*rmp;)210 1950 A
2520 V
(18693)210 648 A
(int)126 1026 A
(signo;)252 1194 A
2610 V
(18694)210 648 A
1026({)S
2700 V
(18695)210 648 A
1026(/*)S
1152(A)S
(traced)252 1236 A
(process)294 1530 A
(got)126 1866 A
2034(a)S
(signal)252 2118 A
2412(so)S
(stop)168 2538 A
(it.)126 2748 A
2916(*/)S
2790 V
(18696)210 648 A
2880 V
(18697)210 648 A
(register)336 1110 A
(struct)252 1488 A
(mproc)210 1782 A
(*rpmp)210 2034 A
2286(=)S
(mproc)210 2370 A
2622(+)S
(rmp->mp_parent;)630 2706 A
2970 V
(18698)210 648 A
3060 V
(18699)210 648 A
1110(if)S
(\(sys_trace\(-1,)588 1236 A
(\(int\))210 1866 A
(\(rmp)168 2118 A
2328(-)S
(mproc\),)294 2412 A
(0L,)126 2748 A
(\(long)210 2916 A
3168(*\))S
3294(0\))S
3420(!=)S
(OK\))126 3546 A
(return;)294 3714 A
3150 V
(18700)210 648 A
(rmp->mp_flags)546 1110 A
1698(|=)S
(STOPPED;)336 1824 A
3240 V
(18701)210 648 A
1110(if)S
(\(rpmp->mp_flags)630 1236 A
1908(&)S
(WAITING\))336 1992 A
2370({)S
3330 V
(18702)210 648 A
(rpmp->mp_flags)588 1362 A
1992(&=)S
(\304WAITING;)378 2118 A
2706(/*)S
(parent)252 2832 A
3126(is)S
3252(no)S
(longer)252 3378 A
(waiting)294 3672 A
4008(*/)S
3420 V
(18703)210 648 A
(reply\(rmp->mp_parent,)882 1362 A
(rmp->mp_pid,)504 2286 A
(0177)168 2832 A
3042(|)S
(\(signo)252 3126 A
3420(<<)S
(8\),)126 3546 A
(NIL_PTR\);)378 3714 A
3510 V
(18704)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3600 V
(18705)210 648 A
(rmp->mp_sigstatus)714 1362 A
2118(=)S
(signo;)252 2202 A
3690 V
(18706)210 648 A
1110(})S
3780 V
(18707)210 648 A
(return;)294 1110 A
3870 V
(18708)210 648 A
1026(})S
4140 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4230 V
(src/mm/alloc.c)588 2034 A
4320 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4500 V
(18800)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
1572(is)S
(concerned)378 1698 A
(with)168 2118 A
(allocating)420 2328 A
(and)126 2790 A
(freeing)294 2958 A
(arbitrary-size)588 3294 A
(blocks)252 3924 A
4218(of)S
4590 V
(18801)210 648 A
1068(*)S
(physical)336 1152 A
(memory)252 1530 A
1824(on)S
(behalf)252 1950 A
2244(of)S
(the)126 2370 A
(FORK)168 2538 A
(and)126 2748 A
(EXEC)168 2916 A
(system)252 3126 A
(calls.)252 3420 A
(The)126 3756 A
(key)126 3924 A
(data)168 4092 A
4680 V
(18802)210 648 A
1068(*)S
(structure)378 1152 A
(used)168 1572 A
1782(is)S
(the)126 1908 A
(hole)168 2076 A
(table,)252 2286 A
(which)210 2580 A
(maintains)378 2832 A
3252(a)S
(list)168 3336 A
3546(of)S
(holes)210 3672 A
3924(in)S
(memory.)294 4050 A
4770 V
(18803)210 648 A
1068(*)S
1152(It)S
1278(is)S
(kept)168 1404 A
(sorted)252 1614 A
1908(in)S
(order)210 2034 A
2286(of)S
(increasing)420 2412 A
(memory)252 2874 A
(address.)336 3168 A
(The)126 3546 A
(addresses)378 3714 A
4860 V
(18804)210 648 A
1068(*)S
1152(it)S
(contains)336 1278 A
(refer)210 1656 A
1908(to)S
(physical)336 2034 A
(memory,)294 2412 A
(starting)336 2748 A
3126(at)S
(absolute)336 3252 A
(address)294 3630 A
3966(0)S
4950 V
(18805)210 648 A
1068(*)S
(\(i.e.,)252 1152 A
(they)168 1446 A
(are)126 1656 A
(not)126 1824 A
(relative)336 1992 A
2370(to)S
(the)126 2496 A
(start)210 2664 A
2916(of)S
(MM\).)168 3042 A
(During)252 3294 A
(system)252 3588 A
5040 V
(18806)210 648 A
1068(*)S
(initialization,)630 1152 A
(that)168 1824 A
(part)168 2034 A
2244(of)S
(memory)252 2370 A
(containing)420 2664 A
(the)126 3126 A
(interrupt)378 3294 A
(vectors,)336 3714 A
5130 V
(18807)210 648 A
1068(*)S
(kernel,)294 1152 A
(and)126 1488 A
1656(MM)S
(are)126 1782 A
("allocated")462 1950 A
2454(to)S
(mark)168 2580 A
(them)168 2790 A
3000(as)S
(not)126 3126 A
(available)378 3294 A
(and)126 3714 A
3882(to)S
5220 V
(18808)210 648 A
1068(*)S
(remove)252 1152 A
(them)168 1446 A
(from)168 1656 A
(the)126 1866 A
(hole)168 2034 A
(list.)210 2244 A
5310 V
(18809)210 648 A
1068(*)S
5400 V
(18810)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are:)168 2496 A
5490 V
(18811)210 648 A
1068(*)S
(alloc_mem:)420 1236 A
(allocate)336 1698 A
2076(a)S
(given)210 2160 A
(sized)210 2412 A
(chunk)210 2664 A
2916(of)S
(memory)252 3042 A
5580 V
(18812)210 648 A
1068(*)S
(free_mem:)378 1236 A
(release)294 1698 A
2034(a)S
(previously)420 2118 A
(allocated)378 2580 A
(chunk)210 3000 A
3252(of)S
(memory)252 3378 A
5670 V
(18813)210 648 A
1068(*)S
(mem_init:)378 1236 A
(initialize)420 1698 A
(the)126 2160 A
(tables)252 2328 A
(when)168 2622 A
2832(MM)S
(start)210 2958 A
3210(up)S
5760 V
(18814)210 648 A
1068(*)S
(max_hole:)378 1236 A
(returns)294 1698 A
(the)126 2034 A
(largest)294 2202 A
(hole)168 2538 A
(currently)378 2748 A
(available)378 3168 A
5850 V
(18815)210 648 A
1068(*/)S
5940 V
(18816)210 648 A
6030 V
(18817)210 648 A
(#include)336 1026 A
("mm.h")252 1404 A
6120 V
(18818)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
6210 V
(18819)210 648 A
8418 V
EP
%%Page: 262 262
BP
/slant 0 def
/height 0 def
630 V
12 B
(262)180 648 A
11 R
2092(File:)S
2325(src/mm/alloc.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(18820)210 648 A
(#define)294 1026 A
(NR_HOLES)336 1362 A
(128)126 2076 A
2370(/*)S
(max)126 2496 A
2664(#)S
(entries)294 2748 A
3084(in)S
(hole)168 3210 A
(table)210 3420 A
3672(*/)S
990 V
(18821)210 648 A
(#define)294 1026 A
(NIL_HOLE)336 1362 A
(\(struct)294 1740 A
(hole)168 2076 A
2286(*\))S
2412(0)S
1080 V
(18822)210 648 A
1170 V
(18823)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(hole)168 1656 A
1866({)S
1260 V
(18824)210 648 A
(phys_clicks)462 1110 A
(h_base;)294 1614 A
2370(/*)S
(where)210 2496 A
(does)168 2748 A
(the)126 2958 A
(hole)168 3126 A
(begin?)252 3336 A
3630(*/)S
1350 V
(18825)210 648 A
(phys_clicks)462 1110 A
(h_len;)252 1614 A
2370(/*)S
(how)126 2496 A
(big)126 2664 A
2832(is)S
(the)126 2958 A
(hole?)210 3126 A
3378(*/)S
1440 V
(18826)210 648 A
(struct)252 1110 A
(hole)168 1404 A
(*h_next;)336 1614 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(next)168 2958 A
(entry)210 3168 A
3420(on)S
(the)126 3546 A
(list)168 3714 A
3924(*/)S
1530 V
(18827)210 648 A
1026(})S
(hole[NR_HOLES];)630 1110 A
1620 V
(18828)210 648 A
1710 V
(18829)210 648 A
1800 V
(18830)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(hole)168 1656 A
(*hole_head;)462 1866 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(first)210 2958 A
(hole)168 3210 A
3420(*/)S
1890 V
(18831)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(hole)168 1656 A
(*free_slots;)504 1866 A
2706(/*)S
(ptr)126 2832 A
3000(to)S
(list)168 3126 A
3336(of)S
(unused)252 3462 A
(table)210 3756 A
(slots)210 4008 A
4260(*/)S
1980 V
(18832)210 648 A
2070 V
(18833)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(del_slot,)378 2076 A
(\(struct)294 2496 A
(hole)168 2832 A
(*prev_ptr,)420 3042 A
(struct)252 3504 A
(hole)168 3798 A
(*hp\))168 4008 A
4218(\);)S
2160 V
(18834)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(merge,)252 2076 A
(\(struct)294 2370 A
(hole)168 2706 A
(*hp\))168 2916 A
4218(\);)S
2250 V
(18835)210 648 A
2340 V
(18836)210 648 A
2430 V
(18837)210 648 A
(/*===========================================================================*)3276 1026 A
2520 V
(18838)210 648 A
1068(*)S
(alloc_mem)378 2370 A
4260(*)S
2610 V
(18839)210 648 A
(*===========================================================================*/)3276 1068 A
2700 V
(18840)210 648 A
(PUBLIC)252 1026 A
(phys_clicks)462 1320 A
(alloc_mem\(clicks\))714 1824 A
2790 V
(18841)210 648 A
(phys_clicks)462 1026 A
(clicks;)294 1530 A
2370(/*)S
(amount)252 2496 A
2790(of)S
(memory)252 2916 A
(requested)378 3210 A
3630(*/)S
2880 V
(18842)210 648 A
1026({)S
2970 V
(18843)210 648 A
1026(/*)S
(Allocate)336 1152 A
1530(a)S
(block)210 1614 A
1866(of)S
(memory)252 1992 A
(from)168 2286 A
(the)126 2496 A
(free)168 2664 A
(list)168 2874 A
(using)210 3084 A
(first)210 3336 A
(fit.)168 3588 A
(The)126 3798 A
(block)210 3966 A
3060 V
(18844)210 648 A
1068(*)S
(consists)336 1152 A
1530(of)S
1656(a)S
(sequence)336 1740 A
2118(of)S
(contiguous)420 2244 A
(bytes,)252 2706 A
(whose)210 3000 A
(length)252 3252 A
3546(in)S
(clicks)252 3672 A
3966(is)S
3150 V
(18845)210 648 A
1068(*)S
(given)210 1152 A
1404(by)S
('clicks'.)378 1530 A
1992(A)S
(pointer)294 2076 A
2412(to)S
(the)126 2538 A
(block)210 2706 A
2958(is)S
(returned.)378 3084 A
(The)126 3546 A
(block)210 3714 A
3966(is)S
3240 V
(18846)210 648 A
1068(*)S
(always)252 1152 A
1446(on)S
1572(a)S
(click)210 1656 A
(boundary.)378 1908 A
(This)168 2370 A
(procedure)378 2580 A
3000(is)S
(called)252 3126 A
(when)168 3420 A
(memory)252 3630 A
3924(is)S
3330 V
(18847)210 648 A
1068(*)S
(needed)252 1152 A
(for)126 1446 A
(FORK)168 1614 A
1824(or)S
(EXEC.)210 1950 A
3420 V
(18848)210 648 A
1068(*/)S
3510 V
(18849)210 648 A
3600 V
(18850)210 648 A
(register)336 1110 A
(struct)252 1488 A
(hole)168 1782 A
(*hp,)168 1992 A
(*prev_ptr;)420 2202 A
3690 V
(18851)210 648 A
(phys_clicks)462 1110 A
(old_base;)378 1614 A
3780 V
(18852)210 648 A
3870 V
(18853)210 648 A
1110(hp)S
1236(=)S
(hole_head;)420 1320 A
3960 V
(18854)210 648 A
(while)210 1110 A
(\(hp)126 1362 A
1530(!=)S
(NIL_HOLE\))378 1656 A
2076({)S
4050 V
(18855)210 648 A
1362(if)S
(\(hp->h_len)420 1488 A
1950(>=)S
(clicks\))294 2076 A
2412({)S
4140 V
(18856)210 648 A
1698(/*)S
1824(We)S
(found)210 1950 A
2202(a)S
(hole)168 2286 A
(that)168 2496 A
2706(is)S
(big)126 2832 A
(enough.)294 3000 A
(Use)126 3378 A
(it.)126 3546 A
3714(*/)S
4230 V
(18857)210 648 A
(old_base)336 1698 A
2076(=)S
(hp->h_base;)462 2160 A
2706(/*)S
(remember)336 2832 A
(where)210 3210 A
3462(it)S
(started)294 3588 A
3924(*/)S
4320 V
(18858)210 648 A
(hp->h_base)420 1698 A
2160(+=)S
(clicks;)294 2286 A
2706(/*)S
(bite)168 2832 A
3042(a)S
(piece)210 3126 A
(off)126 3378 A
3546(*/)S
4410 V
(18859)210 648 A
(hp->h_len)378 1698 A
2118(-=)S
(clicks;)294 2244 A
2706(/*)S
(ditto)210 2832 A
3084(*/)S
4500 V
(18860)210 648 A
4590 V
(18861)210 648 A
1698(/*)S
1824(If)S
(hole)168 1950 A
2160(is)S
(only)168 2286 A
(partly)252 2496 A
(used,)210 2790 A
(reduce)252 3042 A
(size)168 3336 A
(and)126 3546 A
(return.)294 3714 A
4050(*/)S
4680 V
(18862)210 648 A
1698(if)S
(\(hp->h_len)420 1824 A
2286(!=)S
2412(0\))S
(return\(old_base\);)714 2538 A
4770 V
(18863)210 648 A
4860 V
(18864)210 648 A
1698(/*)S
(The)126 1824 A
(entire)252 1992 A
(hole)168 2286 A
(has)126 2496 A
(been)168 2664 A
(used)168 2874 A
(up.)126 3084 A
(Manipulate)420 3294 A
(free)168 3756 A
(list.)210 3966 A
4218(*/)S
4950 V
(18865)210 648 A
(del_slot\(prev_ptr,)756 1698 A
(hp\);)168 2496 A
5040 V
(18866)210 648 A
(return\(old_base\);)714 1698 A
5130 V
(18867)210 648 A
1362(})S
5220 V
(18868)210 648 A
5310 V
(18869)210 648 A
(prev_ptr)336 1362 A
1740(=)S
(hp;)126 1824 A
5400 V
(18870)210 648 A
1362(hp)S
1488(=)S
(hp->h_next;)462 1572 A
5490 V
(18871)210 648 A
1110(})S
5580 V
(18872)210 648 A
(return\(NO_MEM\);)630 1110 A
5670 V
(18873)210 648 A
1026(})S
5940 V
(18876)210 648 A
(/*===========================================================================*)3276 1026 A
6030 V
(18877)210 648 A
1068(*)S
(free_mem)336 2370 A
4260(*)S
6120 V
(18878)210 648 A
(*===========================================================================*/)3276 1068 A
6210 V
(18879)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(free_mem\(base,)588 1530 A
(clicks\))294 2160 A
8418 V
EP
%%Page: 263 263
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2092(File:)S
2325(src/mm/alloc.c)S
12 B
(263)180 4248 A
900 V
7 LST
(18880)210 648 A
(phys_clicks)462 1026 A
(base;)210 1530 A
2370(/*)S
(base)168 2496 A
(address)294 2706 A
3042(of)S
(block)210 3168 A
3420(to)S
(free)168 3546 A
3756(*/)S
990 V
(18881)210 648 A
(phys_clicks)462 1026 A
(clicks;)294 1530 A
2370(/*)S
(number)252 2496 A
2790(of)S
(clicks)252 2916 A
3210(to)S
(free)168 3336 A
3546(*/)S
1080 V
(18882)210 648 A
1026({)S
1170 V
(18883)210 648 A
1026(/*)S
(Return)252 1152 A
1446(a)S
(block)210 1530 A
1782(of)S
(free)168 1908 A
(memory)252 2118 A
2412(to)S
(the)126 2538 A
(hole)168 2706 A
(list.)210 2916 A
(The)126 3210 A
(parameters)420 3378 A
(tell)168 3840 A
(where)210 4050 A
1260 V
(18884)210 648 A
1068(*)S
(the)126 1152 A
(block)210 1320 A
(starts)252 1572 A
1866(in)S
(physical)336 1992 A
(memory)252 2370 A
(and)126 2664 A
(how)126 2832 A
(big)126 3000 A
3168(it)S
(is.)126 3294 A
(The)126 3504 A
(block)210 3672 A
3924(is)S
(added)210 4050 A
1350 V
(18885)210 648 A
1068(*)S
1152(to)S
(the)126 1278 A
(hole)168 1446 A
(list.)210 1656 A
1950(If)S
2076(it)S
2202(is)S
(contiguous)420 2328 A
(with)168 2790 A
3000(an)S
(existing)336 3126 A
(hole)168 3504 A
3714(on)S
(either)252 3840 A
(end,)168 4134 A
1440 V
(18886)210 648 A
1068(*)S
1152(it)S
1278(is)S
(merged)252 1404 A
(with)168 1698 A
(the)126 1908 A
(hole)168 2076 A
2286(or)S
(holes.)252 2412 A
1530 V
(18887)210 648 A
1068(*/)S
1620 V
(18888)210 648 A
1710 V
(18889)210 648 A
(register)336 1110 A
(struct)252 1488 A
(hole)168 1782 A
(*hp,)168 1992 A
(*new_ptr,)378 2202 A
(*prev_ptr;)420 2622 A
1800 V
(18890)210 648 A
1890 V
(18891)210 648 A
1110(if)S
(\(clicks)294 1236 A
1572(==)S
1698(0\))S
(return;)294 1824 A
1980 V
(18892)210 648 A
1110(if)S
1236(\()S
(\(new_ptr)336 1320 A
1698(=)S
(free_slots\))462 1782 A
2286(==)S
(NIL_HOLE\))378 2412 A
(panic\("Hole)462 2832 A
(table)210 3336 A
(full",)252 3588 A
(NO_NUM\);)336 3882 A
2070 V
(18893)210 648 A
(new_ptr->h_base)630 1110 A
1782(=)S
(base;)210 1866 A
2160 V
(18894)210 648 A
(new_ptr->h_len)588 1110 A
1740(=)S
(clicks;)294 1824 A
2250 V
(18895)210 648 A
(free_slots)420 1110 A
1572(=)S
(new_ptr->h_next;)672 1656 A
2340 V
(18896)210 648 A
1110(hp)S
1236(=)S
(hole_head;)420 1320 A
2430 V
(18897)210 648 A
2520 V
(18898)210 648 A
1110(/*)S
1236(If)S
(this)168 1362 A
(block's)294 1572 A
(address)294 1908 A
2244(is)S
(numerically)462 2370 A
(less)168 2874 A
(than)168 3084 A
(the)126 3294 A
(lowest)252 3462 A
(hole)168 3756 A
(currently)378 3966 A
2610 V
(18899)210 648 A
1152(*)S
(available,)420 1236 A
1698(or)S
1824(if)S
1950(no)S
(holes)210 2076 A
(are)126 2328 A
(currently)378 2496 A
(available,)420 2916 A
(put)126 3378 A
(this)168 3546 A
(hole)168 3756 A
3966(on)S
(the)126 4092 A
2700 V
(18900)210 648 A
1152(*)S
(front)210 1236 A
1488(of)S
(the)126 1614 A
(hole)168 1782 A
(list.)210 1992 A
2790 V
(18901)210 648 A
1152(*/)S
2880 V
(18902)210 648 A
1110(if)S
(\(hp)126 1236 A
1404(==)S
(NIL_HOLE)336 1530 A
1908(||)S
(base)168 2034 A
2244(<=)S
(hp->h_base\))462 2370 A
2874({)S
2970 V
(18903)210 648 A
1362(/*)S
(Block)210 1488 A
1740(to)S
1866(be)S
(freed)210 1992 A
(goes)168 2244 A
2454(on)S
(front)210 2580 A
2832(of)S
(the)126 2958 A
(hole)168 3126 A
(list.)210 3336 A
3588(*/)S
3060 V
(18904)210 648 A
(new_ptr->h_next)630 1362 A
2034(=)S
(hp;)126 2118 A
3150 V
(18905)210 648 A
(hole_head)378 1362 A
1782(=)S
(new_ptr;)336 1866 A
3240 V
(18906)210 648 A
(merge\(new_ptr\);)630 1362 A
3330 V
(18907)210 648 A
(return;)294 1362 A
3420 V
(18908)210 648 A
1110(})S
3510 V
(18909)210 648 A
3600 V
(18910)210 648 A
1110(/*)S
(Block)210 1236 A
1488(to)S
1614(be)S
(returned)336 1740 A
(does)168 2118 A
(not)126 2328 A
2496(go)S
2622(on)S
(front)210 2748 A
3000(of)S
(hole)168 3126 A
(list.)210 3336 A
3588(*/)S
3690 V
(18911)210 648 A
(while)210 1110 A
(\(hp)126 1362 A
1530(!=)S
(NIL_HOLE)336 1656 A
2034(&&)S
(base)168 2160 A
2370(>)S
(hp->h_base\))462 2454 A
2958({)S
3780 V
(18912)210 648 A
(prev_ptr)336 1362 A
1740(=)S
(hp;)126 1824 A
3870 V
(18913)210 648 A
1362(hp)S
1488(=)S
(hp->h_next;)462 1572 A
3960 V
(18914)210 648 A
1110(})S
4050 V
(18915)210 648 A
4140 V
(18916)210 648 A
1110(/*)S
1236(We)S
(found)210 1362 A
(where)210 1614 A
1866(it)S
(goes.)210 1992 A
(Insert)252 2286 A
(block)210 2580 A
(after)210 2832 A
('prev_ptr'.)462 3084 A
3588(*/)S
4230 V
(18917)210 648 A
(new_ptr->h_next)630 1110 A
1782(=)S
(prev_ptr->h_next;)714 1866 A
4320 V
(18918)210 648 A
(prev_ptr->h_next)672 1110 A
1824(=)S
(new_ptr;)336 1908 A
4410 V
(18919)210 648 A
(merge\(prev_ptr\);)672 1110 A
2370(/*)S
(sequence)336 2496 A
2874(is)S
('prev_ptr',)462 3000 A
('new_ptr',)420 3504 A
('hp')168 3966 A
4176(*/)S
4500 V
(18920)210 648 A
1026(})S
4770 V
(18923)210 648 A
(/*===========================================================================*)3276 1026 A
4860 V
(18924)210 648 A
1068(*)S
(del_slot)336 2370 A
4260(*)S
4950 V
(18925)210 648 A
(*===========================================================================*/)3276 1068 A
5040 V
(18926)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(del_slot\(prev_ptr,)756 1572 A
(hp\))126 2370 A
5130 V
(18927)210 648 A
(register)336 1026 A
(struct)252 1404 A
(hole)168 1698 A
(*prev_ptr;)420 1908 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(hole)168 2958 A
(entry)210 3168 A
(just)168 3420 A
(ahead)210 3630 A
3882(of)S
('hp')168 4008 A
4218(*/)S
5220 V
(18928)210 648 A
(register)336 1026 A
(struct)252 1404 A
(hole)168 1698 A
(*hp;)168 1908 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(hole)168 2958 A
(entry)210 3168 A
3420(to)S
3546(be)S
(removed)294 3672 A
4008(*/)S
5310 V
(18929)210 648 A
1026({)S
5400 V
(18930)210 648 A
1026(/*)S
(Remove)252 1152 A
1446(an)S
(entry)210 1572 A
(from)168 1824 A
(the)126 2034 A
(hole)168 2202 A
(list.)210 2412 A
(This)168 2706 A
(procedure)378 2916 A
3336(is)S
(called)252 3462 A
(when)168 3756 A
3966(a)S
5490 V
(18931)210 648 A
1068(*)S
(request)294 1152 A
1488(to)S
(allocate)336 1614 A
(memory)252 1992 A
(removes)294 2286 A
2622(a)S
(hole)168 2706 A
2916(in)S
(its)126 3042 A
(entirety,)378 3210 A
(thus)168 3630 A
(reducing)336 3840 A
5580 V
(18932)210 648 A
1068(*)S
(the)126 1152 A
(numbers)294 1320 A
1656(of)S
(holes)210 1782 A
2034(in)S
(memory,)294 2160 A
(and)126 2496 A
(requiring)378 2664 A
(the)126 3084 A
(elimination)462 3252 A
3756(of)S
(one)126 3882 A
5670 V
(18933)210 648 A
1068(*)S
(entry)210 1152 A
1404(in)S
(the)126 1530 A
(hole)168 1698 A
(list.)210 1908 A
5760 V
(18934)210 648 A
1068(*/)S
5850 V
(18935)210 648 A
5940 V
(18936)210 648 A
1110(if)S
(\(hp)126 1236 A
1404(==)S
(hole_head\))420 1530 A
6030 V
(18937)210 648 A
(hole_head)378 1362 A
1782(=)S
(hp->h_next;)462 1866 A
6120 V
(18938)210 648 A
(else)168 1110 A
6210 V
(18939)210 648 A
(prev_ptr->h_next)672 1362 A
2076(=)S
(hp->h_next;)462 2160 A
8418 V
EP
%%Page: 264 264
BP
/slant 0 def
/height 0 def
630 V
12 B
(264)180 648 A
11 R
2092(File:)S
2325(src/mm/alloc.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(18940)210 648 A
990 V
(18941)210 648 A
(hp->h_next)420 1110 A
1572(=)S
(free_slots;)462 1656 A
1080 V
(18942)210 648 A
(free_slots)420 1110 A
1572(=)S
(hp;)126 1656 A
1170 V
(18943)210 648 A
1026(})S
1440 V
(18946)210 648 A
(/*===========================================================================*)3276 1026 A
1530 V
(18947)210 648 A
1068(*)S
(merge)210 2370 A
4260(*)S
1620 V
(18948)210 648 A
(*===========================================================================*/)3276 1068 A
1710 V
(18949)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(merge\(hp\))378 1572 A
1800 V
(18950)210 648 A
(register)336 1026 A
(struct)252 1404 A
(hole)168 1698 A
(*hp;)168 1908 A
2370(/*)S
(ptr)126 2496 A
2664(to)S
(hole)168 2790 A
3000(to)S
(merge)210 3126 A
(with)168 3378 A
(its)126 3588 A
(successors)420 3756 A
4218(*/)S
1890 V
(18951)210 648 A
1026({)S
1980 V
(18952)210 648 A
1026(/*)S
(Check)210 1152 A
(for)126 1404 A
(contiguous)420 1572 A
(holes)210 2034 A
(and)126 2286 A
(merge)210 2454 A
(any)126 2706 A
(found.)252 2874 A
(Contiguous)420 3210 A
(holes)210 3672 A
(can)126 3924 A
(occur)210 4092 A
2070 V
(18953)210 648 A
1068(*)S
(when)168 1152 A
1362(a)S
(block)210 1446 A
1698(of)S
(memory)252 1824 A
2118(is)S
(freed,)252 2244 A
(and)126 2538 A
2706(it)S
(happens)294 2832 A
3168(to)S
(abut)168 3294 A
(another)294 3504 A
(hole)168 3840 A
4050(on)S
2160 V
(18954)210 648 A
1068(*)S
(either)252 1152 A
1446(or)S
(both)168 1572 A
(ends.)210 1782 A
(The)126 2076 A
(pointer)294 2244 A
('hp')168 2580 A
(points)252 2790 A
3084(to)S
(the)126 3210 A
(first)210 3378 A
3630(of)S
3756(a)S
(series)252 3840 A
4134(of)S
2250 V
(18955)210 648 A
1068(*)S
(three)210 1152 A
(holes)210 1404 A
(that)168 1656 A
(can)126 1866 A
(potentially)462 2034 A
(all)126 2538 A
2706(be)S
(merged)252 2832 A
(together.)378 3126 A
2340 V
(18956)210 648 A
1068(*/)S
2430 V
(18957)210 648 A
2520 V
(18958)210 648 A
(register)336 1110 A
(struct)252 1488 A
(hole)168 1782 A
(*next_ptr;)420 1992 A
2610 V
(18959)210 648 A
2700 V
(18960)210 648 A
1110(/*)S
1236(If)S
('hp')168 1362 A
(points)252 1572 A
1866(to)S
(the)126 1992 A
(last)168 2160 A
(hole,)210 2370 A
2622(no)S
(merging)294 2748 A
3084(is)S
(possible.)378 3210 A
3672(If)S
3798(it)S
(does)168 3924 A
(not,)168 4134 A
2790 V
(18961)210 648 A
1152(*)S
(try)126 1236 A
1404(to)S
(absorb)252 1530 A
(its)126 1824 A
(successor)378 1992 A
(into)168 2412 A
2622(it)S
(and)126 2748 A
(free)168 2916 A
(the)126 3126 A
(successor's)462 3294 A
(table)210 3798 A
(entry.)252 4050 A
2880 V
(18962)210 648 A
1152(*/)S
2970 V
(18963)210 648 A
1110(if)S
1236(\()S
(\(next_ptr)378 1320 A
1740(=)S
(hp->h_next\))462 1824 A
2328(==)S
(NIL_HOLE\))378 2454 A
(return;)294 2874 A
3060 V
(18964)210 648 A
1110(if)S
(\(hp->h_base)462 1236 A
1740(+)S
(hp->h_len)378 1824 A
2244(==)S
(next_ptr->h_base\))714 2370 A
3126({)S
3150 V
(18965)210 648 A
(hp->h_len)378 1362 A
1782(+=)S
(next_ptr->h_len;)672 1908 A
2706(/*)S
(first)210 2832 A
(one)126 3084 A
(gets)168 3252 A
(second)252 3462 A
(one's)210 3756 A
(mem)126 4008 A
4176(*/)S
3240 V
(18966)210 648 A
(del_slot\(hp,)504 1362 A
(next_ptr\);)420 1908 A
3330 V
(18967)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3420 V
(18968)210 648 A
1362(hp)S
1488(=)S
(next_ptr;)378 1572 A
3510 V
(18969)210 648 A
1110(})S
3600 V
(18970)210 648 A
3690 V
(18971)210 648 A
1110(/*)S
1236(If)S
('hp')168 1362 A
(now)126 1572 A
(points)252 1740 A
2034(to)S
(the)126 2160 A
(last)168 2328 A
(hole,)210 2538 A
(return;)294 2790 A
(otherwise,)420 3126 A
(try)126 3588 A
3756(to)S
(absorb)252 3882 A
(its)126 4176 A
3780 V
(18972)210 648 A
1152(*)S
(successor)378 1236 A
(into)168 1656 A
(it.)126 1866 A
3870 V
(18973)210 648 A
1152(*/)S
3960 V
(18974)210 648 A
1110(if)S
1236(\()S
(\(next_ptr)378 1320 A
1740(=)S
(hp->h_next\))462 1824 A
2328(==)S
(NIL_HOLE\))378 2454 A
(return;)294 2874 A
4050 V
(18975)210 648 A
1110(if)S
(\(hp->h_base)462 1236 A
1740(+)S
(hp->h_len)378 1824 A
2244(==)S
(next_ptr->h_base\))714 2370 A
3126({)S
4140 V
(18976)210 648 A
(hp->h_len)378 1362 A
1782(+=)S
(next_ptr->h_len;)672 1908 A
4230 V
(18977)210 648 A
(del_slot\(hp,)504 1362 A
(next_ptr\);)420 1908 A
4320 V
(18978)210 648 A
1110(})S
4410 V
(18979)210 648 A
1026(})S
4680 V
(18982)210 648 A
(/*===========================================================================*)3276 1026 A
4770 V
(18983)210 648 A
1068(*)S
(max_hole)336 2370 A
4260(*)S
4860 V
(18984)210 648 A
(*===========================================================================*/)3276 1068 A
4950 V
(18985)210 648 A
(PUBLIC)252 1026 A
(phys_clicks)462 1320 A
(max_hole\(\))420 1824 A
5040 V
(18986)210 648 A
1026({)S
5130 V
(18987)210 648 A
1026(/*)S
(Scan)168 1152 A
(the)126 1362 A
(hole)168 1530 A
(list)168 1740 A
(and)126 1950 A
(return)252 2118 A
(the)126 2412 A
(largest)294 2580 A
(hole.)210 2916 A
3168(*/)S
5220 V
(18988)210 648 A
5310 V
(18989)210 648 A
(register)336 1110 A
(struct)252 1488 A
(hole)168 1782 A
(*hp;)168 1992 A
5400 V
(18990)210 648 A
(register)336 1110 A
(phys_clicks)462 1488 A
(max;)168 1992 A
5490 V
(18991)210 648 A
5580 V
(18992)210 648 A
1110(hp)S
1236(=)S
(hole_head;)420 1320 A
5670 V
(18993)210 648 A
(max)126 1110 A
1278(=)S
1362(0;)S
5760 V
(18994)210 648 A
(while)210 1110 A
(\(hp)126 1362 A
1530(!=)S
(NIL_HOLE\))378 1656 A
2076({)S
5850 V
(18995)210 648 A
1362(if)S
(\(hp->h_len)420 1488 A
1950(>)S
(max\))168 2034 A
(max)126 2244 A
2412(=)S
(hp->h_len;)420 2496 A
5940 V
(18996)210 648 A
1362(hp)S
1488(=)S
(hp->h_next;)462 1572 A
6030 V
(18997)210 648 A
1110(})S
6120 V
(18998)210 648 A
(return\(max\);)504 1110 A
6210 V
(18999)210 648 A
1026(})S
8418 V
EP
%%Page: 265 265
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2092(File:)S
2325(src/mm/alloc.c)S
12 B
(265)180 4248 A
1080 V
7 LST
(19002)210 648 A
(/*===========================================================================*)3276 1026 A
1170 V
(19003)210 648 A
1068(*)S
(mem_init)336 2370 A
4260(*)S
1260 V
(19004)210 648 A
(*===========================================================================*/)3276 1068 A
1350 V
(19005)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(mem_init\(total,)630 1530 A
(free\))210 2202 A
1440 V
(19006)210 648 A
(phys_clicks)462 1026 A
(*total,)294 1530 A
(*free;)252 1866 A
2706(/*)S
(memory)252 2832 A
(size)168 3126 A
(summaries)378 3336 A
3756(*/)S
1530 V
(19007)210 648 A
1026({)S
1620 V
(19008)210 648 A
1026(/*)S
(Initialize)420 1152 A
(hole)168 1614 A
(lists.)252 1824 A
(There)210 2160 A
(are)126 2412 A
(two)126 2580 A
(lists:)252 2748 A
('hole_head')462 3042 A
(points)252 3546 A
3840(to)S
3966(a)S
(linked)252 4050 A
1710 V
(19009)210 648 A
1068(*)S
(list)168 1152 A
1362(of)S
(all)126 1488 A
(the)126 1656 A
(holes)210 1824 A
(\(unused)294 2076 A
(memory\))294 2412 A
2748(in)S
(the)126 2874 A
(system;)294 3042 A
('free_slots')504 3378 A
(points)252 3924 A
4218(to)S
1800 V
(19010)210 648 A
1068(*)S
1152(a)S
(linked)252 1236 A
(list)168 1530 A
1740(of)S
(table)210 1866 A
(entries)294 2118 A
(that)168 2454 A
(are)126 2664 A
(not)126 2832 A
3000(in)S
(use.)168 3126 A
(Initially,)420 3378 A
(the)126 3840 A
(former)252 4008 A
1890 V
(19011)210 648 A
1068(*)S
(list)168 1152 A
(has)126 1362 A
(one)126 1530 A
(entry)210 1698 A
(for)126 1950 A
(each)168 2118 A
(chunk)210 2328 A
2580(of)S
(physical)336 2706 A
(memory,)294 3084 A
(and)126 3420 A
(the)126 3588 A
(second)252 3756 A
1980 V
(19012)210 648 A
1068(*)S
(list)168 1152 A
(links)210 1362 A
(together)336 1614 A
(the)126 1992 A
(remaining)378 2160 A
(table)210 2580 A
(slots.)252 2832 A
3168(As)S
(memory)252 3294 A
(becomes)294 3588 A
(more)168 3924 A
2070 V
(19013)210 648 A
1068(*)S
(fragmented)420 1152 A
1614(in)S
(the)126 1740 A
(course)252 1908 A
2202(of)S
(time)168 2328 A
(\(i.e.,)252 2538 A
(the)126 2832 A
(initial)294 3000 A
(big)126 3336 A
(holes)210 3504 A
(break)210 3756 A
4008(up)S
(into)168 4134 A
2160 V
(19014)210 648 A
1068(*)S
(smaller)294 1152 A
(holes\),)294 1488 A
(new)126 1824 A
(table)210 1992 A
(slots)210 2244 A
(are)126 2496 A
(needed)252 2664 A
2958(to)S
(represent)378 3084 A
(them.)210 3504 A
(These)210 3798 A
(slots)210 4050 A
2250 V
(19015)210 648 A
1068(*)S
(are)126 1152 A
(taken)210 1320 A
(from)168 1572 A
(the)126 1782 A
(list)168 1950 A
(headed)252 2160 A
2454(by)S
('free_slots'.)546 2580 A
2340 V
(19016)210 648 A
1068(*/)S
2430 V
(19017)210 648 A
2520 V
(19018)210 648 A
(register)336 1110 A
(struct)252 1488 A
(hole)168 1782 A
(*hp;)168 1992 A
2610 V
(19019)210 648 A
(phys_clicks)462 1110 A
(base;)210 1614 A
2370(/*)S
(base)168 2496 A
(address)294 2706 A
3042(of)S
(chunk)210 3168 A
3420(*/)S
2700 V
(19020)210 648 A
(phys_clicks)462 1110 A
(size;)210 1614 A
2370(/*)S
(size)168 2496 A
2706(of)S
(chunk)210 2832 A
3084(*/)S
2790 V
(19021)210 648 A
(message)294 1110 A
(mess;)210 1446 A
2880 V
(19022)210 648 A
2970 V
(19023)210 648 A
1110(/*)S
(Put)126 1236 A
(all)126 1404 A
(holes)210 1572 A
1824(on)S
(the)126 1950 A
(free)168 2118 A
(list.)210 2328 A
2580(*/)S
3060 V
(19024)210 648 A
(for)126 1110 A
(\(hp)126 1278 A
1446(=)S
(&hole[0];)378 1530 A
1950(hp)S
2076(<)S
(&hole[NR_HOLES];)672 2160 A
(hp++\))210 2874 A
(hp->h_next)420 3126 A
3588(=)S
3672(hp)S
3798(+)S
3882(1;)S
3150 V
(19025)210 648 A
(hole[NR_HOLES-1].h_next)966 1110 A
2118(=)S
(NIL_HOLE;)378 2202 A
3240 V
(19026)210 648 A
(hole_head)378 1110 A
1530(=)S
(NIL_HOLE;)378 1614 A
3330 V
(19027)210 648 A
(free_slots)420 1110 A
1572(=)S
(&hole[0];)378 1656 A
3420 V
(19028)210 648 A
3510 V
(19029)210 648 A
1110(/*)S
(Ask)126 1236 A
(the)126 1404 A
(kernel)252 1572 A
(for)126 1866 A
(chunks)252 2034 A
2328(of)S
(physical)336 2454 A
(memory)252 2832 A
(and)126 3126 A
(allocate)336 3294 A
3672(a)S
(hole)168 3756 A
(for)126 3966 A
3600 V
(19030)210 648 A
1152(*)S
(each)168 1236 A
1446(of)S
(them.)210 1572 A
(The)126 1866 A
(SYS_MEM)294 2034 A
(call)168 2370 A
(responds)336 2580 A
(with)168 2958 A
(the)126 3168 A
(base)168 3336 A
(and)126 3546 A
(size)168 3714 A
3924(of)S
(the)126 4050 A
3690 V
(19031)210 648 A
1152(*)S
(next)168 1236 A
(chunk)210 1446 A
(and)126 1698 A
(the)126 1866 A
(total)210 2034 A
(amount)252 2286 A
2580(of)S
(memory.)294 2706 A
3780 V
(19032)210 648 A
1152(*/)S
3870 V
(19033)210 648 A
(*free)210 1110 A
1362(=)S
1446(0;)S
3960 V
(19034)210 648 A
(for)126 1110 A
(\(;;\))168 1278 A
1488({)S
4050 V
(19035)210 648 A
(mess.m_type)462 1362 A
1866(=)S
(SYS_MEM;)336 1950 A
4140 V
(19036)210 648 A
1362(if)S
(\(sendrec\(SYSTASK,)714 1488 A
(&mess\))252 2244 A
2538(!=)S
(OK\))126 2664 A
(panic\("bad)420 2832 A
(SYS_MEM?",)420 3294 A
(NO_NUM\);)336 3756 A
4230 V
(19037)210 648 A
(base)168 1362 A
1572(=)S
(mess.m1_i1;)462 1656 A
4320 V
(19038)210 648 A
(size)168 1362 A
1572(=)S
(mess.m1_i2;)462 1656 A
4410 V
(19039)210 648 A
1362(if)S
(\(size)210 1488 A
1740(==)S
1866(0\))S
(break;)252 1992 A
2706(/*)S
2832(no)S
(more?)210 2958 A
3210(*/)S
4500 V
(19040)210 648 A
4590 V
(19041)210 648 A
(free_mem\(base,)588 1362 A
(size\);)252 1992 A
4680 V
(19042)210 648 A
(*total)252 1362 A
1656(=)S
(mess.m1_i3;)462 1740 A
4770 V
(19043)210 648 A
(*free)210 1362 A
1614(+=)S
(size;)210 1740 A
4860 V
(19044)210 648 A
1110(})S
4950 V
(19045)210 648 A
1026(})S
8418 V
EP
%%Page: 266 266
BP
/slant 0 def
/height 0 def
630 V
12 B
(266)180 648 A
11 R
2068(File:)S
(src/mm/utility.c)707 2301 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/mm/utility.c)672 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(19100)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(some)168 1950 A
(utility)294 2160 A
(routines)336 2496 A
(for)126 2874 A
(MM.)126 3042 A
1440 V
(19101)210 648 A
1068(*)S
1530 V
(19102)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(are:)168 1866 A
1620 V
(19103)210 648 A
1068(*)S
(allowed:)336 1236 A
(see)126 1698 A
1866(if)S
1992(an)S
(access)252 2118 A
2412(is)S
(permitted)378 2538 A
1710 V
(19104)210 648 A
1068(*)S
(no_sys:)294 1236 A
(this)168 1698 A
(routine)294 1908 A
2244(is)S
(called)252 2370 A
(for)126 2664 A
(invalid)294 2832 A
(system)252 3168 A
(call)168 3462 A
(numbers)294 3672 A
1800 V
(19105)210 648 A
1068(*)S
(panic:)252 1236 A
1698(MM)S
(has)126 1824 A
(run)126 1992 A
(aground)294 2160 A
2496(of)S
2622(a)S
(fatal)210 2706 A
(error)210 2958 A
(and)126 3210 A
(cannot)252 3378 A
(continue)336 3672 A
1890 V
(19106)210 648 A
1068(*)S
(tell_fs:)336 1236 A
(interface)378 1698 A
2118(to)S
2244(FS)S
1980 V
(19107)210 648 A
1068(*/)S
2070 V
(19108)210 648 A
2160 V
(19109)210 648 A
(#include)336 1026 A
("mm.h")252 1404 A
2250 V
(19110)210 648 A
(#include)336 1026 A
(<sys/stat.h>)504 1404 A
2340 V
(19111)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
2430 V
(19112)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
2520 V
(19113)210 648 A
(#include)336 1026 A
(<fcntl.h>)378 1404 A
2610 V
(19114)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
2370(/*)S
(needed)252 2496 A
(only)168 2790 A
(because)294 3000 A
(mproc.h)294 3336 A
(needs)210 3672 A
3924(it)S
4050(*/)S
2700 V
(19115)210 648 A
(#include)336 1026 A
("mproc.h")378 1404 A
2790 V
(19116)210 648 A
2880 V
(19117)210 648 A
(/*===========================================================================*)3276 1026 A
2970 V
(19118)210 648 A
1068(*)S
(allowed)294 2370 A
4260(*)S
3060 V
(19119)210 648 A
(*===========================================================================*/)3276 1068 A
3150 V
(19120)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(allowed\(name_buf,)714 1488 A
(s_buf,)252 2244 A
(mask\))210 2538 A
3240 V
(19121)210 648 A
(char)168 1026 A
(*name_buf;)420 1236 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(file)168 2958 A
(name)168 3168 A
3378(to)S
3504(be)S
(EXECed)252 3630 A
3924(*/)S
3330 V
(19122)210 648 A
(struct)252 1026 A
(stat)168 1320 A
(*s_buf;)294 1530 A
2370(/*)S
(buffer)252 2496 A
(for)126 2790 A
(doing)210 2958 A
(and)126 3210 A
(returning)378 3378 A
(stat)168 3798 A
(struct*/)336 4008 A
3420 V
(19123)210 648 A
(int)126 1026 A
(mask;)210 1194 A
2370(/*)S
(R_BIT,)252 2496 A
(W_BIT,)252 2790 A
3084(or)S
(X_BIT)210 3210 A
3462(*/)S
3510 V
(19124)210 648 A
1026({)S
3600 V
(19125)210 648 A
1026(/*)S
(Check)210 1152 A
1404(to)S
(see)126 1530 A
1698(if)S
(file)168 1824 A
(can)126 2034 A
2202(be)S
(accessed.)378 2328 A
(Return)252 2790 A
(EACCES)252 3084 A
3378(or)S
(ENOENT)252 3504 A
3798(if)S
(the)126 3924 A
(access)252 4092 A
3690 V
(19126)210 648 A
1068(*)S
1152(is)S
(prohibited.)462 1278 A
1824(If)S
1950(it)S
2076(is)S
(legal)210 2202 A
(open)168 2454 A
(the)126 2664 A
(file)168 2832 A
(and)126 3042 A
(return)252 3210 A
3504(a)S
(file)168 3588 A
(descriptor.)462 3798 A
3780 V
(19127)210 648 A
1068(*/)S
3870 V
(19128)210 648 A
3960 V
(19129)210 648 A
(int)126 1110 A
(fd;)126 1278 A
4050 V
(19130)210 648 A
(int)126 1110 A
(save_errno;)462 1278 A
4140 V
(19131)210 648 A
4230 V
(19132)210 648 A
1110(/*)S
(Use)126 1236 A
(the)126 1404 A
(fact)168 1572 A
(that)168 1782 A
(mask)168 1992 A
(for)126 2202 A
(access\(\))336 2370 A
2748(is)S
(the)126 2874 A
(same)168 3042 A
3252(as)S
(the)126 3378 A
(permissions)462 3546 A
(mask.)210 4050 A
4320 V
(19133)210 648 A
1152(*)S
(E.g.,)210 1236 A
(X_BIT)210 1488 A
1740(in)S
(<minix/const.h>)630 1866 A
2538(is)S
(the)126 2664 A
(same)168 2832 A
3042(as)S
(X_OK)168 3168 A
3378(in)S
(<unistd.h>)420 3504 A
(and)126 3966 A
4410 V
(19134)210 648 A
1152(*)S
(S_IXOTH)294 1236 A
1572(in)S
(<sys/stat.h>.)546 1698 A
(tell_fs\(DO_CHDIR,)714 2328 A
(...\))168 3084 A
(has)126 3294 A
(set)126 3462 A
(MM's)168 3630 A
(real)168 3840 A
(ids)126 4050 A
4500 V
(19135)210 648 A
1152(*)S
1236(to)S
(the)126 1362 A
(user's)252 1530 A
(effective)378 1824 A
(ids,)168 2244 A
2454(so)S
(access\(\))336 2580 A
(works)210 2958 A
(right)210 3210 A
(for)126 3462 A
(setuid)252 3630 A
(programs.)378 3924 A
4590 V
(19136)210 648 A
1152(*/)S
4680 V
(19137)210 648 A
1110(if)S
(\(access\(name_buf,)714 1236 A
(mask\))210 1992 A
2244(<)S
2328(0\))S
(return\(-errno\);)630 2454 A
4770 V
(19138)210 648 A
4860 V
(19139)210 648 A
1110(/*)S
(The)126 1236 A
(file)168 1404 A
1614(is)S
(accessible)420 1740 A
(but)126 2202 A
(might)210 2370 A
(not)126 2622 A
2790(be)S
(readable.)378 2916 A
(Make)168 3378 A
3588(it)S
(readable.)378 3714 A
4134(*/)S
4950 V
(19140)210 648 A
(tell_fs\(SETUID,)630 1110 A
(MM_PROC_NR,)462 1782 A
(\(int\))210 2286 A
(SUPER_USER,)462 2538 A
(\(int\))210 3042 A
(SUPER_USER\);)504 3294 A
5040 V
(19141)210 648 A
5130 V
(19142)210 648 A
1110(/*)S
(Open)168 1236 A
(the)126 1446 A
(file)168 1614 A
(and)126 1824 A
(fstat)210 1992 A
(it.)126 2244 A
(Restore)294 2454 A
(the)126 2790 A
(ids)126 2958 A
(early)210 3126 A
3378(to)S
(handle)252 3504 A
(errors.)294 3798 A
4134(*/)S
5220 V
(19143)210 648 A
1110(fd)S
1236(=)S
(open\(name_buf,)588 1320 A
(O_RDONLY\);)420 1950 A
5310 V
(19144)210 648 A
(save_errno)420 1110 A
1572(=)S
(errno;)252 1656 A
2370(/*)S
(open)168 2496 A
(might)210 2706 A
(fail,)210 2958 A
(e.g.)168 3210 A
(from)168 3420 A
(ENFILE)252 3630 A
3924(*/)S
5400 V
(19145)210 648 A
(tell_fs\(SETUID,)630 1110 A
(MM_PROC_NR,)462 1782 A
(\(int\))210 2286 A
(mp->mp_effuid,)588 2538 A
(\(int\))210 3168 A
(mp->mp_effuid\);)630 3420 A
5490 V
(19146)210 648 A
1110(if)S
(\(fd)126 1236 A
1404(<)S
1488(0\))S
(return\(-save_errno\);)840 1614 A
5580 V
(19147)210 648 A
1110(if)S
(\(fstat\(fd,)420 1236 A
(s_buf\))252 1698 A
1992(<)S
2076(0\))S
(panic\("allowed:)630 2202 A
(fstat)210 2874 A
(failed",)336 3126 A
(NO_NUM\);)336 3504 A
5670 V
(19148)210 648 A
5760 V
(19149)210 648 A
1110(/*)S
(Only)168 1236 A
(regular)294 1446 A
(files)210 1782 A
(can)126 2034 A
2202(be)S
(executed.)378 2328 A
2748(*/)S
5850 V
(19150)210 648 A
1110(if)S
(\(mask)210 1236 A
1488(==)S
(X_BIT)210 1614 A
1866(&&)S
(\(s_buf->st_mode)630 1992 A
2664(&)S
(I_TYPE\))294 2748 A
3084(!=)S
(I_REGULAR\))420 3210 A
3672({)S
5940 V
(19151)210 648 A
(close\(fd\);)420 1362 A
6030 V
(19152)210 648 A
(return\(EACCES\);)630 1362 A
6120 V
(19153)210 648 A
1110(})S
6210 V
(19154)210 648 A
(return\(fd\);)462 1110 A
8418 V
EP
%%Page: 267 267
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2068(File:)S
(src/mm/utility.c)707 2301 A
12 B
(267)180 4248 A
900 V
7 LST
(19155)210 648 A
1026(})S
1170 V
(19158)210 648 A
(/*===========================================================================*)3276 1026 A
1260 V
(19159)210 648 A
1068(*)S
(no_sys)252 2370 A
4260(*)S
1350 V
(19160)210 648 A
(*===========================================================================*/)3276 1068 A
1440 V
(19161)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(no_sys\(\))336 1488 A
1530 V
(19162)210 648 A
1026({)S
1620 V
(19163)210 648 A
1026(/*)S
1152(A)S
(system)252 1236 A
(call)168 1530 A
(number)252 1740 A
(not)126 2034 A
(implemented)462 2202 A
2706(by)S
2832(MM)S
(has)126 2958 A
(been)168 3126 A
(requested.)420 3336 A
3798(*/)S
1710 V
(19164)210 648 A
1800 V
(19165)210 648 A
(return\(EINVAL\);)630 1110 A
1890 V
(19166)210 648 A
1026(})S
2160 V
(19169)210 648 A
(/*===========================================================================*)3276 1026 A
2250 V
(19170)210 648 A
1068(*)S
(panic)210 2370 A
4260(*)S
2340 V
(19171)210 648 A
(*===========================================================================*/)3276 1068 A
2430 V
(19172)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(panic\(format,)546 1530 A
(num\))168 2118 A
2520 V
(19173)210 648 A
(char)168 1026 A
(*format;)336 1236 A
2370(/*)S
(format)252 2496 A
(string)252 2790 A
3084(*/)S
2610 V
(19174)210 648 A
(int)126 1026 A
(num;)168 1194 A
2370(/*)S
(number)252 2496 A
2790(to)S
2916(go)S
(with)168 3042 A
(format)252 3252 A
(string)252 3546 A
3840(*/)S
2700 V
(19175)210 648 A
1026({)S
2790 V
(19176)210 648 A
1026(/*)S
(Something)378 1152 A
(awful)210 1572 A
(has)126 1824 A
(happened.)378 1992 A
(Panics)252 2454 A
(are)126 2748 A
(caused)252 2916 A
(when)168 3210 A
3420(an)S
(internal)336 3546 A
2880 V
(19177)210 648 A
1068(*)S
(inconsistency)546 1152 A
1740(is)S
(detected,)378 1866 A
(e.g.,)210 2286 A
2538(a)S
(programming)462 2622 A
(error)210 3126 A
3378(or)S
(illegal)294 3504 A
(value)210 3840 A
4092(of)S
4218(a)S
2970 V
(19178)210 648 A
1068(*)S
(defined)294 1152 A
(constant.)378 1488 A
3060 V
(19179)210 648 A
1068(*/)S
3150 V
(19180)210 648 A
3240 V
(19181)210 648 A
(printf\("Memory)588 1110 A
(manager)294 1740 A
(panic:)252 2076 A
2370(%s)S
2496(",)S
(format\);)336 2622 A
3330 V
(19182)210 648 A
1110(if)S
(\(num)168 1236 A
1446(!=)S
(NO_NUM\))294 1572 A
(printf\("%d",num\);)714 1908 A
3420 V
(19183)210 648 A
(printf\("\\n"\);)546 1110 A
3510 V
(19184)210 648 A
(tell_fs\(SYNC,)546 1110 A
1698(0,)S
1824(0,)S
(0\);)126 1950 A
2370(/*)S
(flush)210 2496 A
(the)126 2748 A
(cache)210 2916 A
3168(to)S
(the)126 3294 A
(disk)168 3462 A
3672(*/)S
3600 V
(19185)210 648 A
(sys_abort\(RBT_PANIC\);)882 1110 A
3690 V
(19186)210 648 A
1026(})S
3960 V
(19189)210 648 A
(/*===========================================================================*)3276 1026 A
4050 V
(19190)210 648 A
1068(*)S
(tell_fs)294 2370 A
4260(*)S
4140 V
(19191)210 648 A
(*===========================================================================*/)3276 1068 A
4230 V
(19192)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(tell_fs\(what,)546 1530 A
(p1,)126 2118 A
(p2,)126 2286 A
(p3\))126 2454 A
4320 V
(19193)210 648 A
(int)126 1026 A
(what,)210 1194 A
(p1,)126 1446 A
(p2,)126 1614 A
(p3;)126 1782 A
4410 V
(19194)210 648 A
1026({)S
4500 V
(19195)210 648 A
1026(/*)S
(This)168 1152 A
(routine)294 1362 A
1698(is)S
(only)168 1824 A
(used)168 2034 A
2244(by)S
2370(MM)S
2496(to)S
(inform)252 2622 A
2916(FS)S
3042(of)S
(certain)294 3168 A
(events:)294 3504 A
4590 V
(19196)210 648 A
1068(*)S
(tell_fs\(CHDIR,)588 1362 A
(slot,)210 1992 A
(dir,)168 2244 A
2454(0\))S
4680 V
(19197)210 648 A
1068(*)S
(tell_fs\(EXEC,)546 1362 A
(proc,)210 1950 A
2202(0,)S
2328(0\))S
4770 V
(19198)210 648 A
1068(*)S
(tell_fs\(EXIT,)546 1362 A
(proc,)210 1950 A
2202(0,)S
2328(0\))S
4860 V
(19199)210 648 A
1068(*)S
(tell_fs\(FORK,)546 1362 A
(parent,)294 1950 A
(child,)252 2286 A
(pid\))168 2580 A
4950 V
(19200)210 648 A
1068(*)S
(tell_fs\(SETGID,)630 1362 A
(proc,)210 2034 A
(realgid,)336 2286 A
(effgid\))294 2664 A
5040 V
(19201)210 648 A
1068(*)S
(tell_fs\(SETSID,)630 1362 A
(proc,)210 2034 A
2286(0,)S
2412(0\))S
5130 V
(19202)210 648 A
1068(*)S
(tell_fs\(SETUID,)630 1362 A
(proc,)210 2034 A
(realuid,)336 2286 A
(effuid\))294 2664 A
5220 V
(19203)210 648 A
1068(*)S
(tell_fs\(SYNC,)546 1362 A
1950(0,)S
2076(0,)S
2202(0\))S
5310 V
(19204)210 648 A
1068(*)S
(tell_fs\(UNPAUSE,)672 1362 A
(proc,)210 2076 A
(signr,)252 2328 A
2622(0\))S
5400 V
(19205)210 648 A
1068(*/)S
5490 V
(19206)210 648 A
5580 V
(19207)210 648 A
(message)294 1110 A
1446(m;)S
5670 V
(19208)210 648 A
5760 V
(19209)210 648 A
(m.m1_i1)294 1110 A
1446(=)S
(p1;)126 1530 A
5850 V
(19210)210 648 A
(m.m1_i2)294 1110 A
1446(=)S
(p2;)126 1530 A
5940 V
(19211)210 648 A
(m.m1_i3)294 1110 A
1446(=)S
(p3;)126 1530 A
6030 V
(19212)210 648 A
(_taskcall\(FS_PROC_NR,)882 1110 A
(what,)210 2034 A
(&m\);)168 2286 A
6120 V
(19213)210 648 A
1026(})S
8418 V
EP
%%Page: 268 268
BP
/slant 0 def
/height 0 def
630 V
12 B
(268)180 648 A
11 R
2102(File:)S
2335(src/mm/putk.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/mm/putk.c)546 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(19300)210 648 A
1026(/*)S
1152(MM)S
(must)168 1278 A
(occasionally)504 1488 A
(print)210 2034 A
(some)168 2286 A
(message.)336 2496 A
2916(It)S
(uses)168 3042 A
(the)126 3252 A
(standard)336 3420 A
(library)294 3798 A
1440 V
(19301)210 648 A
1068(*)S
(routine)294 1152 A
(printk\(\).)378 1488 A
(\(The)168 1950 A
(name)168 2160 A
("printf")336 2370 A
2748(is)S
(really)252 2874 A
3168(a)S
(macro)210 3252 A
(defined)294 3504 A
3840(as)S
1530 V
(19302)210 648 A
1068(*)S
("printk"\).)420 1152 A
(Printing)336 1614 A
1992(is)S
(done)168 2118 A
2328(by)S
(calling)294 2454 A
(the)126 2790 A
(TTY)126 2958 A
(task)168 3126 A
(directly,)378 3336 A
(not)126 3756 A
(going)210 3924 A
1620 V
(19303)210 648 A
1068(*)S
(through)294 1152 A
(FS.)126 1488 A
1710 V
(19304)210 648 A
1068(*/)S
1800 V
(19305)210 648 A
1890 V
(19306)210 648 A
(#include)336 1026 A
("mm.h")252 1404 A
1980 V
(19307)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
2070 V
(19308)210 648 A
2160 V
(19309)210 648 A
(#define)294 1026 A
(BUF_SIZE)336 1362 A
(100)126 2118 A
2370(/*)S
(print)210 2496 A
(buffer)252 2748 A
(size)168 3042 A
3252(*/)S
2250 V
(19310)210 648 A
2340 V
(19311)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(buf_count;)420 1530 A
2370(/*)S
2496(#)S
(characters)420 2580 A
3042(in)S
(the)126 3168 A
(buffer)252 3336 A
3630(*/)S
2430 V
(19312)210 648 A
(PRIVATE)294 1026 A
(char)168 1362 A
(print_buf[BUF_SIZE];)840 1572 A
2706(/*)S
(output)252 2832 A
3126(is)S
(buffered)336 3252 A
(here)168 3630 A
3840(*/)S
2520 V
(19313)210 648 A
(PRIVATE)294 1026 A
(message)294 1362 A
(putch_msg;)420 1698 A
2370(/*)S
(used)168 2496 A
(for)126 2706 A
(message)294 2874 A
3210(to)S
(TTY)126 3336 A
(task)168 3504 A
3714(*/)S
2610 V
(19314)210 648 A
2700 V
(19315)210 648 A
(_PROTOTYPE\()462 1026 A
(FORWARD)294 1530 A
(void)168 1866 A
(flush,)252 2076 A
(\(void\))252 2370 A
2664(\);)S
2790 V
(19316)210 648 A
2880 V
(19317)210 648 A
(/*===========================================================================*)3276 1026 A
2970 V
(19318)210 648 A
1068(*)S
(putk)168 2370 A
4260(*)S
3060 V
(19319)210 648 A
(*===========================================================================*/)3276 1068 A
3150 V
(19320)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(putk\(c\))294 1530 A
3240 V
(19321)210 648 A
(int)126 1026 A
1194(c;)S
3330 V
(19322)210 648 A
1026({)S
3420 V
(19323)210 648 A
1026(/*)S
(Accumulate)420 1152 A
(another)294 1614 A
(character.)420 1950 A
2454(If)S
2580(0)S
2664(or)S
(buffer)252 2790 A
(full,)210 3084 A
(print)210 3336 A
(it.)126 3588 A
3756(*/)S
3510 V
(19324)210 648 A
3600 V
(19325)210 648 A
1110(if)S
1236(\(c)S
1362(==)S
1488(0)S
1572(||)S
(buf_count)378 1698 A
2118(==)S
(BUF_SIZE\))378 2244 A
(flush\(\);)336 2664 A
3690 V
(19326)210 648 A
1110(if)S
1236(\(c)S
1362(==)S
('\\n'\))210 1488 A
(putk\('\\r'\);)462 1740 A
3780 V
(19327)210 648 A
1110(if)S
1236(\(c)S
1362(!=)S
1488(0\))S
(print_buf[buf_count++])924 1614 A
2580(=)S
2664(c;)S
3870 V
(19328)210 648 A
1026(})S
4140 V
(19331)210 648 A
(/*===========================================================================*)3276 1026 A
4230 V
(19332)210 648 A
1068(*)S
(flush)210 2370 A
4260(*)S
4320 V
(19333)210 648 A
(*===========================================================================*/)3276 1068 A
4410 V
(19334)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(flush\(\))294 1572 A
4500 V
(19335)210 648 A
1026({)S
4590 V
(19336)210 648 A
1026(/*)S
(Flush)210 1152 A
(the)126 1404 A
(print)210 1572 A
(buffer)252 1824 A
2118(by)S
(calling)294 2244 A
(TTY)126 2580 A
(task.)210 2748 A
3000(*/)S
4680 V
(19337)210 648 A
4770 V
(19338)210 648 A
1110(if)S
(\(buf_count)420 1236 A
1698(==)S
1824(0\))S
(return;)294 1950 A
4860 V
(19339)210 648 A
(putch_msg.m_type)672 1110 A
1824(=)S
(DEV_WRITE;)420 1908 A
4950 V
(19340)210 648 A
(putch_msg.PROC_NR)714 1110 A
1908(=)S
1992(0;)S
5040 V
(19341)210 648 A
(putch_msg.TTY_LINE)756 1110 A
1908(=)S
1992(0;)S
5130 V
(19342)210 648 A
(putch_msg.ADDRESS)714 1110 A
1908(=)S
(print_buf;)420 1992 A
5220 V
(19343)210 648 A
(putch_msg.COUNT)630 1110 A
1782(=)S
(buf_count;)420 1866 A
5310 V
(19344)210 648 A
(sendrec\(TTY,)504 1110 A
(&putch_msg\);)504 1656 A
5400 V
(19345)210 648 A
(buf_count)378 1110 A
1530(=)S
1614(0;)S
5490 V
(19346)210 648 A
1026(})S
8418 V
EP
%%Page: 269 269
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2204(File:)S
2437(src/fs/fs.h)S
12 B
(269)180 4248 A
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/fs/fs.h)462 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(19400)210 648 A
1026(/*)S
(This)168 1152 A
1362(is)S
(the)126 1488 A
(master)252 1656 A
(header)252 1950 A
(for)126 2244 A
(fs.)126 2412 A
2622(It)S
(includes)336 2748 A
(some)168 3126 A
(other)210 3336 A
(files)210 3588 A
1440 V
(19401)210 648 A
1068(*)S
(and)126 1152 A
(defines)294 1320 A
(the)126 1656 A
(principal)378 1824 A
(constants.)420 2244 A
1530 V
(19402)210 648 A
1068(*/)S
1620 V
(19403)210 648 A
(#define)294 1026 A
(_POSIX_SOURCE)546 1362 A
2160(1)S
2370(/*)S
(tell)168 2496 A
(headers)294 2706 A
3042(to)S
(include)294 3168 A
(POSIX)210 3504 A
(stuff)210 3756 A
4008(*/)S
1710 V
(19404)210 648 A
(#define)294 1026 A
(_MINIX)252 1362 A
2160(1)S
2370(/*)S
(tell)168 2496 A
(headers)294 2706 A
3042(to)S
(include)294 3168 A
(MINIX)210 3504 A
(stuff)210 3756 A
4008(*/)S
1800 V
(19405)210 648 A
(#define)294 1026 A
(_SYSTEM)294 1362 A
2160(1)S
2370(/*)S
(tell)168 2496 A
(headers)294 2706 A
(that)168 3042 A
(this)168 3252 A
3462(is)S
(the)126 3588 A
(kernel)252 3756 A
4050(*/)S
1890 V
(19406)210 648 A
1980 V
(19407)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(are)126 1740 A
1908(so)S
(basic,)252 2034 A
(all)126 2328 A
(the)126 2496 A
(*.c)126 2664 A
(files)210 2832 A
(get)126 3084 A
(them)168 3252 A
(automatically.)588 3462 A
4092(*/)S
2070 V
(19408)210 648 A
(#include)336 1026 A
(<minix/config.h>)672 1404 A
2370(/*)S
(MUST)168 2496 A
2706(be)S
(first)210 2832 A
3084(*/)S
2160 V
(19409)210 648 A
(#include)336 1026 A
(<ansi.h>)336 1404 A
2370(/*)S
(MUST)168 2496 A
2706(be)S
(second)252 2832 A
3126(*/)S
2250 V
(19410)210 648 A
(#include)336 1026 A
(<sys/types.h>)546 1404 A
2340 V
(19411)210 648 A
(#include)336 1026 A
(<minix/const.h>)630 1404 A
2430 V
(19412)210 648 A
(#include)336 1026 A
(<minix/type.h>)588 1404 A
2520 V
(19413)210 648 A
2610 V
(19414)210 648 A
(#include)336 1026 A
(<limits.h>)420 1404 A
2700 V
(19415)210 648 A
(#include)336 1026 A
(<errno.h>)378 1404 A
2790 V
(19416)210 648 A
2880 V
(19417)210 648 A
(#include)336 1026 A
(<minix/syslib.h>)672 1404 A
2970 V
(19418)210 648 A
3060 V
(19419)210 648 A
(#include)336 1026 A
("const.h")378 1404 A
3150 V
(19420)210 648 A
(#include)336 1026 A
("type.h")336 1404 A
3240 V
(19421)210 648 A
(#include)336 1026 A
("proto.h")378 1404 A
3330 V
(19422)210 648 A
(#include)336 1026 A
("glo.h")294 1404 A
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(src/fs/const.h)588 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(19500)210 648 A
1026(/*)S
(Tables)252 1152 A
(sizes)210 1446 A
1698(*/)S
4140 V
(19501)210 648 A
(#define)294 1026 A
(V1_NR_DZONES)504 1362 A
2160(7)S
2370(/*)S
2496(#)S
(direct)252 2580 A
(zone)168 2874 A
(numbers)294 3084 A
3420(in)S
3546(a)S
3630(V1)S
(inode)210 3756 A
4008(*/)S
4230 V
(19502)210 648 A
(#define)294 1026 A
(V1_NR_TZONES)504 1362 A
2160(9)S
2370(/*)S
(total)210 2496 A
2748(#)S
(zone)168 2832 A
(numbers)294 3042 A
3378(in)S
3504(a)S
3588(V1)S
(inode)210 3714 A
3966(*/)S
4320 V
(19503)210 648 A
(#define)294 1026 A
(V2_NR_DZONES)504 1362 A
2160(7)S
2370(/*)S
2496(#)S
(direct)252 2580 A
(zone)168 2874 A
(numbers)294 3084 A
3420(in)S
3546(a)S
3630(V2)S
(inode)210 3756 A
4008(*/)S
4410 V
(19504)210 648 A
(#define)294 1026 A
(V2_NR_TZONES)504 1362 A
2118(10)S
2370(/*)S
(total)210 2496 A
2748(#)S
(zone)168 2832 A
(numbers)294 3042 A
3378(in)S
3504(a)S
3588(V2)S
(inode)210 3714 A
3966(*/)S
4500 V
(19505)210 648 A
4590 V
(19506)210 648 A
(#define)294 1026 A
(NR_FILPS)336 1362 A
(128)126 2076 A
2370(/*)S
2496(#)S
(slots)210 2580 A
2832(in)S
(filp)168 2958 A
(table)210 3168 A
3420(*/)S
4680 V
(19507)210 648 A
(#define)294 1026 A
(NR_INODES)378 1362 A
2118(64)S
2370(/*)S
2496(#)S
(slots)210 2580 A
2832(in)S
("in)126 2958 A
(core")210 3126 A
(inode)210 3378 A
(table)210 3630 A
3882(*/)S
4770 V
(19508)210 648 A
(#define)294 1026 A
(NR_SUPERS)378 1362 A
2160(8)S
2370(/*)S
2496(#)S
(slots)210 2580 A
2832(in)S
(super)210 2958 A
(block)210 3210 A
(table)210 3462 A
3714(*/)S
4860 V
(19509)210 648 A
(#define)294 1026 A
(NR_LOCKS)336 1362 A
2160(8)S
2370(/*)S
2496(#)S
(slots)210 2580 A
2832(in)S
(the)126 2958 A
(file)168 3126 A
(locking)294 3336 A
(table)210 3672 A
3924(*/)S
4950 V
(19510)210 648 A
5040 V
(19511)210 648 A
1026(/*)S
(The)126 1152 A
(type)168 1320 A
1530(of)S
(sizeof)252 1656 A
(may)126 1950 A
2118(be)S
(\(unsigned\))420 2244 A
(long.)210 2706 A
(Use)126 3000 A
(the)126 3168 A
(following)378 3336 A
(macro)210 3756 A
(for)126 4008 A
5130 V
(19512)210 648 A
1068(*)S
(taking)252 1152 A
(the)126 1446 A
(sizes)210 1614 A
1866(of)S
(small)210 1992 A
(objects)294 2244 A
2580(so)S
(that)168 2706 A
(there)210 2916 A
(are)126 3168 A
3336(no)S
(surprises)378 3462 A
(like)168 3882 A
5220 V
(19513)210 648 A
1068(*)S
(\(small\))294 1152 A
(long)168 1488 A
(constants)378 1698 A
(being)210 2118 A
(passed)252 2370 A
2664(to)S
(routines)336 2790 A
(expecting)378 3168 A
3588(an)S
(int.)168 3714 A
5310 V
(19514)210 648 A
1068(*/)S
5400 V
(19515)210 648 A
(#define)294 1026 A
(usizeof\(t\))420 1362 A
(\(\(unsigned\))462 1824 A
(sizeof\(t\)\))420 2328 A
5490 V
(19516)210 648 A
5580 V
(19517)210 648 A
1026(/*)S
(File)168 1152 A
(system)252 1362 A
(types.)252 1656 A
1950(*/)S
5670 V
(19518)210 648 A
(#define)294 1026 A
(SUPER_MAGIC)462 1362 A
(0x137F)252 1950 A
2370(/*)S
(magic)210 2496 A
(number)252 2748 A
(contained)378 3042 A
3462(in)S
(super-block)462 3588 A
4092(*/)S
5760 V
(19519)210 648 A
(#define)294 1026 A
(SUPER_REV)378 1362 A
(0x7F13)252 1950 A
2370(/*)S
(magic)210 2496 A
2748(#)S
(when)168 2832 A
(68000)210 3042 A
(disk)168 3294 A
(read)168 3504 A
3714(on)S
3840(PC)S
3966(or)S
4092(vv)S
4218(*/)S
5850 V
(19520)210 648 A
(#define)294 1026 A
(SUPER_V2)336 1362 A
(0x2468)252 1950 A
2370(/*)S
(magic)210 2496 A
2748(#)S
(for)126 2832 A
3000(V2)S
(file)168 3126 A
(systems)294 3336 A
3672(*/)S
5940 V
(19521)210 648 A
(#define)294 1026 A
(SUPER_V2_REV)504 1362 A
(0x6824)252 1950 A
2370(/*)S
2496(V2)S
(magic)210 2622 A
(written)294 2874 A
3210(on)S
(PC,)126 3336 A
(read)168 3504 A
3714(on)S
(68K)126 3840 A
4008(or)S
4134(vv)S
4260(*/)S
6030 V
(19522)210 648 A
6120 V
(19523)210 648 A
(#define)294 1026 A
1362(V1)S
2160(1)S
2370(/*)S
(version)294 2496 A
(number)252 2832 A
3126(of)S
3252(V1)S
(file)168 3378 A
(systems)294 3588 A
3924(*/)S
6210 V
(19524)210 648 A
(#define)294 1026 A
1362(V2)S
2160(2)S
2370(/*)S
(version)294 2496 A
(number)252 2832 A
3126(of)S
3252(V2)S
(file)168 3378 A
(systems)294 3588 A
3924(*/)S
8418 V
EP
%%Page: 270 270
BP
/slant 0 def
/height 0 def
630 V
12 B
(270)180 648 A
11 R
2127(File:)S
2360(src/fs/const.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(19525)210 648 A
990 V
(19526)210 648 A
1026(/*)S
(Miscellaneous)546 1152 A
(constants)378 1740 A
2160(*/)S
1080 V
(19527)210 648 A
(#define)294 1026 A
(SU_UID)252 1362 A
(\(\(uid_t\))336 1740 A
2118(0\))S
2370(/*)S
(super_user's)504 2496 A
(uid_t)210 3042 A
3294(*/)S
1170 V
(19528)210 648 A
(#define)294 1026 A
(SYS_UID)294 1362 A
(\(\(uid_t\))336 1740 A
2118(0\))S
2370(/*)S
(uid_t)210 2496 A
(for)126 2748 A
(processes)378 2916 A
3336(MM)S
(and)126 3462 A
(INIT)168 3630 A
3840(*/)S
1260 V
(19529)210 648 A
(#define)294 1026 A
(SYS_GID)294 1362 A
(\(\(gid_t\))336 1740 A
2118(0\))S
2370(/*)S
(gid_t)210 2496 A
(for)126 2748 A
(processes)378 2916 A
3336(MM)S
(and)126 3462 A
(INIT)168 3630 A
3840(*/)S
1350 V
(19530)210 648 A
(#define)294 1026 A
(NORMAL)252 1362 A
2160(0)S
2370(/*)S
(forces)252 2496 A
(get_block)378 2790 A
3210(to)S
3336(do)S
(disk)168 3462 A
(read)168 3672 A
3882(*/)S
1440 V
(19531)210 648 A
(#define)294 1026 A
(NO_READ)294 1362 A
2160(1)S
2370(/*)S
(prevents)336 2496 A
(get_block)378 2874 A
(from)168 3294 A
(doing)210 3504 A
(disk)168 3756 A
(read)168 3966 A
4176(*/)S
1530 V
(19532)210 648 A
(#define)294 1026 A
(PREFETCH)336 1362 A
2160(2)S
2370(/*)S
(tells)210 2496 A
(get_block)378 2748 A
(not)126 3168 A
3336(to)S
(read)168 3462 A
3672(or)S
(mark)168 3798 A
(dev)126 4008 A
4176(*/)S
1620 V
(19533)210 648 A
1710 V
(19534)210 648 A
(#define)294 1026 A
(XPIPE)210 1362 A
(\(-NR_TASKS-1\))546 1656 A
2370(/*)S
(used)168 2496 A
2706(in)S
(fp_task)294 2832 A
(when)168 3168 A
(susp'd)252 3378 A
3672(on)S
(pipe)168 3798 A
4008(*/)S
1800 V
(19535)210 648 A
(#define)294 1026 A
(XOPEN)210 1362 A
(\(-NR_TASKS-2\))546 1656 A
2370(/*)S
(used)168 2496 A
2706(in)S
(fp_task)294 2832 A
(when)168 3168 A
(susp'd)252 3378 A
3672(on)S
(open)168 3798 A
4008(*/)S
1890 V
(19536)210 648 A
(#define)294 1026 A
(XLOCK)210 1362 A
(\(-NR_TASKS-3\))546 1656 A
2370(/*)S
(used)168 2496 A
2706(in)S
(fp_task)294 2832 A
(when)168 3168 A
(susp'd)252 3378 A
3672(on)S
(lock)168 3798 A
4008(*/)S
1980 V
(19537)210 648 A
(#define)294 1026 A
(XPOPEN)252 1362 A
(\(-NR_TASKS-4\))546 1656 A
2370(/*)S
(used)168 2496 A
2706(in)S
(fp_task)294 2832 A
(when)168 3168 A
(susp'd)252 3378 A
3672(on)S
(pipe)168 3798 A
(open)168 4008 A
4218(*/)S
2070 V
(19538)210 648 A
2160 V
(19539)210 648 A
(#define)294 1026 A
(NO_BIT)252 1362 A
(\(\(bit_t\))336 1740 A
2118(0\))S
2370(/*)S
(returned)336 2496 A
2874(by)S
(alloc_bit\(\))462 3000 A
3504(to)S
(signal)252 3630 A
(failure)294 3924 A
4260(*/)S
2250 V
(19540)210 648 A
2340 V
(19541)210 648 A
(#define)294 1026 A
(DUP_MASK)336 1362 A
(0100)168 2034 A
2370(/*)S
(mask)168 2496 A
2706(to)S
(distinguish)462 2832 A
(dup2)168 3336 A
(from)168 3546 A
(dup)126 3756 A
3924(*/)S
2430 V
(19542)210 648 A
2520 V
(19543)210 648 A
(#define)294 1026 A
(LOOK_UP)294 1362 A
2160(0)S
2370(/*)S
(tells)210 2496 A
(search_dir)420 2748 A
3210(to)S
(lookup)252 3336 A
(string)252 3630 A
3924(*/)S
2610 V
(19544)210 648 A
(#define)294 1026 A
(ENTER)210 1362 A
2160(1)S
2370(/*)S
(tells)210 2496 A
(search_dir)420 2748 A
3210(to)S
(make)168 3336 A
(dir)126 3546 A
(entry)210 3714 A
3966(*/)S
2700 V
(19545)210 648 A
(#define)294 1026 A
(DELETE)252 1362 A
2160(2)S
2370(/*)S
(tells)210 2496 A
(search_dir)420 2748 A
3210(to)S
(delete)252 3336 A
(entry)210 3630 A
3882(*/)S
2790 V
(19546)210 648 A
(#define)294 1026 A
(IS_EMPTY)336 1362 A
2160(3)S
2370(/*)S
(tells)210 2496 A
(search_dir)420 2748 A
3210(to)S
(ret.)168 3336 A
3546(OK)S
3672(or)S
(ENOTEMPTY)378 3798 A
4218(*/)S
2880 V
(19547)210 648 A
2970 V
(19548)210 648 A
(#define)294 1026 A
(CLEAN)210 1362 A
2160(0)S
2370(/*)S
(disk)168 2496 A
(and)126 2706 A
(memory)252 2874 A
(copies)252 3168 A
(identical)378 3462 A
3882(*/)S
3060 V
(19549)210 648 A
(#define)294 1026 A
(DIRTY)210 1362 A
2160(1)S
2370(/*)S
(disk)168 2496 A
(and)126 2706 A
(memory)252 2874 A
(copies)252 3168 A
(differ)252 3462 A
3756(*/)S
3150 V
(19550)210 648 A
(#define)294 1026 A
(ATIME)210 1362 A
(002)126 2076 A
2370(/*)S
(set)126 2496 A
2664(if)S
(atime)210 2790 A
(field)210 3042 A
(needs)210 3294 A
(updating)336 3546 A
3924(*/)S
3240 V
(19551)210 648 A
(#define)294 1026 A
(CTIME)210 1362 A
(004)126 2076 A
2370(/*)S
(set)126 2496 A
2664(if)S
(ctime)210 2790 A
(field)210 3042 A
(needs)210 3294 A
(updating)336 3546 A
3924(*/)S
3330 V
(19552)210 648 A
(#define)294 1026 A
(MTIME)210 1362 A
(010)126 2076 A
2370(/*)S
(set)126 2496 A
2664(if)S
(mtime)210 2790 A
(field)210 3042 A
(needs)210 3294 A
(updating)336 3546 A
3924(*/)S
3420 V
(19553)210 648 A
3510 V
(19554)210 648 A
(#define)294 1026 A
(BYTE_SWAP)378 1362 A
2160(0)S
2370(/*)S
(tells)210 2496 A
(conv2/conv4)462 2748 A
3252(to)S
(swap)168 3378 A
(bytes)210 3588 A
3840(*/)S
3600 V
(19555)210 648 A
(#define)294 1026 A
(DONT_SWAP)378 1362 A
2160(1)S
2370(/*)S
(tells)210 2496 A
(conv2/conv4)462 2748 A
(not)126 3252 A
3420(to)S
(swap)168 3546 A
(bytes)210 3756 A
4008(*/)S
3690 V
(19556)210 648 A
3780 V
(19557)210 648 A
(#define)294 1026 A
(END_OF_FILE)462 1362 A
(\(-104\))252 1950 A
2370(/*)S
(eof)126 2496 A
(detected)336 2664 A
3042(*/)S
3870 V
(19558)210 648 A
3960 V
(19559)210 648 A
(#define)294 1026 A
(ROOT_INODE)420 1362 A
2160(1)S
2370(/*)S
(inode)210 2496 A
(number)252 2748 A
(for)126 3042 A
(root)168 3210 A
(directory)378 3420 A
3840(*/)S
4050 V
(19560)210 648 A
(#define)294 1026 A
(BOOT_BLOCK)420 1362 A
(\(\(block_t\))420 1866 A
2328(0\))S
2706(/*)S
(block)210 2832 A
(number)252 3084 A
3378(of)S
(boot)168 3504 A
(block)210 3714 A
3966(*/)S
4140 V
(19561)210 648 A
(#define)294 1026 A
(SUPER_BLOCK)462 1362 A
(\(\(block_t\))420 1866 A
2328(1\))S
2706(/*)S
(block)210 2832 A
(number)252 3084 A
3378(of)S
(super)210 3504 A
(block)210 3756 A
4008(*/)S
4230 V
(19562)210 648 A
4320 V
(19563)210 648 A
(#define)294 1026 A
(DIR_ENTRY_SIZE)588 1362 A
(usizeof)294 2244 A
(\(struct)294 2580 A
(direct\))294 2916 A
3294(/*)S
3420(#)S
(bytes/dir)378 3504 A
(entry)210 3924 A
4260(*/)S
4410 V
(19564)210 648 A
(#define)294 1026 A
(NR_DIR_ENTRIES)588 1362 A
(\(BLOCK_SIZE/DIR_ENTRY_SIZE\))1134 2076 A
3294(/*)S
3420(#)S
(dir)126 3504 A
(entries/blk)462 3672 A
4260(*/)S
4500 V
(19565)210 648 A
(#define)294 1026 A
(SUPER_SIZE)420 1362 A
(usizeof)294 2034 A
(\(struct)294 2370 A
(super_block\))504 2706 A
3294(/*)S
(super_block)462 3420 A
(size)168 3924 A
4260(*/)S
4590 V
(19566)210 648 A
(#define)294 1026 A
(PIPE_SIZE)378 1362 A
(\(V1_NR_DZONES*BLOCK_SIZE\))1050 2160 A
3294(/*)S
(pipe)168 3420 A
(size)168 3630 A
3840(in)S
(bytes)210 3966 A
4260(*/)S
4680 V
(19567)210 648 A
(#define)294 1026 A
(BITMAP_CHUNKS)546 1362 A
(\(BLOCK_SIZE/usizeof)798 1950 A
(\(bitchunk_t\)\)/*)630 2790 A
3462(#)S
(map)126 3546 A
(chunks/blk)420 3714 A
4260(*/)S
4770 V
(19568)210 648 A
4860 V
(19569)210 648 A
1026(/*)S
(Derived)294 1152 A
(sizes)210 1488 A
(pertaining)420 1740 A
2202(to)S
(the)126 2328 A
2496(V1)S
(file)168 2622 A
(system.)294 2832 A
3168(*/)S
4950 V
(19570)210 648 A
(#define)294 1026 A
(V1_ZONE_NUM_SIZE)672 1362 A
(usizeof)294 2496 A
(\(zone1_t\))378 2832 A
3294(/*)S
3420(#)S
(bytes)210 3504 A
3756(in)S
3882(V1)S
(zone)168 4008 A
4260(*/)S
5040 V
(19571)210 648 A
(#define)294 1026 A
(V1_INODE_SIZE)546 1362 A
(usizeof)294 2454 A
(\(d1_inode\))420 2790 A
3294(/*)S
(bytes)210 3420 A
3672(in)S
3798(V1)S
(dsk)126 3924 A
(ino)126 4092 A
4260(*/)S
5130 V
(19572)210 648 A
(#define)294 1026 A
(V1_INDIRECTS)504 1362 A
(\(BLOCK_SIZE/V1_ZONE_NUM_SIZE\))1218 1992 A
3294(/*)S
3420(#)S
(zones/indir)462 3504 A
(block)210 4008 A
4260(*/)S
5220 V
(19573)210 648 A
(#define)294 1026 A
(V1_INODES_PER_BLOCK)798 1362 A
(\(BLOCK_SIZE/V1_INODE_SIZE\)/*)1176 2202 A
3420(#)S
3504(V1)S
(dsk)126 3630 A
(inodes/blk)420 3798 A
4260(*/)S
5310 V
(19574)210 648 A
5400 V
(19575)210 648 A
1026(/*)S
(Derived)294 1152 A
(sizes)210 1488 A
(pertaining)420 1740 A
2202(to)S
(the)126 2328 A
2496(V2)S
(file)168 2622 A
(system.)294 2832 A
3168(*/)S
5490 V
(19576)210 648 A
(#define)294 1026 A
(V2_ZONE_NUM_SIZE)672 1362 A
(usizeof)294 2538 A
(\(zone_t\))336 2874 A
3294(/*)S
3420(#)S
(bytes)210 3504 A
3756(in)S
3882(V2)S
(zone)168 4008 A
4260(*/)S
5580 V
(19577)210 648 A
(#define)294 1026 A
(V2_INODE_SIZE)546 1362 A
(usizeof)294 2454 A
(\(d2_inode\))420 2790 A
3294(/*)S
(bytes)210 3420 A
3672(in)S
3798(V2)S
(dsk)126 3924 A
(ino)126 4092 A
4260(*/)S
5670 V
(19578)210 648 A
(#define)294 1026 A
(V2_INDIRECTS)504 1362 A
(\(BLOCK_SIZE/V2_ZONE_NUM_SIZE\))1218 1992 A
3294(/*)S
3420(#)S
(zones/indir)462 3504 A
(block)210 4008 A
4260(*/)S
5760 V
(19579)210 648 A
(#define)294 1026 A
(V2_INODES_PER_BLOCK)798 1362 A
(\(BLOCK_SIZE/V2_INODE_SIZE\)/*)1176 2202 A
3420(#)S
3504(V2)S
(dsk)126 3630 A
(inodes/blk)420 3798 A
4260(*/)S
5850 V
(19580)210 648 A
5940 V
(19581)210 648 A
(#define)294 1026 A
(printf)252 1362 A
(printk)252 1656 A
8418 V
EP
%%Page: 271 271
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2148(File:)S
2381(src/fs/type.h)S
12 B
(271)180 4248 A
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/fs/type.h)546 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(19600)210 648 A
1026(/*)S
(Declaration)462 1152 A
1656(of)S
(the)126 1782 A
1950(V1)S
(inode)210 2076 A
2328(as)S
2454(it)S
2580(is)S
2706(on)S
(the)126 2832 A
(disk)168 3000 A
(\(not)168 3210 A
3420(in)S
(core\).)252 3546 A
3840(*/)S
1440 V
(19601)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
1656({)S
2370(/*)S
(V1.x)168 2496 A
(disk)168 2706 A
(inode)210 2916 A
3168(*/)S
1530 V
(19602)210 648 A
(mode_t)252 1110 A
(d1_mode;)336 1404 A
2370(/*)S
(file)168 2496 A
(type,)210 2706 A
(protection,)462 2958 A
(etc.)168 3462 A
3672(*/)S
1620 V
(19603)210 648 A
(uid_t)210 1110 A
(d1_uid;)294 1362 A
2370(/*)S
(user)168 2496 A
2706(id)S
2832(of)S
(the)126 2958 A
(file's)252 3126 A
(owner)210 3420 A
3672(*/)S
1710 V
(19604)210 648 A
(off_t)210 1110 A
(d1_size;)336 1362 A
2370(/*)S
(current)294 2496 A
(file)168 2832 A
(size)168 3042 A
3252(in)S
(bytes)210 3378 A
3630(*/)S
1800 V
(19605)210 648 A
(time_t)252 1110 A
(d1_mtime;)378 1404 A
2370(/*)S
(when)168 2496 A
(was)126 2706 A
(file)168 2874 A
(data)168 3084 A
(last)168 3294 A
(changed)294 3504 A
3840(*/)S
1890 V
(19606)210 648 A
(gid_t)210 1110 A
(d1_gid;)294 1362 A
2370(/*)S
(group)210 2496 A
(number)252 2748 A
3042(*/)S
1980 V
(19607)210 648 A
(nlink_t)294 1110 A
(d1_nlinks;)420 1446 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(links)210 2874 A
3126(to)S
(this)168 3252 A
(file)168 3462 A
3672(*/)S
2070 V
(19608)210 648 A
(u16_t)210 1110 A
(d1_zone[V1_NR_TZONES];)924 1362 A
2370(/*)S
(block)210 2496 A
(nums)168 2748 A
(for)126 2958 A
(direct,)294 3126 A
(ind,)168 3462 A
(and)126 3672 A
(dbl)126 3840 A
(ind)126 4008 A
4176(*/)S
2160 V
(19609)210 648 A
1026(})S
(d1_inode;)378 1110 A
2250 V
(19610)210 648 A
2340 V
(19611)210 648 A
1026(/*)S
(Declaration)462 1152 A
1656(of)S
(the)126 1782 A
1950(V2)S
(inode)210 2076 A
2328(as)S
2454(it)S
2580(is)S
2706(on)S
(the)126 2832 A
(disk)168 3000 A
(\(not)168 3210 A
3420(in)S
(core\).)252 3546 A
3840(*/)S
2430 V
(19612)210 648 A
(typedef)294 1026 A
(struct)252 1362 A
1656({)S
2370(/*)S
(V2.x)168 2496 A
(disk)168 2706 A
(inode)210 2916 A
3168(*/)S
2520 V
(19613)210 648 A
(mode_t)252 1110 A
(d2_mode;)336 1404 A
2370(/*)S
(file)168 2496 A
(type,)210 2706 A
(protection,)462 2958 A
(etc.)168 3462 A
3672(*/)S
2610 V
(19614)210 648 A
(u16_t)210 1110 A
(d2_nlinks;)420 1362 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(links)210 2874 A
3126(to)S
(this)168 3252 A
(file.)210 3462 A
(HACK!)210 3714 A
3966(*/)S
2700 V
(19615)210 648 A
(uid_t)210 1110 A
(d2_uid;)294 1362 A
2370(/*)S
(user)168 2496 A
2706(id)S
2832(of)S
(the)126 2958 A
(file's)252 3126 A
(owner.)252 3420 A
3714(*/)S
2790 V
(19616)210 648 A
(u16_t)210 1110 A
(d2_gid;)294 1362 A
2370(/*)S
(group)210 2496 A
(number)252 2748 A
(HACK!)210 3042 A
3294(*/)S
2880 V
(19617)210 648 A
(off_t)210 1110 A
(d2_size;)336 1362 A
2370(/*)S
(current)294 2496 A
(file)168 2832 A
(size)168 3042 A
3252(in)S
(bytes)210 3378 A
3630(*/)S
2970 V
(19618)210 648 A
(time_t)252 1110 A
(d2_atime;)378 1404 A
2370(/*)S
(when)168 2496 A
(was)126 2706 A
(file)168 2874 A
(data)168 3084 A
(last)168 3294 A
(accessed)336 3504 A
3882(*/)S
3060 V
(19619)210 648 A
(time_t)252 1110 A
(d2_mtime;)378 1404 A
2370(/*)S
(when)168 2496 A
(was)126 2706 A
(file)168 2874 A
(data)168 3084 A
(last)168 3294 A
(changed)294 3504 A
3840(*/)S
3150 V
(19620)210 648 A
(time_t)252 1110 A
(d2_ctime;)378 1404 A
2370(/*)S
(when)168 2496 A
(was)126 2706 A
(inode)210 2874 A
(data)168 3126 A
(last)168 3336 A
(changed)294 3546 A
3882(*/)S
3240 V
(19621)210 648 A
(zone_t)252 1110 A
(d2_zone[V2_NR_TZONES];)924 1404 A
2370(/*)S
(block)210 2496 A
(nums)168 2748 A
(for)126 2958 A
(direct,)294 3126 A
(ind,)168 3462 A
(and)126 3672 A
(dbl)126 3840 A
(ind)126 4008 A
4176(*/)S
3330 V
(19622)210 648 A
1026(})S
(d2_inode;)378 1110 A
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(src/fs/proto.h)588 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(19700)210 648 A
1026(/*)S
(Function)336 1152 A
(prototypes.)462 1530 A
2034(*/)S
4140 V
(19701)210 648 A
4230 V
(19702)210 648 A
1026(/*)S
(Structs)294 1152 A
(used)168 1488 A
1698(in)S
(prototypes)420 1824 A
(must)168 2286 A
2496(be)S
(declared)336 2622 A
3000(as)S
(such)168 3126 A
(first.)252 3336 A
3630(*/)S
4320 V
(19703)210 648 A
(struct)252 1026 A
(buf;)168 1320 A
4410 V
(19704)210 648 A
(struct)252 1026 A
(filp;)210 1320 A
4500 V
(19705)210 648 A
(struct)252 1026 A
(inode;)252 1320 A
4590 V
(19706)210 648 A
(struct)252 1026 A
(super_block;)504 1320 A
4680 V
(19707)210 648 A
4770 V
(19708)210 648 A
1026(/*)S
(cache.c)294 1152 A
1488(*/)S
4860 V
(19709)210 648 A
(_PROTOTYPE\()462 1026 A
(zone_t)252 1530 A
(alloc_zone,)462 1824 A
(\(Dev_t)252 2328 A
(dev,)168 2622 A
(zone_t)252 2832 A
3126(z\))S
4050(\);)S
4950 V
(19710)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(flushall,)378 1740 A
(\(Dev_t)252 2160 A
(dev\))168 2454 A
4050(\);)S
5040 V
(19711)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(free_zone,)420 1740 A
(\(Dev_t)252 2202 A
(dev,)168 2496 A
(zone_t)252 2706 A
(numb\))210 3000 A
4050(\);)S
5130 V
(19712)210 648 A
(_PROTOTYPE\()462 1026 A
(struct)252 1530 A
(buf)126 1824 A
(*get_block,)462 1992 A
(\(Dev_t)252 2496 A
(dev,)168 2790 A
(block_t)294 3000 A
(block,int)378 3336 A
(only_search\)\);)588 3756 A
5220 V
(19713)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(invalidate,)462 1740 A
(\(Dev_t)252 2244 A
(device\))294 2538 A
4050(\);)S
5310 V
(19714)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(put_block,)420 1740 A
(\(struct)294 2202 A
(buf)126 2538 A
(*bp,)168 2706 A
(int)126 2916 A
(block_type\))462 3084 A
4050(\);)S
5400 V
(19715)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(rw_block,)378 1740 A
(\(struct)294 2160 A
(buf)126 2496 A
(*bp,)168 2664 A
(int)126 2874 A
(rw_flag\))336 3042 A
4050(\);)S
5490 V
(19716)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(rw_scattered,)546 1740 A
(\(Dev_t)252 2328 A
(dev,)168 2622 A
5580 V
(19717)210 648 A
(struct)252 2034 A
(buf)126 2328 A
(**bufq,)294 2496 A
(int)126 2832 A
(bufqsize,)378 3000 A
(int)126 3420 A
(rw_flag\))336 3588 A
4050(\);)S
5670 V
(19718)210 648 A
5760 V
(19719)210 648 A
1026(/*)S
(device.c)336 1152 A
1530(*/)S
5850 V
(19720)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(call_task,)420 1740 A
(\(int)168 2202 A
(task_nr,)336 2412 A
(message)294 2790 A
(*mess_ptr\))420 3126 A
4050(\);)S
5940 V
(19721)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(dev_opcl,)378 1740 A
(\(int)168 2160 A
(task_nr,)336 2370 A
(message)294 2748 A
(*mess_ptr\))420 3084 A
4050(\);)S
6030 V
(19722)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(dev_io,)294 1698 A
(\(int)168 2034 A
(rw_flag,)336 2244 A
(int)126 2622 A
(nonblock,)378 2790 A
(Dev_t)210 3210 A
(dev,)168 3462 A
6120 V
(19723)210 648 A
(off_t)210 2034 A
(pos,)168 2286 A
(int)126 2496 A
(bytes,)252 2664 A
(int)126 2958 A
(proc,)210 3126 A
(char)168 3378 A
(*buff\))252 3588 A
4050(\);)S
6210 V
(19724)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_ioctl,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
8418 V
EP
%%Page: 272 272
BP
/slant 0 def
/height 0 def
630 V
12 B
(272)180 648 A
11 R
2127(File:)S
2360(src/fs/proto.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(19725)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(no_dev,)294 1740 A
(\(int)168 2076 A
(task_nr,)336 2286 A
(message)294 2664 A
(*m_ptr\))294 3000 A
4050(\);)S
990 V
(19726)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(call_ctty,)420 1740 A
(\(int)168 2202 A
(task_nr,)336 2412 A
(message)294 2790 A
(*mess_ptr\))420 3126 A
4050(\);)S
1080 V
(19727)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(tty_open,)378 1740 A
(\(int)168 2160 A
(task_nr,)336 2370 A
(message)294 2748 A
(*mess_ptr\))420 3084 A
4050(\);)S
1170 V
(19728)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(ctty_close,)462 1740 A
(\(int)168 2244 A
(task_nr,)336 2454 A
(message)294 2832 A
(*mess_ptr\))420 3168 A
4050(\);)S
1260 V
(19729)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(ctty_open,)420 1740 A
(\(int)168 2202 A
(task_nr,)336 2412 A
(message)294 2790 A
(*mess_ptr\))420 3126 A
4050(\);)S
1350 V
(19730)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_setsid,)420 1698 A
(\(void\))252 2160 A
4050(\);)S
1440 V
(19731)210 648 A
(#if)126 1026 A
(ENABLE_NETWORKING)714 1194 A
1530 V
(19732)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(net_open,)378 1740 A
(\(int)168 2160 A
(task_nr,)336 2370 A
(message)294 2748 A
(*mess_ptr\))420 3084 A
4050(\);)S
1620 V
(19733)210 648 A
(#else)210 1026 A
1710 V
(19734)210 648 A
(#define)294 1026 A
(net_open)336 1362 A
1782(0)S
1800 V
(19735)210 648 A
(#endif)252 1026 A
1890 V
(19736)210 648 A
1980 V
(19737)210 648 A
1026(/*)S
(filedes.c)378 1152 A
1572(*/)S
2070 V
(19738)210 648 A
(_PROTOTYPE\()462 1026 A
(struct)252 1530 A
(filp)168 1824 A
(*find_filp,)462 2034 A
(\(struct)294 2538 A
(inode)210 2874 A
(*rip,)210 3126 A
(Mode_t)252 3378 A
(bits\))210 3672 A
4050(\);)S
2160 V
(19739)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(get_fd,)294 1698 A
(\(int)168 2034 A
(start,)252 2244 A
(Mode_t)252 2538 A
(bits,)210 2832 A
(int)126 3084 A
(*k,)126 3252 A
(struct)252 3420 A
(filp)168 3714 A
(**fpt\))252 3924 A
4218(\);)S
2250 V
(19740)210 648 A
(_PROTOTYPE\()462 1026 A
(struct)252 1530 A
(filp)168 1824 A
(*get_filp,)420 2034 A
(\(int)168 2496 A
(fild\))210 2706 A
4050(\);)S
2340 V
(19741)210 648 A
2430 V
(19742)210 648 A
1026(/*)S
(inode.c)294 1152 A
1488(*/)S
2520 V
(19743)210 648 A
(_PROTOTYPE\()462 1026 A
(struct)252 1530 A
(inode)210 1824 A
(*alloc_inode,)546 2076 A
(\(Dev_t)252 2664 A
(dev,)168 2958 A
(Mode_t)252 3168 A
(bits\))210 3462 A
4050(\);)S
2610 V
(19744)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(dup_inode,)420 1740 A
(\(struct)294 2202 A
(inode)210 2538 A
(*ip\))168 2790 A
4050(\);)S
2700 V
(19745)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(free_inode,)462 1740 A
(\(Dev_t)252 2244 A
(dev,)168 2538 A
(Ino_t)210 2748 A
(numb\))210 3000 A
4050(\);)S
2790 V
(19746)210 648 A
(_PROTOTYPE\()462 1026 A
(struct)252 1530 A
(inode)210 1824 A
(*get_inode,)462 2076 A
(\(Dev_t)252 2580 A
(dev,)168 2874 A
(int)126 3084 A
(numb\))210 3252 A
4050(\);)S
2880 V
(19747)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(put_inode,)420 1740 A
(\(struct)294 2202 A
(inode)210 2538 A
(*rip\))210 2790 A
4050(\);)S
2970 V
(19748)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(update_times,)546 1740 A
(\(struct)294 2328 A
(inode)210 2664 A
(*rip\))210 2916 A
4050(\);)S
3060 V
(19749)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(rw_inode,)378 1740 A
(\(struct)294 2160 A
(inode)210 2496 A
(*rip,)210 2748 A
(int)126 3000 A
(rw_flag\))336 3168 A
4050(\);)S
3150 V
(19750)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(wipe_inode,)462 1740 A
(\(struct)294 2244 A
(inode)210 2580 A
(*rip\))210 2832 A
4050(\);)S
3240 V
(19751)210 648 A
3330 V
(19752)210 648 A
1026(/*)S
(link.c)252 1152 A
1446(*/)S
3420 V
(19753)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_link,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
3510 V
(19754)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_unlink,)420 1698 A
(\(void\))252 2160 A
4050(\);)S
3600 V
(19755)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_rename,)420 1698 A
(\(void\))252 2160 A
4050(\);)S
3690 V
(19756)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(truncate,)378 1740 A
(\(struct)294 2160 A
(inode)210 2496 A
(*rip\))210 2748 A
4050(\);)S
3780 V
(19757)210 648 A
3870 V
(19758)210 648 A
1026(/*)S
(lock.c)252 1152 A
1446(*/)S
3960 V
(19759)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(lock_op,)336 1698 A
(\(struct)294 2076 A
(filp)168 2412 A
(*f,)126 2622 A
(int)126 2790 A
(req\))168 2958 A
4050(\);)S
4050 V
(19760)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(lock_revive,)504 1740 A
(\(void\))252 2286 A
4050(\);)S
4140 V
(19761)210 648 A
4230 V
(19762)210 648 A
1026(/*)S
(main.c)252 1152 A
1446(*/)S
4320 V
(19763)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(main,)210 1740 A
(\(void\))252 1992 A
4050(\);)S
4410 V
(19764)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(reply,)252 1740 A
(\(int)168 2034 A
(whom,)210 2244 A
(int)126 2496 A
(result\))294 2664 A
4050(\);)S
4500 V
(19765)210 648 A
4590 V
(19766)210 648 A
1026(/*)S
(misc.c)252 1152 A
1446(*/)S
4680 V
(19767)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_dup,)294 1698 A
(\(void\))252 2034 A
4050(\);)S
4770 V
(19768)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_exit,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
4860 V
(19769)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_fcntl,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
4950 V
(19770)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_fork,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
5040 V
(19771)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_exec,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
5130 V
(19772)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_revive,)420 1698 A
(\(void\))252 2160 A
4050(\);)S
5220 V
(19773)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_set,)294 1698 A
(\(void\))252 2034 A
4050(\);)S
5310 V
(19774)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_sync,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
5400 V
(19775)210 648 A
5490 V
(19776)210 648 A
1026(/*)S
(mount.c)294 1152 A
1488(*/)S
5580 V
(19777)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_mount,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
5670 V
(19778)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_umount,)420 1698 A
(\(void\))252 2160 A
4050(\);)S
5760 V
(19779)210 648 A
5850 V
(19780)210 648 A
1026(/*)S
(open.c)252 1152 A
1446(*/)S
5940 V
(19781)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_close,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
6030 V
(19782)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_creat,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
6120 V
(19783)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_lseek,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
6210 V
(19784)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_mknod,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
8418 V
EP
%%Page: 273 273
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2127(File:)S
2360(src/fs/proto.h)S
12 B
(273)180 4248 A
900 V
7 LST
(19785)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_mkdir,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
990 V
(19786)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_open,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
1080 V
(19787)210 648 A
1170 V
(19788)210 648 A
1026(/*)S
(path.c)252 1152 A
1446(*/)S
1260 V
(19789)210 648 A
(_PROTOTYPE\()462 1026 A
(struct)252 1530 A
(inode)210 1824 A
(*advance,\(struct)672 2076 A
(inode)210 2790 A
(*dirp,)252 3042 A
(char)168 3336 A
(string[NAME_MAX]\)\);)798 3546 A
1350 V
(19790)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(search_dir,)462 1698 A
(\(struct)294 2202 A
(inode)210 2538 A
(*ldir_ptr,)420 2790 A
1440 V
(19791)210 648 A
(char)168 2034 A
(string)252 2244 A
([NAME_MAX],)462 2538 A
(ino_t)210 3042 A
(*numb,)252 3294 A
(int)126 3588 A
(flag\))210 3756 A
4050(\);)S
1530 V
(19792)210 648 A
(_PROTOTYPE\()462 1026 A
(struct)252 1530 A
(inode)210 1824 A
(*eat_path,)420 2076 A
(\(char)210 2538 A
(*path\))252 2790 A
4050(\);)S
1620 V
(19793)210 648 A
(_PROTOTYPE\()462 1026 A
(struct)252 1530 A
(inode)210 1824 A
(*last_dir,)420 2076 A
(\(char)210 2538 A
(*path,)252 2790 A
(char)168 3084 A
(string)252 3294 A
([NAME_MAX]\)\);)546 3588 A
1710 V
(19794)210 648 A
1800 V
(19795)210 648 A
1026(/*)S
(pipe.c)252 1152 A
1446(*/)S
1890 V
(19796)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_pipe,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
1980 V
(19797)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_unpause,)462 1698 A
(\(void\))252 2202 A
4050(\);)S
2070 V
(19798)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(pipe_check,)462 1698 A
(\(struct)294 2202 A
(inode)210 2538 A
(*rip,)210 2790 A
(int)126 3042 A
(rw_flag,)336 3210 A
2160 V
(19799)210 648 A
(int)126 2034 A
(oflags,)294 2202 A
(int)126 2538 A
(bytes,)252 2706 A
(off_t)210 3000 A
(position,)378 3252 A
(int)126 3672 A
(*canwrite\)\);)504 3840 A
2250 V
(19800)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(release,)336 1740 A
(\(struct)294 2118 A
(inode)210 2454 A
(*ip,)168 2706 A
(int)126 2916 A
(call_nr,)336 3084 A
(int)126 3462 A
(count\))252 3630 A
4050(\);)S
2340 V
(19801)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(revive,)294 1740 A
(\(int)168 2076 A
(proc_nr,)336 2286 A
(int)126 2664 A
(bytes\))252 2832 A
4050(\);)S
2430 V
(19802)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(suspend,)336 1740 A
(\(int)168 2118 A
(task\))210 2328 A
4050(\);)S
2520 V
(19803)210 648 A
2610 V
(19804)210 648 A
1026(/*)S
(protect.c)378 1152 A
1572(*/)S
2700 V
(19805)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_access,)420 1698 A
(\(void\))252 2160 A
4050(\);)S
2790 V
(19806)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_chmod,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
2880 V
(19807)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_chown,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
2970 V
(19808)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_umask,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
3060 V
(19809)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(forbidden,)420 1698 A
(\(struct)294 2160 A
(inode)210 2496 A
(*rip,)210 2748 A
(Mode_t)252 3000 A
(access_desired\))630 3294 A
4050(\);)S
3150 V
(19810)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(read_only,)420 1698 A
(\(struct)294 2160 A
(inode)210 2496 A
(*ip\))168 2748 A
4050(\);)S
3240 V
(19811)210 648 A
3330 V
(19812)210 648 A
1026(/*)S
(putk.c)252 1152 A
1446(*/)S
3420 V
(19813)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(putk,)210 1740 A
(\(int)168 1992 A
2202(c\))S
4050(\);)S
3510 V
(19814)210 648 A
3600 V
(19815)210 648 A
1026(/*)S
(read.c)252 1152 A
1446(*/)S
3690 V
(19816)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_read,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
3780 V
(19817)210 648 A
(_PROTOTYPE\()462 1026 A
(struct)252 1530 A
(buf)126 1824 A
(*rahead,)336 1992 A
(\(struct)294 2370 A
(inode)210 2706 A
(*rip,)210 2958 A
(block_t)294 3210 A
(baseblock,)420 3546 A
3870 V
(19818)210 648 A
(off_t)210 2034 A
(position,)378 2286 A
(unsigned)336 2706 A
(bytes_ahead\))504 3084 A
4050(\);)S
3960 V
(19819)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(read_ahead,)462 1740 A
(\(void\))252 2244 A
4050(\);)S
4050 V
(19820)210 648 A
(_PROTOTYPE\()462 1026 A
(block_t)294 1530 A
(read_map,)378 1866 A
(\(struct)294 2286 A
(inode)210 2622 A
(*rip,)210 2874 A
(off_t)210 3126 A
(position\))378 3378 A
4050(\);)S
4140 V
(19821)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(read_write,)462 1698 A
(\(int)168 2202 A
(rw_flag\))336 2412 A
4050(\);)S
4230 V
(19822)210 648 A
(_PROTOTYPE\()462 1026 A
(zone_t)252 1530 A
(rd_indir,)378 1824 A
(\(struct)294 2244 A
(buf)126 2580 A
(*bp,)168 2748 A
(int)126 2958 A
(index\))252 3126 A
4050(\);)S
4320 V
(19823)210 648 A
4410 V
(19824)210 648 A
1026(/*)S
(stadir.c)336 1152 A
1530(*/)S
4500 V
(19825)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_chdir,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
4590 V
(19826)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_chroot,)420 1698 A
(\(void\))252 2160 A
4050(\);)S
4680 V
(19827)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_fstat,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
4770 V
(19828)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_stat,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
4860 V
(19829)210 648 A
4950 V
(19830)210 648 A
1026(/*)S
(super.c)294 1152 A
1488(*/)S
5040 V
(19831)210 648 A
(_PROTOTYPE\()462 1026 A
(bit_t)210 1530 A
(alloc_bit,)420 1782 A
(\(struct)294 2244 A
(super_block)462 2580 A
(*sp,)168 3084 A
(int)126 3294 A
(map,)168 3462 A
(bit_t)210 3672 A
(origin\)\);)378 3924 A
5130 V
(19832)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(free_bit,)378 1740 A
(\(struct)294 2160 A
(super_block)462 2496 A
(*sp,)168 3000 A
(int)126 3210 A
(map,)168 3378 A
5220 V
(19833)210 648 A
(bit_t)210 3042 A
(bit_returned\))546 3294 A
4050(\);)S
5310 V
(19834)210 648 A
(_PROTOTYPE\()462 1026 A
(struct)252 1530 A
(super_block)462 1824 A
(*get_super,)462 2328 A
(\(Dev_t)252 2832 A
(dev\))168 3126 A
4050(\);)S
5400 V
(19835)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(mounted,)336 1698 A
(\(struct)294 2076 A
(inode)210 2412 A
(*rip\))210 2664 A
4050(\);)S
5490 V
(19836)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(read_super,)462 1698 A
(\(struct)294 2202 A
(super_block)462 2538 A
(*sp\))168 3042 A
4050(\);)S
5580 V
(19837)210 648 A
5670 V
(19838)210 648 A
1026(/*)S
(time.c)252 1152 A
1446(*/)S
5760 V
(19839)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_stime,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
5850 V
(19840)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_time,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
5940 V
(19841)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_tims,)336 1698 A
(\(void\))252 2076 A
4050(\);)S
6030 V
(19842)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_utime,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
6120 V
(19843)210 648 A
6210 V
(19844)210 648 A
1026(/*)S
(utility.c)378 1152 A
1572(*/)S
8418 V
EP
%%Page: 274 274
BP
/slant 0 def
/height 0 def
630 V
12 B
(274)180 648 A
11 R
2127(File:)S
2360(src/fs/proto.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(19845)210 648 A
(_PROTOTYPE\()462 1026 A
(time_t)252 1530 A
(clock_time,)462 1824 A
(\(void\))252 2328 A
4050(\);)S
990 V
(19846)210 648 A
(_PROTOTYPE\()462 1026 A
(unsigned)336 1530 A
(conv2,)252 1908 A
(\(int)168 2202 A
(norm,)210 2412 A
(int)126 2664 A
2832(w\))S
4050(\);)S
1080 V
(19847)210 648 A
(_PROTOTYPE\()462 1026 A
(long)168 1530 A
(conv4,)252 1740 A
(\(int)168 2034 A
(norm,)210 2244 A
(long)168 2496 A
2706(x\))S
4050(\);)S
1170 V
(19848)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(fetch_name,)462 1698 A
(\(char)210 2202 A
(*path,)252 2454 A
(int)126 2748 A
(len,)168 2916 A
(int)126 3126 A
(flag\))210 3294 A
4050(\);)S
1260 V
(19849)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(no_sys,)294 1698 A
(\(void\))252 2034 A
4050(\);)S
1350 V
(19850)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(panic,)252 1740 A
(\(char)210 2034 A
(*format,)336 2286 A
(int)126 2664 A
(num\))168 2832 A
4050(\);)S
1440 V
(19851)210 648 A
1530 V
(19852)210 648 A
1026(/*)S
(write.c)294 1152 A
1488(*/)S
1620 V
(19853)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(clear_zone,)462 1740 A
(\(struct)294 2244 A
(inode)210 2580 A
(*rip,)210 2832 A
(off_t)210 3084 A
(pos,)168 3336 A
(int)126 3546 A
(flag\))210 3714 A
4050(\);)S
1710 V
(19854)210 648 A
(_PROTOTYPE\()462 1026 A
(int)126 1530 A
(do_write,)378 1698 A
(\(void\))252 2118 A
4050(\);)S
1800 V
(19855)210 648 A
(_PROTOTYPE\()462 1026 A
(struct)252 1530 A
(buf)126 1824 A
(*new_block,)462 1992 A
(\(struct)294 2496 A
(inode)210 2832 A
(*rip,)210 3084 A
(off_t)210 3336 A
(position\))378 3588 A
4050(\);)S
1890 V
(19856)210 648 A
(_PROTOTYPE\()462 1026 A
(void)168 1530 A
(zero_block,)462 1740 A
(\(struct)294 2244 A
(buf)126 2580 A
(*bp\))168 2748 A
4050(\);)S
2340 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2430 V
(src/fs/glo.h)504 2034 A
2520 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2700 V
(19900)210 648 A
1026(/*)S
(EXTERN)252 1152 A
(should)252 1446 A
1740(be)S
(extern)252 1866 A
(except)252 2160 A
(for)126 2454 A
(the)126 2622 A
(table)210 2790 A
(file)168 3042 A
3252(*/)S
2790 V
(19901)210 648 A
(#ifdef)252 1026 A
(_TABLE)252 1320 A
2880 V
(19902)210 648 A
(#undef)252 1026 A
(EXTERN)252 1320 A
2970 V
(19903)210 648 A
(#define)294 1026 A
(EXTERN)252 1362 A
3060 V
(19904)210 648 A
(#endif)252 1026 A
3150 V
(19905)210 648 A
3240 V
(19906)210 648 A
1026(/*)S
(File)168 1152 A
(System)252 1362 A
(global)252 1656 A
(variables)378 1950 A
2370(*/)S
3330 V
(19907)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(fproc)210 1614 A
(*fp;)168 1866 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(caller's)336 2958 A
(fproc)210 3336 A
(struct)252 3588 A
3882(*/)S
3420 V
(19908)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(super_user;)462 1488 A
2370(/*)S
2496(1)S
2580(if)S
(caller)252 2706 A
3000(is)S
(super_user,)462 3126 A
(else)168 3630 A
3840(0)S
3924(*/)S
3510 V
(19909)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(dont_reply;)462 1488 A
2370(/*)S
(normally)336 2496 A
2874(0;)S
(set)126 3000 A
3168(to)S
3294(1)S
3378(to)S
(inhibit)294 3504 A
(reply)210 3840 A
4092(*/)S
3600 V
(19910)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(susp_count;)462 1488 A
2370(/*)S
(number)252 2496 A
2790(of)S
(procs)210 2916 A
(suspended)378 3168 A
3588(on)S
(pipe)168 3714 A
3924(*/)S
3690 V
(19911)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(nr_locks;)378 1488 A
2370(/*)S
(number)252 2496 A
2790(of)S
(locks)210 2916 A
(currently)378 3168 A
3588(in)S
(place)210 3714 A
3966(*/)S
3780 V
(19912)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(reviving;)378 1488 A
2370(/*)S
(number)252 2496 A
2790(of)S
(pipe)168 2916 A
(processes)378 3126 A
3546(to)S
3672(be)S
(revived)294 3798 A
4134(*/)S
3870 V
(19913)210 648 A
(EXTERN)252 1026 A
(off_t)210 1320 A
(rdahedpos;)420 1572 A
2370(/*)S
(position)336 2496 A
2874(to)S
(read)168 3000 A
(ahead)210 3210 A
3462(*/)S
3960 V
(19914)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(inode)210 1614 A
(*rdahed_inode;)588 1866 A
2706(/*)S
(pointer)294 2832 A
3168(to)S
(inode)210 3294 A
3546(to)S
(read)168 3672 A
(ahead)210 3882 A
4134(*/)S
4050 V
(19915)210 648 A
4140 V
(19916)210 648 A
1026(/*)S
(The)126 1152 A
(parameters)420 1320 A
1782(of)S
(the)126 1908 A
(call)168 2076 A
(are)126 2286 A
(kept)168 2454 A
(here.)210 2664 A
2916(*/)S
4230 V
(19917)210 648 A
(EXTERN)252 1026 A
(message)294 1320 A
1656(m;)S
2370(/*)S
(the)126 2496 A
(input)210 2664 A
(message)294 2916 A
(itself)252 3252 A
3546(*/)S
4320 V
(19918)210 648 A
(EXTERN)252 1026 A
(message)294 1320 A
(m1;)126 1656 A
2370(/*)S
(the)126 2496 A
(output)252 2664 A
(message)294 2958 A
(used)168 3294 A
(for)126 3504 A
(reply)210 3672 A
3924(*/)S
4410 V
(19919)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(who;)168 1488 A
2370(/*)S
(caller's)336 2496 A
(proc)168 2874 A
(number)252 3084 A
3378(*/)S
4500 V
(19920)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(fs_call;)336 1488 A
2370(/*)S
(system)252 2496 A
(call)168 2790 A
(number)252 3000 A
3294(*/)S
4590 V
(19921)210 648 A
(EXTERN)252 1026 A
(char)168 1320 A
(user_path[PATH_MAX];/*)924 1530 A
(storage)294 2496 A
(for)126 2832 A
(user)168 3000 A
(path)168 3210 A
(name)168 3420 A
3630(*/)S
4680 V
(19922)210 648 A
4770 V
(19923)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(variables)378 1740 A
(are)126 2160 A
(used)168 2328 A
(for)126 2538 A
(returning)378 2706 A
(results)294 3126 A
3462(to)S
(the)126 3588 A
(caller.)294 3756 A
4092(*/)S
4860 V
(19924)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(err_code;)378 1488 A
2370(/*)S
(temporary)378 2496 A
(storage)294 2916 A
(for)126 3252 A
(error)210 3420 A
(number)252 3672 A
3966(*/)S
4950 V
(19925)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(rdwt_err;)378 1488 A
2370(/*)S
(status)252 2496 A
2790(of)S
(last)168 2916 A
(disk)168 3126 A
(i/o)126 3336 A
(request)294 3504 A
3840(*/)S
5040 V
(19926)210 648 A
5130 V
(19927)210 648 A
1026(/*)S
(Data)168 1152 A
(which)210 1362 A
(need)168 1614 A
(initialization.)630 1824 A
2496(*/)S
5220 V
(19928)210 648 A
(extern)252 1026 A
(_PROTOTYPE)420 1320 A
(\(int)168 1782 A
(\(*call_vector[]\),)714 1992 A
(\(void\))252 2748 A
3042(\);)S
3168(/*)S
(sys)126 3294 A
(call)168 3462 A
(table)210 3672 A
3924(*/)S
5310 V
(19929)210 648 A
(extern)252 1026 A
(int)126 1320 A
(max_major;)420 1488 A
1992(/*)S
(maximum)294 2118 A
(major)210 2454 A
(device)252 2706 A
3000(\(+)S
3126(1\))S
3252(*/)S
5400 V
(19930)210 648 A
(extern)252 1026 A
(char)168 1320 A
(dot1[2];)336 1530 A
1992(/*)S
(dot1)168 2118 A
(\(&dot1[0]\))420 2328 A
(and)126 2790 A
(dot2)168 2958 A
(\(&dot2[0]\))420 3168 A
(have)168 3630 A
3840(a)S
(special)294 3924 A
4260(*/)S
5490 V
(19931)210 648 A
(extern)252 1026 A
(char)168 1320 A
(dot2[3];)336 1530 A
1992(/*)S
(meaning)294 2118 A
2454(to)S
(search_dir:)462 2580 A
3084(no)S
(access)252 3210 A
(permission)420 3504 A
(check.)252 3966 A
4260(*/)S
8418 V
EP
%%Page: 275 275
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2127(File:)S
2360(src/fs/fproc.h)S
12 B
(275)180 4248 A
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/fs/fproc.h)588 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(20000)210 648 A
1026(/*)S
(This)168 1152 A
1362(is)S
(the)126 1488 A
(per-process)462 1656 A
(information.)504 2160 A
2748(A)S
(slot)168 2832 A
3042(is)S
(reserved)336 3168 A
(for)126 3546 A
(each)168 3714 A
(potential)378 3924 A
1440 V
(20001)210 648 A
1068(*)S
(process.)336 1152 A
(Thus)168 1530 A
(NR_PROCS)336 1740 A
(must)168 2118 A
2328(be)S
(the)126 2454 A
(same)168 2622 A
2832(as)S
2958(in)S
(the)126 3084 A
(kernel.)294 3252 A
3588(It)S
3714(is)S
(not)126 3840 A
(possible)336 4008 A
1530 V
(20002)210 648 A
1068(*)S
1152(or)S
(even)168 1278 A
(necessary)378 1488 A
1908(to)S
(tell)168 2034 A
(when)168 2244 A
2454(a)S
(slot)168 2538 A
2748(is)S
(free)168 2874 A
(here.)210 3084 A
1620 V
(20003)210 648 A
1068(*/)S
1710 V
(20004)210 648 A
1800 V
(20005)210 648 A
1890 V
(20006)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(fproc)210 1614 A
1866({)S
1980 V
(20007)210 648 A
(mode_t)252 1110 A
(fp_umask;)378 1404 A
2370(/*)S
(mask)168 2496 A
(set)126 2706 A
2874(by)S
(umask)210 3000 A
(system)252 3252 A
(call)168 3546 A
3756(*/)S
2070 V
(20008)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*fp_workdir;)504 1656 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(working)294 2958 A
(directory's)462 3294 A
(inode)210 3798 A
4050(*/)S
2160 V
(20009)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*fp_rootdir;)504 1656 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(current)294 2958 A
(root)168 3294 A
(dir)126 3504 A
(\(see)168 3672 A
(chroot\))294 3882 A
4218(*/)S
2250 V
(20010)210 648 A
(struct)252 1110 A
(filp)168 1404 A
(*fp_filp[OPEN_MAX];/*)882 1614 A
(the)126 2538 A
(file)168 2706 A
(descriptor)420 2916 A
(table)210 3378 A
3630(*/)S
2340 V
(20011)210 648 A
(uid_t)210 1110 A
(fp_realuid;)462 1362 A
2370(/*)S
(real)168 2496 A
(user)168 2706 A
2916(id)S
3042(*/)S
2430 V
(20012)210 648 A
(uid_t)210 1110 A
(fp_effuid;)420 1362 A
2370(/*)S
(effective)378 2496 A
(user)168 2916 A
3126(id)S
3252(*/)S
2520 V
(20013)210 648 A
(gid_t)210 1110 A
(fp_realgid;)462 1362 A
2370(/*)S
(real)168 2496 A
(group)210 2706 A
2958(id)S
3084(*/)S
2610 V
(20014)210 648 A
(gid_t)210 1110 A
(fp_effgid;)420 1362 A
2370(/*)S
(effective)378 2496 A
(group)210 2916 A
3168(id)S
3294(*/)S
2700 V
(20015)210 648 A
(dev_t)210 1110 A
(fp_tty;)294 1362 A
2370(/*)S
(major/minor)462 2496 A
3000(of)S
(controlling)462 3126 A
(tty)126 3630 A
3798(*/)S
2790 V
(20016)210 648 A
(int)126 1110 A
(fp_fd;)252 1278 A
2370(/*)S
(place)210 2496 A
2748(to)S
(save)168 2874 A
3084(fd)S
3210(if)S
(rd/wr)210 3336 A
(can't)210 3588 A
(finish)252 3840 A
4134(*/)S
2880 V
(20017)210 648 A
(char)168 1110 A
(*fp_buffer;)462 1320 A
2370(/*)S
(place)210 2496 A
2748(to)S
(save)168 2874 A
(buffer)252 3084 A
3378(if)S
(rd/wr)210 3504 A
(can't)210 3756 A
(finish*/)336 4008 A
2970 V
(20018)210 648 A
(int)126 1110 A
(fp_nbytes;)420 1320 A
2370(/*)S
(place)210 2496 A
2748(to)S
(save)168 2874 A
(bytes)210 3084 A
3336(if)S
(rd/wr)210 3462 A
(can't)210 3714 A
(finish)252 3966 A
4260(*/)S
3060 V
(20019)210 648 A
(int)126 1110 A
(fp_cum_io_partial;)756 1320 A
2370(/*)S
(partial)294 2496 A
(byte)168 2832 A
(count)210 3042 A
3294(if)S
(rd/wr)210 3420 A
(can't)210 3672 A
(finish)252 3924 A
4218(*/)S
3150 V
(20020)210 648 A
(char)168 1110 A
(fp_suspended;)546 1320 A
2370(/*)S
(set)126 2496 A
2664(to)S
(indicate)336 2790 A
(process)294 3168 A
(hanging)294 3504 A
3840(*/)S
3240 V
(20021)210 648 A
(char)168 1110 A
(fp_revived;)462 1320 A
2370(/*)S
(set)126 2496 A
2664(to)S
(indicate)336 2790 A
(process)294 3168 A
(being)210 3504 A
(revived)294 3756 A
4092(*/)S
3330 V
(20022)210 648 A
(char)168 1110 A
(fp_task;)336 1320 A
2370(/*)S
(which)210 2496 A
(task)168 2748 A
2958(is)S
(proc)168 3084 A
(suspended)378 3294 A
3714(on)S
3840(*/)S
3420 V
(20023)210 648 A
(char)168 1110 A
(fp_sesldr;)420 1320 A
2370(/*)S
(true)168 2496 A
2706(if)S
(proc)168 2832 A
3042(is)S
3168(a)S
(session)294 3252 A
(leader)252 3588 A
3882(*/)S
3510 V
(20024)210 648 A
(pid_t)210 1110 A
(fp_pid;)294 1362 A
2370(/*)S
(process)294 2496 A
2832(id)S
2958(*/)S
3600 V
(20025)210 648 A
(long)168 1110 A
(fp_cloexec;)462 1320 A
2370(/*)S
(bit)126 2496 A
(map)126 2664 A
(for)126 2832 A
(POSIX)210 3000 A
(Table)210 3252 A
(6-2)126 3504 A
(FD_CLOEXEC)420 3672 A
4134(*/)S
3690 V
(20026)210 648 A
1026(})S
(fproc[NR_PROCS];)672 1110 A
3780 V
(20027)210 648 A
3870 V
(20028)210 648 A
1026(/*)S
(Field)210 1152 A
(values.)294 1404 A
1740(*/)S
3960 V
(20029)210 648 A
(#define)294 1026 A
(NOT_SUSPENDED)546 1362 A
2160(0)S
2370(/*)S
(process)294 2496 A
2832(is)S
(not)126 2958 A
(suspended)378 3126 A
3546(on)S
(pipe)168 3672 A
3882(or)S
(task)168 4008 A
4218(*/)S
4050 V
(20030)210 648 A
(#define)294 1026 A
(SUSPENDED)378 1362 A
2160(1)S
2370(/*)S
(process)294 2496 A
2832(is)S
(suspended)378 2958 A
3378(on)S
(pipe)168 3504 A
3714(or)S
(task)168 3840 A
4050(*/)S
4140 V
(20031)210 648 A
(#define)294 1026 A
(NOT_REVIVING)504 1362 A
2160(0)S
2370(/*)S
(process)294 2496 A
2832(is)S
(not)126 2958 A
(being)210 3126 A
(revived)294 3378 A
3714(*/)S
4230 V
(20032)210 648 A
(#define)294 1026 A
(REVIVING)336 1362 A
2160(1)S
2370(/*)S
(process)294 2496 A
2832(is)S
(being)210 2958 A
(revived)294 3210 A
(from)168 3546 A
(suspension)420 3756 A
4218(*/)S
4590 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4680 V
(src/fs/buf.h)504 2034 A
4770 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4950 V
(20100)210 648 A
1026(/*)S
(Buffer)252 1152 A
(\(block\))294 1446 A
(cache.)252 1782 A
2118(To)S
(acquire)294 2244 A
2580(a)S
(block,)252 2664 A
2958(a)S
(routine)294 3042 A
(calls)210 3378 A
(get_block\(\),)504 3630 A
5040 V
(20101)210 648 A
1068(*)S
(telling)294 1152 A
(which)210 1488 A
(block)210 1740 A
1992(it)S
(wants.)252 2118 A
(The)126 2454 A
(block)210 2622 A
2874(is)S
(then)168 3000 A
(regarded)336 3210 A
3588(as)S
("in)126 3714 A
(use")168 3882 A
5130 V
(20102)210 648 A
1068(*)S
(and)126 1152 A
(has)126 1320 A
(its)126 1488 A
('b_count')378 1656 A
(field)210 2076 A
(incremented.)504 2328 A
(All)126 2916 A
(the)126 3084 A
(blocks)252 3252 A
(that)168 3546 A
(are)126 3756 A
(not)126 3924 A
5220 V
(20103)210 648 A
1068(*)S
1152(in)S
(use)126 1278 A
(are)126 1446 A
(chained)294 1614 A
(together)336 1950 A
2328(in)S
2454(an)S
(LRU)126 2580 A
(list,)210 2748 A
(with)168 3000 A
('front')294 3210 A
(pointing)336 3546 A
5310 V
(20104)210 648 A
1068(*)S
1152(to)S
(the)126 1278 A
(least)210 1446 A
(recently)336 1698 A
(used)168 2076 A
(block,)252 2286 A
(and)126 2580 A
('rear')252 2748 A
3042(to)S
(the)126 3168 A
(most)168 3336 A
(recently)336 3546 A
(used)168 3924 A
5400 V
(20105)210 648 A
1068(*)S
(block.)252 1152 A
1488(A)S
(reverse)294 1572 A
(chain,)252 1908 A
(using)210 2202 A
(the)126 2454 A
(field)210 2622 A
(b_prev)252 2874 A
3168(is)S
(also)168 3294 A
(maintained.)462 3504 A
5490 V
(20106)210 648 A
1068(*)S
(Usage)210 1152 A
(for)126 1404 A
(LRU)126 1572 A
1740(is)S
(measured)336 1866 A
2244(by)S
(the)126 2370 A
(time)168 2538 A
(the)126 2748 A
(put_block\(\))462 2916 A
3420(is)S
(done.)210 3546 A
(The)126 3840 A
(second)252 4008 A
5580 V
(20107)210 648 A
1068(*)S
(parameter)378 1152 A
1572(to)S
(put_block\(\))462 1698 A
(can)126 2202 A
(violate)294 2370 A
(the)126 2706 A
(LRU)126 2874 A
(order)210 3042 A
(and)126 3294 A
(put)126 3462 A
3630(a)S
(block)210 3714 A
3966(on)S
(the)126 4092 A
5670 V
(20108)210 648 A
1068(*)S
(front)210 1152 A
1404(of)S
(the)126 1530 A
(list,)210 1698 A
1950(if)S
2076(it)S
(will)168 2202 A
(probably)336 2412 A
(not)126 2790 A
2958(be)S
(needed)252 3084 A
(soon.)210 3378 A
3672(If)S
3798(a)S
(block)210 3882 A
5760 V
(20109)210 648 A
1068(*)S
1152(is)S
(modified,)378 1278 A
(the)126 1698 A
(modifying)378 1866 A
(routine)294 2286 A
(must)168 2622 A
(set)126 2832 A
(b_dirt)252 3000 A
3294(to)S
(DIRTY,)252 3420 A
3714(so)S
(the)126 3840 A
(block)210 4008 A
5850 V
(20110)210 648 A
1068(*)S
(will)168 1152 A
(eventually)420 1362 A
1824(be)S
(rewritten)378 1950 A
2370(to)S
(the)126 2496 A
(disk.)210 2664 A
5940 V
(20111)210 648 A
1068(*/)S
6030 V
(20112)210 648 A
6120 V
(20113)210 648 A
(#include)336 1026 A
(<sys/dir.h>)462 1404 A
2706(/*)S
(need)168 2832 A
(struct)252 3042 A
(direct)252 3336 A
3630(*/)S
6210 V
(20114)210 648 A
8418 V
EP
%%Page: 276 276
BP
/slant 0 def
/height 0 def
630 V
12 B
(276)180 648 A
11 R
2170(File:)S
2403(src/fs/buf.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(20115)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(buf)126 1614 A
1782({)S
990 V
(20116)210 648 A
1110(/*)S
(Data)168 1236 A
(portion)294 1446 A
1782(of)S
(the)126 1908 A
(buffer.)294 2076 A
2412(*/)S
1080 V
(20117)210 648 A
(union)210 1110 A
1362({)S
1170 V
(20118)210 648 A
(char)168 1194 A
(b__data[BLOCK_SIZE];)840 1404 A
2916(/*)S
(ordinary)336 3042 A
(user)168 3420 A
(data)168 3630 A
3840(*/)S
1260 V
(20119)210 648 A
(struct)252 1194 A
(direct)252 1488 A
(b__dir[NR_DIR_ENTRIES];)966 1782 A
2916(/*)S
(directory)378 3042 A
(block)210 3462 A
3714(*/)S
1350 V
(20120)210 648 A
(zone1_t)294 1194 A
(b__v1_ind[V1_INDIRECTS];)1008 1530 A
2916(/*)S
3042(V1)S
(indirect)336 3168 A
(block)210 3546 A
3798(*/)S
1440 V
(20121)210 648 A
(zone_t)252 1194 A
(b__v2_ind[V2_INDIRECTS];)1008 1530 A
2916(/*)S
3042(V2)S
(indirect)336 3168 A
(block)210 3546 A
3798(*/)S
1530 V
(20122)210 648 A
(d1_inode)336 1194 A
(b__v1_ino[V1_INODES_PER_BLOCK];)1302 1572 A
2916(/*)S
3042(V1)S
(inode)210 3168 A
(block)210 3420 A
3672(*/)S
1620 V
(20123)210 648 A
(d2_inode)336 1194 A
(b__v2_ino[V2_INODES_PER_BLOCK];)1302 1572 A
2916(/*)S
3042(V2)S
(inode)210 3168 A
(block)210 3420 A
3672(*/)S
1710 V
(20124)210 648 A
(bitchunk_t)420 1194 A
(b__bitmap[BITMAP_CHUNKS];)1050 1656 A
2916(/*)S
(bit)126 3042 A
(map)126 3210 A
(block)210 3378 A
3630(*/)S
1800 V
(20125)210 648 A
1110(})S
1194(b;)S
1890 V
(20126)210 648 A
1980 V
(20127)210 648 A
1110(/*)S
(Header)252 1236 A
(portion)294 1530 A
1866(of)S
(the)126 1992 A
(buffer.)294 2160 A
2496(*/)S
2070 V
(20128)210 648 A
(struct)252 1110 A
(buf)126 1404 A
(*b_next;)336 1572 A
2370(/*)S
(used)168 2496 A
2706(to)S
(link)168 2832 A
(all)126 3042 A
(free)168 3210 A
(bufs)168 3420 A
3630(in)S
3756(a)S
(chain)210 3840 A
4092(*/)S
2160 V
(20129)210 648 A
(struct)252 1110 A
(buf)126 1404 A
(*b_prev;)336 1572 A
2370(/*)S
(used)168 2496 A
2706(to)S
(link)168 2832 A
(all)126 3042 A
(free)168 3210 A
(bufs)168 3420 A
(the)126 3630 A
(other)210 3798 A
(way)126 4050 A
4218(*/)S
2250 V
(20130)210 648 A
(struct)252 1110 A
(buf)126 1404 A
(*b_hash;)336 1572 A
2370(/*)S
(used)168 2496 A
2706(to)S
(link)168 2832 A
(bufs)168 3042 A
3252(on)S
(hash)168 3378 A
(chains)252 3588 A
3882(*/)S
2340 V
(20131)210 648 A
(block_t)294 1110 A
(b_blocknr;)420 1446 A
2370(/*)S
(block)210 2496 A
(number)252 2748 A
3042(of)S
(its)126 3168 A
(\(minor\))294 3336 A
(device)252 3672 A
3966(*/)S
2430 V
(20132)210 648 A
(dev_t)210 1110 A
(b_dev;)252 1362 A
2370(/*)S
(major)210 2496 A
2748(|)S
(minor)210 2832 A
(device)252 3084 A
(where)210 3378 A
(block)210 3630 A
(resides)294 3882 A
4218(*/)S
2520 V
(20133)210 648 A
(char)168 1110 A
(b_dirt;)294 1320 A
2370(/*)S
(CLEAN)210 2496 A
2748(or)S
(DIRTY)210 2874 A
3126(*/)S
2610 V
(20134)210 648 A
(char)168 1110 A
(b_count;)336 1320 A
2370(/*)S
(number)252 2496 A
2790(of)S
(users)210 2916 A
3168(of)S
(this)168 3294 A
(buffer)252 3504 A
3798(*/)S
2700 V
(20135)210 648 A
1026(})S
(buf[NR_BUFS];)546 1110 A
2790 V
(20136)210 648 A
2880 V
(20137)210 648 A
1026(/*)S
1152(A)S
(block)210 1236 A
1488(is)S
(free)168 1614 A
1824(if)S
(b_dev)210 1950 A
2202(==)S
(NO_DEV.)294 2328 A
2664(*/)S
2970 V
(20138)210 648 A
3060 V
(20139)210 648 A
(#define)294 1026 A
(NIL_BUF)294 1362 A
(\(\(struct)336 1698 A
(buf)126 2076 A
2244(*\))S
2370(0\))S
2706(/*)S
(indicates)378 2832 A
(absence)294 3252 A
3588(of)S
3714(a)S
(buffer)252 3798 A
4092(*/)S
3150 V
(20140)210 648 A
3240 V
(20141)210 648 A
1026(/*)S
(These)210 1152 A
(defs)168 1404 A
(make)168 1614 A
1824(it)S
(possible)336 1950 A
2328(to)S
(use)126 2454 A
2622(to)S
(bp->b_data)420 2748 A
(instead)294 3210 A
3546(of)S
(bp->b.b__data)546 3672 A
4260(*/)S
3330 V
(20142)210 648 A
(#define)294 1026 A
(b_data)252 1362 A
(b.b__data)378 1740 A
3420 V
(20143)210 648 A
(#define)294 1026 A
(b_dir)210 1362 A
(b.b__dir)336 1740 A
3510 V
(20144)210 648 A
(#define)294 1026 A
(b_v1_ind)336 1362 A
(b.b__v1_ind)462 1740 A
3600 V
(20145)210 648 A
(#define)294 1026 A
(b_v2_ind)336 1362 A
(b.b__v2_ind)462 1740 A
3690 V
(20146)210 648 A
(#define)294 1026 A
(b_v1_ino)336 1362 A
(b.b__v1_ino)462 1740 A
3780 V
(20147)210 648 A
(#define)294 1026 A
(b_v2_ino)336 1362 A
(b.b__v2_ino)462 1740 A
3870 V
(20148)210 648 A
(#define)294 1026 A
(b_bitmap)336 1362 A
(b.b__bitmap)462 1740 A
3960 V
(20149)210 648 A
4050 V
(20150)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(buf)126 1614 A
(*buf_hash[NR_BUF_HASH];)966 1782 A
3042(/*)S
(the)126 3168 A
(buffer)252 3336 A
(hash)168 3630 A
(table)210 3840 A
4092(*/)S
4140 V
(20151)210 648 A
4230 V
(20152)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(buf)126 1614 A
(*front;)294 1782 A
2370(/*)S
(points)252 2496 A
2790(to)S
(least)210 2916 A
(recently)336 3168 A
(used)168 3546 A
(free)168 3756 A
(block)210 3966 A
4218(*/)S
4320 V
(20153)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(buf)126 1614 A
(*rear;)252 1782 A
2370(/*)S
(points)252 2496 A
2790(to)S
(most)168 2916 A
(recently)336 3126 A
(used)168 3504 A
(free)168 3714 A
(block)210 3924 A
4176(*/)S
4410 V
(20154)210 648 A
(EXTERN)252 1026 A
(int)126 1320 A
(bufs_in_use;)504 1488 A
2370(/*)S
2496(#)S
(bufs)168 2580 A
(currently)378 2790 A
3210(in)S
(use)126 3336 A
(\(not)168 3504 A
3714(on)S
(free)168 3840 A
(list\)*/)294 4050 A
4500 V
(20155)210 648 A
4590 V
(20156)210 648 A
1026(/*)S
(When)168 1152 A
1362(a)S
(block)210 1446 A
1698(is)S
(released,)378 1824 A
(the)126 2244 A
(type)168 2412 A
2622(of)S
(usage)210 2748 A
3000(is)S
(passed)252 3126 A
3420(to)S
(put_block\(\).)504 3546 A
4092(*/)S
4680 V
(20157)210 648 A
(#define)294 1026 A
(WRITE_IMMED)462 1362 A
(0100)168 2160 A
2370(/*)S
(block)210 2496 A
(should)252 2748 A
3042(be)S
(written)294 3168 A
3504(to)S
(disk)168 3630 A
(now)126 3840 A
4008(*/)S
4770 V
(20158)210 648 A
(#define)294 1026 A
(ONE_SHOT)336 1362 A
(0200)168 2160 A
2370(/*)S
(set)126 2496 A
2664(if)S
(block)210 2790 A
(not)126 3042 A
(likely)252 3210 A
3504(to)S
3630(be)S
(needed)252 3756 A
(soon)168 4050 A
4260(*/)S
4860 V
(20159)210 648 A
4950 V
(20160)210 648 A
(#define)294 1026 A
(INODE_BLOCK)462 1362 A
2118(\(0)S
2244(+)S
(MAYBE_WRITE_IMMED\))756 2328 A
3420(/*)S
(inode)210 3546 A
(block)210 3798 A
4050(*/)S
5040 V
(20161)210 648 A
(#define)294 1026 A
(DIRECTORY_BLOCK)630 1362 A
2118(\(1)S
2244(+)S
(MAYBE_WRITE_IMMED\))756 2328 A
3420(/*)S
(directory)378 3546 A
(block)210 3966 A
4218(*/)S
5130 V
(20162)210 648 A
(#define)294 1026 A
(INDIRECT_BLOCK)588 1362 A
2118(\(2)S
2244(+)S
(MAYBE_WRITE_IMMED\))756 2328 A
3420(/*)S
(pointer)294 3546 A
(block)210 3882 A
4134(*/)S
5220 V
(20163)210 648 A
(#define)294 1026 A
(MAP_BLOCK)378 1362 A
2118(\(3)S
2244(+)S
(MAYBE_WRITE_IMMED\))756 2328 A
3420(/*)S
(bit)126 3546 A
(map)126 3714 A
3882(*/)S
5310 V
(20164)210 648 A
(#define)294 1026 A
(ZUPER_BLOCK)462 1362 A
2118(\(4)S
2244(+)S
(WRITE_IMMED)462 2328 A
2832(+)S
(ONE_SHOT\))378 2916 A
3420(/*)S
(super)210 3546 A
(block)210 3798 A
4050(*/)S
5400 V
(20165)210 648 A
(#define)294 1026 A
(FULL_DATA_BLOCK)630 1362 A
2160(5)S
3420(/*)S
(data,)210 3546 A
(fully)210 3798 A
(used)168 4050 A
4260(*/)S
5490 V
(20166)210 648 A
(#define)294 1026 A
(PARTIAL_DATA_BLOCK)756 1362 A
2160(6)S
3420(/*)S
(data,)210 3546 A
(partly)252 3798 A
(used*/)252 4092 A
5580 V
(20167)210 648 A
5670 V
(20168)210 648 A
(#define)294 1026 A
(HASH_MASK)378 1362 A
(\(NR_BUF_HASH)504 1782 A
2328(-)S
2412(1\))S
2706(/*)S
(mask)168 2832 A
(for)126 3042 A
(hashing)294 3210 A
(block)210 3546 A
(numbers)294 3798 A
4134(*/)S
8418 V
EP
%%Page: 277 277
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2164(File:)S
2397(src/fs/dev.h)S
12 B
(277)180 4248 A
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/fs/dev.h)504 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(20200)210 648 A
1026(/*)S
(Device)252 1152 A
(table.)252 1446 A
(This)168 1782 A
(table)210 1992 A
2244(is)S
(indexed)294 2370 A
2706(by)S
(major)210 2832 A
(device)252 3084 A
(number.)294 3378 A
3756(It)S
(provides)336 3882 A
1440 V
(20201)210 648 A
1068(*)S
(the)126 1152 A
(link)168 1320 A
(between)294 1530 A
(major)210 1866 A
(device)252 2118 A
(numbers)294 2412 A
(and)126 2748 A
(the)126 2916 A
(routines)336 3084 A
(that)168 3462 A
(process)294 3672 A
(them.)210 4008 A
1530 V
(20202)210 648 A
1068(*/)S
1620 V
(20203)210 648 A
1710 V
(20204)210 648 A
(typedef)294 1026 A
(_PROTOTYPE)420 1362 A
(\(void)210 1824 A
(\(*dmap_t\),)420 2076 A
(\(int)168 2538 A
(task,)210 2748 A
(message)294 3000 A
(*m_ptr\))294 3336 A
3672(\);)S
1800 V
(20205)210 648 A
1890 V
(20206)210 648 A
(extern)252 1026 A
(struct)252 1320 A
(dmap)168 1614 A
1824({)S
1980 V
(20207)210 648 A
(dmap_t)252 1110 A
(dmap_open;)420 1404 A
2070 V
(20208)210 648 A
(dmap_t)252 1110 A
(dmap_rw;)336 1404 A
2160 V
(20209)210 648 A
(dmap_t)252 1110 A
(dmap_close;)462 1404 A
2250 V
(20210)210 648 A
(int)126 1110 A
(dmap_task;)420 1278 A
2340 V
(20211)210 648 A
1026(})S
(dmap[];)294 1110 A
2430 V
(20212)210 648 A
2790 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2880 V
(src/fs/file.h)546 2034 A
2970 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3150 V
(20300)210 648 A
1026(/*)S
(This)168 1152 A
1362(is)S
(the)126 1488 A
(filp)168 1656 A
(table.)252 1866 A
2202(It)S
2328(is)S
2454(an)S
(intermediary)504 2580 A
(between)294 3126 A
(file)168 3462 A
(descriptors)462 3672 A
(and)126 4176 A
3240 V
(20301)210 648 A
1068(*)S
(inodes.)294 1152 A
1530(A)S
(slot)168 1614 A
1824(is)S
(free)168 1950 A
2160(if)S
(filp_count)420 2286 A
2748(==)S
2874(0.)S
3330 V
(20302)210 648 A
1068(*/)S
3420 V
(20303)210 648 A
3510 V
(20304)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(filp)168 1614 A
1824({)S
3600 V
(20305)210 648 A
(mode_t)252 1110 A
(filp_mode;)420 1404 A
2370(/*)S
2496(RW)S
(bits,)210 2622 A
(telling)294 2874 A
(how)126 3210 A
(file)168 3378 A
3588(is)S
(opened)252 3714 A
4008(*/)S
3690 V
(20306)210 648 A
(int)126 1110 A
(filp_flags;)462 1278 A
2370(/*)S
(flags)210 2496 A
(from)168 2748 A
(open)168 2958 A
(and)126 3168 A
(fcntl)210 3336 A
3588(*/)S
3780 V
(20307)210 648 A
(int)126 1110 A
(filp_count;)462 1278 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(file)168 2874 A
(descriptors)462 3084 A
(share)210 3588 A
(this)168 3840 A
(slot?*/)294 4050 A
3870 V
(20308)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*filp_ino;)420 1656 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(the)126 2958 A
(inode)210 3126 A
3378(*/)S
3960 V
(20309)210 648 A
(off_t)210 1110 A
(filp_pos;)378 1362 A
2370(/*)S
(file)168 2496 A
(position)336 2706 A
3084(*/)S
4050 V
(20310)210 648 A
1026(})S
(filp[NR_FILPS];)630 1110 A
4140 V
(20311)210 648 A
4230 V
(20312)210 648 A
(#define)294 1026 A
(FILP_CLOSED)462 1362 A
2034(0)S
2370(/*)S
(filp_mode:)420 2496 A
(associated)420 2958 A
(device)252 3420 A
(closed)252 3714 A
4008(*/)S
4320 V
(20313)210 648 A
4410 V
(20314)210 648 A
(#define)294 1026 A
(NIL_FILP)336 1362 A
(\(struct)294 1740 A
(filp)168 2076 A
2286(*\))S
2412(0)S
2706(/*)S
(indicates)378 2832 A
(absence)294 3252 A
3588(of)S
3714(a)S
(filp)168 3798 A
(slot)168 4008 A
4218(*/)S
5040 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5130 V
(src/fs/lock.h)546 2034 A
5220 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5400 V
(20400)210 648 A
1026(/*)S
(This)168 1152 A
1362(is)S
(the)126 1488 A
(file)168 1656 A
(locking)294 1866 A
(table.)252 2202 A
(Like)168 2538 A
(the)126 2748 A
(filp)168 2916 A
(table,)252 3126 A
3420(it)S
(points)252 3546 A
3840(to)S
(the)126 3966 A
5490 V
(20401)210 648 A
1068(*)S
(inode)210 1152 A
(table,)252 1404 A
(however,)336 1698 A
2076(in)S
(this)168 2202 A
(case)168 2412 A
2622(to)S
(achieve)294 2748 A
(advisory)336 3084 A
(locking.)336 3462 A
5580 V
(20402)210 648 A
1068(*/)S
5670 V
(20403)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(file_lock)378 1614 A
2034({)S
5760 V
(20404)210 648 A
(short)210 1110 A
(lock_type;)420 1362 A
2370(/*)S
(F_RDLOCK)336 2496 A
2874(or)S
(F_WRLOCK;)378 3000 A
3420(0)S
(means)210 3504 A
(unused)252 3756 A
(slot)168 4050 A
4260(*/)S
5850 V
(20405)210 648 A
(pid_t)210 1110 A
(lock_pid;)378 1362 A
2370(/*)S
(pid)126 2496 A
2664(of)S
(the)126 2790 A
(process)294 2958 A
(holding)294 3294 A
(the)126 3630 A
(lock)168 3798 A
4008(*/)S
5940 V
(20406)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*lock_inode;)504 1656 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(the)126 2958 A
(inode)210 3126 A
(locked)252 3378 A
3672(*/)S
6030 V
(20407)210 648 A
(off_t)210 1110 A
(lock_first;)462 1362 A
2370(/*)S
(offset)252 2496 A
2790(of)S
(first)210 2916 A
(byte)168 3168 A
(locked)252 3378 A
3672(*/)S
6120 V
(20408)210 648 A
(off_t)210 1110 A
(lock_last;)420 1362 A
2370(/*)S
(offset)252 2496 A
2790(of)S
(last)168 2916 A
(byte)168 3126 A
(locked)252 3336 A
3630(*/)S
6210 V
(20409)210 648 A
1026(})S
(file_lock[NR_LOCKS];)840 1110 A
8418 V
EP
%%Page: 278 278
BP
/slant 0 def
/height 0 def
630 V
12 B
(278)180 648 A
11 R
2121(File:)S
(src/fs/inode.h)601 2354 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/fs/inode.h)588 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(20500)210 648 A
1026(/*)S
(Inode)210 1152 A
(table.)252 1404 A
(This)168 1740 A
(table)210 1950 A
(holds)210 2202 A
(inodes)252 2454 A
(that)168 2748 A
(are)126 2958 A
(currently)378 3126 A
3546(in)S
(use.)168 3672 A
3924(In)S
(some)168 4050 A
1440 V
(20501)210 648 A
1068(*)S
(cases)210 1152 A
(they)168 1404 A
(have)168 1614 A
(been)168 1824 A
(opened)252 2034 A
2328(by)S
2454(an)S
(open\(\))252 2580 A
2874(or)S
(creat\(\))294 3000 A
(system)252 3336 A
(call,)210 3630 A
3882(in)S
(other)210 4008 A
1530 V
(20502)210 648 A
1068(*)S
(cases)210 1152 A
(the)126 1404 A
(file)168 1572 A
(system)252 1782 A
(itself)252 2076 A
(needs)210 2370 A
(the)126 2622 A
(inode)210 2790 A
(for)126 3042 A
(one)126 3210 A
(reason)252 3378 A
3672(or)S
(another,)336 3798 A
1620 V
(20503)210 648 A
1068(*)S
(such)168 1152 A
1362(as)S
1488(to)S
(search)252 1614 A
1908(a)S
(directory)378 1992 A
(for)126 2412 A
2580(a)S
(path)168 2664 A
(name.)210 2874 A
1710 V
(20504)210 648 A
1068(*)S
(The)126 1152 A
(first)210 1320 A
(part)168 1572 A
1782(of)S
(the)126 1908 A
(struct)252 2076 A
(holds)210 2370 A
(fields)252 2622 A
(that)168 2916 A
(are)126 3126 A
(present)294 3294 A
3630(on)S
(the)126 3756 A
1800 V
(20505)210 648 A
1068(*)S
(disk;)210 1152 A
(the)126 1404 A
(second)252 1572 A
(part)168 1866 A
(holds)210 2076 A
(fields)252 2328 A
(not)126 2622 A
(present)294 2790 A
3126(on)S
(the)126 3252 A
(disk.)210 3420 A
1890 V
(20506)210 648 A
1068(*)S
(The)126 1152 A
(disk)168 1320 A
(inode)210 1530 A
(part)168 1782 A
1992(is)S
(also)168 2118 A
(declared)336 2328 A
2706(in)S
("type.h")336 2832 A
3210(as)S
('d1_inode')420 3336 A
(for)126 3798 A
3966(V1)S
1980 V
(20507)210 648 A
1068(*)S
(file)168 1152 A
(systems)294 1362 A
(and)126 1698 A
('d2_inode')420 1866 A
(for)126 2328 A
2496(V2)S
(file)168 2622 A
(systems.)336 2832 A
2070 V
(20508)210 648 A
1068(*/)S
2160 V
(20509)210 648 A
2250 V
(20510)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(inode)210 1614 A
1866({)S
2340 V
(20511)210 648 A
(mode_t)252 1110 A
(i_mode;)294 1404 A
2370(/*)S
(file)168 2496 A
(type,)210 2706 A
(protection,)462 2958 A
(etc.)168 3462 A
3672(*/)S
2430 V
(20512)210 648 A
(nlink_t)294 1110 A
(i_nlinks;)378 1446 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(links)210 2874 A
3126(to)S
(this)168 3252 A
(file)168 3462 A
3672(*/)S
2520 V
(20513)210 648 A
(uid_t)210 1110 A
(i_uid;)252 1362 A
2370(/*)S
(user)168 2496 A
2706(id)S
2832(of)S
(the)126 2958 A
(file's)252 3126 A
(owner)210 3420 A
3672(*/)S
2610 V
(20514)210 648 A
(gid_t)210 1110 A
(i_gid;)252 1362 A
2370(/*)S
(group)210 2496 A
(number)252 2748 A
3042(*/)S
2700 V
(20515)210 648 A
(off_t)210 1110 A
(i_size;)294 1362 A
2370(/*)S
(current)294 2496 A
(file)168 2832 A
(size)168 3042 A
3252(in)S
(bytes)210 3378 A
3630(*/)S
2790 V
(20516)210 648 A
(time_t)252 1110 A
(i_atime;)336 1404 A
2370(/*)S
(time)168 2496 A
2706(of)S
(last)168 2832 A
(access)252 3042 A
(\(V2)126 3336 A
(only\))210 3504 A
3756(*/)S
2880 V
(20517)210 648 A
(time_t)252 1110 A
(i_mtime;)336 1404 A
2370(/*)S
(when)168 2496 A
(was)126 2706 A
(file)168 2874 A
(data)168 3084 A
(last)168 3294 A
(changed)294 3504 A
3840(*/)S
2970 V
(20518)210 648 A
(time_t)252 1110 A
(i_ctime;)336 1404 A
2370(/*)S
(when)168 2496 A
(was)126 2706 A
(inode)210 2874 A
(itself)252 3126 A
(changed)294 3420 A
(\(V2)126 3756 A
(only\)*/)294 3924 A
3060 V
(20519)210 648 A
(zone_t)252 1110 A
(i_zone[V2_NR_TZONES];)882 1404 A
2370(/*)S
(zone)168 2496 A
(numbers)294 2706 A
(for)126 3042 A
(direct,)294 3210 A
(ind,)168 3546 A
(and)126 3756 A
(dbl)126 3924 A
(ind)126 4092 A
4260(*/)S
3150 V
(20520)210 648 A
3240 V
(20521)210 648 A
1110(/*)S
(The)126 1236 A
(following)378 1404 A
(items)210 1824 A
(are)126 2076 A
(not)126 2244 A
(present)294 2412 A
2748(on)S
(the)126 2874 A
(disk.)210 3042 A
3294(*/)S
3330 V
(20522)210 648 A
(dev_t)210 1110 A
(i_dev;)252 1362 A
2370(/*)S
(which)210 2496 A
(device)252 2748 A
3042(is)S
(the)126 3168 A
(inode)210 3336 A
3588(on)S
3714(*/)S
3420 V
(20523)210 648 A
(ino_t)210 1110 A
(i_num;)252 1362 A
2370(/*)S
(inode)210 2496 A
(number)252 2748 A
3042(on)S
(its)126 3168 A
(\(minor\))294 3336 A
(device)252 3672 A
3966(*/)S
3510 V
(20524)210 648 A
(int)126 1110 A
(i_count;)336 1278 A
2370(/*)S
2496(#)S
(times)210 2580 A
(inode)210 2832 A
(used;)210 3084 A
3336(0)S
(means)210 3420 A
(slot)168 3672 A
3882(is)S
(free)168 4008 A
4218(*/)S
3600 V
(20525)210 648 A
(int)126 1110 A
(i_ndzones;)420 1278 A
2370(/*)S
2496(#)S
(direct)252 2580 A
(zones)210 2874 A
(\(Vx_NR_DZONES\))588 3126 A
3756(*/)S
3690 V
(20526)210 648 A
(int)126 1110 A
(i_nindirs;)420 1278 A
2370(/*)S
2496(#)S
(indirect)336 2580 A
(zones)210 2958 A
(per)126 3210 A
(indirect)336 3378 A
(block)210 3756 A
4008(*/)S
3780 V
(20527)210 648 A
(struct)252 1110 A
(super_block)462 1404 A
(*i_sp;)252 1908 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(super)210 2958 A
(block)210 3210 A
(for)126 3462 A
(inode's)294 3630 A
(device)252 3966 A
4260(*/)S
3870 V
(20528)210 648 A
(char)168 1110 A
(i_dirt;)294 1320 A
2370(/*)S
(CLEAN)210 2496 A
2748(or)S
(DIRTY)210 2874 A
3126(*/)S
3960 V
(20529)210 648 A
(char)168 1110 A
(i_pipe;)294 1320 A
2370(/*)S
(set)126 2496 A
2664(to)S
(I_PIPE)252 2790 A
3084(if)S
(pipe)168 3210 A
3420(*/)S
4050 V
(20530)210 648 A
(char)168 1110 A
(i_mount;)336 1320 A
2370(/*)S
(this)168 2496 A
(bit)126 2706 A
2874(is)S
(set)126 3000 A
3168(if)S
(file)168 3294 A
(mounted)294 3504 A
3840(on)S
3966(*/)S
4140 V
(20531)210 648 A
(char)168 1110 A
(i_seek;)294 1320 A
2370(/*)S
(set)126 2496 A
2664(on)S
(LSEEK,)252 2790 A
(cleared)294 3084 A
3420(on)S
(READ/WRITE)420 3546 A
4008(*/)S
4230 V
(20532)210 648 A
(char)168 1110 A
(i_update;)378 1320 A
2370(/*)S
(the)126 2496 A
(ATIME,)252 2664 A
(CTIME,)252 2958 A
(and)126 3252 A
(MTIME)210 3420 A
(bits)168 3672 A
(are)126 3882 A
(here)168 4050 A
4260(*/)S
4320 V
(20533)210 648 A
1026(})S
(inode[NR_INODES];)714 1110 A
4410 V
(20534)210 648 A
4500 V
(20535)210 648 A
4590 V
(20536)210 648 A
(#define)294 1026 A
(NIL_INODE)378 1362 A
(\(struct)294 1782 A
(inode)210 2118 A
2370(*\))S
2496(0)S
2706(/*)S
(indicates)378 2832 A
(absence)294 3252 A
3588(of)S
(inode)210 3714 A
(slot)168 3966 A
4176(*/)S
4680 V
(20537)210 648 A
4770 V
(20538)210 648 A
1026(/*)S
(Field)210 1152 A
(values.)294 1404 A
(Note)168 1782 A
(that)168 1992 A
(CLEAN)210 2202 A
(and)126 2454 A
(DIRTY)210 2622 A
(are)126 2874 A
(defined)294 3042 A
3378(in)S
("const.h")378 3504 A
3924(*/)S
4860 V
(20539)210 648 A
(#define)294 1026 A
(NO_PIPE)294 1362 A
2160(0)S
2370(/*)S
(i_pipe)252 2496 A
2790(is)S
(NO_PIPE)294 2916 A
3252(if)S
(inode)210 3378 A
3630(is)S
(not)126 3756 A
3924(a)S
(pipe)168 4008 A
4218(*/)S
4950 V
(20540)210 648 A
(#define)294 1026 A
(I_PIPE)252 1362 A
2160(1)S
2370(/*)S
(i_pipe)252 2496 A
2790(is)S
(I_PIPE)252 2916 A
3210(if)S
(inode)210 3336 A
3588(is)S
3714(a)S
(pipe)168 3798 A
4008(*/)S
5040 V
(20541)210 648 A
(#define)294 1026 A
(NO_MOUNT)336 1362 A
2160(0)S
2370(/*)S
(i_mount)294 2496 A
2832(is)S
(NO_MOUNT)336 2958 A
3336(if)S
(file)168 3462 A
(not)126 3672 A
(mounted)294 3840 A
(on*/)168 4176 A
5130 V
(20542)210 648 A
(#define)294 1026 A
(I_MOUNT)294 1362 A
2160(1)S
2370(/*)S
(i_mount)294 2496 A
2832(is)S
(I_MOUNT)294 2958 A
3294(if)S
(file)168 3420 A
(mounted)294 3630 A
3966(on)S
4092(*/)S
5220 V
(20543)210 648 A
(#define)294 1026 A
(NO_SEEK)294 1362 A
2160(0)S
2370(/*)S
(i_seek)252 2496 A
2790(=)S
(NO_SEEK)294 2874 A
3210(if)S
(last)168 3336 A
3546(op)S
(was)126 3672 A
(not)126 3840 A
(SEEK)168 4008 A
4218(*/)S
5310 V
(20544)210 648 A
(#define)294 1026 A
(ISEEK)210 1362 A
2160(1)S
2370(/*)S
(i_seek)252 2496 A
2790(=)S
(ISEEK)210 2874 A
3126(if)S
(last)168 3252 A
3462(op)S
(was)126 3588 A
(SEEK)168 3756 A
3966(*/)S
8418 V
EP
%%Page: 279 279
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2105(File:)S
2338(src/fs/param.h)S
12 B
(279)180 4248 A
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/fs/param.h)588 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(20600)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(names)210 1740 A
(are)126 1992 A
(synonyms)336 2160 A
(for)126 2538 A
(the)126 2706 A
(variables)378 2874 A
3294(in)S
(the)126 3420 A
(input)210 3588 A
(message.)336 3840 A
4218(*/)S
1440 V
(20601)210 648 A
(#define)294 1026 A
(acc_time)336 1362 A
(m.m2_l1)294 1950 A
1530 V
(20602)210 648 A
(#define)294 1026 A
(addr)168 1362 A
(m.m1_i3)294 1950 A
1620 V
(20603)210 648 A
(#define)294 1026 A
(buffer)252 1362 A
(m.m1_p1)294 1950 A
1710 V
(20604)210 648 A
(#define)294 1026 A
(child)210 1362 A
(m.m1_i2)294 1950 A
1800 V
(20605)210 648 A
(#define)294 1026 A
(co_mode)294 1362 A
(m.m1_i1)294 1950 A
1890 V
(20606)210 648 A
(#define)294 1026 A
(eff_grp_id)420 1362 A
(m.m1_i3)294 1950 A
1980 V
(20607)210 648 A
(#define)294 1026 A
(eff_user_id)462 1362 A
(m.m1_i3)294 1950 A
2070 V
(20608)210 648 A
(#define)294 1026 A
(erki)168 1362 A
(m.m1_p1)294 1950 A
2160 V
(20609)210 648 A
(#define)294 1026 A
1362(fd)S
(m.m1_i1)294 1950 A
2250 V
(20610)210 648 A
(#define)294 1026 A
(fd2)126 1362 A
(m.m1_i2)294 1950 A
2340 V
(20611)210 648 A
(#define)294 1026 A
(ioflags)294 1362 A
(m.m1_i3)294 1950 A
2430 V
(20612)210 648 A
(#define)294 1026 A
(group)210 1362 A
(m.m1_i3)294 1950 A
2520 V
(20613)210 648 A
(#define)294 1026 A
(real_grp_id)462 1362 A
(m.m1_i2)294 1950 A
2610 V
(20614)210 648 A
(#define)294 1026 A
(ls_fd)210 1362 A
(m.m2_i1)294 1950 A
2700 V
(20615)210 648 A
(#define)294 1026 A
(mk_mode)294 1362 A
(m.m1_i2)294 1950 A
2790 V
(20616)210 648 A
(#define)294 1026 A
(mode)168 1362 A
(m.m3_i2)294 1950 A
2880 V
(20617)210 648 A
(#define)294 1026 A
(c_mode)252 1362 A
(m.m1_i3)294 1950 A
2970 V
(20618)210 648 A
(#define)294 1026 A
(c_name)252 1362 A
(m.m1_p1)294 1950 A
3060 V
(20619)210 648 A
(#define)294 1026 A
(name)168 1362 A
(m.m3_p1)294 1950 A
3150 V
(20620)210 648 A
(#define)294 1026 A
(name1)210 1362 A
(m.m1_p1)294 1950 A
3240 V
(20621)210 648 A
(#define)294 1026 A
(name2)210 1362 A
(m.m1_p2)294 1950 A
3330 V
(20622)210 648 A
(#define)294 1026 A
(name_length)462 1362 A
(m.m3_i1)294 1950 A
3420 V
(20623)210 648 A
(#define)294 1026 A
(name1_length)504 1362 A
(m.m1_i1)294 1950 A
3510 V
(20624)210 648 A
(#define)294 1026 A
(name2_length)504 1362 A
(m.m1_i2)294 1950 A
3600 V
(20625)210 648 A
(#define)294 1026 A
(nbytes)252 1362 A
(m.m1_i2)294 1950 A
3690 V
(20626)210 648 A
(#define)294 1026 A
(offset)252 1362 A
(m.m2_l1)294 1950 A
3780 V
(20627)210 648 A
(#define)294 1026 A
(owner)210 1362 A
(m.m1_i2)294 1950 A
3870 V
(20628)210 648 A
(#define)294 1026 A
(parent)252 1362 A
(m.m1_i1)294 1950 A
3960 V
(20629)210 648 A
(#define)294 1026 A
(pathname)336 1362 A
(m.m3_ca1)336 1950 A
4050 V
(20630)210 648 A
(#define)294 1026 A
(pid)126 1362 A
(m.m1_i3)294 1950 A
4140 V
(20631)210 648 A
(#define)294 1026 A
(pro)126 1362 A
(m.m1_i1)294 1950 A
4230 V
(20632)210 648 A
(#define)294 1026 A
(rd_only)294 1362 A
(m.m1_i3)294 1950 A
4320 V
(20633)210 648 A
(#define)294 1026 A
(real_user_id)504 1362 A
(m.m1_i2)294 1950 A
4410 V
(20634)210 648 A
(#define)294 1026 A
(request)294 1362 A
(m.m1_i2)294 1950 A
4500 V
(20635)210 648 A
(#define)294 1026 A
(sig)126 1362 A
(m.m1_i2)294 1950 A
4590 V
(20636)210 648 A
(#define)294 1026 A
(slot1)210 1362 A
(m.m1_i1)294 1950 A
4680 V
(20637)210 648 A
(#define)294 1026 A
1362(tp)S
(m.m2_l1)294 1950 A
4770 V
(20638)210 648 A
(#define)294 1026 A
(utime_actime)504 1362 A
(m.m2_l1)294 1950 A
4860 V
(20639)210 648 A
(#define)294 1026 A
(utime_modtime)546 1362 A
(m.m2_l2)294 1950 A
4950 V
(20640)210 648 A
(#define)294 1026 A
(utime_file)420 1362 A
(m.m2_p1)294 1950 A
5040 V
(20641)210 648 A
(#define)294 1026 A
(utime_length)504 1362 A
(m.m2_i1)294 1950 A
5130 V
(20642)210 648 A
(#define)294 1026 A
(whence)252 1362 A
(m.m2_i2)294 1950 A
5220 V
(20643)210 648 A
5310 V
(20644)210 648 A
1026(/*)S
(The)126 1152 A
(following)378 1320 A
(names)210 1740 A
(are)126 1992 A
(synonyms)336 2160 A
(for)126 2538 A
(the)126 2706 A
(variables)378 2874 A
3294(in)S
(the)126 3420 A
(output)252 3588 A
(message.)336 3882 A
4260(*/)S
5400 V
(20645)210 648 A
(#define)294 1026 A
(reply_type)420 1362 A
(m1.m_type)378 1950 A
5490 V
(20646)210 648 A
(#define)294 1026 A
(reply_l1)336 1362 A
(m1.m2_l1)336 1950 A
5580 V
(20647)210 648 A
(#define)294 1026 A
(reply_i1)336 1362 A
(m1.m1_i1)336 1950 A
5670 V
(20648)210 648 A
(#define)294 1026 A
(reply_i2)336 1362 A
(m1.m1_i2)336 1950 A
5760 V
(20649)210 648 A
(#define)294 1026 A
(reply_t1)336 1362 A
(m1.m4_l1)336 1950 A
5850 V
(20650)210 648 A
(#define)294 1026 A
(reply_t2)336 1362 A
(m1.m4_l2)336 1950 A
5940 V
(20651)210 648 A
(#define)294 1026 A
(reply_t3)336 1362 A
(m1.m4_l3)336 1950 A
6030 V
(20652)210 648 A
(#define)294 1026 A
(reply_t4)336 1362 A
(m1.m4_l4)336 1950 A
6120 V
(20653)210 648 A
(#define)294 1026 A
(reply_t5)336 1362 A
(m1.m4_l5)336 1950 A
8418 V
EP
%%Page: 280 280
BP
/slant 0 def
/height 0 def
630 V
12 B
(280)180 648 A
11 R
2124(File:)S
2357(src/fs/super.h)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/fs/super.h)588 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(20700)210 648 A
1026(/*)S
(Super)210 1152 A
(block)210 1404 A
(table.)252 1656 A
(The)126 1992 A
(root)168 2160 A
(file)168 2370 A
(system)252 2580 A
(and)126 2874 A
(every)210 3042 A
(mounted)294 3294 A
(file)168 3630 A
(system)252 3840 A
1440 V
(20701)210 648 A
1068(*)S
(has)126 1152 A
1320(an)S
(entry)210 1446 A
(here.)210 1698 A
(The)126 1992 A
(entry)210 2160 A
(holds)210 2412 A
(information)462 2664 A
(about)210 3168 A
(the)126 3420 A
(sizes)210 3588 A
3840(of)S
(the)126 3966 A
(bit)126 4134 A
1530 V
(20702)210 648 A
1068(*)S
(maps)168 1152 A
(and)126 1362 A
(inodes.)294 1530 A
(The)126 1908 A
(s_ninodes)378 2076 A
(field)210 2496 A
(gives)210 2748 A
(the)126 3000 A
(number)252 3168 A
3462(of)S
(inodes)252 3588 A
(available)378 3882 A
1620 V
(20703)210 648 A
1068(*)S
(for)126 1152 A
(files)210 1320 A
(and)126 1572 A
(directories,)504 1740 A
(including)378 2286 A
(the)126 2706 A
(root)168 2874 A
(directory.)420 3084 A
(Inode)210 3588 A
3840(0)S
3924(is)S
1710 V
(20704)210 648 A
1068(*)S
1152(on)S
(the)126 1278 A
(disk,)210 1446 A
(but)126 1698 A
(not)126 1866 A
(used.)210 2034 A
(Thus)168 2328 A
(s_ninodes)378 2538 A
2958(=)S
3042(4)S
(means)210 3126 A
(that)168 3378 A
3588(5)S
(bits)168 3672 A
(will)168 3882 A
4092(be)S
1800 V
(20705)210 648 A
1068(*)S
(used)168 1152 A
1362(in)S
(the)126 1488 A
(bit)126 1656 A
(map,)168 1824 A
(bit)126 2034 A
2202(0,)S
(which)210 2328 A
2580(is)S
(always)252 2706 A
3000(1)S
(and)126 3084 A
(not)126 3252 A
(used,)210 3420 A
(and)126 3672 A
(bits)168 3840 A
(1-4)126 4050 A
1890 V
(20706)210 648 A
1068(*)S
(for)126 1152 A
(files)210 1320 A
(and)126 1572 A
(directories.)504 1740 A
(The)126 2328 A
(disk)168 2496 A
(layout)252 2706 A
(is:)126 3000 A
1980 V
(20707)210 648 A
1068(*)S
2070 V
(20708)210 648 A
1068(*)S
(Item)168 1362 A
1866(#)S
(blocks)252 1950 A
2160 V
(20709)210 648 A
1068(*)S
(boot)168 1278 A
(block)210 1488 A
1950(1)S
2250 V
(20710)210 648 A
1068(*)S
(super)210 1278 A
(block)210 1530 A
1950(1)S
2340 V
(20711)210 648 A
1068(*)S
(inode)210 1278 A
(map)126 1530 A
(s_imap_blocks)546 1866 A
2430 V
(20712)210 648 A
1068(*)S
(zone)168 1278 A
(map)126 1488 A
(s_zmap_blocks)546 1866 A
2520 V
(20713)210 648 A
1068(*)S
(inodes)252 1278 A
(\(s_ninodes)420 1866 A
2328(+)S
('inodes)294 2412 A
(per)126 2748 A
(block')252 2916 A
3210(-)S
(1\)/'inodes)420 3294 A
(per)126 3756 A
(block')252 3924 A
2610 V
(20714)210 648 A
1068(*)S
(unused)252 1278 A
(whatever)336 1866 A
2244(is)S
(needed)252 2370 A
2664(to)S
(fill)168 2790 A
(out)126 3000 A
(the)126 3168 A
(current)294 3336 A
(zone)168 3672 A
2700 V
(20715)210 648 A
1068(*)S
(data)168 1278 A
(zones)210 1488 A
(\(s_zones)336 1866 A
2244(-)S
(s_firstdatazone\))672 2328 A
3042(<<)S
(s_log_zone_size)630 3168 A
2790 V
(20716)210 648 A
1068(*)S
2880 V
(20717)210 648 A
1068(*)S
1152(A)S
(super_block)462 1236 A
(slot)168 1740 A
1950(is)S
(free)168 2076 A
2286(if)S
(s_dev)210 2412 A
2664(==)S
(NO_DEV.)294 2790 A
2970 V
(20718)210 648 A
1068(*/)S
3060 V
(20719)210 648 A
3150 V
(20720)210 648 A
3240 V
(20721)210 648 A
(EXTERN)252 1026 A
(struct)252 1320 A
(super_block)462 1614 A
2118({)S
3330 V
(20722)210 648 A
(ino_t)210 1110 A
(s_ninodes;)420 1362 A
2370(/*)S
2496(#)S
(usable)252 2580 A
(inodes)252 2874 A
3168(on)S
(the)126 3294 A
(minor)210 3462 A
(device)252 3714 A
4008(*/)S
3420 V
(20723)210 648 A
(zone1_t)294 1110 A
(s_nzones;)378 1488 A
2370(/*)S
(total)210 2496 A
(device)252 2748 A
(size,)210 3042 A
(including)378 3294 A
(bit)126 3714 A
(maps)168 3882 A
(etc)126 4092 A
4260(*/)S
3510 V
(20724)210 648 A
(short)210 1110 A
(s_imap_blocks;)588 1362 A
2370(/*)S
2496(#)S
2580(of)S
(blocks)252 2706 A
(used)168 3000 A
3210(by)S
(inode)210 3336 A
(bit)126 3588 A
(map)126 3756 A
3924(*/)S
3600 V
(20725)210 648 A
(short)210 1110 A
(s_zmap_blocks;)588 1362 A
2370(/*)S
2496(#)S
2580(of)S
(blocks)252 2706 A
(used)168 3000 A
3210(by)S
(zone)168 3336 A
(bit)126 3546 A
(map)126 3714 A
3882(*/)S
3690 V
(20726)210 648 A
(zone1_t)294 1110 A
(s_firstdatazone;)672 1446 A
2370(/*)S
(number)252 2496 A
2790(of)S
(first)210 2916 A
(data)168 3168 A
(zone)168 3378 A
3588(*/)S
3780 V
(20727)210 648 A
(short)210 1110 A
(s_log_zone_size;)672 1362 A
2370(/*)S
(log2)168 2496 A
2706(of)S
(blocks/zone)462 2832 A
3336(*/)S
3870 V
(20728)210 648 A
(off_t)210 1110 A
(s_max_size;)462 1362 A
2370(/*)S
(maximum)294 2496 A
(file)168 2832 A
(size)168 3042 A
3252(on)S
(this)168 3378 A
(device)252 3588 A
3882(*/)S
3960 V
(20729)210 648 A
(short)210 1110 A
(s_magic;)336 1362 A
2370(/*)S
(magic)210 2496 A
(number)252 2748 A
3042(to)S
(recognize)378 3168 A
(super-blocks)504 3588 A
4134(*/)S
4050 V
(20730)210 648 A
(short)210 1110 A
(s_pad;)252 1362 A
2370(/*)S
(try)126 2496 A
2664(to)S
(avoid)210 2790 A
(compiler-dependent)756 3042 A
(padding)294 3840 A
4176(*/)S
4140 V
(20731)210 648 A
(zone_t)252 1110 A
(s_zones;)336 1404 A
2370(/*)S
(number)252 2496 A
2790(of)S
(zones)210 2916 A
(\(replaces)378 3168 A
(s_nzones)336 3588 A
3966(in)S
(V2\))126 4092 A
4260(*/)S
4230 V
(20732)210 648 A
4320 V
(20733)210 648 A
1110(/*)S
(The)126 1236 A
(following)378 1404 A
(items)210 1824 A
(are)126 2076 A
(only)168 2244 A
(used)168 2454 A
(when)168 2664 A
(the)126 2874 A
(super_block)462 3042 A
3546(is)S
3672(in)S
(memory.)294 3798 A
4134(*/)S
4410 V
(20734)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*s_isup;)336 1656 A
2370(/*)S
(inode)210 2496 A
(for)126 2748 A
(root)168 2916 A
(dir)126 3126 A
3294(of)S
(mounted)294 3420 A
(file)168 3756 A
(sys)126 3966 A
4134(*/)S
4500 V
(20735)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*s_imount;)420 1656 A
2370(/*)S
(inode)210 2496 A
(mounted)294 2748 A
3084(on)S
3210(*/)S
4590 V
(20736)210 648 A
(unsigned)336 1110 A
(s_inodes_per_block;)798 1488 A
2370(/*)S
(precalculated)546 2496 A
(from)168 3084 A
(magic)210 3294 A
(number)252 3546 A
3840(*/)S
4680 V
(20737)210 648 A
(dev_t)210 1110 A
(s_dev;)252 1362 A
2370(/*)S
(whose)210 2496 A
(super)210 2748 A
(block)210 3000 A
3252(is)S
(this?)210 3378 A
3630(*/)S
4770 V
(20738)210 648 A
(int)126 1110 A
(s_rd_only;)420 1278 A
2370(/*)S
(set)126 2496 A
2664(to)S
2790(1)S
(iff)126 2874 A
(file)168 3042 A
(sys)126 3252 A
(mounted)294 3420 A
(read)168 3756 A
(only)168 3966 A
4176(*/)S
4860 V
(20739)210 648 A
(int)126 1110 A
(s_native;)378 1278 A
2370(/*)S
(set)126 2496 A
2664(to)S
2790(1)S
(iff)126 2874 A
(not)126 3042 A
(byte)168 3210 A
(swapped)294 3420 A
(file)168 3756 A
(system)252 3966 A
4260(*/)S
4950 V
(20740)210 648 A
(int)126 1110 A
(s_version;)420 1278 A
2370(/*)S
(file)168 2496 A
(system)252 2706 A
(version,)336 3000 A
(zero)168 3378 A
(means)210 3588 A
(bad)126 3840 A
(magic)210 4008 A
4260(*/)S
5040 V
(20741)210 648 A
(int)126 1110 A
(s_ndzones;)420 1278 A
2370(/*)S
2496(#)S
(direct)252 2580 A
(zones)210 2874 A
3126(in)S
3252(an)S
(inode)210 3378 A
3630(*/)S
5130 V
(20742)210 648 A
(int)126 1110 A
(s_nindirs;)420 1278 A
2370(/*)S
2496(#)S
(indirect)336 2580 A
(zones)210 2958 A
(per)126 3210 A
(indirect)336 3378 A
(block)210 3756 A
4008(*/)S
5220 V
(20743)210 648 A
(bit_t)210 1110 A
(s_isearch;)420 1362 A
2370(/*)S
(inodes)252 2496 A
(below)210 2790 A
(this)168 3042 A
(bit)126 3252 A
(number)252 3420 A
(are)126 3714 A
3882(in)S
(use)126 4008 A
4176(*/)S
5310 V
(20744)210 648 A
(bit_t)210 1110 A
(s_zsearch;)420 1362 A
2370(/*)S
(all)126 2496 A
(zones)210 2664 A
(below)210 2916 A
(this)168 3168 A
(bit)126 3378 A
(number)252 3546 A
(are)126 3840 A
4008(in)S
(use*/)210 4134 A
5400 V
(20745)210 648 A
1026(})S
(super_block[NR_SUPERS];)966 1110 A
5490 V
(20746)210 648 A
5580 V
(20747)210 648 A
(#define)294 1026 A
(NIL_SUPER)378 1362 A
(\(struct)294 1782 A
(super_block)462 2118 A
2622(*\))S
2748(0)S
5670 V
(20748)210 648 A
(#define)294 1026 A
(IMAP)168 1362 A
2034(0)S
2370(/*)S
(operating)378 2496 A
2916(on)S
(the)126 3042 A
(inode)210 3210 A
(bit)126 3462 A
(map)126 3630 A
3798(*/)S
5760 V
(20749)210 648 A
(#define)294 1026 A
(ZMAP)168 1362 A
2034(1)S
2370(/*)S
(operating)378 2496 A
2916(on)S
(the)126 3042 A
(zone)168 3210 A
(bit)126 3420 A
(map)126 3588 A
3756(*/)S
8418 V
EP
%%Page: 281 281
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2138(File:)S
2371(src/fs/table.c)S
12 B
(281)180 4248 A
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/fs/table.c)588 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(20800)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(table)210 2118 A
(used)168 2370 A
2580(to)S
(map)126 2706 A
(system)252 2874 A
(call)168 3168 A
(numbers)294 3378 A
(onto)168 3714 A
(the)126 3924 A
1440 V
(20801)210 648 A
1068(*)S
(routines)336 1152 A
(that)168 1530 A
(perform)294 1740 A
(them.)210 2076 A
1530 V
(20802)210 648 A
1068(*/)S
1620 V
(20803)210 648 A
1710 V
(20804)210 648 A
(#define)294 1026 A
(_TABLE)252 1362 A
1800 V
(20805)210 648 A
1890 V
(20806)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
1980 V
(20807)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
2070 V
(20808)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
2160 V
(20809)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
2250 V
(20810)210 648 A
(#include)336 1026 A
("dev.h")294 1404 A
2340 V
(20811)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
2430 V
(20812)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
2520 V
(20813)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
2610 V
(20814)210 648 A
(#include)336 1026 A
("lock.h")336 1404 A
2700 V
(20815)210 648 A
(#include)336 1026 A
("super.h")378 1404 A
2790 V
(20816)210 648 A
2880 V
(20817)210 648 A
(PUBLIC)252 1026 A
(_PROTOTYPE)420 1320 A
(\(int)168 1782 A
(\(*call_vector[NCALLS]\),)966 1992 A
(\(void\))252 3000 A
3294(\))S
3378(=)S
3462({)S
2970 V
(20818)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2202(0)S
2286(=)S
(unused)252 2370 A
2706(*/)S
3060 V
(20819)210 648 A
(do_exit,)336 1362 A
2034(/*)S
2202(1)S
2286(=)S
(exit)168 2370 A
2706(*/)S
3150 V
(20820)210 648 A
(do_fork,)336 1362 A
2034(/*)S
2202(2)S
2286(=)S
(fork)168 2370 A
2706(*/)S
3240 V
(20821)210 648 A
(do_read,)336 1362 A
2034(/*)S
2202(3)S
2286(=)S
(read)168 2370 A
2706(*/)S
3330 V
(20822)210 648 A
(do_write,)378 1362 A
2034(/*)S
2202(4)S
2286(=)S
(write)210 2370 A
2706(*/)S
3420 V
(20823)210 648 A
(do_open,)336 1362 A
2034(/*)S
2202(5)S
2286(=)S
(open)168 2370 A
2706(*/)S
3510 V
(20824)210 648 A
(do_close,)378 1362 A
2034(/*)S
2202(6)S
2286(=)S
(close)210 2370 A
2706(*/)S
3600 V
(20825)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2202(7)S
2286(=)S
(wait)168 2370 A
2706(*/)S
3690 V
(20826)210 648 A
(do_creat,)378 1362 A
2034(/*)S
2202(8)S
2286(=)S
(creat)210 2370 A
2706(*/)S
3780 V
(20827)210 648 A
(do_link,)336 1362 A
2034(/*)S
2202(9)S
2286(=)S
(link)168 2370 A
2706(*/)S
3870 V
(20828)210 648 A
(do_unlink,)420 1362 A
2034(/*)S
2160(10)S
2286(=)S
(unlink)252 2370 A
2706(*/)S
3960 V
(20829)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(11)S
2286(=)S
(waitpid)294 2370 A
2706(*/)S
4050 V
(20830)210 648 A
(do_chdir,)378 1362 A
2034(/*)S
2160(12)S
2286(=)S
(chdir)210 2370 A
2706(*/)S
4140 V
(20831)210 648 A
(do_time,)336 1362 A
2034(/*)S
2160(13)S
2286(=)S
(time)168 2370 A
2706(*/)S
4230 V
(20832)210 648 A
(do_mknod,)378 1362 A
2034(/*)S
2160(14)S
2286(=)S
(mknod)210 2370 A
2706(*/)S
4320 V
(20833)210 648 A
(do_chmod,)378 1362 A
2034(/*)S
2160(15)S
2286(=)S
(chmod)210 2370 A
2706(*/)S
4410 V
(20834)210 648 A
(do_chown,)378 1362 A
2034(/*)S
2160(16)S
2286(=)S
(chown)210 2370 A
2706(*/)S
4500 V
(20835)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(17)S
2286(=)S
(break)210 2370 A
2706(*/)S
4590 V
(20836)210 648 A
(do_stat,)336 1362 A
2034(/*)S
2160(18)S
2286(=)S
(stat)168 2370 A
2706(*/)S
4680 V
(20837)210 648 A
(do_lseek,)378 1362 A
2034(/*)S
2160(19)S
2286(=)S
(lseek)210 2370 A
2706(*/)S
4770 V
(20838)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(20)S
2286(=)S
(getpid)252 2370 A
2706(*/)S
4860 V
(20839)210 648 A
(do_mount,)378 1362 A
2034(/*)S
2160(21)S
2286(=)S
(mount)210 2370 A
2706(*/)S
4950 V
(20840)210 648 A
(do_umount,)420 1362 A
2034(/*)S
2160(22)S
2286(=)S
(umount)252 2370 A
2706(*/)S
5040 V
(20841)210 648 A
(do_set,)294 1362 A
2034(/*)S
2160(23)S
2286(=)S
(setuid)252 2370 A
2706(*/)S
5130 V
(20842)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(24)S
2286(=)S
(getuid)252 2370 A
2706(*/)S
5220 V
(20843)210 648 A
(do_stime,)378 1362 A
2034(/*)S
2160(25)S
2286(=)S
(stime)210 2370 A
2706(*/)S
5310 V
(20844)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(26)S
2286(=)S
(ptrace)252 2370 A
2706(*/)S
5400 V
(20845)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(27)S
2286(=)S
(alarm)210 2370 A
2706(*/)S
5490 V
(20846)210 648 A
(do_fstat,)378 1362 A
2034(/*)S
2160(28)S
2286(=)S
(fstat)210 2370 A
2706(*/)S
5580 V
(20847)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(29)S
2286(=)S
(pause)210 2370 A
2706(*/)S
5670 V
(20848)210 648 A
(do_utime,)378 1362 A
2034(/*)S
2160(30)S
2286(=)S
(utime)210 2370 A
2706(*/)S
5760 V
(20849)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(31)S
2286(=)S
(\(stty\))252 2370 A
2706(*/)S
5850 V
(20850)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(32)S
2286(=)S
(\(gtty\))252 2370 A
2706(*/)S
5940 V
(20851)210 648 A
(do_access,)420 1362 A
2034(/*)S
2160(33)S
2286(=)S
(access)252 2370 A
2706(*/)S
6030 V
(20852)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(34)S
2286(=)S
(\(nice\))252 2370 A
2706(*/)S
6120 V
(20853)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(35)S
2286(=)S
(\(ftime\))294 2370 A
2706(*/)S
6210 V
(20854)210 648 A
(do_sync,)336 1362 A
2034(/*)S
2160(36)S
2286(=)S
(sync)168 2370 A
2706(*/)S
8418 V
EP
%%Page: 282 282
BP
/slant 0 def
/height 0 def
630 V
12 B
(282)180 648 A
11 R
2138(File:)S
2371(src/fs/table.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(20855)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(37)S
2286(=)S
(kill)168 2370 A
2706(*/)S
990 V
(20856)210 648 A
(do_rename,)420 1362 A
2034(/*)S
2160(38)S
2286(=)S
(rename)252 2370 A
2706(*/)S
1080 V
(20857)210 648 A
(do_mkdir,)378 1362 A
2034(/*)S
2160(39)S
2286(=)S
(mkdir)210 2370 A
2706(*/)S
1170 V
(20858)210 648 A
(do_unlink,)420 1362 A
2034(/*)S
2160(40)S
2286(=)S
(rmdir)210 2370 A
2706(*/)S
1260 V
(20859)210 648 A
(do_dup,)294 1362 A
2034(/*)S
2160(41)S
2286(=)S
(dup)126 2370 A
2706(*/)S
1350 V
(20860)210 648 A
(do_pipe,)336 1362 A
2034(/*)S
2160(42)S
2286(=)S
(pipe)168 2370 A
2706(*/)S
1440 V
(20861)210 648 A
(do_tims,)336 1362 A
2034(/*)S
2160(43)S
2286(=)S
(times)210 2370 A
2706(*/)S
1530 V
(20862)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(44)S
2286(=)S
(\(prof\))252 2370 A
2706(*/)S
1620 V
(20863)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(45)S
2286(=)S
(unused)252 2370 A
2706(*/)S
1710 V
(20864)210 648 A
(do_set,)294 1362 A
2034(/*)S
2160(46)S
2286(=)S
(setgid)252 2370 A
2706(*/)S
1800 V
(20865)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(47)S
2286(=)S
(getgid)252 2370 A
2706(*/)S
1890 V
(20866)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(48)S
2286(=)S
(\(signal\)*/)420 2370 A
1980 V
(20867)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(49)S
2286(=)S
(unused)252 2370 A
2706(*/)S
2070 V
(20868)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(50)S
2286(=)S
(unused)252 2370 A
2706(*/)S
2160 V
(20869)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(51)S
2286(=)S
(\(acct\))252 2370 A
2706(*/)S
2250 V
(20870)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(52)S
2286(=)S
(\(phys\))252 2370 A
2706(*/)S
2340 V
(20871)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(53)S
2286(=)S
(\(lock\))252 2370 A
2706(*/)S
2430 V
(20872)210 648 A
(do_ioctl,)378 1362 A
2034(/*)S
2160(54)S
2286(=)S
(ioctl)210 2370 A
2706(*/)S
2520 V
(20873)210 648 A
(do_fcntl,)378 1362 A
2034(/*)S
2160(55)S
2286(=)S
(fcntl)210 2370 A
2706(*/)S
2610 V
(20874)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(56)S
2286(=)S
(\(mpx\))210 2370 A
2706(*/)S
2700 V
(20875)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(57)S
2286(=)S
(unused)252 2370 A
2706(*/)S
2790 V
(20876)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(58)S
2286(=)S
(unused)252 2370 A
2706(*/)S
2880 V
(20877)210 648 A
(do_exec,)336 1362 A
2034(/*)S
2160(59)S
2286(=)S
(execve)252 2370 A
2706(*/)S
2970 V
(20878)210 648 A
(do_umask,)378 1362 A
2034(/*)S
2160(60)S
2286(=)S
(umask)210 2370 A
2706(*/)S
3060 V
(20879)210 648 A
(do_chroot,)420 1362 A
2034(/*)S
2160(61)S
2286(=)S
(chroot)252 2370 A
2706(*/)S
3150 V
(20880)210 648 A
(do_setsid,)420 1362 A
2034(/*)S
2160(62)S
2286(=)S
(setsid)252 2370 A
2706(*/)S
3240 V
(20881)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(63)S
2286(=)S
(getpgrp)294 2370 A
2706(*/)S
3330 V
(20882)210 648 A
3420 V
(20883)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(64)S
2286(=)S
(KSIG:)210 2370 A
(signals)294 2622 A
(originating)462 2958 A
3462(in)S
(the)126 3588 A
(kernel)252 3756 A
4050(*/)S
3510 V
(20884)210 648 A
(do_unpause,)462 1362 A
2034(/*)S
2160(65)S
2286(=)S
(UNPAUSE)294 2370 A
2706(*/)S
3600 V
(20885)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(66)S
2286(=)S
(unused)252 2370 A
2706(*/)S
3690 V
(20886)210 648 A
(do_revive,)420 1362 A
2034(/*)S
2160(67)S
2286(=)S
(REVIVE)252 2370 A
2706(*/)S
3780 V
(20887)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(68)S
2286(=)S
(TASK_REPLY)420 2370 A
3042(*/)S
3870 V
(20888)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(69)S
2286(=)S
(unused)252 2370 A
2664(*/)S
3960 V
(20889)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(70)S
2286(=)S
(unused)252 2370 A
2664(*/)S
4050 V
(20890)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(71)S
2286(=)S
(SIGACTION)378 2370 A
2790(*/)S
4140 V
(20891)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(72)S
2286(=)S
(SIGSUSPEND)420 2370 A
2832(*/)S
4230 V
(20892)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(73)S
2286(=)S
(SIGPENDING)420 2370 A
2832(*/)S
4320 V
(20893)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(74)S
2286(=)S
(SIGPROCMASK)462 2370 A
2874(*/)S
4410 V
(20894)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(75)S
2286(=)S
(SIGRETURN)378 2370 A
2790(*/)S
4500 V
(20895)210 648 A
(no_sys,)294 1362 A
2034(/*)S
2160(76)S
2286(=)S
(REBOOT)252 2370 A
2664(*/)S
4590 V
(20896)210 648 A
1026(};)S
4680 V
(20897)210 648 A
4770 V
(20898)210 648 A
4860 V
(20899)210 648 A
1026(/*)S
(Some)168 1152 A
(devices)294 1362 A
(may)126 1698 A
1866(or)S
(may)126 1992 A
(not)126 2160 A
2328(be)S
(there)210 2454 A
2706(in)S
(the)126 2832 A
(next)168 3000 A
(table.)252 3210 A
3504(*/)S
4950 V
(20900)210 648 A
(#define)294 1026 A
(DT\(enable,)420 1362 A
(open,)210 1824 A
(rw,)126 2076 A
(close,)252 2244 A
(task\))210 2538 A
2790(\\)S
5040 V
(20901)210 648 A
1362({)S
(\(enable)294 1446 A
1782(?)S
(\(open\))252 1866 A
2160(:)S
(no_dev\),)336 2244 A
(\(enable)294 2622 A
2958(?)S
(\(rw\))168 3042 A
3252(:)S
(no_dev\),)336 3336 A
3714(\\)S
5130 V
(20902)210 648 A
(\(enable)294 1446 A
1782(?)S
(\(close\))294 1866 A
2202(:)S
(no_dev\),)336 2286 A
(\(enable)294 2664 A
3000(?)S
(\(task\))252 3084 A
3378(:)S
3462(0\))S
3588(},)S
5220 V
(20903)210 648 A
5310 V
(20904)210 648 A
1026(/*)S
(The)126 1152 A
(order)210 1320 A
1572(of)S
(the)126 1698 A
(entries)294 1866 A
(here)168 2202 A
(determines)420 2412 A
(the)126 2874 A
(mapping)294 3042 A
(between)294 3378 A
(major)210 3714 A
(device)252 3966 A
5400 V
(20905)210 648 A
1068(*)S
(numbers)294 1152 A
(and)126 1488 A
(tasks.)252 1656 A
(The)126 1992 A
(first)210 2160 A
(entry)210 2412 A
(\(major)252 2664 A
(device)252 2958 A
3252(0\))S
3378(is)S
(not)126 3504 A
(used.)210 3672 A
(The)126 3966 A
5490 V
(20906)210 648 A
1068(*)S
(next)168 1152 A
(entry)210 1362 A
1614(is)S
(major)210 1740 A
(device)252 1992 A
2286(1,)S
(etc.)168 2412 A
(Character)378 2664 A
(and)126 3084 A
(block)210 3252 A
(devices)294 3504 A
(can)126 3840 A
4008(be)S
5580 V
(20907)210 648 A
1068(*)S
(intermixed)420 1152 A
1614(at)S
(random.)294 1740 A
2118(If)S
(this)168 2244 A
(ordering)336 2454 A
2832(is)S
(changed,)336 2958 A
(the)126 3336 A
(devices)294 3504 A
3840(in)S
5670 V
(20908)210 648 A
1068(*)S
(<include/minix/boot.h>)924 1152 A
(must)168 2118 A
2328(be)S
(changed)294 2454 A
2790(to)S
(correspond)420 2916 A
3378(to)S
(the)126 3504 A
(new)126 3672 A
(values.)294 3840 A
5760 V
(20909)210 648 A
1068(*)S
(Note)168 1152 A
(that)168 1362 A
(the)126 1572 A
(major)210 1740 A
(device)252 1992 A
(numbers)294 2286 A
(used)168 2622 A
2832(in)S
(/dev)168 2958 A
(are)126 3168 A
(NOT)126 3336 A
(the)126 3504 A
(same)168 3672 A
3882(as)S
(the)126 4008 A
5850 V
(20910)210 648 A
1068(*)S
(task)168 1152 A
(numbers)294 1362 A
(used)168 1698 A
(inside)252 1908 A
(the)126 2202 A
(kernel)252 2370 A
(\(as)126 2664 A
(defined)294 2832 A
3168(in)S
(<include/minix/com.h>\).)966 3294 A
5940 V
(20911)210 648 A
1068(*)S
(Also)168 1152 A
(note)168 1362 A
(that)168 1572 A
1782(if)S
(/dev/mem)336 1908 A
2286(is)S
(changed)294 2412 A
(from)168 2748 A
2958(1,)S
(NULL_MAJOR)420 3084 A
(must)168 3546 A
3756(be)S
(changed)294 3882 A
6030 V
(20912)210 648 A
1068(*)S
1152(in)S
(<include/minix/com.h>.)924 1278 A
6120 V
(20913)210 648 A
1068(*/)S
6210 V
(20914)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(dmap)168 1614 A
(dmap[])252 1824 A
2118(=)S
2202({)S
8418 V
EP
%%Page: 283 283
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2138(File:)S
2371(src/fs/table.c)S
12 B
(283)180 4248 A
900 V
7 LST
(20915)210 648 A
1026(/*)S
1194(?)S
(Open)168 1362 A
(Read/Write)420 1824 A
(Close)210 2370 A
(Task)168 2874 A
3084(#)S
(Device)252 3378 A
(File)168 3714 A
990 V
(20916)210 648 A
1194(-)S
(----)168 1362 A
(----------)420 1824 A
(-----)210 2370 A
(-------)294 2874 A
(------)252 3378 A
(----)168 3714 A
4176(*/)S
1080 V
(20917)210 648 A
(DT\(1,)210 1110 A
(no_dev,)294 1362 A
(no_dev,)294 1824 A
(no_dev,)294 2370 A
2874(0\))S
3420(/*)S
3546(0)S
3630(=)S
(not)126 3714 A
(used)168 3882 A
4176(*/)S
1170 V
(20918)210 648 A
(DT\(1,)210 1110 A
(dev_opcl,)378 1362 A
(call_task,)420 1824 A
(dev_opcl,)378 2370 A
(MEM\))168 2874 A
3420(/*)S
3546(1)S
3630(=)S
(/dev/mem)336 3714 A
4176(*/)S
1260 V
(20919)210 648 A
(DT\(1,)210 1110 A
(dev_opcl,)378 1362 A
(call_task,)420 1824 A
(dev_opcl,)378 2370 A
(FLOPPY\))294 2874 A
3420(/*)S
3546(2)S
3630(=)S
(/dev/fd0)336 3714 A
4176(*/)S
1350 V
(20920)210 648 A
(DT\(ENABLE_WINI,)630 1110 A
1440 V
(20921)210 648 A
(dev_opcl,)378 1362 A
(call_task,)420 1824 A
(dev_opcl,)378 2370 A
(WINCHESTER\))462 2874 A
3420(/*)S
3546(3)S
3630(=)S
(/dev/hd0)336 3714 A
4176(*/)S
1530 V
(20922)210 648 A
(DT\(1,)210 1110 A
(tty_open,)378 1362 A
(call_task,)420 1824 A
(dev_opcl,)378 2370 A
(TTY\))168 2874 A
3420(/*)S
3546(4)S
3630(=)S
(/dev/tty00)420 3714 A
4176(*/)S
1620 V
(20923)210 648 A
(DT\(1,)210 1110 A
(ctty_open,)420 1362 A
(call_ctty,)420 1824 A
(ctty_close,)462 2370 A
(TTY\))168 2874 A
3420(/*)S
3546(5)S
3630(=)S
(/dev/tty)336 3714 A
4176(*/)S
1710 V
(20924)210 648 A
(DT\(1,)210 1110 A
(dev_opcl,)378 1362 A
(call_task,)420 1824 A
(dev_opcl,)378 2370 A
(PRINTER\))336 2916 A
3462(/*)S
3588(6)S
3672(=)S
(/dev/lp)294 3756 A
4218(*/)S
1800 V
(20925)210 648 A
1890 V
(20926)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(IBM_PC\))294 1698 A
1980 V
(20927)210 648 A
(DT\(ENABLE_NETWORKING,)882 1110 A
2070 V
(20928)210 648 A
(net_open,)378 1362 A
(call_task,)420 1824 A
(dev_opcl,)378 2370 A
(INET_PROC_NR\)/*)630 2874 A
3546(7)S
3630(=)S
(/dev/ip)294 3714 A
4176(*/)S
2160 V
(20929)210 648 A
(DT\(ENABLE_CDROM,)672 1110 A
2250 V
(20930)210 648 A
(dev_opcl,)378 1362 A
(call_task,)420 1824 A
(dev_opcl,)378 2370 A
(CDROM\))252 2874 A
3420(/*)S
3546(8)S
3630(=)S
(/dev/cd0)336 3714 A
4176(*/)S
2340 V
(20931)210 648 A
(DT\(0,)210 1110 A
1362(0,)S
1824(0,)S
2370(0,)S
2874(0\))S
3420(/*)S
3546(9)S
3630(=)S
(not)126 3714 A
(used)168 3882 A
4176(*/)S
2430 V
(20932)210 648 A
(DT\(ENABLE_SCSI,)630 1110 A
2520 V
(20933)210 648 A
(dev_opcl,)378 1362 A
(call_task,)420 1824 A
(dev_opcl,)378 2370 A
(SCSI\))210 2874 A
(/*10)168 3420 A
3630(=)S
(/dev/sd0)336 3714 A
4176(*/)S
2610 V
(20934)210 648 A
(DT\(0,)210 1110 A
1362(0,)S
1824(0,)S
2370(0,)S
2874(0\))S
(/*11)168 3420 A
3630(=)S
(not)126 3714 A
(used)168 3882 A
4176(*/)S
2700 V
(20935)210 648 A
(DT\(0,)210 1110 A
1362(0,)S
1824(0,)S
2370(0,)S
2874(0\))S
(/*12)168 3420 A
3630(=)S
(not)126 3714 A
(used)168 3882 A
4176(*/)S
2790 V
(20936)210 648 A
(DT\(ENABLE_AUDIO,)672 1110 A
2880 V
(20937)210 648 A
(dev_opcl,)378 1362 A
(call_task,)420 1824 A
(dev_opcl,)378 2370 A
(AUDIO\))252 2874 A
(/*13)168 3420 A
3630(=)S
(/dev/audio)420 3714 A
4176(*/)S
2970 V
(20938)210 648 A
(DT\(ENABLE_AUDIO,)672 1110 A
3060 V
(20939)210 648 A
(dev_opcl,)378 1362 A
(call_task,)420 1824 A
(dev_opcl,)378 2370 A
(MIXER\))252 2874 A
(/*14)168 3420 A
3630(=)S
(/dev/mixer)420 3714 A
4176(*/)S
3150 V
(20940)210 648 A
(#endif)252 1026 A
1320(/*)S
(IBM_PC)252 1446 A
1740(*/)S
3240 V
(20941)210 648 A
3330 V
(20942)210 648 A
(#if)126 1026 A
(\(MACHINE)336 1194 A
1572(==)S
(ATARI\))252 1698 A
3420 V
(20943)210 648 A
(DT\(ENABLE_SCSI,)630 1110 A
3510 V
(20944)210 648 A
(dev_opcl,)378 1362 A
(call_task,)420 1824 A
(dev_opcl,)378 2370 A
(SCSI\))210 2874 A
3420(/*)S
3546(7)S
3630(=)S
(/dev/hdscsi0)504 3714 A
4260(*/)S
3600 V
(20945)210 648 A
(#endif)252 1026 A
3690 V
(20946)210 648 A
1026(};)S
3780 V
(20947)210 648 A
3870 V
(20948)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(max_major)378 1488 A
1908(=)S
(sizeof\(dmap\)/sizeof\(struct)1092 1992 A
(dmap\);)252 3126 A
4140 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4230 V
(src/fs/cache.c)588 2034 A
4320 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4500 V
(21000)210 648 A
1026(/*)S
(The)126 1152 A
(file)168 1320 A
(system)252 1530 A
(maintains)378 1824 A
2244(a)S
(buffer)252 2328 A
(cache)210 2622 A
2874(to)S
(reduce)252 3000 A
(the)126 3294 A
(number)252 3462 A
3756(of)S
(disk)168 3882 A
4590 V
(21001)210 648 A
1068(*)S
(accesses)336 1152 A
(needed.)294 1530 A
(Whenever)336 1908 A
2286(a)S
(read)168 2370 A
2580(or)S
(write)210 2706 A
2958(to)S
(the)126 3084 A
(disk)168 3252 A
3462(is)S
(done,)210 3588 A
3840(a)S
(check)210 3924 A
4176(is)S
4680 V
(21002)210 648 A
1068(*)S
(first)210 1152 A
(made)168 1404 A
1614(to)S
(see)126 1740 A
1908(if)S
(the)126 2034 A
(block)210 2202 A
2454(is)S
2580(in)S
(the)126 2706 A
(cache.)252 2874 A
(This)168 3210 A
(file)168 3420 A
(manages)294 3630 A
(the)126 3966 A
4770 V
(21003)210 648 A
1068(*)S
(cache.)252 1152 A
4860 V
(21004)210 648 A
1068(*)S
4950 V
(21005)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are:)168 2496 A
5040 V
(21006)210 648 A
1068(*)S
(get_block:)420 1236 A
(request)294 1782 A
2118(to)S
(fetch)210 2244 A
2496(a)S
(block)210 2580 A
(for)126 2832 A
(reading)294 3000 A
3336(or)S
(writing)294 3462 A
(from)168 3798 A
(cache)210 4008 A
5130 V
(21007)210 648 A
1068(*)S
(put_block:)420 1236 A
(return)252 1782 A
2076(a)S
(block)210 2160 A
(previously)420 2412 A
(requested)378 2874 A
(with)168 3294 A
(get_block)378 3504 A
5220 V
(21008)210 648 A
1068(*)S
(alloc_zone:)462 1236 A
(allocate)336 1782 A
2160(a)S
(new)126 2244 A
(zone)168 2412 A
(\(to)126 2622 A
(increase)336 2790 A
(the)126 3168 A
(length)252 3336 A
3630(of)S
3756(a)S
(file\))210 3840 A
5310 V
(21009)210 648 A
1068(*)S
(free_zone:)420 1236 A
(release)294 1782 A
2118(a)S
(zone)168 2202 A
(\(when)210 2412 A
2664(a)S
(file)168 2748 A
2958(is)S
(removed\))336 3084 A
5400 V
(21010)210 648 A
1068(*)S
(rw_block:)378 1236 A
(read)168 1782 A
1992(or)S
(write)210 2118 A
2370(a)S
(block)210 2454 A
(from)168 2706 A
(the)126 2916 A
(disk)168 3084 A
(itself)252 3294 A
5490 V
(21011)210 648 A
1068(*)S
(invalidate:)462 1236 A
(remove)252 1782 A
(all)126 2076 A
(the)126 2244 A
(cache)210 2412 A
(blocks)252 2664 A
2958(on)S
(some)168 3084 A
(device)252 3294 A
5580 V
(21012)210 648 A
1068(*/)S
5670 V
(21013)210 648 A
5760 V
(21014)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
5850 V
(21015)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
5940 V
(21016)210 648 A
(#include)336 1026 A
(<minix/boot.h>)588 1404 A
6030 V
(21017)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
6120 V
(21018)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
6210 V
(21019)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
8418 V
EP
%%Page: 284 284
BP
/slant 0 def
/height 0 def
630 V
12 B
(284)180 648 A
11 R
2119(File:)S
(src/fs/cache.c)605 2352 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(21020)210 648 A
(#include)336 1026 A
("super.h")378 1404 A
990 V
(21021)210 648 A
1080 V
(21022)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(rm_lru,)294 2076 A
(\(struct)294 2412 A
(buf)126 2748 A
(*bp\))168 2916 A
3126(\);)S
1170 V
(21023)210 648 A
1260 V
(21024)210 648 A
(/*===========================================================================*)3276 1026 A
1350 V
(21025)210 648 A
1068(*)S
(get_block)378 2370 A
4260(*)S
1440 V
(21026)210 648 A
(*===========================================================================*/)3276 1068 A
1530 V
(21027)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(buf)126 1614 A
(*get_block\(dev,)630 1782 A
(block,)252 2454 A
(only_search\))504 2748 A
1620 V
(21028)210 648 A
(register)336 1026 A
(dev_t)210 1404 A
(dev;)168 1656 A
2370(/*)S
2496(on)S
(which)210 2622 A
(device)252 2874 A
3168(is)S
(the)126 3294 A
(block?)252 3462 A
3756(*/)S
1710 V
(21029)210 648 A
(register)336 1026 A
(block_t)294 1404 A
(block;)252 1740 A
2370(/*)S
(which)210 2496 A
(block)210 2748 A
3000(is)S
(wanted?)294 3126 A
3462(*/)S
1800 V
(21030)210 648 A
(int)126 1026 A
(only_search;)504 1194 A
2370(/*)S
2496(if)S
(NO_READ,)336 2622 A
(don't)210 3000 A
(read,)210 3252 A
(else)168 3504 A
(act)126 3714 A
(normal)252 3882 A
4176(*/)S
1890 V
(21031)210 648 A
1026({)S
1980 V
(21032)210 648 A
1026(/*)S
(Check)210 1152 A
1404(to)S
(see)126 1530 A
1698(if)S
(the)126 1824 A
(requested)378 1992 A
(block)210 2412 A
2664(is)S
2790(in)S
(the)126 2916 A
(block)210 3084 A
(cache.)252 3336 A
3672(If)S
(so,)126 3798 A
(return)252 3966 A
2070 V
(21033)210 648 A
1068(*)S
1152(a)S
(pointer)294 1236 A
1572(to)S
(it.)126 1698 A
1908(If)S
(not,)168 2034 A
(evict)210 2244 A
(some)168 2496 A
(other)210 2706 A
(block)210 2958 A
(and)126 3210 A
(fetch)210 3378 A
3630(it)S
(\(unless)294 3756 A
2160 V
(21034)210 648 A
1068(*)S
('only_search')546 1152 A
1740(is)S
(1\).)126 1866 A
(All)126 2076 A
(the)126 2244 A
(blocks)252 2412 A
2706(in)S
(the)126 2832 A
(cache)210 3000 A
(that)168 3252 A
(are)126 3462 A
(not)126 3630 A
3798(in)S
(use)126 3924 A
2250 V
(21035)210 648 A
1068(*)S
(are)126 1152 A
(linked)252 1320 A
(together)336 1614 A
1992(in)S
2118(a)S
(chain,)252 2202 A
(with)168 2496 A
('front')294 2706 A
(pointing)336 3042 A
3420(to)S
(the)126 3546 A
(least)210 3714 A
(recently)336 3966 A
2340 V
(21036)210 648 A
1068(*)S
(used)168 1152 A
(block)210 1362 A
(and)126 1614 A
('rear')252 1782 A
2076(to)S
(the)126 2202 A
(most)168 2370 A
(recently)336 2580 A
(used)168 2958 A
(block.)252 3168 A
3504(If)S
('only_search')546 3630 A
4218(is)S
2430 V
(21037)210 648 A
1068(*)S
1152(1,)S
(the)126 1278 A
(block)210 1446 A
(being)210 1698 A
(requested)378 1950 A
(will)168 2370 A
2580(be)S
(overwritten)462 2706 A
3210(in)S
(its)126 3336 A
(entirety,)378 3504 A
3924(so)S
4050(it)S
4176(is)S
2520 V
(21038)210 648 A
1068(*)S
(only)168 1152 A
(necessary)378 1362 A
1782(to)S
(see)126 1908 A
2076(if)S
2202(it)S
2328(is)S
2454(in)S
(the)126 2580 A
(cache;)252 2748 A
3042(if)S
3168(it)S
3294(is)S
(not,)168 3420 A
(any)126 3630 A
(free)168 3798 A
(buffer)252 4008 A
2610 V
(21039)210 648 A
1068(*)S
(will)168 1152 A
(do.)126 1362 A
1572(It)S
1698(is)S
(not)126 1824 A
(necessary)378 1992 A
2412(to)S
(actually)336 2538 A
(read)168 2916 A
(the)126 3126 A
(block)210 3294 A
3546(in)S
(from)168 3672 A
(disk.)210 3882 A
2700 V
(21040)210 648 A
1068(*)S
1152(If)S
('only_search')546 1278 A
1866(is)S
(PREFETCH,)378 1992 A
(the)126 2412 A
(block)210 2580 A
(need)168 2832 A
(not)126 3042 A
3210(be)S
(read)168 3336 A
(from)168 3546 A
(the)126 3756 A
(disk,)210 3924 A
2790 V
(21041)210 648 A
1068(*)S
(and)126 1152 A
(the)126 1320 A
(device)252 1488 A
1782(is)S
(not)126 1908 A
2076(to)S
2202(be)S
(marked)252 2328 A
2622(on)S
(the)126 2748 A
(block,)252 2916 A
3210(so)S
(callers)294 3336 A
(can)126 3672 A
(tell)168 3840 A
4050(if)S
2880 V
(21042)210 648 A
1068(*)S
(the)126 1152 A
(block)210 1320 A
(returned)336 1572 A
1950(is)S
(valid.)252 2076 A
2970 V
(21043)210 648 A
1068(*)S
1152(In)S
(addition)336 1278 A
1656(to)S
(the)126 1782 A
(LRU)126 1950 A
(chain,)252 2118 A
(there)210 2412 A
2664(is)S
(also)168 2790 A
3000(a)S
(hash)168 3084 A
(chain)210 3294 A
3546(to)S
(link)168 3672 A
(together)336 3882 A
3060 V
(21044)210 648 A
1068(*)S
(blocks)252 1152 A
(whose)210 1446 A
(block)210 1698 A
(numbers)294 1950 A
(end)126 2286 A
(with)168 2454 A
(the)126 2664 A
(same)168 2832 A
(bit)126 3042 A
(strings,)336 3210 A
(for)126 3588 A
(fast)168 3756 A
(lookup.)294 3966 A
3150 V
(21045)210 648 A
1068(*/)S
3240 V
(21046)210 648 A
3330 V
(21047)210 648 A
(int)126 1110 A
1278(b;)S
3420 V
(21048)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp,)168 1950 A
(*prev_ptr;)420 2160 A
3510 V
(21049)210 648 A
3600 V
(21050)210 648 A
1110(/*)S
(Search)252 1236 A
(the)126 1530 A
(hash)168 1698 A
(chain)210 1908 A
(for)126 2160 A
(\(dev,)210 2328 A
(block\).)294 2580 A
(Do_read\(\))378 2916 A
(can)126 3336 A
(use)126 3504 A
3690 V
(21051)210 648 A
1152(*)S
(get_block\(NO_DEV)672 1236 A
(...\))168 1950 A
2160(to)S
(get)126 2286 A
2454(an)S
(unnamed)294 2580 A
(block)210 2916 A
3168(to)S
(fill)168 3294 A
(with)168 3504 A
(zeros)210 3714 A
(when)168 3966 A
3780 V
(21052)210 648 A
1152(*)S
(someone)294 1236 A
(wants)210 1572 A
1824(to)S
(read)168 1950 A
(from)168 2160 A
2370(a)S
(hole)168 2454 A
2664(in)S
2790(a)S
(file,)210 2874 A
3126(in)S
(which)210 3252 A
(case)168 3504 A
(this)168 3714 A
(search)252 3924 A
3870 V
(21053)210 648 A
1152(*)S
1236(is)S
(skipped)294 1362 A
3960 V
(21054)210 648 A
1152(*/)S
4050 V
(21055)210 648 A
1110(if)S
(\(dev)168 1236 A
1446(!=)S
(NO_DEV\))294 1572 A
1908({)S
4140 V
(21056)210 648 A
1362(b)S
1446(=)S
(\(int\))210 1530 A
(block)210 1782 A
2034(&)S
(HASH_MASK;)420 2118 A
4230 V
(21057)210 648 A
1362(bp)S
1488(=)S
(buf_hash[b];)504 1572 A
4320 V
(21058)210 648 A
(while)210 1362 A
(\(bp)126 1614 A
1782(!=)S
(NIL_BUF\))336 1908 A
2286({)S
4410 V
(21059)210 648 A
1698(if)S
(\(bp->b_blocknr)588 1824 A
2454(==)S
(block)210 2580 A
2832(&&)S
(bp->b_dev)378 2958 A
3378(==)S
(dev\))168 3504 A
3714({)S
4500 V
(21060)210 648 A
2034(/*)S
(Block)210 2160 A
(needed)252 2412 A
(has)126 2706 A
(been)168 2874 A
(found.)252 3084 A
3378(*/)S
4590 V
(21061)210 648 A
2034(if)S
(\(bp->b_count)504 2160 A
2706(==)S
2832(0\))S
(rm_lru\(bp\);)462 2958 A
4680 V
(21062)210 648 A
(bp->b_count++;)588 2034 A
2706(/*)S
(record)252 2832 A
(that)168 3126 A
(block)210 3336 A
3588(is)S
3714(in)S
(use)126 3840 A
4008(*/)S
4770 V
(21063)210 648 A
(return\(bp\);)462 2034 A
4860 V
(21064)210 648 A
1698(})S
(else)168 1782 A
1992({)S
4950 V
(21065)210 648 A
2034(/*)S
(This)168 2160 A
(block)210 2370 A
2622(is)S
(not)126 2748 A
(the)126 2916 A
(one)126 3084 A
(sought.)294 3252 A
3588(*/)S
5040 V
(21066)210 648 A
2034(bp)S
2160(=)S
(bp->b_hash;)462 2244 A
2748(/*)S
(move)168 2874 A
3084(to)S
(next)168 3210 A
(block)210 3420 A
3672(on)S
(hash)168 3798 A
(chain)210 4008 A
4260(*/)S
5130 V
(21067)210 648 A
1698(})S
5220 V
(21068)210 648 A
1362(})S
5310 V
(21069)210 648 A
1110(})S
5400 V
(21070)210 648 A
5490 V
(21071)210 648 A
1110(/*)S
(Desired)294 1236 A
(block)210 1572 A
1824(is)S
(not)126 1950 A
2118(on)S
(available)378 2244 A
(chain.)252 2664 A
(Take)168 3000 A
(oldest)252 3210 A
(block)210 3504 A
(\('front'\).)420 3756 A
4218(*/)S
5580 V
(21072)210 648 A
1110(if)S
(\(\(bp)168 1236 A
1446(=)S
(front\))252 1530 A
1824(==)S
(NIL_BUF\))336 1950 A
(panic\("all)420 2328 A
(buffers)294 2790 A
3126(in)S
(use",)210 3252 A
(NR_BUFS\);)378 3504 A
5670 V
(21073)210 648 A
(rm_lru\(bp\);)462 1110 A
5760 V
(21074)210 648 A
5850 V
(21075)210 648 A
1110(/*)S
(Remove)252 1236 A
(the)126 1530 A
(block)210 1698 A
(that)168 1950 A
(was)126 2160 A
(just)168 2328 A
(taken)210 2538 A
(from)168 2790 A
(its)126 3000 A
(hash)168 3168 A
(chain.)252 3378 A
3672(*/)S
5940 V
(21076)210 648 A
1110(b)S
1194(=)S
(\(int\))210 1278 A
(bp->b_blocknr)546 1530 A
2118(&)S
(HASH_MASK;)420 2202 A
6030 V
(21077)210 648 A
(prev_ptr)336 1110 A
1488(=)S
(buf_hash[b];)504 1572 A
6120 V
(21078)210 648 A
1110(if)S
(\(prev_ptr)378 1236 A
1656(==)S
(bp\))126 1782 A
1950({)S
6210 V
(21079)210 648 A
(buf_hash[b])462 1362 A
1866(=)S
(bp->b_hash;)462 1950 A
8418 V
EP
%%Page: 285 285
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2119(File:)S
(src/fs/cache.c)605 2352 A
12 B
(285)180 4248 A
900 V
7 LST
(21080)210 648 A
1110(})S
(else)168 1194 A
1404({)S
990 V
(21081)210 648 A
1362(/*)S
(The)126 1488 A
(block)210 1656 A
(just)168 1908 A
(taken)210 2118 A
2370(is)S
(not)126 2496 A
2664(on)S
(the)126 2790 A
(front)210 2958 A
3210(of)S
(its)126 3336 A
(hash)168 3504 A
(chain.)252 3714 A
4008(*/)S
1080 V
(21082)210 648 A
(while)210 1362 A
(\(prev_ptr->b_hash)714 1614 A
2370(!=)S
(NIL_BUF\))336 2496 A
1170 V
(21083)210 648 A
1698(if)S
(\(prev_ptr->b_hash)714 1824 A
2580(==)S
(bp\))126 2706 A
2874({)S
1260 V
(21084)210 648 A
(prev_ptr->b_hash)672 2034 A
2748(=)S
(bp->b_hash;)462 2832 A
3378(/*)S
(found)210 3504 A
3756(it)S
3882(*/)S
1350 V
(21085)210 648 A
(break;)252 2034 A
1440 V
(21086)210 648 A
1698(})S
(else)168 1782 A
1992({)S
1530 V
(21087)210 648 A
(prev_ptr)336 2034 A
2412(=)S
(prev_ptr->b_hash;)714 2496 A
3378(/*)S
(keep)168 3504 A
(looking)294 3714 A
4050(*/)S
1620 V
(21088)210 648 A
1698(})S
1710 V
(21089)210 648 A
1110(})S
1800 V
(21090)210 648 A
1890 V
(21091)210 648 A
1110(/*)S
1236(If)S
(the)126 1362 A
(block)210 1530 A
(taken)210 1782 A
2034(is)S
(dirty,)252 2160 A
(make)168 2454 A
2664(it)S
(clean)210 2790 A
3042(by)S
(writing)294 3168 A
3504(it)S
3630(to)S
(the)126 3756 A
(disk.)210 3924 A
1980 V
(21092)210 648 A
1152(*)S
(Avoid)210 1236 A
(hysteresis)420 1488 A
1950(by)S
(flushing)336 2076 A
(all)126 2454 A
(other)210 2622 A
(dirty)210 2874 A
(blocks)252 3126 A
(for)126 3420 A
(the)126 3588 A
(same)168 3756 A
(device.)294 3966 A
2070 V
(21093)210 648 A
1152(*/)S
2160 V
(21094)210 648 A
1110(if)S
(\(bp->b_dev)420 1236 A
1698(!=)S
(NO_DEV\))294 1824 A
2160({)S
2250 V
(21095)210 648 A
1362(if)S
(\(bp->b_dirt)462 1488 A
1992(==)S
(DIRTY\))252 2118 A
(flushall\(bp->b_dev\);)840 2412 A
2340 V
(21096)210 648 A
1110(})S
2430 V
(21097)210 648 A
2520 V
(21098)210 648 A
1110(/*)S
(Fill)168 1236 A
1446(in)S
(block's)294 1572 A
(parameters)420 1908 A
(and)126 2370 A
(add)126 2538 A
2706(it)S
2832(to)S
(the)126 2958 A
(hash)168 3126 A
(chain)210 3336 A
(where)210 3588 A
3840(it)S
(goes.)210 3966 A
4218(*/)S
2610 V
(21099)210 648 A
(bp->b_dev)378 1110 A
1530(=)S
(dev;)168 1614 A
2370(/*)S
(fill)168 2496 A
2706(in)S
(device)252 2832 A
(number)252 3126 A
3420(*/)S
2700 V
(21100)210 648 A
(bp->b_blocknr)546 1110 A
1698(=)S
(block;)252 1782 A
2370(/*)S
(fill)168 2496 A
2706(in)S
(block)210 2832 A
(number)252 3084 A
3378(*/)S
2790 V
(21101)210 648 A
(bp->b_count++;)588 1110 A
2370(/*)S
(record)252 2496 A
(that)168 2790 A
(block)210 3000 A
3252(is)S
(being)210 3378 A
(used)168 3630 A
3840(*/)S
2880 V
(21102)210 648 A
1110(b)S
1194(=)S
(\(int\))210 1278 A
(bp->b_blocknr)546 1530 A
2118(&)S
(HASH_MASK;)420 2202 A
2970 V
(21103)210 648 A
(bp->b_hash)420 1110 A
1572(=)S
(buf_hash[b];)504 1656 A
3060 V
(21104)210 648 A
(buf_hash[b])462 1110 A
1614(=)S
(bp;)126 1698 A
2370(/*)S
(add)126 2496 A
2664(to)S
(hash)168 2790 A
(list)168 3000 A
3210(*/)S
3150 V
(21105)210 648 A
3240 V
(21106)210 648 A
1110(/*)S
1236(Go)S
(get)126 1362 A
(the)126 1530 A
(requested)378 1698 A
(block)210 2118 A
(unless)252 2370 A
(searching)378 2664 A
3084(or)S
(prefetching.)504 3210 A
3756(*/)S
3330 V
(21107)210 648 A
1110(if)S
(\(dev)168 1236 A
1446(!=)S
(NO_DEV\))294 1572 A
1908({)S
3420 V
(21108)210 648 A
1362(if)S
(\(only_search)504 1488 A
2034(==)S
(PREFETCH\))378 2160 A
(bp->b_dev)378 2580 A
3000(=)S
(NO_DEV;)294 3084 A
3510 V
(21109)210 648 A
(else)168 1362 A
3600 V
(21110)210 648 A
1362(if)S
(\(only_search)504 1488 A
2034(==)S
(NORMAL\))294 2160 A
(rw_block\(bp,)504 2496 A
(READING\);)378 3042 A
3690 V
(21111)210 648 A
1110(})S
3780 V
(21112)210 648 A
(return\(bp\);)462 1110 A
2370(/*)S
(return)252 2496 A
(the)126 2790 A
(newly)210 2958 A
(acquired)336 3210 A
(block)210 3588 A
3840(*/)S
3870 V
(21113)210 648 A
1026(})S
4140 V
(21116)210 648 A
(/*===========================================================================*)3276 1026 A
4230 V
(21117)210 648 A
1068(*)S
(put_block)378 2370 A
4260(*)S
4320 V
(21118)210 648 A
(*===========================================================================*/)3276 1068 A
4410 V
(21119)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(put_block\(bp,)546 1530 A
(block_type\))462 2118 A
4500 V
(21120)210 648 A
(register)336 1026 A
(struct)252 1404 A
(buf)126 1698 A
(*bp;)168 1866 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(the)126 2958 A
(buffer)252 3126 A
3420(to)S
3546(be)S
(released)336 3672 A
4050(*/)S
4590 V
(21121)210 648 A
(int)126 1026 A
(block_type;)462 1194 A
2370(/*)S
(INODE_BLOCK,)504 2496 A
(DIRECTORY_BLOCK,)672 3042 A
3756(or)S
(whatever)336 3882 A
4260(*/)S
4680 V
(21122)210 648 A
1026({)S
4770 V
(21123)210 648 A
1026(/*)S
(Return)252 1152 A
1446(a)S
(block)210 1530 A
1782(to)S
(the)126 1908 A
(list)168 2076 A
2286(of)S
(available)378 2412 A
(blocks.)294 2832 A
(Depending)378 3252 A
3672(on)S
('block_type')504 3798 A
4860 V
(21124)210 648 A
1068(*)S
1152(it)S
(may)126 1278 A
1446(be)S
(put)126 1572 A
1740(on)S
(the)126 1866 A
(front)210 2034 A
2286(or)S
(rear)168 2412 A
2622(of)S
(the)126 2748 A
(LRU)126 2916 A
(chain.)252 3084 A
(Blocks)252 3420 A
(that)168 3714 A
(are)126 3924 A
4950 V
(21125)210 648 A
1068(*)S
(expected)336 1152 A
1530(to)S
1656(be)S
(needed)252 1782 A
(again)210 2076 A
(shortly)294 2328 A
(\(e.g.,)252 2664 A
(partially)378 2958 A
(full)168 3378 A
(data)168 3588 A
(blocks\))294 3798 A
5040 V
(21126)210 648 A
1068(*)S
1152(go)S
1278(on)S
(the)126 1404 A
(rear;)210 1572 A
(blocks)252 1824 A
(that)168 2118 A
(are)126 2328 A
(unlikely)336 2496 A
2874(to)S
3000(be)S
(needed)252 3126 A
(again)210 3420 A
(shortly)294 3672 A
5130 V
(21127)210 648 A
1068(*)S
(\(e.g.,)252 1152 A
(full)168 1446 A
(data)168 1656 A
(blocks\))294 1866 A
2202(go)S
2328(on)S
(the)126 2454 A
(front.)252 2622 A
(Blocks)252 2958 A
(whose)210 3252 A
(loss)168 3504 A
(can)126 3714 A
(hurt)168 3882 A
5220 V
(21128)210 648 A
1068(*)S
(the)126 1152 A
(integrity)378 1320 A
1740(of)S
(the)126 1866 A
(file)168 2034 A
(system)252 2244 A
(\(e.g.,)252 2538 A
(inode)210 2832 A
(blocks\))294 3084 A
(are)126 3420 A
(written)294 3588 A
3924(to)S
5310 V
(21129)210 648 A
1068(*)S
(disk)168 1152 A
(immediately)462 1362 A
1866(if)S
(they)168 1992 A
(are)126 2202 A
(dirty.)252 2370 A
5400 V
(21130)210 648 A
1068(*/)S
5490 V
(21131)210 648 A
5580 V
(21132)210 648 A
1110(if)S
(\(bp)126 1236 A
1404(==)S
(NIL_BUF\))336 1530 A
(return;)294 1908 A
2370(/*)S
2496(it)S
2622(is)S
(easier)252 2748 A
3042(to)S
(check)210 3168 A
(here)168 3420 A
(than)168 3630 A
3840(in)S
(caller)252 3966 A
4260(*/)S
5670 V
(21133)210 648 A
5760 V
(21134)210 648 A
(bp->b_count--;)588 1110 A
2370(/*)S
(there)210 2496 A
2748(is)S
(one)126 2874 A
(use)126 3042 A
(fewer)210 3210 A
(now)126 3462 A
3630(*/)S
5850 V
(21135)210 648 A
1110(if)S
(\(bp->b_count)504 1236 A
1782(!=)S
1908(0\))S
(return;)294 2034 A
2370(/*)S
(block)210 2496 A
2748(is)S
(still)210 2874 A
3126(in)S
(use)126 3252 A
3420(*/)S
5940 V
(21136)210 648 A
6030 V
(21137)210 648 A
(bufs_in_use--;)588 1110 A
2370(/*)S
(one)126 2496 A
(fewer)210 2664 A
(block)210 2916 A
(buffers)294 3168 A
3504(in)S
(use)126 3630 A
3798(*/)S
6120 V
(21138)210 648 A
6210 V
(21139)210 648 A
1110(/*)S
(Put)126 1236 A
(this)168 1404 A
(block)210 1614 A
(back)168 1866 A
2076(on)S
(the)126 2202 A
(LRU)126 2370 A
(chain.)252 2538 A
2874(If)S
(the)126 3000 A
(ONE_SHOT)336 3168 A
(bit)126 3546 A
3714(is)S
(set)126 3840 A
4008(in)S
8418 V
EP
%%Page: 286 286
BP
/slant 0 def
/height 0 def
630 V
12 B
(286)180 648 A
11 R
2119(File:)S
(src/fs/cache.c)605 2352 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(21140)210 648 A
1152(*)S
('block_type',)546 1236 A
(the)126 1824 A
(block)210 1992 A
2244(is)S
(not)126 2370 A
(likely)252 2538 A
2832(to)S
2958(be)S
(needed)252 3084 A
(again)210 3378 A
(shortly,)336 3630 A
4008(so)S
(put)126 4134 A
990 V
(21141)210 648 A
1152(*)S
1236(it)S
1362(on)S
(the)126 1488 A
(front)210 1656 A
1908(of)S
(the)126 2034 A
(LRU)126 2202 A
(chain)210 2370 A
(where)210 2622 A
2874(it)S
(will)168 3000 A
3210(be)S
(the)126 3336 A
(first)210 3504 A
(one)126 3756 A
3924(to)S
4050(be)S
1080 V
(21142)210 648 A
1152(*)S
(taken)210 1236 A
(when)168 1488 A
1698(a)S
(free)168 1782 A
(buffer)252 1992 A
2286(is)S
(needed)252 2412 A
(later.)252 2706 A
1170 V
(21143)210 648 A
1152(*/)S
1260 V
(21144)210 648 A
1110(if)S
(\(block_type)462 1236 A
1740(&)S
(ONE_SHOT\))378 1824 A
2244({)S
1350 V
(21145)210 648 A
1362(/*)S
(Block)210 1488 A
(probably)336 1740 A
(won't)210 2118 A
2370(be)S
(needed)252 2496 A
(quickly.)336 2790 A
(Put)126 3168 A
3336(it)S
3462(on)S
(front)210 3588 A
3840(of)S
(chain.)252 3966 A
1440 V
(21146)210 648 A
1404(*)S
1488(It)S
(will)168 1614 A
1824(be)S
(the)126 1950 A
(next)168 2118 A
(block)210 2328 A
2580(to)S
2706(be)S
(evicted)294 2832 A
(from)168 3168 A
(the)126 3378 A
(cache.)252 3546 A
1530 V
(21147)210 648 A
1404(*/)S
1620 V
(21148)210 648 A
(bp->b_prev)420 1362 A
1824(=)S
(NIL_BUF;)336 1908 A
1710 V
(21149)210 648 A
(bp->b_next)420 1362 A
1824(=)S
(front;)252 1908 A
1800 V
(21150)210 648 A
1362(if)S
(\(front)252 1488 A
1782(==)S
(NIL_BUF\))336 1908 A
1890 V
(21151)210 648 A
(rear)168 1698 A
1908(=)S
(bp;)126 1992 A
2370(/*)S
(LRU)126 2496 A
(chain)210 2664 A
(was)126 2916 A
(empty)210 3084 A
3336(*/)S
1980 V
(21152)210 648 A
(else)168 1362 A
2070 V
(21153)210 648 A
(front->b_prev)546 1698 A
2286(=)S
(bp;)126 2370 A
2160 V
(21154)210 648 A
(front)210 1362 A
1614(=)S
(bp;)126 1698 A
2250 V
(21155)210 648 A
1110(})S
(else)168 1194 A
1404({)S
2340 V
(21156)210 648 A
1362(/*)S
(Block)210 1488 A
(probably)336 1740 A
(will)168 2118 A
2328(be)S
(needed)252 2454 A
(quickly.)336 2748 A
(Put)126 3168 A
3336(it)S
3462(on)S
(rear)168 3588 A
3798(of)S
(chain.)252 3924 A
2430 V
(21157)210 648 A
1404(*)S
1488(It)S
(will)168 1614 A
(not)126 1824 A
1992(be)S
(evicted)294 2118 A
(from)168 2454 A
(the)126 2664 A
(cache)210 2832 A
(for)126 3084 A
3252(a)S
(long)168 3336 A
(time.)210 3546 A
2520 V
(21158)210 648 A
1404(*/)S
2610 V
(21159)210 648 A
(bp->b_prev)420 1362 A
1824(=)S
(rear;)210 1908 A
2700 V
(21160)210 648 A
(bp->b_next)420 1362 A
1824(=)S
(NIL_BUF;)336 1908 A
2790 V
(21161)210 648 A
1362(if)S
(\(rear)210 1488 A
1740(==)S
(NIL_BUF\))336 1866 A
2880 V
(21162)210 648 A
(front)210 1698 A
1950(=)S
(bp;)126 2034 A
2970 V
(21163)210 648 A
(else)168 1362 A
3060 V
(21164)210 648 A
(rear->b_next)504 1698 A
2244(=)S
(bp;)126 2328 A
3150 V
(21165)210 648 A
(rear)168 1362 A
1572(=)S
(bp;)126 1656 A
3240 V
(21166)210 648 A
1110(})S
3330 V
(21167)210 648 A
3420 V
(21168)210 648 A
1110(/*)S
(Some)168 1236 A
(blocks)252 1446 A
(are)126 1740 A
1908(so)S
(important)378 2034 A
(\(e.g.,)252 2454 A
(inodes,)294 2748 A
(indirect)336 3084 A
(blocks\))294 3462 A
(that)168 3798 A
(they)168 4008 A
3510 V
(21169)210 648 A
1152(*)S
(should)252 1236 A
1530(be)S
(written)294 1656 A
1992(to)S
(the)126 2118 A
(disk)168 2286 A
(immediately)462 2496 A
3000(to)S
(avoid)210 3126 A
(messing)294 3378 A
3714(up)S
(the)126 3840 A
(file)168 4008 A
3600 V
(21170)210 648 A
1152(*)S
(system)252 1236 A
1530(in)S
(the)126 1656 A
(event)210 1824 A
2076(of)S
2202(a)S
(crash.)252 2286 A
3690 V
(21171)210 648 A
1152(*/)S
3780 V
(21172)210 648 A
1110(if)S
(\(\(block_type)504 1236 A
1782(&)S
(WRITE_IMMED\))504 1866 A
2412(&&)S
(bp->b_dirt==DIRTY)714 2538 A
3294(&&)S
(bp->b_dev)378 3420 A
3840(!=)S
(NO_DEV\))294 3966 A
3870 V
(21173)210 648 A
(rw_block\(bp,)504 1362 A
(WRITING\);)378 1908 A
3960 V
(21174)210 648 A
1026(})S
4230 V
(21177)210 648 A
(/*===========================================================================*)3276 1026 A
4320 V
(21178)210 648 A
1068(*)S
(alloc_zone)420 2370 A
4260(*)S
4410 V
(21179)210 648 A
(*===========================================================================*/)3276 1068 A
4500 V
(21180)210 648 A
(PUBLIC)252 1026 A
(zone_t)252 1320 A
(alloc_zone\(dev,)630 1614 A
2286(z\))S
4590 V
(21181)210 648 A
(dev_t)210 1026 A
(dev;)168 1278 A
2370(/*)S
(device)252 2496 A
(where)210 2790 A
(zone)168 3042 A
(wanted)252 3252 A
3546(*/)S
4680 V
(21182)210 648 A
(zone_t)252 1026 A
1320(z;)S
2370(/*)S
(try)126 2496 A
2664(to)S
(allocate)336 2790 A
(new)126 3168 A
(zone)168 3336 A
(near)168 3546 A
(this)168 3756 A
(one)126 3966 A
4134(*/)S
4770 V
(21183)210 648 A
1026({)S
4860 V
(21184)210 648 A
1026(/*)S
(Allocate)336 1152 A
1530(a)S
(new)126 1614 A
(zone)168 1782 A
1992(on)S
(the)126 2118 A
(indicated)378 2286 A
(device)252 2706 A
(and)126 3000 A
(return)252 3168 A
(its)126 3462 A
(number.)294 3630 A
3966(*/)S
4950 V
(21185)210 648 A
5040 V
(21186)210 648 A
(int)126 1110 A
(major,)252 1278 A
(minor;)252 1572 A
5130 V
(21187)210 648 A
(bit_t)210 1110 A
1362(b,)S
(bit;)168 1488 A
5220 V
(21188)210 648 A
(struct)252 1110 A
(super_block)462 1404 A
(*sp;)168 1908 A
5310 V
(21189)210 648 A
5400 V
(21190)210 648 A
1110(/*)S
(Note)168 1236 A
(that)168 1446 A
(the)126 1656 A
(routine)294 1824 A
(alloc_bit\(\))462 2160 A
(returns)294 2664 A
3000(1)S
(for)126 3084 A
(the)126 3252 A
(lowest)252 3420 A
(possible)336 3714 A
5490 V
(21191)210 648 A
1152(*)S
(zone,)210 1236 A
(which)210 1488 A
(corresponds)462 1740 A
2244(to)S
(sp->s_firstdatazone.)840 2370 A
3294(To)S
(convert)294 3420 A
3756(a)S
(value)210 3840 A
5580 V
(21192)210 648 A
1152(*)S
(between)294 1236 A
(the)126 1572 A
(bit)126 1740 A
(number,)294 1908 A
('b',)168 2244 A
(used)168 2454 A
2664(by)S
(alloc_bit\(\))462 2790 A
(and)126 3294 A
(the)126 3462 A
(zone)168 3630 A
(number,)294 3840 A
('z',)168 4176 A
5670 V
(21193)210 648 A
1152(*)S
(stored)252 1236 A
1530(in)S
(the)126 1656 A
(inode,)252 1824 A
(use)126 2118 A
(the)126 2286 A
(formula:)336 2454 A
5760 V
(21194)210 648 A
1152(*)S
1404(z)S
1488(=)S
1572(b)S
1656(+)S
(sp->s_firstdatazone)798 1740 A
2580(-)S
2664(1)S
5850 V
(21195)210 648 A
1152(*)S
(Alloc_bit\(\))462 1236 A
(never)210 1740 A
(returns)294 1992 A
2328(0,)S
(since)210 2454 A
(this)168 2706 A
2916(is)S
(used)168 3042 A
(for)126 3252 A
(NO_BIT)252 3420 A
(\(failure\).)420 3714 A
5940 V
(21196)210 648 A
1152(*/)S
6030 V
(21197)210 648 A
1110(sp)S
1236(=)S
(get_super\(dev\);)630 1320 A
2370(/*)S
(find)168 2496 A
(the)126 2706 A
(super_block)462 2874 A
(for)126 3378 A
(this)168 3546 A
(device)252 3756 A
4050(*/)S
6120 V
(21198)210 648 A
6210 V
(21199)210 648 A
1110(/*)S
1236(If)S
1362(z)S
1446(is)S
1572(0,)S
(skip)168 1698 A
(initial)294 1908 A
(part)168 2244 A
2454(of)S
(the)126 2580 A
(map)126 2748 A
(known)210 2916 A
3168(to)S
3294(be)S
(fully)210 3420 A
3672(in)S
(use.)168 3798 A
4008(*/)S
8418 V
EP
%%Page: 287 287
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2119(File:)S
(src/fs/cache.c)605 2352 A
12 B
(287)180 4248 A
900 V
7 LST
(21200)210 648 A
1110(if)S
1236(\(z)S
1362(==)S
(sp->s_firstdatazone\))840 1488 A
2370({)S
990 V
(21201)210 648 A
(bit)126 1362 A
1530(=)S
(sp->s_zsearch;)588 1614 A
1080 V
(21202)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1170 V
(21203)210 648 A
(bit)126 1362 A
1530(=)S
(\(bit_t\))294 1614 A
1950(z)S
2034(-)S
(\(sp->s_firstdatazone)840 2118 A
3000(-)S
(1\);)126 3084 A
1260 V
(21204)210 648 A
1110(})S
1350 V
(21205)210 648 A
1110(b)S
1194(=)S
(alloc_bit\(sp,)546 1278 A
(ZMAP,)210 1866 A
(bit\);)210 2118 A
1440 V
(21206)210 648 A
1110(if)S
1236(\(b)S
1362(==)S
(NO_BIT\))294 1488 A
1824({)S
1530 V
(21207)210 648 A
(err_code)336 1362 A
1740(=)S
(ENOSPC;)294 1824 A
1620 V
(21208)210 648 A
(major)210 1362 A
1614(=)S
(\(int\))210 1698 A
(\(sp->s_dev)420 1950 A
2412(>>)S
(MAJOR\))252 2538 A
2832(&)S
(BYTE;)210 2916 A
1710 V
(21209)210 648 A
(minor)210 1362 A
1614(=)S
(\(int\))210 1698 A
(\(sp->s_dev)420 1950 A
2412(>>)S
(MINOR\))252 2538 A
2832(&)S
(BYTE;)210 2916 A
1800 V
(21210)210 648 A
(printf\("No)420 1362 A
(space)210 1824 A
2076(on)S
(%sdevice)336 2202 A
(%d/%d\\n",)378 2580 A
1890 V
(21211)210 648 A
(sp->s_dev)378 1698 A
2118(==)S
(ROOT_DEV)336 2244 A
2622(?)S
("root)210 2706 A
2958(")S
3042(:)S
("",)126 3126 A
(major,)252 3294 A
(minor\);)294 3588 A
1980 V
(21212)210 648 A
(return\(NO_ZONE\);)672 1362 A
2070 V
(21213)210 648 A
1110(})S
2160 V
(21214)210 648 A
1110(if)S
1236(\(z)S
1362(==)S
(sp->s_firstdatazone\))840 1488 A
(sp->s_zsearch)546 2370 A
2958(=)S
3042(b;)S
3378(/*)S
(for)126 3504 A
(next)168 3672 A
(time)168 3882 A
4092(*/)S
2250 V
(21215)210 648 A
(return\(sp->s_firstdatazone)1092 1110 A
2244(-)S
2328(1)S
2412(+)S
(\(zone_t\))336 2496 A
(b\);)126 2874 A
2340 V
(21216)210 648 A
1026(})S
2610 V
(21219)210 648 A
(/*===========================================================================*)3276 1026 A
2700 V
(21220)210 648 A
1068(*)S
(free_zone)378 2370 A
4260(*)S
2790 V
(21221)210 648 A
(*===========================================================================*/)3276 1068 A
2880 V
(21222)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(free_zone\(dev,)588 1530 A
(numb\))210 2160 A
2970 V
(21223)210 648 A
(dev_t)210 1026 A
(dev;)168 1278 A
2706(/*)S
(device)252 2832 A
(where)210 3126 A
(zone)168 3378 A
(located)294 3588 A
3924(*/)S
3060 V
(21224)210 648 A
(zone_t)252 1026 A
(numb;)210 1320 A
2706(/*)S
(zone)168 2832 A
3042(to)S
3168(be)S
(returned)336 3294 A
3672(*/)S
3150 V
(21225)210 648 A
1026({)S
3240 V
(21226)210 648 A
1026(/*)S
(Return)252 1152 A
1446(a)S
(zone.)210 1530 A
1782(*/)S
3330 V
(21227)210 648 A
3420 V
(21228)210 648 A
(register)336 1110 A
(struct)252 1488 A
(super_block)462 1782 A
(*sp;)168 2286 A
3510 V
(21229)210 648 A
(bit_t)210 1110 A
(bit;)168 1362 A
3600 V
(21230)210 648 A
3690 V
(21231)210 648 A
1110(/*)S
(Locate)252 1236 A
(the)126 1530 A
(appropriate)462 1698 A
(super_block)462 2202 A
(and)126 2706 A
(return)252 2874 A
(bit.)168 3168 A
3378(*/)S
3780 V
(21232)210 648 A
1110(sp)S
1236(=)S
(get_super\(dev\);)630 1320 A
3870 V
(21233)210 648 A
1110(if)S
(\(numb)210 1236 A
1488(<)S
(sp->s_firstdatazone)798 1572 A
2412(||)S
(numb)168 2538 A
2748(>=)S
(sp->s_zones\))504 2874 A
(return;)294 3420 A
3960 V
(21234)210 648 A
(bit)126 1110 A
1278(=)S
(\(bit_t\))294 1362 A
(\(numb)210 1698 A
1950(-)S
(\(sp->s_firstdatazone)840 2034 A
2916(-)S
(1\)\);)168 3000 A
4050 V
(21235)210 648 A
(free_bit\(sp,)504 1110 A
(ZMAP,)210 1656 A
(bit\);)210 1908 A
4140 V
(21236)210 648 A
1110(if)S
(\(bit)168 1236 A
1446(<)S
(sp->s_zsearch\))588 1530 A
(sp->s_zsearch)546 2160 A
2748(=)S
(bit;)168 2832 A
4230 V
(21237)210 648 A
1026(})S
4500 V
(21240)210 648 A
(/*===========================================================================*)3276 1026 A
4590 V
(21241)210 648 A
1068(*)S
(rw_block)336 2370 A
4260(*)S
4680 V
(21242)210 648 A
(*===========================================================================*/)3276 1068 A
4770 V
(21243)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(rw_block\(bp,)504 1530 A
(rw_flag\))336 2076 A
4860 V
(21244)210 648 A
(register)336 1026 A
(struct)252 1404 A
(buf)126 1698 A
(*bp;)168 1866 A
2370(/*)S
(buffer)252 2496 A
(pointer)294 2790 A
3126(*/)S
4950 V
(21245)210 648 A
(int)126 1026 A
(rw_flag;)336 1194 A
2370(/*)S
(READING)294 2496 A
2832(or)S
(WRITING)294 2958 A
3294(*/)S
5040 V
(21246)210 648 A
1026({)S
5130 V
(21247)210 648 A
1026(/*)S
(Read)168 1152 A
1362(or)S
(write)210 1488 A
1740(a)S
(disk)168 1824 A
(block.)252 2034 A
(This)168 2328 A
2538(is)S
(the)126 2664 A
(only)168 2832 A
(routine)294 3042 A
3378(in)S
(which)210 3504 A
(actual)252 3756 A
(disk)168 4050 A
5220 V
(21248)210 648 A
1068(*)S
(I/O)126 1152 A
1320(is)S
(invoked.)336 1446 A
1824(If)S
1950(an)S
(error)210 2076 A
(occurs,)294 2328 A
2664(a)S
(message)294 2748 A
3084(is)S
(printed)294 3210 A
(here,)210 3546 A
(but)126 3798 A
(the)126 3966 A
(error)210 4134 A
5310 V
(21249)210 648 A
1068(*)S
1152(is)S
(not)126 1278 A
(reported)336 1446 A
1824(to)S
(the)126 1950 A
(caller.)294 2118 A
2496(If)S
(the)126 2622 A
(error)210 2790 A
(occurred)336 3042 A
(while)210 3420 A
(purging)294 3672 A
4008(a)S
(block)210 4092 A
5400 V
(21250)210 648 A
1068(*)S
(from)168 1152 A
(the)126 1362 A
(cache,)252 1530 A
1824(it)S
1950(is)S
(not)126 2076 A
(clear)210 2244 A
(what)168 2496 A
(the)126 2706 A
(caller)252 2874 A
(could)210 3168 A
3420(do)S
(about)210 3546 A
3798(it)S
(anyway.)294 3924 A
5490 V
(21251)210 648 A
1068(*/)S
5580 V
(21252)210 648 A
5670 V
(21253)210 648 A
(int)126 1110 A
1278(r,)S
(op;)126 1404 A
5760 V
(21254)210 648 A
(off_t)210 1110 A
(pos;)168 1362 A
5850 V
(21255)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
5940 V
(21256)210 648 A
6030 V
(21257)210 648 A
1110(if)S
1236(\()S
(\(dev)168 1320 A
1530(=)S
(bp->b_dev\))420 1614 A
2076(!=)S
(NO_DEV\))294 2202 A
2538({)S
6120 V
(21258)210 648 A
(pos)126 1362 A
1530(=)S
(\(off_t\))294 1614 A
(bp->b_blocknr)546 1950 A
2538(*)S
(BLOCK_SIZE;)462 2622 A
6210 V
(21259)210 648 A
1362(op)S
1488(=)S
(\(rw_flag)336 1572 A
1950(==)S
(READING)294 2076 A
2412(?)S
(DEV_READ)336 2496 A
2874(:)S
(DEV_WRITE\);)462 2958 A
8418 V
EP
%%Page: 288 288
BP
/slant 0 def
/height 0 def
630 V
12 B
(288)180 648 A
11 R
2119(File:)S
(src/fs/cache.c)605 2352 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(21260)210 648 A
1362(r)S
1446(=)S
(dev_io\(op,)420 1530 A
(FALSE,)252 1992 A
(dev,)168 2286 A
(pos,)168 2496 A
(BLOCK_SIZE,)462 2706 A
(FS_PROC_NR,)462 3210 A
(bp->b_data\);)504 3714 A
990 V
(21261)210 648 A
1362(if)S
1488(\(r)S
1614(!=)S
(BLOCK_SIZE\))462 1740 A
2244({)S
1080 V
(21262)210 648 A
1530(if)S
1656(\(r)S
1782(>=)S
1908(0\))S
2034(r)S
2118(=)S
(END_OF_FILE;)504 2202 A
1170 V
(21263)210 648 A
1530(if)S
1656(\(r)S
1782(!=)S
(END_OF_FILE\))504 1908 A
1260 V
(21264)210 648 A
(printf\("Unrecoverable)882 1614 A
(disk)168 2538 A
(error)210 2748 A
3000(on)S
(device)252 3126 A
(%d/%d,)252 3420 A
(block)210 3714 A
(%ld\\n",)294 3966 A
1350 V
(21265)210 648 A
(\(dev>>MAJOR\)&BYTE,)756 2034 A
(\(dev>>MINOR\)&BYTE,)756 2832 A
(bp->b_blocknr\);)630 3630 A
1440 V
(21266)210 648 A
(bp->b_dev)378 1698 A
2118(=)S
(NO_DEV;)294 2202 A
2706(/*)S
(invalidate)420 2832 A
(block)210 3294 A
3546(*/)S
1530 V
(21267)210 648 A
1620 V
(21268)210 648 A
1698(/*)S
(Report)252 1824 A
(read)168 2118 A
(errors)252 2328 A
2622(to)S
(interested)420 2748 A
(parties.)336 3210 A
3588(*/)S
1710 V
(21269)210 648 A
1698(if)S
(\(rw_flag)336 1824 A
2202(==)S
(READING\))336 2328 A
(rdwt_err)336 2706 A
3084(=)S
3168(r;)S
1800 V
(21270)210 648 A
1362(})S
1890 V
(21271)210 648 A
1110(})S
1980 V
(21272)210 648 A
2070 V
(21273)210 648 A
(bp->b_dirt)420 1110 A
1572(=)S
(CLEAN;)252 1656 A
2160 V
(21274)210 648 A
1026(})S
2430 V
(21277)210 648 A
(/*===========================================================================*)3276 1026 A
2520 V
(21278)210 648 A
1068(*)S
(invalidate)420 2370 A
4260(*)S
2610 V
(21279)210 648 A
(*===========================================================================*/)3276 1068 A
2700 V
(21280)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(invalidate\(device\))756 1530 A
2790 V
(21281)210 648 A
(dev_t)210 1026 A
(device;)294 1278 A
2370(/*)S
(device)252 2496 A
(whose)210 2790 A
(blocks)252 3042 A
(are)126 3336 A
3504(to)S
3630(be)S
(purged)252 3756 A
4050(*/)S
2880 V
(21282)210 648 A
1026({)S
2970 V
(21283)210 648 A
1026(/*)S
(Remove)252 1152 A
(all)126 1446 A
(the)126 1614 A
(blocks)252 1782 A
(belonging)378 2076 A
2496(to)S
(some)168 2622 A
(device)252 2832 A
(from)168 3126 A
(the)126 3336 A
(cache.)252 3504 A
3798(*/)S
3060 V
(21284)210 648 A
3150 V
(21285)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp;)168 1950 A
3240 V
(21286)210 648 A
3330 V
(21287)210 648 A
(for)126 1110 A
(\(bp)126 1278 A
1446(=)S
(&buf[0];)336 1530 A
1908(bp)S
2034(<)S
(&buf[NR_BUFS];)588 2118 A
(bp++\))210 2748 A
3420 V
(21288)210 648 A
1362(if)S
(\(bp->b_dev)420 1488 A
1950(==)S
(device\))294 2076 A
(bp->b_dev)378 2412 A
2832(=)S
(NO_DEV;)294 2916 A
3510 V
(21289)210 648 A
1026(})S
3780 V
(21292)210 648 A
(/*==========================================================================*)3234 1026 A
3870 V
(21293)210 648 A
1068(*)S
(flushall)336 2370 A
4218(*)S
3960 V
(21294)210 648 A
(*==========================================================================*/)3234 1068 A
4050 V
(21295)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(flushall\(dev\))546 1530 A
4140 V
(21296)210 648 A
(dev_t)210 1026 A
(dev;)168 1278 A
2370(/*)S
(device)252 2496 A
2790(to)S
(flush)210 2916 A
3168(*/)S
4230 V
(21297)210 648 A
1026({)S
4320 V
(21298)210 648 A
1026(/*)S
(Flush)210 1152 A
(all)126 1404 A
(dirty)210 1572 A
(blocks)252 1824 A
(for)126 2118 A
(one)126 2286 A
(device.)294 2454 A
2790(*/)S
4410 V
(21299)210 648 A
4500 V
(21300)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp;)168 1950 A
4590 V
(21301)210 648 A
(static)252 1110 A
(struct)252 1404 A
(buf)126 1698 A
(*dirty[NR_BUFS];)672 1866 A
2706(/*)S
(static)252 2832 A
3126(so)S
3252(it)S
(isn't)210 3378 A
3630(on)S
(stack)210 3756 A
4008(*/)S
4680 V
(21302)210 648 A
(int)126 1110 A
(ndirty;)294 1278 A
4770 V
(21303)210 648 A
4860 V
(21304)210 648 A
(for)126 1110 A
(\(bp)126 1278 A
1446(=)S
(&buf[0],)336 1530 A
(ndirty)252 1908 A
2202(=)S
2286(0;)S
2412(bp)S
2538(<)S
(&buf[NR_BUFS];)588 2622 A
(bp++\))210 3252 A
4950 V
(21305)210 648 A
1362(if)S
(\(bp->b_dirt)462 1488 A
1992(==)S
(DIRTY)210 2118 A
2370(&&)S
(bp->b_dev)378 2496 A
2916(==)S
(dev\))168 3042 A
(dirty[ndirty++])630 3252 A
3924(=)S
(bp;)126 4008 A
5040 V
(21306)210 648 A
(rw_scattered\(dev,)714 1110 A
(dirty,)252 1866 A
(ndirty,)294 2160 A
(WRITING\);)378 2496 A
5130 V
(21307)210 648 A
1026(})S
5400 V
(21310)210 648 A
(/*===========================================================================*)3276 1026 A
5490 V
(21311)210 648 A
1068(*)S
(rw_scattered)504 2370 A
4260(*)S
5580 V
(21312)210 648 A
(*===========================================================================*/)3276 1068 A
5670 V
(21313)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(rw_scattered\(dev,)714 1530 A
(bufq,)210 2286 A
(bufqsize,)378 2538 A
(rw_flag\))336 2958 A
5760 V
(21314)210 648 A
(dev_t)210 1026 A
(dev;)168 1278 A
2370(/*)S
(major-minor)462 2496 A
(device)252 3000 A
(number)252 3294 A
3588(*/)S
5850 V
(21315)210 648 A
(struct)252 1026 A
(buf)126 1320 A
(**bufq;)294 1488 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(array)210 2958 A
3210(of)S
(buffers)294 3336 A
3672(*/)S
5940 V
(21316)210 648 A
(int)126 1026 A
(bufqsize;)378 1194 A
2370(/*)S
(number)252 2496 A
2790(of)S
(buffers)294 2916 A
3252(*/)S
6030 V
(21317)210 648 A
(int)126 1026 A
(rw_flag;)336 1194 A
2370(/*)S
(READING)294 2496 A
2832(or)S
(WRITING)294 2958 A
3294(*/)S
6120 V
(21318)210 648 A
1026({)S
6210 V
(21319)210 648 A
1026(/*)S
(Read)168 1152 A
1362(or)S
(write)210 1488 A
(scattered)378 1740 A
(data)168 2160 A
(from)168 2370 A
2580(a)S
(device.)294 2664 A
3000(*/)S
8418 V
EP
%%Page: 289 289
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2119(File:)S
(src/fs/cache.c)605 2352 A
12 B
(289)180 4248 A
900 V
7 LST
(21320)210 648 A
990 V
(21321)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp;)168 1950 A
1080 V
(21322)210 648 A
(int)126 1110 A
(gap;)168 1278 A
1170 V
(21323)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(i;)S
1260 V
(21324)210 648 A
(register)336 1110 A
(struct)252 1488 A
(iorequest_s)462 1782 A
(*iop;)210 2286 A
1350 V
(21325)210 648 A
(static)252 1110 A
(struct)252 1404 A
(iorequest_s)462 1698 A
(iovec[NR_IOREQS];)714 2202 A
3000(/*)S
(static)252 3126 A
3420(so)S
3546(it)S
(isn't)210 3672 A
3924(on)S
(stack)210 4050 A
4302(*/)S
1440 V
(21326)210 648 A
(int)126 1110 A
1278(j;)S
1530 V
(21327)210 648 A
1620 V
(21328)210 648 A
1110(/*)S
(\(Shell\))294 1236 A
(sort)168 1572 A
(buffers)294 1782 A
2118(on)S
(b_blocknr.)420 2244 A
2706(*/)S
1710 V
(21329)210 648 A
(gap)126 1110 A
1278(=)S
1362(1;)S
1800 V
(21330)210 648 A
1110(do)S
1890 V
(21331)210 648 A
(gap)126 1362 A
1530(=)S
1614(3)S
1698(*)S
(gap)126 1782 A
1950(+)S
2034(1;)S
1980 V
(21332)210 648 A
(while)210 1110 A
(\(gap)168 1362 A
1572(<=)S
(bufqsize\);)420 1698 A
2070 V
(21333)210 648 A
(while)210 1110 A
(\(gap)168 1362 A
1572(!=)S
1698(1\))S
1824({)S
2160 V
(21334)210 648 A
(gap)126 1362 A
1530(/=)S
1656(3;)S
2250 V
(21335)210 648 A
(for)126 1362 A
1530(\(j)S
1656(=)S
(gap;)168 1740 A
1950(j)S
2034(<)S
(bufqsize;)378 2118 A
(j++\))168 2538 A
2748({)S
2340 V
(21336)210 648 A
(for)126 1698 A
1866(\(i)S
1992(=)S
2076(j)S
2160(-)S
(gap;)168 2244 A
2430 V
(21337)210 648 A
1908(i)S
1992(>=)S
2118(0)S
2202(&&)S
(bufq[i]->b_blocknr)756 2328 A
3126(>)S
(bufq[i)252 3210 A
3504(+)S
(gap]->b_blocknr;)672 3588 A
2520 V
(21338)210 648 A
1908(i)S
1992(-=)S
(gap\))168 2118 A
2328({)S
2610 V
(21339)210 648 A
2034(bp)S
2160(=)S
(bufq[i];)336 2244 A
2700 V
(21340)210 648 A
(bufq[i])294 2034 A
2370(=)S
(bufq[i)252 2454 A
2748(+)S
(gap];)210 2832 A
2790 V
(21341)210 648 A
(bufq[i)252 2034 A
2328(+)S
(gap])168 2412 A
2622(=)S
(bp;)126 2706 A
2880 V
(21342)210 648 A
1698(})S
2970 V
(21343)210 648 A
1362(})S
3060 V
(21344)210 648 A
1110(})S
3150 V
(21345)210 648 A
3240 V
(21346)210 648 A
1110(/*)S
(Set)126 1236 A
1404(up)S
(i/o)126 1530 A
(vector)252 1698 A
(and)126 1992 A
2160(do)S
(i/o.)168 2286 A
(The)126 2538 A
(result)252 2706 A
3000(of)S
(dev_io)252 3126 A
3420(is)S
(discarded)378 3546 A
(because)294 3966 A
3330 V
(21347)210 648 A
1152(*)S
(all)126 1236 A
(results)294 1404 A
(are)126 1740 A
(returned)336 1908 A
2286(in)S
(the)126 2412 A
(vector.)294 2580 A
2958(If)S
(dev_io)252 3084 A
(fails)210 3378 A
(completely,)462 3630 A
(the)126 4134 A
3420 V
(21348)210 648 A
1152(*)S
(vector)252 1236 A
1530(is)S
(unchanged)378 1656 A
(and)126 2076 A
(all)126 2244 A
(results)294 2412 A
(are)126 2748 A
(taken)210 2916 A
3168(as)S
(errors.)294 3294 A
3510 V
(21349)210 648 A
1152(*/)S
3600 V
(21350)210 648 A
(while)210 1110 A
(\(bufqsize)378 1362 A
1782(>)S
1866(0\))S
1992({)S
3690 V
(21351)210 648 A
(for)126 1362 A
1530(\(j)S
1656(=)S
1740(0,)S
(iop)126 1866 A
2034(=)S
(iovec;)252 2118 A
2412(j)S
2496(<)S
(NR_IOREQS)378 2580 A
3000(&&)S
3126(j)S
3210(<)S
(bufqsize;)378 3294 A
(j++,)168 3714 A
(iop++\))252 3924 A
4218({)S
3780 V
(21352)210 648 A
1698(bp)S
1824(=)S
(bufq[j];)336 1908 A
3870 V
(21353)210 648 A
(iop->io_position)672 1698 A
2412(=)S
(\(off_t\))294 2496 A
(bp->b_blocknr)546 2832 A
3420(*)S
(BLOCK_SIZE;)462 3504 A
3960 V
(21354)210 648 A
(iop->io_buf)462 1698 A
2202(=)S
(bp->b_data;)462 2286 A
4050 V
(21355)210 648 A
(iop->io_nbytes)588 1698 A
2328(=)S
(BLOCK_SIZE;)462 2412 A
4140 V
(21356)210 648 A
(iop->io_request)630 1698 A
2370(=)S
(rw_flag)294 2454 A
2790(==)S
(WRITING)294 2916 A
3252(?)S
4230 V
(21357)210 648 A
(DEV_WRITE)378 2454 A
2874(:)S
(DEV_READ)336 2958 A
3336(|)S
(OPTIONAL_IO;)504 3420 A
4320 V
(21358)210 648 A
1362(})S
4410 V
(21359)210 648 A
(\(void\))252 1362 A
(dev_io\(SCATTERED_IO,)840 1656 A
2538(0,)S
(dev,)168 2664 A
(\(off_t\))294 2874 A
3210(0,)S
3336(j,)S
(FS_PROC_NR,)462 3462 A
4500 V
(21360)210 648 A
(\(char)210 3378 A
3630(*\))S
(iovec\);)294 3756 A
4590 V
(21361)210 648 A
4680 V
(21362)210 648 A
1362(/*)S
(Harvest)294 1488 A
(the)126 1824 A
(results.)336 1992 A
(Leave)210 2412 A
(read)168 2664 A
(errors)252 2874 A
(for)126 3168 A
(rw_block\(\))420 3336 A
3798(to)S
(complain.)378 3924 A
4344(*/)S
4770 V
(21363)210 648 A
(for)126 1362 A
1530(\(i)S
1656(=)S
1740(0,)S
(iop)126 1866 A
2034(=)S
(iovec;)252 2118 A
2412(i)S
2496(<)S
2580(j;)S
(i++,)168 2706 A
(iop++\))252 2916 A
3210({)S
4860 V
(21364)210 648 A
1698(bp)S
1824(=)S
(bufq[i];)336 1908 A
4950 V
(21365)210 648 A
1698(if)S
(\(rw_flag)336 1824 A
2202(==)S
(READING\))336 2328 A
2706({)S
5040 V
(21366)210 648 A
1866(if)S
(\(iop->io_nbytes)630 1992 A
2664(==)S
2790(0\))S
5130 V
(21367)210 648 A
(bp->b_dev)378 2034 A
2454(=)S
(dev;)168 2538 A
3042(/*)S
(validate)336 3168 A
(block)210 3546 A
3798(*/)S
5220 V
(21368)210 648 A
(put_block\(bp,)546 1866 A
(PARTIAL_DATA_BLOCK\);)840 2454 A
5310 V
(21369)210 648 A
1698(})S
(else)168 1782 A
1992({)S
5400 V
(21370)210 648 A
1866(if)S
(\(iop->io_nbytes)630 1992 A
2664(!=)S
2790(0\))S
2916({)S
5490 V
(21371)210 648 A
(printf\("Unrecoverable)882 1908 A
(write)210 2832 A
(error)210 3084 A
3336(on)S
(device)252 3462 A
(%d/%d,)252 3756 A
(block)210 4050 A
(%ld\\n",)294 4302 A
5580 V
(21372)210 648 A
(\(dev>>MAJOR\)&BYTE,)756 2370 A
(\(dev>>MINOR\)&BYTE,)756 3168 A
(bp->b_blocknr\);)630 3966 A
5670 V
(21373)210 648 A
(bp->b_dev)378 2034 A
2454(=)S
(NO_DEV;)294 2538 A
3042(/*)S
(invalidate)420 3168 A
(block)210 3630 A
3882(*/)S
5760 V
(21374)210 648 A
1866(})S
5850 V
(21375)210 648 A
(bp->b_dirt)420 1866 A
2328(=)S
(CLEAN;)252 2412 A
5940 V
(21376)210 648 A
1698(})S
6030 V
(21377)210 648 A
1362(})S
6120 V
(21378)210 648 A
(bufq)168 1362 A
1572(+=)S
1698(j;)S
6210 V
(21379)210 648 A
(bufqsize)336 1362 A
1740(-=)S
1866(j;)S
8418 V
EP
%%Page: 290 290
BP
/slant 0 def
/height 0 def
630 V
12 B
(290)180 648 A
11 R
2119(File:)S
(src/fs/cache.c)605 2352 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(21380)210 648 A
1110(})S
990 V
(21381)210 648 A
1026(})S
1260 V
(21384)210 648 A
(/*===========================================================================*)3276 1026 A
1350 V
(21385)210 648 A
1068(*)S
(rm_lru)252 2370 A
4260(*)S
1440 V
(21386)210 648 A
(*===========================================================================*/)3276 1068 A
1530 V
(21387)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(rm_lru\(bp\))420 1572 A
1620 V
(21388)210 648 A
(struct)252 1026 A
(buf)126 1320 A
(*bp;)168 1488 A
1710 V
(21389)210 648 A
1026({)S
1800 V
(21390)210 648 A
1026(/*)S
(Remove)252 1152 A
1446(a)S
(block)210 1530 A
(from)168 1782 A
(its)126 1992 A
(LRU)126 2160 A
(chain.)252 2328 A
2622(*/)S
1890 V
(21391)210 648 A
1980 V
(21392)210 648 A
(struct)252 1110 A
(buf)126 1404 A
(*next_ptr,)420 1572 A
(*prev_ptr;)420 2034 A
2070 V
(21393)210 648 A
2160 V
(21394)210 648 A
(bufs_in_use++;)588 1110 A
2250 V
(21395)210 648 A
(next_ptr)336 1110 A
1488(=)S
(bp->b_next;)462 1572 A
2370(/*)S
(successor)378 2496 A
2916(on)S
(LRU)126 3042 A
(chain)210 3210 A
3462(*/)S
2340 V
(21396)210 648 A
(prev_ptr)336 1110 A
1488(=)S
(bp->b_prev;)462 1572 A
2370(/*)S
(predecessor)462 2496 A
3000(on)S
(LRU)126 3126 A
(chain)210 3294 A
3546(*/)S
2430 V
(21397)210 648 A
1110(if)S
(\(prev_ptr)378 1236 A
1656(!=)S
(NIL_BUF\))336 1782 A
2520 V
(21398)210 648 A
(prev_ptr->b_next)672 1362 A
2076(=)S
(next_ptr;)378 2160 A
2610 V
(21399)210 648 A
(else)168 1110 A
2700 V
(21400)210 648 A
(front)210 1362 A
1614(=)S
(next_ptr;)378 1698 A
2370(/*)S
(this)168 2496 A
(block)210 2706 A
(was)126 2958 A
3126(at)S
(front)210 3252 A
3504(of)S
(chain)210 3630 A
3882(*/)S
2790 V
(21401)210 648 A
2880 V
(21402)210 648 A
1110(if)S
(\(next_ptr)378 1236 A
1656(!=)S
(NIL_BUF\))336 1782 A
2970 V
(21403)210 648 A
(next_ptr->b_prev)672 1362 A
2076(=)S
(prev_ptr;)378 2160 A
3060 V
(21404)210 648 A
(else)168 1110 A
3150 V
(21405)210 648 A
(rear)168 1362 A
1572(=)S
(prev_ptr;)378 1656 A
2370(/*)S
(this)168 2496 A
(block)210 2706 A
(was)126 2958 A
3126(at)S
(rear)168 3252 A
3462(of)S
(chain)210 3588 A
3840(*/)S
3240 V
(21406)210 648 A
1026(})S
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(src/fs/inode.c)588 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(21500)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(manages)294 1572 A
(the)126 1908 A
(inode)210 2076 A
(table.)252 2328 A
(There)210 2664 A
(are)126 2916 A
(procedures)420 3084 A
3546(to)S
(allocate)336 3672 A
(and)126 4050 A
4140 V
(21501)210 648 A
1068(*)S
(deallocate)420 1152 A
(inodes,)294 1614 A
(acquire,)336 1950 A
(erase,)252 2328 A
(and)126 2622 A
(release)294 2790 A
(them,)210 3126 A
(and)126 3378 A
(read)168 3546 A
(and)126 3756 A
(write)210 3924 A
4230 V
(21502)210 648 A
1068(*)S
(them)168 1152 A
(from)168 1362 A
(the)126 1572 A
(disk.)210 1740 A
4320 V
(21503)210 648 A
1068(*)S
4410 V
(21504)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
4500 V
(21505)210 648 A
1068(*)S
(get_inode:)420 1236 A
(search)252 1824 A
(inode)210 2118 A
(table)210 2370 A
(for)126 2622 A
2790(a)S
(given)210 2874 A
(inode;)252 3126 A
3420(if)S
(not)126 3546 A
(there,)252 3714 A
(read)168 4008 A
4218(it)S
4590 V
(21506)210 648 A
1068(*)S
(put_inode:)420 1236 A
(indicate)336 1824 A
(that)168 2202 A
2412(an)S
(inode)210 2538 A
2790(is)S
2916(no)S
(longer)252 3042 A
(needed)252 3336 A
3630(in)S
(memory)252 3756 A
4680 V
(21507)210 648 A
1068(*)S
(alloc_inode:)504 1236 A
(allocate)336 1824 A
2202(a)S
(new,)168 2286 A
(unused)252 2496 A
(inode)210 2790 A
4770 V
(21508)210 648 A
1068(*)S
(wipe_inode:)462 1236 A
(erase)210 1824 A
(some)168 2076 A
(fields)252 2286 A
2580(of)S
2706(a)S
(newly)210 2790 A
(allocated)378 3042 A
(inode)210 3462 A
4860 V
(21509)210 648 A
1068(*)S
(free_inode:)462 1236 A
(mark)168 1824 A
2034(an)S
(inode)210 2160 A
2412(as)S
(available)378 2538 A
(for)126 2958 A
3126(a)S
(new)126 3210 A
(file)168 3378 A
4950 V
(21510)210 648 A
1068(*)S
(update_times:)546 1236 A
(update)252 1824 A
(atime,)252 2118 A
(ctime,)252 2412 A
(and)126 2706 A
(mtime)210 2874 A
5040 V
(21511)210 648 A
1068(*)S
(rw_inode:)378 1236 A
(read)168 1824 A
2034(a)S
(disk)168 2118 A
(block)210 2328 A
(and)126 2580 A
(extract)294 2748 A
3084(an)S
(inode,)252 3210 A
3504(or)S
(corresp.)336 3630 A
(write)210 4008 A
5130 V
(21512)210 648 A
1068(*)S
(old_icopy:)420 1236 A
(copy)168 1824 A
(to/from)294 2034 A
(in-core)294 2370 A
(inode)210 2706 A
(struct)252 2958 A
(and)126 3252 A
(disk)168 3420 A
(inode)210 3630 A
(\(V1.x\))252 3882 A
5220 V
(21513)210 648 A
1068(*)S
(new_icopy:)420 1236 A
(copy)168 1824 A
(to/from)294 2034 A
(in-core)294 2370 A
(inode)210 2706 A
(struct)252 2958 A
(and)126 3252 A
(disk)168 3420 A
(inode)210 3630 A
(\(V2.x\))252 3882 A
5310 V
(21514)210 648 A
1068(*)S
(dup_inode:)420 1236 A
(indicate)336 1824 A
(that)168 2202 A
(someone)294 2412 A
(else)168 2748 A
2958(is)S
(using)210 3084 A
3336(an)S
(inode)210 3462 A
(table)210 3714 A
(entry)210 3966 A
5400 V
(21515)210 648 A
1068(*/)S
5490 V
(21516)210 648 A
5580 V
(21517)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
5670 V
(21518)210 648 A
(#include)336 1026 A
(<minix/boot.h>)588 1404 A
5760 V
(21519)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
5850 V
(21520)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
5940 V
(21521)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
6030 V
(21522)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
6120 V
(21523)210 648 A
(#include)336 1026 A
("super.h")378 1404 A
6210 V
(21524)210 648 A
8418 V
EP
%%Page: 291 291
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2123(File:)S
(src/fs/inode.c)596 2356 A
12 B
(291)180 4248 A
900 V
7 LST
(21525)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(old_icopy,)420 2076 A
(\(struct)294 2538 A
(inode)210 2874 A
(*rip,)210 3126 A
(d1_inode)336 3378 A
(*dip,)210 3756 A
990 V
(21526)210 648 A
(int)126 3042 A
(direction,)420 3210 A
(int)126 3672 A
(norm\)\);)294 3840 A
1080 V
(21527)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(new_icopy,)420 2076 A
(\(struct)294 2538 A
(inode)210 2874 A
(*rip,)210 3126 A
(d2_inode)336 3378 A
(*dip,)210 3756 A
1170 V
(21528)210 648 A
(int)126 3042 A
(direction,)420 3210 A
(int)126 3672 A
(norm\)\);)294 3840 A
1260 V
(21529)210 648 A
1350 V
(21530)210 648 A
1440 V
(21531)210 648 A
(/*===========================================================================*)3276 1026 A
1530 V
(21532)210 648 A
1068(*)S
(get_inode)378 2370 A
4260(*)S
1620 V
(21533)210 648 A
(*===========================================================================*/)3276 1068 A
1710 V
(21534)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(inode)210 1614 A
(*get_inode\(dev,)630 1866 A
(numb\))210 2538 A
1800 V
(21535)210 648 A
(dev_t)210 1026 A
(dev;)168 1278 A
2370(/*)S
(device)252 2496 A
2790(on)S
(which)210 2916 A
(inode)210 3168 A
(resides)294 3420 A
3756(*/)S
1890 V
(21536)210 648 A
(int)126 1026 A
(numb;)210 1194 A
2370(/*)S
(inode)210 2496 A
(number)252 2748 A
(\(ANSI:)252 3042 A
(may)126 3336 A
(not)126 3504 A
3672(be)S
(unshort\))336 3798 A
4176(*/)S
1980 V
(21537)210 648 A
1026({)S
2070 V
(21538)210 648 A
1026(/*)S
(Find)168 1152 A
1362(a)S
(slot)168 1446 A
1656(in)S
(the)126 1782 A
(inode)210 1950 A
(table,)252 2202 A
(load)168 2496 A
(the)126 2706 A
(specified)378 2874 A
(inode)210 3294 A
(into)168 3546 A
(it,)126 3756 A
(and)126 3924 A
2160 V
(21539)210 648 A
1068(*)S
(return)252 1152 A
1446(a)S
(pointer)294 1530 A
1866(to)S
(the)126 1992 A
(slot.)210 2160 A
2454(If)S
('dev')210 2580 A
2832(==)S
(NO_DEV,)294 2958 A
(just)168 3294 A
(return)252 3504 A
3798(a)S
(free)168 3882 A
(slot.)210 4092 A
2250 V
(21540)210 648 A
1068(*/)S
2340 V
(21541)210 648 A
2430 V
(21542)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip,)210 2034 A
(*xp;)168 2286 A
2520 V
(21543)210 648 A
2610 V
(21544)210 648 A
1110(/*)S
(Search)252 1236 A
(the)126 1530 A
(inode)210 1698 A
(table)210 1950 A
(both)168 2202 A
(for)126 2412 A
(\(dev,)210 2580 A
(numb\))210 2832 A
(and)126 3084 A
3252(a)S
(free)168 3336 A
(slot.)210 3546 A
3798(*/)S
2700 V
(21545)210 648 A
1110(xp)S
1236(=)S
(NIL_INODE;)420 1320 A
2790 V
(21546)210 648 A
(for)126 1110 A
(\(rip)168 1278 A
1488(=)S
(&inode[0];)420 1572 A
(rip)126 2034 A
2202(<)S
(&inode[NR_INODES];)756 2286 A
(rip++\))252 3084 A
3378({)S
2880 V
(21547)210 648 A
1362(if)S
(\(rip->i_count)546 1488 A
2076(>)S
2160(0\))S
2286({)S
2370(/*)S
(only)168 2496 A
(check)210 2706 A
(used)168 2958 A
(slots)210 3168 A
(for)126 3420 A
(\(dev,)210 3588 A
(numb\))210 3840 A
4092(*/)S
2970 V
(21548)210 648 A
1698(if)S
(\(rip->i_dev)462 1824 A
2328(==)S
(dev)126 2454 A
2622(&&)S
(rip->i_num)420 2748 A
3210(==)S
(numb\))210 3336 A
3588({)S
3060 V
(21549)210 648 A
2034(/*)S
(This)168 2160 A
2370(is)S
(the)126 2496 A
(inode)210 2664 A
(that)168 2916 A
3126(we)S
(are)126 3252 A
(looking)294 3420 A
(for.)168 3756 A
3966(*/)S
3150 V
(21550)210 648 A
(rip->i_count++;)630 2034 A
3240 V
(21551)210 648 A
(return\(rip\);)504 2034 A
2706(/*)S
(\(dev,)210 2832 A
(numb\))210 3084 A
(found)210 3336 A
3588(*/)S
3330 V
(21552)210 648 A
1698(})S
3420 V
(21553)210 648 A
1362(})S
(else)168 1446 A
1656({)S
3510 V
(21554)210 648 A
1698(xp)S
1824(=)S
(rip;)168 1908 A
2370(/*)S
(remember)336 2496 A
(this)168 2874 A
(free)168 3084 A
(slot)168 3294 A
(for)126 3504 A
(later)210 3672 A
3924(*/)S
3600 V
(21555)210 648 A
1362(})S
3690 V
(21556)210 648 A
1110(})S
3780 V
(21557)210 648 A
3870 V
(21558)210 648 A
1110(/*)S
(Inode)210 1236 A
1488(we)S
(want)168 1614 A
1824(is)S
(not)126 1950 A
(currently)378 2118 A
2538(in)S
(use.)168 2664 A
(Did)126 2916 A
3084(we)S
(find)168 3210 A
3420(a)S
(free)168 3504 A
(slot?)210 3714 A
3966(*/)S
3960 V
(21559)210 648 A
1110(if)S
(\(xp)126 1236 A
1404(==)S
(NIL_INODE\))420 1530 A
1992({)S
2370(/*)S
(inode)210 2496 A
(table)210 2748 A
(completely)420 3000 A
(full)168 3462 A
3672(*/)S
4050 V
(21560)210 648 A
(err_code)336 1362 A
1740(=)S
(ENFILE;)294 1824 A
4140 V
(21561)210 648 A
(return\(NIL_INODE\);)756 1362 A
4230 V
(21562)210 648 A
1110(})S
4320 V
(21563)210 648 A
4410 V
(21564)210 648 A
1110(/*)S
1236(A)S
(free)168 1320 A
(inode)210 1530 A
(slot)168 1782 A
(has)126 1992 A
(been)168 2160 A
(located.)336 2370 A
(Load)168 2790 A
(the)126 3000 A
(inode)210 3168 A
(into)168 3420 A
(it.)126 3630 A
3798(*/)S
4500 V
(21565)210 648 A
(xp->i_dev)378 1110 A
1530(=)S
(dev;)168 1614 A
4590 V
(21566)210 648 A
(xp->i_num)378 1110 A
1530(=)S
(numb;)210 1614 A
4680 V
(21567)210 648 A
(xp->i_count)462 1110 A
1614(=)S
1698(1;)S
4770 V
(21568)210 648 A
1110(if)S
(\(dev)168 1236 A
1446(!=)S
(NO_DEV\))294 1572 A
(rw_inode\(xp,)504 1908 A
(READING\);)378 2454 A
3042(/*)S
(get)126 3168 A
(inode)210 3336 A
(from)168 3588 A
(disk)168 3798 A
4008(*/)S
4860 V
(21569)210 648 A
(xp->i_update)504 1110 A
1656(=)S
1740(0;)S
2370(/*)S
(all)126 2496 A
(the)126 2664 A
(times)210 2832 A
(are)126 3084 A
(initially)378 3252 A
(up-to-date)420 3672 A
4134(*/)S
4950 V
(21570)210 648 A
5040 V
(21571)210 648 A
(return\(xp\);)462 1110 A
5130 V
(21572)210 648 A
1026(})S
5400 V
(21575)210 648 A
(/*===========================================================================*)3276 1026 A
5490 V
(21576)210 648 A
1068(*)S
(put_inode)378 2370 A
4260(*)S
5580 V
(21577)210 648 A
(*===========================================================================*/)3276 1068 A
5670 V
(21578)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(put_inode\(rip\))588 1530 A
5760 V
(21579)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
3210(to)S
3336(be)S
(released)336 3462 A
3840(*/)S
5850 V
(21580)210 648 A
1026({)S
5940 V
(21581)210 648 A
1026(/*)S
(The)126 1152 A
(caller)252 1320 A
1614(is)S
1740(no)S
(longer)252 1866 A
(using)210 2160 A
(this)168 2412 A
(inode.)252 2622 A
2958(If)S
3084(no)S
(one)126 3210 A
(else)168 3378 A
3588(is)S
(using)210 3714 A
3966(it)S
(either)252 4092 A
6030 V
(21582)210 648 A
1068(*)S
(write)210 1152 A
1404(it)S
(back)168 1530 A
1740(to)S
(the)126 1866 A
(disk)168 2034 A
(immediately.)504 2244 A
2832(If)S
2958(it)S
(has)126 3084 A
3252(no)S
(links,)252 3378 A
(truncate)336 3672 A
4050(it)S
(and)126 4176 A
6120 V
(21583)210 648 A
1068(*)S
(return)252 1152 A
1446(it)S
1572(to)S
(the)126 1698 A
(pool)168 1866 A
2076(of)S
(available)378 2202 A
(inodes.)294 2622 A
6210 V
(21584)210 648 A
1068(*/)S
8418 V
EP
%%Page: 292 292
BP
/slant 0 def
/height 0 def
630 V
12 B
(292)180 648 A
11 R
2123(File:)S
(src/fs/inode.c)596 2356 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(21585)210 648 A
990 V
(21586)210 648 A
1110(if)S
(\(rip)168 1236 A
1446(==)S
(NIL_INODE\))420 1572 A
(return;)294 2034 A
2370(/*)S
(checking)336 2496 A
(here)168 2874 A
3084(is)S
(easier)252 3210 A
(than)168 3504 A
3714(in)S
(caller)252 3840 A
4134(*/)S
1080 V
(21587)210 648 A
1110(if)S
(\(--rip->i_count)630 1236 A
1908(==)S
2034(0\))S
2160({)S
2370(/*)S
(i_count)294 2496 A
2832(==)S
2958(0)S
(means)210 3042 A
3294(no)S
(one)126 3420 A
3588(is)S
(using)210 3714 A
3966(it)S
(now)126 4092 A
4260(*/)S
1170 V
(21588)210 648 A
1362(if)S
(\(\(rip->i_nlinks)630 1488 A
2160(&)S
(BYTE\))210 2244 A
2496(==)S
2622(0\))S
2748({)S
1260 V
(21589)210 648 A
1698(/*)S
(i_nlinks)336 1824 A
2202(==)S
2328(0)S
(means)210 2412 A
(free)168 2664 A
(the)126 2874 A
(inode.)252 3042 A
3336(*/)S
1350 V
(21590)210 648 A
(truncate\(rip\);)588 1698 A
2370(/*)S
(return)252 2496 A
(all)126 2790 A
(the)126 2958 A
(disk)168 3126 A
(blocks)252 3336 A
3630(*/)S
1440 V
(21591)210 648 A
(rip->i_mode)462 1698 A
2202(=)S
(I_NOT_ALLOC;)504 2286 A
3042(/*)S
(clear)210 3168 A
(I_TYPE)252 3420 A
(field)210 3714 A
3966(*/)S
1530 V
(21592)210 648 A
(rip->i_dirt)462 1698 A
2202(=)S
(DIRTY;)252 2286 A
1620 V
(21593)210 648 A
(free_inode\(rip->i_dev,)924 1698 A
(rip->i_num\);)504 2664 A
1710 V
(21594)210 648 A
1362(})S
(else)168 1446 A
1656({)S
1800 V
(21595)210 648 A
1698(if)S
(\(rip->i_pipe)504 1824 A
2370(==)S
(I_PIPE\))294 2496 A
(truncate\(rip\);)588 2832 A
1890 V
(21596)210 648 A
1362(})S
1980 V
(21597)210 648 A
(rip->i_pipe)462 1362 A
1866(=)S
(NO_PIPE;)336 1950 A
2370(/*)S
(should)252 2496 A
(always)252 2790 A
3084(be)S
(cleared)294 3210 A
3546(*/)S
2070 V
(21598)210 648 A
1362(if)S
(\(rip->i_dirt)504 1488 A
2034(==)S
(DIRTY\))252 2160 A
(rw_inode\(rip,)546 2454 A
(WRITING\);)378 3042 A
2160 V
(21599)210 648 A
1110(})S
2250 V
(21600)210 648 A
1026(})S
2430 V
(21602)210 648 A
(/*===========================================================================*)3276 1026 A
2520 V
(21603)210 648 A
1068(*)S
(alloc_inode)462 2370 A
4260(*)S
2610 V
(21604)210 648 A
(*===========================================================================*/)3276 1068 A
2700 V
(21605)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(inode)210 1614 A
(*alloc_inode\(dev,)714 1866 A
(bits\))210 2622 A
2790 V
(21606)210 648 A
(dev_t)210 1026 A
(dev;)168 1278 A
2370(/*)S
(device)252 2496 A
2790(on)S
(which)210 2916 A
3168(to)S
(allocate)336 3294 A
(the)126 3672 A
(inode)210 3840 A
4092(*/)S
2880 V
(21607)210 648 A
(mode_t)252 1026 A
(bits;)210 1320 A
2370(/*)S
(mode)168 2496 A
2706(of)S
(the)126 2832 A
(inode)210 3000 A
3252(*/)S
2970 V
(21608)210 648 A
1026({)S
3060 V
(21609)210 648 A
1026(/*)S
(Allocate)336 1152 A
1530(a)S
(free)168 1614 A
(inode)210 1824 A
2076(on)S
('dev',)252 2202 A
(and)126 2496 A
(return)252 2664 A
2958(a)S
(pointer)294 3042 A
3378(to)S
(it.)126 3504 A
3672(*/)S
3150 V
(21610)210 648 A
3240 V
(21611)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
3330 V
(21612)210 648 A
(register)336 1110 A
(struct)252 1488 A
(super_block)462 1782 A
(*sp;)168 2286 A
3420 V
(21613)210 648 A
(int)126 1110 A
(major,)252 1278 A
(minor,)252 1572 A
(inumb;)252 1866 A
3510 V
(21614)210 648 A
(bit_t)210 1110 A
1362(b;)S
3600 V
(21615)210 648 A
3690 V
(21616)210 648 A
1110(sp)S
1236(=)S
(get_super\(dev\);)630 1320 A
2034(/*)S
(get)126 2160 A
(pointer)294 2328 A
2664(to)S
(super_block)462 2790 A
3294(*/)S
3780 V
(21617)210 648 A
1110(if)S
(\(sp->s_rd_only\))630 1236 A
1908({)S
2034(/*)S
(can't)210 2160 A
(allocate)336 2412 A
2790(an)S
(inode)210 2916 A
3168(on)S
3294(a)S
(read)168 3378 A
(only)168 3588 A
(device.)294 3798 A
4134(*/)S
3870 V
(21618)210 648 A
(err_code)336 1362 A
1740(=)S
(EROFS;)252 1824 A
3960 V
(21619)210 648 A
(return\(NIL_INODE\);)756 1362 A
4050 V
(21620)210 648 A
1110(})S
4140 V
(21621)210 648 A
4230 V
(21622)210 648 A
1110(/*)S
(Acquire)294 1236 A
1572(an)S
(inode)210 1698 A
(from)168 1950 A
(the)126 2160 A
(bit)126 2328 A
(map.)168 2496 A
2706(*/)S
4320 V
(21623)210 648 A
1110(b)S
1194(=)S
(alloc_bit\(sp,)546 1278 A
(IMAP,)210 1866 A
(sp->s_isearch\);)630 2118 A
4410 V
(21624)210 648 A
1110(if)S
1236(\(b)S
1362(==)S
(NO_BIT\))294 1488 A
1824({)S
4500 V
(21625)210 648 A
(err_code)336 1362 A
1740(=)S
(ENFILE;)294 1824 A
4590 V
(21626)210 648 A
(major)210 1362 A
1614(=)S
(\(int\))210 1698 A
(\(sp->s_dev)420 1950 A
2412(>>)S
(MAJOR\))252 2538 A
2832(&)S
(BYTE;)210 2916 A
4680 V
(21627)210 648 A
(minor)210 1362 A
1614(=)S
(\(int\))210 1698 A
(\(sp->s_dev)420 1950 A
2412(>>)S
(MINOR\))252 2538 A
2832(&)S
(BYTE;)210 2916 A
4770 V
(21628)210 648 A
(printf\("Out)462 1362 A
1866(of)S
(i-nodes)294 1992 A
2328(on)S
(%sdevice)336 2454 A
(%d/%d\\n",)378 2832 A
4860 V
(21629)210 648 A
(sp->s_dev)378 1698 A
2118(==)S
(ROOT_DEV)336 2244 A
2622(?)S
("root)210 2706 A
2958(")S
3042(:)S
("",)126 3126 A
(major,)252 3294 A
(minor\);)294 3588 A
4950 V
(21630)210 648 A
(return\(NIL_INODE\);)756 1362 A
5040 V
(21631)210 648 A
1110(})S
5130 V
(21632)210 648 A
(sp->s_isearch)546 1110 A
1698(=)S
1782(b;)S
2370(/*)S
(next)168 2496 A
(time)168 2706 A
(start)210 2916 A
(here)168 3168 A
3378(*/)S
5220 V
(21633)210 648 A
(inumb)210 1110 A
1362(=)S
(\(int\))210 1446 A
1698(b;)S
2370(/*)S
2496(be)S
(careful)294 2622 A
(not)126 2958 A
3126(to)S
(pass)168 3252 A
(unshort)294 3462 A
3798(as)S
(param)210 3924 A
4176(*/)S
5310 V
(21634)210 648 A
5400 V
(21635)210 648 A
1110(/*)S
(Try)126 1236 A
1404(to)S
(acquire)294 1530 A
1866(a)S
(slot)168 1950 A
2160(in)S
(the)126 2286 A
(inode)210 2454 A
(table.)252 2706 A
3000(*/)S
5490 V
(21636)210 648 A
1110(if)S
(\(\(rip)210 1236 A
1488(=)S
(get_inode\(NO_DEV,)714 1572 A
(inumb\)\))294 2328 A
2664(==)S
(NIL_INODE\))420 2790 A
3252({)S
5580 V
(21637)210 648 A
1362(/*)S
1488(No)S
(inode)210 1614 A
(table)210 1866 A
(slots)210 2118 A
(available.)420 2370 A
(Free)168 2874 A
(the)126 3084 A
(inode)210 3252 A
(just)168 3504 A
(allocated.)420 3714 A
4176(*/)S
5670 V
(21638)210 648 A
(free_bit\(sp,)504 1362 A
(IMAP,)210 1908 A
(b\);)126 2160 A
5760 V
(21639)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5850 V
(21640)210 648 A
1362(/*)S
1488(An)S
(inode)210 1614 A
(slot)168 1866 A
2076(is)S
(available.)420 2202 A
(Put)126 2664 A
(the)126 2832 A
(inode)210 3000 A
(just)168 3252 A
(allocated)378 3462 A
(into)168 3882 A
(it.)126 4092 A
4260(*/)S
5940 V
(21641)210 648 A
(rip->i_mode)462 1362 A
1866(=)S
(bits;)210 1950 A
2706(/*)S
(set)126 2832 A
3000(up)S
(RWX)126 3126 A
(bits)168 3294 A
3504(*/)S
6030 V
(21642)210 648 A
(rip->i_nlinks)546 1362 A
1950(=)S
(\(nlink_t\))378 2034 A
2454(0;)S
2706(/*)S
(initial)294 2832 A
3168(no)S
(links)210 3294 A
3546(*/)S
6120 V
(21643)210 648 A
(rip->i_uid)420 1362 A
1824(=)S
(fp->fp_effuid;)588 1908 A
2706(/*)S
(file's)252 2832 A
(uid)126 3126 A
3294(is)S
(owner's)294 3420 A
3756(*/)S
6210 V
(21644)210 648 A
(rip->i_gid)420 1362 A
1824(=)S
(fp->fp_effgid;)588 1908 A
2706(/*)S
(ditto)210 2832 A
(group)210 3084 A
3336(id)S
3462(*/)S
8418 V
EP
%%Page: 293 293
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2123(File:)S
(src/fs/inode.c)596 2356 A
12 B
(293)180 4248 A
900 V
7 LST
(21645)210 648 A
(rip->i_dev)420 1362 A
1824(=)S
(dev;)168 1908 A
2706(/*)S
(mark)168 2832 A
(which)210 3042 A
(device)252 3294 A
3588(it)S
3714(is)S
3840(on)S
3966(*/)S
990 V
(21646)210 648 A
(rip->i_ndzones)588 1362 A
1992(=)S
(sp->s_ndzones;)588 2076 A
2706(/*)S
(number)252 2832 A
3126(of)S
(direct)252 3252 A
(zones)210 3546 A
3798(*/)S
1080 V
(21647)210 648 A
(rip->i_nindirs)588 1362 A
1992(=)S
(sp->s_nindirs;)588 2076 A
2706(/*)S
(number)252 2832 A
3126(of)S
(indirect)336 3252 A
(zones)210 3630 A
(per)126 3882 A
(blk*/)210 4050 A
1170 V
(21648)210 648 A
(rip->i_sp)378 1362 A
1782(=)S
(sp;)126 1866 A
2706(/*)S
(pointer)294 2832 A
3168(to)S
(super)210 3294 A
(block)210 3546 A
3798(*/)S
1260 V
(21649)210 648 A
1350 V
(21650)210 648 A
1362(/*)S
(Fields)252 1488 A
(not)126 1782 A
(cleared)294 1950 A
(already)294 2286 A
(are)126 2622 A
(cleared)294 2790 A
3126(in)S
(wipe_inode\(\).)546 3252 A
(They)168 3882 A
(have)168 4092 A
1440 V
(21651)210 648 A
1404(*)S
(been)168 1488 A
(put)126 1698 A
(there)210 1866 A
(because)294 2118 A
(truncate\(\))420 2454 A
(needs)210 2916 A
3168(to)S
(clear)210 3294 A
(the)126 3546 A
(same)168 3714 A
(fields)252 3924 A
4218(if)S
1530 V
(21652)210 648 A
1404(*)S
(the)126 1488 A
(file)168 1656 A
(happens)294 1866 A
2202(to)S
2328(be)S
(open)168 2454 A
(while)210 2664 A
(being)210 2916 A
(truncated.)420 3168 A
3672(It)S
(saves)210 3798 A
(space)210 4050 A
1620 V
(21653)210 648 A
1404(*)S
(not)126 1488 A
1656(to)S
(repeat)252 1782 A
(the)126 2076 A
(code)168 2244 A
(twice.)252 2454 A
1710 V
(21654)210 648 A
1404(*/)S
1800 V
(21655)210 648 A
(wipe_inode\(rip\);)672 1362 A
1890 V
(21656)210 648 A
1110(})S
1980 V
(21657)210 648 A
2070 V
(21658)210 648 A
(return\(rip\);)504 1110 A
2160 V
(21659)210 648 A
1026(})S
2340 V
(21661)210 648 A
(/*===========================================================================*)3276 1026 A
2430 V
(21662)210 648 A
1068(*)S
(wipe_inode)420 2370 A
4260(*)S
2520 V
(21663)210 648 A
(*===========================================================================*/)3276 1068 A
2610 V
(21664)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(wipe_inode\(rip\))630 1530 A
2700 V
(21665)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(the)126 2496 A
(inode)210 2664 A
2916(to)S
3042(be)S
(erased)252 3168 A
3462(*/)S
2790 V
(21666)210 648 A
1026({)S
2880 V
(21667)210 648 A
1026(/*)S
(Erase)210 1152 A
(some)168 1404 A
(fields)252 1614 A
1908(in)S
(the)126 2034 A
(inode.)252 2202 A
(This)168 2538 A
(function)336 2748 A
3126(is)S
(called)252 3252 A
(from)168 3546 A
(alloc_inode\(\))546 3756 A
2970 V
(21668)210 648 A
1068(*)S
(when)168 1152 A
1362(a)S
(new)126 1446 A
(inode)210 1614 A
1866(is)S
1992(to)S
2118(be)S
(allocated,)420 2244 A
(and)126 2706 A
(from)168 2874 A
(truncate\(\),)462 3084 A
(when)168 3588 A
3798(an)S
(existing)336 3924 A
3060 V
(21669)210 648 A
1068(*)S
(inode)210 1152 A
1404(is)S
1530(to)S
1656(be)S
(truncated.)420 1782 A
3150 V
(21670)210 648 A
1068(*/)S
3240 V
(21671)210 648 A
3330 V
(21672)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(i;)S
3420 V
(21673)210 648 A
3510 V
(21674)210 648 A
(rip->i_size)462 1110 A
1614(=)S
1698(0;)S
3600 V
(21675)210 648 A
(rip->i_update)546 1110 A
1698(=)S
(ATIME)210 1782 A
2034(|)S
(CTIME)210 2118 A
2370(|)S
(MTIME;)252 2454 A
3042(/*)S
(update)252 3168 A
(all)126 3462 A
(times)210 3630 A
(later)210 3882 A
4134(*/)S
3690 V
(21676)210 648 A
(rip->i_dirt)462 1110 A
1614(=)S
(DIRTY;)252 1698 A
3780 V
(21677)210 648 A
(for)126 1110 A
1278(\(i)S
1404(=)S
1488(0;)S
1614(i)S
1698(<)S
(V2_NR_TZONES;)546 1782 A
(i++\))168 2370 A
(rip->i_zone[i])588 2580 A
3210(=)S
(NO_ZONE;)336 3294 A
3870 V
(21678)210 648 A
1026(})S
4140 V
(21681)210 648 A
(/*===========================================================================*)3276 1026 A
4230 V
(21682)210 648 A
1068(*)S
(free_inode)420 2370 A
4260(*)S
4320 V
(21683)210 648 A
(*===========================================================================*/)3276 1068 A
4410 V
(21684)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(free_inode\(dev,)630 1530 A
(inumb\))252 2202 A
4500 V
(21685)210 648 A
(dev_t)210 1026 A
(dev;)168 1278 A
2370(/*)S
2496(on)S
(which)210 2622 A
(device)252 2874 A
3168(is)S
(the)126 3294 A
(inode)210 3462 A
3714(*/)S
4590 V
(21686)210 648 A
(ino_t)210 1026 A
(inumb;)252 1278 A
2370(/*)S
(number)252 2496 A
2790(of)S
(inode)210 2916 A
3168(to)S
3294(be)S
(freed)210 3420 A
3672(*/)S
4680 V
(21687)210 648 A
1026({)S
4770 V
(21688)210 648 A
1026(/*)S
(Return)252 1152 A
1446(an)S
(inode)210 1572 A
1824(to)S
(the)126 1950 A
(pool)168 2118 A
2328(of)S
(unallocated)462 2454 A
(inodes.)294 2958 A
3294(*/)S
4860 V
(21689)210 648 A
4950 V
(21690)210 648 A
(register)336 1110 A
(struct)252 1488 A
(super_block)462 1782 A
(*sp;)168 2286 A
5040 V
(21691)210 648 A
(bit_t)210 1110 A
1362(b;)S
5130 V
(21692)210 648 A
5220 V
(21693)210 648 A
1110(/*)S
(Locate)252 1236 A
(the)126 1530 A
(appropriate)462 1698 A
(super_block.)504 2202 A
2748(*/)S
5310 V
(21694)210 648 A
1110(sp)S
1236(=)S
(get_super\(dev\);)630 1320 A
5400 V
(21695)210 648 A
1110(if)S
(\(inumb)252 1236 A
1530(<=)S
1656(0)S
1740(||)S
(inumb)210 1866 A
2118(>)S
(sp->s_ninodes\))588 2202 A
(return;)294 2832 A
5490 V
(21696)210 648 A
1110(b)S
1194(=)S
(inumb;)252 1278 A
5580 V
(21697)210 648 A
(free_bit\(sp,)504 1110 A
(IMAP,)210 1656 A
(b\);)126 1908 A
5670 V
(21698)210 648 A
1110(if)S
1236(\(b)S
1362(<)S
(sp->s_isearch\))588 1446 A
(sp->s_isearch)546 2076 A
2664(=)S
2748(b;)S
5760 V
(21699)210 648 A
1026(})S
5940 V
(21701)210 648 A
(/*===========================================================================*)3276 1026 A
6030 V
(21702)210 648 A
1068(*)S
(update_times)504 2370 A
4260(*)S
6120 V
(21703)210 648 A
(*===========================================================================*/)3276 1068 A
6210 V
(21704)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(update_times\(rip\))714 1530 A
8418 V
EP
%%Page: 294 294
BP
/slant 0 def
/height 0 def
630 V
12 B
(294)180 648 A
11 R
2123(File:)S
(src/fs/inode.c)596 2356 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(21705)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
3210(to)S
3336(be)S
(read/written)504 3462 A
4008(*/)S
990 V
(21706)210 648 A
1026({)S
1080 V
(21707)210 648 A
1026(/*)S
(Various)294 1152 A
(system)252 1488 A
(calls)210 1782 A
(are)126 2034 A
(required)336 2202 A
2580(by)S
(the)126 2706 A
(standard)336 2874 A
3252(to)S
(update)252 3378 A
(atime,)252 3672 A
(ctime,)252 3966 A
1170 V
(21708)210 648 A
1068(*)S
1152(or)S
(mtime.)252 1278 A
(Since)210 1614 A
(updating)336 1866 A
2244(a)S
(time)168 2328 A
(requires)336 2538 A
(sending)294 2916 A
3252(a)S
(message)294 3336 A
3672(to)S
(the)126 3798 A
(clock)210 3966 A
1260 V
(21709)210 648 A
1068(*)S
(task--an)336 1152 A
(expensive)378 1530 A
(business--the)546 1950 A
(times)210 2538 A
(are)126 2790 A
(marked)252 2958 A
(for)126 3252 A
(update)252 3420 A
3714(by)S
(setting)294 3840 A
1350 V
(21710)210 648 A
1068(*)S
(bits)168 1152 A
1362(in)S
(i_update.)378 1488 A
(When)168 1950 A
2160(a)S
(stat,)210 2244 A
(fstat,)252 2496 A
2790(or)S
(sync)168 2916 A
3126(is)S
(done,)210 3252 A
3504(or)S
3630(an)S
(inode)210 3756 A
4008(is)S
1440 V
(21711)210 648 A
1068(*)S
(released,)378 1152 A
(update_times\(\))588 1572 A
(may)126 2202 A
2370(be)S
(called)252 2496 A
2790(to)S
(actually)336 2916 A
(fill)168 3294 A
3504(in)S
(the)126 3630 A
(times.)252 3798 A
1530 V
(21712)210 648 A
1068(*/)S
1620 V
(21713)210 648 A
1710 V
(21714)210 648 A
(time_t)252 1110 A
(cur_time;)378 1404 A
1800 V
(21715)210 648 A
(struct)252 1110 A
(super_block)462 1404 A
(*sp;)168 1908 A
1890 V
(21716)210 648 A
1980 V
(21717)210 648 A
1110(sp)S
1236(=)S
(rip->i_sp;)420 1320 A
2370(/*)S
(get)126 2496 A
(pointer)294 2664 A
3000(to)S
(super)210 3126 A
(block.)252 3378 A
3672(*/)S
2070 V
(21718)210 648 A
1110(if)S
(\(sp->s_rd_only\))630 1236 A
(return;)294 1908 A
2370(/*)S
2496(no)S
(updates)294 2622 A
(for)126 2958 A
(read-only)378 3126 A
(file)168 3546 A
(systems)294 3756 A
4092(*/)S
2160 V
(21719)210 648 A
2250 V
(21720)210 648 A
(cur_time)336 1110 A
1488(=)S
(clock_time\(\);)546 1572 A
2340 V
(21721)210 648 A
1110(if)S
(\(rip->i_update)588 1236 A
1866(&)S
(ATIME\))252 1950 A
(rip->i_atime)504 2244 A
2790(=)S
(cur_time;)378 2874 A
2430 V
(21722)210 648 A
1110(if)S
(\(rip->i_update)588 1236 A
1866(&)S
(CTIME\))252 1950 A
(rip->i_ctime)504 2244 A
2790(=)S
(cur_time;)378 2874 A
2520 V
(21723)210 648 A
1110(if)S
(\(rip->i_update)588 1236 A
1866(&)S
(MTIME\))252 1950 A
(rip->i_mtime)504 2244 A
2790(=)S
(cur_time;)378 2874 A
2610 V
(21724)210 648 A
(rip->i_update)546 1110 A
1698(=)S
1782(0;)S
2370(/*)S
(they)168 2496 A
(are)126 2706 A
(all)126 2874 A
(up-to-date)420 3042 A
(now)126 3504 A
3672(*/)S
2700 V
(21725)210 648 A
1026(})S
2970 V
(21728)210 648 A
(/*===========================================================================*)3276 1026 A
3060 V
(21729)210 648 A
1068(*)S
(rw_inode)336 2370 A
4260(*)S
3150 V
(21730)210 648 A
(*===========================================================================*/)3276 1068 A
3240 V
(21731)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(rw_inode\(rip,)546 1530 A
(rw_flag\))336 2118 A
3330 V
(21732)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
3210(to)S
3336(be)S
(read/written)504 3462 A
4008(*/)S
3420 V
(21733)210 648 A
(int)126 1026 A
(rw_flag;)336 1194 A
2370(/*)S
(READING)294 2496 A
2832(or)S
(WRITING)294 2958 A
3294(*/)S
3510 V
(21734)210 648 A
1026({)S
3600 V
(21735)210 648 A
1026(/*)S
1152(An)S
(entry)210 1278 A
1530(in)S
(the)126 1656 A
(inode)210 1824 A
(table)210 2076 A
2328(is)S
2454(to)S
2580(be)S
(copied)252 2706 A
3000(to)S
3126(or)S
(from)168 3252 A
(the)126 3462 A
(disk.)210 3630 A
3882(*/)S
3690 V
(21736)210 648 A
3780 V
(21737)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp;)168 1950 A
3870 V
(21738)210 648 A
(register)336 1110 A
(struct)252 1488 A
(super_block)462 1782 A
(*sp;)168 2286 A
3960 V
(21739)210 648 A
(d1_inode)336 1110 A
(*dip;)210 1488 A
4050 V
(21740)210 648 A
(d2_inode)336 1110 A
(*dip2;)252 1488 A
4140 V
(21741)210 648 A
(block_t)294 1110 A
1446(b,)S
(offset;)294 1572 A
4230 V
(21742)210 648 A
4320 V
(21743)210 648 A
1110(/*)S
(Get)126 1236 A
(the)126 1404 A
(block)210 1572 A
(where)210 1824 A
(the)126 2076 A
(inode)210 2244 A
(resides.)336 2496 A
2874(*/)S
4410 V
(21744)210 648 A
1110(sp)S
1236(=)S
(get_super\(rip->i_dev\);)924 1320 A
2370(/*)S
(get)126 2496 A
(pointer)294 2664 A
3000(to)S
(super)210 3126 A
(block)210 3378 A
3630(*/)S
4500 V
(21745)210 648 A
(rip->i_sp)378 1110 A
1530(=)S
(sp;)126 1614 A
2370(/*)S
(inode)210 2496 A
(must)168 2748 A
(contain)294 2958 A
(super)210 3294 A
(block)210 3546 A
(pointer)294 3798 A
4134(*/)S
4590 V
(21746)210 648 A
(offset)252 1110 A
1404(=)S
(sp->s_imap_blocks)714 1488 A
2244(+)S
(sp->s_zmap_blocks)714 2328 A
3084(+)S
3168(2;)S
4680 V
(21747)210 648 A
1110(b)S
1194(=)S
(\(block_t\))378 1278 A
(\(rip->i_num)462 1698 A
2202(-)S
(1\)/sp->s_inodes_per_block)1050 2286 A
3378(+)S
(offset;)294 3462 A
4770 V
(21748)210 648 A
1110(bp)S
1236(=)S
(get_block\(rip->i_dev,)882 1320 A
2244(b,)S
(NORMAL\);)336 2370 A
4860 V
(21749)210 648 A
(dip)126 1110 A
1320(=)S
(bp->b_v1_ino)504 1404 A
1950(+)S
(\(rip->i_num)462 2034 A
2538(-)S
2622(1\))S
2748(%)S
(V1_INODES_PER_BLOCK;)840 2832 A
4950 V
(21750)210 648 A
(dip2)168 1110 A
1320(=)S
(bp->b_v2_ino)504 1404 A
1950(+)S
(\(rip->i_num)462 2034 A
2538(-)S
2622(1\))S
2748(%)S
(V2_INODES_PER_BLOCK;)840 2832 A
5040 V
(21751)210 648 A
5130 V
(21752)210 648 A
1110(/*)S
1236(Do)S
(the)126 1362 A
(read)168 1530 A
1740(or)S
(write.)252 1866 A
2160(*/)S
5220 V
(21753)210 648 A
1110(if)S
(\(rw_flag)336 1236 A
1614(==)S
(WRITING\))336 1740 A
2118({)S
5310 V
(21754)210 648 A
1362(if)S
(\(rip->i_update\))630 1488 A
(update_times\(rip\);)756 2160 A
3042(/*)S
(times)210 3168 A
(need)168 3420 A
(updating)336 3630 A
4008(*/)S
5400 V
(21755)210 648 A
1362(if)S
(\(sp->s_rd_only)588 1488 A
2118(==)S
(FALSE\))252 2244 A
(bp->b_dirt)420 2538 A
3000(=)S
(DIRTY;)252 3084 A
5490 V
(21756)210 648 A
1110(})S
5580 V
(21757)210 648 A
5670 V
(21758)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(inode)210 1614 A
(from)168 1866 A
(the)126 2076 A
(disk)168 2244 A
(block)210 2454 A
2706(to)S
(the)126 2832 A
(in-core)294 3000 A
(table)210 3336 A
3588(or)S
(vice)168 3714 A
(versa.)252 3924 A
5760 V
(21759)210 648 A
1152(*)S
1236(If)S
(the)126 1362 A
(fourth)252 1530 A
(parameter)378 1824 A
(below)210 2244 A
2496(is)S
(FALSE,)252 2622 A
(the)126 2916 A
(bytes)210 3084 A
(are)126 3336 A
(swapped.)336 3504 A
5850 V
(21760)210 648 A
1152(*/)S
5940 V
(21761)210 648 A
1110(if)S
(\(sp->s_version)588 1236 A
1866(==)S
(V1\))126 1992 A
6030 V
(21762)210 648 A
(old_icopy\(rip,)588 1362 A
(dip,)168 1992 A
(rw_flag,)336 2244 A
(sp->s_native\);)588 2622 A
6120 V
(21763)210 648 A
(else)168 1110 A
6210 V
(21764)210 648 A
(new_icopy\(rip,)588 1362 A
(dip2,)210 1992 A
(rw_flag,)336 2244 A
(sp->s_native\);)588 2622 A
8418 V
EP
%%Page: 295 295
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2123(File:)S
(src/fs/inode.c)596 2356 A
12 B
(295)180 4248 A
900 V
7 LST
(21765)210 648 A
990 V
(21766)210 648 A
(put_block\(bp,)546 1110 A
(INODE_BLOCK\);)546 1698 A
1080 V
(21767)210 648 A
(rip->i_dirt)462 1110 A
1614(=)S
(CLEAN;)252 1698 A
1170 V
(21768)210 648 A
1026(})S
1440 V
(21771)210 648 A
(/*===========================================================================*)3276 1026 A
1530 V
(21772)210 648 A
1068(*)S
(old_icopy)378 2370 A
4260(*)S
1620 V
(21773)210 648 A
(*===========================================================================*/)3276 1068 A
1710 V
(21774)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(old_icopy\(rip,)588 1572 A
(dip,)168 2202 A
(direction,)420 2412 A
(norm\))210 2874 A
1800 V
(21775)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(the)126 2958 A
(in-core)294 3126 A
(inode)210 3462 A
(struct)252 3714 A
4008(*/)S
1890 V
(21776)210 648 A
(register)336 1026 A
(d1_inode)336 1404 A
(*dip;)210 1782 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(the)126 2958 A
(d1_inode)336 3126 A
(inode)210 3504 A
(struct)252 3756 A
4050(*/)S
1980 V
(21777)210 648 A
(int)126 1026 A
(direction;)420 1194 A
2370(/*)S
(READING)294 2496 A
(\(from)210 2832 A
(disk\))210 3084 A
3336(or)S
(WRITING)294 3462 A
(\(to)126 3798 A
(disk\))210 3966 A
4218(*/)S
2070 V
(21778)210 648 A
(int)126 1026 A
(norm;)210 1194 A
2370(/*)S
(TRUE)168 2496 A
2706(=)S
2790(do)S
(not)126 2916 A
(swap)168 3084 A
(bytes;)252 3294 A
(FALSE)210 3588 A
3840(=)S
(swap)168 3924 A
4134(*/)S
2160 V
(21779)210 648 A
2250 V
(21780)210 648 A
1026({)S
2340 V
(21781)210 648 A
1026(/*)S
(The)126 1152 A
(V1.x)168 1320 A
(IBM)126 1530 A
(disk,)210 1698 A
(the)126 1950 A
(V1.x)168 2118 A
(68000)210 2328 A
(disk,)210 2580 A
(and)126 2832 A
(the)126 3000 A
3168(V2)S
(disk)168 3294 A
(\(same)210 3504 A
(for)126 3756 A
(IBM)126 3924 A
(and)126 4092 A
2430 V
(21782)210 648 A
1068(*)S
(68000\))252 1152 A
(all)126 1446 A
(have)168 1614 A
(different)378 1824 A
(inode)210 2244 A
(layouts.)336 2496 A
(When)168 2916 A
3126(an)S
(inode)210 3252 A
3504(is)S
(read)168 3630 A
3840(or)S
(written)294 3966 A
2520 V
(21783)210 648 A
1068(*)S
(this)168 1152 A
(routine)294 1362 A
(handles)294 1698 A
(the)126 2034 A
(conversions)462 2202 A
2706(so)S
(that)168 2832 A
(the)126 3042 A
(information)462 3210 A
3714(in)S
(the)126 3840 A
(inode)210 4008 A
2610 V
(21784)210 648 A
1068(*)S
(table)210 1152 A
1404(is)S
(independent)462 1530 A
2034(of)S
(the)126 2160 A
(disk)168 2328 A
(structure)378 2538 A
(from)168 2958 A
(which)210 3168 A
(the)126 3420 A
(inode)210 3588 A
(came.)210 3840 A
2700 V
(21785)210 648 A
1068(*)S
(The)126 1152 A
(old_icopy)378 1320 A
(routine)294 1740 A
(copies)252 2076 A
2370(to)S
(and)126 2496 A
(from)168 2664 A
2874(V1)S
(disks.)252 3000 A
2790 V
(21786)210 648 A
1068(*/)S
2880 V
(21787)210 648 A
2970 V
(21788)210 648 A
(int)126 1110 A
1278(i;)S
3060 V
(21789)210 648 A
3150 V
(21790)210 648 A
1110(if)S
(\(direction)420 1236 A
1698(==)S
(READING\))336 1824 A
2202({)S
3240 V
(21791)210 648 A
1362(/*)S
(Copy)168 1488 A
(V1.x)168 1698 A
(inode)210 1908 A
2160(to)S
(the)126 2286 A
(in-core)294 2454 A
(table,)252 2790 A
(swapping)336 3084 A
(bytes)210 3462 A
3714(if)S
(need)168 3840 A
(be.)126 4050 A
4218(*/)S
3330 V
(21792)210 648 A
(rip->i_mode)462 1362 A
1992(=)S
(conv2\(norm,)462 2076 A
(\(int\))210 2580 A
(dip->d1_mode\);)588 2832 A
3420 V
(21793)210 648 A
(rip->i_uid)420 1362 A
1992(=)S
(conv2\(norm,)462 2076 A
(\(int\))210 2580 A
(dip->d1_uid)462 2832 A
3336(\);)S
3510 V
(21794)210 648 A
(rip->i_size)462 1362 A
1992(=)S
(conv4\(norm,)462 2076 A
(dip->d1_size\);)588 2832 A
3600 V
(21795)210 648 A
(rip->i_mtime)504 1362 A
1992(=)S
(conv4\(norm,)462 2076 A
(dip->d1_mtime\);)630 2832 A
3690 V
(21796)210 648 A
(rip->i_atime)504 1362 A
1992(=)S
(rip->i_mtime;)546 2076 A
3780 V
(21797)210 648 A
(rip->i_ctime)504 1362 A
1992(=)S
(rip->i_mtime;)546 2076 A
3870 V
(21798)210 648 A
(rip->i_nlinks)546 1362 A
1992(=)S
(\(nlink_t\))378 2076 A
(dip->d1_nlinks;)630 2496 A
3378(/*)S
3504(1)S
(char)168 3588 A
3798(*/)S
3960 V
(21799)210 648 A
(rip->i_gid)420 1362 A
1992(=)S
(\(gid_t\))294 2076 A
(dip->d1_gid;)504 2412 A
3378(/*)S
3504(1)S
(char)168 3588 A
3798(*/)S
4050 V
(21800)210 648 A
(rip->i_ndzones)588 1362 A
1992(=)S
(V1_NR_DZONES;)546 2076 A
4140 V
(21801)210 648 A
(rip->i_nindirs)588 1362 A
1992(=)S
(V1_INDIRECTS;)546 2076 A
4230 V
(21802)210 648 A
(for)126 1362 A
1530(\(i)S
1656(=)S
1740(0;)S
1866(i)S
1950(<)S
(V1_NR_TZONES;)546 2034 A
(i++\))168 2622 A
4320 V
(21803)210 648 A
(rip->i_zone[i])588 1698 A
2328(=)S
(conv2\(norm,)462 2412 A
(\(int\))210 2916 A
(dip->d1_zone[i]\);)714 3168 A
4410 V
(21804)210 648 A
1110(})S
(else)168 1194 A
1404({)S
4500 V
(21805)210 648 A
1362(/*)S
(Copying)294 1488 A
(V1.x)168 1824 A
(inode)210 2034 A
2286(to)S
(disk)168 2412 A
(from)168 2622 A
(the)126 2832 A
(in-core)294 3000 A
(table.)252 3336 A
3630(*/)S
4590 V
(21806)210 648 A
(dip->d1_mode)504 1362 A
1992(=)S
(conv2\(norm,)462 2076 A
(\(int\))210 2580 A
(rip->i_mode\);)546 2832 A
4680 V
(21807)210 648 A
(dip->d1_uid)462 1362 A
1992(=)S
(conv2\(norm,)462 2076 A
(\(int\))210 2580 A
(rip->i_uid)420 2832 A
3294(\);)S
4770 V
(21808)210 648 A
(dip->d1_size)504 1362 A
1992(=)S
(conv4\(norm,)462 2076 A
(rip->i_size\);)546 2832 A
4860 V
(21809)210 648 A
(dip->d1_mtime)546 1362 A
1992(=)S
(conv4\(norm,)462 2076 A
(rip->i_mtime\);)588 2832 A
4950 V
(21810)210 648 A
(dip->d1_nlinks)588 1362 A
1992(=)S
(\(nlink_t\))378 2076 A
(rip->i_nlinks;)588 2496 A
3378(/*)S
3504(1)S
(char)168 3588 A
3798(*/)S
5040 V
(21811)210 648 A
(dip->d1_gid)462 1362 A
1992(=)S
(\(gid_t\))294 2076 A
(rip->i_gid;)462 2412 A
3378(/*)S
3504(1)S
(char)168 3588 A
3798(*/)S
5130 V
(21812)210 648 A
(for)126 1362 A
1530(\(i)S
1656(=)S
1740(0;)S
1866(i)S
1950(<)S
(V1_NR_TZONES;)546 2034 A
(i++\))168 2622 A
5220 V
(21813)210 648 A
(dip->d1_zone[i])630 1698 A
2370(=)S
(conv2\(norm,)462 2454 A
(\(int\))210 2958 A
(rip->i_zone[i]\);)672 3210 A
5310 V
(21814)210 648 A
1110(})S
5400 V
(21815)210 648 A
1026(})S
5670 V
(21818)210 648 A
(/*===========================================================================*)3276 1026 A
5760 V
(21819)210 648 A
1068(*)S
(new_icopy)378 2370 A
4260(*)S
5850 V
(21820)210 648 A
(*===========================================================================*/)3276 1068 A
5940 V
(21821)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(new_icopy\(rip,)588 1572 A
(dip,)168 2202 A
(direction,)420 2412 A
(norm\))210 2874 A
6030 V
(21822)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(the)126 2958 A
(in-core)294 3126 A
(inode)210 3462 A
(struct)252 3714 A
4008(*/)S
6120 V
(21823)210 648 A
(register)336 1026 A
(d2_inode)336 1404 A
(*dip;)210 1782 A
2034(/*)S
(pointer)294 2160 A
2496(to)S
(the)126 2622 A
(d2_inode)336 2790 A
(struct)252 3168 A
3462(*/)S
6210 V
(21824)210 648 A
(int)126 1026 A
(direction;)420 1194 A
2370(/*)S
(READING)294 2496 A
(\(from)210 2832 A
(disk\))210 3084 A
3336(or)S
(WRITING)294 3462 A
(\(to)126 3798 A
(disk\))210 3966 A
4218(*/)S
8418 V
EP
%%Page: 296 296
BP
/slant 0 def
/height 0 def
630 V
12 B
(296)180 648 A
11 R
2123(File:)S
(src/fs/inode.c)596 2356 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(21825)210 648 A
(int)126 1026 A
(norm;)210 1194 A
2370(/*)S
(TRUE)168 2496 A
2706(=)S
2790(do)S
(not)126 2916 A
(swap)168 3084 A
(bytes;)252 3294 A
(FALSE)210 3588 A
3840(=)S
(swap)168 3924 A
4134(*/)S
990 V
(21826)210 648 A
1080 V
(21827)210 648 A
1026({)S
1170 V
(21828)210 648 A
1026(/*)S
(Same)168 1152 A
1362(as)S
(old_icopy,)420 1488 A
(but)126 1950 A
(to/from)294 2118 A
2454(V2)S
(disk)168 2580 A
(layout.)294 2790 A
3126(*/)S
1260 V
(21829)210 648 A
1350 V
(21830)210 648 A
(int)126 1110 A
1278(i;)S
1440 V
(21831)210 648 A
1530 V
(21832)210 648 A
1110(if)S
(\(direction)420 1236 A
1698(==)S
(READING\))336 1824 A
2202({)S
1620 V
(21833)210 648 A
1362(/*)S
(Copy)168 1488 A
(V2.x)168 1698 A
(inode)210 1908 A
2160(to)S
(the)126 2286 A
(in-core)294 2454 A
(table,)252 2790 A
(swapping)336 3084 A
(bytes)210 3462 A
3714(if)S
(need)168 3840 A
(be.)126 4050 A
4218(*/)S
1710 V
(21834)210 648 A
(rip->i_mode)462 1362 A
1992(=)S
(conv2\(norm,dip->d2_mode\);)1050 2076 A
1800 V
(21835)210 648 A
(rip->i_uid)420 1362 A
1992(=)S
(conv2\(norm,dip->d2_uid)924 2076 A
3042(\);)S
1890 V
(21836)210 648 A
(rip->i_nlinks)546 1362 A
1992(=)S
(conv2\(norm,\(int\))672 2076 A
(dip->d2_nlinks\);)672 2790 A
1980 V
(21837)210 648 A
(rip->i_gid)420 1362 A
1992(=)S
(conv2\(norm,\(int\))672 2076 A
(dip->d2_gid)462 2790 A
3294(\);)S
2070 V
(21838)210 648 A
(rip->i_size)462 1362 A
1992(=)S
(conv4\(norm,dip->d2_size\);)1050 2076 A
2160 V
(21839)210 648 A
(rip->i_atime)504 1362 A
1992(=)S
(conv4\(norm,dip->d2_atime\);)1092 2076 A
2250 V
(21840)210 648 A
(rip->i_ctime)504 1362 A
1992(=)S
(conv4\(norm,dip->d2_ctime\);)1092 2076 A
2340 V
(21841)210 648 A
(rip->i_mtime)504 1362 A
1992(=)S
(conv4\(norm,dip->d2_mtime\);)1092 2076 A
2430 V
(21842)210 648 A
(rip->i_ndzones)588 1362 A
1992(=)S
(V2_NR_DZONES;)546 2076 A
2520 V
(21843)210 648 A
(rip->i_nindirs)588 1362 A
1992(=)S
(V2_INDIRECTS;)546 2076 A
2610 V
(21844)210 648 A
(for)126 1362 A
1530(\(i)S
1656(=)S
1740(0;)S
1866(i)S
1950(<)S
(V2_NR_TZONES;)546 2034 A
(i++\))168 2622 A
2700 V
(21845)210 648 A
(rip->i_zone[i])588 1698 A
2328(=)S
(conv4\(norm,)462 2412 A
(\(long\))252 2916 A
(dip->d2_zone[i]\);)714 3210 A
2790 V
(21846)210 648 A
1110(})S
(else)168 1194 A
1404({)S
2880 V
(21847)210 648 A
1362(/*)S
(Copying)294 1488 A
(V2.x)168 1824 A
(inode)210 2034 A
2286(to)S
(disk)168 2412 A
(from)168 2622 A
(the)126 2832 A
(in-core)294 3000 A
(table.)252 3336 A
3630(*/)S
2970 V
(21848)210 648 A
(dip->d2_mode)504 1362 A
1992(=)S
(conv2\(norm,rip->i_mode\);)1008 2076 A
3060 V
(21849)210 648 A
(dip->d2_uid)462 1362 A
1992(=)S
(conv2\(norm,rip->i_uid)882 2076 A
3000(\);)S
3150 V
(21850)210 648 A
(dip->d2_nlinks)588 1362 A
1992(=)S
(conv2\(norm,rip->i_nlinks\);)1092 2076 A
3240 V
(21851)210 648 A
(dip->d2_gid)462 1362 A
1992(=)S
(conv2\(norm,rip->i_gid)882 2076 A
3000(\);)S
3330 V
(21852)210 648 A
(dip->d2_size)504 1362 A
1992(=)S
(conv4\(norm,rip->i_size\);)1008 2076 A
3420 V
(21853)210 648 A
(dip->d2_atime)546 1362 A
1992(=)S
(conv4\(norm,rip->i_atime\);)1050 2076 A
3510 V
(21854)210 648 A
(dip->d2_ctime)546 1362 A
1992(=)S
(conv4\(norm,rip->i_ctime\);)1050 2076 A
3600 V
(21855)210 648 A
(dip->d2_mtime)546 1362 A
1992(=)S
(conv4\(norm,rip->i_mtime\);)1050 2076 A
3690 V
(21856)210 648 A
(for)126 1362 A
1530(\(i)S
1656(=)S
1740(0;)S
1866(i)S
1950(<)S
(V2_NR_TZONES;)546 2034 A
(i++\))168 2622 A
3780 V
(21857)210 648 A
(dip->d2_zone[i])630 1698 A
2370(=)S
(conv4\(norm,)462 2454 A
(\(long\))252 2958 A
(rip->i_zone[i]\);)672 3252 A
3870 V
(21858)210 648 A
1110(})S
3960 V
(21859)210 648 A
1026(})S
4230 V
(21862)210 648 A
(/*===========================================================================*)3276 1026 A
4320 V
(21863)210 648 A
1068(*)S
(dup_inode)378 2370 A
4260(*)S
4410 V
(21864)210 648 A
(*===========================================================================*/)3276 1068 A
4500 V
(21865)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(dup_inode\(ip\))546 1530 A
4590 V
(21866)210 648 A
(struct)252 1026 A
(inode)210 1320 A
(*ip;)168 1572 A
2370(/*)S
(The)126 2496 A
(inode)210 2664 A
2916(to)S
3042(be)S
(duplicated.)462 3168 A
3672(*/)S
4680 V
(21867)210 648 A
1026({)S
4770 V
(21868)210 648 A
1026(/*)S
(This)168 1152 A
(routine)294 1362 A
1698(is)S
1824(a)S
(simplified)420 1908 A
(form)168 2370 A
2580(of)S
(get_inode\(\))462 2706 A
(for)126 3210 A
(the)126 3378 A
(case)168 3546 A
(where)210 3756 A
4860 V
(21869)210 648 A
1068(*)S
(the)126 1152 A
(inode)210 1320 A
(pointer)294 1572 A
1908(is)S
(already)294 2034 A
(known.)252 2370 A
4950 V
(21870)210 648 A
1068(*/)S
5040 V
(21871)210 648 A
5130 V
(21872)210 648 A
(ip->i_count++;)588 1110 A
5220 V
(21873)210 648 A
1026(})S
8418 V
EP
%%Page: 297 297
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2126(File:)S
2359(src/fs/super.c)S
12 B
(297)180 4248 A
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/fs/super.c)588 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(21900)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(manages)294 1572 A
(the)126 1908 A
(super)210 2076 A
(block)210 2328 A
(table)210 2580 A
(and)126 2832 A
(the)126 3000 A
(related)294 3168 A
(data)168 3504 A
(structures,)462 3714 A
1440 V
(21901)210 648 A
1068(*)S
(namely,)294 1152 A
(the)126 1488 A
(bit)126 1656 A
(maps)168 1824 A
(that)168 2034 A
(keep)168 2244 A
(track)210 2454 A
2706(of)S
(which)210 2832 A
(zones)210 3084 A
(and)126 3336 A
(which)210 3504 A
(inodes)252 3756 A
(are)126 4050 A
1530 V
(21902)210 648 A
1068(*)S
(allocated)378 1152 A
(and)126 1572 A
(which)210 1740 A
(are)126 1992 A
(free.)210 2160 A
(When)168 2454 A
2664(a)S
(new)126 2748 A
(inode)210 2916 A
3168(or)S
(zone)168 3294 A
3504(is)S
(needed,)294 3630 A
(the)126 3966 A
1620 V
(21903)210 648 A
1068(*)S
(appropriate)462 1152 A
(bit)126 1656 A
(map)126 1824 A
1992(is)S
(searched)336 2118 A
(for)126 2496 A
2664(a)S
(free)168 2748 A
(entry.)252 2958 A
1710 V
(21904)210 648 A
1068(*)S
1800 V
(21905)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
1890 V
(21906)210 648 A
1068(*)S
(alloc_bit:)420 1236 A
(somebody)336 1950 A
(wants)210 2328 A
2580(to)S
(allocate)336 2706 A
3084(a)S
(zone)168 3168 A
3378(or)S
(inode;)252 3504 A
(find)168 3798 A
(one)126 4008 A
1980 V
(21907)210 648 A
1068(*)S
(free_bit:)378 1236 A
(indicate)336 1950 A
(that)168 2328 A
2538(a)S
(zone)168 2622 A
2832(or)S
(inode)210 2958 A
3210(is)S
(available)378 3336 A
(for)126 3756 A
(allocation)420 3924 A
2070 V
(21908)210 648 A
1068(*)S
(get_super:)420 1236 A
(search)252 1950 A
(the)126 2244 A
('superblock')504 2412 A
(table)210 2958 A
(for)126 3210 A
3378(a)S
(device)252 3462 A
2160 V
(21909)210 648 A
1068(*)S
(mounted:)336 1236 A
(tells)210 1950 A
2202(if)S
(file)168 2328 A
(inode)210 2538 A
2790(is)S
2916(on)S
(mounted)294 3042 A
(\(or)126 3378 A
(ROOT\))210 3546 A
(file)168 3798 A
(system)252 4008 A
2250 V
(21910)210 648 A
1068(*)S
(read_super:)462 1236 A
(read)168 1950 A
2160(a)S
(superblock)420 2244 A
2340 V
(21911)210 648 A
1068(*/)S
2430 V
(21912)210 648 A
2520 V
(21913)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
2610 V
(21914)210 648 A
(#include)336 1026 A
(<string.h>)420 1404 A
2700 V
(21915)210 648 A
(#include)336 1026 A
(<minix/boot.h>)588 1404 A
2790 V
(21916)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
2880 V
(21917)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
2970 V
(21918)210 648 A
(#include)336 1026 A
("super.h")378 1404 A
3060 V
(21919)210 648 A
3150 V
(21920)210 648 A
(#define)294 1026 A
(BITCHUNK_BITS)546 1362 A
(\(usizeof\(bitchunk_t\))840 2034 A
2916(*)S
(CHAR_BIT\))378 3000 A
3240 V
(21921)210 648 A
(#define)294 1026 A
(BITS_PER_BLOCK)588 1362 A
(\(BITMAP_CHUNKS)588 2034 A
2664(*)S
(BITCHUNK_BITS\))588 2748 A
3330 V
(21922)210 648 A
3420 V
(21923)210 648 A
(/*===========================================================================*)3276 1026 A
3510 V
(21924)210 648 A
1068(*)S
(alloc_bit)378 2370 A
4260(*)S
3600 V
(21925)210 648 A
(*===========================================================================*/)3276 1068 A
3690 V
(21926)210 648 A
(PUBLIC)252 1026 A
(bit_t)210 1320 A
(alloc_bit\(sp,)546 1572 A
(map,)168 2160 A
(origin\))294 2370 A
3780 V
(21927)210 648 A
(struct)252 1026 A
(super_block)462 1320 A
(*sp;)168 1824 A
2370(/*)S
(the)126 2496 A
(filesystem)420 2664 A
3126(to)S
(allocate)336 3252 A
(from)168 3630 A
3840(*/)S
3870 V
(21928)210 648 A
(int)126 1026 A
(map;)168 1194 A
2370(/*)S
(IMAP)168 2496 A
(\(inode)252 2706 A
(map\))168 3000 A
3210(or)S
(ZMAP)168 3336 A
(\(zone)210 3546 A
(map\))168 3798 A
4008(*/)S
3960 V
(21929)210 648 A
(bit_t)210 1026 A
(origin;)294 1278 A
2370(/*)S
(number)252 2496 A
2790(of)S
(bit)126 2916 A
3084(to)S
(start)210 3210 A
(searching)378 3462 A
3882(at)S
4008(*/)S
4050 V
(21930)210 648 A
1026({)S
4140 V
(21931)210 648 A
1026(/*)S
(Allocate)336 1152 A
1530(a)S
(bit)126 1614 A
(from)168 1782 A
1992(a)S
(bit)126 2076 A
(map)126 2244 A
(and)126 2412 A
(return)252 2580 A
(its)126 2874 A
(bit)126 3042 A
(number.)294 3210 A
3546(*/)S
4230 V
(21932)210 648 A
4320 V
(21933)210 648 A
(block_t)294 1110 A
(start_block;)504 1446 A
2370(/*)S
(first)210 2496 A
(bit)126 2748 A
(block)210 2916 A
3168(*/)S
4410 V
(21934)210 648 A
(bit_t)210 1110 A
(map_bits;)378 1362 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(bits)168 2874 A
(are)126 3084 A
(there)210 3252 A
3504(in)S
(the)126 3630 A
(bit)126 3798 A
(map?)168 3966 A
4176(*/)S
4500 V
(21935)210 648 A
(unsigned)336 1110 A
(bit_blocks;)462 1488 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(blocks)252 2874 A
(are)126 3168 A
(there)210 3336 A
3588(in)S
(the)126 3714 A
(bit)126 3882 A
(map?)168 4050 A
4260(*/)S
4590 V
(21936)210 648 A
(unsigned)336 1110 A
(block,)252 1488 A
(word,)210 1782 A
(bcount,)294 2034 A
(wcount;)294 2370 A
4680 V
(21937)210 648 A
(struct)252 1110 A
(buf)126 1404 A
(*bp;)168 1572 A
4770 V
(21938)210 648 A
(bitchunk_t)420 1110 A
(*wptr,)252 1572 A
(*wlim,)252 1866 A
2160(k;)S
4860 V
(21939)210 648 A
(bit_t)210 1110 A
1362(i,)S
1488(b;)S
4950 V
(21940)210 648 A
5040 V
(21941)210 648 A
1110(if)S
(\(sp->s_rd_only\))630 1236 A
5130 V
(21942)210 648 A
(panic\("can't)504 1362 A
(allocate)336 1908 A
(bit)126 2286 A
2454(on)S
(read-only)378 2580 A
(filesys.",)420 3000 A
(NO_NUM\);)336 3462 A
5220 V
(21943)210 648 A
5310 V
(21944)210 648 A
1110(if)S
(\(map)168 1236 A
1446(==)S
(IMAP\))210 1572 A
1824({)S
5400 V
(21945)210 648 A
(start_block)462 1362 A
1866(=)S
(SUPER_BLOCK)462 1950 A
2454(+)S
2538(1;)S
5490 V
(21946)210 648 A
(map_bits)336 1362 A
1740(=)S
(sp->s_ninodes)546 1824 A
2412(+)S
2496(1;)S
5580 V
(21947)210 648 A
(bit_blocks)420 1362 A
1824(=)S
(sp->s_imap_blocks;)756 1908 A
5670 V
(21948)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5760 V
(21949)210 648 A
(start_block)462 1362 A
1866(=)S
(SUPER_BLOCK)462 1950 A
2454(+)S
2538(1)S
2622(+)S
(sp->s_imap_blocks;)756 2706 A
5850 V
(21950)210 648 A
(map_bits)336 1362 A
1740(=)S
(sp->s_zones)462 1824 A
2328(-)S
(\(sp->s_firstdatazone)840 2412 A
3294(-)S
(1\);)126 3378 A
5940 V
(21951)210 648 A
(bit_blocks)420 1362 A
1824(=)S
(sp->s_zmap_blocks;)756 1908 A
6030 V
(21952)210 648 A
1110(})S
6120 V
(21953)210 648 A
6210 V
(21954)210 648 A
1110(/*)S
(Figure)252 1236 A
(out)126 1530 A
(where)210 1698 A
1950(to)S
(start)210 2076 A
(the)126 2328 A
(bit)126 2496 A
(search)252 2664 A
(\(depends)336 2958 A
3336(on)S
('origin'\).)420 3462 A
3924(*/)S
8418 V
EP
%%Page: 298 298
BP
/slant 0 def
/height 0 def
630 V
12 B
(298)180 648 A
11 R
2126(File:)S
2359(src/fs/super.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(21955)210 648 A
1110(if)S
(\(origin)294 1236 A
1572(>=)S
(map_bits\))378 1698 A
(origin)252 2118 A
2412(=)S
2496(0;)S
2706(/*)S
(for)126 2832 A
(robustness)420 3000 A
3462(*/)S
990 V
(21956)210 648 A
1080 V
(21957)210 648 A
1110(/*)S
(Locate)252 1236 A
(the)126 1530 A
(starting)336 1698 A
(place.)252 2076 A
2370(*/)S
1170 V
(21958)210 648 A
(block)210 1110 A
1362(=)S
(origin)252 1446 A
1740(/)S
(BITS_PER_BLOCK;)630 1824 A
1260 V
(21959)210 648 A
(word)168 1110 A
1320(=)S
(\(origin)294 1404 A
1740(%)S
(BITS_PER_BLOCK\))630 1824 A
2496(/)S
(BITCHUNK_BITS;)588 2580 A
1350 V
(21960)210 648 A
1440 V
(21961)210 648 A
1110(/*)S
(Iterate)294 1236 A
(over)168 1572 A
(all)126 1782 A
(blocks)252 1950 A
(plus)168 2244 A
(one,)168 2454 A
(because)294 2664 A
3000(we)S
(start)210 3126 A
3378(in)S
(the)126 3504 A
(middle.)294 3672 A
4008(*/)S
1530 V
(21962)210 648 A
(bcount)252 1110 A
1404(=)S
(bit_blocks)420 1488 A
1950(+)S
2034(1;)S
1620 V
(21963)210 648 A
1110(do)S
1236({)S
1710 V
(21964)210 648 A
1362(bp)S
1488(=)S
(get_block\(sp->s_dev,)840 1572 A
(start_block)462 2454 A
2958(+)S
(block,)252 3042 A
(NORMAL\);)336 3336 A
1800 V
(21965)210 648 A
(wlim)168 1362 A
1572(=)S
(&bp->b_bitmap[BITMAP_CHUNKS];)1218 1656 A
1890 V
(21966)210 648 A
1980 V
(21967)210 648 A
1362(/*)S
(Iterate)294 1488 A
(over)168 1824 A
(the)126 2034 A
(words)210 2202 A
2454(in)S
(block.)252 2580 A
2874(*/)S
2070 V
(21968)210 648 A
(for)126 1362 A
(\(wptr)210 1530 A
1782(=)S
(&bp->b_bitmap[word];)840 1866 A
(wptr)168 2748 A
2958(<)S
(wlim;)210 3042 A
(wptr++\))294 3294 A
3630({)S
2160 V
(21969)210 648 A
2250 V
(21970)210 648 A
1698(/*)S
(Does)168 1824 A
(this)168 2034 A
(word)168 2244 A
(contain)294 2454 A
2790(a)S
(free)168 2874 A
(bit?)168 3084 A
3294(*/)S
2340 V
(21971)210 648 A
1698(if)S
(\(*wptr)252 1824 A
2118(==)S
(\(bitchunk_t\))504 2244 A
(\3040\))126 2790 A
(continue;)378 2958 A
2430 V
(21972)210 648 A
2520 V
(21973)210 648 A
1698(/*)S
(Find)168 1824 A
(and)126 2034 A
(allocate)336 2202 A
(the)126 2580 A
(free)168 2748 A
(bit.)168 2958 A
3168(*/)S
2610 V
(21974)210 648 A
1698(k)S
1782(=)S
(conv2\(sp->s_native,)798 1866 A
(\(int\))210 2706 A
(*wptr\);)294 2958 A
2700 V
(21975)210 648 A
(for)126 1698 A
1866(\(i)S
1992(=)S
2076(0;)S
2202(\(k)S
2328(&)S
2412(\(1)S
2538(<<)S
(i\)\))126 2664 A
2832(!=)S
2958(0;)S
(++i\))168 3084 A
3294({})S
2790 V
(21976)210 648 A
2880 V
(21977)210 648 A
1698(/*)S
(Bit)126 1824 A
(number)252 1992 A
(from)168 2286 A
(the)126 2496 A
(start)210 2664 A
2916(of)S
(the)126 3042 A
(bit)126 3210 A
(map.)168 3378 A
3588(*/)S
2970 V
(21978)210 648 A
1698(b)S
1782(=)S
(\(\(bit_t\))336 1866 A
(block)210 2244 A
2496(*)S
(BITS_PER_BLOCK\))630 2580 A
3060 V
(21979)210 648 A
1866(+)S
(\(wptr)210 1950 A
2202(-)S
(&bp->b_bitmap[0]\))714 2286 A
3042(*)S
(BITCHUNK_BITS)546 3126 A
3150 V
(21980)210 648 A
1866(+)S
1950(i;)S
3240 V
(21981)210 648 A
3330 V
(21982)210 648 A
1698(/*)S
(Don't)210 1824 A
(allocate)336 2076 A
(bits)168 2454 A
(beyond)252 2664 A
(the)126 2958 A
(end)126 3126 A
3294(of)S
(the)126 3420 A
(map.)168 3588 A
3798(*/)S
3420 V
(21983)210 648 A
1698(if)S
1824(\(b)S
1950(>=)S
(map_bits\))378 2076 A
(break;)252 2496 A
3510 V
(21984)210 648 A
3600 V
(21985)210 648 A
1698(/*)S
(Allocate)336 1824 A
(and)126 2202 A
(return)252 2370 A
(bit)126 2664 A
(number.)294 2832 A
3168(*/)S
3690 V
(21986)210 648 A
1698(k)S
1782(|=)S
1908(1)S
1992(<<)S
2118(i;)S
3780 V
(21987)210 648 A
(*wptr)210 1698 A
1950(=)S
(conv2\(sp->s_native,)798 2034 A
(\(int\))210 2874 A
(k\);)126 3126 A
3870 V
(21988)210 648 A
(bp->b_dirt)420 1698 A
2160(=)S
(DIRTY;)252 2244 A
3960 V
(21989)210 648 A
(put_block\(bp,)546 1698 A
(MAP_BLOCK\);)462 2286 A
4050 V
(21990)210 648 A
(return\(b\);)420 1698 A
4140 V
(21991)210 648 A
1362(})S
4230 V
(21992)210 648 A
(put_block\(bp,)546 1362 A
(MAP_BLOCK\);)462 1950 A
4320 V
(21993)210 648 A
1362(if)S
(\(++block)336 1488 A
1866(>=)S
(bit_blocks\))462 1992 A
(block)210 2496 A
2748(=)S
2832(0;)S
3042(/*)S
(last)168 3168 A
(block,)252 3378 A
(wrap)168 3672 A
(around)252 3882 A
4176(*/)S
4410 V
(21994)210 648 A
(word)168 1362 A
1572(=)S
1656(0;)S
4500 V
(21995)210 648 A
1110(})S
(while)210 1194 A
(\(--bcount)378 1446 A
1866(>)S
(0\);)126 1950 A
4590 V
(21996)210 648 A
(return\(NO_BIT\);)630 1110 A
2370(/*)S
2496(no)S
(bit)126 2622 A
(could)210 2790 A
3042(be)S
(allocated)378 3168 A
3588(*/)S
4680 V
(21997)210 648 A
1026(})S
4950 V
(22000)210 648 A
(/*===========================================================================*)3276 1026 A
5040 V
(22001)210 648 A
1068(*)S
(free_bit)336 2370 A
4260(*)S
5130 V
(22002)210 648 A
(*===========================================================================*/)3276 1068 A
5220 V
(22003)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(free_bit\(sp,)504 1530 A
(map,)168 2076 A
(bit_returned\))546 2286 A
5310 V
(22004)210 648 A
(struct)252 1026 A
(super_block)462 1320 A
(*sp;)168 1824 A
2370(/*)S
(the)126 2496 A
(filesystem)420 2664 A
3126(to)S
(operate)294 3252 A
3588(on)S
3714(*/)S
5400 V
(22005)210 648 A
(int)126 1026 A
(map;)168 1194 A
2370(/*)S
(IMAP)168 2496 A
(\(inode)252 2706 A
(map\))168 3000 A
3210(or)S
(ZMAP)168 3336 A
(\(zone)210 3546 A
(map\))168 3798 A
4008(*/)S
5490 V
(22006)210 648 A
(bit_t)210 1026 A
(bit_returned;)546 1278 A
2370(/*)S
(number)252 2496 A
2790(of)S
(bit)126 2916 A
3084(to)S
(insert)252 3210 A
(into)168 3504 A
(the)126 3714 A
(map)126 3882 A
4050(*/)S
5580 V
(22007)210 648 A
1026({)S
5670 V
(22008)210 648 A
1026(/*)S
(Return)252 1152 A
1446(a)S
(zone)168 1530 A
1740(or)S
(inode)210 1866 A
2118(by)S
(turning)294 2244 A
(off)126 2580 A
(its)126 2748 A
(bitmap)252 2916 A
(bit.)168 3210 A
3420(*/)S
5760 V
(22009)210 648 A
5850 V
(22010)210 648 A
(unsigned)336 1110 A
(block,)252 1488 A
(word,)210 1782 A
(bit;)168 2034 A
5940 V
(22011)210 648 A
(struct)252 1110 A
(buf)126 1404 A
(*bp;)168 1572 A
6030 V
(22012)210 648 A
(bitchunk_t)420 1110 A
1572(k,)S
(mask;)210 1698 A
6120 V
(22013)210 648 A
(block_t)294 1110 A
(start_block;)504 1446 A
6210 V
(22014)210 648 A
8418 V
EP
%%Page: 299 299
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2126(File:)S
2359(src/fs/super.c)S
12 B
(299)180 4248 A
900 V
7 LST
(22015)210 648 A
1110(if)S
(\(sp->s_rd_only\))630 1236 A
990 V
(22016)210 648 A
(panic\("can't)504 1362 A
(free)168 1908 A
(bit)126 2118 A
2286(on)S
(read-only)378 2412 A
(filesys.",)420 2832 A
(NO_NUM\);)336 3294 A
1080 V
(22017)210 648 A
1170 V
(22018)210 648 A
1110(if)S
(\(map)168 1236 A
1446(==)S
(IMAP\))210 1572 A
1824({)S
1260 V
(22019)210 648 A
(start_block)462 1362 A
1866(=)S
(SUPER_BLOCK)462 1950 A
2454(+)S
2538(1;)S
1350 V
(22020)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1440 V
(22021)210 648 A
(start_block)462 1362 A
1866(=)S
(SUPER_BLOCK)462 1950 A
2454(+)S
2538(1)S
2622(+)S
(sp->s_imap_blocks;)756 2706 A
1530 V
(22022)210 648 A
1110(})S
1620 V
(22023)210 648 A
(block)210 1110 A
1362(=)S
(bit_returned)504 1446 A
1992(/)S
(BITS_PER_BLOCK;)630 2076 A
1710 V
(22024)210 648 A
(word)168 1110 A
1320(=)S
(\(bit_returned)546 1404 A
1992(%)S
(BITS_PER_BLOCK\))630 2076 A
2748(/)S
(BITCHUNK_BITS;)588 2832 A
1800 V
(22025)210 648 A
(bit)126 1110 A
1278(=)S
(bit_returned)504 1362 A
1908(%)S
(BITCHUNK_BITS;)588 1992 A
1890 V
(22026)210 648 A
(mask)168 1110 A
1320(=)S
1404(1)S
1488(<<)S
(bit;)168 1614 A
1980 V
(22027)210 648 A
2070 V
(22028)210 648 A
1110(bp)S
1236(=)S
(get_block\(sp->s_dev,)840 1320 A
(start_block)462 2202 A
2706(+)S
(block,)252 2790 A
(NORMAL\);)336 3084 A
2160 V
(22029)210 648 A
2250 V
(22030)210 648 A
1110(k)S
1194(=)S
(conv2\(sp->s_native,)798 1278 A
(\(int\))210 2118 A
(bp->b_bitmap[word]\);)840 2370 A
2340 V
(22031)210 648 A
1110(if)S
(\(!\(k)168 1236 A
1446(&)S
(mask\)\))252 1530 A
1824({)S
2430 V
(22032)210 648 A
(panic\(map)378 1362 A
1782(==)S
(IMAP)168 1908 A
2118(?)S
("tried)252 2202 A
2496(to)S
(free)168 2622 A
(unused)252 2832 A
(inode")252 3126 A
3420(:)S
2520 V
(22033)210 648 A
("tried)252 1614 A
1908(to)S
(free)168 2034 A
(unused)252 2244 A
(block",)294 2538 A
(NO_NUM\);)336 2874 A
2610 V
(22034)210 648 A
1110(})S
2700 V
(22035)210 648 A
2790 V
(22036)210 648 A
1110(k)S
1194(&=)S
(\304mask;)252 1320 A
2880 V
(22037)210 648 A
(bp->b_bitmap[word])756 1110 A
1908(=)S
(conv2\(sp->s_native,)798 1992 A
(\(int\))210 2832 A
(k\);)126 3084 A
2970 V
(22038)210 648 A
(bp->b_dirt)420 1110 A
1572(=)S
(DIRTY;)252 1656 A
3060 V
(22039)210 648 A
3150 V
(22040)210 648 A
(put_block\(bp,)546 1110 A
(MAP_BLOCK\);)462 1698 A
3240 V
(22041)210 648 A
1026(})S
3510 V
(22044)210 648 A
(/*===========================================================================*)3276 1026 A
3600 V
(22045)210 648 A
1068(*)S
(get_super)378 2370 A
4260(*)S
3690 V
(22046)210 648 A
(*===========================================================================*/)3276 1068 A
3780 V
(22047)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(super_block)462 1614 A
(*get_super\(dev\))630 2118 A
3870 V
(22048)210 648 A
(dev_t)210 1026 A
(dev;)168 1278 A
2370(/*)S
(device)252 2496 A
(number)252 2790 A
(whose)210 3084 A
(super_block)462 3336 A
3840(is)S
(sought)252 3966 A
4260(*/)S
3960 V
(22049)210 648 A
1026({)S
4050 V
(22050)210 648 A
1026(/*)S
(Search)252 1152 A
(the)126 1446 A
(superblock)420 1614 A
(table)210 2076 A
(for)126 2328 A
(this)168 2496 A
(device.)294 2706 A
3084(It)S
3210(is)S
(supposed)336 3336 A
3714(to)S
3840(be)S
(there.)252 3966 A
4260(*/)S
4140 V
(22051)210 648 A
4230 V
(22052)210 648 A
(register)336 1110 A
(struct)252 1488 A
(super_block)462 1782 A
(*sp;)168 2286 A
4320 V
(22053)210 648 A
4410 V
(22054)210 648 A
(for)126 1110 A
(\(sp)126 1278 A
1446(=)S
(&super_block[0];)672 1530 A
2244(sp)S
2370(<)S
(&super_block[NR_SUPERS];)1008 2454 A
(sp++\))210 3504 A
4500 V
(22055)210 648 A
1362(if)S
(\(sp->s_dev)420 1488 A
1950(==)S
(dev\))168 2076 A
(return\(sp\);)462 2286 A
4590 V
(22056)210 648 A
4680 V
(22057)210 648 A
1110(/*)S
(Search)252 1236 A
(failed.)294 1530 A
(Something)378 1908 A
(wrong.)252 2328 A
2622(*/)S
4770 V
(22058)210 648 A
(panic\("can't)504 1110 A
(find)168 1656 A
(superblock)420 1866 A
(for)126 2328 A
(device)252 2496 A
(\(in)126 2790 A
(decimal\)",)420 2958 A
(\(int\))210 3420 A
(dev\);)210 3672 A
4860 V
(22059)210 648 A
4950 V
(22060)210 648 A
(return\(NIL_SUPER\);)756 1110 A
2370(/*)S
2496(to)S
(keep)168 2622 A
(the)126 2832 A
(compiler)336 3000 A
(and)126 3378 A
(lint)168 3546 A
(quiet)210 3756 A
4008(*/)S
5040 V
(22061)210 648 A
1026(})S
5310 V
(22064)210 648 A
(/*===========================================================================*)3276 1026 A
5400 V
(22065)210 648 A
1068(*)S
(mounted)294 2370 A
4260(*)S
5490 V
(22066)210 648 A
(*===========================================================================*/)3276 1068 A
5580 V
(22067)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(mounted\(rip\))504 1488 A
5670 V
(22068)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
3210(*/)S
5760 V
(22069)210 648 A
1026({)S
5850 V
(22070)210 648 A
1026(/*)S
(Report)252 1152 A
1446(on)S
(whether)294 1572 A
(the)126 1908 A
(given)210 2076 A
(inode)210 2328 A
2580(is)S
2706(on)S
2832(a)S
(mounted)294 2916 A
(\(or)126 3252 A
(ROOT\))210 3420 A
(file)168 3672 A
(system.)294 3882 A
4218(*/)S
5940 V
(22071)210 648 A
6030 V
(22072)210 648 A
(register)336 1110 A
(struct)252 1488 A
(super_block)462 1782 A
(*sp;)168 2286 A
6120 V
(22073)210 648 A
(register)336 1110 A
(dev_t)210 1488 A
(dev;)168 1740 A
6210 V
(22074)210 648 A
8418 V
EP
%%Page: 300 300
BP
/slant 0 def
/height 0 def
630 V
12 B
(300)180 648 A
11 R
2126(File:)S
2359(src/fs/super.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(22075)210 648 A
(dev)126 1110 A
1278(=)S
(\(dev_t\))294 1362 A
(rip->i_zone[0];)630 1698 A
990 V
(22076)210 648 A
1110(if)S
(\(dev)168 1236 A
1446(==)S
(ROOT_DEV\))378 1572 A
(return\(TRUE\);)546 1992 A
2706(/*)S
(inode)210 2832 A
3084(is)S
3210(on)S
(root)168 3336 A
(file)168 3546 A
(system)252 3756 A
4050(*/)S
1080 V
(22077)210 648 A
1170 V
(22078)210 648 A
(for)126 1110 A
(\(sp)126 1278 A
1446(=)S
(&super_block[0];)672 1530 A
2244(sp)S
2370(<)S
(&super_block[NR_SUPERS];)1008 2454 A
(sp++\))210 3504 A
1260 V
(22079)210 648 A
1362(if)S
(\(sp->s_dev)420 1488 A
1950(==)S
(dev\))168 2076 A
(return\(TRUE\);)546 2286 A
1350 V
(22080)210 648 A
1440 V
(22081)210 648 A
(return\(FALSE\);)588 1110 A
1530 V
(22082)210 648 A
1026(})S
1800 V
(22085)210 648 A
(/*===========================================================================*)3276 1026 A
1890 V
(22086)210 648 A
1068(*)S
(read_super)420 2370 A
4260(*)S
1980 V
(22087)210 648 A
(*===========================================================================*/)3276 1068 A
2070 V
(22088)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(read_super\(sp\))588 1488 A
2160 V
(22089)210 648 A
(register)336 1026 A
(struct)252 1404 A
(super_block)462 1698 A
(*sp;)168 2202 A
2412(/*)S
(pointer)294 2538 A
2874(to)S
3000(a)S
(superblock)420 3084 A
3546(*/)S
2250 V
(22090)210 648 A
1026({)S
2340 V
(22091)210 648 A
1026(/*)S
(Read)168 1152 A
1362(a)S
(superblock.)462 1446 A
1950(*/)S
2430 V
(22092)210 648 A
2520 V
(22093)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp;)168 1950 A
2610 V
(22094)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
2700 V
(22095)210 648 A
(int)126 1110 A
(magic;)252 1278 A
2790 V
(22096)210 648 A
(int)126 1110 A
(version,)336 1278 A
(native;)294 1656 A
2880 V
(22097)210 648 A
2970 V
(22098)210 648 A
(dev)126 1110 A
1278(=)S
(sp->s_dev;)420 1362 A
2370(/*)S
(save)168 2496 A
(device)252 2706 A
(\(will)210 3000 A
3252(be)S
(overwritten)462 3378 A
3882(by)S
(copy\))210 4008 A
4260(*/)S
3060 V
(22099)210 648 A
1110(bp)S
1236(=)S
(get_block\(sp->s_dev,)840 1320 A
(SUPER_BLOCK,)504 2202 A
(NORMAL\);)336 2748 A
3150 V
(22100)210 648 A
(memcpy\()294 1110 A
(\(char)210 1446 A
1698(*\))S
(sp,)126 1824 A
(bp->b_data,)462 1992 A
(\(size_t\))336 2496 A
(SUPER_SIZE\);)504 2874 A
3240 V
(22101)210 648 A
(put_block\(bp,)546 1110 A
(ZUPER_BLOCK\);)546 1698 A
3330 V
(22102)210 648 A
(sp->s_dev)378 1110 A
1530(=)S
(NO_DEV;)294 1614 A
2370(/*)S
(restore)294 2496 A
(later)210 2832 A
3084(*/)S
3420 V
(22103)210 648 A
(magic)210 1110 A
1362(=)S
(sp->s_magic;)504 1446 A
2370(/*)S
(determines)420 2496 A
(file)168 2958 A
(system)252 3168 A
(type)168 3462 A
3672(*/)S
3510 V
(22104)210 648 A
3600 V
(22105)210 648 A
1110(/*)S
(Get)126 1236 A
(file)168 1404 A
(system)252 1614 A
(version)294 1908 A
(and)126 2244 A
(type.)210 2412 A
2664(*/)S
3690 V
(22106)210 648 A
1110(if)S
(\(magic)252 1236 A
1530(==)S
(SUPER_MAGIC)462 1656 A
2160(||)S
(magic)210 2286 A
2538(==)S
(conv2\(BYTE_SWAP,)672 2664 A
(SUPER_MAGIC\)\))546 3378 A
3966({)S
3780 V
(22107)210 648 A
(version)294 1362 A
1698(=)S
(V1;)126 1782 A
3870 V
(22108)210 648 A
(native)252 1362 A
1698(=)S
(\(magic)252 1782 A
2076(==)S
(SUPER_MAGIC\);)546 2202 A
3960 V
(22109)210 648 A
1110(})S
(else)168 1194 A
1404(if)S
(\(magic)252 1530 A
1824(==)S
(SUPER_V2)336 1950 A
2328(||)S
(magic)210 2454 A
2706(==)S
(conv2\(BYTE_SWAP,)672 2832 A
(SUPER_V2\)\))420 3546 A
4008({)S
4050 V
(22110)210 648 A
(version)294 1362 A
1698(=)S
(V2;)126 1782 A
4140 V
(22111)210 648 A
(native)252 1362 A
1698(=)S
(\(magic)252 1782 A
2076(==)S
(SUPER_V2\);)420 2202 A
4230 V
(22112)210 648 A
1110(})S
(else)168 1194 A
1404({)S
4320 V
(22113)210 648 A
(return\(EINVAL\);)630 1362 A
4410 V
(22114)210 648 A
1110(})S
4500 V
(22115)210 648 A
4590 V
(22116)210 648 A
1110(/*)S
1236(If)S
(the)126 1362 A
(super)210 1530 A
(block)210 1782 A
(has)126 2034 A
(the)126 2202 A
(wrong)210 2370 A
(byte)168 2622 A
(order,)252 2832 A
(swap)168 3126 A
(the)126 3336 A
(fields;)294 3504 A
(the)126 3840 A
(magic)210 4008 A
4680 V
(22117)210 648 A
1152(*)S
(number)252 1236 A
(doesn't)294 1530 A
(need)168 1866 A
(conversion.)462 2076 A
2580(*/)S
4770 V
(22118)210 648 A
(sp->s_ninodes)546 1110 A
1698(=)S
(conv2\(native,)546 2034 A
(\(int\))210 2622 A
(sp->s_ninodes\);)630 2874 A
4860 V
(22119)210 648 A
(sp->s_nzones)504 1110 A
1656(=)S
(conv2\(native,)546 2034 A
(\(int\))210 2622 A
(sp->s_nzones\);)588 2874 A
4950 V
(22120)210 648 A
(sp->s_imap_blocks)714 1110 A
1866(=)S
(conv2\(native,)546 2034 A
(\(int\))210 2622 A
(sp->s_imap_blocks\);)798 2874 A
5040 V
(22121)210 648 A
(sp->s_zmap_blocks)714 1110 A
1866(=)S
(conv2\(native,)546 2034 A
(\(int\))210 2622 A
(sp->s_zmap_blocks\);)798 2874 A
5130 V
(22122)210 648 A
(sp->s_firstdatazone)798 1110 A
1950(=)S
(conv2\(native,)546 2034 A
(\(int\))210 2622 A
(sp->s_firstdatazone\);)882 2874 A
5220 V
(22123)210 648 A
(sp->s_log_zone_size)798 1110 A
1950(=)S
(conv2\(native,)546 2034 A
(\(int\))210 2622 A
(sp->s_log_zone_size\);)882 2874 A
5310 V
(22124)210 648 A
(sp->s_max_size)588 1110 A
1740(=)S
(conv4\(native,)546 2034 A
(sp->s_max_size\);)672 2622 A
5400 V
(22125)210 648 A
(sp->s_zones)462 1110 A
1614(=)S
(conv4\(native,)546 2034 A
(sp->s_zones\);)546 2622 A
5490 V
(22126)210 648 A
5580 V
(22127)210 648 A
1110(/*)S
1236(In)S
(V1,)126 1362 A
(the)126 1530 A
(device)252 1698 A
(size)168 1992 A
(was)126 2202 A
(kept)168 2370 A
2580(in)S
2706(a)S
(short,)252 2790 A
(s_nzones,)378 3084 A
(which)210 3504 A
(limited)294 3756 A
5670 V
(22128)210 648 A
1152(*)S
(devices)294 1236 A
1572(to)S
(32K)126 1698 A
(zones.)252 1866 A
(For)126 2202 A
(V2,)126 2370 A
2538(it)S
(was)126 2664 A
(decided)294 2832 A
3168(to)S
(keep)168 3294 A
(the)126 3504 A
(size)168 3672 A
3882(as)S
4008(a)S
5760 V
(22129)210 648 A
1152(*)S
(long.)210 1236 A
(However,)336 1530 A
(just)168 1908 A
(changing)336 2118 A
(s_nzones)336 2496 A
2874(to)S
3000(a)S
(long)168 3084 A
(would)210 3294 A
(not)126 3546 A
(work,)210 3714 A
(since)210 3966 A
5850 V
(22130)210 648 A
1152(*)S
(then)168 1236 A
(the)126 1446 A
(position)336 1614 A
1992(of)S
(s_magic)294 2118 A
2454(in)S
(the)126 2580 A
(super)210 2748 A
(block)210 3000 A
(would)210 3252 A
(not)126 3504 A
3672(be)S
(the)126 3798 A
(same)168 3966 A
5940 V
(22131)210 648 A
1152(*)S
1236(in)S
1362(V1)S
(and)126 1488 A
1656(V2)S
(file)168 1782 A
(systems,)336 1992 A
(and)126 2370 A
(there)210 2538 A
(would)210 2790 A
3042(be)S
3168(no)S
(way)126 3294 A
3462(to)S
(tell)168 3588 A
(whether)294 3798 A
6030 V
(22132)210 648 A
1152(*)S
1236(a)S
(newly)210 1320 A
(mounted)294 1572 A
(file)168 1908 A
(system)252 2118 A
(was)126 2412 A
2580(V1)S
2706(or)S
(V2.)126 2832 A
(The)126 3042 A
(solution)336 3210 A
(was)126 3588 A
3756(to)S
(introduce)378 3882 A
6120 V
(22133)210 648 A
1152(*)S
1236(a)S
(new)126 1320 A
(variable,)378 1488 A
(s_zones,)336 1908 A
(and)126 2286 A
(copy)168 2454 A
(the)126 2664 A
(size)168 2832 A
(there.)252 3042 A
6210 V
(22134)210 648 A
1152(*)S
8418 V
EP
%%Page: 301 301
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2126(File:)S
2359(src/fs/super.c)S
12 B
(301)180 4248 A
900 V
7 LST
(22135)210 648 A
1152(*)S
(Calculate)378 1236 A
(some)168 1656 A
(other)210 1866 A
(numbers)294 2118 A
(that)168 2454 A
(depend)252 2664 A
2958(on)S
(the)126 3084 A
(version)294 3252 A
(here)168 3588 A
(too,)168 3798 A
4008(to)S
990 V
(22136)210 648 A
1152(*)S
(hide)168 1236 A
(some)168 1446 A
1656(of)S
(the)126 1782 A
(differences.)504 1950 A
1080 V
(22137)210 648 A
1152(*/)S
1170 V
(22138)210 648 A
1110(if)S
(\(version)336 1236 A
1614(==)S
(V1\))126 1740 A
1908({)S
1260 V
(22139)210 648 A
(sp->s_zones)462 1362 A
1866(=)S
(sp->s_nzones;)546 1950 A
2706(/*)S
(only)168 2832 A
3042(V1)S
(needs)210 3168 A
(this)168 3420 A
(copy)168 3630 A
3840(*/)S
1350 V
(22140)210 648 A
(sp->s_inodes_per_block)924 1362 A
2328(=)S
(V1_INODES_PER_BLOCK;)840 2412 A
1440 V
(22141)210 648 A
(sp->s_ndzones)546 1362 A
1950(=)S
(V1_NR_DZONES;)546 2034 A
1530 V
(22142)210 648 A
(sp->s_nindirs)546 1362 A
1950(=)S
(V1_INDIRECTS;)546 2034 A
1620 V
(22143)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1710 V
(22144)210 648 A
(sp->s_inodes_per_block)924 1362 A
2328(=)S
(V2_INODES_PER_BLOCK;)840 2412 A
1800 V
(22145)210 648 A
(sp->s_ndzones)546 1362 A
1950(=)S
(V2_NR_DZONES;)546 2034 A
1890 V
(22146)210 648 A
(sp->s_nindirs)546 1362 A
1950(=)S
(V2_INDIRECTS;)546 2034 A
1980 V
(22147)210 648 A
1110(})S
2070 V
(22148)210 648 A
2160 V
(22149)210 648 A
(sp->s_isearch)546 1110 A
1698(=)S
1782(0;)S
2370(/*)S
(inode)210 2496 A
(searches)336 2748 A
(initially)378 3126 A
(start)210 3546 A
3798(at)S
3924(0)S
4008(*/)S
2250 V
(22150)210 648 A
(sp->s_zsearch)546 1110 A
1698(=)S
1782(0;)S
2370(/*)S
(zone)168 2496 A
(searches)336 2706 A
(initially)378 3084 A
(start)210 3504 A
3756(at)S
3882(0)S
3966(*/)S
2340 V
(22151)210 648 A
(sp->s_version)546 1110 A
1698(=)S
(version;)336 1782 A
2430 V
(22152)210 648 A
(sp->s_native)504 1110 A
1698(=)S
(native;)294 1782 A
2520 V
(22153)210 648 A
2610 V
(22154)210 648 A
1110(/*)S
(Make)168 1236 A
1446(a)S
(few)126 1530 A
(basic)210 1698 A
(checks)252 1950 A
2244(to)S
(see)126 2370 A
2538(if)S
(super)210 2664 A
(block)210 2916 A
(looks)210 3168 A
(reasonable.)462 3420 A
3924(*/)S
2700 V
(22155)210 648 A
1110(if)S
(\(sp->s_imap_blocks)756 1236 A
2034(<)S
2118(1)S
2202(||)S
(sp->s_zmap_blocks)714 2328 A
3084(<)S
3168(1)S
2790 V
(22156)210 648 A
2370(||)S
(sp->s_ninodes)546 2496 A
3084(<)S
3168(1)S
3252(||)S
(sp->s_zones)462 3378 A
3882(<)S
3966(1)S
2880 V
(22157)210 648 A
2370(||)S
(\(unsigned\))420 2496 A
(sp->s_log_zone_size)798 2958 A
3798(>)S
3882(4\))S
4008({)S
2970 V
(22158)210 648 A
(return\(EINVAL\);)630 1362 A
3060 V
(22159)210 648 A
1110(})S
3150 V
(22160)210 648 A
(sp->s_dev)378 1110 A
1530(=)S
(dev;)168 1614 A
2370(/*)S
(restore)294 2496 A
(device)252 2832 A
(number)252 3126 A
3420(*/)S
3240 V
(22161)210 648 A
(return\(OK\);)462 1110 A
3330 V
(22162)210 648 A
1026(})S
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(src/fs/filedes.c)672 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(22200)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(procedures)420 2118 A
(that)168 2580 A
(manipulate)420 2790 A
(file)168 3252 A
(descriptors.)504 3462 A
4140 V
(22201)210 648 A
1068(*)S
4230 V
(22202)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
4320 V
(22203)210 648 A
1068(*)S
(get_fd:)294 1236 A
(look)168 1698 A
(for)126 1908 A
(free)168 2076 A
(file)168 2286 A
(descriptor)420 2496 A
(and)126 2958 A
(free)168 3126 A
(filp)168 3336 A
(slots)210 3546 A
4410 V
(22204)210 648 A
1068(*)S
(get_filp:)378 1236 A
(look)168 1698 A
1908(up)S
(the)126 2034 A
(filp)168 2202 A
(entry)210 2412 A
(for)126 2664 A
2832(a)S
(given)210 2916 A
(file)168 3168 A
(descriptor)420 3378 A
4500 V
(22205)210 648 A
1068(*)S
(find_filp:)420 1236 A
(find)168 1698 A
1908(a)S
(filp)168 1992 A
(slot)168 2202 A
(that)168 2412 A
(points)252 2622 A
2916(to)S
3042(a)S
(given)210 3126 A
(inode)210 3378 A
4590 V
(22206)210 648 A
1068(*/)S
4680 V
(22207)210 648 A
4770 V
(22208)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
4860 V
(22209)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
4950 V
(22210)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
5040 V
(22211)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
5130 V
(22212)210 648 A
5220 V
(22213)210 648 A
(/*===========================================================================*)3276 1026 A
5310 V
(22214)210 648 A
1068(*)S
(get_fd)252 2370 A
4260(*)S
5400 V
(22215)210 648 A
(*===========================================================================*/)3276 1068 A
5490 V
(22216)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(get_fd\(start,)546 1488 A
(bits,)210 2076 A
2328(k,)S
(fpt\))168 2454 A
5580 V
(22217)210 648 A
(int)126 1026 A
(start;)252 1194 A
2370(/*)S
(start)210 2496 A
2748(of)S
(search)252 2874 A
(\(used)210 3168 A
(for)126 3420 A
(F_DUPFD\))336 3588 A
3966(*/)S
5670 V
(22218)210 648 A
(mode_t)252 1026 A
(bits;)210 1320 A
2370(/*)S
(mode)168 2496 A
2706(of)S
(the)126 2832 A
(file)168 3000 A
3210(to)S
3336(be)S
(created)294 3462 A
(\(RWX)168 3798 A
(bits\))210 4008 A
4260(*/)S
5760 V
(22219)210 648 A
(int)126 1026 A
(*k;)126 1194 A
2370(/*)S
(place)210 2496 A
2748(to)S
(return)252 2874 A
(file)168 3168 A
(descriptor)420 3378 A
3840(*/)S
5850 V
(22220)210 648 A
(struct)252 1026 A
(filp)168 1320 A
(**fpt;)252 1530 A
2370(/*)S
(place)210 2496 A
2748(to)S
(return)252 2874 A
(filp)168 3168 A
(slot)168 3378 A
3588(*/)S
5940 V
(22221)210 648 A
1026({)S
6030 V
(22222)210 648 A
1026(/*)S
(Look)168 1152 A
(for)126 1362 A
1530(a)S
(free)168 1614 A
(file)168 1824 A
(descriptor)420 2034 A
(and)126 2496 A
2664(a)S
(free)168 2748 A
(filp)168 2958 A
(slot.)210 3168 A
(Fill)168 3462 A
3672(in)S
(the)126 3798 A
(mode)168 3966 A
(word)168 4176 A
6120 V
(22223)210 648 A
1068(*)S
1152(in)S
(the)126 1278 A
(latter,)294 1446 A
(but)126 1782 A
(don't)210 1950 A
(claim)210 2202 A
(either)252 2454 A
(one)126 2748 A
(yet,)168 2916 A
(since)210 3126 A
(the)126 3378 A
(open\(\))252 3546 A
3840(or)S
(creat\(\))294 3966 A
6210 V
(22224)210 648 A
1068(*)S
(may)126 1152 A
(yet)126 1320 A
(fail.)210 1488 A
8418 V
EP
%%Page: 302 302
BP
/slant 0 def
/height 0 def
630 V
12 B
(302)180 648 A
11 R
2098(File:)S
2331(src/fs/filedes.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(22225)210 648 A
1068(*/)S
990 V
(22226)210 648 A
1080 V
(22227)210 648 A
(register)336 1110 A
(struct)252 1488 A
(filp)168 1782 A
(*f;)126 1992 A
1170 V
(22228)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(i;)S
1260 V
(22229)210 648 A
1350 V
(22230)210 648 A
1110(*k)S
1236(=)S
(-1;)126 1320 A
2370(/*)S
2496(we)S
(need)168 2622 A
2832(a)S
(way)126 2916 A
3084(to)S
(tell)168 3210 A
3420(if)S
(file)168 3546 A
(desc)168 3756 A
(found)210 3966 A
4218(*/)S
1440 V
(22231)210 648 A
1530 V
(22232)210 648 A
1110(/*)S
(Search)252 1236 A
(the)126 1530 A
(fproc)210 1698 A
(fp_filp)294 1950 A
(table)210 2286 A
(for)126 2538 A
2706(a)S
(free)168 2790 A
(file)168 3000 A
(descriptor.)462 3210 A
3714(*/)S
1620 V
(22233)210 648 A
(for)126 1110 A
1278(\(i)S
1404(=)S
(start;)252 1488 A
1782(i)S
1866(<)S
(OPEN_MAX;)378 1950 A
(i++\))168 2370 A
2580({)S
1710 V
(22234)210 648 A
1362(if)S
(\(fp->fp_filp[i])630 1488 A
2160(==)S
(NIL_FILP\))378 2286 A
2706({)S
1800 V
(22235)210 648 A
1698(/*)S
1824(A)S
(file)168 1908 A
(descriptor)420 2118 A
(has)126 2580 A
(been)168 2748 A
(located.)336 2958 A
3336(*/)S
1890 V
(22236)210 648 A
1698(*k)S
1824(=)S
1908(i;)S
1980 V
(22237)210 648 A
(break;)252 1698 A
2070 V
(22238)210 648 A
1362(})S
2160 V
(22239)210 648 A
1110(})S
2250 V
(22240)210 648 A
2340 V
(22241)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
1908(a)S
(file)168 1992 A
(descriptor)420 2202 A
(has)126 2664 A
(been)168 2832 A
(found.)252 3042 A
3336(*/)S
2430 V
(22242)210 648 A
1110(if)S
(\(*k)126 1236 A
1404(<)S
1488(0\))S
(return\(EMFILE\);)630 1614 A
2370(/*)S
(this)168 2496 A
2706(is)S
(why)126 2832 A
3000(we)S
(initialized)462 3126 A
3630(k)S
3714(to)S
3840(-1)S
3966(*/)S
2520 V
(22243)210 648 A
2610 V
(22244)210 648 A
1110(/*)S
(Now)126 1236 A
(that)168 1404 A
1614(a)S
(file)168 1698 A
(descriptor)420 1908 A
(has)126 2370 A
(been)168 2538 A
(found,)252 2748 A
(look)168 3042 A
(for)126 3252 A
3420(a)S
(free)168 3504 A
(filp)168 3714 A
(slot.)210 3924 A
4176(*/)S
2700 V
(22245)210 648 A
(for)126 1110 A
1278(\(f)S
1404(=)S
(&filp[0];)378 1488 A
1908(f)S
1992(<)S
(&filp[NR_FILPS];)672 2076 A
(f++\))168 2790 A
3000({)S
2790 V
(22246)210 648 A
1362(if)S
(\(f->filp_count)588 1488 A
2118(==)S
2244(0\))S
2370({)S
2880 V
(22247)210 648 A
(f->filp_mode)504 1698 A
2244(=)S
(bits;)210 2328 A
2970 V
(22248)210 648 A
(f->filp_pos)462 1698 A
2202(=)S
(0L;)126 2286 A
3060 V
(22249)210 648 A
(f->filp_flags)546 1698 A
2286(=)S
2370(0;)S
3150 V
(22250)210 648 A
(*fpt)168 1698 A
1908(=)S
1992(f;)S
3240 V
(22251)210 648 A
(return\(OK\);)462 1698 A
3330 V
(22252)210 648 A
1362(})S
3420 V
(22253)210 648 A
1110(})S
3510 V
(22254)210 648 A
3600 V
(22255)210 648 A
1110(/*)S
1236(If)S
(control)294 1362 A
(passes)252 1698 A
(here,)210 1992 A
(the)126 2244 A
(filp)168 2412 A
(table)210 2622 A
(must)168 2874 A
3084(be)S
(full.)210 3210 A
(Report)252 3504 A
(that)168 3798 A
(back.)210 4008 A
4260(*/)S
3690 V
(22256)210 648 A
(return\(ENFILE\);)630 1110 A
3780 V
(22257)210 648 A
1026(})S
4050 V
(22260)210 648 A
(/*===========================================================================*)3276 1026 A
4140 V
(22261)210 648 A
1068(*)S
(get_filp)336 2370 A
4260(*)S
4230 V
(22262)210 648 A
(*===========================================================================*/)3276 1068 A
4320 V
(22263)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(filp)168 1614 A
(*get_filp\(fild\))630 1824 A
4410 V
(22264)210 648 A
(int)126 1026 A
(fild;)210 1194 A
2370(/*)S
(file)168 2496 A
(descriptor)420 2706 A
3168(*/)S
4500 V
(22265)210 648 A
1026({)S
4590 V
(22266)210 648 A
1026(/*)S
(See)126 1152 A
1320(if)S
('fild')252 1446 A
(refers)252 1740 A
2034(to)S
2160(a)S
(valid)210 2244 A
(file)168 2496 A
(descr.)252 2706 A
3042(If)S
(so,)126 3168 A
(return)252 3336 A
(its)126 3630 A
(filp)168 3798 A
(ptr.)168 4008 A
4218(*/)S
4680 V
(22267)210 648 A
4770 V
(22268)210 648 A
(err_code)336 1110 A
1488(=)S
(EBADF;)252 1572 A
4860 V
(22269)210 648 A
1110(if)S
(\(fild)210 1236 A
1488(<)S
1572(0)S
1656(||)S
(fild)168 1782 A
1992(>=)S
(OPEN_MAX)336 2118 A
2496(\))S
(return\(NIL_FILP\);)714 2580 A
4950 V
(22270)210 648 A
(return\(fp->fp_filp[fild]\);)1092 1110 A
2370(/*)S
(may)126 2496 A
(also)168 2664 A
2874(be)S
(NIL_FILP)336 3000 A
3378(*/)S
5040 V
(22271)210 648 A
1026(})S
5310 V
(22274)210 648 A
(/*===========================================================================*)3276 1026 A
5400 V
(22275)210 648 A
1068(*)S
(find_filp)378 2370 A
4260(*)S
5490 V
(22276)210 648 A
(*===========================================================================*/)3276 1068 A
5580 V
(22277)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(filp)168 1614 A
(*find_filp\(rip,)630 1824 A
(bits\))210 2496 A
5670 V
(22278)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(inode)210 2496 A
(referred)336 2748 A
3126(to)S
3252(by)S
(the)126 3378 A
(filp)168 3546 A
3756(to)S
3882(be)S
(found)210 4008 A
4260(*/)S
5760 V
(22279)210 648 A
(Mode_t)252 1026 A
(bits;)210 1320 A
2370(/*)S
(mode)168 2496 A
2706(of)S
(the)126 2832 A
(filp)168 3000 A
3210(to)S
3336(be)S
(found)210 3462 A
(\(RWX)168 3714 A
(bits\))210 3924 A
4176(*/)S
5850 V
(22280)210 648 A
1026({)S
5940 V
(22281)210 648 A
1026(/*)S
(Find)168 1152 A
1362(a)S
(filp)168 1446 A
(slot)168 1656 A
(that)168 1866 A
(refers)252 2076 A
2370(to)S
(the)126 2496 A
(inode)210 2664 A
('rip')210 2916 A
3168(in)S
3294(a)S
(way)126 3378 A
3546(as)S
(described)378 3672 A
6030 V
(22282)210 648 A
1068(*)S
1152(by)S
(the)126 1278 A
(mode)168 1446 A
(bit)126 1656 A
('bits'.)294 1824 A
(Used)168 2160 A
(for)126 2370 A
(determining)462 2538 A
(whether)294 3042 A
(somebody)336 3378 A
3756(is)S
(still)210 3882 A
6120 V
(22283)210 648 A
1068(*)S
(interested)420 1152 A
1614(in)S
(either)252 1740 A
(end)126 2034 A
2202(of)S
2328(a)S
(pipe.)210 2412 A
(Also)168 2706 A
(used)168 2916 A
(when)168 3126 A
(opening)294 3336 A
3672(a)S
(FIFO)168 3756 A
3966(to)S
6210 V
(22284)210 648 A
1068(*)S
(find)168 1152 A
(partners)336 1362 A
1740(to)S
(share)210 1866 A
2118(a)S
(filp)168 2202 A
(field)210 2412 A
(with)168 2664 A
(\(to)126 2874 A
(shared)252 3042 A
(the)126 3336 A
(file)168 3504 A
(position\).)420 3714 A
8418 V
EP
%%Page: 303 303
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2098(File:)S
2331(src/fs/filedes.c)S
12 B
(303)180 4248 A
900 V
7 LST
(22285)210 648 A
1068(*)S
(Like)168 1152 A
('get_fd')336 1362 A
1740(it)S
(performs)336 1866 A
(its)126 2244 A
(job)126 2412 A
2580(by)S
(linear)252 2706 A
(search)252 3000 A
(through)294 3294 A
(the)126 3630 A
(filp)168 3798 A
(table.)252 4008 A
990 V
(22286)210 648 A
1068(*/)S
1080 V
(22287)210 648 A
1170 V
(22288)210 648 A
(register)336 1110 A
(struct)252 1488 A
(filp)168 1782 A
(*f;)126 1992 A
1260 V
(22289)210 648 A
1350 V
(22290)210 648 A
(for)126 1110 A
1278(\(f)S
1404(=)S
(&filp[0];)378 1488 A
1908(f)S
1992(<)S
(&filp[NR_FILPS];)672 2076 A
(f++\))168 2790 A
3000({)S
1440 V
(22291)210 648 A
1362(if)S
(\(f->filp_count)588 1488 A
2118(!=)S
2244(0)S
2328(&&)S
(f->filp_ino)462 2454 A
2958(==)S
(rip)126 3084 A
3252(&&)S
(\(f->filp_mode)546 3378 A
3966(&)S
(bits\)\){)294 4050 A
1530 V
(22292)210 648 A
(return\(f\);)420 1698 A
1620 V
(22293)210 648 A
1362(})S
1710 V
(22294)210 648 A
1110(})S
1800 V
(22295)210 648 A
1890 V
(22296)210 648 A
1110(/*)S
1236(If)S
(control)294 1362 A
(passes)252 1698 A
(here,)210 1992 A
(the)126 2244 A
(filp)168 2412 A
(wasn't)252 2622 A
(there.)252 2916 A
(Report)252 3252 A
(that)168 3546 A
(back.)210 3756 A
4008(*/)S
1980 V
(22297)210 648 A
(return\(NIL_FILP\);)714 1110 A
2070 V
(22298)210 648 A
1026(})S
2340 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2430 V
(src/fs/lock.c)546 2034 A
2520 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2700 V
(22300)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(handles)294 1572 A
(advisory)336 1908 A
(file)168 2286 A
(locking)294 2496 A
2832(as)S
(required)336 2958 A
3336(by)S
(POSIX.)252 3462 A
2790 V
(22301)210 648 A
1068(*)S
2880 V
(22302)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
2970 V
(22303)210 648 A
1068(*)S
(lock_op:)336 1236 A
(perform)294 1698 A
(locking)294 2034 A
(operations)420 2370 A
(for)126 2832 A
(FCNTL)210 3000 A
(system)252 3252 A
(call)168 3546 A
3060 V
(22304)210 648 A
1068(*)S
(lock_revive:)504 1236 A
(revive)252 1782 A
(processes)378 2076 A
(when)168 2496 A
2706(a)S
(lock)168 2790 A
3000(is)S
(released)336 3126 A
3150 V
(22305)210 648 A
1068(*/)S
3240 V
(22306)210 648 A
3330 V
(22307)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
3420 V
(22308)210 648 A
(#include)336 1026 A
(<fcntl.h>)378 1404 A
3510 V
(22309)210 648 A
(#include)336 1026 A
(<unistd.h>)420 1404 A
2034(/*)S
2160(cc)S
(runs)168 2286 A
(out)126 2496 A
2664(of)S
(memory)252 2790 A
(with)168 3084 A
(unistd.h)336 3294 A
(:-\()126 3672 A
3840(*/)S
3600 V
(22310)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
3690 V
(22311)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
3780 V
(22312)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
3870 V
(22313)210 648 A
(#include)336 1026 A
("lock.h")336 1404 A
3960 V
(22314)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
4050 V
(22315)210 648 A
4140 V
(22316)210 648 A
(/*===========================================================================*)3276 1026 A
4230 V
(22317)210 648 A
1068(*)S
(lock_op)294 2370 A
4260(*)S
4320 V
(22318)210 648 A
(*===========================================================================*/)3276 1068 A
4410 V
(22319)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(lock_op\(f,)420 1488 A
(req\))168 1950 A
4500 V
(22320)210 648 A
(struct)252 1026 A
(filp)168 1320 A
(*f;)126 1530 A
4590 V
(22321)210 648 A
(int)126 1026 A
(req;)168 1194 A
2370(/*)S
(either)252 2496 A
(F_SETLK)294 2790 A
3126(or)S
(F_SETLKW)336 3252 A
3630(*/)S
4680 V
(22322)210 648 A
1026({)S
4770 V
(22323)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(advisory)336 1656 A
(locking)294 2034 A
(required)336 2370 A
2748(by)S
(POSIX.)252 2874 A
3168(*/)S
4860 V
(22324)210 648 A
4950 V
(22325)210 648 A
(int)126 1110 A
1278(r,)S
(ltype,)252 1404 A
1698(i,)S
(conflict)336 1824 A
2202(=)S
2286(0,)S
(unlocking)378 2412 A
2832(=)S
2916(0;)S
5040 V
(22326)210 648 A
(mode_t)252 1110 A
(mo;)126 1404 A
5130 V
(22327)210 648 A
(off_t)210 1110 A
(first,)252 1362 A
(last;)210 1656 A
5220 V
(22328)210 648 A
(struct)252 1110 A
(flock)210 1404 A
(flock;)252 1656 A
5310 V
(22329)210 648 A
(vir_bytes)378 1110 A
(user_flock;)462 1530 A
5400 V
(22330)210 648 A
(struct)252 1110 A
(file_lock)378 1404 A
(*flp,)210 1824 A
(*flp2,)252 2076 A
(*empty;)294 2370 A
5490 V
(22331)210 648 A
5580 V
(22332)210 648 A
1110(/*)S
(Fetch)210 1236 A
(the)126 1488 A
(flock)210 1656 A
(structure)378 1908 A
(from)168 2328 A
(user)168 2538 A
(space.)252 2748 A
3042(*/)S
5670 V
(22333)210 648 A
(user_flock)420 1110 A
1572(=)S
(\(vir_bytes\))462 1656 A
(name1;)252 2160 A
5760 V
(22334)210 648 A
1110(r)S
1194(=)S
(sys_copy\(who,)546 1278 A
1866(D,)S
(\(phys_bytes\))504 1992 A
(user_flock,)462 2538 A
5850 V
(22335)210 648 A
(FS_PROC_NR,)462 1362 A
1866(D,)S
(\(phys_bytes\))504 1992 A
(&flock,)294 2538 A
(\(phys_bytes\))504 2874 A
(sizeof\(flock\)\);)630 3420 A
5940 V
(22336)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
(return\(EINVAL\);)630 1656 A
6030 V
(22337)210 648 A
6120 V
(22338)210 648 A
1110(/*)S
(Make)168 1236 A
(some)168 1446 A
(error)210 1656 A
(checks.)294 1908 A
2244(*/)S
6210 V
(22339)210 648 A
(ltype)210 1110 A
1362(=)S
(flock.l_type;)546 1446 A
8418 V
EP
%%Page: 304 304
BP
/slant 0 def
/height 0 def
630 V
12 B
(304)180 648 A
11 R
2151(File:)S
2384(src/fs/lock.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(22340)210 648 A
1110(mo)S
1236(=)S
(f->filp_mode;)546 1320 A
990 V
(22341)210 648 A
1110(if)S
(\(ltype)252 1236 A
1530(!=)S
(F_UNLCK)294 1656 A
1992(&&)S
(ltype)210 2118 A
2370(!=)S
(F_RDLCK)294 2496 A
2832(&&)S
(ltype)210 2958 A
3210(!=)S
(F_WRLCK\))336 3336 A
(return\(EINVAL\);)630 3714 A
1080 V
(22342)210 648 A
1110(if)S
(\(req)168 1236 A
1446(==)S
(F_GETLK)294 1572 A
1908(&&)S
(ltype)210 2034 A
2286(==)S
(F_UNLCK\))336 2412 A
(return\(EINVAL\);)630 2790 A
1170 V
(22343)210 648 A
1110(if)S
1236(\()S
(\(f->filp_ino->i_mode)840 1320 A
2202(&)S
(I_TYPE\))294 2286 A
2622(!=)S
(I_REGULAR\))420 2748 A
(return\(EINVAL\);)630 3210 A
1260 V
(22344)210 648 A
1110(if)S
(\(req)168 1236 A
1446(!=)S
(F_GETLK)294 1572 A
1908(&&)S
(ltype)210 2034 A
2286(==)S
(F_RDLCK)294 2412 A
2748(&&)S
(\(mo)126 2874 A
3042(&)S
(R_BIT\))252 3126 A
3420(==)S
3546(0\))S
(return\(EBADF\);)588 3672 A
1350 V
(22345)210 648 A
1110(if)S
(\(req)168 1236 A
1446(!=)S
(F_GETLK)294 1572 A
1908(&&)S
(ltype)210 2034 A
2286(==)S
(F_WRLCK)294 2412 A
2748(&&)S
(\(mo)126 2874 A
3042(&)S
(W_BIT\))252 3126 A
3420(==)S
3546(0\))S
(return\(EBADF\);)588 3672 A
1440 V
(22346)210 648 A
1530 V
(22347)210 648 A
1110(/*)S
(Compute)294 1236 A
(the)126 1572 A
(first)210 1740 A
(and)126 1992 A
(last)168 2160 A
(bytes)210 2370 A
2622(in)S
(the)126 2748 A
(lock)168 2916 A
(region.)294 3126 A
3462(*/)S
1620 V
(22348)210 648 A
(switch)252 1110 A
(\(flock.l_whence\))672 1404 A
2118({)S
1710 V
(22349)210 648 A
(case)168 1362 A
(SEEK_SET:)378 1572 A
(first)210 2034 A
2286(=)S
2370(0;)S
(break;)252 2496 A
1800 V
(22350)210 648 A
(case)168 1362 A
(SEEK_CUR:)378 1572 A
(first)210 2034 A
2286(=)S
(f->filp_pos;)504 2370 A
(break;)252 2916 A
1890 V
(22351)210 648 A
(case)168 1362 A
(SEEK_END:)378 1572 A
(first)210 2034 A
2286(=)S
(f->filp_ino->i_size;)840 2370 A
(break;)252 3252 A
1980 V
(22352)210 648 A
(default:)336 1362 A
(return\(EINVAL\);)630 2034 A
2070 V
(22353)210 648 A
1110(})S
2160 V
(22354)210 648 A
1110(/*)S
(Check)210 1236 A
(for)126 1488 A
(overflow.)378 1656 A
2076(*/)S
2250 V
(22355)210 648 A
1110(if)S
(\(\(\(long\)flock.l_start)882 1236 A
2160(>)S
2244(0\))S
2370(&&)S
(\(\(first)294 2496 A
2832(+)S
(flock.l_start\))588 2916 A
3546(<)S
(first\)\))294 3630 A
2340 V
(22356)210 648 A
(return\(EINVAL\);)630 1362 A
2430 V
(22357)210 648 A
1110(if)S
(\(\(\(long\)flock.l_start)882 1236 A
2160(<)S
2244(0\))S
2370(&&)S
(\(\(first)294 2496 A
2832(+)S
(flock.l_start\))588 2916 A
3546(>)S
(first\)\))294 3630 A
2520 V
(22358)210 648 A
(return\(EINVAL\);)630 1362 A
2610 V
(22359)210 648 A
(first)210 1110 A
1362(=)S
(first)210 1446 A
1698(+)S
(flock.l_start;)588 1782 A
2700 V
(22360)210 648 A
(last)168 1110 A
1320(=)S
(first)210 1404 A
1656(+)S
(flock.l_len)462 1740 A
2244(-)S
2328(1;)S
2790 V
(22361)210 648 A
1110(if)S
(\(flock.l_len)504 1236 A
1782(==)S
1908(0\))S
(last)168 2034 A
2244(=)S
(MAX_FILE_POS;)546 2328 A
2880 V
(22362)210 648 A
1110(if)S
(\(last)210 1236 A
1488(<)S
(first\))252 1572 A
(return\(EINVAL\);)630 1866 A
2970 V
(22363)210 648 A
3060 V
(22364)210 648 A
1110(/*)S
(Check)210 1236 A
1488(if)S
(this)168 1614 A
(region)252 1824 A
(conflicts)378 2118 A
(with)168 2538 A
(any)126 2748 A
(existing)336 2916 A
(lock.)210 3294 A
3546(*/)S
3150 V
(22365)210 648 A
(empty)210 1110 A
1362(=)S
(\(struct)294 1446 A
(file_lock)378 1782 A
2202(*\))S
2328(0;)S
3240 V
(22366)210 648 A
(for)126 1110 A
(\(flp)168 1278 A
1488(=)S
(&file_lock[0];)588 1572 A
(flp)126 2202 A
2370(<)S
2454(&)S
(file_lock[NR_LOCKS];)840 2538 A
(flp++\))252 3420 A
3714({)S
3330 V
(22367)210 648 A
1362(if)S
(\(flp->lock_type)630 1488 A
2160(==)S
2286(0\))S
2412({)S
3420 V
(22368)210 648 A
1698(if)S
(\(empty)252 1824 A
2118(==)S
(\(struct)294 2244 A
(file_lock)378 2580 A
3000(*\))S
3126(0\))S
(empty)210 3252 A
3504(=)S
(flp;)168 3588 A
3510 V
(22369)210 648 A
(continue;)378 1698 A
2370(/*)S
2496(0)S
(means)210 2580 A
(unused)252 2832 A
(slot)168 3126 A
3336(*/)S
3600 V
(22370)210 648 A
1362(})S
3690 V
(22371)210 648 A
1362(if)S
(\(flp->lock_inode)672 1488 A
2202(!=)S
(f->filp_ino\))504 2328 A
(continue;)378 2874 A
3378(/*)S
(different)378 3504 A
(file)168 3924 A
4134(*/)S
3780 V
(22372)210 648 A
1362(if)S
(\(last)210 1488 A
1740(<)S
(flp->lock_first\))672 1824 A
(continue;)378 2538 A
3042(/*)S
(new)126 3168 A
(one)126 3336 A
3504(is)S
3630(in)S
(front)210 3756 A
4008(*/)S
3870 V
(22373)210 648 A
1362(if)S
(\(first)252 1488 A
1782(>)S
(flp->lock_last\))630 1866 A
(continue;)378 2538 A
3042(/*)S
(new)126 3168 A
(one)126 3336 A
3504(is)S
(afterwards)420 3630 A
4092(*/)S
3960 V
(22374)210 648 A
1362(if)S
(\(ltype)252 1488 A
1782(==)S
(F_RDLCK)294 1908 A
2244(&&)S
(flp->lock_type)588 2370 A
3000(==)S
(F_RDLCK\))336 3126 A
(continue;)378 3504 A
4050 V
(22375)210 648 A
1362(if)S
(\(ltype)252 1488 A
1782(!=)S
(F_UNLCK)294 1908 A
2244(&&)S
(flp->lock_pid)546 2370 A
2958(==)S
(fp->fp_pid\))462 3084 A
(continue;)378 3588 A
4140 V
(22376)210 648 A
4230 V
(22377)210 648 A
1362(/*)S
(There)210 1488 A
(might)210 1740 A
1992(be)S
2118(a)S
(conflict.)378 2202 A
(Process)294 2664 A
(it.)126 3000 A
3168(*/)S
4320 V
(22378)210 648 A
(conflict)336 1362 A
1740(=)S
1824(1;)S
4410 V
(22379)210 648 A
1362(if)S
(\(req)168 1488 A
1698(==)S
(F_GETLK\))336 1824 A
(break;)252 2202 A
4500 V
(22380)210 648 A
4590 V
(22381)210 648 A
1362(/*)S
1488(If)S
1614(we)S
(are)126 1740 A
(trying)252 1908 A
2202(to)S
(set)126 2328 A
2496(a)S
(lock,)210 2580 A
2832(it)S
(just)168 2958 A
(failed.)294 3168 A
3504(*/)S
4680 V
(22382)210 648 A
1362(if)S
(\(ltype)252 1488 A
1782(==)S
(F_RDLCK)294 1908 A
2244(||)S
(ltype)210 2370 A
2622(==)S
(F_WRLCK\))336 2748 A
3126({)S
4770 V
(22383)210 648 A
1698(if)S
(\(req)168 1824 A
2034(==)S
(F_SETLK\))336 2160 A
2538({)S
4860 V
(22384)210 648 A
2034(/*)S
(For)126 2160 A
(F_SETLK,)336 2328 A
(just)168 2706 A
(report)252 2916 A
(back)168 3210 A
(failure.)336 3420 A
3798(*/)S
4950 V
(22385)210 648 A
(return\(EAGAIN\);)630 2034 A
5040 V
(22386)210 648 A
1698(})S
(else)168 1782 A
1992({)S
5130 V
(22387)210 648 A
2034(/*)S
(For)126 2160 A
(F_SETLKW,)378 2328 A
(suspend)294 2748 A
(the)126 3084 A
(process.)336 3252 A
3630(*/)S
5220 V
(22388)210 648 A
(suspend\(XLOCK\);)630 2034 A
5310 V
(22389)210 648 A
(return\(0\);)420 2034 A
5400 V
(22390)210 648 A
1698(})S
5490 V
(22391)210 648 A
1362(})S
5580 V
(22392)210 648 A
5670 V
(22393)210 648 A
1362(/*)S
1488(We)S
(are)126 1614 A
(clearing)336 1782 A
2160(a)S
(lock)168 2244 A
(and)126 2454 A
2622(we)S
(found)210 2748 A
(something)378 3000 A
(that)168 3420 A
(overlaps.)378 3630 A
4050(*/)S
5760 V
(22394)210 648 A
(unlocking)378 1362 A
1782(=)S
1866(1;)S
5850 V
(22395)210 648 A
1362(if)S
(\(first)252 1488 A
1782(<=)S
(flp->lock_first)630 1908 A
2580(&&)S
(last)168 2706 A
2916(>=)S
(flp->lock_last\))630 3042 A
3714({)S
5940 V
(22396)210 648 A
(flp->lock_type)588 1698 A
2328(=)S
2412(0;)S
2706(/*)S
(mark)168 2832 A
(slot)168 3042 A
3252(as)S
(unused)252 3378 A
3672(*/)S
6030 V
(22397)210 648 A
(nr_locks--;)462 1698 A
2706(/*)S
(number)252 2832 A
3126(of)S
(locks)210 3252 A
3504(is)S
(now)126 3630 A
3798(1)S
(less)168 3882 A
4092(*/)S
6120 V
(22398)210 648 A
(continue;)378 1698 A
6210 V
(22399)210 648 A
1362(})S
8418 V
EP
%%Page: 305 305
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2151(File:)S
2384(src/fs/lock.c)S
12 B
(305)180 4248 A
900 V
7 LST
(22400)210 648 A
990 V
(22401)210 648 A
1362(/*)S
(Part)168 1488 A
1698(of)S
1824(a)S
(locked)252 1908 A
(region)252 2202 A
(has)126 2496 A
(been)168 2664 A
(unlocked.)378 2874 A
3294(*/)S
1080 V
(22402)210 648 A
1362(if)S
(\(first)252 1488 A
1782(<=)S
(flp->lock_first\))672 1908 A
2622({)S
1170 V
(22403)210 648 A
(flp->lock_first)630 1698 A
2370(=)S
(last)168 2454 A
2664(+)S
2748(1;)S
1260 V
(22404)210 648 A
(continue;)378 1698 A
1350 V
(22405)210 648 A
1362(})S
1440 V
(22406)210 648 A
1530 V
(22407)210 648 A
1362(if)S
(\(last)210 1488 A
1740(>=)S
(flp->lock_last\))630 1866 A
2538({)S
1620 V
(22408)210 648 A
(flp->lock_last)588 1698 A
2328(=)S
(first)210 2412 A
2664(-)S
2748(1;)S
1710 V
(22409)210 648 A
(continue;)378 1698 A
1800 V
(22410)210 648 A
1362(})S
1890 V
(22411)210 648 A
1980 V
(22412)210 648 A
1362(/*)S
(Bad)126 1488 A
(luck.)210 1656 A
1908(A)S
(lock)168 1992 A
(has)126 2202 A
(been)168 2370 A
(split)210 2580 A
2832(in)S
(two)126 2958 A
3126(by)S
(unlocking)378 3252 A
(the)126 3672 A
(middle.)294 3840 A
4176(*/)S
2070 V
(22413)210 648 A
1362(if)S
(\(nr_locks)378 1488 A
1908(==)S
(NR_LOCKS\))378 2034 A
(return\(ENOLCK\);)630 2454 A
2160 V
(22414)210 648 A
(for)126 1362 A
1530(\(i)S
1656(=)S
1740(0;)S
1866(i)S
1950(<)S
(NR_LOCKS;)378 2034 A
(i++\))168 2454 A
2250 V
(22415)210 648 A
1698(if)S
(\(file_lock[i].lock_type)966 1824 A
2832(==)S
2958(0\))S
(break;)252 3084 A
2340 V
(22416)210 648 A
(flp2)168 1362 A
1572(=)S
(&file_lock[i];)588 1656 A
2430 V
(22417)210 648 A
(flp2->lock_type)630 1362 A
2034(=)S
(flp->lock_type;)630 2118 A
2520 V
(22418)210 648 A
(flp2->lock_pid)588 1362 A
1992(=)S
(flp->lock_pid;)588 2076 A
2610 V
(22419)210 648 A
(flp2->lock_inode)672 1362 A
2076(=)S
(flp->lock_inode;)672 2160 A
2700 V
(22420)210 648 A
(flp2->lock_first)672 1362 A
2076(=)S
(last)168 2160 A
2370(+)S
2454(1;)S
2790 V
(22421)210 648 A
(flp2->lock_last)630 1362 A
2034(=)S
(flp->lock_last;)630 2118 A
2880 V
(22422)210 648 A
(flp->lock_last)588 1362 A
1992(=)S
(first)210 2076 A
2328(-)S
2412(1;)S
2970 V
(22423)210 648 A
(nr_locks++;)462 1362 A
3060 V
(22424)210 648 A
1110(})S
3150 V
(22425)210 648 A
1110(if)S
(\(unlocking\))462 1236 A
(lock_revive\(\);)588 1740 A
3240 V
(22426)210 648 A
3330 V
(22427)210 648 A
1110(if)S
(\(req)168 1236 A
1446(==)S
(F_GETLK\))336 1572 A
1950({)S
3420 V
(22428)210 648 A
1362(if)S
(\(conflict\))420 1488 A
1950({)S
3510 V
(22429)210 648 A
1698(/*)S
(GETLK)210 1824 A
(and)126 2076 A
(conflict.)378 2244 A
(Report)252 2664 A
2958(on)S
(the)126 3084 A
(conflicting)462 3252 A
(lock.)210 3756 A
4008(*/)S
3600 V
(22430)210 648 A
(flock.l_type)504 1698 A
2244(=)S
(flp->lock_type;)630 2328 A
3690 V
(22431)210 648 A
(flock.l_whence)588 1698 A
2328(=)S
(SEEK_SET;)378 2412 A
3780 V
(22432)210 648 A
(flock.l_start)546 1698 A
2286(=)S
(flp->lock_first;)672 2370 A
3870 V
(22433)210 648 A
(flock.l_len)462 1698 A
2202(=)S
(flp->lock_last)588 2286 A
2916(-)S
(flp->lock_first)630 3000 A
3672(+)S
3756(1;)S
3960 V
(22434)210 648 A
(flock.l_pid)462 1698 A
2202(=)S
(flp->lock_pid;)588 2286 A
4050 V
(22435)210 648 A
4140 V
(22436)210 648 A
1362(})S
(else)168 1446 A
1656({)S
4230 V
(22437)210 648 A
1698(/*)S
1824(It)S
1950(is)S
(GETLK)210 2076 A
(and)126 2328 A
(there)210 2496 A
2748(is)S
2874(no)S
(conflict.)378 3000 A
3420(*/)S
4320 V
(22438)210 648 A
(flock.l_type)504 1698 A
2244(=)S
(F_UNLCK;)336 2328 A
4410 V
(22439)210 648 A
1362(})S
4500 V
(22440)210 648 A
4590 V
(22441)210 648 A
1362(/*)S
(Copy)168 1488 A
(the)126 1698 A
(flock)210 1866 A
(structure)378 2118 A
(back)168 2538 A
2748(to)S
(the)126 2874 A
(caller.)294 3042 A
3378(*/)S
4680 V
(22442)210 648 A
1362(r)S
1446(=)S
(sys_copy\(FS_PROC_NR,)840 1530 A
2412(D,)S
(\(phys_bytes\))504 2538 A
(&flock,)294 3084 A
4770 V
(22443)210 648 A
(who,)168 1698 A
1908(D,)S
(\(phys_bytes\))504 2034 A
(user_flock,)462 2580 A
(\(phys_bytes\))504 3084 A
(sizeof\(flock\)\);)630 3630 A
4860 V
(22444)210 648 A
(return\(r\);)420 1362 A
4950 V
(22445)210 648 A
1110(})S
5040 V
(22446)210 648 A
5130 V
(22447)210 648 A
1110(if)S
(\(ltype)252 1236 A
1530(==)S
(F_UNLCK\))336 1656 A
(return\(OK\);)462 2034 A
2706(/*)S
(unlocked)336 2832 A
3210(a)S
(region)252 3294 A
(with)168 3588 A
3798(no)S
(locks)210 3924 A
4176(*/)S
5220 V
(22448)210 648 A
5310 V
(22449)210 648 A
1110(/*)S
(There)210 1236 A
1488(is)S
1614(no)S
(conflict.)378 1740 A
2202(If)S
(space)210 2328 A
(exists,)294 2580 A
(store)210 2916 A
(new)126 3168 A
(lock)168 3336 A
3546(in)S
(the)126 3672 A
(table.)252 3840 A
4134(*/)S
5400 V
(22450)210 648 A
1110(if)S
(\(empty)252 1236 A
1530(==)S
(\(struct)294 1656 A
(file_lock)378 1992 A
2412(*\))S
2538(0\))S
(return\(ENOLCK\);)630 2664 A
3378(/*)S
(table)210 3504 A
(full)168 3756 A
3966(*/)S
5490 V
(22451)210 648 A
(empty->lock_type)672 1110 A
1824(=)S
(ltype;)252 1908 A
5580 V
(22452)210 648 A
(empty->lock_pid)630 1110 A
1782(=)S
(fp->fp_pid;)462 1866 A
5670 V
(22453)210 648 A
(empty->lock_inode)714 1110 A
1866(=)S
(f->filp_ino;)504 1950 A
5760 V
(22454)210 648 A
(empty->lock_first)714 1110 A
1866(=)S
(first;)252 1950 A
5850 V
(22455)210 648 A
(empty->lock_last)672 1110 A
1824(=)S
(last;)210 1908 A
5940 V
(22456)210 648 A
(nr_locks++;)462 1110 A
6030 V
(22457)210 648 A
(return\(OK\);)462 1110 A
6120 V
(22458)210 648 A
1026(})S
8418 V
EP
%%Page: 306 306
BP
/slant 0 def
/height 0 def
630 V
12 B
(306)180 648 A
11 R
2151(File:)S
2384(src/fs/lock.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(22460)210 648 A
(/*===========================================================================*)3276 1026 A
990 V
(22461)210 648 A
1068(*)S
(lock_revive)462 2370 A
4260(*)S
1080 V
(22462)210 648 A
(*===========================================================================*/)3276 1068 A
1170 V
(22463)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(lock_revive\(\))546 1530 A
1260 V
(22464)210 648 A
1026({)S
1350 V
(22465)210 648 A
1026(/*)S
1152(Go)S
(find)168 1278 A
(all)126 1488 A
(the)126 1656 A
(processes)378 1824 A
(that)168 2244 A
(are)126 2454 A
(waiting)294 2622 A
(for)126 2958 A
(any)126 3126 A
(kind)168 3294 A
3504(of)S
(lock)168 3630 A
(and)126 3840 A
1440 V
(22466)210 648 A
1068(*)S
(revive)252 1152 A
(them)168 1446 A
(all.)168 1656 A
(The)126 1908 A
(ones)168 2076 A
(that)168 2286 A
(are)126 2496 A
(still)210 2664 A
(blocked)294 2916 A
(will)168 3252 A
(block)210 3462 A
(again)210 3714 A
(when)168 3966 A
1530 V
(22467)210 648 A
1068(*)S
(they)168 1152 A
(run.)168 1362 A
(The)126 1614 A
(others)252 1782 A
(will)168 2076 A
(complete.)378 2286 A
(This)168 2748 A
(strategy)336 2958 A
3336(is)S
3462(a)S
(space-time)420 3546 A
1620 V
(22468)210 648 A
1068(*)S
(tradeoff.)378 1152 A
(Figuring)336 1614 A
(out)126 1992 A
(exactly)294 2160 A
(which)210 2496 A
(ones)168 2748 A
2958(to)S
(unblock)294 3084 A
(now)126 3420 A
(would)210 3588 A
(take)168 3840 A
1710 V
(22469)210 648 A
1068(*)S
(extra)210 1152 A
(code,)210 1404 A
(and)126 1656 A
(the)126 1824 A
(only)168 1992 A
(thing)210 2202 A
2454(it)S
(would)210 2580 A
(win)126 2832 A
(would)210 3000 A
3252(be)S
(some)168 3378 A
(performance)462 3588 A
4092(in)S
1800 V
(22470)210 648 A
1068(*)S
(extremely)378 1152 A
(rare)168 1572 A
(circumstances)546 1782 A
(\(namely,)336 2370 A
(that)168 2748 A
(somebody)336 2958 A
(actually)336 3336 A
(used)168 3714 A
1890 V
(22471)210 648 A
1068(*)S
(locking\).)378 1152 A
1980 V
(22472)210 648 A
1068(*/)S
2070 V
(22473)210 648 A
2160 V
(22474)210 648 A
(int)126 1110 A
(task;)210 1278 A
2250 V
(22475)210 648 A
(struct)252 1110 A
(fproc)210 1404 A
(*fptr;)252 1656 A
2340 V
(22476)210 648 A
2430 V
(22477)210 648 A
(for)126 1110 A
(\(fptr)210 1278 A
1530(=)S
(&fproc[INIT_PROC_NR)798 1614 A
2454(+)S
(1];)126 2538 A
(fptr)168 2706 A
2916(<)S
(&fproc[NR_PROCS];)714 3000 A
(fptr++\){)336 3756 A
2520 V
(22478)210 648 A
(task)168 1362 A
1572(=)S
(-fptr->fp_task;)630 1656 A
2610 V
(22479)210 648 A
1362(if)S
(\(fptr->fp_suspended)798 1488 A
2328(==)S
(SUSPENDED)378 2454 A
2874(&&)S
(task)168 3000 A
3210(==)S
(XLOCK\))252 3336 A
3630({)S
2700 V
(22480)210 648 A
(revive\()294 1698 A
(\(int\))210 2034 A
(\(fptr)210 2286 A
2538(-)S
(fproc\),)294 2622 A
(0\);)126 2958 A
2790 V
(22481)210 648 A
1362(})S
2880 V
(22482)210 648 A
1110(})S
2970 V
(22483)210 648 A
1026(})S
3240 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3330 V
(src/fs/main.c)546 2034 A
3420 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3600 V
(22500)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(main)168 2118 A
(program)294 2328 A
2664(of)S
(the)126 2790 A
(File)168 2958 A
(System.)294 3168 A
3546(It)S
(consists)336 3672 A
4050(of)S
3690 V
(22501)210 648 A
1068(*)S
1152(a)S
(loop)168 1236 A
(that)168 1446 A
(gets)168 1656 A
(messages)336 1866 A
(requesting)420 2244 A
(work,)210 2706 A
(carries)294 2958 A
(out)126 3294 A
(the)126 3462 A
(work,)210 3630 A
(and)126 3882 A
(sends)210 4050 A
3780 V
(22502)210 648 A
1068(*)S
(replies.)336 1152 A
3870 V
(22503)210 648 A
1068(*)S
3960 V
(22504)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
4050 V
(22505)210 648 A
1068(*)S
(main:)210 1236 A
(main)168 1698 A
(program)294 1908 A
2244(of)S
(the)126 2370 A
(File)168 2538 A
(System)252 2748 A
4140 V
(22506)210 648 A
1068(*)S
(reply:)252 1236 A
(send)168 1698 A
1908(a)S
(reply)210 1992 A
2244(to)S
2370(a)S
(process)294 2454 A
(after)210 2790 A
(the)126 3042 A
(requested)378 3210 A
(work)168 3630 A
3840(is)S
(done)168 3966 A
4230 V
(22507)210 648 A
1068(*/)S
4320 V
(22508)210 648 A
4410 V
(22509)210 648 A
(struct)252 1026 A
(super_block;)504 1320 A
2370(/*)S
(proto.h)294 2496 A
(needs)210 2832 A
3084(to)S
(know)168 3210 A
(this)168 3420 A
3630(*/)S
4500 V
(22510)210 648 A
4590 V
(22511)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
4680 V
(22512)210 648 A
(#include)336 1026 A
(<fcntl.h>)378 1404 A
4770 V
(22513)210 648 A
(#include)336 1026 A
(<string.h>)420 1404 A
4860 V
(22514)210 648 A
(#include)336 1026 A
(<sys/ioctl.h>)546 1404 A
4950 V
(22515)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
5040 V
(22516)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
5130 V
(22517)210 648 A
(#include)336 1026 A
(<minix/boot.h>)588 1404 A
5220 V
(22518)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
5310 V
(22519)210 648 A
(#include)336 1026 A
("dev.h")294 1404 A
5400 V
(22520)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
5490 V
(22521)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
5580 V
(22522)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
5670 V
(22523)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
5760 V
(22524)210 648 A
(#include)336 1026 A
("super.h")378 1404 A
5850 V
(22525)210 648 A
5940 V
(22526)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(buf_pool,)378 2076 A
(\(void\))252 2496 A
4050(\);)S
6030 V
(22527)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(fs_init,)336 2076 A
(\(void\))252 2454 A
4050(\);)S
6120 V
(22528)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(get_boot_parameters,)840 2076 A
(\(void\))252 2958 A
4050(\);)S
6210 V
(22529)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(get_work,)378 2076 A
(\(void\))252 2496 A
4050(\);)S
8418 V
EP
%%Page: 307 307
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2135(File:)S
2368(src/fs/main.c)S
12 B
(307)180 4248 A
900 V
7 LST
(22530)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(load_ram,)378 2076 A
(\(void\))252 2496 A
4050(\);)S
990 V
(22531)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(load_super,)462 2076 A
(\(Dev_t)252 2580 A
(super_dev\))420 2874 A
4050(\);)S
1080 V
(22532)210 648 A
1170 V
(22533)210 648 A
1260 V
(22534)210 648 A
(/*===========================================================================*)3276 1026 A
1350 V
(22535)210 648 A
1068(*)S
(main)168 2370 A
4260(*)S
1440 V
(22536)210 648 A
(*===========================================================================*/)3276 1068 A
1530 V
(22537)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(main\(\))252 1530 A
1620 V
(22538)210 648 A
1026({)S
1710 V
(22539)210 648 A
1026(/*)S
(This)168 1152 A
1362(is)S
(the)126 1488 A
(main)168 1656 A
(program)294 1866 A
2202(of)S
(the)126 2328 A
(file)168 2496 A
(system.)294 2706 A
(The)126 3084 A
(main)168 3252 A
(loop)168 3462 A
(consists)336 3672 A
4050(of)S
1800 V
(22540)210 648 A
1068(*)S
(three)210 1152 A
(major)210 1404 A
(activities:)462 1656 A
(getting)294 2160 A
(new)126 2496 A
(work,)210 2664 A
(processing)420 2916 A
(the)126 3378 A
(work,)210 3546 A
(and)126 3798 A
(sending)294 3966 A
1890 V
(22541)210 648 A
1068(*)S
(the)126 1152 A
(reply.)252 1320 A
(This)168 1656 A
(loop)168 1866 A
(never)210 2076 A
(terminates)420 2328 A
2790(as)S
(long)168 2916 A
3126(as)S
(the)126 3252 A
(file)168 3420 A
(system)252 3630 A
(runs.)210 3924 A
1980 V
(22542)210 648 A
1068(*/)S
2070 V
(22543)210 648 A
(int)126 1110 A
(error;)252 1278 A
2160 V
(22544)210 648 A
2250 V
(22545)210 648 A
(fs_init\(\);)420 1110 A
2340 V
(22546)210 648 A
2430 V
(22547)210 648 A
1110(/*)S
(This)168 1236 A
1446(is)S
(the)126 1572 A
(main)168 1740 A
(loop)168 1950 A
(that)168 2160 A
(gets)168 2370 A
(work,)210 2580 A
(processes)378 2832 A
(it,)126 3252 A
(and)126 3420 A
(sends)210 3588 A
(replies.)336 3840 A
4218(*/)S
2520 V
(22548)210 648 A
(while)210 1110 A
(\(TRUE\))252 1362 A
1656({)S
2610 V
(22549)210 648 A
(get_work\(\);)462 1362 A
2370(/*)S
(sets)168 2496 A
(who)126 2706 A
(and)126 2874 A
(fs_call)294 3042 A
3378(*/)S
2700 V
(22550)210 648 A
2790 V
(22551)210 648 A
1362(fp)S
1488(=)S
(&fproc[who];)504 1572 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(proc)168 2958 A
(table)210 3168 A
(struct)252 3420 A
3714(*/)S
2880 V
(22552)210 648 A
(super_user)420 1362 A
1824(=)S
(\(fp->fp_effuid)588 1908 A
2538(==)S
(SU_UID)252 2664 A
2958(?)S
(TRUE)168 3042 A
3252(:)S
(FALSE\);)294 3336 A
3756(/*)S
(su?)126 3882 A
4050(*/)S
2970 V
(22553)210 648 A
(dont_reply)420 1362 A
1824(=)S
(FALSE;)252 1908 A
2370(/*)S
2496(in)S
(other)210 2622 A
(words,)252 2874 A
3168(do)S
(reply)210 3294 A
3546(is)S
(default)294 3672 A
4008(*/)S
3060 V
(22554)210 648 A
3150 V
(22555)210 648 A
1362(/*)S
(Call)168 1488 A
(the)126 1698 A
(internal)336 1866 A
(function)336 2244 A
(that)168 2622 A
(does)168 2832 A
(the)126 3042 A
(work.)210 3210 A
3462(*/)S
3240 V
(22556)210 648 A
1362(if)S
(\(fs_call)336 1488 A
1866(<)S
1950(0)S
2034(||)S
(fs_call)294 2160 A
2496(>=)S
(NCALLS\))294 2622 A
3330 V
(22557)210 648 A
(error)210 1698 A
1950(=)S
(EBADCALL;)378 2034 A
3420 V
(22558)210 648 A
(else)168 1362 A
3510 V
(22559)210 648 A
(error)210 1698 A
1950(=)S
(\(*call_vector[fs_call]\)\(\);)1092 2034 A
3600 V
(22560)210 648 A
3690 V
(22561)210 648 A
1362(/*)S
(Copy)168 1488 A
(the)126 1698 A
(results)294 1866 A
(back)168 2202 A
2412(to)S
(the)126 2538 A
(user)168 2706 A
(and)126 2916 A
(send)168 3084 A
(reply.)252 3294 A
3588(*/)S
3780 V
(22562)210 648 A
1362(if)S
(\(dont_reply\))504 1488 A
(continue;)378 2034 A
3870 V
(22563)210 648 A
(reply\(who,)420 1362 A
(error\);)294 1824 A
3960 V
(22564)210 648 A
1362(if)S
(\(rdahed_inode)546 1488 A
2076(!=)S
(NIL_INODE\))420 2202 A
(read_ahead\(\);)546 2664 A
3252(/*)S
3378(do)S
(block)210 3504 A
(read)168 3756 A
(ahead)210 3966 A
4218(*/)S
4050 V
(22565)210 648 A
1110(})S
4140 V
(22566)210 648 A
1026(})S
4410 V
(22569)210 648 A
(/*===========================================================================*)3276 1026 A
4500 V
(22570)210 648 A
1068(*)S
(get_work)336 2370 A
4260(*)S
4590 V
(22571)210 648 A
(*===========================================================================*/)3276 1068 A
4680 V
(22572)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(get_work\(\))420 1572 A
4770 V
(22573)210 648 A
1026({)S
4860 V
(22574)210 648 A
1110(/*)S
(Normally)336 1236 A
(wait)168 1614 A
(for)126 1824 A
(new)126 1992 A
(input.)252 2160 A
(However,)336 2496 A
2874(if)S
('reviving')420 3000 A
3462(is)S
4950 V
(22575)210 648 A
1152(*)S
(nonzero,)336 1236 A
1614(a)S
(suspended)378 1698 A
(process)294 2118 A
(must)168 2454 A
2664(be)S
(awakened.)378 2790 A
5040 V
(22576)210 648 A
1152(*/)S
5130 V
(22577)210 648 A
5220 V
(22578)210 648 A
(register)336 1110 A
(struct)252 1488 A
(fproc)210 1782 A
(*rp;)168 2034 A
5310 V
(22579)210 648 A
5400 V
(22580)210 648 A
1110(if)S
(\(reviving)378 1236 A
1656(!=)S
1782(0\))S
1908({)S
5490 V
(22581)210 648 A
1362(/*)S
(Revive)252 1488 A
1782(a)S
(suspended)378 1866 A
(process.)336 2286 A
2664(*/)S
5580 V
(22582)210 648 A
(for)126 1362 A
(\(rp)126 1530 A
1698(=)S
(&fproc[0];)420 1782 A
2244(rp)S
2370(<)S
(&fproc[NR_PROCS];)714 2454 A
(rp++\))210 3210 A
5670 V
(22583)210 648 A
1698(if)S
(\(rp->fp_revived)630 1824 A
2496(==)S
(REVIVING\))378 2622 A
3042({)S
5760 V
(22584)210 648 A
(who)126 2034 A
2202(=)S
(\(int\)\(rp)336 2286 A
2664(-)S
(fproc\);)294 2748 A
5850 V
(22585)210 648 A
(fs_call)294 2034 A
2370(=)S
(rp->fp_fd)378 2454 A
2874(&)S
(BYTE;)210 2958 A
5940 V
(22586)210 648 A
2034(fd)S
2160(=)S
(\(rp->fp_fd)420 2244 A
(>>8\))168 2706 A
2916(&)S
(BYTE;)210 3000 A
6030 V
(22587)210 648 A
(buffer)252 2034 A
2328(=)S
(rp->fp_buffer;)588 2412 A
6120 V
(22588)210 648 A
(nbytes)252 2034 A
2328(=)S
(rp->fp_nbytes;)588 2412 A
6210 V
(22589)210 648 A
(rp->fp_suspended)672 2034 A
2748(=)S
(NOT_SUSPENDED;)588 2832 A
(/*no)168 3462 A
(longer)252 3672 A
(hanging*/)378 3966 A
8418 V
EP
%%Page: 308 308
BP
/slant 0 def
/height 0 def
630 V
12 B
(308)180 648 A
11 R
2135(File:)S
2368(src/fs/main.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(22590)210 648 A
(rp->fp_revived)588 2034 A
2664(=)S
(NOT_REVIVING;)546 2748 A
990 V
(22591)210 648 A
(reviving--;)462 2034 A
1080 V
(22592)210 648 A
(return;)294 2034 A
1170 V
(22593)210 648 A
1698(})S
1260 V
(22594)210 648 A
(panic\("get_work)630 1362 A
(couldn't)336 2034 A
(revive)252 2412 A
(anyone",)336 2706 A
(NO_NUM\);)336 3084 A
1350 V
(22595)210 648 A
1110(})S
1440 V
(22596)210 648 A
1530 V
(22597)210 648 A
1110(/*)S
(Normal)252 1236 A
(case.)210 1530 A
1824(No)S
(one)126 1950 A
2118(to)S
(revive.)294 2244 A
2580(*/)S
1620 V
(22598)210 648 A
1110(if)S
(\(receive\(ANY,)546 1236 A
(&m\))126 1824 A
1992(!=)S
(OK\))126 2118 A
(panic\("fs)378 2286 A
(receive)294 2706 A
(error",)294 3042 A
(NO_NUM\);)336 3378 A
1710 V
(22599)210 648 A
1800 V
(22600)210 648 A
(who)126 1110 A
1278(=)S
(m.m_source;)462 1362 A
1890 V
(22601)210 648 A
(fs_call)294 1110 A
1446(=)S
(m.m_type;)378 1530 A
1980 V
(22602)210 648 A
1026(})S
2250 V
(22605)210 648 A
(/*===========================================================================*)3276 1026 A
2340 V
(22606)210 648 A
1068(*)S
(reply)210 2370 A
4260(*)S
2430 V
(22607)210 648 A
(*===========================================================================*/)3276 1068 A
2520 V
(22608)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(reply\(whom,)462 1530 A
(result\))294 2034 A
2610 V
(22609)210 648 A
(int)126 1026 A
(whom;)210 1194 A
2370(/*)S
(process)294 2496 A
2832(to)S
(reply)210 2958 A
3210(to)S
3336(*/)S
2700 V
(22610)210 648 A
(int)126 1026 A
(result;)294 1194 A
2370(/*)S
(result)252 2496 A
2790(of)S
(the)126 2916 A
(call)168 3084 A
(\(usually)336 3294 A
3672(OK)S
3798(or)S
(error)210 3924 A
4176(#\))S
4302(*/)S
2790 V
(22611)210 648 A
1026({)S
2880 V
(22612)210 648 A
1026(/*)S
(Send)168 1152 A
1362(a)S
(reply)210 1446 A
1698(to)S
1824(a)S
(user)168 1908 A
(process.)336 2118 A
2496(It)S
(may)126 2622 A
(fail)168 2790 A
(\(if)126 3000 A
(the)126 3168 A
(process)294 3336 A
(has)126 3672 A
(just)168 3840 A
2970 V
(22613)210 648 A
1068(*)S
(been)168 1152 A
(killed)252 1362 A
1656(by)S
1782(a)S
(signal\),)336 1866 A
2244(so)S
(don't)210 2370 A
(check)210 2622 A
(the)126 2874 A
(return)252 3042 A
(code.)210 3336 A
3630(If)S
(the)126 3756 A
(send)168 3924 A
3060 V
(22614)210 648 A
1068(*)S
(fails,)252 1152 A
(just)168 1446 A
(ignore)252 1656 A
(it.)126 1950 A
3150 V
(22615)210 648 A
1068(*/)S
3240 V
(22616)210 648 A
3330 V
(22617)210 648 A
(reply_type)420 1110 A
1572(=)S
(result;)294 1656 A
3420 V
(22618)210 648 A
(send\(whom,)420 1110 A
(&m1\);)210 1572 A
3510 V
(22619)210 648 A
1026(})S
3780 V
(22622)210 648 A
(/*===========================================================================*)3276 1026 A
3870 V
(22623)210 648 A
1068(*)S
(fs_init)294 2370 A
4260(*)S
3960 V
(22624)210 648 A
(*===========================================================================*/)3276 1068 A
4050 V
(22625)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(fs_init\(\))378 1572 A
4140 V
(22626)210 648 A
1026({)S
4230 V
(22627)210 648 A
1026(/*)S
(Initialize)420 1152 A
(global)252 1614 A
(variables,)420 1908 A
(tables,)294 2370 A
(etc.)168 2706 A
2916(*/)S
4320 V
(22628)210 648 A
4410 V
(22629)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
4500 V
(22630)210 648 A
(int)126 1110 A
1278(i;)S
4590 V
(22631)210 648 A
(message)294 1110 A
(mess;)210 1446 A
4680 V
(22632)210 648 A
4770 V
(22633)210 648 A
1110(/*)S
(The)126 1236 A
(following)378 1404 A
(initializations)630 1824 A
(are)126 2496 A
(needed)252 2664 A
2958(to)S
(let)126 3084 A
(dev_opcl)336 3252 A
(succeed)294 3630 A
(.*/)126 3966 A
4860 V
(22634)210 648 A
1110(fp)S
1236(=)S
(\(struct)294 1320 A
(fproc)210 1656 A
1908(*\))S
(NULL;)210 2034 A
4950 V
(22635)210 648 A
(who)126 1110 A
1278(=)S
(FS_PROC_NR;)462 1362 A
5040 V
(22636)210 648 A
5130 V
(22637)210 648 A
(buf_pool\(\);)462 1110 A
2370(/*)S
(initialize)420 2496 A
(buffer)252 2958 A
(pool)168 3252 A
3462(*/)S
5220 V
(22638)210 648 A
(get_boot_parameters\(\);)924 1110 A
2370(/*)S
(get)126 2496 A
(the)126 2664 A
(parameters)420 2832 A
(from)168 3294 A
(the)126 3504 A
(menu)168 3672 A
3882(*/)S
5310 V
(22639)210 648 A
(load_ram\(\);)462 1110 A
2370(/*)S
(init)168 2496 A
(RAM)126 2706 A
(disk,)210 2874 A
(load)168 3126 A
3336(if)S
3462(it)S
3588(is)S
(root)168 3714 A
3924(*/)S
5400 V
(22640)210 648 A
(load_super\(ROOT_DEV\);)882 1110 A
2370(/*)S
(load)168 2496 A
(super)210 2706 A
(block)210 2958 A
(for)126 3210 A
(root)168 3378 A
(device)252 3588 A
3882(*/)S
5490 V
(22641)210 648 A
5580 V
(22642)210 648 A
1110(/*)S
(Initialize)420 1236 A
(the)126 1698 A
('fproc')294 1866 A
(fields)252 2202 A
(for)126 2496 A
(process)294 2664 A
3000(0)S
3084(..)S
(INIT.)210 3210 A
3462(*/)S
5670 V
(22643)210 648 A
(for)126 1110 A
1278(\(i)S
1404(=)S
1488(0;)S
1614(i)S
1698(<=)S
(LOW_USER;)378 1824 A
(i+=)126 2244 A
2412(1\))S
2538({)S
5760 V
(22644)210 648 A
1362(if)S
1488(\(i)S
1614(==)S
(FS_PROC_NR\))462 1740 A
(continue;)378 2244 A
2706(/*)S
2832(do)S
(not)126 2958 A
(initialize)420 3126 A
3588(FS)S
3714(*/)S
5850 V
(22645)210 648 A
1362(fp)S
1488(=)S
(&fproc[i];)420 1572 A
5940 V
(22646)210 648 A
(rip)126 1362 A
1530(=)S
(get_inode\(ROOT_DEV,)798 1614 A
(ROOT_INODE\);)504 2454 A
6030 V
(22647)210 648 A
(fp->fp_rootdir)588 1362 A
1992(=)S
(rip;)168 2076 A
6120 V
(22648)210 648 A
(dup_inode\(rip\);)630 1362 A
6210 V
(22649)210 648 A
(fp->fp_workdir)588 1362 A
1992(=)S
(rip;)168 2076 A
8418 V
EP
%%Page: 309 309
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2135(File:)S
2368(src/fs/main.c)S
12 B
(309)180 4248 A
900 V
7 LST
(22650)210 648 A
(fp->fp_realuid)588 1362 A
1992(=)S
(\(uid_t\))294 2076 A
(SYS_UID;)336 2412 A
990 V
(22651)210 648 A
(fp->fp_effuid)546 1362 A
1950(=)S
(\(uid_t\))294 2034 A
(SYS_UID;)336 2370 A
1080 V
(22652)210 648 A
(fp->fp_realgid)588 1362 A
1992(=)S
(\(gid_t\))294 2076 A
(SYS_GID;)336 2412 A
1170 V
(22653)210 648 A
(fp->fp_effgid)546 1362 A
1950(=)S
(\(gid_t\))294 2034 A
(SYS_GID;)336 2370 A
1260 V
(22654)210 648 A
(fp->fp_umask)504 1362 A
1908(=)S
(\3040;)126 1992 A
1350 V
(22655)210 648 A
1110(})S
1440 V
(22656)210 648 A
1530 V
(22657)210 648 A
1110(/*)S
(Certain)294 1236 A
(relations)378 1572 A
(must)168 1992 A
(hold)168 2202 A
(for)126 2412 A
(the)126 2580 A
(file)168 2748 A
(system)252 2958 A
3252(to)S
(work)168 3378 A
3588(at)S
(all.)168 3714 A
3924(*/)S
1620 V
(22658)210 648 A
1110(if)S
(\(SUPER_SIZE)462 1236 A
1740(>)S
(BLOCK_SIZE\))462 1824 A
(panic\("SUPER_SIZE)714 2328 A
3084(>)S
(BLOCK_SIZE",)504 3168 A
(NO_NUM\);)336 3714 A
1710 V
(22659)210 648 A
1110(if)S
(\(BLOCK_SIZE)462 1236 A
1740(%)S
(V2_INODE_SIZE)546 1824 A
2412(!=)S
2538(0\))S
2706(/*)S
(this)168 2832 A
(checks)252 3042 A
(V1_INODE_SIZE)546 3336 A
(too)126 3924 A
4092(*/)S
1800 V
(22660)210 648 A
(panic\("BLOCK_SIZE)714 1362 A
2118(%)S
(V2_INODE_SIZE)546 2202 A
2790(!=)S
(0",)126 2916 A
(NO_NUM\);)336 3084 A
1890 V
(22661)210 648 A
1110(if)S
(\(OPEN_MAX)378 1236 A
1656(>)S
(127\))168 1740 A
(panic\("OPEN_MAX)630 1950 A
2622(>)S
(127",)210 2706 A
(NO_NUM\);)336 2958 A
1980 V
(22662)210 648 A
1110(if)S
(\(NR_BUFS)336 1236 A
1614(<)S
1698(6\))S
(panic\("NR_BUFS)588 1824 A
2454(<)S
(6",)126 2538 A
(NO_NUM\);)336 2706 A
2070 V
(22663)210 648 A
1110(if)S
(\(V1_INODE_SIZE)588 1236 A
1866(!=)S
(32\))126 1992 A
(panic\("V1)378 2160 A
(inode)210 2580 A
(size)168 2832 A
3042(!=)S
(32",)168 3168 A
(NO_NUM\);)336 3378 A
2160 V
(22664)210 648 A
1110(if)S
(\(V2_INODE_SIZE)588 1236 A
1866(!=)S
(64\))126 1992 A
(panic\("V2)378 2160 A
(inode)210 2580 A
(size)168 2832 A
3042(!=)S
(64",)168 3168 A
(NO_NUM\);)336 3378 A
2250 V
(22665)210 648 A
1110(if)S
(\(OPEN_MAX)378 1236 A
1656(>)S
1740(8)S
1824(*)S
(sizeof\(long\)\))546 1908 A
(panic\("Too)420 2496 A
(few)126 2958 A
(bits)168 3126 A
3336(in)S
(fp_cloexec",)504 3462 A
(NO_NUM\);)336 4008 A
2340 V
(22666)210 648 A
2430 V
(22667)210 648 A
1110(/*)S
(Tell)168 1236 A
(the)126 1446 A
(memory)252 1614 A
(task)168 1908 A
(where)210 2118 A
2370(my)S
(process)294 2496 A
(table)210 2832 A
3084(is)S
(for)126 3210 A
(the)126 3378 A
(sake)168 3546 A
3756(of)S
(ps\(1\).)252 3882 A
4176(*/)S
2520 V
(22668)210 648 A
(mess.m_type)462 1110 A
1614(=)S
(DEV_IOCTL;)420 1698 A
2610 V
(22669)210 648 A
(mess.PROC_NR)504 1110 A
1656(=)S
(FS_PROC_NR;)462 1740 A
2700 V
(22670)210 648 A
(mess.REQUEST)504 1110 A
1656(=)S
(MIOCSPSINFO;)504 1740 A
2790 V
(22671)210 648 A
(mess.ADDRESS)504 1110 A
1656(=)S
(\(void)210 1740 A
1992(*\))S
(fproc;)252 2118 A
2880 V
(22672)210 648 A
(\(void\))252 1110 A
(sendrec\(MEM,)504 1404 A
(&mess\);)294 1950 A
2970 V
(22673)210 648 A
1026(})S
3240 V
(22676)210 648 A
(/*===========================================================================*)3276 1026 A
3330 V
(22677)210 648 A
1068(*)S
(buf_pool)336 2370 A
4260(*)S
3420 V
(22678)210 648 A
(*===========================================================================*/)3276 1068 A
3510 V
(22679)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(buf_pool\(\))420 1572 A
3600 V
(22680)210 648 A
1026({)S
3690 V
(22681)210 648 A
1026(/*)S
(Initialize)420 1152 A
(the)126 1614 A
(buffer)252 1782 A
(pool.)210 2076 A
2328(*/)S
3780 V
(22682)210 648 A
3870 V
(22683)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp;)168 1950 A
3960 V
(22684)210 648 A
4050 V
(22685)210 648 A
(bufs_in_use)462 1110 A
1614(=)S
1698(0;)S
4140 V
(22686)210 648 A
(front)210 1110 A
1362(=)S
(&buf[0];)336 1446 A
4230 V
(22687)210 648 A
(rear)168 1110 A
1320(=)S
(&buf[NR_BUFS)504 1404 A
1950(-)S
(1];)126 2034 A
4320 V
(22688)210 648 A
4410 V
(22689)210 648 A
(for)126 1110 A
(\(bp)126 1278 A
1446(=)S
(&buf[0];)336 1530 A
1908(bp)S
2034(<)S
(&buf[NR_BUFS];)588 2118 A
(bp++\))210 2748 A
3000({)S
4500 V
(22690)210 648 A
(bp->b_blocknr)546 1362 A
1950(=)S
(NO_BLOCK;)378 2034 A
4590 V
(22691)210 648 A
(bp->b_dev)378 1362 A
1782(=)S
(NO_DEV;)294 1866 A
4680 V
(22692)210 648 A
(bp->b_next)420 1362 A
1824(=)S
1908(bp)S
2034(+)S
2118(1;)S
4770 V
(22693)210 648 A
(bp->b_prev)420 1362 A
1824(=)S
1908(bp)S
2034(-)S
2118(1;)S
4860 V
(22694)210 648 A
1110(})S
4950 V
(22695)210 648 A
(buf[0].b_prev)546 1110 A
1698(=)S
(NIL_BUF;)336 1782 A
5040 V
(22696)210 648 A
(buf[NR_BUFS)462 1110 A
1614(-)S
(1].b_next)378 1698 A
2118(=)S
(NIL_BUF;)336 2202 A
5130 V
(22697)210 648 A
5220 V
(22698)210 648 A
(for)126 1110 A
(\(bp)126 1278 A
1446(=)S
(&buf[0];)336 1530 A
1908(bp)S
2034(<)S
(&buf[NR_BUFS];)588 2118 A
(bp++\))210 2748 A
(bp->b_hash)420 3000 A
3462(=)S
(bp->b_next;)462 3546 A
5310 V
(22699)210 648 A
(buf_hash[0])462 1110 A
1614(=)S
(front;)252 1698 A
5400 V
(22700)210 648 A
1026(})S
5670 V
(22703)210 648 A
(/*===========================================================================*)3276 1026 A
5760 V
(22704)210 648 A
1068(*)S
(get_boot_parameters)798 2370 A
4260(*)S
5850 V
(22705)210 648 A
(*===========================================================================*/)3276 1068 A
5940 V
(22706)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(bparam_s)336 1614 A
(boot_parameters;)672 1992 A
6030 V
(22707)210 648 A
6120 V
(22708)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(get_boot_parameters\(\))882 1572 A
6210 V
(22709)210 648 A
1026({)S
8418 V
EP
%%Page: 310 310
BP
/slant 0 def
/height 0 def
630 V
12 B
(310)180 648 A
11 R
2135(File:)S
2368(src/fs/main.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(22710)210 648 A
1026(/*)S
(Ask)126 1152 A
(kernel)252 1320 A
(for)126 1614 A
(boot)168 1782 A
(parameters.)462 1992 A
2496(*/)S
990 V
(22711)210 648 A
1080 V
(22712)210 648 A
(m1.m_type)378 1110 A
1530(=)S
(SYS_GBOOT;)420 1614 A
1170 V
(22713)210 648 A
(m1.PROC1)336 1110 A
1488(=)S
(FS_PROC_NR;)462 1572 A
1260 V
(22714)210 648 A
(m1.MEM_PTR)420 1110 A
1572(=)S
(\(char)210 1656 A
1908(*\))S
(&boot_parameters;)714 2034 A
1350 V
(22715)210 648 A
(\(void\))252 1110 A
(sendrec\(SYSTASK,)672 1404 A
(&m1\);)210 2118 A
1440 V
(22716)210 648 A
1026(})S
1710 V
(22719)210 648 A
(/*===========================================================================*)3276 1026 A
1800 V
(22720)210 648 A
1068(*)S
(load_ram)336 2370 A
4260(*)S
1890 V
(22721)210 648 A
(*===========================================================================*/)3276 1068 A
1980 V
(22722)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(load_ram\(\))420 1572 A
2070 V
(22723)210 648 A
1026({)S
2160 V
(22724)210 648 A
1026(/*)S
1152(If)S
(the)126 1278 A
(root)168 1446 A
(device)252 1656 A
1950(is)S
(the)126 2076 A
(RAM)126 2244 A
(disk,)210 2412 A
(copy)168 2664 A
(the)126 2874 A
(entire)252 3042 A
(root)168 3336 A
(image)210 3546 A
(device)252 3798 A
2250 V
(22725)210 648 A
1068(*)S
(block-by-block)588 1152 A
1782(to)S
1908(a)S
(RAM)126 1992 A
(disk)168 2160 A
(with)168 2370 A
(the)126 2580 A
(same)168 2748 A
(size)168 2958 A
3168(as)S
(the)126 3294 A
(image.)252 3462 A
2340 V
(22726)210 648 A
1068(*)S
(Otherwise,)420 1152 A
(just)168 1614 A
(allocate)336 1824 A
2202(a)S
(RAM)126 2286 A
(disk)168 2454 A
(with)168 2664 A
(size)168 2874 A
(given)210 3084 A
3336(in)S
(the)126 3462 A
(boot)168 3630 A
(parameters.)462 3840 A
2430 V
(22727)210 648 A
1068(*/)S
2520 V
(22728)210 648 A
2610 V
(22729)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp,)168 1950 A
(*bp1;)210 2160 A
2700 V
(22730)210 648 A
(long)168 1110 A
(k_loaded,)378 1320 A
(lcount;)294 1740 A
2790 V
(22731)210 648 A
(u32_t)210 1110 A
(ram_size,)378 1362 A
(fsmax;)252 1782 A
2880 V
(22732)210 648 A
(zone_t)252 1110 A
(zones;)252 1404 A
2970 V
(22733)210 648 A
(struct)252 1110 A
(super_block)462 1404 A
(*sp,)168 1908 A
(*dsp;)210 2118 A
3060 V
(22734)210 648 A
(block_t)294 1110 A
1446(b;)S
3150 V
(22735)210 648 A
(int)126 1110 A
(major,)252 1278 A
(task;)210 1572 A
3240 V
(22736)210 648 A
(message)294 1110 A
(dev_mess;)378 1446 A
3330 V
(22737)210 648 A
3420 V
(22738)210 648 A
(ram_size)336 1110 A
1488(=)S
(boot_parameters.bp_ramsize;)1134 1572 A
3510 V
(22739)210 648 A
3600 V
(22740)210 648 A
1110(/*)S
(Open)168 1236 A
(the)126 1446 A
(root)168 1614 A
(device.)294 1824 A
2160(*/)S
3690 V
(22741)210 648 A
(major)210 1110 A
1362(=)S
(\(ROOT_DEV)378 1446 A
1866(>>)S
(MAJOR\))252 1992 A
2286(&)S
(BYTE;)210 2370 A
2706(/*)S
(major)210 2832 A
(device)252 3084 A
3378(nr)S
3504(*/)S
3780 V
(22742)210 648 A
(task)168 1110 A
1320(=)S
(dmap[major].dmap_task;)924 1404 A
2706(/*)S
(device)252 2832 A
(task)168 3126 A
3336(nr)S
3462(*/)S
3870 V
(22743)210 648 A
(dev_mess.m_type)630 1110 A
1782(=)S
(DEV_OPEN;)378 1866 A
2706(/*)S
(distinguish)462 2832 A
(from)168 3336 A
(close)210 3546 A
3798(*/)S
3960 V
(22744)210 648 A
(dev_mess.DEVICE)630 1110 A
1782(=)S
(ROOT_DEV;)378 1866 A
4050 V
(22745)210 648 A
(dev_mess.COUNT)588 1110 A
1740(=)S
(R_BIT|W_BIT;)504 1824 A
4140 V
(22746)210 648 A
(\(*dmap[major].dmap_open\)\(task,)1260 1110 A
(&dev_mess\);)462 2412 A
4230 V
(22747)210 648 A
1110(if)S
(\(dev_mess.REP_STATUS)840 1236 A
2118(!=)S
(OK\))126 2244 A
(panic\("Cannot)546 2412 A
(open)168 3000 A
(root)168 3210 A
(device",NO_NUM\);)672 3420 A
4320 V
(22748)210 648 A
4410 V
(22749)210 648 A
1110(/*)S
1236(If)S
(the)126 1362 A
(root)168 1530 A
(device)252 1740 A
2034(is)S
(the)126 2160 A
(ram)126 2328 A
(disk)168 2496 A
(then)168 2706 A
(fill)168 2916 A
3126(it)S
(from)168 3252 A
(the)126 3462 A
(image)210 3630 A
(device.)294 3882 A
4218(*/)S
4500 V
(22750)210 648 A
1110(if)S
(\(ROOT_DEV)378 1236 A
1656(==)S
(DEV_RAM\))336 1782 A
2160({)S
4590 V
(22751)210 648 A
(major)210 1362 A
1614(=)S
(\(IMAGE_DEV)420 1698 A
2160(>>)S
(MAJOR\))252 2286 A
2580(&)S
(BYTE;)210 2664 A
3042(/*)S
(major)210 3168 A
(device)252 3420 A
3714(nr)S
3840(*/)S
4680 V
(22752)210 648 A
(task)168 1362 A
1572(=)S
(dmap[major].dmap_task;)924 1656 A
3042(/*)S
(device)252 3168 A
(task)168 3462 A
3672(nr)S
3798(*/)S
4770 V
(22753)210 648 A
(dev_mess.m_type)630 1362 A
2034(=)S
(DEV_OPEN;)378 2118 A
3042(/*)S
(distinguish)462 3168 A
(from)168 3672 A
(close)210 3882 A
4134(*/)S
4860 V
(22754)210 648 A
(dev_mess.DEVICE)630 1362 A
2034(=)S
(IMAGE_DEV;)420 2118 A
4950 V
(22755)210 648 A
(dev_mess.COUNT)588 1362 A
1992(=)S
(R_BIT;)252 2076 A
5040 V
(22756)210 648 A
(\(*dmap[major].dmap_open\)\(task,)1260 1362 A
(&dev_mess\);)462 2664 A
5130 V
(22757)210 648 A
1362(if)S
(\(dev_mess.REP_STATUS)840 1488 A
2370(!=)S
(OK\))126 2496 A
(panic\("Cannot)546 2664 A
(open)168 3252 A
(root)168 3462 A
(device",)336 3672 A
(NO_NUM\);)336 4050 A
5220 V
(22758)210 648 A
5310 V
(22759)210 648 A
1362(/*)S
(Get)126 1488 A
(size)168 1656 A
1866(of)S
(RAM)126 1992 A
(disk)168 2160 A
2370(by)S
(reading)294 2496 A
(root)168 2832 A
(file)168 3042 A
(system's)336 3252 A
(super)210 3630 A
(block.)252 3882 A
4176(*/)S
5400 V
(22760)210 648 A
1362(sp)S
1488(=)S
(&super_block[0];)672 1572 A
5490 V
(22761)210 648 A
(sp->s_dev)378 1362 A
1782(=)S
(IMAGE_DEV;)420 1866 A
5580 V
(22762)210 648 A
1362(if)S
(\(read_super\(sp\))630 1488 A
2160(!=)S
(OK\))126 2286 A
(panic\("Bad)420 2454 A
(root)168 2916 A
(file)168 3126 A
(system",)336 3336 A
(NO_NUM\);)336 3714 A
5670 V
(22763)210 648 A
5760 V
(22764)210 648 A
(lcount)252 1362 A
1656(=)S
(sp->s_zones)462 1740 A
2244(<<)S
(sp->s_log_zone_size;)840 2370 A
3378(/*)S
3504(#)S
(blks)168 3588 A
3798(on)S
(root)168 3924 A
(dev*/)210 4134 A
5850 V
(22765)210 648 A
5940 V
(22766)210 648 A
1362(/*)S
(Stretch)294 1488 A
(the)126 1824 A
(RAM)126 1992 A
(disk)168 2160 A
(file)168 2370 A
(system)252 2580 A
2874(to)S
(the)126 3000 A
(boot)168 3168 A
(parameters)420 3378 A
(size,)210 3840 A
(but)126 4092 A
6030 V
(22767)210 648 A
1404(*)S
1488(no)S
(further)294 1614 A
(than)168 1950 A
(the)126 2160 A
(last)168 2328 A
(zone)168 2538 A
(bit)126 2748 A
(map)126 2916 A
(block)210 3084 A
(allows.)294 3336 A
6120 V
(22768)210 648 A
1404(*/)S
6210 V
(22769)210 648 A
1362(if)S
(\(ram_size)378 1488 A
1908(<)S
(lcount\))294 1992 A
(ram_size)336 2328 A
2706(=)S
(lcount;)294 2790 A
8418 V
EP
%%Page: 311 311
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2135(File:)S
2368(src/fs/main.c)S
12 B
(311)180 4248 A
900 V
7 LST
(22770)210 648 A
(fsmax)210 1362 A
1614(=)S
(\(u32_t\))294 1698 A
(sp->s_zmap_blocks)714 2034 A
2790(*)S
(CHAR_BIT)336 2874 A
3252(*)S
(BLOCK_SIZE;)462 3336 A
990 V
(22771)210 648 A
(fsmax)210 1362 A
1614(=)S
(\(fsmax)252 1698 A
1992(+)S
(\(sp->s_firstdatazone-1\)\))1008 2076 A
3126(<<)S
(sp->s_log_zone_size;)840 3252 A
1080 V
(22772)210 648 A
1362(if)S
(\(ram_size)378 1488 A
1908(>)S
(fsmax\))252 1992 A
(ram_size)336 2286 A
2664(=)S
(fsmax;)252 2748 A
1170 V
(22773)210 648 A
1110(})S
1260 V
(22774)210 648 A
1350 V
(22775)210 648 A
1110(/*)S
(Tell)168 1236 A
(RAM)126 1446 A
(driver)252 1614 A
(how)126 1908 A
(big)126 2076 A
(the)126 2244 A
(RAM)126 2412 A
(disk)168 2580 A
(must)168 2790 A
(be.)126 3000 A
3168(*/)S
1440 V
(22776)210 648 A
(m1.m_type)378 1110 A
1530(=)S
(DEV_IOCTL;)420 1614 A
1530 V
(22777)210 648 A
(m1.PROC_NR)420 1110 A
1572(=)S
(FS_PROC_NR;)462 1656 A
1620 V
(22778)210 648 A
(m1.REQUEST)420 1110 A
1572(=)S
(MIOCRAMSIZE;)504 1656 A
1710 V
(22779)210 648 A
(m1.POSITION)462 1110 A
1614(=)S
(ram_size;)378 1698 A
1800 V
(22780)210 648 A
1110(if)S
(\(sendrec\(MEM,)546 1236 A
(&m1\))168 1824 A
2034(!=)S
2160(OK)S
2286(||)S
(m1.REP_STATUS)546 2412 A
3000(!=)S
(OK\))126 3126 A
1890 V
(22781)210 648 A
(panic\("Can't)504 1362 A
(set)126 1908 A
(RAM)126 2076 A
(disk)168 2244 A
(size",)252 2454 A
(NO_NUM\);)336 2748 A
1980 V
(22782)210 648 A
2070 V
(22783)210 648 A
1110(/*)S
(Tell)168 1236 A
1446(MM)S
(the)126 1572 A
(RAM)126 1740 A
(disk)168 1908 A
(size,)210 2118 A
(and)126 2370 A
(wait)168 2538 A
(for)126 2748 A
2916(it)S
3042(to)S
(come)168 3168 A
("on-line".)420 3378 A
3840(*/)S
2160 V
(22784)210 648 A
(m1.m1_i1)336 1110 A
1488(=)S
(\(\(long\))294 1572 A
(ram_size)336 1908 A
2286(*)S
(BLOCK_SIZE\))462 2370 A
2874(>>)S
(CLICK_SHIFT;)504 3000 A
2250 V
(22785)210 648 A
1110(if)S
(\(sendrec\(MM_PROC_NR,)840 1236 A
(&m1\))168 2118 A
2328(!=)S
(OK\))126 2454 A
2340 V
(22786)210 648 A
(panic\("FS)378 1362 A
(can't)210 1782 A
(sync)168 2034 A
2244(up)S
(with)168 2370 A
(MM",)168 2580 A
(NO_NUM\);)336 2790 A
2430 V
(22787)210 648 A
2520 V
(22788)210 648 A
1110(/*)S
1236(If)S
(the)126 1362 A
(root)168 1530 A
(device)252 1740 A
2034(is)S
(not)126 2160 A
(the)126 2328 A
(RAM)126 2496 A
(disk,)210 2664 A
2916(it)S
(doesn't)294 3042 A
(need)168 3378 A
(loading.)336 3588 A
3966(*/)S
2610 V
(22789)210 648 A
1110(if)S
(\(ROOT_DEV)378 1236 A
1656(!=)S
(DEV_RAM\))336 1782 A
(return;)294 2160 A
2700 V
(22790)210 648 A
2790 V
(22791)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(blocks)252 1614 A
(one)126 1908 A
2076(at)S
2202(a)S
(time)168 2286 A
(from)168 2496 A
(the)126 2706 A
(image)210 2874 A
3126(to)S
(the)126 3252 A
(RAM)126 3420 A
(disk.)210 3588 A
3840(*/)S
2880 V
(22792)210 648 A
(printf\("Loading)630 1110 A
(RAM)126 1782 A
(disk.\\33[23CLoaded:)798 1950 A
2916(0K)S
("\);)126 3042 A
2970 V
(22793)210 648 A
3060 V
(22794)210 648 A
(inode[0].i_mode)630 1110 A
1782(=)S
(I_BLOCK_SPECIAL;)672 1866 A
2706(/*)S
(temp)168 2832 A
(inode)210 3042 A
(for)126 3294 A
(rahead\(\))336 3462 A
3840(*/)S
3150 V
(22795)210 648 A
(inode[0].i_size)630 1110 A
1782(=)S
(LONG_MAX;)378 1866 A
3240 V
(22796)210 648 A
(inode[0].i_dev)588 1110 A
1740(=)S
(IMAGE_DEV;)420 1824 A
3330 V
(22797)210 648 A
(inode[0].i_zone[0])756 1110 A
1908(=)S
(IMAGE_DEV;)420 1992 A
3420 V
(22798)210 648 A
3510 V
(22799)210 648 A
(for)126 1110 A
1278(\(b)S
1404(=)S
1488(0;)S
1614(b)S
1698(<)S
(\(block_t\))378 1782 A
(lcount;)294 2202 A
(b++\))168 2538 A
2748({)S
3600 V
(22800)210 648 A
1362(bp)S
1488(=)S
(rahead\(&inode[0],)714 1572 A
2328(b,)S
(\(off_t\)BLOCK_SIZE)714 2454 A
3210(*)S
3294(b,)S
(BLOCK_SIZE\);)504 3420 A
3690 V
(22801)210 648 A
(bp1)126 1362 A
1530(=)S
(get_block\(ROOT_DEV,)798 1614 A
2454(b,)S
(NO_READ\);)378 2580 A
3780 V
(22802)210 648 A
(memcpy\(bp1->b_data,)798 1362 A
(bp->b_data,)462 2202 A
(\(size_t\))336 2706 A
(BLOCK_SIZE\);)504 3084 A
3870 V
(22803)210 648 A
(bp1->b_dirt)462 1362 A
1866(=)S
(DIRTY;)252 1950 A
3960 V
(22804)210 648 A
(put_block\(bp,)546 1362 A
(FULL_DATA_BLOCK\);)714 1950 A
4050 V
(22805)210 648 A
(put_block\(bp1,)588 1362 A
(FULL_DATA_BLOCK\);)714 1992 A
4140 V
(22806)210 648 A
(k_loaded)336 1362 A
1740(=)S
1824(\()S
(\(long\))252 1908 A
2202(b)S
2286(*)S
(BLOCK_SIZE\)/1024L;)756 2370 A
3378(/*)S
3504(K)S
(loaded)252 3588 A
3882(so)S
(far)126 4008 A
4176(*/)S
4230 V
(22807)210 648 A
1362(if)S
(\(k_loaded)378 1488 A
1908(%)S
1992(5)S
2076(==)S
2202(0\))S
(printf\("\\b\\b\\b\\b\\b\\b\\b%5ldK)1134 2328 A
3504(",)S
(k_loaded\);)420 3630 A
4320 V
(22808)210 648 A
1110(})S
4410 V
(22809)210 648 A
4500 V
(22810)210 648 A
(printf\("\\rRAM)546 1110 A
(disk)168 1698 A
(loaded.\\33[K\\n\\n"\);)798 1908 A
4590 V
(22811)210 648 A
4680 V
(22812)210 648 A
1110(/*)S
(Close)210 1236 A
(and)126 1488 A
(invalidate)420 1656 A
(image)210 2118 A
(device.)294 2370 A
2706(*/)S
4770 V
(22813)210 648 A
(dev_mess.m_type)630 1110 A
1782(=)S
(DEV_CLOSE;)420 1866 A
4860 V
(22814)210 648 A
(dev_mess.DEVICE)630 1110 A
1782(=)S
(IMAGE_DEV;)420 1866 A
4950 V
(22815)210 648 A
(\(*dmap[major].dmap_close\)\(task,)1302 1110 A
(&dev_mess\);)462 2454 A
5040 V
(22816)210 648 A
(invalidate\(IMAGE_DEV\);)924 1110 A
5130 V
(22817)210 648 A
5220 V
(22818)210 648 A
1110(/*)S
(Resize)252 1236 A
(the)126 1530 A
(RAM)126 1698 A
(disk)168 1866 A
(root)168 2076 A
(file)168 2286 A
(system.)294 2496 A
2832(*/)S
5310 V
(22819)210 648 A
1110(bp)S
1236(=)S
(get_block\(ROOT_DEV,)798 1320 A
(SUPER_BLOCK,)504 2160 A
(NORMAL\);)336 2706 A
5400 V
(22820)210 648 A
(dsp)126 1110 A
1278(=)S
(\(struct)294 1362 A
(super_block)462 1698 A
2202(*\))S
(bp->b_data;)462 2328 A
5490 V
(22821)210 648 A
(zones)210 1110 A
1362(=)S
(ram_size)336 1446 A
1824(>>)S
(sp->s_log_zone_size;)840 1950 A
5580 V
(22822)210 648 A
(dsp->s_nzones)546 1110 A
1698(=)S
(conv2\(sp->s_native,)798 1782 A
(\(u16_t\))294 2622 A
(zones\);)294 2958 A
5670 V
(22823)210 648 A
(dsp->s_zones)504 1110 A
1656(=)S
(conv4\(sp->s_native,)798 1740 A
(zones\);)294 2580 A
5760 V
(22824)210 648 A
(bp->b_dirt)420 1110 A
1572(=)S
(DIRTY;)252 1656 A
5850 V
(22825)210 648 A
(put_block\(bp,)546 1110 A
(ZUPER_BLOCK\);)546 1698 A
5940 V
(22826)210 648 A
1026(})S
6210 V
(22829)210 648 A
(/*===========================================================================*)3276 1026 A
8418 V
EP
%%Page: 312 312
BP
/slant 0 def
/height 0 def
630 V
12 B
(312)180 648 A
11 R
2135(File:)S
2368(src/fs/main.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(22830)210 648 A
1068(*)S
(load_super)420 2370 A
4260(*)S
990 V
(22831)210 648 A
(*===========================================================================*/)3276 1068 A
1080 V
(22832)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(load_super\(super_dev\))882 1572 A
1170 V
(22833)210 648 A
(dev_t)210 1026 A
(super_dev;)420 1278 A
2706(/*)S
(place)210 2832 A
3084(to)S
(get)126 3210 A
(superblock)420 3378 A
(from)168 3840 A
4050(*/)S
1260 V
(22834)210 648 A
1026({)S
1350 V
(22835)210 648 A
(int)126 1110 A
(bad;)168 1278 A
1440 V
(22836)210 648 A
(register)336 1110 A
(struct)252 1488 A
(super_block)462 1782 A
(*sp;)168 2286 A
1530 V
(22837)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
1620 V
(22838)210 648 A
1710 V
(22839)210 648 A
1110(/*)S
(Initialize)420 1236 A
(the)126 1698 A
(super_block)462 1866 A
(table.)252 2370 A
2664(*/)S
1800 V
(22840)210 648 A
(for)126 1110 A
(\(sp)126 1278 A
1446(=)S
(&super_block[0];)672 1530 A
2244(sp)S
2370(<)S
(&super_block[NR_SUPERS];)1008 2454 A
(sp++\))210 3504 A
1890 V
(22841)210 648 A
(sp->s_dev)378 1362 A
1782(=)S
(NO_DEV;)294 1866 A
1980 V
(22842)210 648 A
2070 V
(22843)210 648 A
1110(/*)S
(Read)168 1236 A
1446(in)S
(super_block)462 1572 A
(for)126 2076 A
(the)126 2244 A
(root)168 2412 A
(file)168 2622 A
(system.)294 2832 A
3168(*/)S
2160 V
(22844)210 648 A
1110(sp)S
1236(=)S
(&super_block[0];)672 1320 A
2250 V
(22845)210 648 A
(sp->s_dev)378 1110 A
1530(=)S
(super_dev;)420 1614 A
2340 V
(22846)210 648 A
2430 V
(22847)210 648 A
1110(/*)S
(Check)210 1236 A
(super_block)462 1488 A
(for)126 1992 A
(consistency)462 2160 A
(\(is)126 2664 A
2832(it)S
(the)126 2958 A
(right)210 3126 A
(diskette?\).)462 3378 A
3882(*/)S
2520 V
(22848)210 648 A
(bad)126 1110 A
1278(=)S
(\(read_super\(sp\))630 1362 A
2034(!=)S
(OK\);)168 2160 A
2610 V
(22849)210 648 A
1110(if)S
(\(!bad\))252 1236 A
1530({)S
2700 V
(22850)210 648 A
(rip)126 1362 A
1530(=)S
(get_inode\(super_dev,)840 1614 A
(ROOT_INODE\);)504 2496 A
3042(/*)S
(inode)210 3168 A
(for)126 3420 A
(root)168 3588 A
(dir)126 3798 A
3966(*/)S
2790 V
(22851)210 648 A
1362(if)S
1488(\()S
(\(rip->i_mode)504 1572 A
2118(&)S
(I_TYPE\))294 2202 A
2538(!=)S
(I_DIRECTORY)462 2664 A
3168(||)S
(rip->i_nlinks)546 3294 A
3882(<)S
3966(3\))S
(bad++;)252 4092 A
2880 V
(22852)210 648 A
1110(})S
2970 V
(22853)210 648 A
1110(if)S
(\(bad\)panic\("Invalid)798 1236 A
(root)168 2076 A
(file)168 2286 A
(system.)294 2496 A
(Possibly)336 2874 A
(wrong)210 3252 A
(diskette.",NO_NUM\);)798 3504 A
3060 V
(22854)210 648 A
3150 V
(22855)210 648 A
(sp->s_imount)504 1110 A
1656(=)S
(rip;)168 1740 A
3240 V
(22856)210 648 A
(dup_inode\(rip\);)630 1110 A
3330 V
(22857)210 648 A
(sp->s_isup)420 1110 A
1572(=)S
(rip;)168 1656 A
3420 V
(22858)210 648 A
(sp->s_rd_only)546 1110 A
1698(=)S
1782(0;)S
3510 V
(22859)210 648 A
(return;)294 1110 A
3600 V
(22860)210 648 A
1026(})S
4140 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4230 V
(src/fs/open.c)546 2034 A
4320 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4500 V
(22900)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(procedures)420 2118 A
(for)126 2580 A
(creating,)378 2748 A
(opening,)336 3168 A
(closing,)336 3546 A
(and)126 3924 A
4590 V
(22901)210 648 A
1068(*)S
(seeking)294 1152 A
1488(on)S
(files.)252 1614 A
4680 V
(22902)210 648 A
1068(*)S
4770 V
(22903)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
4860 V
(22904)210 648 A
1068(*)S
(do_creat:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(CREAT)210 2202 A
(system)252 2454 A
(call)168 2748 A
4950 V
(22905)210 648 A
1068(*)S
(do_open:)336 1236 A
(perform)294 1698 A
(the)126 2034 A
(OPEN)168 2202 A
(system)252 2412 A
(call)168 2706 A
5040 V
(22906)210 648 A
1068(*)S
(do_mknod:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(MKNOD)210 2202 A
(system)252 2454 A
(call)168 2748 A
5130 V
(22907)210 648 A
1068(*)S
(do_mkdir:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(MKDIR)210 2202 A
(system)252 2454 A
(call)168 2748 A
5220 V
(22908)210 648 A
1068(*)S
(do_close:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(CLOSE)210 2202 A
(system)252 2454 A
(call)168 2748 A
5310 V
(22909)210 648 A
1068(*)S
(do_lseek:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(LSEEK)210 2202 A
(system)252 2454 A
(call)168 2748 A
5400 V
(22910)210 648 A
1068(*/)S
5490 V
(22911)210 648 A
5580 V
(22912)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
5670 V
(22913)210 648 A
(#include)336 1026 A
(<sys/stat.h>)504 1404 A
5760 V
(22914)210 648 A
(#include)336 1026 A
(<fcntl.h>)378 1404 A
5850 V
(22915)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
5940 V
(22916)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
6030 V
(22917)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
6120 V
(22918)210 648 A
(#include)336 1026 A
("dev.h")294 1404 A
6210 V
(22919)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
8418 V
EP
%%Page: 313 313
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2139(File:)S
2372(src/fs/open.c)S
12 B
(313)180 4248 A
900 V
7 LST
(22920)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
990 V
(22921)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
1080 V
(22922)210 648 A
(#include)336 1026 A
("lock.h")336 1404 A
1170 V
(22923)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
1260 V
(22924)210 648 A
1350 V
(22925)210 648 A
(PRIVATE)294 1026 A
(message)294 1362 A
(dev_mess;)378 1698 A
1440 V
(22926)210 648 A
(PRIVATE)294 1026 A
(char)168 1362 A
(mode_map[])420 1572 A
2034(=)S
({R_BIT,)294 2118 A
(W_BIT,)252 2454 A
(R_BIT|W_BIT,)504 2748 A
(0};)126 3294 A
1530 V
(22927)210 648 A
1620 V
(22928)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(common_open,)504 2034 A
(\(int)168 2580 A
(oflags,)294 2790 A
(Mode_t)252 3126 A
(omode\))252 3420 A
4050(\);)S
1710 V
(22929)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(pipe_open,)420 2034 A
(\(struct)294 2496 A
(inode)210 2832 A
(*rip,Mode_t)462 3084 A
(bits,int)336 3588 A
(oflags\)\);)378 3966 A
1800 V
(22930)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(struct)252 1866 A
(inode)210 2160 A
(*new_node,)420 2412 A
(\(char)210 2874 A
(*path,)252 3126 A
(Mode_t)252 3420 A
(bits,)210 3714 A
1890 V
(22931)210 648 A
(zone_t)252 3378 A
(z0\))126 3672 A
4050(\);)S
1980 V
(22932)210 648 A
2070 V
(22933)210 648 A
2160 V
(22934)210 648 A
(/*===========================================================================*)3276 1026 A
2250 V
(22935)210 648 A
1068(*)S
(do_creat)336 2370 A
4260(*)S
2340 V
(22936)210 648 A
(*===========================================================================*/)3276 1068 A
2430 V
(22937)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_creat\(\))420 1488 A
2520 V
(22938)210 648 A
1026({)S
2610 V
(22939)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(creat\(name,)462 1656 A
(mode\))210 2160 A
(system)252 2412 A
(call.)210 2706 A
2958(*/)S
2700 V
(22940)210 648 A
(int)126 1110 A
1278(r;)S
2790 V
(22941)210 648 A
2880 V
(22942)210 648 A
1110(if)S
(\(fetch_name\(name,)714 1236 A
(name_length,)504 1992 A
(M3\))126 2538 A
2706(!=)S
(OK\))126 2832 A
(return\(err_code\);)714 3000 A
2970 V
(22943)210 648 A
1110(r)S
1194(=)S
(common_open\(O_WRONLY)840 1278 A
2160(|)S
(O_CREAT)294 2244 A
2580(|)S
(O_TRUNC,)336 2664 A
(\(mode_t\))336 3042 A
(mode\);)252 3420 A
3060 V
(22944)210 648 A
(return\(r\);)420 1110 A
3150 V
(22945)210 648 A
1026(})S
3420 V
(22948)210 648 A
(/*===========================================================================*)3276 1026 A
3510 V
(22949)210 648 A
1068(*)S
(do_open)294 2370 A
4260(*)S
3600 V
(22950)210 648 A
(*===========================================================================*/)3276 1068 A
3690 V
(22951)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_open\(\))378 1488 A
3780 V
(22952)210 648 A
1026({)S
3870 V
(22953)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(open\(name,)420 1656 A
(flags,...\))420 2118 A
(system)252 2580 A
(call.)210 2874 A
3126(*/)S
3960 V
(22954)210 648 A
4050 V
(22955)210 648 A
(int)126 1110 A
(create_mode)462 1278 A
1782(=)S
1866(0;)S
2370(/*)S
2496(is)S
(really)252 2622 A
(mode_t)252 2916 A
(but)126 3210 A
(this)168 3378 A
(gives)210 3588 A
(problems)336 3840 A
4218(*/)S
4140 V
(22956)210 648 A
(int)126 1110 A
1278(r;)S
4230 V
(22957)210 648 A
4320 V
(22958)210 648 A
1110(/*)S
1236(If)S
(O_CREAT)294 1362 A
1698(is)S
(set,)168 1824 A
(open)168 2034 A
(has)126 2244 A
(three)210 2412 A
(parameters,)462 2664 A
(otherwise)378 3168 A
(two.)168 3588 A
3798(*/)S
4410 V
(22959)210 648 A
1110(if)S
(\(mode)210 1236 A
1488(&)S
(O_CREAT\))336 1572 A
1950({)S
4500 V
(22960)210 648 A
(create_mode)462 1362 A
1866(=)S
(c_mode;)294 1950 A
4590 V
(22961)210 648 A
1362(r)S
1446(=)S
(fetch_name\(c_name,)756 1530 A
(name1_length,)546 2328 A
(M1\);)168 2916 A
4680 V
(22962)210 648 A
1110(})S
(else)168 1194 A
1404({)S
4770 V
(22963)210 648 A
1362(r)S
1446(=)S
(fetch_name\(name,)672 1530 A
(name_length,)504 2244 A
(M3\);)168 2790 A
4860 V
(22964)210 648 A
1110(})S
4950 V
(22965)210 648 A
5040 V
(22966)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
(return\(err_code\);)714 1656 A
2412(/*)S
(name)168 2538 A
(was)126 2748 A
(bad)126 2916 A
3084(*/)S
5130 V
(22967)210 648 A
1110(r)S
1194(=)S
(common_open\(mode,)714 1278 A
(create_mode\);)546 2034 A
5220 V
(22968)210 648 A
(return\(r\);)420 1110 A
5310 V
(22969)210 648 A
1026(})S
5580 V
(22972)210 648 A
(/*===========================================================================*)3276 1026 A
5670 V
(22973)210 648 A
1068(*)S
(common_open)462 2370 A
4260(*)S
5760 V
(22974)210 648 A
(*===========================================================================*/)3276 1068 A
5850 V
(22975)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(common_open\(oflags,)798 1530 A
(omode\))252 2370 A
5940 V
(22976)210 648 A
(register)336 1026 A
(int)126 1404 A
(oflags;)294 1572 A
6030 V
(22977)210 648 A
(mode_t)252 1026 A
(omode;)252 1320 A
6120 V
(22978)210 648 A
1026({)S
6210 V
(22979)210 648 A
1026(/*)S
(Common)252 1152 A
(code)168 1446 A
(from)168 1656 A
(do_creat)336 1866 A
(and)126 2244 A
(do_open.)336 2412 A
2790(*/)S
8418 V
EP
%%Page: 314 314
BP
/slant 0 def
/height 0 def
630 V
12 B
(314)180 648 A
11 R
2139(File:)S
2372(src/fs/open.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(22980)210 648 A
990 V
(22981)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
1080 V
(22982)210 648 A
(int)126 1110 A
1278(r,)S
1404(b,)S
(major,)252 1530 A
(task,)210 1824 A
(exist)210 2076 A
2328(=)S
(TRUE;)210 2412 A
1170 V
(22983)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
1260 V
(22984)210 648 A
(mode_t)252 1110 A
(bits;)210 1404 A
1350 V
(22985)210 648 A
(off_t)210 1110 A
(pos;)168 1362 A
1440 V
(22986)210 648 A
(struct)252 1110 A
(filp)168 1404 A
(*fil_ptr,)378 1614 A
(*filp2;)294 2034 A
1530 V
(22987)210 648 A
1620 V
(22988)210 648 A
1110(/*)S
(Remap)210 1236 A
(the)126 1488 A
(bottom)252 1656 A
(two)126 1950 A
(bits)168 2118 A
2328(of)S
(oflags.)294 2454 A
2790(*/)S
1710 V
(22989)210 648 A
(bits)168 1110 A
1320(=)S
(\(mode_t\))336 1404 A
(mode_map[oflags)630 1782 A
2454(&)S
(O_ACCMODE];)462 2538 A
1800 V
(22990)210 648 A
1890 V
(22991)210 648 A
1110(/*)S
(See)126 1236 A
1404(if)S
(file)168 1530 A
(descriptor)420 1740 A
(and)126 2202 A
(filp)168 2370 A
(slots)210 2580 A
(are)126 2832 A
(available.)420 3000 A
3462(*/)S
1980 V
(22992)210 648 A
1110(if)S
1236(\()S
1320(\(r)S
1446(=)S
(get_fd\(0,)378 1530 A
(bits,)210 1950 A
(&fd,)168 2202 A
(&fil_ptr\)\))420 2412 A
2874(!=)S
(OK\))126 3000 A
(return\(r\);)420 3168 A
2070 V
(22993)210 648 A
2160 V
(22994)210 648 A
1110(/*)S
1236(If)S
(O_CREATE)336 1362 A
1740(is)S
(set,)168 1866 A
(try)126 2076 A
2244(to)S
(make)168 2370 A
(the)126 2580 A
(file.)210 2748 A
3000(*/)S
2250 V
(22995)210 648 A
1110(if)S
(\(oflags)294 1236 A
1572(&)S
(O_CREAT\))336 1656 A
2034({)S
2340 V
(22996)210 648 A
1362(/*)S
(Create)252 1488 A
1782(a)S
(new)126 1866 A
(inode)210 2034 A
2286(by)S
(calling)294 2412 A
(new_node\(\).)462 2748 A
3252(*/)S
2430 V
(22997)210 648 A
(omode)210 1362 A
1614(=)S
(I_REGULAR)378 1698 A
2118(|)S
(\(omode)252 2202 A
2496(&)S
(ALL_MODES)378 2580 A
3000(&)S
(fp->fp_umask\);)588 3084 A
2520 V
(22998)210 648 A
(rip)126 1362 A
1530(=)S
(new_node\(user_path,)798 1614 A
(omode,)252 2454 A
(NO_ZONE\);)378 2748 A
2610 V
(22999)210 648 A
1362(r)S
1446(=)S
(err_code;)378 1530 A
2700 V
(23000)210 648 A
1362(if)S
1488(\(r)S
1614(==)S
(OK\))126 1740 A
(exist)210 1908 A
2160(=)S
(FALSE;)252 2244 A
2748(/*)S
2874(we)S
(just)168 3000 A
(created)294 3210 A
(the)126 3546 A
(file)168 3714 A
3924(*/)S
2790 V
(23001)210 648 A
(else)168 1362 A
1572(if)S
1698(\(r)S
1824(!=)S
(EEXIST\))294 1950 A
(return\(r\);)420 2286 A
2748(/*)S
(other)210 2874 A
(error)210 3126 A
3378(*/)S
2880 V
(23002)210 648 A
(else)168 1362 A
(exist)210 1572 A
1824(=)S
(!\(oflags)336 1908 A
2286(&)S
(O_EXCL\);)336 2370 A
2748(/*)S
(file)168 2874 A
(exists,)294 3084 A
3420(if)S
(the)126 3546 A
(O_EXCL)252 3714 A
2970 V
(23003)210 648 A
(flag)168 2874 A
3084(is)S
(set)126 3210 A
(this)168 3378 A
3588(is)S
3714(an)S
(error)210 3840 A
4092(*/)S
3060 V
(23004)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3150 V
(23005)210 648 A
1404(/*)S
(Scan)168 1530 A
(path)168 1740 A
(name.)210 1950 A
2202(*/)S
3240 V
(23006)210 648 A
1362(if)S
1488(\()S
(\(rip)168 1572 A
1782(=)S
(eat_path\(user_path\)\))840 1866 A
2748(==)S
(NIL_INODE\))420 2874 A
(return\(err_code\);)714 3336 A
3330 V
(23007)210 648 A
1110(})S
3420 V
(23008)210 648 A
3510 V
(23009)210 648 A
1110(/*)S
(Claim)210 1236 A
(the)126 1488 A
(file)168 1656 A
(descriptor)420 1866 A
(and)126 2328 A
(filp)168 2496 A
(slot)168 2706 A
(and)126 2916 A
(fill)168 3084 A
(them)168 3294 A
(in.)126 3504 A
3672(*/)S
3600 V
(23010)210 648 A
(fp->fp_filp[fd])630 1110 A
1782(=)S
(fil_ptr;)336 1866 A
3690 V
(23011)210 648 A
(fil_ptr->filp_count)798 1110 A
1950(=)S
2034(1;)S
3780 V
(23012)210 648 A
(fil_ptr->filp_ino)714 1110 A
1866(=)S
(rip;)168 1950 A
3870 V
(23013)210 648 A
(fil_ptr->filp_flags)798 1110 A
1950(=)S
(oflags;)294 2034 A
3960 V
(23014)210 648 A
4050 V
(23015)210 648 A
1110(/*)S
(Only)168 1236 A
1446(do)S
(the)126 1572 A
(normal)252 1740 A
(open)168 2034 A
(code)168 2244 A
2454(if)S
2580(we)S
(didn't)252 2706 A
(just)168 3000 A
(create)252 3210 A
(the)126 3504 A
(file.)210 3672 A
3924(*/)S
4140 V
(23016)210 648 A
1110(if)S
(\(exist\))294 1236 A
1572({)S
4230 V
(23017)210 648 A
1362(/*)S
(Check)210 1488 A
(protections.)504 1740 A
2286(*/)S
4320 V
(23018)210 648 A
1362(if)S
(\(\(r)126 1488 A
1656(=)S
(forbidden\(rip,)588 1740 A
(bits\)\))252 2370 A
2664(==)S
(OK\))126 2790 A
2958({)S
4410 V
(23019)210 648 A
1698(/*)S
(Opening)294 1824 A
(reg.)168 2160 A
(files)210 2370 A
(directories)462 2622 A
(and)126 3126 A
(special)294 3294 A
(files)210 3630 A
(differ.)294 3882 A
4218(*/)S
4500 V
(23020)210 648 A
(switch)252 1698 A
(\(rip->i_mode)504 1992 A
2538(&)S
(I_TYPE\))294 2622 A
2958({)S
4590 V
(23021)210 648 A
(case)168 1824 A
(I_REGULAR:)420 2034 A
4680 V
(23022)210 648 A
2034(/*)S
(Truncate)336 2160 A
(regular)294 2538 A
(file)168 2874 A
3084(if)S
(O_TRUNC.)336 3210 A
3588(*/)S
4770 V
(23023)210 648 A
2034(if)S
(\(oflags)294 2160 A
2496(&)S
(O_TRUNC\))336 2580 A
2958({)S
4860 V
(23024)210 648 A
2370(if)S
(\(\(r)126 2496 A
2664(=)S
(forbidden\(rip,)588 2748 A
(W_BIT\)\))294 3378 A
(!=OK\))210 3714 A
(break;)252 3966 A
4950 V
(23025)210 648 A
(truncate\(rip\);)588 2370 A
5040 V
(23026)210 648 A
(wipe_inode\(rip\);)672 2370 A
5130 V
(23027)210 648 A
2370(/*)S
(Send)168 2496 A
(the)126 2706 A
(inode)210 2874 A
(from)168 3126 A
(the)126 3336 A
(inode)210 3504 A
(cache)210 3756 A
4008(to)S
(the)126 4134 A
5220 V
(23028)210 648 A
2412(*)S
(block)210 2496 A
(cache,)252 2748 A
3042(so)S
3168(it)S
(gets)168 3294 A
(written)294 3504 A
3840(on)S
(the)126 3966 A
(next)168 4134 A
5310 V
(23029)210 648 A
2412(*)S
(cache)210 2496 A
(flush.)252 2748 A
5400 V
(23030)210 648 A
2412(*/)S
5490 V
(23031)210 648 A
(rw_inode\(rip,)546 2370 A
(WRITING\);)378 2958 A
5580 V
(23032)210 648 A
2034(})S
5670 V
(23033)210 648 A
(break;)252 2034 A
5760 V
(23034)210 648 A
5850 V
(23035)210 648 A
(case)168 1824 A
(I_DIRECTORY:)504 2034 A
5940 V
(23036)210 648 A
2034(/*)S
(Directories)462 2160 A
(may)126 2664 A
2832(be)S
(read)168 2958 A
(but)126 3168 A
(not)126 3336 A
(written.)336 3504 A
3882(*/)S
6030 V
(23037)210 648 A
2034(r)S
2118(=)S
(\(bits)210 2202 A
2454(&)S
(W_BIT)210 2538 A
2790(?)S
(EISDIR)252 2874 A
3168(:)S
(OK\);)168 3252 A
6120 V
(23038)210 648 A
(break;)252 2034 A
6210 V
(23039)210 648 A
8418 V
EP
%%Page: 315 315
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2139(File:)S
2372(src/fs/open.c)S
12 B
(315)180 4248 A
900 V
7 LST
(23040)210 648 A
(case)168 1824 A
(I_CHAR_SPECIAL:)630 2034 A
990 V
(23041)210 648 A
(case)168 1824 A
(I_BLOCK_SPECIAL:)672 2034 A
1080 V
(23042)210 648 A
2034(/*)S
(Invoke)252 2160 A
(the)126 2454 A
(driver)252 2622 A
(for)126 2916 A
(special)294 3084 A
(processing.)462 3420 A
3924(*/)S
1170 V
(23043)210 648 A
(dev_mess.m_type)630 2034 A
2706(=)S
(DEV_OPEN;)378 2790 A
1260 V
(23044)210 648 A
(dev)126 2034 A
2202(=)S
(\(dev_t\))294 2286 A
(rip->i_zone[0];)630 2622 A
1350 V
(23045)210 648 A
(dev_mess.DEVICE)630 2034 A
2706(=)S
(dev;)168 2790 A
1440 V
(23046)210 648 A
(dev_mess.COUNT)588 2034 A
2664(=)S
(bits)168 2748 A
2958(|)S
(\(oflags)294 3042 A
3378(&)S
(\304O_ACCMODE\);)504 3462 A
1530 V
(23047)210 648 A
(major)210 2034 A
2286(=)S
(\(dev)168 2370 A
2580(>>)S
(MAJOR\))252 2706 A
3000(&)S
(BYTE;)210 3084 A
3378(/*)S
(major)210 3504 A
(device)252 3756 A
4050(nr)S
4176(*/)S
1620 V
(23048)210 648 A
2034(if)S
(\(major)252 2160 A
2454(<=)S
2580(0)S
2664(||)S
(major)210 2790 A
3042(>=)S
(max_major\))420 3168 A
3630({)S
1710 V
(23049)210 648 A
2370(r)S
2454(=)S
(ENODEV;)294 2538 A
1800 V
(23050)210 648 A
(break;)252 2370 A
1890 V
(23051)210 648 A
2034(})S
1980 V
(23052)210 648 A
(task)168 2034 A
2244(=)S
(dmap[major].dmap_task;)924 2328 A
3378(/*)S
(device)252 3504 A
(task)168 3798 A
4008(nr)S
4134(*/)S
2070 V
(23053)210 648 A
(\(*dmap[major].dmap_open\)\(task,)1260 2034 A
(&dev_mess\);)462 3336 A
2160 V
(23054)210 648 A
2034(r)S
2118(=)S
(dev_mess.REP_STATUS;)840 2202 A
2250 V
(23055)210 648 A
(break;)252 2034 A
2340 V
(23056)210 648 A
2430 V
(23057)210 648 A
(case)168 1824 A
(I_NAMED_PIPE:)546 2034 A
2520 V
(23058)210 648 A
(oflags)252 2034 A
2328(|=)S
(O_APPEND;)378 2454 A
3042(/*)S
(force)210 3168 A
(append)252 3420 A
(mode)168 3714 A
3924(*/)S
2610 V
(23059)210 648 A
(fil_ptr->filp_flags)798 2034 A
2874(=)S
(oflags;)294 2958 A
2700 V
(23060)210 648 A
2034(r)S
2118(=)S
(pipe_open\(rip,)588 2202 A
(bits,)210 2832 A
(oflags\);)336 3084 A
2790 V
(23061)210 648 A
2034(if)S
2160(\(r)S
2286(==)S
(OK\))126 2412 A
2580({)S
2880 V
(23062)210 648 A
2370(/*)S
(See)126 2496 A
2664(if)S
(someone)294 2790 A
(else)168 3126 A
3336(is)S
(doing)210 3462 A
3714(a)S
3798(rd)S
3924(or)S
4050(wt)S
4176(on)S
2970 V
(23063)210 648 A
2412(*)S
(the)126 2496 A
(FIFO.)210 2664 A
2958(If)S
(so,)126 3084 A
(use)126 3252 A
(its)126 3420 A
(filp)168 3588 A
(entry)210 3798 A
4050(so)S
(the)126 4176 A
3060 V
(23064)210 648 A
2412(*)S
(file)168 2496 A
(position)336 2706 A
(will)168 3084 A
3294(be)S
(automatically)546 3420 A
(shared.)294 4008 A
3150 V
(23065)210 648 A
2412(*/)S
3240 V
(23066)210 648 A
2370(b)S
2454(=)S
(\(bits)210 2538 A
2790(&)S
(R_BIT)210 2874 A
3126(?)S
(R_BIT)210 3210 A
3462(:)S
(W_BIT\);)294 3546 A
3330 V
(23067)210 648 A
(fil_ptr->filp_count)798 2370 A
3210(=)S
3294(0;)S
3420(/*)S
(don't)210 3546 A
(find)168 3798 A
(self)168 4008 A
4218(*/)S
3420 V
(23068)210 648 A
2370(if)S
(\(\(filp2)294 2496 A
2832(=)S
(find_filp\(rip,)588 2916 A
(b\)\))126 3546 A
3714(!=)S
(NIL_FILP\))378 3840 A
4260({)S
3510 V
(23069)210 648 A
2706(/*)S
(Co-reader)378 2832 A
3252(or)S
(writer)252 3378 A
(found.)252 3672 A
(Use)126 3966 A
(it.*/)210 4134 A
3600 V
(23070)210 648 A
(fp->fp_filp[fd])630 2706 A
3378(=)S
(filp2;)252 3462 A
3690 V
(23071)210 648 A
(filp2->filp_count++;)840 2706 A
3780 V
(23072)210 648 A
(filp2->filp_ino)630 2706 A
3378(=)S
(rip;)168 3462 A
3870 V
(23073)210 648 A
(filp2->filp_flags)714 2706 A
3462(=)S
(oflags;)294 3546 A
3960 V
(23074)210 648 A
4050 V
(23075)210 648 A
2706(/*)S
(i_count)294 2832 A
(was)126 3168 A
(incremented)462 3336 A
(incorrectly)462 3840 A
4140 V
(23076)210 648 A
2748(*)S
2832(by)S
(eatpath)294 2958 A
(above,)252 3294 A
(not)126 3588 A
(knowing)294 3756 A
(that)168 4092 A
4230 V
(23077)210 648 A
2748(*)S
2832(we)S
(were)168 2958 A
(going)210 3168 A
3420(to)S
(use)126 3546 A
3714(an)S
(existing)336 3840 A
4320 V
(23078)210 648 A
2748(*)S
(filp)168 2832 A
(entry.)252 3042 A
(Correct)294 3378 A
(this)168 3714 A
(error.)252 3924 A
4410 V
(23079)210 648 A
2748(*/)S
4500 V
(23080)210 648 A
(rip->i_count--;)630 2706 A
4590 V
(23081)210 648 A
2370(})S
(else)168 2454 A
2664({)S
4680 V
(23082)210 648 A
2706(/*)S
(Nobody)252 2832 A
(else)168 3126 A
(found.)252 3336 A
(Restore)294 3672 A
(filp.)210 4008 A
4260(*/)S
4770 V
(23083)210 648 A
(fil_ptr->filp_count)798 2706 A
3546(=)S
3630(1;)S
4860 V
(23084)210 648 A
2706(if)S
2832(\(b)S
2958(==)S
(R_BIT\))252 3084 A
4950 V
(23085)210 648 A
(pos)126 2916 A
3084(=)S
(rip->i_zone[V2_NR_DZONES+1];)1176 3168 A
5040 V
(23086)210 648 A
(else)168 2706 A
5130 V
(23087)210 648 A
(pos)126 2916 A
3084(=)S
(rip->i_zone[V2_NR_DZONES+2];)1176 3168 A
5220 V
(23088)210 648 A
(fil_ptr->filp_pos)714 2706 A
3462(=)S
(pos;)168 3546 A
5310 V
(23089)210 648 A
2370(})S
5400 V
(23090)210 648 A
2034(})S
5490 V
(23091)210 648 A
(break;)252 2034 A
5580 V
(23092)210 648 A
1698(})S
5670 V
(23093)210 648 A
1362(})S
5760 V
(23094)210 648 A
1110(})S
5850 V
(23095)210 648 A
5940 V
(23096)210 648 A
1110(/*)S
1236(If)S
(error,)252 1362 A
(release)294 1656 A
(inode.)252 1992 A
2286(*/)S
6030 V
(23097)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
1656({)S
6120 V
(23098)210 648 A
(fp->fp_filp[fd])630 1362 A
2034(=)S
(NIL_FILP;)378 2118 A
6210 V
(23099)210 648 A
(fil_ptr->filp_count=)840 1362 A
2244(0;)S
8418 V
EP
%%Page: 316 316
BP
/slant 0 def
/height 0 def
630 V
12 B
(316)180 648 A
11 R
2139(File:)S
2372(src/fs/open.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(23100)210 648 A
(put_inode\(rip\);)630 1362 A
990 V
(23101)210 648 A
(return\(r\);)420 1362 A
1080 V
(23102)210 648 A
1110(})S
1170 V
(23103)210 648 A
1260 V
(23104)210 648 A
(return\(fd\);)462 1110 A
1350 V
(23105)210 648 A
1026(})S
1620 V
(23108)210 648 A
(/*===========================================================================*)3276 1026 A
1710 V
(23109)210 648 A
1068(*)S
(new_node)336 2370 A
4260(*)S
1800 V
(23110)210 648 A
(*===========================================================================*/)3276 1068 A
1890 V
(23111)210 648 A
(PRIVATE)294 1026 A
(struct)252 1362 A
(inode)210 1656 A
(*new_node\(path,)630 1908 A
(bits,)210 2580 A
(z0\))126 2832 A
1980 V
(23112)210 648 A
(char)168 1026 A
(*path;)252 1236 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(path)168 2958 A
(name)168 3168 A
3378(*/)S
2070 V
(23113)210 648 A
(mode_t)252 1026 A
(bits;)210 1320 A
2370(/*)S
(mode)168 2496 A
2706(of)S
(the)126 2832 A
(new)126 3000 A
(inode)210 3168 A
3420(*/)S
2160 V
(23114)210 648 A
(zone_t)252 1026 A
(z0;)126 1320 A
2370(/*)S
(zone)168 2496 A
(number)252 2706 A
3000(0)S
(for)126 3084 A
(new)126 3252 A
(inode)210 3420 A
3672(*/)S
2250 V
(23115)210 648 A
1026({)S
2340 V
(23116)210 648 A
1026(/*)S
(New_node\(\))420 1152 A
1614(is)S
(called)252 1740 A
2034(by)S
(common_open\(\),)588 2160 A
(do_mknod\(\),)462 2790 A
(and)126 3294 A
(do_mkdir\(\).)462 3462 A
2430 V
(23117)210 648 A
1068(*)S
1152(In)S
(all)126 1278 A
(cases)210 1446 A
1698(it)S
(allocates)378 1824 A
2244(a)S
(new)126 2328 A
(inode,)252 2496 A
(makes)210 2790 A
3042(a)S
(directory)378 3126 A
(entry)210 3546 A
(for)126 3798 A
3966(it)S
4092(on)S
2520 V
(23118)210 648 A
1068(*)S
(the)126 1152 A
(path)168 1320 A
('path',)294 1530 A
(and)126 1866 A
(initializes)462 2034 A
(it.)126 2538 A
2748(It)S
(returns)294 2874 A
3210(a)S
(pointer)294 3294 A
3630(to)S
(the)126 3756 A
(inode)210 3924 A
4176(if)S
2610 V
(23119)210 648 A
1068(*)S
1152(it)S
(can)126 1278 A
1446(do)S
(this;)210 1572 A
(otherwise)378 1824 A
2244(it)S
(returns)294 2370 A
(NIL_INODE.)420 2706 A
3210(It)S
(always)252 3336 A
(sets)168 3630 A
('err_code')420 3840 A
2700 V
(23120)210 648 A
1068(*)S
1152(to)S
1278(an)S
(appropriate)462 1404 A
(value)210 1908 A
(\(OK)126 2160 A
2328(or)S
2454(an)S
(error)210 2580 A
(code\).)252 2832 A
2790 V
(23121)210 648 A
1068(*/)S
2880 V
(23122)210 648 A
2970 V
(23123)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rlast_dir_ptr,)630 2034 A
(*rip;)210 2706 A
3060 V
(23124)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(r;)S
3150 V
(23125)210 648 A
(char)168 1110 A
(string[NAME_MAX];)714 1320 A
3240 V
(23126)210 648 A
3330 V
(23127)210 648 A
1110(/*)S
(See)126 1236 A
1404(if)S
(the)126 1530 A
(path)168 1698 A
(can)126 1908 A
2076(be)S
(opened)252 2202 A
(down)168 2496 A
2706(to)S
(the)126 2832 A
(last)168 3000 A
(directory.)420 3210 A
3672(*/)S
3420 V
(23128)210 648 A
1110(if)S
(\(\(rlast_dir_ptr)630 1236 A
1908(=)S
(last_dir\(path,)588 1992 A
(string\)\))336 2622 A
3000(==)S
(NIL_INODE\))420 3126 A
(return\(NIL_INODE\);)756 3588 A
3510 V
(23129)210 648 A
3600 V
(23130)210 648 A
1110(/*)S
(The)126 1236 A
(final)210 1404 A
(directory)378 1656 A
2076(is)S
(accessible.)462 2202 A
(Get)126 2706 A
(final)210 2874 A
(component)378 3126 A
3546(of)S
(the)126 3672 A
(path.)210 3840 A
4092(*/)S
3690 V
(23131)210 648 A
(rip)126 1110 A
1278(=)S
(advance\(rlast_dir_ptr,)924 1362 A
(string\);)336 2328 A
3780 V
(23132)210 648 A
1110(if)S
1236(\()S
(rip)126 1320 A
1488(==)S
(NIL_INODE)378 1614 A
2034(&&)S
(err_code)336 2160 A
2538(==)S
(ENOENT\))294 2664 A
3000({)S
3870 V
(23133)210 648 A
1362(/*)S
(Last)168 1488 A
(path)168 1698 A
(component)378 1908 A
(does)168 2328 A
(not)126 2538 A
(exist.)252 2706 A
(Make)168 3042 A
(new)126 3252 A
(directory)378 3420 A
(entry.)252 3840 A
4134(*/)S
3960 V
(23134)210 648 A
1362(if)S
1488(\()S
(\(rip)168 1572 A
1782(=)S
(alloc_inode\(rlast_dir_ptr->i_dev,)1386 1866 A
(bits\)\))252 3294 A
3588(==)S
(NIL_INODE\))420 3714 A
4176({)S
4050 V
(23135)210 648 A
1698(/*)S
(Can't)210 1824 A
(creat)210 2076 A
(new)126 2328 A
(inode:)252 2496 A
(out)126 2790 A
2958(of)S
(inodes.)294 3084 A
3420(*/)S
4140 V
(23136)210 648 A
(put_inode\(rlast_dir_ptr\);)1050 1698 A
4230 V
(23137)210 648 A
(return\(NIL_INODE\);)756 1698 A
4320 V
(23138)210 648 A
1362(})S
4410 V
(23139)210 648 A
4500 V
(23140)210 648 A
1362(/*)S
(Force)210 1488 A
(inode)210 1740 A
1992(to)S
(the)126 2118 A
(disk)168 2286 A
(before)252 2496 A
(making)252 2790 A
(directory)378 3084 A
(entry)210 3504 A
3756(to)S
(make)168 3882 A
4590 V
(23141)210 648 A
1404(*)S
(the)126 1488 A
(system)252 1656 A
(more)168 1950 A
(robust)252 2160 A
2454(in)S
(the)126 2580 A
(face)168 2748 A
2958(of)S
3084(a)S
(crash:)252 3168 A
3462(an)S
(inode)210 3588 A
(with)168 3840 A
4680 V
(23142)210 648 A
1404(*)S
1488(no)S
(directory)378 1614 A
(entry)210 2034 A
2286(is)S
(much)168 2412 A
(better)252 2622 A
(than)168 2916 A
(the)126 3126 A
(opposite.)378 3294 A
4770 V
(23143)210 648 A
1404(*/)S
4860 V
(23144)210 648 A
(rip->i_nlinks++;)672 1362 A
4950 V
(23145)210 648 A
(rip->i_zone[0])588 1362 A
1992(=)S
(z0;)126 2076 A
2706(/*)S
(major/minor)462 2832 A
(device)252 3336 A
(numbers)294 3630 A
3966(*/)S
5040 V
(23146)210 648 A
(rw_inode\(rip,)546 1362 A
(WRITING\);)378 1950 A
2706(/*)S
(force)210 2832 A
(inode)210 3084 A
3336(to)S
(disk)168 3462 A
(now)126 3672 A
3840(*/)S
5130 V
(23147)210 648 A
5220 V
(23148)210 648 A
1362(/*)S
(New)126 1488 A
(inode)210 1656 A
(acquired.)378 1908 A
(Try)126 2370 A
2538(to)S
(make)168 2664 A
(directory)378 2874 A
(entry.)252 3294 A
3588(*/)S
5310 V
(23149)210 648 A
1362(if)S
(\(\(r)126 1488 A
1656(=)S
(search_dir\(rlast_dir_ptr,)1050 1740 A
(string,)294 2832 A
(&rip->i_num,ENTER\)\))798 3168 A
4008(!=)S
(OK\))126 4134 A
4302({)S
5400 V
(23150)210 648 A
(put_inode\(rlast_dir_ptr\);)1050 1698 A
5490 V
(23151)210 648 A
(rip->i_nlinks--;)672 1698 A
2706(/*)S
(pity,)210 2832 A
(have)168 3084 A
3294(to)S
(free)168 3420 A
(disk)168 3630 A
(inode)210 3840 A
4092(*/)S
5580 V
(23152)210 648 A
(rip->i_dirt)462 1698 A
2202(=)S
(DIRTY;)252 2286 A
2706(/*)S
(dirty)210 2832 A
(inodes)252 3084 A
(are)126 3378 A
(written)294 3546 A
(out)126 3882 A
4050(*/)S
5670 V
(23153)210 648 A
(put_inode\(rip\);)630 1698 A
2370(/*)S
(this)168 2496 A
(call)168 2706 A
(frees)210 2916 A
(the)126 3168 A
(inode)210 3336 A
3588(*/)S
5760 V
(23154)210 648 A
(err_code)336 1698 A
2076(=)S
2160(r;)S
5850 V
(23155)210 648 A
(return\(NIL_INODE\);)756 1698 A
5940 V
(23156)210 648 A
1362(})S
6030 V
(23157)210 648 A
6120 V
(23158)210 648 A
1110(})S
(else)168 1194 A
1404({)S
6210 V
(23159)210 648 A
1362(/*)S
(Either)252 1488 A
(last)168 1782 A
(component)378 1992 A
(exists,)294 2412 A
2748(or)S
(there)210 2874 A
3126(is)S
(some)168 3252 A
(problem.)336 3462 A
3840(*/)S
8418 V
EP
%%Page: 317 317
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2139(File:)S
2372(src/fs/open.c)S
12 B
(317)180 4248 A
900 V
7 LST
(23160)210 648 A
1362(if)S
(\(rip)168 1488 A
1698(!=)S
(NIL_INODE\))420 1824 A
990 V
(23161)210 648 A
1698(r)S
1782(=)S
(EEXIST;)294 1866 A
1080 V
(23162)210 648 A
(else)168 1362 A
1170 V
(23163)210 648 A
1698(r)S
1782(=)S
(err_code;)378 1866 A
1260 V
(23164)210 648 A
1110(})S
1350 V
(23165)210 648 A
1440 V
(23166)210 648 A
1110(/*)S
(Return)252 1236 A
(the)126 1530 A
(directory)378 1698 A
(inode)210 2118 A
(and)126 2370 A
(exit.)210 2538 A
2790(*/)S
1530 V
(23167)210 648 A
(put_inode\(rlast_dir_ptr\);)1050 1110 A
1620 V
(23168)210 648 A
(err_code)336 1110 A
1488(=)S
1572(r;)S
1710 V
(23169)210 648 A
(return\(rip\);)504 1110 A
1800 V
(23170)210 648 A
1026(})S
2070 V
(23173)210 648 A
(/*===========================================================================*)3276 1026 A
2160 V
(23174)210 648 A
1068(*)S
(pipe_open)378 2370 A
4260(*)S
2250 V
(23175)210 648 A
(*===========================================================================*/)3276 1068 A
2340 V
(23176)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(pipe_open\(rip,)588 1530 A
(bits,)210 2160 A
(oflags\))294 2412 A
2430 V
(23177)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2520 V
(23178)210 648 A
(register)336 1026 A
(mode_t)252 1404 A
(bits;)210 1698 A
2610 V
(23179)210 648 A
(register)336 1026 A
(int)126 1404 A
(oflags;)294 1572 A
2700 V
(23180)210 648 A
1026({)S
2790 V
(23181)210 648 A
1026(/*)S
(This)168 1194 A
(function)336 1404 A
1782(is)S
(called)252 1908 A
(from)168 2202 A
(common_open.)504 2412 A
2958(It)S
(checks)252 3084 A
3378(if)S
2880 V
(23182)210 648 A
1068(*)S
(there)210 1194 A
1446(is)S
1572(at)S
(least)210 1698 A
(one)126 1950 A
(reader/writer)546 2118 A
(pair)168 2706 A
(for)126 2916 A
(the)126 3084 A
(pipe,)210 3252 A
3504(if)S
(not)126 3630 A
2970 V
(23183)210 648 A
1068(*)S
1194(it)S
(suspends)336 1320 A
(the)126 1698 A
(caller,)294 1866 A
(otherwise)378 2202 A
2622(it)S
(revives)294 2748 A
(all)126 3084 A
(other)210 3252 A
(blocked)294 3504 A
3060 V
(23184)210 648 A
1068(*)S
(processes)378 1194 A
(hanging)294 1614 A
1950(on)S
(the)126 2076 A
(pipe.)210 2244 A
3150 V
(23185)210 648 A
1068(*/)S
3240 V
(23186)210 648 A
3330 V
(23187)210 648 A
1110(if)S
(\(find_filp\(rip,)630 1236 A
(bits)168 1908 A
2118(&)S
(W_BIT)210 2202 A
2454(?)S
(R_BIT)210 2538 A
2790(:)S
(W_BIT\))252 2874 A
3168(==)S
(NIL_FILP\))378 3294 A
3714({)S
3420 V
(23188)210 648 A
1362(if)S
(\(oflags)294 1488 A
1824(&)S
(O_NONBLOCK\))462 1908 A
2412({)S
3510 V
(23189)210 648 A
1698(if)S
(\(bits)210 1824 A
2076(&)S
(W_BIT\))252 2160 A
(return\(ENXIO\);)588 2454 A
3600 V
(23190)210 648 A
1362(})S
(else)168 1446 A
3690 V
(23191)210 648 A
(suspend\(XPOPEN\);)672 1698 A
2706(/*)S
(suspend)294 2832 A
(caller)252 3168 A
3462(*/)S
3780 V
(23192)210 648 A
1110(})S
(else)168 1194 A
1404(if)S
(\(susp_count)462 1530 A
2034(>)S
2118(0\))S
({/*)126 2244 A
(revive)252 2412 A
(blocked)294 2706 A
(processes)378 3042 A
3462(*/)S
3870 V
(23193)210 648 A
(release\(rip,)504 1362 A
(OPEN,)210 1908 A
(susp_count\);)504 2160 A
3960 V
(23194)210 648 A
(release\(rip,)504 1362 A
(CREAT,)252 1908 A
(susp_count\);)504 2202 A
4050 V
(23195)210 648 A
1110(})S
4140 V
(23196)210 648 A
(rip->i_pipe)462 1110 A
1614(=)S
(I_PIPE;)294 1698 A
4230 V
(23197)210 648 A
4320 V
(23198)210 648 A
(return\(OK\);)462 1110 A
4410 V
(23199)210 648 A
1026(})S
4680 V
(23202)210 648 A
(/*===========================================================================*)3276 1026 A
4770 V
(23203)210 648 A
1068(*)S
(do_mknod)336 2370 A
4260(*)S
4860 V
(23204)210 648 A
(*===========================================================================*/)3276 1068 A
4950 V
(23205)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_mknod\(\))420 1488 A
5040 V
(23206)210 648 A
1026({)S
5130 V
(23207)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(mknod\(name,)462 1656 A
(mode,)210 2160 A
(addr\))210 2412 A
(system)252 2664 A
(call.)210 2958 A
3210(*/)S
5220 V
(23208)210 648 A
5310 V
(23209)210 648 A
(register)336 1110 A
(mode_t)252 1488 A
(bits,)210 1782 A
(mode_bits;)420 2034 A
5400 V
(23210)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*ip;)168 1656 A
5490 V
(23211)210 648 A
5580 V
(23212)210 648 A
1110(/*)S
(Only)168 1236 A
(the)126 1446 A
(super_user)420 1614 A
(may)126 2076 A
(make)168 2244 A
(nodes)210 2454 A
(other)210 2706 A
(than)168 2958 A
(fifos.)252 3168 A
3462(*/)S
5670 V
(23213)210 648 A
(mode_bits)378 1110 A
1530(=)S
(\(mode_t\))336 1614 A
(m.m1_i2;)336 1992 A
2370(/*)S
(mode)168 2496 A
2706(of)S
(the)126 2832 A
(inode)210 3000 A
3252(*/)S
5760 V
(23214)210 648 A
1110(if)S
(\(!super_user)504 1236 A
1782(&&)S
(\(\(mode_bits)462 1908 A
2412(&)S
(I_TYPE\))294 2496 A
2832(!=)S
(I_NAMED_PIPE\)\))588 2958 A
(return\(EPERM\);)588 3588 A
5850 V
(23215)210 648 A
1110(if)S
(\(fetch_name\(m.m1_p1,)840 1236 A
(m.m1_i1,)336 2118 A
(M1\))126 2496 A
2664(!=)S
(OK\))126 2790 A
(return\(err_code\);)714 2958 A
5940 V
(23216)210 648 A
(bits)168 1110 A
1320(=)S
(\(mode_bits)420 1404 A
1866(&)S
(I_TYPE\))294 1950 A
2286(|)S
(\(mode_bits)420 2370 A
2832(&)S
(ALL_MODES)378 2916 A
3336(&)S
(fp->fp_umask\);)588 3420 A
6030 V
(23217)210 648 A
1110(ip)S
1236(=)S
(new_node\(user_path,)798 1320 A
(bits,)210 2160 A
(\(zone_t\))336 2412 A
(m.m1_i3\);)378 2790 A
6120 V
(23218)210 648 A
(put_inode\(ip\);)588 1110 A
6210 V
(23219)210 648 A
(return\(err_code\);)714 1110 A
8418 V
EP
%%Page: 318 318
BP
/slant 0 def
/height 0 def
630 V
12 B
(318)180 648 A
11 R
2139(File:)S
2372(src/fs/open.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(23220)210 648 A
1026(})S
1170 V
(23223)210 648 A
(/*===========================================================================*)3276 1026 A
1260 V
(23224)210 648 A
1068(*)S
(do_mkdir)336 2370 A
4260(*)S
1350 V
(23225)210 648 A
(*===========================================================================*/)3276 1068 A
1440 V
(23226)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_mkdir\(\))420 1488 A
1530 V
(23227)210 648 A
1026({)S
1620 V
(23228)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(mkdir\(name,)462 1656 A
(mode\))210 2160 A
(system)252 2412 A
(call.)210 2706 A
2958(*/)S
1710 V
(23229)210 648 A
1800 V
(23230)210 648 A
(int)126 1110 A
(r1,)126 1278 A
(r2;)126 1446 A
2370(/*)S
(status)252 2496 A
(codes)210 2790 A
3042(*/)S
1890 V
(23231)210 648 A
(ino_t)210 1110 A
(dot,)168 1362 A
(dotdot;)294 1572 A
2370(/*)S
(inode)210 2496 A
(numbers)294 2748 A
(for)126 3084 A
3252(.)S
(and)126 3336 A
3504(..)S
3630(*/)S
1980 V
(23232)210 648 A
(mode_t)252 1110 A
(bits;)210 1404 A
2370(/*)S
(mode)168 2496 A
(bits)168 2706 A
(for)126 2916 A
(the)126 3084 A
(new)126 3252 A
(inode)210 3420 A
3672(*/)S
2070 V
(23233)210 648 A
(char)168 1110 A
(string[NAME_MAX];)714 1320 A
2370(/*)S
(last)168 2496 A
(component)378 2706 A
3126(of)S
(the)126 3252 A
(new)126 3420 A
(dir's)210 3588 A
(path)168 3840 A
(name)168 4050 A
4260(*/)S
2160 V
(23234)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip,)210 2034 A
(*ldirp;)294 2286 A
2250 V
(23235)210 648 A
2340 V
(23236)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
1908(it)S
2034(is)S
(possible)336 2160 A
2538(to)S
(make)168 2664 A
(another)294 2874 A
(link)168 3210 A
3420(in)S
(the)126 3546 A
(parent)252 3714 A
(dir.)168 4008 A
4218(*/)S
2430 V
(23237)210 648 A
1110(if)S
(\(fetch_name\(name1,)756 1236 A
(name1_length,)546 2034 A
(M1\))126 2622 A
2790(!=)S
(OK\))126 2916 A
(return\(err_code\);)714 3084 A
2520 V
(23238)210 648 A
(ldirp)210 1110 A
1362(=)S
(last_dir\(user_path,)798 1446 A
(string\);)336 2286 A
2706(/*)S
(pointer)294 2832 A
3168(to)S
(new)126 3294 A
(dir's)210 3462 A
(parent)252 3714 A
4008(*/)S
2610 V
(23239)210 648 A
1110(if)S
(\(ldirp)252 1236 A
1530(==)S
(NIL_INODE\))420 1656 A
(return\(err_code\);)714 2118 A
2700 V
(23240)210 648 A
1110(if)S
1236(\()S
(\(ldirp->i_nlinks)672 1320 A
2034(&)S
(BYTE\))210 2118 A
2370(>=)S
(LINK_MAX\))378 2496 A
2916({)S
2790 V
(23241)210 648 A
(put_inode\(ldirp\);)714 1362 A
2370(/*)S
(return)252 2496 A
(parent)252 2790 A
3084(*/)S
2880 V
(23242)210 648 A
(return\(EMLINK\);)630 1362 A
2970 V
(23243)210 648 A
1110(})S
3060 V
(23244)210 648 A
3150 V
(23245)210 648 A
1110(/*)S
(Next)168 1236 A
(make)168 1446 A
(the)126 1656 A
(inode.)252 1824 A
2118(If)S
(that)168 2244 A
(fails,)252 2454 A
(return)252 2748 A
(error)210 3042 A
(code.)210 3294 A
3546(*/)S
3240 V
(23246)210 648 A
(bits)168 1110 A
1320(=)S
(I_DIRECTORY)462 1404 A
1908(|)S
(\(mode)210 1992 A
2244(&)S
(RWX_MODES)378 2328 A
2748(&)S
(fp->fp_umask\);)588 2832 A
3330 V
(23247)210 648 A
(rip)126 1110 A
1278(=)S
(new_node\(user_path,)798 1362 A
(bits,)210 2202 A
(\(zone_t\))336 2454 A
(0\);)126 2832 A
3420 V
(23248)210 648 A
1110(if)S
(\(rip)168 1236 A
1446(==)S
(NIL_INODE)378 1572 A
1992(||)S
(err_code)336 2118 A
2496(==)S
(EEXIST\))294 2622 A
2958({)S
3510 V
(23249)210 648 A
(put_inode\(rip\);)630 1362 A
2370(/*)S
(can't)210 2496 A
(make)168 2748 A
(dir:)168 2958 A
3168(it)S
(already)294 3294 A
(exists)252 3630 A
3924(*/)S
3600 V
(23250)210 648 A
(put_inode\(ldirp\);)714 1362 A
2370(/*)S
(return)252 2496 A
(parent)252 2790 A
(too)126 3084 A
3252(*/)S
3690 V
(23251)210 648 A
(return\(err_code\);)714 1362 A
3780 V
(23252)210 648 A
1110(})S
3870 V
(23253)210 648 A
3960 V
(23254)210 648 A
1110(/*)S
(Get)126 1236 A
(the)126 1404 A
(inode)210 1572 A
(numbers)294 1824 A
(for)126 2160 A
2328(.)S
(and)126 2412 A
2580(..)S
2706(to)S
(enter)210 2832 A
3084(in)S
(the)126 3210 A
(directory.)420 3378 A
3840(*/)S
4050 V
(23255)210 648 A
(dotdot)252 1110 A
1404(=)S
(ldirp->i_num;)546 1488 A
2370(/*)S
(parent's)336 2496 A
(inode)210 2874 A
(number)252 3126 A
3420(*/)S
4140 V
(23256)210 648 A
(dot)126 1110 A
1278(=)S
(rip->i_num;)462 1362 A
2370(/*)S
(inode)210 2496 A
(number)252 2748 A
3042(of)S
(the)126 3168 A
(new)126 3336 A
(dir)126 3504 A
(itself)252 3672 A
3966(*/)S
4230 V
(23257)210 648 A
4320 V
(23258)210 648 A
1110(/*)S
(Now)126 1236 A
(make)168 1404 A
(dir)126 1614 A
(entries)294 1782 A
(for)126 2118 A
2286(.)S
(and)126 2370 A
2538(..)S
(unless)252 2664 A
(the)126 2958 A
(disk)168 3126 A
3336(is)S
(completely)420 3462 A
(full.)210 3924 A
4176(*/)S
4410 V
(23259)210 648 A
1110(/*)S
(Use)126 1236 A
(dot1)168 1404 A
(and)126 1614 A
(dot2,)210 1782 A
2034(so)S
(the)126 2160 A
(mode)168 2328 A
2538(of)S
(the)126 2664 A
(directory)378 2832 A
(isn't)210 3252 A
(important.)420 3504 A
3966(*/)S
4500 V
(23260)210 648 A
(rip->i_mode)462 1110 A
1614(=)S
(bits;)210 1698 A
2034(/*)S
(set)126 2160 A
(mode)168 2328 A
2538(*/)S
4590 V
(23261)210 648 A
1110(r1)S
1236(=)S
(search_dir\(rip,)630 1320 A
(dot1,)210 1992 A
(&dot,)210 2244 A
(ENTER\);)294 2496 A
3042(/*)S
(enter)210 3168 A
3420(.)S
3504(in)S
(the)126 3630 A
(new)126 3798 A
(dir)126 3966 A
4134(*/)S
4680 V
(23262)210 648 A
1110(r2)S
1236(=)S
(search_dir\(rip,)630 1320 A
(dot2,)210 1992 A
(&dotdot,)336 2244 A
(ENTER\);)294 2622 A
3042(/*)S
(enter)210 3168 A
3420(..)S
3546(in)S
(the)126 3672 A
(new)126 3840 A
(dir)126 4008 A
4176(*/)S
4770 V
(23263)210 648 A
4860 V
(23264)210 648 A
1110(/*)S
1236(If)S
(both)168 1362 A
1572(.)S
(and)126 1656 A
1824(..)S
(were)168 1950 A
(successfully)504 2160 A
(entered,)336 2706 A
(increment)378 3084 A
(the)126 3504 A
(link)168 3672 A
(counts.)294 3882 A
4218(*/)S
4950 V
(23265)210 648 A
1110(if)S
(\(r1)126 1236 A
1404(==)S
1530(OK)S
1656(&&)S
1782(r2)S
1908(==)S
(OK\))126 2034 A
2202({)S
5040 V
(23266)210 648 A
1362(/*)S
(Normal)252 1488 A
(case.)210 1782 A
2076(It)S
(was)126 2202 A
(possible)336 2370 A
2748(to)S
(enter)210 2874 A
3126(.)S
(and)126 3210 A
3378(..)S
3504(in)S
(the)126 3630 A
(new)126 3798 A
(dir.)168 3966 A
4176(*/)S
5130 V
(23267)210 648 A
(rip->i_nlinks++;)672 1362 A
2370(/*)S
(this)168 2496 A
(accounts)336 2706 A
(for)126 3084 A
3252(.)S
3336(*/)S
5220 V
(23268)210 648 A
(ldirp->i_nlinks++;)756 1362 A
2370(/*)S
(this)168 2496 A
(accounts)336 2706 A
(for)126 3084 A
3252(..)S
3378(*/)S
5310 V
(23269)210 648 A
(ldirp->i_dirt)546 1362 A
1950(=)S
(DIRTY;)252 2034 A
2370(/*)S
(mark)168 2496 A
(parent's)336 2706 A
(inode)210 3084 A
3336(as)S
(dirty)210 3462 A
3714(*/)S
5400 V
(23270)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5490 V
(23271)210 648 A
1362(/*)S
1488(It)S
(was)126 1614 A
(not)126 1782 A
(possible)336 1950 A
2328(to)S
(enter)210 2454 A
2706(.)S
2790(or)S
2916(..)S
(probably)336 3042 A
(disk)168 3420 A
(was)126 3630 A
(full.)210 3798 A
4050(*/)S
5580 V
(23272)210 648 A
(\(void\))252 1362 A
(search_dir\(ldirp,)714 1656 A
(string,)294 2412 A
(\(ino_t)252 2748 A
3042(*\))S
3168(0,)S
(DELETE\);)336 3294 A
5670 V
(23273)210 648 A
(rip->i_nlinks--;)672 1362 A
2370(/*)S
(undo)168 2496 A
(the)126 2706 A
(increment)378 2874 A
(done)168 3294 A
3504(in)S
(new_node\(\))420 3630 A
4092(*/)S
5760 V
(23274)210 648 A
1110(})S
5850 V
(23275)210 648 A
(rip->i_dirt)462 1110 A
1614(=)S
(DIRTY;)252 1698 A
2370(/*)S
(either)252 2496 A
(way,)168 2790 A
(i_nlinks)336 3000 A
(has)126 3378 A
(changed)294 3546 A
3882(*/)S
5940 V
(23276)210 648 A
6030 V
(23277)210 648 A
(put_inode\(ldirp\);)714 1110 A
2370(/*)S
(return)252 2496 A
(the)126 2790 A
(inode)210 2958 A
3210(of)S
(the)126 3336 A
(parent)252 3504 A
(dir)126 3798 A
3966(*/)S
6120 V
(23278)210 648 A
(put_inode\(rip\);)630 1110 A
2370(/*)S
(return)252 2496 A
(the)126 2790 A
(inode)210 2958 A
3210(of)S
(the)126 3336 A
(newly)210 3504 A
(made)168 3756 A
(dir)126 3966 A
4134(*/)S
6210 V
(23279)210 648 A
(return\(err_code\);)714 1110 A
2370(/*)S
(new_node\(\))420 2496 A
(always)252 2958 A
(sets)168 3252 A
('err_code')420 3462 A
3924(*/)S
8418 V
EP
%%Page: 319 319
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2139(File:)S
2372(src/fs/open.c)S
12 B
(319)180 4248 A
900 V
7 LST
(23280)210 648 A
1026(})S
1170 V
(23283)210 648 A
(/*===========================================================================*)3276 1026 A
1260 V
(23284)210 648 A
1068(*)S
(do_close)336 2370 A
4260(*)S
1350 V
(23285)210 648 A
(*===========================================================================*/)3276 1068 A
1440 V
(23286)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_close\(\))420 1488 A
1530 V
(23287)210 648 A
1026({)S
1620 V
(23288)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(close\(fd\))378 1656 A
(system)252 2076 A
(call.)210 2370 A
2622(*/)S
1710 V
(23289)210 648 A
1800 V
(23290)210 648 A
(register)336 1110 A
(struct)252 1488 A
(filp)168 1782 A
(*rfilp;)294 1992 A
1890 V
(23291)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
1980 V
(23292)210 648 A
(struct)252 1110 A
(file_lock)378 1404 A
(*flp;)210 1824 A
2070 V
(23293)210 648 A
(int)126 1110 A
(rw,)126 1278 A
(mode_word,)420 1446 A
(major,)252 1908 A
(task,)210 2202 A
(lock_count;)462 2454 A
2160 V
(23294)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
2250 V
(23295)210 648 A
2340 V
(23296)210 648 A
1110(/*)S
(First)210 1236 A
(locate)252 1488 A
(the)126 1782 A
(inode)210 1950 A
(that)168 2202 A
(belongs)294 2412 A
2748(to)S
(the)126 2874 A
(file)168 3042 A
(descriptor.)462 3252 A
3756(*/)S
2430 V
(23297)210 648 A
1110(if)S
1236(\()S
(\(rfilp)252 1320 A
1614(=)S
(get_filp\(fd\)\))546 1698 A
2286(==)S
(NIL_FILP\))378 2412 A
(return\(err_code\);)714 2832 A
2520 V
(23298)210 648 A
(rip)126 1110 A
1278(=)S
(rfilp->filp_ino;)672 1362 A
2370(/*)S
('rip')210 2496 A
(points)252 2748 A
3042(to)S
(the)126 3168 A
(inode)210 3336 A
3588(*/)S
2610 V
(23299)210 648 A
2700 V
(23300)210 648 A
1110(if)S
(\(rfilp->filp_count)756 1236 A
2034(-)S
2118(1)S
2202(==)S
2328(0)S
2412(&&)S
(rfilp->filp_mode)672 2538 A
3252(!=)S
(FILP_CLOSED\))504 3378 A
3924({)S
2790 V
(23301)210 648 A
1362(/*)S
(Check)210 1488 A
1740(to)S
(see)126 1866 A
2034(if)S
(the)126 2160 A
(file)168 2328 A
2538(is)S
(special.)336 2664 A
3042(*/)S
2880 V
(23302)210 648 A
(mode_word)378 1362 A
1782(=)S
(rip->i_mode)462 1866 A
2370(&)S
(I_TYPE;)294 2454 A
2970 V
(23303)210 648 A
1362(if)S
(\(mode_word)420 1488 A
1950(==)S
(I_CHAR_SPECIAL)588 2076 A
2706(||)S
(mode_word)378 2832 A
3252(==)S
(I_BLOCK_SPECIAL\))672 3378 A
4092({)S
3060 V
(23304)210 648 A
(dev)126 1698 A
1866(=)S
(\(dev_t\))294 1950 A
(rip->i_zone[0];)630 2286 A
3150 V
(23305)210 648 A
1698(if)S
(\(mode_word)420 1824 A
2286(==)S
(I_BLOCK_SPECIAL\))672 2412 A
3168({)S
3240 V
(23306)210 648 A
2034(/*)S
(Invalidate)420 2160 A
(cache)210 2622 A
(entries)294 2874 A
(unless)252 3210 A
(special)294 3504 A
3840(is)S
(mounted)294 3966 A
3330 V
(23307)210 648 A
2076(*)S
2160(or)S
(ROOT)168 2286 A
3420 V
(23308)210 648 A
2076(*/)S
3510 V
(23309)210 648 A
2034(if)S
(\(!mounted\(rip\)\))630 2160 A
2832({)S
3600 V
(23310)210 648 A
(\(void\))252 2370 A
(do_sync\(\);)420 2664 A
3378(/*)S
(purge)210 3504 A
(cache)210 3756 A
4008(*/)S
3690 V
(23311)210 648 A
(invalidate\(dev\);)672 2370 A
3780 V
(23312)210 648 A
2034(})S
3870 V
(23313)210 648 A
1698(})S
3960 V
(23314)210 648 A
1698(/*)S
(Use)126 1824 A
(the)126 1992 A
(dmap_close)420 2160 A
(entry)210 2622 A
2874(to)S
3000(do)S
(any)126 3126 A
(special)294 3294 A
(processing)420 3630 A
4050 V
(23315)210 648 A
1740(*)S
(required.)378 1824 A
4140 V
(23316)210 648 A
1740(*/)S
4230 V
(23317)210 648 A
(dev_mess.m_type)630 1698 A
2370(=)S
(DEV_CLOSE;)420 2454 A
4320 V
(23318)210 648 A
(dev_mess.DEVICE)630 1698 A
2370(=)S
(dev;)168 2454 A
4410 V
(23319)210 648 A
(major)210 1698 A
1950(=)S
(\(dev)168 2034 A
2244(>>)S
(MAJOR\))252 2370 A
2664(&)S
(BYTE;)210 2748 A
3042(/*)S
(major)210 3168 A
(device)252 3420 A
3714(nr)S
3840(*/)S
4500 V
(23320)210 648 A
(task)168 1698 A
1908(=)S
(dmap[major].dmap_task;)924 1992 A
3042(/*)S
(device)252 3168 A
(task)168 3462 A
3672(nr)S
3798(*/)S
4590 V
(23321)210 648 A
(\(*dmap[major].dmap_close\)\(task,)1302 1698 A
(&dev_mess\);)462 3042 A
4680 V
(23322)210 648 A
1362(})S
4770 V
(23323)210 648 A
1110(})S
4860 V
(23324)210 648 A
4950 V
(23325)210 648 A
1110(/*)S
1236(If)S
(the)126 1362 A
(inode)210 1530 A
(being)210 1782 A
(closed)252 2034 A
2328(is)S
2454(a)S
(pipe,)210 2538 A
(release)294 2790 A
(everyone)336 3126 A
(hanging)294 3504 A
3840(on)S
(it.)126 3966 A
4134(*/)S
5040 V
(23326)210 648 A
1110(if)S
(\(rip->i_pipe)504 1236 A
1782(==)S
(I_PIPE\))294 1908 A
2244({)S
5130 V
(23327)210 648 A
1362(rw)S
1488(=)S
(\(rfilp->filp_mode)714 1572 A
2328(&)S
(R_BIT)210 2412 A
2664(?)S
(WRITE)210 2748 A
3000(:)S
(READ\);)252 3084 A
5220 V
(23328)210 648 A
(release\(rip,)504 1362 A
(rw,)126 1908 A
(NR_PROCS\);)420 2076 A
5310 V
(23329)210 648 A
1110(})S
5400 V
(23330)210 648 A
5490 V
(23331)210 648 A
1110(/*)S
1236(If)S
1362(a)S
(write)210 1446 A
(has)126 1698 A
(been)168 1866 A
(done,)210 2076 A
(the)126 2328 A
(inode)210 2496 A
2748(is)S
(already)294 2874 A
(marked)252 3210 A
3504(as)S
(DIRTY.)252 3630 A
3924(*/)S
5580 V
(23332)210 648 A
1110(if)S
(\(--rfilp->filp_count)840 1236 A
2118(==)S
2244(0\))S
2370({)S
5670 V
(23333)210 648 A
1362(if)S
(\(rip->i_pipe)504 1488 A
2034(==)S
(I_PIPE)252 2160 A
2454(&&)S
(rip->i_count)504 2580 A
3126(>)S
3210(1\))S
3336({)S
5760 V
(23334)210 648 A
1698(/*)S
(Save)168 1824 A
(the)126 2034 A
(file)168 2202 A
(position)336 2412 A
2790(in)S
(the)126 2916 A
(i-node)252 3084 A
3378(in)S
(case)168 3504 A
(needed)252 3714 A
(later.)252 4008 A
5850 V
(23335)210 648 A
1740(*)S
(The)126 1824 A
(read)168 1992 A
(and)126 2202 A
(write)210 2370 A
(positions)378 2622 A
(are)126 3042 A
(saved)210 3210 A
(separately.)462 3462 A
(The)126 4008 A
5940 V
(23336)210 648 A
1740(*)S
(last)168 1824 A
2034(3)S
(zones)210 2118 A
2370(in)S
(the)126 2496 A
(i-node)252 2664 A
(are)126 2958 A
(not)126 3126 A
(used)168 3294 A
(for)126 3504 A
(\(named\))294 3672 A
(pipes.)252 4008 A
6030 V
(23337)210 648 A
1740(*/)S
6120 V
(23338)210 648 A
1698(if)S
(\(rfilp->filp_mode)714 1824 A
2580(==)S
(R_BIT\))252 2706 A
6210 V
(23339)210 648 A
(rip->i_zone[V2_NR_DZONES+1])1134 2034 A
3210(=)S
(\(zone_t\))336 3294 A
(rfilp->filp_pos;)672 3672 A
8418 V
EP
%%Page: 320 320
BP
/slant 0 def
/height 0 def
630 V
12 B
(320)180 648 A
11 R
2139(File:)S
2372(src/fs/open.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(23340)210 648 A
(else)168 1698 A
990 V
(23341)210 648 A
(rip->i_zone[V2_NR_DZONES+2])1134 2034 A
3210(=)S
(\(zone_t\))336 3294 A
(rfilp->filp_pos;)672 3672 A
1080 V
(23342)210 648 A
1362(})S
1170 V
(23343)210 648 A
(put_inode\(rip\);)630 1362 A
1260 V
(23344)210 648 A
1110(})S
1350 V
(23345)210 648 A
1440 V
(23346)210 648 A
(fp->fp_cloexec)588 1110 A
1740(&=)S
(\304\(1L)168 1866 A
2076(<<)S
(fd\);)168 2202 A
2706(/*)S
(turn)168 2832 A
(off)126 3042 A
(close-on-exec)546 3210 A
(bit)126 3798 A
3966(*/)S
1530 V
(23347)210 648 A
(fp->fp_filp[fd])630 1110 A
1782(=)S
(NIL_FILP;)378 1866 A
1620 V
(23348)210 648 A
1710 V
(23349)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
(the)126 1908 A
(file)168 2076 A
2286(is)S
(locked.)294 2412 A
2790(If)S
(so,)126 2916 A
(release)294 3084 A
(all)126 3420 A
(locks.)252 3588 A
3882(*/)S
1800 V
(23350)210 648 A
1110(if)S
(\(nr_locks)378 1236 A
1656(==)S
1782(0\))S
(return\(OK\);)462 1908 A
1890 V
(23351)210 648 A
(lock_count)420 1110 A
1572(=)S
(nr_locks;)378 1656 A
2370(/*)S
(save)168 2496 A
(count)210 2706 A
2958(of)S
(locks)210 3084 A
3336(*/)S
1980 V
(23352)210 648 A
(for)126 1110 A
(\(flp)168 1278 A
1488(=)S
(&file_lock[0];)588 1572 A
(flp)126 2202 A
2370(<)S
(&file_lock[NR_LOCKS];)882 2454 A
(flp++\))252 3378 A
3672({)S
2070 V
(23353)210 648 A
1362(if)S
(\(flp->lock_type)630 1488 A
2160(==)S
2286(0\))S
(continue;)378 2412 A
3042(/*)S
(slot)168 3168 A
(not)126 3378 A
3546(in)S
(use)126 3672 A
3840(*/)S
2160 V
(23354)210 648 A
1362(if)S
(\(flp->lock_inode)672 1488 A
2202(==)S
(rip)126 2328 A
2496(&&)S
(flp->lock_pid)546 2622 A
3210(==)S
(fp->fp_pid\))462 3336 A
3840({)S
2250 V
(23355)210 648 A
(flp->lock_type)588 1698 A
2328(=)S
2412(0;)S
2340 V
(23356)210 648 A
(nr_locks--;)462 1698 A
2430 V
(23357)210 648 A
1362(})S
2520 V
(23358)210 648 A
1110(})S
2610 V
(23359)210 648 A
1110(if)S
(\(nr_locks)378 1236 A
1656(<)S
(lock_count\))462 1740 A
(lock_revive\(\);)588 2244 A
3042(/*)S
(lock)168 3168 A
(released)336 3378 A
3756(*/)S
2700 V
(23360)210 648 A
(return\(OK\);)462 1110 A
2790 V
(23361)210 648 A
1026(})S
3060 V
(23364)210 648 A
(/*===========================================================================*)3276 1026 A
3150 V
(23365)210 648 A
1068(*)S
(do_lseek)336 2370 A
4260(*)S
3240 V
(23366)210 648 A
(*===========================================================================*/)3276 1068 A
3330 V
(23367)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_lseek\(\))420 1488 A
3420 V
(23368)210 648 A
1026({)S
3510 V
(23369)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(lseek\(ls_fd,)504 1656 A
(offset,)294 2202 A
(whence\))294 2538 A
(system)252 2874 A
(call.)210 3168 A
3420(*/)S
3600 V
(23370)210 648 A
3690 V
(23371)210 648 A
(register)336 1110 A
(struct)252 1488 A
(filp)168 1782 A
(*rfilp;)294 1992 A
3780 V
(23372)210 648 A
(register)336 1110 A
(off_t)210 1488 A
(pos;)168 1740 A
3870 V
(23373)210 648 A
3960 V
(23374)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
(the)126 1908 A
(file)168 2076 A
(descriptor)420 2286 A
2748(is)S
(valid.)252 2874 A
3168(*/)S
4050 V
(23375)210 648 A
1110(if)S
1236(\()S
(\(rfilp)252 1320 A
1614(=)S
(get_filp\(ls_fd\)\))672 1698 A
2412(==)S
(NIL_FILP\))378 2538 A
(return\(err_code\);)714 2958 A
4140 V
(23376)210 648 A
4230 V
(23377)210 648 A
1110(/*)S
1236(No)S
(lseek)210 1362 A
1614(on)S
(pipes.)252 1740 A
2034(*/)S
4320 V
(23378)210 648 A
1110(if)S
(\(rfilp->filp_ino->i_pipe)1008 1236 A
2286(==)S
(I_PIPE\))294 2412 A
(return\(ESPIPE\);)630 2748 A
4410 V
(23379)210 648 A
4500 V
(23380)210 648 A
1110(/*)S
(The)126 1236 A
(value)210 1404 A
1656(of)S
('whence')336 1782 A
(determines)420 2160 A
(the)126 2622 A
(start)210 2790 A
(position)336 3042 A
3420(to)S
(use.)168 3546 A
3756(*/)S
4590 V
(23381)210 648 A
(switch\(whence\))588 1110 A
1740({)S
4680 V
(23382)210 648 A
(case)168 1362 A
1572(0:)S
(pos)126 1698 A
1866(=)S
1950(0;)S
(break;)252 2370 A
4770 V
(23383)210 648 A
(case)168 1362 A
1572(1:)S
(pos)126 1698 A
1866(=)S
(rfilp->filp_pos;)672 1950 A
(break;)252 2706 A
4860 V
(23384)210 648 A
(case)168 1362 A
1572(2:)S
(pos)126 1698 A
1866(=)S
(rfilp->filp_ino->i_size;)1008 1950 A
(break;)252 3042 A
4950 V
(23385)210 648 A
(default:)336 1362 A
(return\(EINVAL\);)630 1740 A
5040 V
(23386)210 648 A
1110(})S
5130 V
(23387)210 648 A
5220 V
(23388)210 648 A
1110(/*)S
(Check)210 1236 A
(for)126 1488 A
(overflow.)378 1656 A
2076(*/)S
5310 V
(23389)210 648 A
1110(if)S
(\(\(\(long\)offset)588 1236 A
1866(>)S
1950(0\))S
2076(&&)S
(\(\(long\)\(pos)462 2202 A
2706(+)S
(offset\))294 2790 A
3126(<)S
(\(long\)pos\)\))462 3210 A
(return\(EINVAL\);)630 3714 A
5400 V
(23390)210 648 A
1110(if)S
(\(\(\(long\)offset)588 1236 A
1866(<)S
1950(0\))S
2076(&&)S
(\(\(long\)\(pos)462 2202 A
2706(+)S
(offset\))294 2790 A
3126(>)S
(\(long\)pos\)\))462 3210 A
(return\(EINVAL\);)630 3714 A
5490 V
(23391)210 648 A
(pos)126 1110 A
1278(=)S
(pos)126 1362 A
1530(+)S
(offset;)294 1614 A
5580 V
(23392)210 648 A
5670 V
(23393)210 648 A
1110(if)S
(\(pos)168 1236 A
1446(!=)S
(rfilp->filp_pos\))672 1572 A
5760 V
(23394)210 648 A
(rfilp->filp_ino->i_seek)966 1362 A
2370(=)S
(ISEEK;)252 2454 A
3042(/*)S
(inhibit)294 3168 A
(read)168 3504 A
(ahead)210 3714 A
3966(*/)S
5850 V
(23395)210 648 A
(rfilp->filp_pos)630 1110 A
1782(=)S
(pos;)168 1866 A
5940 V
(23396)210 648 A
(reply_l1)336 1110 A
1488(=)S
(pos;)168 1572 A
2370(/*)S
(insert)252 2496 A
(the)126 2790 A
(long)168 2958 A
(into)168 3168 A
(the)126 3378 A
(output)252 3546 A
(message)294 3840 A
4176(*/)S
6030 V
(23397)210 648 A
(return\(OK\);)462 1110 A
6120 V
(23398)210 648 A
1026(})S
8418 V
EP
%%Page: 321 321
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2150(File:)S
2383(src/fs/read.c)S
12 B
(321)180 4248 A
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/fs/read.c)546 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(23400)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(heart)210 2118 A
2370(of)S
(the)126 2496 A
(mechanism)378 2664 A
(used)168 3084 A
3294(to)S
(read)168 3420 A
(\(and)168 3630 A
(write\))252 3840 A
1440 V
(23401)210 648 A
1068(*)S
(files.)252 1152 A
(Read)168 1488 A
(and)126 1698 A
(write)210 1866 A
(requests)336 2118 A
(are)126 2496 A
(split)210 2664 A
2916(up)S
(into)168 3042 A
(chunks)252 3252 A
(that)168 3546 A
3756(do)S
(not)126 3882 A
(cross)210 4050 A
1530 V
(23402)210 648 A
1068(*)S
(block)210 1152 A
(boundaries.)462 1404 A
(Each)168 1950 A
(chunk)210 2160 A
2412(is)S
(then)168 2538 A
(processed)378 2748 A
3168(in)S
(turn.)210 3294 A
(Reads)210 3588 A
3840(on)S
(special)294 3966 A
1620 V
(23403)210 648 A
1068(*)S
(files)210 1152 A
(are)126 1404 A
(also)168 1572 A
(detected)336 1782 A
(and)126 2160 A
(handled.)336 2328 A
1710 V
(23404)210 648 A
1068(*)S
1800 V
(23405)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
1890 V
(23406)210 648 A
1068(*)S
(do_read:)336 1236 A
(perform)294 1740 A
(the)126 2076 A
(READ)168 2244 A
(system)252 2454 A
(call)168 2748 A
2958(by)S
(calling)294 3084 A
(read_write)420 3420 A
1980 V
(23407)210 648 A
1068(*)S
(read_write:)462 1236 A
(actually)336 1740 A
2118(do)S
(the)126 2244 A
(work)168 2412 A
2622(of)S
(READ)168 2748 A
(and)126 2958 A
(WRITE)210 3126 A
2070 V
(23408)210 648 A
1068(*)S
(read_map:)378 1236 A
(given)210 1740 A
1992(an)S
(inode)210 2118 A
(and)126 2370 A
(file)168 2538 A
(position,)378 2748 A
(look)168 3168 A
3378(up)S
(its)126 3504 A
(zone)168 3672 A
(number)252 3882 A
2160 V
(23409)210 648 A
1068(*)S
(rd_indir:)378 1236 A
(read)168 1740 A
1950(an)S
(entry)210 2076 A
2328(in)S
2454(an)S
(indirect)336 2580 A
(block)210 2958 A
2250 V
(23410)210 648 A
1068(*)S
(read_ahead:)462 1236 A
(manage)252 1740 A
(the)126 2034 A
(block)210 2202 A
(read)168 2454 A
(ahead)210 2664 A
(business)336 2916 A
2340 V
(23411)210 648 A
1068(*/)S
2430 V
(23412)210 648 A
2520 V
(23413)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
2610 V
(23414)210 648 A
(#include)336 1026 A
(<fcntl.h>)378 1404 A
2700 V
(23415)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
2790 V
(23416)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
2880 V
(23417)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
2970 V
(23418)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
3060 V
(23419)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
3150 V
(23420)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
3240 V
(23421)210 648 A
(#include)336 1026 A
("super.h")378 1404 A
3330 V
(23422)210 648 A
3420 V
(23423)210 648 A
(#define)294 1026 A
(FD_MASK)294 1362 A
(077)126 2076 A
2370(/*)S
(max)126 2496 A
(file)168 2664 A
(descriptor)420 2874 A
3336(is)S
3462(63)S
3588(*/)S
3510 V
(23424)210 648 A
3600 V
(23425)210 648 A
(PRIVATE)294 1026 A
(message)294 1362 A
(umess;)252 1698 A
2370(/*)S
(message)294 2496 A
(for)126 2832 A
(asking)252 3000 A
(SYSTASK)294 3294 A
(for)126 3630 A
(user)168 3798 A
(copy)168 4008 A
4218(*/)S
3690 V
(23426)210 648 A
3780 V
(23427)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(rw_chunk,)378 2034 A
(\(struct)294 2454 A
(inode)210 2790 A
(*rip,)210 3042 A
(off_t)210 3294 A
(position,)378 3546 A
3870 V
(23428)210 648 A
(unsigned)336 2034 A
(off,)168 2412 A
(int)126 2622 A
(chunk,)252 2790 A
(unsigned)336 3084 A
(left,)210 3462 A
(int)126 3714 A
(rw_flag,)336 3882 A
3960 V
(23429)210 648 A
(char)168 2034 A
(*buff,)252 2244 A
(int)126 2538 A
(seg,)168 2706 A
(int)126 2916 A
(usr\))168 3084 A
4050(\);)S
4050 V
(23430)210 648 A
4140 V
(23431)210 648 A
(/*===========================================================================*)3276 1026 A
4230 V
(23432)210 648 A
1068(*)S
(do_read)294 2370 A
4260(*)S
4320 V
(23433)210 648 A
(*===========================================================================*/)3276 1068 A
4410 V
(23434)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_read\(\))378 1488 A
4500 V
(23435)210 648 A
1026({)S
4590 V
(23436)210 648 A
(return\(read_write\(READING\)\);)1176 1110 A
4680 V
(23437)210 648 A
1026(})S
4950 V
(23440)210 648 A
(/*===========================================================================*)3276 1026 A
5040 V
(23441)210 648 A
1068(*)S
(read_write)420 2370 A
4260(*)S
5130 V
(23442)210 648 A
(*===========================================================================*/)3276 1068 A
5220 V
(23443)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(read_write\(rw_flag\))798 1488 A
5310 V
(23444)210 648 A
(int)126 1026 A
(rw_flag;)336 1194 A
2370(/*)S
(READING)294 2496 A
2832(or)S
(WRITING)294 2958 A
3294(*/)S
5400 V
(23445)210 648 A
1026({)S
5490 V
(23446)210 648 A
1026(/*)S
(Perform)294 1152 A
(read\(fd,)336 1488 A
(buffer,)294 1866 A
(nbytes\))294 2202 A
2538(or)S
(write\(fd,)378 2664 A
(buffer,)294 3084 A
(nbytes\))294 3420 A
(call.)210 3756 A
4008(*/)S
5580 V
(23447)210 648 A
5670 V
(23448)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
5760 V
(23449)210 648 A
(register)336 1110 A
(struct)252 1488 A
(filp)168 1782 A
(*f;)126 1992 A
5850 V
(23450)210 648 A
(off_t)210 1110 A
(bytes_left,)462 1362 A
(f_size,)294 1866 A
(position;)378 2202 A
5940 V
(23451)210 648 A
(unsigned)336 1110 A
(int)126 1488 A
(off,)168 1656 A
(cum_io;)294 1866 A
6030 V
(23452)210 648 A
(int)126 1110 A
(op,)126 1278 A
(oflags,)294 1446 A
1782(r,)S
(chunk,)252 1908 A
(usr,)168 2202 A
(seg,)168 2412 A
(block_spec,)462 2622 A
(char_spec;)420 3126 A
6120 V
(23453)210 648 A
(int)126 1110 A
(regular,)336 1278 A
(partial_pipe)504 1656 A
2202(=)S
2286(0,)S
(partial_cnt)462 2412 A
2916(=)S
3000(0;)S
6210 V
(23454)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
8418 V
EP
%%Page: 322 322
BP
/slant 0 def
/height 0 def
630 V
12 B
(322)180 648 A
11 R
2150(File:)S
2383(src/fs/read.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(23455)210 648 A
(mode_t)252 1110 A
(mode_word;)420 1404 A
990 V
(23456)210 648 A
(struct)252 1110 A
(filp)168 1404 A
(*wf;)168 1614 A
1080 V
(23457)210 648 A
1170 V
(23458)210 648 A
1110(/*)S
1236(MM)S
(loads)210 1362 A
(segments)336 1614 A
1992(by)S
(putting)294 2118 A
(funny)210 2454 A
(things)252 2706 A
3000(in)S
(upper)210 3126 A
3378(10)S
(bits)168 3504 A
3714(of)S
('fd'.)210 3840 A
4092(*/)S
1260 V
(23459)210 648 A
1110(if)S
(\(who)168 1236 A
1446(==)S
(MM_PROC_NR)420 1572 A
2034(&&)S
(\(fd)126 2160 A
2328(&)S
(\(\304BYTE\)\))336 2412 A
2790(\))S
2874({)S
1350 V
(23460)210 648 A
(usr)126 1362 A
1530(=)S
(\(fd)126 1614 A
1782(>>)S
1908(8\))S
2034(&)S
(BYTE;)210 2118 A
1440 V
(23461)210 648 A
(seg)126 1362 A
1530(=)S
(\(fd)126 1614 A
1782(>>)S
1908(6\))S
2034(&)S
(03;)126 2118 A
1530 V
(23462)210 648 A
1362(fd)S
1488(&=)S
(FD_MASK;)336 1614 A
2370(/*)S
(get)126 2496 A
(rid)126 2664 A
2832(of)S
(user)168 2958 A
(and)126 3168 A
(segment)294 3336 A
(bits)168 3672 A
3882(*/)S
1620 V
(23463)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1710 V
(23464)210 648 A
(usr)126 1362 A
1530(=)S
(who;)168 1614 A
2370(/*)S
(normal)252 2496 A
(case)168 2790 A
3000(*/)S
1800 V
(23465)210 648 A
(seg)126 1362 A
1530(=)S
1614(D;)S
1890 V
(23466)210 648 A
1110(})S
1980 V
(23467)210 648 A
2070 V
(23468)210 648 A
1110(/*)S
1236(If)S
(the)126 1362 A
(file)168 1530 A
(descriptor)420 1740 A
2202(is)S
(valid,)252 2328 A
(get)126 2622 A
(the)126 2790 A
(inode,)252 2958 A
(size)168 3252 A
(and)126 3462 A
(mode.)210 3630 A
3882(*/)S
2160 V
(23469)210 648 A
1110(if)S
(\(nbytes)294 1236 A
1572(<)S
1656(0\))S
(return\(EINVAL\);)630 1782 A
2250 V
(23470)210 648 A
1110(if)S
(\(\(f)126 1236 A
1404(=)S
(get_filp\(fd\)\))546 1488 A
2076(==)S
(NIL_FILP\))378 2202 A
(return\(err_code\);)714 2622 A
2340 V
(23471)210 648 A
1110(if)S
(\(\(\(f->filp_mode\))672 1236 A
1950(&)S
(\(rw_flag)336 2034 A
2412(==)S
(READING)294 2538 A
2874(?)S
(R_BIT)210 2958 A
3210(:)S
(W_BIT\)\))294 3294 A
3630(==)S
3756(0\))S
3882({)S
2430 V
(23472)210 648 A
(return\(f->filp_mode)798 1362 A
2202(==)S
(FILP_CLOSED)462 2328 A
2832(?)S
(EIO)126 2916 A
3084(:)S
(EBADF\);)294 3168 A
2520 V
(23473)210 648 A
1110(})S
2610 V
(23474)210 648 A
1110(if)S
(\(nbytes)294 1236 A
1572(==)S
1698(0\))S
(return\(0\);)420 1824 A
2370(/*)S
2496(so)S
(char)168 2622 A
(special)294 2832 A
(files)210 3168 A
(need)168 3420 A
(not)126 3630 A
(check)210 3798 A
(for)126 4050 A
(0*/)126 4218 A
2700 V
(23475)210 648 A
(position)336 1110 A
1488(=)S
(f->filp_pos;)504 1572 A
2790 V
(23476)210 648 A
1110(if)S
(\(position)378 1236 A
1656(>)S
(MAX_FILE_POS\))546 1740 A
(return\(EINVAL\);)630 2328 A
2880 V
(23477)210 648 A
1110(if)S
(\(position)378 1236 A
1656(+)S
(nbytes)252 1740 A
2034(<)S
(position\))378 2118 A
(return\(EINVAL\);)630 2538 A
3210(/*)S
(unsigned)336 3336 A
(overflow)336 3714 A
4092(*/)S
2970 V
(23478)210 648 A
(oflags)252 1110 A
1404(=)S
(f->filp_flags;)588 1488 A
3060 V
(23479)210 648 A
(rip)126 1110 A
1278(=)S
(f->filp_ino;)504 1362 A
3150 V
(23480)210 648 A
(f_size)252 1110 A
1404(=)S
(rip->i_size;)504 1488 A
3240 V
(23481)210 648 A
1110(r)S
1194(=)S
(OK;)126 1278 A
3330 V
(23482)210 648 A
1110(if)S
(\(rip->i_pipe)504 1236 A
1782(==)S
(I_PIPE\))294 1908 A
2244({)S
3420 V
(23483)210 648 A
1362(/*)S
(fp->fp_cum_io_partial)882 1488 A
2412(is)S
(only)168 2538 A
(nonzero)294 2748 A
(when)168 3084 A
(doing)210 3294 A
(partial)294 3546 A
(writes)252 3882 A
4176(*/)S
3510 V
(23484)210 648 A
(cum_io)252 1362 A
1656(=)S
(fp->fp_cum_io_partial;)924 1740 A
3600 V
(23485)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3690 V
(23486)210 648 A
(cum_io)252 1362 A
1656(=)S
1740(0;)S
3780 V
(23487)210 648 A
1110(})S
3870 V
(23488)210 648 A
1110(op)S
1236(=)S
(\(rw_flag)336 1320 A
1698(==)S
(READING)294 1824 A
2160(?)S
(DEV_READ)336 2244 A
2622(:)S
(DEV_WRITE\);)462 2706 A
3960 V
(23489)210 648 A
(mode_word)378 1110 A
1530(=)S
(rip->i_mode)462 1614 A
2118(&)S
(I_TYPE;)294 2202 A
4050 V
(23490)210 648 A
(regular)294 1110 A
1446(=)S
(mode_word)378 1530 A
1950(==)S
(I_REGULAR)378 2076 A
2496(||)S
(mode_word)378 2622 A
3042(==)S
(I_NAMED_PIPE;)546 3168 A
4140 V
(23491)210 648 A
4230 V
(23492)210 648 A
(char_spec)378 1110 A
1530(=)S
(\(mode_word)420 1614 A
2076(==)S
(I_CHAR_SPECIAL)588 2202 A
2832(?)S
2916(1)S
3000(:)S
(0\);)126 3084 A
4320 V
(23493)210 648 A
(block_spec)420 1110 A
1572(=)S
(\(mode_word)420 1656 A
2118(==)S
(I_BLOCK_SPECIAL)630 2244 A
2916(?)S
3000(1)S
3084(:)S
(0\);)126 3168 A
4410 V
(23494)210 648 A
1110(if)S
(\(block_spec\))504 1236 A
(f_size)252 1782 A
2076(=)S
(LONG_MAX;)378 2160 A
4500 V
(23495)210 648 A
(rdwt_err)336 1110 A
1488(=)S
(OK;)126 1572 A
2370(/*)S
(set)126 2496 A
2664(to)S
(EIO)126 2790 A
2958(if)S
(disk)168 3084 A
(error)210 3294 A
(occurs)252 3546 A
3840(*/)S
4590 V
(23496)210 648 A
4680 V
(23497)210 648 A
1110(/*)S
(Check)210 1236 A
(for)126 1488 A
(character)378 1656 A
(special)294 2076 A
(files.)252 2412 A
2706(*/)S
4770 V
(23498)210 648 A
1110(if)S
(\(char_spec\))462 1236 A
1740({)S
4860 V
(23499)210 648 A
(dev)126 1362 A
1530(=)S
(\(dev_t\))294 1614 A
(rip->i_zone[0];)630 1950 A
4950 V
(23500)210 648 A
1362(r)S
1446(=)S
(dev_io\(op,)420 1530 A
(oflags)252 1992 A
2286(&)S
(O_NONBLOCK,)462 2370 A
(dev,)168 2874 A
(position,)378 3084 A
(nbytes,)294 3504 A
(who,buffer\);)504 3840 A
5040 V
(23501)210 648 A
1362(if)S
1488(\(r)S
1614(>=)S
1740(0\))S
1866({)S
5130 V
(23502)210 648 A
(cum_io)252 1698 A
1992(=)S
2076(r;)S
5220 V
(23503)210 648 A
(position)336 1698 A
2076(+=)S
2202(r;)S
5310 V
(23504)210 648 A
1698(r)S
1782(=)S
(OK;)126 1866 A
5400 V
(23505)210 648 A
1362(})S
5490 V
(23506)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5580 V
(23507)210 648 A
1362(if)S
(\(rw_flag)336 1488 A
1866(==)S
(WRITING)294 1992 A
2328(&&)S
(block_spec)420 2454 A
2916(==)S
3042(0\))S
3168({)S
5670 V
(23508)210 648 A
1698(/*)S
(Check)210 1824 A
2076(in)S
(advance)294 2202 A
2538(to)S
(see)126 2664 A
2832(if)S
(file)168 2958 A
(will)168 3168 A
(grow)168 3378 A
(too)126 3588 A
(big.)168 3756 A
3966(*/)S
5760 V
(23509)210 648 A
1698(if)S
(\(position)378 1824 A
2244(>)S
(rip->i_sp->s_max_size)882 2328 A
3252(-)S
(nbytes\))294 3336 A
(return\(EFBIG\);)588 3672 A
5850 V
(23510)210 648 A
5940 V
(23511)210 648 A
1698(/*)S
(Check)210 1824 A
(for)126 2076 A
(O_APPEND)336 2244 A
(flag.)210 2622 A
2874(*/)S
6030 V
(23512)210 648 A
1698(if)S
(\(oflags)294 1824 A
2160(&)S
(O_APPEND\))378 2244 A
(position)336 2664 A
3042(=)S
(f_size;)294 3126 A
6120 V
(23513)210 648 A
6210 V
(23514)210 648 A
1698(/*)S
(Clear)210 1824 A
(the)126 2076 A
(zone)168 2244 A
(containing)420 2454 A
(present)294 2916 A
(EOF)126 3252 A
3420(if)S
(hole)168 3546 A
(about)210 3756 A
8418 V
EP
%%Page: 323 323
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2150(File:)S
2383(src/fs/read.c)S
12 B
(323)180 4248 A
900 V
7 LST
(23515)210 648 A
1740(*)S
1824(to)S
1950(be)S
(created.)336 2076 A
(This)168 2496 A
2706(is)S
(necessary)378 2832 A
(because)294 3252 A
(all)126 3588 A
(unwritten)378 3756 A
990 V
(23516)210 648 A
1740(*)S
(blocks)252 1824 A
(prior)210 2118 A
2370(to)S
(the)126 2496 A
(EOF)126 2664 A
(must)168 2832 A
(read)168 3042 A
3252(as)S
(zeros.)252 3378 A
1080 V
(23517)210 648 A
1740(*/)S
1170 V
(23518)210 648 A
1698(if)S
(\(position)378 1824 A
2244(>)S
(f_size\))294 2328 A
(clear_zone\(rip,)630 2664 A
(f_size,)294 3336 A
(0\);)126 3672 A
1260 V
(23519)210 648 A
1362(})S
1350 V
(23520)210 648 A
1440 V
(23521)210 648 A
1362(/*)S
(Pipes)210 1488 A
(are)126 1740 A
1908(a)S
(little)252 1992 A
(different.)420 2286 A
(Check.)252 2790 A
3084(*/)S
1530 V
(23522)210 648 A
1362(if)S
(\(rip->i_pipe)504 1488 A
2034(==)S
(I_PIPE\))294 2160 A
2496({)S
1620 V
(23523)210 648 A
1656(r)S
1740(=)S
(pipe_check\(rip,rw_flag,oflags,nbytes,position,&partial_cnt\);)2520 1824 A
1710 V
(23524)210 648 A
1656(if)S
1782(\(r)S
1908(<=)S
2034(0\))S
(return\(r\);)420 2160 A
1800 V
(23525)210 648 A
1362(})S
1890 V
(23526)210 648 A
1980 V
(23527)210 648 A
1362(if)S
(\(partial_cnt)504 1488 A
2034(>)S
2118(0\))S
(partial_pipe)504 2244 A
2790(=)S
2874(1;)S
2070 V
(23528)210 648 A
2160 V
(23529)210 648 A
1362(/*)S
(Split)210 1488 A
(the)126 1740 A
(transfer)336 1908 A
(into)168 2286 A
(chunks)252 2496 A
(that)168 2790 A
(don't)210 3000 A
(span)168 3252 A
(two)126 3462 A
(blocks.)294 3630 A
3966(*/)S
2250 V
(23530)210 648 A
(while)210 1362 A
(\(nbytes)294 1614 A
1950(!=)S
2076(0\))S
2202({)S
2340 V
(23531)210 648 A
(off)126 1698 A
1866(=)S
(\(unsigned)378 1950 A
(int\))168 2370 A
(\(position)378 2580 A
3000(%)S
(BLOCK_SIZE\);/*)588 3084 A
(offset)252 3714 A
4008(in)S
(blk*/)210 4134 A
2430 V
(23532)210 648 A
1698(if)S
(\(partial_pipe\))588 1824 A
2454({)S
2580(/*)S
(pipes)210 2706 A
(only)168 2958 A
3168(*/)S
2520 V
(23533)210 648 A
(chunk)210 2034 A
2286(=)S
(MIN\(partial_cnt,)672 2370 A
(BLOCK_SIZE)420 3084 A
3546(-)S
(off\);)210 3630 A
2610 V
(23534)210 648 A
1698(})S
(else)168 1782 A
2700 V
(23535)210 648 A
(chunk)210 2034 A
2286(=)S
(MIN\(nbytes,)462 2370 A
(BLOCK_SIZE)420 2874 A
3336(-)S
(off\);)210 3420 A
2790 V
(23536)210 648 A
1698(if)S
(\(chunk)252 1824 A
2118(<)S
2202(0\))S
(chunk)210 2328 A
2580(=)S
(BLOCK_SIZE)420 2664 A
3126(-)S
(off;)168 3210 A
2880 V
(23537)210 648 A
2970 V
(23538)210 648 A
1698(if)S
(\(rw_flag)336 1824 A
2202(==)S
(READING\))336 2328 A
2706({)S
3060 V
(23539)210 648 A
(bytes_left)420 2034 A
2496(=)S
(f_size)252 2580 A
2874(-)S
(position;)378 2958 A
3150 V
(23540)210 648 A
2034(if)S
(\(position)378 2160 A
2580(>=)S
(f_size\))294 2706 A
(break;)252 3042 A
3378(/*)S
3504(we)S
(are)126 3630 A
(beyond)252 3798 A
(EOF)126 4092 A
4260(*/)S
3240 V
(23541)210 648 A
2034(if)S
(\(chunk)252 2160 A
2454(>)S
(bytes_left\))462 2538 A
(chunk)210 3042 A
3294(=)S
(\(int\))210 3378 A
(bytes_left;)462 3630 A
3330 V
(23542)210 648 A
1698(})S
3420 V
(23543)210 648 A
3510 V
(23544)210 648 A
1698(/*)S
(Read)168 1824 A
2034(or)S
(write)210 2160 A
('chunk')294 2412 A
(bytes.)252 2748 A
3042(*/)S
3600 V
(23545)210 648 A
1698(r)S
1782(=)S
(rw_chunk\(rip,)546 1866 A
(position,)378 2454 A
(off,)168 2874 A
(chunk,)252 3084 A
(\(unsigned\))420 3378 A
(nbytes,)294 3840 A
3690 V
(23546)210 648 A
(rw_flag,)336 2244 A
(buffer,)294 2622 A
(seg,)168 2958 A
(usr\);)210 3168 A
3780 V
(23547)210 648 A
1698(if)S
1824(\(r)S
1950(!=)S
(OK\))126 2076 A
(break;)252 2244 A
2706(/*)S
(EOF)126 2832 A
(reached)294 3000 A
3336(*/)S
3870 V
(23548)210 648 A
1698(if)S
(\(rdwt_err)378 1824 A
2244(<)S
2328(0\))S
(break;)252 2454 A
3960 V
(23549)210 648 A
4050 V
(23550)210 648 A
1698(/*)S
(Update)252 1824 A
(counters)336 2118 A
(and)126 2496 A
(pointers.)378 2664 A
3084(*/)S
4140 V
(23551)210 648 A
(buffer)252 1698 A
1992(+=)S
(chunk;)252 2118 A
2706(/*)S
(user)168 2832 A
(buffer)252 3042 A
(address)294 3336 A
3672(*/)S
4230 V
(23552)210 648 A
(nbytes)252 1698 A
1992(-=)S
(chunk;)252 2118 A
2706(/*)S
(bytes)210 2832 A
(yet)126 3084 A
3252(to)S
3378(be)S
(read)168 3504 A
3714(*/)S
4320 V
(23553)210 648 A
(cum_io)252 1698 A
1992(+=)S
(chunk;)252 2118 A
2706(/*)S
(bytes)210 2832 A
(read)168 3084 A
3294(so)S
(far)126 3420 A
3588(*/)S
4410 V
(23554)210 648 A
(position)336 1698 A
2076(+=)S
(chunk;)252 2202 A
2706(/*)S
(position)336 2832 A
(within)252 3210 A
(the)126 3504 A
(file)168 3672 A
3882(*/)S
4500 V
(23555)210 648 A
4590 V
(23556)210 648 A
1698(if)S
(\(partial_pipe\))588 1824 A
2454({)S
4680 V
(23557)210 648 A
(partial_cnt)462 2034 A
2538(-=)S
(chunk;)252 2664 A
4770 V
(23558)210 648 A
2034(if)S
(\(partial_cnt)504 2160 A
2706(<=)S
2832(0\))S
(break;)252 3000 A
4860 V
(23559)210 648 A
1698(})S
4950 V
(23560)210 648 A
1362(})S
5040 V
(23561)210 648 A
1110(})S
5130 V
(23562)210 648 A
5220 V
(23563)210 648 A
1110(/*)S
1236(On)S
(write,)252 1362 A
(update)252 1656 A
(file)168 1950 A
(size)168 2160 A
(and)126 2370 A
(access)252 2538 A
(time.)210 2832 A
3084(*/)S
5310 V
(23564)210 648 A
1110(if)S
(\(rw_flag)336 1236 A
1614(==)S
(WRITING\))336 1740 A
2118({)S
5400 V
(23565)210 648 A
1362(if)S
(\(regular)336 1488 A
1866(||)S
(mode_word)378 1992 A
2412(==)S
(I_DIRECTORY\))504 2538 A
3084({)S
5490 V
(23566)210 648 A
1698(if)S
(\(position)378 1824 A
2244(>)S
(f_size\))294 2328 A
(rip->i_size)462 2664 A
3168(=)S
(position;)378 3252 A
5580 V
(23567)210 648 A
1362(})S
5670 V
(23568)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5760 V
(23569)210 648 A
1362(if)S
(\(rip->i_pipe)504 1488 A
2034(==)S
(I_PIPE)252 2160 A
2454(&&)S
(position)336 2580 A
2958(>=)S
(rip->i_size\))504 3084 A
3630({)S
5850 V
(23570)210 648 A
1698(/*)S
(Reset)210 1824 A
(pipe)168 2076 A
(pointers.)378 2286 A
2706(*/)S
5940 V
(23571)210 648 A
(rip->i_size)462 1698 A
2202(=)S
2286(0;)S
2706(/*)S
2832(no)S
(data)168 2958 A
(left)168 3168 A
3378(*/)S
6030 V
(23572)210 648 A
(position)336 1698 A
2076(=)S
2160(0;)S
2706(/*)S
(reset)210 2832 A
(reader\(s\))378 3084 A
3504(*/)S
6120 V
(23573)210 648 A
1698(if)S
1824(\()S
(\(wf)126 1908 A
2076(=)S
(find_filp\(rip,)588 2160 A
(W_BIT\)\))294 2790 A
3126(!=)S
(NIL_FILP\))378 3252 A
(wf->filp_pos)504 3672 A
(=0;)126 4218 A
6210 V
(23574)210 648 A
1362(})S
8418 V
EP
%%Page: 324 324
BP
/slant 0 def
/height 0 def
630 V
12 B
(324)180 648 A
11 R
2150(File:)S
2383(src/fs/read.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(23575)210 648 A
1110(})S
990 V
(23576)210 648 A
(f->filp_pos)462 1110 A
1614(=)S
(position;)378 1698 A
1080 V
(23577)210 648 A
1170 V
(23578)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
(read-ahead)420 1908 A
2370(is)S
(called)252 2496 A
(for,)168 2790 A
(and)126 3000 A
3168(if)S
(so,)126 3294 A
(set)126 3462 A
3630(it)S
(up.)126 3756 A
3924(*/)S
1260 V
(23579)210 648 A
1110(if)S
(\(rw_flag)336 1236 A
1614(==)S
(READING)294 1740 A
2076(&&)S
(rip->i_seek)462 2202 A
2706(==)S
(NO_SEEK)294 2832 A
3168(&&)S
(position)336 3294 A
3672(%)S
(BLOCK_SIZE==)504 3756 A
4302(0)S
1350 V
(23580)210 648 A
1698(&&)S
(\(regular)336 1824 A
2202(||)S
(mode_word)378 2328 A
2748(==)S
(I_DIRECTORY\)\))546 2874 A
3462({)S
1440 V
(23581)210 648 A
(rdahed_inode)504 1362 A
1908(=)S
(rip;)168 1992 A
1530 V
(23582)210 648 A
(rdahedpos)378 1362 A
1782(=)S
(position;)378 1866 A
1620 V
(23583)210 648 A
1110(})S
1710 V
(23584)210 648 A
(rip->i_seek)462 1110 A
1614(=)S
(NO_SEEK;)336 1698 A
1800 V
(23585)210 648 A
1890 V
(23586)210 648 A
1110(if)S
(\(rdwt_err)378 1236 A
1656(!=)S
(OK\))126 1782 A
1950(r)S
2034(=)S
(rdwt_err;)378 2118 A
2706(/*)S
(check)210 2832 A
(for)126 3084 A
(disk)168 3252 A
(error)210 3462 A
3714(*/)S
1980 V
(23587)210 648 A
1110(if)S
(\(rdwt_err)378 1236 A
1656(==)S
(END_OF_FILE\))504 1782 A
2328(r)S
2412(=)S
(OK;)126 2496 A
2070 V
(23588)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
2160 V
(23589)210 648 A
1362(if)S
(\(rw_flag)336 1488 A
1866(==)S
(READING\))336 1992 A
(rip->i_update)546 2370 A
2958(|=)S
(ATIME;)252 3084 A
2250 V
(23590)210 648 A
1362(if)S
(\(rw_flag)336 1488 A
1866(==)S
(WRITING\))336 1992 A
(rip->i_update)546 2370 A
2958(|=)S
(CTIME)210 3084 A
3336(|)S
(MTIME;)252 3420 A
2340 V
(23591)210 648 A
(rip->i_dirt)462 1362 A
1866(=)S
(DIRTY;)252 1950 A
2706(/*)S
(inode)210 2832 A
3084(is)S
(thus)168 3210 A
(now)126 3420 A
(dirty)210 3588 A
3840(*/)S
2430 V
(23592)210 648 A
1362(if)S
(\(partial_pipe\))588 1488 A
2118({)S
2520 V
(23593)210 648 A
(partial_pipe)504 1698 A
2244(=)S
2328(0;)S
2610 V
(23594)210 648 A
2034(/*)S
(partial)294 2160 A
(write)210 2496 A
2748(on)S
(pipe)168 2874 A
(with)168 3084 A
3294(*/)S
2700 V
(23595)210 648 A
2034(/*)S
(O_NONBLOCK,)462 2160 A
(return)252 2664 A
(write)210 2958 A
(count)210 3210 A
3462(*/)S
2790 V
(23596)210 648 A
1698(if)S
(\(!\(oflags)378 1824 A
2244(&)S
(O_NONBLOCK\)\))504 2328 A
2874({)S
2880 V
(23597)210 648 A
(fp->fp_cum_io_partial)882 2034 A
2958(=)S
(cum_io;)294 3042 A
2970 V
(23598)210 648 A
(suspend\(XPIPE\);)630 2034 A
2706(/*)S
(partial)294 2832 A
(write)210 3168 A
3420(on)S
(pipe)168 3546 A
(with)168 3756 A
3966(*/)S
3060 V
(23599)210 648 A
(return\(0\);)420 2034 A
2706(/*)S
(nbyte)210 2832 A
3084(>)S
(PIPE_SIZE)378 3168 A
3588(-)S
(non-atomic)420 3672 A
4134(*/)S
3150 V
(23600)210 648 A
1698(})S
3240 V
(23601)210 648 A
1362(})S
3330 V
(23602)210 648 A
(fp->fp_cum_io_partial)882 1362 A
2286(=)S
2370(0;)S
3420 V
(23603)210 648 A
(return\(cum_io\);)630 1362 A
3510 V
(23604)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3600 V
(23605)210 648 A
(return\(r\);)420 1362 A
3690 V
(23606)210 648 A
1110(})S
3780 V
(23607)210 648 A
1026(})S
4050 V
(23610)210 648 A
(/*===========================================================================*)3276 1026 A
4140 V
(23611)210 648 A
1068(*)S
(rw_chunk)336 2370 A
4260(*)S
4230 V
(23612)210 648 A
(*===========================================================================*/)3276 1068 A
4320 V
(23613)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(rw_chunk\(rip,)546 1530 A
(position,)378 2118 A
(off,)168 2538 A
(chunk,)252 2748 A
(left,)210 3042 A
(rw_flag,)336 3294 A
(buff,)210 3672 A
(seg,)168 3924 A
(usr\))168 4134 A
4410 V
(23614)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
(for)126 3210 A
(file)168 3378 A
3588(to)S
3714(be)S
(rd/wr)210 3840 A
4092(*/)S
4500 V
(23615)210 648 A
(off_t)210 1026 A
(position;)378 1278 A
2370(/*)S
(position)336 2496 A
(within)252 2874 A
(file)168 3168 A
3378(to)S
(read)168 3504 A
3714(or)S
(write)210 3840 A
4092(*/)S
4590 V
(23616)210 648 A
(unsigned)336 1026 A
(off;)168 1404 A
2370(/*)S
(off)126 2496 A
(within)252 2664 A
(the)126 2958 A
(current)294 3126 A
(block)210 3462 A
3714(*/)S
4680 V
(23617)210 648 A
(int)126 1026 A
(chunk;)252 1194 A
2370(/*)S
(number)252 2496 A
2790(of)S
(bytes)210 2916 A
3168(to)S
(read)168 3294 A
3504(or)S
(write)210 3630 A
3882(*/)S
4770 V
(23618)210 648 A
(unsigned)336 1026 A
(left;)210 1404 A
2370(/*)S
(max)126 2496 A
(number)252 2664 A
2958(of)S
(bytes)210 3084 A
(wanted)252 3336 A
(after)210 3630 A
(position)336 3882 A
4260(*/)S
4860 V
(23619)210 648 A
(int)126 1026 A
(rw_flag;)336 1194 A
2370(/*)S
(READING)294 2496 A
2832(or)S
(WRITING)294 2958 A
3294(*/)S
4950 V
(23620)210 648 A
(char)168 1026 A
(*buff;)252 1236 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
3168(of)S
(the)126 3294 A
(user)168 3462 A
(buffer)252 3672 A
3966(*/)S
5040 V
(23621)210 648 A
(int)126 1026 A
(seg;)168 1194 A
2370(/*)S
2496(T)S
2580(or)S
2706(D)S
(segment)294 2790 A
3126(in)S
(user)168 3252 A
(space)210 3462 A
3714(*/)S
5130 V
(23622)210 648 A
(int)126 1026 A
(usr;)168 1194 A
2370(/*)S
(which)210 2496 A
(user)168 2748 A
(process)294 2958 A
3294(*/)S
5220 V
(23623)210 648 A
1026({)S
5310 V
(23624)210 648 A
1026(/*)S
(Read)168 1152 A
1362(or)S
(write)210 1488 A
(\(part)210 1740 A
(of\))126 1992 A
2160(a)S
(block.)252 2244 A
2538(*/)S
5400 V
(23625)210 648 A
5490 V
(23626)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp;)168 1950 A
5580 V
(23627)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(r;)S
5670 V
(23628)210 648 A
(int)126 1110 A
1278(n,)S
(block_spec;)462 1404 A
5760 V
(23629)210 648 A
(block_t)294 1110 A
1446(b;)S
5850 V
(23630)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
5940 V
(23631)210 648 A
6030 V
(23632)210 648 A
(block_spec)420 1110 A
1572(=)S
(\(rip->i_mode)504 1656 A
2202(&)S
(I_TYPE\))294 2286 A
2622(==)S
(I_BLOCK_SPECIAL;)672 2748 A
6120 V
(23633)210 648 A
1110(if)S
(\(block_spec\))504 1236 A
1782({)S
6210 V
(23634)210 648 A
1362(b)S
1446(=)S
(position/BLOCK_SIZE;)840 1530 A
8418 V
EP
%%Page: 325 325
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2150(File:)S
2383(src/fs/read.c)S
12 B
(325)180 4248 A
900 V
7 LST
(23635)210 648 A
(dev)126 1362 A
1530(=)S
(\(dev_t\))294 1614 A
(rip->i_zone[0];)630 1950 A
990 V
(23636)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1080 V
(23637)210 648 A
1362(b)S
1446(=)S
(read_map\(rip,)546 1530 A
(position\);)420 2118 A
1170 V
(23638)210 648 A
(dev)126 1362 A
1530(=)S
(rip->i_dev;)462 1614 A
1260 V
(23639)210 648 A
1110(})S
1350 V
(23640)210 648 A
1440 V
(23641)210 648 A
1110(if)S
(\(!block_spec)504 1236 A
1782(&&)S
1908(b)S
1992(==)S
(NO_BLOCK\))378 2118 A
2538({)S
1530 V
(23642)210 648 A
1362(if)S
(\(rw_flag)336 1488 A
1866(==)S
(READING\))336 1992 A
2370({)S
1620 V
(23643)210 648 A
1698(/*)S
(Reading)294 1824 A
(from)168 2160 A
2370(a)S
(nonexistent)462 2454 A
(block.)252 2958 A
(Must)168 3294 A
(read)168 3504 A
3714(as)S
(all)126 3840 A
(zeros.*/)336 4008 A
1710 V
(23644)210 648 A
1698(bp)S
1824(=)S
(get_block\(NO_DEV,)714 1908 A
(NO_BLOCK,)378 2664 A
(NORMAL\);)336 3084 A
3588(/*)S
(get)126 3714 A
3882(a)S
(buffer)252 3966 A
4260(*/)S
1800 V
(23645)210 648 A
(zero_block\(bp\);)630 1698 A
1890 V
(23646)210 648 A
1362(})S
(else)168 1446 A
1656({)S
1980 V
(23647)210 648 A
1698(/*)S
(Writing)294 1824 A
2160(to)S
2286(a)S
(nonexistent)462 2370 A
(block.)252 2874 A
(Create)252 3168 A
(and)126 3462 A
(enter)210 3630 A
3882(in)S
(inode.*/)336 4008 A
2070 V
(23648)210 648 A
1698(if)S
(\(\(bp=)210 1824 A
(new_block\(rip,)588 2076 A
(position\)\))420 2706 A
3168(==)S
(NIL_BUF\)return\(err_code\);)1050 3294 A
2160 V
(23649)210 648 A
1362(})S
2250 V
(23650)210 648 A
1110(})S
(else)168 1194 A
1404(if)S
(\(rw_flag)336 1530 A
1908(==)S
(READING\))336 2034 A
2412({)S
2340 V
(23651)210 648 A
1362(/*)S
(Read)168 1488 A
(and)126 1698 A
(read)168 1866 A
(ahead)210 2076 A
2328(if)S
(convenient.)462 2454 A
2958(*/)S
2430 V
(23652)210 648 A
1362(bp)S
1488(=)S
(rahead\(rip,)462 1572 A
2076(b,)S
(position,)378 2202 A
(left\);)252 2622 A
2520 V
(23653)210 648 A
1110(})S
(else)168 1194 A
1404({)S
2610 V
(23654)210 648 A
1362(/*)S
(Normally)336 1488 A
1866(an)S
(existing)336 1992 A
(block)210 2370 A
2622(to)S
2748(be)S
(partially)378 2874 A
(overwritten)462 3294 A
3798(is)S
(first)210 3924 A
(read)168 4176 A
2700 V
(23655)210 648 A
1404(*)S
(in.)126 1488 A
(However,)336 1698 A
2076(a)S
(full)168 2160 A
(block)210 2370 A
(need)168 2622 A
(not)126 2832 A
3000(be)S
(read)168 3126 A
(in.)126 3336 A
3546(If)S
3672(it)S
3798(is)S
(already)294 3924 A
4260(in)S
2790 V
(23656)210 648 A
1404(*)S
(the)126 1488 A
(cache,)252 1656 A
(acquire)294 1950 A
(it,)126 2286 A
(otherwise)378 2454 A
(just)168 2874 A
(acquire)294 3084 A
3420(a)S
(free)168 3504 A
(buffer.)294 3714 A
2880 V
(23657)210 648 A
1404(*/)S
2970 V
(23658)210 648 A
1362(n)S
1446(=)S
(\(chunk)252 1530 A
1824(==)S
(BLOCK_SIZE)420 1950 A
2412(?)S
(NO_READ)294 2496 A
2832(:)S
(NORMAL\);)336 2916 A
3060 V
(23659)210 648 A
1362(if)S
(\(!block_spec)504 1488 A
2034(&&)S
(off)126 2160 A
2328(==)S
2454(0)S
2538(&&)S
(position)336 2664 A
3042(>=)S
(rip->i_size\))504 3168 A
3714(n)S
3798(=)S
(NO_READ;)336 3882 A
3150 V
(23660)210 648 A
1362(bp)S
1488(=)S
(get_block\(dev,)588 1572 A
2202(b,)S
(n\);)126 2328 A
3240 V
(23661)210 648 A
1110(})S
3330 V
(23662)210 648 A
3420 V
(23663)210 648 A
1110(/*)S
1236(In)S
(all)126 1362 A
(cases,)252 1530 A
1824(bp)S
(now)126 1950 A
(points)252 2118 A
2412(to)S
2538(a)S
(valid)210 2622 A
(buffer.)294 2874 A
3210(*/)S
3510 V
(23664)210 648 A
1110(if)S
(\(rw_flag)336 1236 A
1614(==)S
(WRITING)294 1740 A
2076(&&)S
(chunk)210 2202 A
2454(!=)S
(BLOCK_SIZE)420 2580 A
3042(&&)S
(!block_spec)462 3168 A
3672(&&)S
3600 V
(23665)210 648 A
(position)336 2706 A
3084(>=)S
(rip->i_size)462 3210 A
3714(&&)S
(off)126 3840 A
4008(==)S
4134(0\))S
4260({)S
3690 V
(23666)210 648 A
(zero_block\(bp\);)630 1362 A
3780 V
(23667)210 648 A
1110(})S
3870 V
(23668)210 648 A
1110(if)S
(\(rw_flag)336 1236 A
1614(==)S
(READING\))336 1740 A
2118({)S
3960 V
(23669)210 648 A
1362(/*)S
(Copy)168 1488 A
1698(a)S
(chunk)210 1782 A
(from)168 2034 A
(the)126 2244 A
(block)210 2412 A
(buffer)252 2664 A
2958(to)S
(user)168 3084 A
(space.)252 3294 A
3588(*/)S
4050 V
(23670)210 648 A
1362(r)S
1446(=)S
(sys_copy\(FS_PROC_NR,)840 1530 A
2412(D,)S
(\(phys_bytes\))504 2538 A
(\(bp->b_data+off\),)714 3084 A
4140 V
(23671)210 648 A
(usr,)168 2034 A
(seg,)168 2244 A
(\(phys_bytes\))504 2454 A
(buff,)210 3000 A
4230 V
(23672)210 648 A
(\(phys_bytes\))504 2034 A
(chunk\);)294 2580 A
4320 V
(23673)210 648 A
1110(})S
(else)168 1194 A
1404({)S
4410 V
(23674)210 648 A
1362(/*)S
(Copy)168 1488 A
1698(a)S
(chunk)210 1782 A
(from)168 2034 A
(user)168 2244 A
(space)210 2454 A
2706(to)S
(the)126 2832 A
(block)210 3000 A
(buffer.)294 3252 A
3588(*/)S
4500 V
(23675)210 648 A
1362(r)S
1446(=)S
(sys_copy\(usr,)546 1530 A
(seg,)168 2118 A
(\(phys_bytes\))504 2328 A
(buff,)210 2874 A
4590 V
(23676)210 648 A
(FS_PROC_NR,)462 2034 A
2538(D,)S
(\(phys_bytes\))504 2664 A
(\(bp->b_data+off\),)714 3210 A
4680 V
(23677)210 648 A
(\(phys_bytes\))504 2034 A
(chunk\);)294 2580 A
4770 V
(23678)210 648 A
(bp->b_dirt)420 1362 A
1824(=)S
(DIRTY;)252 1908 A
4860 V
(23679)210 648 A
1110(})S
4950 V
(23680)210 648 A
1110(n)S
1194(=)S
(\(off)168 1278 A
1488(+)S
(chunk)210 1572 A
1824(==)S
(BLOCK_SIZE)420 1950 A
2412(?)S
(FULL_DATA_BLOCK)630 2496 A
3168(:)S
(PARTIAL_DATA_BLOCK\);)840 3252 A
5040 V
(23681)210 648 A
(put_block\(bp,)546 1110 A
(n\);)126 1698 A
5130 V
(23682)210 648 A
(return\(r\);)420 1110 A
5220 V
(23683)210 648 A
1026(})S
5490 V
(23686)210 648 A
(/*===========================================================================*)3276 1026 A
5580 V
(23687)210 648 A
1068(*)S
(read_map)336 2370 A
4260(*)S
5670 V
(23688)210 648 A
(*===========================================================================*/)3276 1068 A
5760 V
(23689)210 648 A
(PUBLIC)252 1026 A
(block_t)294 1320 A
(read_map\(rip,)546 1656 A
(position\))378 2244 A
5850 V
(23690)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(ptr)126 2496 A
2664(to)S
(inode)210 2790 A
3042(to)S
(map)126 3168 A
(from)168 3336 A
3546(*/)S
5940 V
(23691)210 648 A
(off_t)210 1026 A
(position;)378 1278 A
2370(/*)S
(position)336 2496 A
2874(in)S
(file)168 3000 A
(whose)210 3210 A
(blk)126 3462 A
(wanted)252 3630 A
3924(*/)S
6030 V
(23692)210 648 A
1026({)S
6120 V
(23693)210 648 A
1026(/*)S
(Given)210 1152 A
1404(an)S
(inode)210 1530 A
(and)126 1782 A
1950(a)S
(position)336 2034 A
(within)252 2412 A
(the)126 2706 A
(corresponding)546 2874 A
(file,)210 3462 A
(locate)252 3714 A
(the)126 4008 A
6210 V
(23694)210 648 A
1068(*)S
(block)210 1152 A
(\(not)168 1404 A
(zone\))210 1614 A
(number)252 1866 A
2160(in)S
(which)210 2286 A
(that)168 2538 A
(position)336 2748 A
3126(is)S
3252(to)S
3378(be)S
(found)210 3504 A
(and)126 3756 A
(return)252 3924 A
(it.)126 4218 A
8418 V
EP
%%Page: 326 326
BP
/slant 0 def
/height 0 def
630 V
12 B
(326)180 648 A
11 R
2150(File:)S
2383(src/fs/read.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(23695)210 648 A
1068(*/)S
990 V
(23696)210 648 A
1080 V
(23697)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp;)168 1950 A
1170 V
(23698)210 648 A
(register)336 1110 A
(zone_t)252 1488 A
1782(z;)S
1260 V
(23699)210 648 A
(int)126 1110 A
(scale,)252 1278 A
(boff,)210 1572 A
(dzones,)294 1824 A
(nr_indirects,)546 2160 A
(index,)252 2748 A
(zind,)210 3042 A
(ex;)126 3294 A
1350 V
(23700)210 648 A
(block_t)294 1110 A
1446(b;)S
1440 V
(23701)210 648 A
(long)168 1110 A
(excess,)294 1320 A
(zone,)210 1656 A
(block_pos;)420 1908 A
1530 V
(23702)210 648 A
1620 V
(23703)210 648 A
(scale)210 1110 A
1362(=)S
(rip->i_sp->s_log_zone_size;)1134 1446 A
2706(/*)S
(for)126 2832 A
(block-zone)420 3000 A
(conversion)420 3462 A
3924(*/)S
1710 V
(23704)210 648 A
(block_pos)378 1110 A
1530(=)S
(position/BLOCK_SIZE;)840 1614 A
2706(/*)S
(relative)336 2832 A
(blk)126 3210 A
3378(#)S
3462(in)S
(file)168 3588 A
3798(*/)S
1800 V
(23705)210 648 A
(zone)168 1110 A
1320(=)S
(block_pos)378 1404 A
1824(>>)S
(scale;)252 1950 A
2370(/*)S
(position's)420 2496 A
(zone)168 2958 A
3168(*/)S
1890 V
(23706)210 648 A
(boff)168 1110 A
1320(=)S
(\(int\))210 1404 A
(\(block_pos)420 1656 A
2118(-)S
(\(zone)210 2202 A
2454(<<)S
(scale\))252 2580 A
2874(\);)S
3000(/*)S
(relative)336 3126 A
(blk)126 3504 A
3672(#)S
(within)252 3756 A
(zone)168 4050 A
4260(*/)S
1980 V
(23707)210 648 A
(dzones)252 1110 A
1404(=)S
(rip->i_ndzones;)630 1488 A
2070 V
(23708)210 648 A
(nr_indirects)504 1110 A
1656(=)S
(rip->i_nindirs;)630 1740 A
2160 V
(23709)210 648 A
2250 V
(23710)210 648 A
1110(/*)S
1236(Is)S
('position')420 1362 A
1824(to)S
1950(be)S
(found)210 2076 A
2328(in)S
(the)126 2454 A
(inode)210 2622 A
(itself?)294 2874 A
3210(*/)S
2340 V
(23711)210 648 A
1110(if)S
(\(zone)210 1236 A
1488(<)S
(dzones\))294 1572 A
1908({)S
2430 V
(23712)210 648 A
(zind)168 1362 A
1572(=)S
(\(int\))210 1656 A
(zone;)210 1908 A
2370(/*)S
(index)210 2496 A
(should)252 2748 A
3042(be)S
3168(an)S
(int)126 3294 A
3462(*/)S
2520 V
(23713)210 648 A
1362(z)S
1446(=)S
(rip->i_zone[zind];)756 1530 A
2610 V
(23714)210 648 A
1362(if)S
1488(\(z)S
1614(==)S
(NO_ZONE\))336 1740 A
(return\(NO_BLOCK\);)714 2118 A
2700 V
(23715)210 648 A
1362(b)S
1446(=)S
(\(\(block_t\))420 1530 A
1992(z)S
2076(<<)S
(scale\))252 2202 A
2496(+)S
(boff;)210 2580 A
2790 V
(23716)210 648 A
(return\(b\);)420 1362 A
2880 V
(23717)210 648 A
1110(})S
2970 V
(23718)210 648 A
3060 V
(23719)210 648 A
1110(/*)S
1236(It)S
1362(is)S
(not)126 1488 A
1656(in)S
(the)126 1782 A
(inode,)252 1950 A
2244(so)S
2370(it)S
(must)168 2496 A
2706(be)S
(single)252 2832 A
3126(or)S
(double)252 3252 A
(indirect.)378 3546 A
3966(*/)S
3150 V
(23720)210 648 A
(excess)252 1110 A
1404(=)S
(zone)168 1488 A
1698(-)S
(dzones;)294 1782 A
2370(/*)S
(first)210 2496 A
(Vx_NR_DZONES)504 2748 A
(don't)210 3294 A
(count)210 3546 A
3798(*/)S
3240 V
(23721)210 648 A
3330 V
(23722)210 648 A
1110(if)S
(\(excess)294 1236 A
1572(<)S
(nr_indirects\))546 1656 A
2244({)S
3420 V
(23723)210 648 A
1362(/*)S
('position')420 1488 A
(can)126 1950 A
2118(be)S
(located)294 2244 A
(via)126 2580 A
(the)126 2748 A
(single)252 2916 A
(indirect)336 3210 A
(block.)252 3588 A
3882(*/)S
3510 V
(23724)210 648 A
1362(z)S
1446(=)S
(rip->i_zone[dzones];)840 1530 A
3600 V
(23725)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3690 V
(23726)210 648 A
1362(/*)S
('position')420 1488 A
(can)126 1950 A
2118(be)S
(located)294 2244 A
(via)126 2580 A
(the)126 2748 A
(double)252 2916 A
(indirect)336 3210 A
(block.)252 3588 A
3882(*/)S
3780 V
(23727)210 648 A
1362(if)S
1488(\()S
1572(\(z)S
1698(=)S
(rip->i_zone[dzones+1]\))924 1782 A
2748(==)S
(NO_ZONE\))336 2874 A
(return\(NO_BLOCK\);)714 3252 A
3870 V
(23728)210 648 A
(excess)252 1362 A
1656(-=)S
(nr_indirects;)546 1782 A
3042(/*)S
(single)252 3168 A
(indir)210 3462 A
(doesn't)294 3714 A
(count*/)294 4050 A
3960 V
(23729)210 648 A
1362(b)S
1446(=)S
(\(block_t\))378 1530 A
1950(z)S
2034(<<)S
(scale;)252 2160 A
4050 V
(23730)210 648 A
1362(bp)S
1488(=)S
(get_block\(rip->i_dev,)882 1572 A
2496(b,)S
(NORMAL\);)336 2622 A
3042(/*)S
(get)126 3168 A
(double)252 3336 A
(indirect)336 3630 A
(block)210 4008 A
4260(*/)S
4140 V
(23731)210 648 A
(index)210 1362 A
1614(=)S
(\(int\))210 1698 A
(\(excess/nr_indirects\);)924 1950 A
4230 V
(23732)210 648 A
1362(z)S
1446(=)S
(rd_indir\(bp,)504 1530 A
(index\);)294 2076 A
3042(/*)S
3168(z=)S
(zone)168 3294 A
(for)126 3504 A
(single*/)336 3672 A
4320 V
(23733)210 648 A
(put_block\(bp,)546 1362 A
(INDIRECT_BLOCK\);)672 1950 A
3042(/*)S
(release)294 3168 A
(double)252 3504 A
(ind)126 3798 A
(block)210 3966 A
4218(*/)S
4410 V
(23734)210 648 A
(excess)252 1362 A
1656(=)S
(excess)252 1740 A
2034(%)S
(nr_indirects;)546 2118 A
3042(/*)S
(index)210 3168 A
(into)168 3420 A
(single)252 3630 A
(ind)126 3924 A
(blk)126 4092 A
4260(*/)S
4500 V
(23735)210 648 A
1110(})S
4590 V
(23736)210 648 A
4680 V
(23737)210 648 A
1110(/*)S
('z')126 1236 A
1404(is)S
(zone)168 1530 A
(num)126 1740 A
(for)126 1908 A
(single)252 2076 A
(indirect)336 2370 A
(block;)252 2748 A
('excess')336 3042 A
3420(is)S
(index)210 3546 A
(into)168 3798 A
(it.)126 4008 A
4176(*/)S
4770 V
(23738)210 648 A
1110(if)S
1236(\(z)S
1362(==)S
(NO_ZONE\))336 1488 A
(return\(NO_BLOCK\);)714 1866 A
4860 V
(23739)210 648 A
1110(b)S
1194(=)S
(\(block_t\))378 1278 A
1698(z)S
1782(<<)S
(scale;)252 1908 A
3042(/*)S
3168(b)S
3252(is)S
(blk)126 3378 A
3546(#)S
(for)126 3630 A
(single)252 3798 A
(ind)126 4092 A
4260(*/)S
4950 V
(23740)210 648 A
1110(bp)S
1236(=)S
(get_block\(rip->i_dev,)882 1320 A
2244(b,)S
(NORMAL\);)336 2370 A
3042(/*)S
(get)126 3168 A
(single)252 3336 A
(indirect)336 3630 A
(block)210 4008 A
4260(*/)S
5040 V
(23741)210 648 A
1110(ex)S
1236(=)S
(\(int\))210 1320 A
(excess;)294 1572 A
3042(/*)S
(need)168 3168 A
3378(an)S
(integer)294 3504 A
3840(*/)S
5130 V
(23742)210 648 A
1110(z)S
1194(=)S
(rd_indir\(bp,)504 1278 A
(ex\);)168 1824 A
3042(/*)S
(get)126 3168 A
(block)210 3336 A
(pointed)294 3588 A
3924(to)S
4050(*/)S
5220 V
(23743)210 648 A
(put_block\(bp,)546 1110 A
(INDIRECT_BLOCK\);)672 1698 A
3042(/*)S
(release)294 3168 A
(single)252 3504 A
(indir)210 3798 A
(blk)126 4050 A
4218(*/)S
5310 V
(23744)210 648 A
1110(if)S
1236(\(z)S
1362(==)S
(NO_ZONE\))336 1488 A
(return\(NO_BLOCK\);)714 1866 A
5400 V
(23745)210 648 A
1110(b)S
1194(=)S
(\(\(block_t\))420 1278 A
1740(z)S
1824(<<)S
(scale\))252 1950 A
2244(+)S
(boff;)210 2328 A
5490 V
(23746)210 648 A
(return\(b\);)420 1110 A
5580 V
(23747)210 648 A
1026(})S
5850 V
(23750)210 648 A
(/*===========================================================================*)3276 1026 A
5940 V
(23751)210 648 A
1068(*)S
(rd_indir)336 2370 A
4260(*)S
6030 V
(23752)210 648 A
(*===========================================================================*/)3276 1068 A
6120 V
(23753)210 648 A
(PUBLIC)252 1026 A
(zone_t)252 1320 A
(rd_indir\(bp,)504 1614 A
(index\))252 2160 A
6210 V
(23754)210 648 A
(struct)252 1026 A
(buf)126 1320 A
(*bp;)168 1488 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(indirect)336 2958 A
(block)210 3336 A
3588(*/)S
8418 V
EP
%%Page: 327 327
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2150(File:)S
2383(src/fs/read.c)S
12 B
(327)180 4248 A
900 V
7 LST
(23755)210 648 A
(int)126 1026 A
(index;)252 1194 A
2370(/*)S
(index)210 2496 A
(into)168 2748 A
(*bp)126 2958 A
3126(*/)S
990 V
(23756)210 648 A
1026({)S
1080 V
(23757)210 648 A
1026(/*)S
(Given)210 1152 A
1404(a)S
(pointer)294 1488 A
1824(to)S
1950(an)S
(indirect)336 2076 A
(block,)252 2454 A
(read)168 2748 A
(one)126 2958 A
(entry.)252 3126 A
(The)126 3462 A
(reason)252 3630 A
(for)126 3924 A
1170 V
(23758)210 648 A
1068(*)S
(making)252 1152 A
1446(a)S
(separate)336 1530 A
(routine)294 1908 A
(out)126 2244 A
2412(of)S
(this)168 2538 A
2748(is)S
(that)168 2874 A
(there)210 3084 A
(are)126 3336 A
(four)168 3504 A
(cases:)252 3714 A
1260 V
(23759)210 648 A
1068(*)S
1152(V1)S
(\(IBM)168 1278 A
(and)126 1488 A
(68000\),)294 1656 A
(and)126 1992 A
2160(V2)S
(\(IBM)168 2286 A
(and)126 2496 A
(68000\).)294 2664 A
1350 V
(23760)210 648 A
1068(*/)S
1440 V
(23761)210 648 A
1530 V
(23762)210 648 A
(struct)252 1110 A
(super_block)462 1404 A
(*sp;)168 1908 A
1620 V
(23763)210 648 A
(zone_t)252 1110 A
(zone;)210 1404 A
2370(/*)S
2496(V2)S
(zones)210 2622 A
(are)126 2874 A
(longs)210 3042 A
(\(shorts)294 3294 A
3630(in)S
(V1\))126 3756 A
3924(*/)S
1710 V
(23764)210 648 A
1800 V
(23765)210 648 A
1110(sp)S
1236(=)S
(get_super\(bp->b_dev\);)882 1320 A
2370(/*)S
(need)168 2496 A
(super)210 2706 A
(block)210 2958 A
3210(to)S
(find)168 3336 A
(file)168 3546 A
(sys)126 3756 A
(type)168 3924 A
4134(*/)S
1890 V
(23766)210 648 A
1980 V
(23767)210 648 A
1110(/*)S
(read)168 1236 A
1446(a)S
(zone)168 1530 A
(from)168 1740 A
1950(an)S
(indirect)336 2076 A
(block)210 2454 A
2706(*/)S
2070 V
(23768)210 648 A
1110(if)S
(\(sp->s_version)588 1236 A
1866(==)S
(V1\))126 1992 A
2160 V
(23769)210 648 A
(zone)168 1362 A
1572(=)S
(\(zone_t\))336 1656 A
(conv2\(sp->s_native,)798 2034 A
(\(int\))210 2874 A
(bp->b_v1_ind[index]\);)882 3168 A
2250 V
(23770)210 648 A
(else)168 1110 A
2340 V
(23771)210 648 A
(zone)168 1362 A
1572(=)S
(\(zone_t\))336 1656 A
(conv4\(sp->s_native,)798 2034 A
(\(long\))252 2874 A
(bp->b_v2_ind[index]\);)882 3168 A
2430 V
(23772)210 648 A
2520 V
(23773)210 648 A
1110(if)S
(\(zone)210 1236 A
1488(!=)S
(NO_ZONE)294 1614 A
1950(&&)S
2610 V
(23774)210 648 A
(\(zone)210 1698 A
1950(<)S
(\(zone_t\))336 2034 A
(sp->s_firstdatazone)798 2412 A
3252(||)S
(zone)168 3378 A
3588(>=)S
(sp->s_zones\)\))546 3714 A
4302({)S
2700 V
(23775)210 648 A
(printf\("Illegal)630 1362 A
(zone)168 2034 A
(number)252 2244 A
(%ld)126 2538 A
2706(in)S
(indirect)336 2832 A
(block,)252 3210 A
(index)210 3504 A
(%d\\n",)252 3756 A
2790 V
(23776)210 648 A
(\(long\))252 1656 A
(zone,)210 1950 A
(index\);)294 2202 A
2880 V
(23777)210 648 A
(panic\("check)504 1362 A
(file)168 1908 A
(system",)336 2118 A
(NO_NUM\);)336 2496 A
2970 V
(23778)210 648 A
1110(})S
3060 V
(23779)210 648 A
(return\(zone\);)546 1110 A
3150 V
(23780)210 648 A
1026(})S
3420 V
(23783)210 648 A
(/*===========================================================================*)3276 1026 A
3510 V
(23784)210 648 A
1068(*)S
(read_ahead)420 2370 A
4260(*)S
3600 V
(23785)210 648 A
(*===========================================================================*/)3276 1068 A
3690 V
(23786)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(read_ahead\(\))504 1530 A
3780 V
(23787)210 648 A
1026({)S
3870 V
(23788)210 648 A
1026(/*)S
(Read)168 1152 A
1362(a)S
(block)210 1446 A
(into)168 1698 A
(the)126 1908 A
(cache)210 2076 A
(before)252 2328 A
2622(it)S
2748(is)S
(needed.)294 2874 A
3210(*/)S
3960 V
(23789)210 648 A
4050 V
(23790)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
4140 V
(23791)210 648 A
(struct)252 1110 A
(buf)126 1404 A
(*bp;)168 1572 A
4230 V
(23792)210 648 A
(block_t)294 1110 A
1446(b;)S
4320 V
(23793)210 648 A
4410 V
(23794)210 648 A
(rip)126 1110 A
1278(=)S
(rdahed_inode;)546 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
3210(to)S
(read)168 3336 A
(ahead)210 3546 A
(from)168 3798 A
4008(*/)S
4500 V
(23795)210 648 A
(rdahed_inode)504 1110 A
1656(=)S
(NIL_INODE;)420 1740 A
2370(/*)S
(turn)168 2496 A
(off)126 2706 A
(read)168 2874 A
(ahead)210 3084 A
3336(*/)S
4590 V
(23796)210 648 A
1110(if)S
1236(\()S
1320(\(b)S
1446(=)S
(read_map\(rip,)546 1530 A
(rdahedpos\)\))462 2118 A
2622(==)S
(NO_BLOCK\))378 2748 A
(return;)294 3168 A
3714(/*)S
3840(at)S
(EOF)126 3966 A
4134(*/)S
4680 V
(23797)210 648 A
1110(bp)S
1236(=)S
(rahead\(rip,)462 1320 A
1824(b,)S
(rdahedpos,)420 1950 A
(BLOCK_SIZE\);)504 2412 A
4770 V
(23798)210 648 A
(put_block\(bp,)546 1110 A
(PARTIAL_DATA_BLOCK\);)840 1698 A
4860 V
(23799)210 648 A
1026(})S
5130 V
(23802)210 648 A
(/*===========================================================================*)3276 1026 A
5220 V
(23803)210 648 A
1068(*)S
(rahead)252 2370 A
4260(*)S
5310 V
(23804)210 648 A
(*===========================================================================*/)3276 1068 A
5400 V
(23805)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(buf)126 1614 A
(*rahead\(rip,)504 1782 A
(baseblock,)420 2328 A
(position,)378 2790 A
(bytes_ahead\))504 3210 A
5490 V
(23806)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
(for)126 3210 A
(file)168 3378 A
3588(to)S
3714(be)S
(read)168 3840 A
4050(*/)S
5580 V
(23807)210 648 A
(block_t)294 1026 A
(baseblock;)420 1362 A
2370(/*)S
(block)210 2496 A
2748(at)S
(current)294 2874 A
(position)336 3210 A
3588(*/)S
5670 V
(23808)210 648 A
(off_t)210 1026 A
(position;)378 1278 A
2370(/*)S
(position)336 2496 A
(within)252 2874 A
(file)168 3168 A
3378(*/)S
5760 V
(23809)210 648 A
(unsigned)336 1026 A
(bytes_ahead;)504 1404 A
2370(/*)S
(bytes)210 2496 A
(beyond)252 2748 A
(position)336 3042 A
(for)126 3420 A
(immediate)378 3588 A
(use)126 4008 A
4176(*/)S
5850 V
(23810)210 648 A
1026({)S
5940 V
(23811)210 648 A
1026(/*)S
(Fetch)210 1152 A
1404(a)S
(block)210 1488 A
(from)168 1740 A
(the)126 1950 A
(cache)210 2118 A
2370(or)S
(the)126 2496 A
(device.)294 2664 A
3042(If)S
3168(a)S
(physical)336 3252 A
(read)168 3630 A
3840(is)S
6030 V
(23812)210 648 A
1068(*)S
(required,)378 1152 A
(prefetch)336 1572 A
1950(as)S
(many)168 2076 A
(more)168 2286 A
(blocks)252 2496 A
2790(as)S
(convenient)420 2916 A
(into)168 3378 A
(the)126 3588 A
(cache.)252 3756 A
6120 V
(23813)210 648 A
1068(*)S
(This)168 1152 A
(usually)294 1362 A
(covers)252 1698 A
(bytes_ahead)462 1992 A
(and)126 2496 A
2664(is)S
2790(at)S
(least)210 2916 A
(BLOCKS_MINIMUM.)630 3168 A
6210 V
(23814)210 648 A
1068(*)S
(The)126 1152 A
(device)252 1320 A
(driver)252 1614 A
(may)126 1908 A
(decide)252 2076 A
2370(it)S
(knows)210 2496 A
(better)252 2748 A
(and)126 3042 A
(stop)168 3210 A
(reading)294 3420 A
3756(at)S
3882(a)S
8418 V
EP
%%Page: 328 328
BP
/slant 0 def
/height 0 def
630 V
12 B
(328)180 648 A
11 R
2150(File:)S
2383(src/fs/read.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(23815)210 648 A
1068(*)S
(cylinder)336 1152 A
(boundary)336 1530 A
(\(or)126 1908 A
(after)210 2076 A
2328(an)S
(error\).)294 2454 A
(Rw_scattered\(\))588 2832 A
(puts)168 3462 A
3672(an)S
(optional)336 3798 A
990 V
(23816)210 648 A
1068(*)S
(flag)168 1152 A
1362(on)S
(all)126 1488 A
(reads)210 1656 A
1908(to)S
(allow)210 2034 A
(this.)210 2286 A
1080 V
(23817)210 648 A
1068(*/)S
1170 V
(23818)210 648 A
1260 V
(23819)210 648 A
1026(/*)S
(Minimum)294 1152 A
(number)252 1488 A
1782(of)S
(blocks)252 1908 A
2202(to)S
(prefetch.)378 2328 A
2748(*/)S
1350 V
(23820)210 648 A
1026(#)S
(define)252 1110 A
(BLOCKS_MINIMUM)588 1404 A
(\(NR_BUFS)336 2370 A
2748(<)S
2832(50)S
2958(?)S
3042(18)S
3168(:)S
(32\))126 3252 A
1440 V
(23821)210 648 A
1530 V
(23822)210 648 A
(int)126 1110 A
(block_spec,)462 1278 A
(scale,)252 1782 A
(read_q_size;)504 2076 A
1620 V
(23823)210 648 A
(unsigned)336 1110 A
(int)126 1488 A
(blocks_ahead,)546 1656 A
(fragment;)378 2244 A
1710 V
(23824)210 648 A
(block_t)294 1110 A
(block,)252 1446 A
(blocks_left;)504 1740 A
1800 V
(23825)210 648 A
(off_t)210 1110 A
(ind1_pos;)378 1362 A
1890 V
(23826)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
1980 V
(23827)210 648 A
(struct)252 1110 A
(buf)126 1404 A
(*bp;)168 1572 A
2070 V
(23828)210 648 A
(static)252 1110 A
(struct)252 1404 A
(buf)126 1698 A
(*read_q[NR_BUFS];)714 1866 A
2160 V
(23829)210 648 A
2250 V
(23830)210 648 A
(block_spec)420 1110 A
1572(=)S
(\(rip->i_mode)504 1656 A
2202(&)S
(I_TYPE\))294 2286 A
2622(==)S
(I_BLOCK_SPECIAL;)672 2748 A
2340 V
(23831)210 648 A
1110(if)S
(\(block_spec\))504 1236 A
1782({)S
2430 V
(23832)210 648 A
(dev)126 1362 A
1530(=)S
(\(dev_t\))294 1614 A
(rip->i_zone[0];)630 1950 A
2520 V
(23833)210 648 A
1110(})S
(else)168 1194 A
1404({)S
2610 V
(23834)210 648 A
(dev)126 1362 A
1530(=)S
(rip->i_dev;)462 1614 A
2700 V
(23835)210 648 A
1110(})S
2790 V
(23836)210 648 A
2880 V
(23837)210 648 A
(block)210 1110 A
1362(=)S
(baseblock;)420 1446 A
2970 V
(23838)210 648 A
1110(bp)S
1236(=)S
(get_block\(dev,)588 1320 A
(block,)252 1950 A
(PREFETCH\);)420 2244 A
3060 V
(23839)210 648 A
1110(if)S
(\(bp->b_dev)420 1236 A
1698(!=)S
(NO_DEV\))294 1824 A
(return\(bp\);)462 2160 A
3150 V
(23840)210 648 A
3240 V
(23841)210 648 A
1110(/*)S
(The)126 1236 A
(best)168 1404 A
(guess)210 1614 A
(for)126 1866 A
(the)126 2034 A
(number)252 2202 A
2496(of)S
(blocks)252 2622 A
2916(to)S
(prefetch:)378 3042 A
3504(A)S
(lot.)168 3588 A
3330 V
(23842)210 648 A
1152(*)S
1236(It)S
1362(is)S
(impossible)420 1488 A
1950(to)S
(tell)168 2076 A
(what)168 2286 A
(the)126 2496 A
(device)252 2664 A
(looks)210 2958 A
(like,)210 3210 A
3462(so)S
3588(we)S
(don't)210 3714 A
(even)168 3966 A
3420 V
(23843)210 648 A
1152(*)S
(try)126 1236 A
1404(to)S
(guess)210 1530 A
(the)126 1782 A
(geometry,)378 1950 A
(but)126 2370 A
(leave)210 2538 A
2790(it)S
2916(to)S
(the)126 3042 A
(driver.)294 3210 A
3510 V
(23844)210 648 A
1152(*)S
3600 V
(23845)210 648 A
1152(*)S
(The)126 1236 A
(floppy)252 1404 A
(driver)252 1698 A
(can)126 1992 A
(read)168 2160 A
2370(a)S
(full)168 2454 A
(track)210 2664 A
(with)168 2916 A
3126(no)S
(rotational)420 3252 A
(delay,)252 3714 A
(and)126 4008 A
4176(it)S
3690 V
(23846)210 648 A
1152(*)S
(avoids)252 1236 A
(reading)294 1530 A
(partial)294 1866 A
(tracks)252 2202 A
2496(if)S
2622(it)S
(can,)168 2748 A
2958(so)S
(handing)294 3084 A
3420(it)S
(enough)252 3546 A
(buffers)294 3840 A
4176(to)S
3780 V
(23847)210 648 A
1152(*)S
(read)168 1236 A
(two)126 1446 A
(tracks)252 1614 A
1908(is)S
(perfect.)336 2034 A
(\(Two,)210 2454 A
(because)294 2706 A
(some)168 3042 A
(diskette)336 3252 A
(types)210 3630 A
(have)168 3882 A
3870 V
(23848)210 648 A
1152(*)S
1236(an)S
(odd)126 1362 A
(number)252 1530 A
1824(of)S
(sectors)294 1950 A
(per)126 2286 A
(track,)252 2454 A
2748(so)S
2874(a)S
(block)210 2958 A
(may)126 3210 A
(span)168 3378 A
(tracks.\))336 3588 A
3960 V
(23849)210 648 A
1152(*)S
4050 V
(23850)210 648 A
1152(*)S
(The)126 1236 A
(disk)168 1404 A
(drivers)294 1614 A
(don't)210 1950 A
(try)126 2202 A
2370(to)S
2496(be)S
(smart.)252 2622 A
(With)168 2958 A
(todays)252 3168 A
(disks)210 3462 A
3714(it)S
3840(is)S
4140 V
(23851)210 648 A
1152(*)S
(impossible)420 1236 A
1698(to)S
(tell)168 1824 A
(what)168 2034 A
(the)126 2244 A
(real)168 2412 A
(geometry)336 2622 A
(looks)210 3000 A
(like,)210 3252 A
3504(so)S
3630(it)S
3756(is)S
(best)168 3882 A
4092(to)S
4230 V
(23852)210 648 A
1152(*)S
(read)168 1236 A
1446(as)S
(much)168 1572 A
1782(as)S
(you)126 1908 A
(can.)168 2076 A
(With)168 2328 A
(luck)168 2538 A
(the)126 2748 A
(caching)294 2916 A
3252(on)S
(the)126 3378 A
(drive)210 3546 A
(allows)252 3798 A
4320 V
(23853)210 648 A
1152(*)S
(for)126 1236 A
1404(a)S
(little)252 1488 A
(time)168 1782 A
1992(to)S
(start)210 2118 A
(the)126 2370 A
(next)168 2538 A
(read.)210 2748 A
4410 V
(23854)210 648 A
1152(*)S
4500 V
(23855)210 648 A
1152(*)S
(The)126 1236 A
(current)294 1404 A
(solution)336 1740 A
(below)210 2118 A
2370(is)S
2496(a)S
(bit)126 2580 A
2748(of)S
2874(a)S
(hack,)210 2958 A
3210(it)S
(just)168 3336 A
(reads)210 3546 A
(blocks)252 3798 A
(from)168 4092 A
4590 V
(23856)210 648 A
1152(*)S
(the)126 1236 A
(current)294 1404 A
(file)168 1740 A
(position)336 1950 A
(hoping)252 2328 A
(that)168 2622 A
(more)168 2832 A
3042(of)S
(the)126 3168 A
(file)168 3336 A
(can)126 3546 A
3714(be)S
(found.)252 3840 A
4176(A)S
4680 V
(23857)210 648 A
1152(*)S
(better)252 1236 A
(solution)336 1530 A
(must)168 1908 A
(look)168 2118 A
2328(at)S
(the)126 2454 A
(already)294 2622 A
(available)378 2958 A
(zone)168 3378 A
(pointers)336 3588 A
(and)126 3966 A
4770 V
(23858)210 648 A
1152(*)S
(indirect)336 1236 A
(blocks)252 1614 A
(\(but)168 1908 A
(don't)210 2118 A
(call)168 2370 A
(read_map!\).)462 2580 A
4860 V
(23859)210 648 A
1152(*/)S
4950 V
(23860)210 648 A
5040 V
(23861)210 648 A
(fragment)336 1110 A
1488(=)S
(position)336 1572 A
1950(%)S
(BLOCK_SIZE;)462 2034 A
5130 V
(23862)210 648 A
(position)336 1110 A
1488(-=)S
(fragment;)378 1614 A
5220 V
(23863)210 648 A
(bytes_ahead)462 1110 A
1614(+=)S
(fragment;)378 1740 A
5310 V
(23864)210 648 A
5400 V
(23865)210 648 A
(blocks_ahead)504 1110 A
1656(=)S
(\(bytes_ahead)504 1740 A
2286(+)S
(BLOCK_SIZE)420 2370 A
2832(-)S
2916(1\))S
3042(/)S
(BLOCK_SIZE;)462 3126 A
5490 V
(23866)210 648 A
5580 V
(23867)210 648 A
1110(if)S
(\(block_spec)462 1236 A
1740(&&)S
(rip->i_size)462 1866 A
2370(==)S
2496(0\))S
2622({)S
5670 V
(23868)210 648 A
(blocks_left)462 1362 A
1866(=)S
(NR_IOREQS;)420 1950 A
5760 V
(23869)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5850 V
(23870)210 648 A
(blocks_left)462 1362 A
1866(=)S
(\(rip->i_size)504 1950 A
2496(-)S
(position)336 2580 A
2958(+)S
(BLOCK_SIZE)420 3042 A
3504(-)S
3588(1\))S
3714(/)S
(BLOCK_SIZE;)462 3798 A
5940 V
(23871)210 648 A
6030 V
(23872)210 648 A
1362(/*)S
1488(Go)S
(for)126 1614 A
(the)126 1782 A
(first)210 1950 A
(indirect)336 2202 A
(block)210 2580 A
2832(if)S
2958(we)S
(are)126 3084 A
3252(in)S
(its)126 3378 A
(neighborhood.)546 3546 A
4134(*/)S
6120 V
(23873)210 648 A
1362(if)S
(\(!block_spec\))546 1488 A
2076({)S
6210 V
(23874)210 648 A
(scale)210 1698 A
1950(=)S
(rip->i_sp->s_log_zone_size;)1134 2034 A
8418 V
EP
%%Page: 329 329
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2150(File:)S
2383(src/fs/read.c)S
12 B
(329)180 4248 A
900 V
7 LST
(23875)210 648 A
(ind1_pos)336 1698 A
2076(=)S
(\(off_t\))294 2160 A
(rip->i_ndzones)588 2496 A
3126(*)S
(\(BLOCK_SIZE)462 3210 A
3714(<<)S
(scale\);)294 3840 A
990 V
(23876)210 648 A
1698(if)S
(\(position)378 1824 A
2244(<=)S
(ind1_pos)336 2370 A
2748(&&)S
(rip->i_size)462 2874 A
3378(>)S
(ind1_pos\))378 3462 A
3882({)S
1080 V
(23877)210 648 A
(blocks_ahead++;)630 2034 A
1170 V
(23878)210 648 A
(blocks_left++;)588 2034 A
1260 V
(23879)210 648 A
1698(})S
1350 V
(23880)210 648 A
1362(})S
1440 V
(23881)210 648 A
1110(})S
1530 V
(23882)210 648 A
1620 V
(23883)210 648 A
1110(/*)S
1236(No)S
(more)168 1362 A
(than)168 1572 A
(the)126 1782 A
(maximum)294 1950 A
(request.)336 2286 A
2664(*/)S
1710 V
(23884)210 648 A
1110(if)S
(\(blocks_ahead)546 1236 A
1824(>)S
(NR_IOREQS\))420 1908 A
(blocks_ahead)504 2370 A
2916(=)S
(NR_IOREQS;)420 3000 A
1800 V
(23885)210 648 A
1890 V
(23886)210 648 A
1110(/*)S
(Read)168 1236 A
1446(at)S
(least)210 1572 A
(the)126 1824 A
(minimum)294 1992 A
(number)252 2328 A
2622(of)S
(blocks,)294 2748 A
(but)126 3084 A
(not)126 3252 A
(after)210 3420 A
3672(a)S
(seek.)210 3756 A
4008(*/)S
1980 V
(23887)210 648 A
1110(if)S
(\(blocks_ahead)546 1236 A
1824(<)S
(BLOCKS_MINIMUM)588 1908 A
2538(&&)S
(rip->i_seek)462 2664 A
3168(==)S
(NO_SEEK\))336 3294 A
2070 V
(23888)210 648 A
(blocks_ahead)504 1362 A
1908(=)S
(BLOCKS_MINIMUM;)630 1992 A
2160 V
(23889)210 648 A
2250 V
(23890)210 648 A
1110(/*)S
(Can't)210 1236 A
1488(go)S
(past)168 1614 A
(end)126 1824 A
1992(of)S
(file.)210 2118 A
2370(*/)S
2340 V
(23891)210 648 A
1110(if)S
(\(blocks_ahead)546 1236 A
1824(>)S
(blocks_left\))504 1908 A
(blocks_ahead)504 2454 A
3000(=)S
(blocks_left;)504 3084 A
2430 V
(23892)210 648 A
2520 V
(23893)210 648 A
(read_q_size)462 1110 A
1614(=)S
1698(0;)S
2610 V
(23894)210 648 A
2700 V
(23895)210 648 A
1110(/*)S
(Acquire)294 1236 A
(block)210 1572 A
(buffers.)336 1824 A
2202(*/)S
2790 V
(23896)210 648 A
(for)126 1110 A
(\(;;\))168 1278 A
1488({)S
2880 V
(23897)210 648 A
(read_q[read_q_size++])882 1362 A
2286(=)S
(bp;)126 2370 A
2970 V
(23898)210 648 A
3060 V
(23899)210 648 A
1362(if)S
(\(--blocks_ahead)630 1488 A
2160(==)S
2286(0\))S
(break;)252 2412 A
3150 V
(23900)210 648 A
3240 V
(23901)210 648 A
1362(/*)S
(Don't)210 1488 A
(trash)210 1740 A
(the)126 1992 A
(cache,)252 2160 A
(leave)210 2454 A
2706(4)S
(free.)210 2790 A
3042(*/)S
3330 V
(23902)210 648 A
1362(if)S
(\(bufs_in_use)504 1488 A
2034(>=)S
(NR_BUFS)294 2160 A
2496(-)S
2580(4\))S
(break;)252 2706 A
3420 V
(23903)210 648 A
3510 V
(23904)210 648 A
(block++;)336 1362 A
3600 V
(23905)210 648 A
3690 V
(23906)210 648 A
1362(bp)S
1488(=)S
(get_block\(dev,)588 1572 A
(block,)252 2202 A
(PREFETCH\);)420 2496 A
3780 V
(23907)210 648 A
1362(if)S
(\(bp->b_dev)420 1488 A
1950(!=)S
(NO_DEV\))294 2076 A
2412({)S
3870 V
(23908)210 648 A
1698(/*)S
(Oops,)210 1824 A
(block)210 2076 A
(already)294 2328 A
2664(in)S
(the)126 2790 A
(cache,)252 2958 A
(get)126 3252 A
(out.)168 3420 A
3630(*/)S
3960 V
(23909)210 648 A
(put_block\(bp,)546 1698 A
(FULL_DATA_BLOCK\);)714 2286 A
4050 V
(23910)210 648 A
(break;)252 1698 A
4140 V
(23911)210 648 A
1362(})S
4230 V
(23912)210 648 A
1110(})S
4320 V
(23913)210 648 A
(rw_scattered\(dev,)714 1110 A
(read_q,)294 1866 A
(read_q_size,)504 2202 A
(READING\);)378 2748 A
4410 V
(23914)210 648 A
(return\(get_block\(dev,)882 1110 A
(baseblock,)420 2034 A
(NORMAL\)\);)378 2496 A
4500 V
(23915)210 648 A
1026(})S
5040 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5130 V
(src/fs/write.c)588 2034 A
5220 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5400 V
(24000)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
1572(is)S
(the)126 1698 A
(counterpart)462 1866 A
2370(of)S
("read.c".)378 2496 A
2958(It)S
(contains)336 3084 A
(the)126 3462 A
(code)168 3630 A
(for)126 3840 A
(writing)294 4008 A
5490 V
(24001)210 648 A
1068(*)S
(insofar)294 1152 A
1488(as)S
(this)168 1614 A
1824(is)S
(not)126 1950 A
(contained)378 2118 A
2538(in)S
(read_write\(\).)546 2664 A
5580 V
(24002)210 648 A
1068(*)S
5670 V
(24003)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
5760 V
(24004)210 648 A
1068(*)S
(do_write:)378 1236 A
(call)168 1824 A
(read_write)420 2034 A
2496(to)S
(perform)294 2622 A
(the)126 2958 A
(WRITE)210 3126 A
(system)252 3378 A
(call)168 3672 A
5850 V
(24005)210 648 A
1068(*)S
(clear_zone:)462 1236 A
(erase)210 1824 A
2076(a)S
(zone)168 2160 A
2370(in)S
(the)126 2496 A
(middle)252 2664 A
2958(of)S
3084(a)S
(file)168 3168 A
5940 V
(24006)210 648 A
1068(*)S
(new_block:)420 1236 A
(acquire)294 1824 A
2160(a)S
(new)126 2244 A
(block)210 2412 A
6030 V
(24007)210 648 A
1068(*/)S
6120 V
(24008)210 648 A
6210 V
(24009)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
8418 V
EP
%%Page: 330 330
BP
/slant 0 def
/height 0 def
630 V
12 B
(330)180 648 A
11 R
2132(File:)S
2365(src/fs/write.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(24010)210 648 A
(#include)336 1026 A
(<string.h>)420 1404 A
990 V
(24011)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
1080 V
(24012)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
1170 V
(24013)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
1260 V
(24014)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
1350 V
(24015)210 648 A
(#include)336 1026 A
("super.h")378 1404 A
1440 V
(24016)210 648 A
1530 V
(24017)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(write_map,)420 2034 A
(\(struct)294 2496 A
(inode)210 2832 A
(*rip,)210 3084 A
(off_t)210 3336 A
(position,)378 3588 A
1620 V
(24018)210 648 A
(zone_t)252 2034 A
(new_zone\))378 2328 A
4050(\);)S
1710 V
(24019)210 648 A
1800 V
(24020)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(wr_indir,)378 2076 A
(\(struct)294 2496 A
(buf)126 2832 A
(*bp,)168 3000 A
(int)126 3210 A
(index,)252 3378 A
(zone_t)252 3672 A
(zone\))210 3966 A
4218(\);)S
1890 V
(24021)210 648 A
1980 V
(24022)210 648 A
(/*===========================================================================*)3276 1026 A
2070 V
(24023)210 648 A
1068(*)S
(do_write)336 2370 A
4260(*)S
2160 V
(24024)210 648 A
(*===========================================================================*/)3276 1068 A
2250 V
(24025)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_write\(\))420 1488 A
2340 V
(24026)210 648 A
1026({)S
2430 V
(24027)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(write\(fd,)378 1656 A
(buffer,)294 2076 A
(nbytes\))294 2412 A
(system)252 2748 A
(call.)210 3042 A
3294(*/)S
2520 V
(24028)210 648 A
2610 V
(24029)210 648 A
(return\(read_write\(WRITING\)\);)1176 1110 A
2700 V
(24030)210 648 A
1026(})S
2970 V
(24033)210 648 A
(/*===========================================================================*)3276 1026 A
3060 V
(24034)210 648 A
1068(*)S
(write_map)378 2370 A
4260(*)S
3150 V
(24035)210 648 A
(*===========================================================================*/)3276 1068 A
3240 V
(24036)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(write_map\(rip,)588 1530 A
(position,)378 2160 A
(new_zone\))378 2580 A
3330 V
(24037)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
3210(to)S
3336(be)S
(changed)294 3462 A
3798(*/)S
3420 V
(24038)210 648 A
(off_t)210 1026 A
(position;)378 1278 A
2370(/*)S
(file)168 2496 A
(address)294 2706 A
3042(to)S
3168(be)S
(mapped)252 3294 A
3588(*/)S
3510 V
(24039)210 648 A
(zone_t)252 1026 A
(new_zone;)378 1320 A
2370(/*)S
(zone)168 2496 A
2706(#)S
2790(to)S
2916(be)S
(inserted)336 3042 A
3420(*/)S
3600 V
(24040)210 648 A
1026({)S
3690 V
(24041)210 648 A
1026(/*)S
(Write)210 1152 A
1404(a)S
(new)126 1488 A
(zone)168 1656 A
(into)168 1866 A
2076(an)S
(inode.)252 2202 A
2496(*/)S
3780 V
(24042)210 648 A
(int)126 1110 A
(scale,)252 1278 A
(ind_ex,)294 1572 A
(new_ind,)336 1908 A
(new_dbl,)336 2286 A
(zones,)252 2664 A
(nr_indirects,)546 2958 A
(single,)294 3546 A
(zindex,)294 3882 A
(ex;)126 4218 A
3870 V
(24043)210 648 A
(zone_t)252 1110 A
1404(z,)S
(z1;)126 1530 A
3960 V
(24044)210 648 A
(register)336 1110 A
(block_t)294 1488 A
1824(b;)S
4050 V
(24045)210 648 A
(long)168 1110 A
(excess,)294 1320 A
(zone;)210 1656 A
4140 V
(24046)210 648 A
(struct)252 1110 A
(buf)126 1404 A
(*bp;)168 1572 A
4230 V
(24047)210 648 A
4320 V
(24048)210 648 A
(rip->i_dirt)462 1110 A
1614(=)S
(DIRTY;)252 1698 A
2370(/*)S
(inode)210 2496 A
(will)168 2748 A
2958(be)S
(changed)294 3084 A
3420(*/)S
4410 V
(24049)210 648 A
1110(bp)S
1236(=)S
(NIL_BUF;)336 1320 A
4500 V
(24050)210 648 A
(scale)210 1110 A
1362(=)S
(rip->i_sp->s_log_zone_size;)1134 1446 A
3042(/*)S
(for)126 3168 A
(zone-block)420 3336 A
(conversion)420 3798 A
4260(*/)S
4590 V
(24051)210 648 A
(zone)168 1110 A
1320(=)S
(\(position/BLOCK_SIZE\))882 1404 A
2328(>>)S
(scale;)252 2454 A
3042(/*)S
(relative)336 3168 A
(zone)168 3546 A
3756(#)S
3840(to)S
(insert)252 3966 A
4260(*/)S
4680 V
(24052)210 648 A
(zones)210 1110 A
1362(=)S
(rip->i_ndzones;)630 1446 A
2370(/*)S
2496(#)S
(direct)252 2580 A
(zones)210 2874 A
3126(in)S
(the)126 3252 A
(inode)210 3420 A
3672(*/)S
4770 V
(24053)210 648 A
(nr_indirects)504 1110 A
1656(=)S
(rip->i_nindirs;/*)714 1740 A
2496(#)S
(indirect)336 2580 A
(zones)210 2958 A
(per)126 3210 A
(indirect)336 3378 A
(block)210 3756 A
4008(*/)S
4860 V
(24054)210 648 A
4950 V
(24055)210 648 A
1110(/*)S
1236(Is)S
('position')420 1362 A
1824(to)S
1950(be)S
(found)210 2076 A
2328(in)S
(the)126 2454 A
(inode)210 2622 A
(itself?)294 2874 A
3210(*/)S
5040 V
(24056)210 648 A
1110(if)S
(\(zone)210 1236 A
1488(<)S
(zones\))252 1572 A
1866({)S
5130 V
(24057)210 648 A
(zindex)252 1362 A
1656(=)S
(\(int\))210 1740 A
(zone;)210 1992 A
2370(/*)S
2496(we)S
(need)168 2622 A
2832(an)S
(integer)294 2958 A
(here)168 3294 A
3504(*/)S
5220 V
(24058)210 648 A
(rip->i_zone[zindex])798 1362 A
2202(=)S
(new_zone;)378 2286 A
5310 V
(24059)210 648 A
(return\(OK\);)462 1362 A
5400 V
(24060)210 648 A
1110(})S
5490 V
(24061)210 648 A
5580 V
(24062)210 648 A
1110(/*)S
1236(It)S
1362(is)S
(not)126 1488 A
1656(in)S
(the)126 1782 A
(inode,)252 1950 A
2244(so)S
2370(it)S
(must)168 2496 A
2706(be)S
(single)252 2832 A
3126(or)S
(double)252 3252 A
(indirect.)378 3546 A
3966(*/)S
5670 V
(24063)210 648 A
(excess)252 1110 A
1404(=)S
(zone)168 1488 A
1698(-)S
(zones;)252 1782 A
2370(/*)S
(first)210 2496 A
(Vx_NR_DZONES)504 2748 A
(don't)210 3294 A
(count)210 3546 A
3798(*/)S
5760 V
(24064)210 648 A
(new_ind)294 1110 A
1446(=)S
(FALSE;)252 1530 A
5850 V
(24065)210 648 A
(new_dbl)294 1110 A
1446(=)S
(FALSE;)252 1530 A
5940 V
(24066)210 648 A
6030 V
(24067)210 648 A
1110(if)S
(\(excess)294 1236 A
1572(<)S
(nr_indirects\))546 1656 A
2244({)S
6120 V
(24068)210 648 A
1362(/*)S
('position')420 1488 A
(can)126 1950 A
2118(be)S
(located)294 2244 A
(via)126 2580 A
(the)126 2748 A
(single)252 2916 A
(indirect)336 3210 A
(block.)252 3588 A
3882(*/)S
6210 V
(24069)210 648 A
1362(z1)S
1488(=)S
(rip->i_zone[zones];)798 1572 A
2706(/*)S
(single)252 2832 A
(indirect)336 3126 A
(zone)168 3504 A
3714(*/)S
8418 V
EP
%%Page: 331 331
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2132(File:)S
2365(src/fs/write.c)S
12 B
(331)180 4248 A
900 V
7 LST
(24070)210 648 A
(single)252 1362 A
1656(=)S
(TRUE;)210 1740 A
990 V
(24071)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1080 V
(24072)210 648 A
1362(/*)S
('position')420 1488 A
(can)126 1950 A
2118(be)S
(located)294 2244 A
(via)126 2580 A
(the)126 2748 A
(double)252 2916 A
(indirect)336 3210 A
(block.)252 3588 A
3882(*/)S
1170 V
(24073)210 648 A
1362(if)S
1488(\()S
1572(\(z)S
1698(=)S
(rip->i_zone[zones+1]\))882 1782 A
2706(==)S
(NO_ZONE\))336 2832 A
3210({)S
1260 V
(24074)210 648 A
1698(/*)S
(Create)252 1824 A
(the)126 2118 A
(double)252 2286 A
(indirect)336 2580 A
(block.)252 2958 A
3252(*/)S
1350 V
(24075)210 648 A
1698(if)S
1824(\()S
1908(\(z)S
2034(=)S
(alloc_zone\(rip->i_dev,)924 2118 A
(rip->i_zone[0]\)\))672 3084 A
3798(==)S
(NO_ZONE\))336 3924 A
1440 V
(24076)210 648 A
(return\(err_code\);)714 2034 A
1530 V
(24077)210 648 A
(rip->i_zone[zones+1])840 1698 A
2580(=)S
2664(z;)S
1620 V
(24078)210 648 A
(new_dbl)294 1698 A
2034(=)S
(TRUE;)210 2118 A
2370(/*)S
(set)126 2496 A
(flag)168 2664 A
(for)126 2874 A
(later)210 3042 A
3294(*/)S
1710 V
(24079)210 648 A
1362(})S
1800 V
(24080)210 648 A
1890 V
(24081)210 648 A
1362(/*)S
(Either)252 1488 A
(way,)168 1782 A
('z')126 1992 A
2160(is)S
(zone)168 2286 A
(number)252 2496 A
(for)126 2790 A
(double)252 2958 A
(indirect)336 3252 A
(block.)252 3630 A
3924(*/)S
1980 V
(24082)210 648 A
(excess)252 1362 A
1656(-=)S
(nr_indirects;)546 1782 A
2370(/*)S
(single)252 2496 A
(indirect)336 2790 A
(doesn't)294 3168 A
(count)210 3504 A
3756(*/)S
2070 V
(24083)210 648 A
(ind_ex)252 1362 A
1656(=)S
(\(int\))210 1740 A
(\(excess)294 1992 A
2328(/)S
(nr_indirects\);)588 2412 A
2160 V
(24084)210 648 A
(excess)252 1362 A
1656(=)S
(excess)252 1740 A
2034(%)S
(nr_indirects;)546 2118 A
2250 V
(24085)210 648 A
1362(if)S
(\(ind_ex)294 1488 A
1824(>=)S
(nr_indirects\))546 1950 A
(return\(EFBIG\);)588 2538 A
2340 V
(24086)210 648 A
1362(b)S
1446(=)S
(\(block_t\))378 1530 A
1950(z)S
2034(<<)S
(scale;)252 2160 A
2430 V
(24087)210 648 A
1362(bp)S
1488(=)S
(get_block\(rip->i_dev,)882 1572 A
2496(b,)S
(\(new_dbl)336 2622 A
3000(?)S
(NO_READ)294 3084 A
3420(:)S
(NORMAL\)\);)378 3504 A
2520 V
(24088)210 648 A
1362(if)S
(\(new_dbl\))378 1488 A
(zero_block\(bp\);)630 1908 A
2610 V
(24089)210 648 A
1362(z1)S
1488(=)S
(rd_indir\(bp,)504 1572 A
(ind_ex\);)336 2118 A
2700 V
(24090)210 648 A
(single)252 1362 A
1656(=)S
(FALSE;)252 1740 A
2790 V
(24091)210 648 A
1110(})S
2880 V
(24092)210 648 A
2970 V
(24093)210 648 A
1110(/*)S
1236(z1)S
1362(is)S
(now)126 1488 A
(single)252 1656 A
(indirect)336 1950 A
(zone;)210 2328 A
('excess')336 2580 A
2958(is)S
(index.)252 3084 A
3378(*/)S
3060 V
(24094)210 648 A
1110(if)S
(\(z1)126 1236 A
1404(==)S
(NO_ZONE\))336 1530 A
1908({)S
3150 V
(24095)210 648 A
1362(/*)S
(Create)252 1488 A
(indirect)336 1782 A
(block)210 2160 A
(and)126 2412 A
(store)210 2580 A
(zone)168 2832 A
3042(#)S
3126(in)S
(inode)210 3252 A
3504(or)S
(dbl)126 3630 A
(indir)210 3798 A
(blk.)168 4050 A
4260(*/)S
3240 V
(24096)210 648 A
1362(z1)S
1488(=)S
(alloc_zone\(rip->i_dev,)924 1572 A
(rip->i_zone[0]\);)672 2538 A
3330 V
(24097)210 648 A
1362(if)S
(\(single\))336 1488 A
3420 V
(24098)210 648 A
(rip->i_zone[zones])756 1698 A
2496(=)S
(z1;)126 2580 A
3042(/*)S
(update)252 3168 A
(inode)210 3462 A
3714(*/)S
3510 V
(24099)210 648 A
(else)168 1362 A
3600 V
(24100)210 648 A
(wr_indir\(bp,)504 1698 A
(ind_ex,)294 2244 A
(z1\);)168 2580 A
3042(/*)S
(update)252 3168 A
(dbl)126 3462 A
(indir)210 3630 A
3882(*/)S
3690 V
(24101)210 648 A
3780 V
(24102)210 648 A
(new_ind)294 1362 A
1698(=)S
(TRUE;)210 1782 A
3870 V
(24103)210 648 A
1362(if)S
(\(bp)126 1488 A
1656(!=)S
(NIL_BUF\))336 1782 A
(bp->b_dirt)420 2160 A
2622(=)S
(DIRTY;)252 2706 A
3042(/*)S
3168(if)S
(double)252 3294 A
(ind,)168 3588 A
3798(it)S
3924(is)S
(dirty*/)294 4050 A
3960 V
(24104)210 648 A
1362(if)S
(\(z1)126 1488 A
1656(==)S
(NO_ZONE\))336 1782 A
2160({)S
4050 V
(24105)210 648 A
(put_block\(bp,)546 1698 A
(INDIRECT_BLOCK\);)672 2286 A
3042(/*)S
(release)294 3168 A
(dbl)126 3504 A
(indirect)336 3672 A
(blk)126 4050 A
4218(*/)S
4140 V
(24106)210 648 A
(return\(err_code\);)714 1698 A
2706(/*)S
(couldn't)336 2832 A
(create)252 3210 A
(single)252 3504 A
(ind)126 3798 A
3966(*/)S
4230 V
(24107)210 648 A
1362(})S
4320 V
(24108)210 648 A
1110(})S
4410 V
(24109)210 648 A
(put_block\(bp,)546 1110 A
(INDIRECT_BLOCK\);)672 1698 A
2706(/*)S
(release)294 2832 A
(double)252 3168 A
(indirect)336 3462 A
(blk)126 3840 A
4008(*/)S
4500 V
(24110)210 648 A
4590 V
(24111)210 648 A
1110(/*)S
1236(z1)S
1362(is)S
(indirect)336 1488 A
(block's)294 1866 A
(zone)168 2202 A
(number.)294 2412 A
2748(*/)S
4680 V
(24112)210 648 A
1110(b)S
1194(=)S
(\(block_t\))378 1278 A
1698(z1)S
1824(<<)S
(scale;)252 1950 A
4770 V
(24113)210 648 A
1110(bp)S
1236(=)S
(get_block\(rip->i_dev,)882 1320 A
2244(b,)S
(\(new_ind)336 2370 A
2748(?)S
(NO_READ)294 2832 A
3168(:)S
(NORMAL\))294 3252 A
3588(\);)S
4860 V
(24114)210 648 A
1110(if)S
(\(new_ind\))378 1236 A
(zero_block\(bp\);)630 1656 A
4950 V
(24115)210 648 A
1110(ex)S
1236(=)S
(\(int\))210 1320 A
(excess;)294 1572 A
2706(/*)S
2832(we)S
(need)168 2958 A
3168(an)S
(int)126 3294 A
(here)168 3462 A
3672(*/)S
5040 V
(24116)210 648 A
(wr_indir\(bp,)504 1110 A
(ex,)126 1656 A
(new_zone\);)420 1824 A
5130 V
(24117)210 648 A
(bp->b_dirt)420 1110 A
1572(=)S
(DIRTY;)252 1656 A
5220 V
(24118)210 648 A
(put_block\(bp,)546 1110 A
(INDIRECT_BLOCK\);)672 1698 A
5310 V
(24119)210 648 A
5400 V
(24120)210 648 A
(return\(OK\);)462 1110 A
5490 V
(24121)210 648 A
1026(})S
5760 V
(24124)210 648 A
(/*===========================================================================*)3276 1026 A
5850 V
(24125)210 648 A
1068(*)S
(wr_indir)336 2370 A
4260(*)S
5940 V
(24126)210 648 A
(*===========================================================================*/)3276 1068 A
6030 V
(24127)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(wr_indir\(bp,)504 1572 A
(index,)252 2118 A
(zone\))210 2412 A
6120 V
(24128)210 648 A
(struct)252 1026 A
(buf)126 1320 A
(*bp;)168 1488 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(indirect)336 2958 A
(block)210 3336 A
3588(*/)S
6210 V
(24129)210 648 A
(int)126 1026 A
(index;)252 1194 A
2370(/*)S
(index)210 2496 A
(into)168 2748 A
(*bp)126 2958 A
3126(*/)S
8418 V
EP
%%Page: 332 332
BP
/slant 0 def
/height 0 def
630 V
12 B
(332)180 648 A
11 R
2132(File:)S
2365(src/fs/write.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(24130)210 648 A
(zone_t)252 1026 A
(zone;)210 1320 A
2370(/*)S
(zone)168 2496 A
2706(to)S
(write)210 2832 A
3084(*/)S
990 V
(24131)210 648 A
1026({)S
1080 V
(24132)210 648 A
1026(/*)S
(Given)210 1152 A
1404(a)S
(pointer)294 1488 A
1824(to)S
1950(an)S
(indirect)336 2076 A
(block,)252 2454 A
(write)210 2748 A
(one)126 3000 A
(entry.)252 3168 A
3462(*/)S
1170 V
(24133)210 648 A
1260 V
(24134)210 648 A
(struct)252 1110 A
(super_block)462 1404 A
(*sp;)168 1908 A
1350 V
(24135)210 648 A
1440 V
(24136)210 648 A
1110(sp)S
1236(=)S
(get_super\(bp->b_dev\);)882 1320 A
2370(/*)S
(need)168 2496 A
(super)210 2706 A
(block)210 2958 A
3210(to)S
(find)168 3336 A
(file)168 3546 A
(sys)126 3756 A
(type)168 3924 A
4134(*/)S
1530 V
(24137)210 648 A
1620 V
(24138)210 648 A
1110(/*)S
(write)210 1236 A
1488(a)S
(zone)168 1572 A
(into)168 1782 A
1992(an)S
(indirect)336 2118 A
(block)210 2496 A
2748(*/)S
1710 V
(24139)210 648 A
1110(if)S
(\(sp->s_version)588 1236 A
1866(==)S
(V1\))126 1992 A
1800 V
(24140)210 648 A
(bp->b_v1_ind[index])798 1362 A
2202(=)S
(\(zone1_t\))378 2286 A
(conv2\(sp->s_native,)798 2706 A
(\(int\))210 3546 A
(zone\);)252 3840 A
1890 V
(24141)210 648 A
(else)168 1110 A
1980 V
(24142)210 648 A
(bp->b_v2_ind[index])798 1362 A
2202(=)S
(\(zone_t\))336 2286 A
(conv4\(sp->s_native,)798 2706 A
(\(long\))252 3546 A
(zone\);)252 3840 A
2070 V
(24143)210 648 A
1026(})S
2340 V
(24146)210 648 A
(/*===========================================================================*)3276 1026 A
2430 V
(24147)210 648 A
1068(*)S
(clear_zone)420 2370 A
4260(*)S
2520 V
(24148)210 648 A
(*===========================================================================*/)3276 1068 A
2610 V
(24149)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(clear_zone\(rip,)630 1530 A
(pos,)168 2202 A
(flag\))210 2412 A
2700 V
(24150)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(inode)210 2496 A
2748(to)S
(clear)210 2874 A
3126(*/)S
2790 V
(24151)210 648 A
(off_t)210 1026 A
(pos;)168 1278 A
2370(/*)S
(points)252 2496 A
2790(to)S
(block)210 2916 A
3168(to)S
(clear)210 3294 A
3546(*/)S
2880 V
(24152)210 648 A
(int)126 1026 A
(flag;)210 1194 A
2370(/*)S
2496(0)S
2580(if)S
(called)252 2706 A
3000(by)S
(read_write,)462 3126 A
3630(1)S
3714(by)S
(new_block)378 3840 A
4260(*/)S
2970 V
(24153)210 648 A
1026({)S
3060 V
(24154)210 648 A
1026(/*)S
(Zero)168 1152 A
1362(a)S
(zone,)210 1446 A
(possibly)336 1698 A
(starting)336 2076 A
2454(in)S
(the)126 2580 A
(middle.)294 2748 A
(The)126 3126 A
(parameter)378 3294 A
('pos')210 3714 A
(gives)210 3966 A
3150 V
(24155)210 648 A
1068(*)S
1152(a)S
(byte)168 1236 A
1446(in)S
(the)126 1572 A
(first)210 1740 A
(block)210 1992 A
2244(to)S
2370(be)S
(zeroed.)294 2496 A
(Clearzone\(\))462 2874 A
3378(is)S
(called)252 3504 A
(from)168 3798 A
3240 V
(24156)210 648 A
1068(*)S
(read_write)420 1152 A
(and)126 1614 A
(new_block\(\).)504 1782 A
3330 V
(24157)210 648 A
1068(*/)S
3420 V
(24158)210 648 A
3510 V
(24159)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp;)168 1950 A
3600 V
(24160)210 648 A
(register)336 1110 A
(block_t)294 1488 A
1824(b,)S
(blo,)168 1950 A
(bhi;)168 2160 A
3690 V
(24161)210 648 A
(register)336 1110 A
(off_t)210 1488 A
(next;)210 1740 A
3780 V
(24162)210 648 A
(register)336 1110 A
(int)126 1488 A
(scale;)252 1656 A
3870 V
(24163)210 648 A
(register)336 1110 A
(zone_t)252 1488 A
(zone_size;)420 1782 A
3960 V
(24164)210 648 A
4050 V
(24165)210 648 A
1110(/*)S
1236(If)S
(the)126 1362 A
(block)210 1530 A
(size)168 1782 A
(and)126 1992 A
(zone)168 2160 A
(size)168 2370 A
(are)126 2580 A
(the)126 2748 A
(same,)210 2916 A
(clear_zone\(\))504 3168 A
(not)126 3714 A
(needed.)294 3882 A
4218(*/)S
4140 V
(24166)210 648 A
(scale)210 1110 A
1362(=)S
(rip->i_sp->s_log_zone_size;)1134 1446 A
4230 V
(24167)210 648 A
1110(if)S
(\(scale)252 1236 A
1530(==)S
1656(0\))S
(return;)294 1782 A
4320 V
(24168)210 648 A
4410 V
(24169)210 648 A
(zone_size)378 1110 A
1530(=)S
(\(zone_t\))336 1614 A
(BLOCK_SIZE)420 1992 A
2454(<<)S
(scale;)252 2580 A
4500 V
(24170)210 648 A
1110(if)S
(\(flag)210 1236 A
1488(==)S
1614(1\))S
(pos)126 1740 A
1908(=)S
(\(pos/zone_size\))630 1992 A
2664(*)S
(zone_size;)420 2748 A
4590 V
(24171)210 648 A
(next)168 1110 A
1320(=)S
(pos)126 1404 A
1572(+)S
(BLOCK_SIZE)420 1656 A
2118(-)S
2202(1;)S
4680 V
(24172)210 648 A
4770 V
(24173)210 648 A
1110(/*)S
1236(If)S
('pos')210 1362 A
1614(is)S
1740(in)S
(the)126 1866 A
(last)168 2034 A
(block)210 2244 A
2496(of)S
2622(a)S
(zone,)210 2706 A
2958(do)S
(not)126 3084 A
(clear)210 3252 A
(the)126 3504 A
(zone.)210 3672 A
3924(*/)S
4860 V
(24174)210 648 A
1110(if)S
(\(next/zone_size)630 1236 A
1908(!=)S
(pos/zone_size\))588 2034 A
(return;)294 2664 A
4950 V
(24175)210 648 A
1110(if)S
1236(\()S
(\(blo)168 1320 A
1530(=)S
(read_map\(rip,)546 1614 A
(next\)\))252 2202 A
2496(==)S
(NO_BLOCK\))378 2622 A
(return;)294 3042 A
5040 V
(24176)210 648 A
(bhi)126 1110 A
1278(=)S
1362(\()S
(\(\(blo>>scale\)+1\))672 1488 A
2202(<<)S
(scale\))252 2328 A
2706(-)S
2790(1;)S
5130 V
(24177)210 648 A
5220 V
(24178)210 648 A
1110(/*)S
(Clear)210 1236 A
(all)126 1488 A
(the)126 1656 A
(blocks)252 1824 A
(between)294 2118 A
('blo')210 2454 A
(and)126 2706 A
('bhi'.)252 2874 A
3168(*/)S
5310 V
(24179)210 648 A
(for)126 1110 A
1278(\(b)S
1404(=)S
(blo;)168 1488 A
1698(b)S
1782(<=)S
(bhi;)168 1908 A
(b++\))168 2118 A
2328({)S
5400 V
(24180)210 648 A
1362(bp)S
1488(=)S
(get_block\(rip->i_dev,)882 1572 A
2496(b,)S
(NO_READ\);)378 2622 A
5490 V
(24181)210 648 A
(zero_block\(bp\);)630 1362 A
5580 V
(24182)210 648 A
(put_block\(bp,)546 1362 A
(FULL_DATA_BLOCK\);)714 1950 A
5670 V
(24183)210 648 A
1110(})S
5760 V
(24184)210 648 A
1026(})S
6030 V
(24187)210 648 A
(/*===========================================================================*)3276 1026 A
6120 V
(24188)210 648 A
1068(*)S
(new_block)378 2370 A
4260(*)S
6210 V
(24189)210 648 A
(*===========================================================================*/)3276 1068 A
8418 V
EP
%%Page: 333 333
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2132(File:)S
2365(src/fs/write.c)S
12 B
(333)180 4248 A
900 V
7 LST
(24190)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(buf)126 1614 A
(*new_block\(rip,)630 1782 A
(position\))378 2454 A
990 V
(24191)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
3210(*/)S
1080 V
(24192)210 648 A
(off_t)210 1026 A
(position;)378 1278 A
2370(/*)S
(file)168 2496 A
(pointer)294 2706 A
3042(*/)S
1170 V
(24193)210 648 A
1026({)S
1260 V
(24194)210 648 A
1026(/*)S
(Acquire)294 1152 A
1488(a)S
(new)126 1572 A
(block)210 1740 A
(and)126 1992 A
(return)252 2160 A
2454(a)S
(pointer)294 2538 A
2874(to)S
(it.)126 3000 A
(Doing)210 3210 A
3462(so)S
(may)126 3588 A
(require)294 3756 A
1350 V
(24195)210 648 A
1068(*)S
(allocating)420 1152 A
1614(a)S
(complete)336 1698 A
(zone,)210 2076 A
(and)126 2328 A
(then)168 2496 A
(returning)378 2706 A
(the)126 3126 A
(initial)294 3294 A
(block.)252 3630 A
1440 V
(24196)210 648 A
1068(*)S
1152(On)S
(the)126 1278 A
(other)210 1446 A
(hand,)210 1698 A
(the)126 1950 A
(current)294 2118 A
(zone)168 2454 A
(may)126 2664 A
(still)210 2832 A
(have)168 3084 A
(some)168 3294 A
(unused)252 3504 A
(blocks.)294 3798 A
1530 V
(24197)210 648 A
1068(*/)S
1620 V
(24198)210 648 A
1710 V
(24199)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp;)168 1950 A
1800 V
(24200)210 648 A
(block_t)294 1110 A
1446(b,)S
(base_block;)462 1572 A
1890 V
(24201)210 648 A
(zone_t)252 1110 A
1404(z;)S
1980 V
(24202)210 648 A
(zone_t)252 1110 A
(zone_size;)420 1404 A
2070 V
(24203)210 648 A
(int)126 1110 A
(scale,)252 1278 A
1572(r;)S
2160 V
(24204)210 648 A
(struct)252 1110 A
(super_block)462 1404 A
(*sp;)168 1908 A
2250 V
(24205)210 648 A
2340 V
(24206)210 648 A
1110(/*)S
1236(Is)S
(another)294 1362 A
(block)210 1698 A
(available)378 1950 A
2370(in)S
(the)126 2496 A
(current)294 2664 A
(zone?)210 3000 A
3252(*/)S
2430 V
(24207)210 648 A
1110(if)S
1236(\()S
1320(\(b)S
1446(=)S
(read_map\(rip,)546 1530 A
(position\)\))420 2118 A
2580(==)S
(NO_BLOCK\))378 2706 A
3126({)S
2520 V
(24208)210 648 A
1362(/*)S
(Choose)252 1488 A
(first)210 1782 A
(zone)168 2034 A
2244(if)S
(possible.)378 2370 A
2790(*/)S
2610 V
(24209)210 648 A
1362(/*)S
(Lose)168 1488 A
1698(if)S
(the)126 1824 A
(file)168 1992 A
2202(is)S
(nonempty)336 2328 A
(but)126 2706 A
(the)126 2874 A
(first)210 3042 A
(zone)168 3294 A
(number)252 3504 A
3798(is)S
(NO_ZONE)294 3924 A
2700 V
(24210)210 648 A
1404(*)S
(corresponding)546 1488 A
2076(to)S
2202(a)S
(zone)168 2286 A
(full)168 2496 A
2706(of)S
(zeros.)252 2832 A
3168(It)S
(would)210 3294 A
3546(be)S
(better)252 3672 A
3966(to)S
2790 V
(24211)210 648 A
1404(*)S
(search)252 1488 A
(near)168 1782 A
(the)126 1992 A
(last)168 2160 A
(real)168 2370 A
(zone.)210 2580 A
2880 V
(24212)210 648 A
1404(*/)S
2970 V
(24213)210 648 A
1362(if)S
(\(rip->i_zone[0])630 1488 A
2160(==)S
(NO_ZONE\))336 2286 A
2664({)S
3060 V
(24214)210 648 A
1698(sp)S
1824(=)S
(rip->i_sp;)420 1908 A
3150 V
(24215)210 648 A
1698(z)S
1782(=)S
(sp->s_firstdatazone;)840 1866 A
3240 V
(24216)210 648 A
1362(})S
(else)168 1446 A
1656({)S
3330 V
(24217)210 648 A
1698(z)S
1782(=)S
(rip->i_zone[0];)630 1866 A
2706(/*)S
(hunt)168 2832 A
(near)168 3042 A
(first)210 3252 A
(zone)168 3504 A
3714(*/)S
3420 V
(24218)210 648 A
1362(})S
3510 V
(24219)210 648 A
1362(if)S
1488(\()S
1572(\(z)S
1698(=)S
(alloc_zone\(rip->i_dev,)924 1782 A
(z\)\))126 2748 A
2916(==)S
(NO_ZONE\))336 3042 A
(return\(NIL_BUF\);)672 3420 A
3600 V
(24220)210 648 A
1362(if)S
1488(\()S
1572(\(r)S
1698(=)S
(write_map\(rip,)588 1782 A
(position,)378 2412 A
(z\)\))126 2832 A
3000(!=)S
(OK\))126 3126 A
3294({)S
3690 V
(24221)210 648 A
(free_zone\(rip->i_dev,)882 1698 A
(z\);)126 2622 A
3780 V
(24222)210 648 A
(err_code)336 1698 A
2076(=)S
2160(r;)S
3870 V
(24223)210 648 A
(return\(NIL_BUF\);)672 1698 A
3960 V
(24224)210 648 A
1362(})S
4050 V
(24225)210 648 A
4140 V
(24226)210 648 A
1362(/*)S
1488(If)S
1614(we)S
(are)126 1740 A
(not)126 1908 A
(writing)294 2076 A
2412(at)S
(EOF,)168 2538 A
(clear)210 2748 A
(the)126 3000 A
(zone,)210 3168 A
(just)168 3420 A
3630(to)S
3756(be)S
(safe.)210 3882 A
4134(*/)S
4230 V
(24227)210 648 A
1362(if)S
1488(\()S
(position)336 1572 A
1950(!=)S
(rip->i_size\))504 2076 A
(clear_zone\(rip,)630 2622 A
(position,)378 3294 A
(1\);)126 3714 A
4320 V
(24228)210 648 A
(scale)210 1362 A
1614(=)S
(rip->i_sp->s_log_zone_size;)1134 1698 A
4410 V
(24229)210 648 A
(base_block)420 1362 A
1824(=)S
(\(block_t\))378 1908 A
2328(z)S
2412(<<)S
(scale;)252 2538 A
4500 V
(24230)210 648 A
(zone_size)378 1362 A
1782(=)S
(\(zone_t\))336 1866 A
(BLOCK_SIZE)420 2244 A
2706(<<)S
(scale;)252 2832 A
4590 V
(24231)210 648 A
1362(b)S
1446(=)S
(base_block)420 1530 A
1992(+)S
(\(block_t\)\(\(position)798 2076 A
2916(%)S
(zone_size\)/BLOCK_SIZE\);)966 3000 A
4680 V
(24232)210 648 A
1110(})S
4770 V
(24233)210 648 A
4860 V
(24234)210 648 A
1110(bp)S
1236(=)S
(get_block\(rip->i_dev,)882 1320 A
2244(b,)S
(NO_READ\);)378 2370 A
4950 V
(24235)210 648 A
(zero_block\(bp\);)630 1110 A
5040 V
(24236)210 648 A
(return\(bp\);)462 1110 A
5130 V
(24237)210 648 A
1026(})S
5400 V
(24240)210 648 A
(/*===========================================================================*)3276 1026 A
5490 V
(24241)210 648 A
1068(*)S
(zero_block)420 2370 A
4260(*)S
5580 V
(24242)210 648 A
(*===========================================================================*/)3276 1068 A
5670 V
(24243)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(zero_block\(bp\))588 1530 A
5760 V
(24244)210 648 A
(register)336 1026 A
(struct)252 1404 A
(buf)126 1698 A
(*bp;)168 1866 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(buffer)252 2958 A
3252(to)S
(zero)168 3378 A
3588(*/)S
5850 V
(24245)210 648 A
1026({)S
5940 V
(24246)210 648 A
1026(/*)S
(Zero)168 1152 A
1362(a)S
(block.)252 1446 A
1740(*/)S
6030 V
(24247)210 648 A
6120 V
(24248)210 648 A
(memset\(bp->b_data,)756 1110 A
1908(0,)S
(BLOCK_SIZE\);)504 2034 A
6210 V
(24249)210 648 A
(bp->b_dirt)420 1110 A
1572(=)S
(DIRTY;)252 1656 A
8418 V
EP
%%Page: 334 334
BP
/slant 0 def
/height 0 def
630 V
12 B
(334)180 648 A
11 R
2132(File:)S
2365(src/fs/write.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(24250)210 648 A
1026(})S
1440 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1530 V
(src/fs/pipe.c)546 2034 A
1620 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1800 V
(24300)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(deals)210 1572 A
(with)168 1824 A
(the)126 2034 A
(suspension)420 2202 A
(and)126 2664 A
(revival)294 2832 A
3168(of)S
(processes.)420 3294 A
3798(A)S
(process)294 3882 A
(can)126 4218 A
1890 V
(24301)210 648 A
1068(*)S
1152(be)S
(suspended)378 1278 A
(because)294 1698 A
2034(it)S
(wants)210 2160 A
2412(to)S
(read)168 2538 A
2748(or)S
(write)210 2874 A
(from)168 3126 A
3336(a)S
(pipe)168 3420 A
(and)126 3630 A
(can't,)252 3798 A
4092(or)S
1980 V
(24302)210 648 A
1068(*)S
(because)294 1152 A
1488(it)S
(wants)210 1614 A
1866(to)S
(read)168 1992 A
2202(or)S
(write)210 2328 A
(from)168 2580 A
2790(a)S
(special)294 2874 A
(file)168 3210 A
(and)126 3420 A
(can't.)252 3588 A
(When)168 3924 A
4134(a)S
2070 V
(24303)210 648 A
1068(*)S
(process)294 1152 A
(can't)210 1488 A
(continue)336 1740 A
2118(it)S
2244(is)S
(suspended,)420 2370 A
(and)126 2832 A
(revived)294 3000 A
(later)210 3336 A
(when)168 3588 A
3798(it)S
3924(is)S
(able)168 4050 A
2160 V
(24304)210 648 A
1068(*)S
1152(to)S
(continue.)378 1278 A
2250 V
(24305)210 648 A
1068(*)S
2340 V
(24306)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
2430 V
(24307)210 648 A
1068(*)S
(do_pipe:)336 1236 A
(perform)294 1782 A
(the)126 2118 A
(PIPE)168 2286 A
(system)252 2496 A
(call)168 2790 A
2520 V
(24308)210 648 A
1068(*)S
(pipe_check:)462 1236 A
(check)210 1782 A
2034(to)S
(see)126 2160 A
(that)168 2328 A
2538(a)S
(read)168 2622 A
2832(or)S
(write)210 2958 A
3210(on)S
3336(a)S
(pipe)168 3420 A
3630(is)S
(feasible)336 3756 A
(now)126 4134 A
2610 V
(24309)210 648 A
1068(*)S
(suspend:)336 1236 A
(suspend)294 1782 A
2118(a)S
(process)294 2202 A
(that)168 2538 A
(cannot)252 2748 A
3042(do)S
3168(a)S
(requested)378 3252 A
(read)168 3672 A
3882(or)S
(write)210 4008 A
2700 V
(24310)210 648 A
1068(*)S
(release:)336 1236 A
(check)210 1782 A
2034(to)S
(see)126 2160 A
2328(if)S
2454(a)S
(suspended)378 2538 A
(process)294 2958 A
(can)126 3294 A
3462(be)S
(released)336 3588 A
(and)126 3966 A
4134(do)S
4260(it)S
2790 V
(24311)210 648 A
1068(*)S
(revive:)294 1236 A
(mark)168 1782 A
1992(a)S
(suspended)378 2076 A
(process)294 2496 A
2832(as)S
(able)168 2958 A
3168(to)S
(run)126 3294 A
(again)210 3462 A
2880 V
(24312)210 648 A
1068(*)S
(do_unpause:)462 1236 A
1782(a)S
(signal)252 1866 A
(has)126 2160 A
(been)168 2328 A
(sent)168 2538 A
2748(to)S
2874(a)S
(process;)336 2958 A
(see)126 3336 A
3504(if)S
3630(it)S
(suspended)378 3756 A
2970 V
(24313)210 648 A
1068(*/)S
3060 V
(24314)210 648 A
3150 V
(24315)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
3240 V
(24316)210 648 A
(#include)336 1026 A
(<fcntl.h>)378 1404 A
3330 V
(24317)210 648 A
(#include)336 1026 A
(<signal.h>)420 1404 A
3420 V
(24318)210 648 A
(#include)336 1026 A
(<minix/boot.h>)588 1404 A
3510 V
(24319)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
3600 V
(24320)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
3690 V
(24321)210 648 A
(#include)336 1026 A
("dev.h")294 1404 A
3780 V
(24322)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
3870 V
(24323)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
3960 V
(24324)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
4050 V
(24325)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
4140 V
(24326)210 648 A
4230 V
(24327)210 648 A
(PRIVATE)294 1026 A
(message)294 1362 A
(mess;)210 1698 A
4320 V
(24328)210 648 A
4410 V
(24329)210 648 A
(/*===========================================================================*)3276 1026 A
4500 V
(24330)210 648 A
1068(*)S
(do_pipe)294 2370 A
4260(*)S
4590 V
(24331)210 648 A
(*===========================================================================*/)3276 1068 A
4680 V
(24332)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_pipe\(\))378 1488 A
4770 V
(24333)210 648 A
1026({)S
4860 V
(24334)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(pipe\(fil_des\))546 1656 A
(system)252 2244 A
(call.)210 2538 A
2790(*/)S
4950 V
(24335)210 648 A
5040 V
(24336)210 648 A
(register)336 1110 A
(struct)252 1488 A
(fproc)210 1782 A
(*rfp;)210 2034 A
5130 V
(24337)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
5220 V
(24338)210 648 A
(int)126 1110 A
1278(r;)S
5310 V
(24339)210 648 A
(struct)252 1110 A
(filp)168 1404 A
(*fil_ptr0,)420 1614 A
(*fil_ptr1;)420 2076 A
5400 V
(24340)210 648 A
(int)126 1110 A
(fil_des[2];)462 1278 A
2370(/*)S
(reply)210 2496 A
(goes)168 2748 A
(here)168 2958 A
3168(*/)S
5490 V
(24341)210 648 A
5580 V
(24342)210 648 A
1110(/*)S
(Acquire)294 1236 A
(two)126 1572 A
(file)168 1740 A
(descriptors.)504 1950 A
2496(*/)S
5670 V
(24343)210 648 A
(rfp)126 1110 A
1278(=)S
(fp;)126 1362 A
5760 V
(24344)210 648 A
1110(if)S
1236(\()S
1320(\(r)S
1446(=)S
(get_fd\(0,)378 1530 A
(R_BIT,)252 1950 A
(&fil_des[0],)504 2244 A
(&fil_ptr0\)\))462 2790 A
3294(!=)S
(OK\))126 3420 A
(return\(r\);)420 3588 A
5850 V
(24345)210 648 A
(rfp->fp_filp[fil_des[0]])1008 1110 A
2160(=)S
(fil_ptr0;)378 2244 A
5940 V
(24346)210 648 A
(fil_ptr0->filp_count)840 1110 A
1992(=)S
2076(1;)S
6030 V
(24347)210 648 A
1110(if)S
1236(\()S
1320(\(r)S
1446(=)S
(get_fd\(0,)378 1530 A
(W_BIT,)252 1950 A
(&fil_des[1],)504 2244 A
(&fil_ptr1\)\))462 2790 A
3294(!=)S
(OK\))126 3420 A
3588({)S
6120 V
(24348)210 648 A
(rfp->fp_filp[fil_des[0]])1008 1362 A
2412(=)S
(NIL_FILP;)378 2496 A
6210 V
(24349)210 648 A
(fil_ptr0->filp_count)840 1362 A
2244(=)S
2328(0;)S
8418 V
EP
%%Page: 335 335
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2151(File:)S
2384(src/fs/pipe.c)S
12 B
(335)180 4248 A
900 V
7 LST
(24350)210 648 A
(return\(r\);)420 1362 A
990 V
(24351)210 648 A
1110(})S
1080 V
(24352)210 648 A
(rfp->fp_filp[fil_des[1]])1008 1110 A
2160(=)S
(fil_ptr1;)378 2244 A
1170 V
(24353)210 648 A
(fil_ptr1->filp_count)840 1110 A
1992(=)S
2076(1;)S
1260 V
(24354)210 648 A
1350 V
(24355)210 648 A
1110(/*)S
(Make)168 1236 A
(the)126 1446 A
(inode)210 1614 A
1866(on)S
(the)126 1992 A
(pipe)168 2160 A
(device.)294 2370 A
2706(*/)S
1440 V
(24356)210 648 A
1110(if)S
1236(\()S
(\(rip)168 1320 A
1530(=)S
(alloc_inode\(PIPE_DEV,)882 1614 A
(I_REGULAR\))420 2538 A
3000(\))S
3084(==)S
(NIL_INODE\))420 3210 A
3672({)S
1530 V
(24357)210 648 A
(rfp->fp_filp[fil_des[0]])1008 1362 A
2412(=)S
(NIL_FILP;)378 2496 A
1620 V
(24358)210 648 A
(fil_ptr0->filp_count)840 1362 A
2244(=)S
2328(0;)S
1710 V
(24359)210 648 A
(rfp->fp_filp[fil_des[1]])1008 1362 A
2412(=)S
(NIL_FILP;)378 2496 A
1800 V
(24360)210 648 A
(fil_ptr1->filp_count)840 1362 A
2244(=)S
2328(0;)S
1890 V
(24361)210 648 A
(return\(err_code\);)714 1362 A
1980 V
(24362)210 648 A
1110(})S
2070 V
(24363)210 648 A
2160 V
(24364)210 648 A
1110(if)S
(\(read_only\(rip\))630 1236 A
1908(!=)S
(OK\))126 2034 A
(panic\("pipe)462 2202 A
(device)252 2706 A
3000(is)S
(read)168 3126 A
(only",)252 3336 A
(NO_NUM\);)336 3630 A
2250 V
(24365)210 648 A
2340 V
(24366)210 648 A
(rip->i_pipe)462 1110 A
1614(=)S
(I_PIPE;)294 1698 A
2430 V
(24367)210 648 A
(rip->i_mode)462 1110 A
1614(&=)S
(\304I_REGULAR;)462 1740 A
2520 V
(24368)210 648 A
(rip->i_mode)462 1110 A
1614(|=)S
(I_NAMED_PIPE;)546 1740 A
2370(/*)S
(pipes)210 2496 A
(and)126 2748 A
(FIFOs)210 2916 A
(have)168 3168 A
(this)168 3378 A
(bit)126 3588 A
(set)126 3756 A
3924(*/)S
2610 V
(24369)210 648 A
(fil_ptr0->filp_ino)756 1110 A
1908(=)S
(rip;)168 1992 A
2700 V
(24370)210 648 A
(fil_ptr0->filp_flags)840 1110 A
1992(=)S
(O_RDONLY;)378 2076 A
2790 V
(24371)210 648 A
(dup_inode\(rip\);)630 1110 A
2370(/*)S
(for)126 2496 A
(double)252 2664 A
(usage)210 2958 A
3210(*/)S
2880 V
(24372)210 648 A
(fil_ptr1->filp_ino)756 1110 A
1908(=)S
(rip;)168 1992 A
2970 V
(24373)210 648 A
(fil_ptr1->filp_flags)840 1110 A
1992(=)S
(O_WRONLY;)378 2076 A
3060 V
(24374)210 648 A
(rw_inode\(rip,)546 1110 A
(WRITING\);)378 1698 A
2370(/*)S
(mark)168 2496 A
(inode)210 2706 A
2958(as)S
(allocated)378 3084 A
3504(*/)S
3150 V
(24375)210 648 A
(reply_i1)336 1110 A
1488(=)S
(fil_des[0];)462 1572 A
3240 V
(24376)210 648 A
(reply_i2)336 1110 A
1488(=)S
(fil_des[1];)462 1572 A
3330 V
(24377)210 648 A
(rip->i_update)546 1110 A
1698(=)S
(ATIME)210 1782 A
2034(|)S
(CTIME)210 2118 A
2370(|)S
(MTIME;)252 2454 A
3420 V
(24378)210 648 A
(return\(OK\);)462 1110 A
3510 V
(24379)210 648 A
1026(})S
3780 V
(24382)210 648 A
(/*===========================================================================*)3276 1026 A
3870 V
(24383)210 648 A
1068(*)S
(pipe_check)420 2370 A
4260(*)S
3960 V
(24384)210 648 A
(*===========================================================================*/)3276 1068 A
4050 V
(24385)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(pipe_check\(rip,)630 1488 A
(rw_flag,)336 2160 A
(oflags,)294 2538 A
(bytes,)252 2874 A
(position,)378 3168 A
(canwrite\))378 3588 A
4140 V
(24386)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(the)126 2496 A
(inode)210 2664 A
2916(of)S
(the)126 3042 A
(pipe)168 3210 A
3420(*/)S
4230 V
(24387)210 648 A
(int)126 1026 A
(rw_flag;)336 1194 A
2370(/*)S
(READING)294 2496 A
2832(or)S
(WRITING)294 2958 A
3294(*/)S
4320 V
(24388)210 648 A
(int)126 1026 A
(oflags;)294 1194 A
2370(/*)S
(flags)210 2496 A
(set)126 2748 A
2916(by)S
(open)168 3042 A
3252(or)S
(fcntl)210 3378 A
3630(*/)S
4410 V
(24389)210 648 A
(register)336 1026 A
(int)126 1404 A
(bytes;)252 1572 A
2370(/*)S
(bytes)210 2496 A
2748(to)S
2874(be)S
(read)168 3000 A
3210(or)S
(written)294 3336 A
(\(all)168 3672 A
(chunks\))294 3882 A
4218(*/)S
4500 V
(24390)210 648 A
(register)336 1026 A
(off_t)210 1404 A
(position;)378 1656 A
2370(/*)S
(current)294 2496 A
(file)168 2832 A
(position)336 3042 A
3420(*/)S
4590 V
(24391)210 648 A
(int)126 1026 A
(*canwrite;)420 1194 A
2370(/*)S
(return:)294 2496 A
(number)252 2832 A
3126(of)S
(bytes)210 3252 A
3504(we)S
(can)126 3630 A
(write)210 3798 A
4050(*/)S
4680 V
(24392)210 648 A
1026({)S
4770 V
(24393)210 648 A
1026(/*)S
(Pipes)210 1152 A
(are)126 1404 A
1572(a)S
(little)252 1656 A
(different.)420 1950 A
2454(If)S
2580(a)S
(process)294 2664 A
(reads)210 3000 A
(from)168 3252 A
3462(an)S
(empty)210 3588 A
(pipe)168 3840 A
(for)126 4050 A
4860 V
(24394)210 648 A
1068(*)S
(which)210 1152 A
1404(a)S
(writer)252 1488 A
(still)210 1782 A
(exists,)294 2034 A
(suspend)294 2370 A
(the)126 2706 A
(reader.)294 2874 A
3252(If)S
(the)126 3378 A
(pipe)168 3546 A
3756(is)S
(empty)210 3882 A
4950 V
(24395)210 648 A
1068(*)S
(and)126 1152 A
(there)210 1320 A
1572(is)S
1698(no)S
(writer,)294 1824 A
(return)252 2160 A
2454(0)S
(bytes.)252 2538 A
2874(If)S
3000(a)S
(process)294 3084 A
3420(is)S
(writing)294 3546 A
3882(to)S
4008(a)S
5040 V
(24396)210 648 A
1068(*)S
(pipe)168 1152 A
(and)126 1362 A
1530(no)S
(one)126 1656 A
1824(is)S
(reading)294 1950 A
(from)168 2286 A
(it,)126 2496 A
(give)168 2664 A
2874(a)S
(broken)252 2958 A
(pipe)168 3252 A
(error.)252 3462 A
5130 V
(24397)210 648 A
1068(*/)S
5220 V
(24398)210 648 A
5310 V
(24399)210 648 A
(int)126 1110 A
1278(r)S
1362(=)S
1446(0;)S
5400 V
(24400)210 648 A
5490 V
(24401)210 648 A
1110(/*)S
1236(If)S
(reading,)336 1362 A
(check)210 1740 A
(for)126 1992 A
(empty)210 2160 A
(pipe.)210 2412 A
2664(*/)S
5580 V
(24402)210 648 A
1110(if)S
(\(rw_flag)336 1236 A
1614(==)S
(READING\))336 1740 A
2118({)S
5670 V
(24403)210 648 A
1362(if)S
(\(position)378 1488 A
1908(>=)S
(rip->i_size\))504 2034 A
2580({)S
5760 V
(24404)210 648 A
1698(/*)S
(Process)294 1824 A
2160(is)S
(reading)294 2286 A
(from)168 2622 A
2832(an)S
(empty)210 2958 A
(pipe.)210 3210 A
3462(*/)S
5850 V
(24405)210 648 A
1698(if)S
(\(find_filp\(rip,)630 1824 A
(W_BIT\))252 2496 A
2790(!=)S
(NIL_FILP\))378 2916 A
3336({)S
5940 V
(24406)210 648 A
2034(/*)S
(Writer)252 2160 A
(exists)252 2454 A
2748(*/)S
6030 V
(24407)210 648 A
2034(if)S
(\(oflags)294 2160 A
2496(&)S
(O_NONBLOCK\))462 2580 A
6120 V
(24408)210 648 A
2370(r)S
2454(=)S
(EAGAIN;)294 2538 A
6210 V
(24409)210 648 A
(else)168 2034 A
8418 V
EP
%%Page: 336 336
BP
/slant 0 def
/height 0 def
630 V
12 B
(336)180 648 A
11 R
2151(File:)S
2384(src/fs/pipe.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(24410)210 648 A
(suspend\(XPIPE\);)630 2370 A
3042(/*)S
(block)210 3168 A
(reader)252 3420 A
3714(*/)S
990 V
(24411)210 648 A
1080 V
(24412)210 648 A
2034(/*)S
2160(If)S
(need)168 2286 A
(be,)126 2496 A
(activate)336 2664 A
(sleeping)336 3042 A
(writers.)336 3420 A
3798(*/)S
1170 V
(24413)210 648 A
2034(if)S
(\(susp_count)462 2160 A
2664(>)S
2748(0\))S
(release\(rip,)504 2874 A
(WRITE,)252 3420 A
(susp_count\);)504 3714 A
1260 V
(24414)210 648 A
1698(})S
1350 V
(24415)210 648 A
(return\(r\);)420 1698 A
1440 V
(24416)210 648 A
1362(})S
1530 V
(24417)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1620 V
(24418)210 648 A
1362(/*)S
(Process)294 1488 A
1824(is)S
(writing)294 1950 A
2286(to)S
2412(a)S
(pipe.)210 2496 A
2748(*/)S
1710 V
(24419)210 648 A
1026(/*)S
1362(if)S
(\(bytes)252 1488 A
1782(>)S
(PIPE_SIZE\))420 1866 A
(return\(EFBIG\);)588 2328 A
2958(*/)S
1800 V
(24420)210 648 A
1362(if)S
(\(find_filp\(rip,)630 1488 A
(R_BIT\))252 2160 A
2454(==)S
(NIL_FILP\))378 2580 A
3000({)S
1890 V
(24421)210 648 A
1698(/*)S
(Tell)168 1824 A
(kernel)252 2034 A
2328(to)S
(generate)336 2454 A
2832(a)S
(SIGPIPE)294 2916 A
(signal.)294 3252 A
3588(*/)S
1980 V
(24422)210 648 A
(sys_kill\(\(int\)\(fp)714 1698 A
2454(-)S
(fproc\),)294 2538 A
(SIGPIPE\);)378 2874 A
2070 V
(24423)210 648 A
(return\(EPIPE\);)588 1698 A
2160 V
(24424)210 648 A
1362(})S
2250 V
(24425)210 648 A
2340 V
(24426)210 648 A
1362(if)S
(\(position)378 1488 A
1908(+)S
(bytes)210 1992 A
2244(>)S
(PIPE_SIZE\))420 2328 A
2790({)S
2430 V
(24427)210 648 A
1698(if)S
(\(\(oflags)336 1824 A
2202(&)S
(O_NONBLOCK\))462 2286 A
2790(&&)S
(bytes)210 2916 A
3168(<)S
(PIPE_SIZE\))420 3252 A
2520 V
(24428)210 648 A
(return\(EAGAIN\);)630 2034 A
2610 V
(24429)210 648 A
(else)168 1698 A
1908(if)S
(\(\(oflags)336 2034 A
2412(&)S
(O_NONBLOCK\))462 2496 A
3000(&&)S
(bytes)210 3126 A
3378(>)S
(PIPE_SIZE\))420 3462 A
3924({)S
2700 V
(24430)210 648 A
2034(if)S
2160(\()S
(\(*canwrite)420 2244 A
2706(=)S
(\(PIPE_SIZE)420 2790 A
3252(-)S
(position\)\))420 3336 A
3798(>)S
3882(0\))S
4050({)S
2790 V
(24431)210 648 A
2370(/*)S
2496(Do)S
2622(a)S
(partial)294 2706 A
(write.)252 3042 A
(Need)168 3336 A
3546(to)S
(wakeup)252 3672 A
(reader)252 3966 A
4260(*/)S
2880 V
(24432)210 648 A
(release\(rip,)504 2370 A
(READ,)210 2916 A
(susp_count\);)504 3168 A
2970 V
(24433)210 648 A
(return\(1\);)420 2370 A
3060 V
(24434)210 648 A
2034(})S
(else)168 2118 A
2328({)S
3150 V
(24435)210 648 A
(return\(EAGAIN\);)630 2370 A
3240 V
(24436)210 648 A
2034(})S
3330 V
(24437)210 648 A
1908(})S
3420 V
(24438)210 648 A
1698(if)S
(\(bytes)252 1824 A
2118(>)S
(PIPE_SIZE\))420 2202 A
2664({)S
3510 V
(24439)210 648 A
2034(if)S
(\(\(*canwrite)462 2160 A
2664(=)S
(PIPE_SIZE)378 2748 A
3168(-)S
(position\))378 3252 A
3672(>)S
3756(0\))S
3882({)S
3600 V
(24440)210 648 A
2370(/*)S
2496(Do)S
2622(a)S
(partial)294 2706 A
(write.)252 3042 A
(Need)168 3336 A
3546(to)S
(wakeup)252 3672 A
(reader)252 3966 A
3690 V
(24441)210 648 A
2412(*)S
(since)210 2496 A
(we'll)210 2748 A
(suspend)294 3000 A
(ourself)294 3336 A
3672(in)S
(read_write\(\))504 3798 A
3780 V
(24442)210 648 A
2412(*/)S
3870 V
(24443)210 648 A
(release\(rip,)504 2370 A
(READ,)210 2916 A
(susp_count\);)504 3168 A
3960 V
(24444)210 648 A
(return\(1\);)420 2370 A
4050 V
(24445)210 648 A
2034(})S
4140 V
(24446)210 648 A
1698(})S
4230 V
(24447)210 648 A
(suspend\(XPIPE\);)630 1698 A
2370(/*)S
(stop)168 2496 A
(writer)252 2706 A
3000(--)S
(pipe)168 3126 A
(full)168 3336 A
3546(*/)S
4320 V
(24448)210 648 A
(return\(0\);)420 1698 A
4410 V
(24449)210 648 A
1362(})S
4500 V
(24450)210 648 A
4590 V
(24451)210 648 A
1362(/*)S
(Writing)294 1488 A
1824(to)S
1950(an)S
(empty)210 2076 A
(pipe.)210 2328 A
(Search)252 2622 A
(for)126 2916 A
(suspended)378 3084 A
(reader.)294 3504 A
3840(*/)S
4680 V
(24452)210 648 A
1362(if)S
(\(position)378 1488 A
1908(==)S
2034(0\))S
(release\(rip,)504 2160 A
(READ,)210 2706 A
(susp_count\);)504 2958 A
4770 V
(24453)210 648 A
1110(})S
4860 V
(24454)210 648 A
4950 V
(24455)210 648 A
(*canwrite)378 1110 A
1530(=)S
1614(0;)S
5040 V
(24456)210 648 A
(return\(1\);)420 1110 A
5130 V
(24457)210 648 A
1026(})S
5400 V
(24460)210 648 A
(/*===========================================================================*)3276 1026 A
5490 V
(24461)210 648 A
1068(*)S
(suspend)294 2370 A
4260(*)S
5580 V
(24462)210 648 A
(*===========================================================================*/)3276 1068 A
5670 V
(24463)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(suspend\(task\))546 1530 A
5760 V
(24464)210 648 A
(int)126 1026 A
(task;)210 1194 A
2370(/*)S
(who)126 2496 A
2664(is)S
(proc)168 2790 A
(waiting)294 3000 A
(for?)168 3336 A
(\(PIPE)210 3546 A
3798(=)S
(pipe\))210 3882 A
4134(*/)S
5850 V
(24465)210 648 A
1026({)S
5940 V
(24466)210 648 A
1026(/*)S
(Take)168 1152 A
(measures)336 1362 A
1740(to)S
(suspend)294 1866 A
(the)126 2202 A
(processing)420 2370 A
2832(of)S
(the)126 2958 A
(present)294 3126 A
(system)252 3462 A
(call.)210 3756 A
6030 V
(24467)210 648 A
1068(*)S
(Store)210 1152 A
(the)126 1404 A
(parameters)420 1572 A
2034(to)S
2160(be)S
(used)168 2286 A
(upon)168 2496 A
(resuming)336 2706 A
3084(in)S
(the)126 3210 A
(process)294 3378 A
(table.)252 3714 A
6120 V
(24468)210 648 A
1068(*)S
(\(Actually)378 1152 A
(they)168 1572 A
(are)126 1782 A
(not)126 1950 A
(used)168 2118 A
(when)168 2328 A
2538(a)S
(process)294 2622 A
2958(is)S
(waiting)294 3084 A
(for)126 3420 A
3588(an)S
(I/O)126 3714 A
(device,)294 3882 A
6210 V
(24469)210 648 A
1068(*)S
(but)126 1152 A
(they)168 1320 A
(are)126 1530 A
(needed)252 1698 A
(for)126 1992 A
(pipes,)252 2160 A
(and)126 2454 A
2622(it)S
2748(is)S
(not)126 2874 A
(worth)210 3042 A
(making)252 3294 A
(the)126 3588 A
(distinction.\))546 3756 A
8418 V
EP
%%Page: 337 337
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2151(File:)S
2384(src/fs/pipe.c)S
12 B
(337)180 4248 A
900 V
7 LST
(24470)210 648 A
1068(*/)S
990 V
(24471)210 648 A
1080 V
(24472)210 648 A
1110(if)S
(\(task)210 1236 A
1488(==)S
(XPIPE)210 1614 A
1866(||)S
(task)168 1992 A
2202(==)S
(XPOPEN\))294 2328 A
(susp_count++;/*)630 2664 A
(#procs)252 3336 A
(susp'ed)294 3630 A
3966(on)S
(pipe*/)252 4092 A
1170 V
(24473)210 648 A
(fp->fp_suspended)672 1110 A
1824(=)S
(SUSPENDED;)420 1908 A
1260 V
(24474)210 648 A
(fp->fp_fd)378 1110 A
1530(=)S
1614(fd)S
1740(<<)S
1866(8)S
1950(|)S
(fs_call;)336 2034 A
1350 V
(24475)210 648 A
(fp->fp_task)462 1110 A
1614(=)S
(-task;)252 1698 A
1440 V
(24476)210 648 A
1110(if)S
(\(task)210 1236 A
1488(==)S
(XLOCK\))252 1614 A
1908({)S
1530 V
(24477)210 648 A
(fp->fp_buffer)546 1362 A
1950(=)S
(\(char)210 2034 A
2286(*\))S
(name1;)252 2412 A
2706(/*)S
(third)210 2874 A
(arg)126 3126 A
3294(to)S
(fcntl\(\))294 3420 A
3756(*/)S
1620 V
(24478)210 648 A
(fp->fp_nbytes)546 1362 A
(=request;)378 1950 A
2706(/*)S
(second)252 2832 A
(arg)126 3126 A
3294(to)S
(fcntl\(\))294 3420 A
3756(*/)S
1710 V
(24479)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1800 V
(24480)210 648 A
(fp->fp_buffer)546 1362 A
1950(=)S
(buffer;)294 2034 A
2706(/*)S
(for)126 2832 A
(reads)210 3000 A
(and)126 3252 A
(writes)252 3420 A
3714(*/)S
1890 V
(24481)210 648 A
(fp->fp_nbytes)546 1362 A
1950(=)S
(nbytes;)294 2034 A
1980 V
(24482)210 648 A
1110(})S
2070 V
(24483)210 648 A
(dont_reply)420 1110 A
1572(=)S
(TRUE;)210 1656 A
2370(/*)S
2496(do)S
(not)126 2622 A
(send)168 2790 A
(caller)252 3000 A
3294(a)S
(reply)210 3378 A
(message)294 3630 A
(now)126 3966 A
4134(*/)S
2160 V
(24484)210 648 A
1026(})S
2430 V
(24487)210 648 A
(/*===========================================================================*)3276 1026 A
2520 V
(24488)210 648 A
1068(*)S
(release)294 2370 A
4260(*)S
2610 V
(24489)210 648 A
(*===========================================================================*/)3276 1068 A
2700 V
(24490)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(release\(ip,)462 1530 A
(call_nr,)336 2034 A
(count\))252 2412 A
2790 V
(24491)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*ip;)168 1950 A
2370(/*)S
(inode)210 2496 A
2748(of)S
(pipe)168 2874 A
3084(*/)S
2880 V
(24492)210 648 A
(int)126 1026 A
(call_nr;)336 1194 A
2370(/*)S
(READ,)210 2496 A
(WRITE,)252 2748 A
(OPEN)168 3042 A
3252(or)S
(CREAT)210 3378 A
3630(*/)S
2970 V
(24493)210 648 A
(int)126 1026 A
(count;)252 1194 A
2370(/*)S
(max)126 2496 A
(number)252 2664 A
2958(of)S
(processes)378 3084 A
3504(to)S
(release)294 3630 A
3966(*/)S
3060 V
(24494)210 648 A
1026({)S
3150 V
(24495)210 648 A
1026(/*)S
(Check)210 1152 A
1404(to)S
(see)126 1530 A
1698(if)S
(any)126 1824 A
(process)294 1992 A
2328(is)S
(hanging)294 2454 A
2790(on)S
(the)126 2916 A
(pipe)168 3084 A
(whose)210 3294 A
(inode)210 3546 A
3798(is)S
3924(in)S
('ip'.)210 4050 A
3240 V
(24496)210 648 A
1068(*)S
1152(If)S
(one)126 1278 A
(is,)126 1446 A
(and)126 1614 A
1782(it)S
(was)126 1908 A
(trying)252 2076 A
2370(to)S
(perform)294 2496 A
(the)126 2832 A
(call)168 3000 A
(indicated)378 3210 A
3630(by)S
('call_nr',)420 3756 A
3330 V
(24497)210 648 A
1068(*)S
(release)294 1152 A
(it.)126 1488 A
3420 V
(24498)210 648 A
1068(*/)S
3510 V
(24499)210 648 A
3600 V
(24500)210 648 A
(register)336 1110 A
(struct)252 1488 A
(fproc)210 1782 A
(*rp;)168 2034 A
3690 V
(24501)210 648 A
3780 V
(24502)210 648 A
1110(/*)S
(Search)252 1236 A
(the)126 1530 A
(proc)168 1698 A
(table.)252 1908 A
2202(*/)S
3870 V
(24503)210 648 A
(for)126 1110 A
(\(rp)126 1278 A
1446(=)S
(&fproc[0];)420 1530 A
1992(rp)S
2118(<)S
(&fproc[NR_PROCS];)714 2202 A
(rp++\))210 2958 A
3210({)S
3960 V
(24504)210 648 A
1362(if)S
(\(rp->fp_suspended)714 1488 A
2244(==)S
(SUSPENDED)378 2370 A
2790(&&)S
4050 V
(24505)210 648 A
(rp->fp_revived)588 2034 A
2664(==)S
(NOT_REVIVING)504 2790 A
3336(&&)S
4140 V
(24506)210 648 A
(\(rp->fp_fd)420 2034 A
2496(&)S
(BYTE\))210 2580 A
2832(==)S
(call_nr)294 2958 A
3294(&&)S
4230 V
(24507)210 648 A
(rp->fp_filp[rp->fp_fd>>8]->filp_ino)1470 2034 A
3546(==)S
(ip\))126 3672 A
3840({)S
4320 V
(24508)210 648 A
(revive\(\(int\)\(rp)630 1698 A
2370(-)S
(fproc\),)294 2454 A
(0\);)126 2790 A
4410 V
(24509)210 648 A
(susp_count--;)546 1698 A
2370(/*)S
(keep)168 2496 A
(track)210 2706 A
2958(of)S
(who)126 3084 A
3252(is)S
(suspended)378 3378 A
3798(*/)S
4500 V
(24510)210 648 A
1698(if)S
(\(--count)336 1824 A
2202(==)S
2328(0\))S
(return;)294 2454 A
4590 V
(24511)210 648 A
1362(})S
4680 V
(24512)210 648 A
1110(})S
4770 V
(24513)210 648 A
1026(})S
5040 V
(24516)210 648 A
(/*===========================================================================*)3276 1026 A
5130 V
(24517)210 648 A
1068(*)S
(revive)252 2370 A
4260(*)S
5220 V
(24518)210 648 A
(*===========================================================================*/)3276 1068 A
5310 V
(24519)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(revive\(proc_nr,)630 1530 A
(bytes\))252 2202 A
5400 V
(24520)210 648 A
(int)126 1026 A
(proc_nr;)336 1194 A
2370(/*)S
(process)294 2496 A
2832(to)S
(revive)252 2958 A
3252(*/)S
5490 V
(24521)210 648 A
(int)126 1026 A
(bytes;)252 1194 A
2370(/*)S
2496(if)S
(hanging)294 2622 A
2958(on)S
(task,)210 3084 A
(how)126 3336 A
(many)168 3504 A
(bytes)210 3714 A
(read)168 3966 A
4176(*/)S
5580 V
(24522)210 648 A
1026({)S
5670 V
(24523)210 648 A
1026(/*)S
(Revive)252 1152 A
1446(a)S
(previously)420 1530 A
(blocked)294 1992 A
(process.)336 2328 A
(When)168 2706 A
2916(a)S
(process)294 3000 A
(hangs)210 3336 A
3588(on)S
(tty,)168 3714 A
(this)168 3924 A
5760 V
(24524)210 648 A
1068(*)S
1152(is)S
(the)126 1278 A
(way)126 1446 A
1614(it)S
1740(is)S
(eventually)420 1866 A
(released.)378 2328 A
5850 V
(24525)210 648 A
1068(*/)S
5940 V
(24526)210 648 A
6030 V
(24527)210 648 A
(register)336 1110 A
(struct)252 1488 A
(fproc)210 1782 A
(*rfp;)210 2034 A
6120 V
(24528)210 648 A
(register)336 1110 A
(int)126 1488 A
(task;)210 1656 A
6210 V
(24529)210 648 A
8418 V
EP
%%Page: 338 338
BP
/slant 0 def
/height 0 def
630 V
12 B
(338)180 648 A
11 R
2151(File:)S
2384(src/fs/pipe.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(24530)210 648 A
1110(if)S
(\(proc_nr)336 1236 A
1614(<)S
1698(0)S
1782(||)S
(proc_nr)294 1908 A
2244(>=)S
(NR_PROCS\))378 2370 A
(panic\("revive)546 2790 A
(err",)210 3378 A
(proc_nr\);)378 3630 A
990 V
(24531)210 648 A
(rfp)126 1110 A
1278(=)S
(&fproc[proc_nr];)672 1362 A
1080 V
(24532)210 648 A
1110(if)S
(\(rfp->fp_suspended)756 1236 A
2034(==)S
(NOT_SUSPENDED)546 2160 A
2748(||)S
(rfp->fp_revived)630 2874 A
3546(==)S
(REVIVING\)return;)672 3672 A
1170 V
(24533)210 648 A
1260 V
(24534)210 648 A
1110(/*)S
(The)126 1236 A
('reviving')420 1404 A
(flag)168 1866 A
(only)168 2076 A
(applies)294 2286 A
2622(to)S
(pipes.)252 2748 A
(Processes)378 3084 A
(waiting)294 3504 A
(for)126 3840 A
(TTY)126 4008 A
(get)126 4176 A
1350 V
(24535)210 648 A
1152(*)S
1236(a)S
(message)294 1320 A
(right)210 1656 A
(away.)210 1908 A
(The)126 2202 A
(revival)294 2370 A
(process)294 2706 A
3042(is)S
(different)378 3168 A
(for)126 3588 A
(TTY)126 3756 A
(and)126 3924 A
(pipes.)252 4092 A
1440 V
(24536)210 648 A
1152(*)S
(For)126 1236 A
(TTY)126 1404 A
(revival,)336 1572 A
(the)126 1950 A
(work)168 2118 A
2328(is)S
(already)294 2454 A
(done,)210 2790 A
(for)126 3042 A
(pipes)210 3210 A
3462(it)S
3588(is)S
(not:)168 3714 A
(the)126 3924 A
(proc)168 4092 A
1530 V
(24537)210 648 A
1152(*)S
(must)168 1236 A
1446(be)S
(restarted)378 1572 A
1992(so)S
2118(it)S
(can)126 2244 A
(try)126 2412 A
(again.)252 2580 A
1620 V
(24538)210 648 A
1152(*/)S
1710 V
(24539)210 648 A
(task)168 1110 A
1320(=)S
(-rfp->fp_task;)588 1404 A
1800 V
(24540)210 648 A
1110(if)S
(\(task)210 1236 A
1488(==)S
(XPIPE)210 1614 A
1866(||)S
(task)168 1992 A
2202(==)S
(XLOCK\))252 2328 A
2622({)S
1890 V
(24541)210 648 A
1362(/*)S
(Revive)252 1488 A
1782(a)S
(process)294 1866 A
(suspended)378 2202 A
2622(on)S
2748(a)S
(pipe)168 2832 A
3042(or)S
(lock.)210 3168 A
3420(*/)S
1980 V
(24542)210 648 A
(rfp->fp_revived)630 1362 A
2034(=)S
(REVIVING;)378 2118 A
2070 V
(24543)210 648 A
(reviving++;)462 1362 A
2370(/*)S
(process)294 2496 A
(was)126 2832 A
(waiting)294 3000 A
3336(on)S
(pipe)168 3462 A
3672(or)S
(lock)168 3798 A
4008(*/)S
2160 V
(24544)210 648 A
1110(})S
(else)168 1194 A
1404({)S
2250 V
(24545)210 648 A
(rfp->fp_suspended)714 1362 A
2118(=)S
(NOT_SUSPENDED;)588 2202 A
2340 V
(24546)210 648 A
1362(if)S
(\(task)210 1488 A
1740(==)S
(XPOPEN\))294 1866 A
2202(/*)S
(process)294 2328 A
(blocked)294 2664 A
3000(in)S
(open)168 3126 A
3336(or)S
(create)252 3462 A
3756(*/)S
2430 V
(24547)210 648 A
(reply\(proc_nr,)588 1698 A
(rfp->fp_fd>>8\);)630 2328 A
2520 V
(24548)210 648 A
(else)168 1362 A
1572({)S
2610 V
(24549)210 648 A
1698(/*)S
(Revive)252 1824 A
2118(a)S
(process)294 2202 A
(suspended)378 2538 A
2958(on)S
(TTY)126 3084 A
3252(or)S
(other)210 3378 A
(device.)294 3630 A
3966(*/)S
2700 V
(24550)210 648 A
(rfp->fp_nbytes)588 1698 A
2328(=)S
(bytes;)252 2412 A
(/*pretend)378 2706 A
3126(it)S
(wants)210 3252 A
(only)168 3504 A
(what)168 3714 A
(there)210 3924 A
(is*/)168 4176 A
2790 V
(24551)210 648 A
(reply\(proc_nr,)588 1698 A
(bytes\);)294 2328 A
2706(/*)S
(unblock)294 2832 A
(the)126 3168 A
(process)294 3336 A
3672(*/)S
2880 V
(24552)210 648 A
1362(})S
2970 V
(24553)210 648 A
1110(})S
3060 V
(24554)210 648 A
1026(})S
3330 V
(24557)210 648 A
(/*===========================================================================*)3276 1026 A
3420 V
(24558)210 648 A
1068(*)S
(do_unpause)420 2370 A
4260(*)S
3510 V
(24559)210 648 A
(*===========================================================================*/)3276 1068 A
3600 V
(24560)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_unpause\(\))504 1488 A
3690 V
(24561)210 648 A
1026({)S
3780 V
(24562)210 648 A
1026(/*)S
1152(A)S
(signal)252 1236 A
(has)126 1530 A
(been)168 1698 A
(sent)168 1908 A
2118(to)S
2244(a)S
(user)168 2328 A
(who)126 2538 A
2706(is)S
(paused)252 2832 A
3126(on)S
(the)126 3252 A
(file)168 3420 A
(system.)294 3630 A
3870 V
(24563)210 648 A
1068(*)S
(Abort)210 1152 A
(the)126 1404 A
(system)252 1572 A
(call)168 1866 A
(with)168 2076 A
(the)126 2286 A
(EINTR)210 2454 A
(error)210 2706 A
(message.)336 2958 A
3960 V
(24564)210 648 A
1068(*/)S
4050 V
(24565)210 648 A
4140 V
(24566)210 648 A
(register)336 1110 A
(struct)252 1488 A
(fproc)210 1782 A
(*rfp;)210 2034 A
4230 V
(24567)210 648 A
(int)126 1110 A
(proc_nr,)336 1278 A
(task,)210 1656 A
(fild;)210 1908 A
4320 V
(24568)210 648 A
(struct)252 1110 A
(filp)168 1404 A
(*f;)126 1614 A
4410 V
(24569)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
4500 V
(24570)210 648 A
4590 V
(24571)210 648 A
1110(if)S
(\(who)168 1236 A
1446(>)S
(MM_PROC_NR\))462 1530 A
(return\(EPERM\);)588 2034 A
4680 V
(24572)210 648 A
(proc_nr)294 1110 A
1446(=)S
(pro;)168 1530 A
4770 V
(24573)210 648 A
1110(if)S
(\(proc_nr)336 1236 A
1614(<)S
1698(0)S
1782(||)S
(proc_nr)294 1908 A
2244(>=)S
(NR_PROCS\))378 2370 A
(panic\("unpause)588 2790 A
(err)126 3420 A
(1",)126 3588 A
(proc_nr\);)378 3756 A
4860 V
(24574)210 648 A
(rfp)126 1110 A
1278(=)S
(&fproc[proc_nr];)672 1362 A
4950 V
(24575)210 648 A
1110(if)S
(\(rfp->fp_suspended)756 1236 A
2034(==)S
(NOT_SUSPENDED\))588 2160 A
(return\(OK\);)462 2790 A
5040 V
(24576)210 648 A
(task)168 1110 A
1320(=)S
(-rfp->fp_task;)588 1404 A
5130 V
(24577)210 648 A
5220 V
(24578)210 648 A
(switch\(task\))504 1110 A
1656({)S
5310 V
(24579)210 648 A
(case)168 1362 A
(XPIPE:)252 1572 A
2370(/*)S
(process)294 2496 A
(trying)252 2832 A
3126(to)S
(read)168 3252 A
3462(or)S
(write)210 3588 A
3840(a)S
(pipe)168 3924 A
4134(*/)S
5400 V
(24580)210 648 A
(break;)252 1698 A
5490 V
(24581)210 648 A
5580 V
(24582)210 648 A
(case)168 1362 A
(XOPEN:)252 1572 A
2370(/*)S
(process)294 2496 A
(trying)252 2832 A
3126(to)S
(open)168 3252 A
3462(a)S
(special)294 3546 A
(file)168 3882 A
4092(*/)S
5670 V
(24583)210 648 A
(panic)210 1698 A
(\("fs/do_unpause)630 1950 A
(called)252 2622 A
(with)168 2916 A
(XOPEN\\n",)378 3126 A
(NO_NUM\);)336 3546 A
5760 V
(24584)210 648 A
5850 V
(24585)210 648 A
(case)168 1362 A
(XLOCK:)252 1572 A
2370(/*)S
(process)294 2496 A
(trying)252 2832 A
3126(to)S
(set)126 3252 A
3420(a)S
(lock)168 3504 A
(with)168 3714 A
(FCNTL)210 3924 A
4176(*/)S
5940 V
(24586)210 648 A
(break;)252 1698 A
6030 V
(24587)210 648 A
6120 V
(24588)210 648 A
(case)168 1362 A
(XPOPEN:)294 1572 A
2370(/*)S
(process)294 2496 A
(trying)252 2832 A
3126(to)S
(open)168 3252 A
3462(a)S
(fifo)168 3546 A
3756(*/)S
6210 V
(24589)210 648 A
(break;)252 1698 A
8418 V
EP
%%Page: 339 339
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2151(File:)S
2384(src/fs/pipe.c)S
12 B
(339)180 4248 A
900 V
7 LST
(24590)210 648 A
990 V
(24591)210 648 A
(default:)336 1362 A
2370(/*)S
(process)294 2496 A
(trying)252 2832 A
3126(to)S
3252(do)S
(device)252 3378 A
(I/O)126 3672 A
(\(e.g.)210 3840 A
(tty\)*/)252 4092 A
1080 V
(24592)210 648 A
(fild)168 1698 A
1908(=)S
(\(rfp->fp_fd)462 1992 A
2496(>>)S
2622(8\))S
2748(&)S
(BYTE;/*)294 2832 A
(extract)294 3168 A
(file)168 3504 A
(descriptor)420 3714 A
4176(*/)S
1170 V
(24593)210 648 A
1698(if)S
(\(fild)210 1824 A
2076(<)S
2160(0)S
2244(||)S
(fild)168 2370 A
2580(>=)S
(OPEN_MAX\)panic\("unpause)966 2706 A
(err)126 3714 A
(2",NO_NUM\);)462 3882 A
1260 V
(24594)210 648 A
1698(f)S
1782(=)S
(rfp->fp_filp[fild];)798 1866 A
1350 V
(24595)210 648 A
(dev)126 1698 A
1866(=)S
(\(dev_t\))294 1950 A
(f->filp_ino->i_zone[0];)966 2286 A
3378(/*)S
(device)252 3504 A
(hung)168 3798 A
4008(on)S
4134(*/)S
1440 V
(24596)210 648 A
(mess.TTY_LINE)546 1698 A
2286(=)S
(\(dev)168 2370 A
2580(>>)S
(MINOR\))252 2706 A
3000(&)S
(BYTE;)210 3084 A
1530 V
(24597)210 648 A
(mess.PROC_NR)504 1698 A
2244(=)S
(proc_nr;)336 2328 A
1620 V
(24598)210 648 A
1710 V
(24599)210 648 A
1698(/*)S
(Tell)168 1824 A
(kernel)252 2034 A
2328(R)S
2412(or)S
2538(W.)S
(Mode)168 2664 A
2874(is)S
(from)168 3000 A
(current)294 3210 A
(call,)210 3546 A
(not)126 3798 A
(open.)210 3966 A
4218(*/)S
1800 V
(24600)210 648 A
(mess.COUNT)420 1698 A
2160(=)S
(\(rfp->fp_fd)462 2244 A
2748(&)S
(BYTE\))210 2832 A
3084(==)S
(READ)168 3210 A
3420(?)S
(R_BIT)210 3504 A
3756(:)S
(W_BIT;)252 3840 A
1890 V
(24601)210 648 A
(mess.m_type)462 1698 A
2202(=)S
(CANCEL;)294 2286 A
1980 V
(24602)210 648 A
1698(fp)S
1824(=)S
(rfp;)168 1908 A
2370(/*)S
(hack)168 2496 A
2706(-)S
(call_ctty)378 2790 A
(uses)168 3210 A
3420(fp)S
3546(*/)S
2070 V
(24603)210 648 A
(\(*dmap[\(dev)462 1698 A
2202(>>)S
(MAJOR\))252 2328 A
2622(&)S
(BYTE].dmap_rw\)\(task,)840 2706 A
(&mess\);)294 3588 A
2160 V
(24604)210 648 A
1110(})S
2250 V
(24605)210 648 A
2340 V
(24606)210 648 A
(rfp->fp_suspended)714 1110 A
1866(=)S
(NOT_SUSPENDED;)588 1950 A
2430 V
(24607)210 648 A
(reply\(proc_nr,)588 1110 A
(EINTR\);)294 1740 A
2370(/*)S
(signal)252 2496 A
(interrupted)462 2790 A
(call)168 3294 A
3504(*/)S
2520 V
(24608)210 648 A
(return\(OK\);)462 1110 A
2610 V
(24609)210 648 A
1026(})S
3240 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3330 V
(src/fs/path.c)546 2034 A
3420 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3600 V
(24700)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(procedures)420 2118 A
(that)168 2580 A
(look)168 2790 A
3000(up)S
(path)168 3126 A
(names)210 3336 A
3588(in)S
(the)126 3714 A
(directory)378 3882 A
3690 V
(24701)210 648 A
1068(*)S
(system)252 1152 A
(and)126 1446 A
(determine)378 1614 A
(the)126 2034 A
(inode)210 2202 A
(number)252 2454 A
(that)168 2748 A
(goes)168 2958 A
(with)168 3168 A
3378(a)S
(given)210 3462 A
(path)168 3714 A
(name.)210 3924 A
3780 V
(24702)210 648 A
1068(*)S
3870 V
(24703)210 648 A
1068(*)S
(The)126 1194 A
(entry)210 1362 A
(points)252 1614 A
(into)168 1908 A
(this)168 2118 A
(file)168 2328 A
(are)126 2538 A
3960 V
(24704)210 648 A
1068(*)S
(eat_path:)378 1236 A
(the)126 1740 A
('main')252 1908 A
(routine)294 2202 A
2538(of)S
(the)126 2664 A
(path-to-inode)546 2832 A
(conversion)420 3420 A
(mechanism)378 3882 A
4050 V
(24705)210 648 A
1068(*)S
(last_dir:)378 1236 A
(find)168 1740 A
(the)126 1950 A
(final)210 2118 A
(directory)378 2370 A
2790(on)S
2916(a)S
(given)210 3000 A
(path)168 3252 A
4140 V
(24706)210 648 A
1068(*)S
(advance:)336 1236 A
(parse)210 1740 A
(one)126 1992 A
(component)378 2160 A
2580(of)S
2706(a)S
(path)168 2790 A
(name)168 3000 A
4230 V
(24707)210 648 A
1068(*)S
(search_dir:)462 1236 A
(search)252 1740 A
2034(a)S
(directory)378 2118 A
(for)126 2538 A
2706(a)S
(string)252 2790 A
(and)126 3084 A
(return)252 3252 A
(its)126 3546 A
(inode)210 3714 A
(number)252 3966 A
4320 V
(24708)210 648 A
1068(*/)S
4410 V
(24709)210 648 A
4500 V
(24710)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
4590 V
(24711)210 648 A
(#include)336 1026 A
(<string.h>)420 1404 A
4680 V
(24712)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
4770 V
(24713)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
4860 V
(24714)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
4950 V
(24715)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
5040 V
(24716)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
5130 V
(24717)210 648 A
(#include)336 1026 A
("super.h")378 1404 A
5220 V
(24718)210 648 A
5310 V
(24719)210 648 A
(PUBLIC)252 1026 A
(char)168 1320 A
(dot1[2])294 1530 A
1866(=)S
(".";)168 1950 A
2370(/*)S
(used)168 2496 A
(for)126 2706 A
(search_dir)420 2874 A
3336(to)S
(bypass)252 3462 A
(the)126 3756 A
(access)252 3924 A
4218(*/)S
5400 V
(24720)210 648 A
(PUBLIC)252 1026 A
(char)168 1320 A
(dot2[3])294 1530 A
1866(=)S
("..";)210 1950 A
2370(/*)S
(permissions)462 2496 A
(for)126 3000 A
3168(.)S
(and)126 3252 A
3420(..)S
4218(*/)S
5490 V
(24721)210 648 A
5580 V
(24722)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(char)168 1866 A
(*get_name,)420 2076 A
(\(char)210 2538 A
(*old_name,)420 2790 A
(char)168 3252 A
(string)252 3462 A
([NAME_MAX]\))462 3756 A
4260(\);)S
5670 V
(24723)210 648 A
5760 V
(24724)210 648 A
(/*===========================================================================*)3276 1026 A
5850 V
(24725)210 648 A
1068(*)S
(eat_path)336 2370 A
4260(*)S
5940 V
(24726)210 648 A
(*===========================================================================*/)3276 1068 A
6030 V
(24727)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(inode)210 1614 A
(*eat_path\(path\))630 1866 A
6120 V
(24728)210 648 A
(char)168 1026 A
(*path;)252 1236 A
2370(/*)S
(the)126 2496 A
(path)168 2664 A
(name)168 2874 A
3084(to)S
3210(be)S
(parsed)252 3336 A
3630(*/)S
6210 V
(24729)210 648 A
1026({)S
8418 V
EP
%%Page: 340 340
BP
/slant 0 def
/height 0 def
630 V
12 B
(340)180 648 A
11 R
2151(File:)S
2384(src/fs/path.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(24730)210 648 A
1026(/*)S
(Parse)210 1152 A
(the)126 1404 A
(path)168 1572 A
('path')252 1782 A
(and)126 2076 A
(put)126 2244 A
(its)126 2412 A
(inode)210 2580 A
2832(in)S
(the)126 2958 A
(inode)210 3126 A
(table.)252 3378 A
3672(If)S
(not)126 3798 A
(possible,)378 3966 A
990 V
(24731)210 648 A
1068(*)S
(return)252 1152 A
(NIL_INODE)378 1446 A
1866(as)S
(function)336 1992 A
(value)210 2370 A
(and)126 2622 A
2790(an)S
(error)210 2916 A
(code)168 3168 A
3378(in)S
('err_code'.)462 3504 A
1080 V
(24732)210 648 A
1068(*/)S
1170 V
(24733)210 648 A
1260 V
(24734)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*ldip,)252 2034 A
(*rip;)210 2328 A
1350 V
(24735)210 648 A
(char)168 1110 A
(string[NAME_MAX];)714 1320 A
2370(/*)S
(hold)168 2496 A
2706(1)S
(path)168 2790 A
(component)378 3000 A
(name)168 3420 A
(here)168 3630 A
3840(*/)S
1440 V
(24736)210 648 A
1530 V
(24737)210 648 A
1110(/*)S
(First)210 1236 A
(open)168 1488 A
(the)126 1698 A
(path)168 1866 A
(down)168 2076 A
2286(to)S
(the)126 2412 A
(final)210 2580 A
(directory.)420 2832 A
3294(*/)S
1620 V
(24738)210 648 A
1110(if)S
1236(\()S
(\(ldip)210 1320 A
1572(=)S
(last_dir\(path,)588 1656 A
(string\)\))336 2286 A
2664(==)S
(NIL_INODE\))420 2790 A
1710 V
(24739)210 648 A
(return\(NIL_INODE\);)756 1362 A
2370(/*)S
2496(we)S
(couldn't)336 2622 A
(open)168 3000 A
(final)210 3210 A
(directory)378 3462 A
3882(*/)S
1800 V
(24740)210 648 A
1890 V
(24741)210 648 A
1110(/*)S
(The)126 1236 A
(path)168 1404 A
(consisting)420 1614 A
(only)168 2076 A
2286(of)S
("/")126 2412 A
2580(is)S
2706(a)S
(special)294 2790 A
(case,)210 3126 A
(check)210 3378 A
(for)126 3630 A
(it.)126 3798 A
3966(*/)S
1980 V
(24742)210 648 A
1110(if)S
(\(string[0])420 1236 A
1698(==)S
('\\0'\))210 1824 A
(return\(ldip\);)546 2076 A
2070 V
(24743)210 648 A
2160 V
(24744)210 648 A
1110(/*)S
(Get)126 1236 A
(final)210 1404 A
(component)378 1656 A
2076(of)S
(the)126 2202 A
(path.)210 2370 A
2622(*/)S
2250 V
(24745)210 648 A
(rip)126 1110 A
1278(=)S
(advance\(ldip,)546 1362 A
(string\);)336 1950 A
2340 V
(24746)210 648 A
(put_inode\(ldip\);)672 1110 A
2430 V
(24747)210 648 A
(return\(rip\);)504 1110 A
2520 V
(24748)210 648 A
1026(})S
2790 V
(24751)210 648 A
(/*===========================================================================*)3276 1026 A
2880 V
(24752)210 648 A
1068(*)S
(last_dir)336 2370 A
4260(*)S
2970 V
(24753)210 648 A
(*===========================================================================*/)3276 1068 A
3060 V
(24754)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(inode)210 1614 A
(*last_dir\(path,)630 1866 A
(string\))294 2538 A
3150 V
(24755)210 648 A
(char)168 1026 A
(*path;)252 1236 A
2370(/*)S
(the)126 2496 A
(path)168 2664 A
(name)168 2874 A
3084(to)S
3210(be)S
(parsed)252 3336 A
3630(*/)S
3240 V
(24756)210 648 A
(char)168 1026 A
(string[NAME_MAX];)714 1236 A
2370(/*)S
(the)126 2496 A
(final)210 2664 A
(component)378 2916 A
3336(is)S
(returned)336 3462 A
(here)168 3840 A
4050(*/)S
3330 V
(24757)210 648 A
1026({)S
3420 V
(24758)210 648 A
1026(/*)S
(Given)210 1152 A
1404(a)S
(path,)210 1488 A
('path',)294 1740 A
(located)294 2076 A
2412(in)S
(the)126 2538 A
2706(fs)S
(address)294 2832 A
(space,)252 3168 A
(parse)210 3462 A
3714(it)S
3840(as)S
3510 V
(24759)210 648 A
1068(*)S
(far)126 1152 A
1320(as)S
(the)126 1446 A
(last)168 1614 A
(directory,)420 1824 A
(fetch)210 2286 A
(the)126 2538 A
(inode)210 2706 A
(for)126 2958 A
(the)126 3126 A
(last)168 3294 A
(directory)378 3504 A
(into)168 3924 A
3600 V
(24760)210 648 A
1068(*)S
(the)126 1152 A
(inode)210 1320 A
(table,)252 1572 A
(and)126 1866 A
(return)252 2034 A
2328(a)S
(pointer)294 2412 A
2748(to)S
(the)126 2874 A
(inode.)252 3042 A
3378(In)S
3690 V
(24761)210 648 A
1068(*)S
(addition,)378 1152 A
(return)252 1572 A
(the)126 1866 A
(final)210 2034 A
(component)378 2286 A
2706(of)S
(the)126 2832 A
(path)168 3000 A
3210(in)S
('string'.)378 3336 A
3780 V
(24762)210 648 A
1068(*)S
1152(If)S
(the)126 1278 A
(last)168 1446 A
(directory)378 1656 A
(can't)210 2076 A
2328(be)S
(opened,)294 2454 A
(return)252 2790 A
(NIL_INODE)378 3084 A
(and)126 3504 A
3870 V
(24763)210 648 A
1068(*)S
(the)126 1152 A
(reason)252 1320 A
(for)126 1614 A
(failure)294 1782 A
2118(in)S
('err_code'.)462 2244 A
3960 V
(24764)210 648 A
1068(*/)S
4050 V
(24765)210 648 A
4140 V
(24766)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
4230 V
(24767)210 648 A
(register)336 1110 A
(char)168 1488 A
(*new_name;)420 1698 A
4320 V
(24768)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*new_ip;)336 2034 A
4410 V
(24769)210 648 A
4500 V
(24770)210 648 A
1110(/*)S
1236(Is)S
(the)126 1362 A
(path)168 1530 A
(absolute)336 1740 A
2118(or)S
(relative?)378 2244 A
(Initialize)420 2706 A
('rip')210 3168 A
(accordingly.)504 3420 A
3966(*/)S
4590 V
(24771)210 648 A
(rip)126 1110 A
1278(=)S
(\(*path)252 1362 A
1656(==)S
('/')126 1782 A
1950(?)S
(fp->fp_rootdir)588 2034 A
2664(:)S
(fp->fp_workdir\);)672 2748 A
4680 V
(24772)210 648 A
4770 V
(24773)210 648 A
1110(/*)S
1236(If)S
(dir)126 1362 A
(has)126 1530 A
(been)168 1698 A
(removed)294 1908 A
2244(or)S
(path)168 2370 A
2580(is)S
(empty,)252 2706 A
(return)252 3000 A
(ENOENT.)294 3294 A
3630(*/)S
4860 V
(24774)210 648 A
1110(if)S
(\(rip->i_nlinks)588 1236 A
1866(==)S
1992(0)S
2076(||)S
(*path)210 2202 A
2454(==)S
('\\0'\))210 2580 A
2832({)S
4950 V
(24775)210 648 A
(err_code)336 1362 A
1740(=)S
(ENOENT;)294 1824 A
5040 V
(24776)210 648 A
(return\(NIL_INODE\);)756 1362 A
5130 V
(24777)210 648 A
1110(})S
5220 V
(24778)210 648 A
5310 V
(24779)210 648 A
(dup_inode\(rip\);)630 1110 A
2370(/*)S
(inode)210 2496 A
(will)168 2748 A
2958(be)S
(returned)336 3084 A
(with)168 3462 A
(put_inode)378 3672 A
4092(*/)S
5400 V
(24780)210 648 A
5490 V
(24781)210 648 A
1110(/*)S
(Scan)168 1236 A
(the)126 1446 A
(path)168 1614 A
(component)378 1824 A
2244(by)S
(component.)420 2370 A
2832(*/)S
5580 V
(24782)210 648 A
(while)210 1110 A
(\(TRUE\))252 1362 A
1656({)S
5670 V
(24783)210 648 A
1362(/*)S
(Extract)294 1488 A
(one)126 1824 A
(component.)420 1992 A
2454(*/)S
5760 V
(24784)210 648 A
1362(if)S
1488(\()S
(\(new_name)378 1572 A
1992(=)S
(get_name\(path,)588 2076 A
(string\)\))336 2706 A
3084(==)S
(\(char*\))294 3210 A
3546(0\))S
3672({)S
5850 V
(24785)210 648 A
(put_inode\(rip\);)630 1698 A
2370(/*)S
(bad)126 2496 A
(path)168 2664 A
2874(in)S
(user)168 3000 A
(space)210 3210 A
3462(*/)S
5940 V
(24786)210 648 A
(return\(NIL_INODE\);)756 1698 A
6030 V
(24787)210 648 A
1362(})S
6120 V
(24788)210 648 A
1362(if)S
(\(*new_name)420 1488 A
1950(==)S
('\\0'\))210 2076 A
6210 V
(24789)210 648 A
1698(if)S
1824(\()S
(\(rip->i_mode)504 1908 A
2454(&)S
(I_TYPE\))294 2538 A
2874(==)S
(I_DIRECTORY\))504 3000 A
8418 V
EP
%%Page: 341 341
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2151(File:)S
2384(src/fs/path.c)S
12 B
(341)180 4248 A
900 V
7 LST
(24790)210 648 A
(return\(rip\);)504 2034 A
2706(/*)S
(normal)252 2832 A
(exit)168 3126 A
3336(*/)S
990 V
(24791)210 648 A
(else)168 1698 A
1908({)S
1080 V
(24792)210 648 A
2034(/*)S
(last)168 2160 A
(file)168 2370 A
2580(of)S
(path)168 2706 A
(prefix)252 2916 A
3210(is)S
(not)126 3336 A
3504(a)S
(directory)378 3588 A
4008(*/)S
1170 V
(24793)210 648 A
(put_inode\(rip\);)630 2034 A
1260 V
(24794)210 648 A
(err_code)336 2034 A
2412(=)S
(ENOTDIR;)336 2496 A
1350 V
(24795)210 648 A
(return\(NIL_INODE\);)756 2034 A
1440 V
(24796)210 648 A
1698(})S
1530 V
(24797)210 648 A
1620 V
(24798)210 648 A
1362(/*)S
(There)210 1488 A
1740(is)S
(more)168 1866 A
(path.)210 2076 A
(Keep)168 2370 A
(parsing.)336 2580 A
2958(*/)S
1710 V
(24799)210 648 A
(new_ip)252 1362 A
1656(=)S
(advance\(rip,)504 1740 A
(string\);)336 2286 A
1800 V
(24800)210 648 A
(put_inode\(rip\);)630 1362 A
2370(/*)S
(rip)126 2496 A
(either)252 2664 A
(obsolete)336 2958 A
3336(or)S
(irrelevant)420 3462 A
3924(*/)S
1890 V
(24801)210 648 A
1362(if)S
(\(new_ip)294 1488 A
1824(==)S
(NIL_INODE\))420 1950 A
(return\(NIL_INODE\);)756 2412 A
1980 V
(24802)210 648 A
2070 V
(24803)210 648 A
1362(/*)S
(The)126 1488 A
(call)168 1656 A
1866(to)S
(advance\(\))378 1992 A
(succeeded.)420 2412 A
(Fetch)210 2916 A
(next)168 3168 A
(component.)420 3378 A
3840(*/)S
2160 V
(24804)210 648 A
(path)168 1362 A
1572(=)S
(new_name;)378 1656 A
2250 V
(24805)210 648 A
(rip)126 1362 A
1530(=)S
(new_ip;)294 1614 A
2340 V
(24806)210 648 A
1110(})S
2430 V
(24807)210 648 A
1026(})S
2700 V
(24810)210 648 A
(/*===========================================================================*)3276 1026 A
2790 V
(24811)210 648 A
1068(*)S
(get_name)336 2370 A
4260(*)S
2880 V
(24812)210 648 A
(*===========================================================================*/)3276 1068 A
2970 V
(24813)210 648 A
(PRIVATE)294 1026 A
(char)168 1362 A
(*get_name\(old_name,)798 1572 A
(string\))294 2412 A
3060 V
(24814)210 648 A
(char)168 1026 A
(*old_name;)420 1236 A
2370(/*)S
(path)168 2496 A
(name)168 2706 A
2916(to)S
(parse)210 3042 A
3294(*/)S
3150 V
(24815)210 648 A
(char)168 1026 A
(string[NAME_MAX];)714 1236 A
2370(/*)S
(component)378 2496 A
(extracted)378 2916 A
(from)168 3336 A
('old_name')420 3546 A
4008(*/)S
3240 V
(24816)210 648 A
1026({)S
3330 V
(24817)210 648 A
1026(/*)S
(Given)210 1152 A
1404(a)S
(pointer)294 1488 A
1824(to)S
1950(a)S
(path)168 2034 A
(name)168 2244 A
2454(in)S
2580(fs)S
(space,)252 2706 A
('old_name',)462 3000 A
(copy)168 3504 A
(the)126 3714 A
(next)168 3882 A
3420 V
(24818)210 648 A
1068(*)S
(component)378 1152 A
1572(to)S
('string')336 1698 A
(and)126 2076 A
(pad)126 2244 A
(with)168 2412 A
(zeros.)252 2622 A
2958(A)S
(pointer)294 3042 A
3378(to)S
(that)168 3504 A
(part)168 3714 A
3924(of)S
3510 V
(24819)210 648 A
1068(*)S
(the)126 1152 A
(name)168 1320 A
1530(as)S
(yet)126 1656 A
(unparsed)336 1824 A
2202(is)S
(returned.)378 2328 A
(Roughly)294 2790 A
(speaking,)378 3126 A
3600 V
(24820)210 648 A
1068(*)S
('get_name')420 1152 A
1614(=)S
('old_name')420 1698 A
2160(-)S
('string'.)378 2244 A
3690 V
(24821)210 648 A
1068(*)S
3780 V
(24822)210 648 A
1068(*)S
(This)168 1152 A
(routine)294 1362 A
(follows)294 1698 A
(the)126 2034 A
(standard)336 2202 A
(convention)420 2580 A
(that)168 3042 A
(/usr/ast,)378 3252 A
(/usr//ast,)420 3672 A
3870 V
(24823)210 648 A
1068(*)S
(//usr///ast)462 1152 A
(and)126 1656 A
(/usr/ast/)378 1824 A
(are)126 2244 A
(all)126 2412 A
(equivalent.)462 2580 A
3960 V
(24824)210 648 A
1068(*/)S
4050 V
(24825)210 648 A
4140 V
(24826)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(c;)S
4230 V
(24827)210 648 A
(register)336 1110 A
(char)168 1488 A
(*np,)168 1698 A
(*rnp;)210 1908 A
4320 V
(24828)210 648 A
4410 V
(24829)210 648 A
1110(np)S
1236(=)S
(string;)294 1320 A
2370(/*)S
('np')168 2496 A
(points)252 2706 A
3000(to)S
(current)294 3126 A
(position)336 3462 A
3840(*/)S
4500 V
(24830)210 648 A
(rnp)126 1110 A
1278(=)S
(old_name;)378 1362 A
2370(/*)S
('rnp')210 2496 A
(points)252 2748 A
3042(to)S
(unparsed)336 3168 A
(string)252 3546 A
3840(*/)S
4590 V
(24831)210 648 A
(while)210 1110 A
1362(\()S
1446(\(c)S
1572(=)S
(*rnp\))210 1656 A
1908(==)S
('/'\))168 2034 A
(rnp++;)252 2244 A
2706(/*)S
(skip)168 2832 A
(leading)294 3042 A
(slashes)294 3378 A
3714(*/)S
4680 V
(24832)210 648 A
4770 V
(24833)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(unparsed)336 1614 A
(path,)210 1992 A
('old_name',)462 2244 A
2748(to)S
(the)126 2874 A
(array,)252 3042 A
('string'.)378 3336 A
3756(*/)S
4860 V
(24834)210 648 A
(while)210 1110 A
1362(\()S
(rnp)126 1446 A
1614(<)S
(&old_name[PATH_MAX])798 1698 A
2580(&&)S
2748(c)S
2832(!=)S
('/')126 2958 A
3210(&&)S
3378(c)S
3462(!=)S
('\\0'\))210 3588 A
3840({)S
4950 V
(24835)210 648 A
1362(if)S
(\(np)126 1488 A
1656(<)S
(&string[NAME_MAX]\))756 1740 A
(*np++)210 2538 A
2790(=)S
2874(c;)S
5040 V
(24836)210 648 A
1362(c)S
1446(=)S
(*++rnp;)294 1530 A
2370(/*)S
(advance)294 2496 A
2832(to)S
(next)168 2958 A
(character)378 3168 A
3588(*/)S
5130 V
(24837)210 648 A
1110(})S
5220 V
(24838)210 648 A
5310 V
(24839)210 648 A
1110(/*)S
1236(To)S
(make)168 1362 A
(/usr/ast/)378 1572 A
(equivalent)420 1992 A
2454(to)S
(/usr/ast,)378 2580 A
(skip)168 3000 A
(trailing)336 3210 A
(slashes.)336 3588 A
3966(*/)S
5400 V
(24840)210 648 A
(while)210 1110 A
1362(\(c)S
1488(==)S
('/')126 1614 A
1782(&&)S
(rnp)126 1908 A
2076(<)S
(&old_name[PATH_MAX]\))840 2160 A
3042(c)S
3126(=)S
(*++rnp;)294 3210 A
5490 V
(24841)210 648 A
5580 V
(24842)210 648 A
1110(if)S
(\(np)126 1236 A
1404(<)S
(&string[NAME_MAX]\))756 1488 A
(*np)126 2286 A
2454(=)S
('\\0';)210 2538 A
3042(/*)S
(Terminate)378 3168 A
(string)252 3588 A
3882(*/)S
5670 V
(24843)210 648 A
5760 V
(24844)210 648 A
1110(if)S
(\(rnp)168 1236 A
1446(>=)S
(&old_name[PATH_MAX]\))840 1572 A
2454({)S
5850 V
(24845)210 648 A
(err_code)336 1362 A
1740(=)S
(ENAMETOOLONG;)546 1824 A
5940 V
(24846)210 648 A
(return\(\(char)504 1362 A
1908(*\))S
(0\);)126 2034 A
6030 V
(24847)210 648 A
1110(})S
6120 V
(24848)210 648 A
(return\(rnp\);)504 1110 A
6210 V
(24849)210 648 A
1026(})S
8418 V
EP
%%Page: 342 342
BP
/slant 0 def
/height 0 def
630 V
12 B
(342)180 648 A
11 R
2151(File:)S
2384(src/fs/path.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
1080 V
7 LST
(24852)210 648 A
(/*===========================================================================*)3276 1026 A
1170 V
(24853)210 648 A
1068(*)S
(advance)294 2370 A
4260(*)S
1260 V
(24854)210 648 A
(*===========================================================================*/)3276 1068 A
1350 V
(24855)210 648 A
(PUBLIC)252 1026 A
(struct)252 1320 A
(inode)210 1614 A
(*advance\(dirp,)588 1866 A
(string\))294 2496 A
1440 V
(24856)210 648 A
(struct)252 1026 A
(inode)210 1320 A
(*dirp;)252 1572 A
2370(/*)S
(inode)210 2496 A
(for)126 2748 A
(directory)378 2916 A
3336(to)S
3462(be)S
(searched)336 3588 A
3966(*/)S
1530 V
(24857)210 648 A
(char)168 1026 A
(string[NAME_MAX];)714 1236 A
2370(/*)S
(component)378 2496 A
(name)168 2916 A
3126(to)S
(look)168 3252 A
(for)126 3462 A
3630(*/)S
1620 V
(24858)210 648 A
1026({)S
1710 V
(24859)210 648 A
1026(/*)S
(Given)210 1152 A
1404(a)S
(directory)378 1488 A
(and)126 1908 A
2076(a)S
(component)378 2160 A
2580(of)S
2706(a)S
(path,)210 2790 A
(look)168 3042 A
3252(up)S
(the)126 3378 A
(component)378 3546 A
3966(in)S
1800 V
(24860)210 648 A
1068(*)S
(the)126 1152 A
(directory,)420 1320 A
(find)168 1782 A
(the)126 1992 A
(inode,)252 2160 A
(open)168 2454 A
(it,)126 2664 A
(and)126 2832 A
(return)252 3000 A
3294(a)S
(pointer)294 3378 A
3714(to)S
(its)126 3840 A
(inode)210 4008 A
1890 V
(24861)210 648 A
1068(*)S
(slot.)210 1152 A
1446(If)S
1572(it)S
(can't)210 1698 A
1950(be)S
(done,)210 2076 A
(return)252 2328 A
(NIL_INODE.)420 2622 A
1980 V
(24862)210 648 A
1068(*/)S
2070 V
(24863)210 648 A
2160 V
(24864)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
2250 V
(24865)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*rip2;)252 1656 A
2340 V
(24866)210 648 A
(register)336 1110 A
(struct)252 1488 A
(super_block)462 1782 A
(*sp;)168 2286 A
2430 V
(24867)210 648 A
(int)126 1110 A
1278(r,)S
(inumb;)252 1404 A
2520 V
(24868)210 648 A
(dev_t)210 1110 A
(mnt_dev;)336 1362 A
2610 V
(24869)210 648 A
(ino_t)210 1110 A
(numb;)210 1362 A
2700 V
(24870)210 648 A
2790 V
(24871)210 648 A
1110(/*)S
1236(If)S
('string')336 1362 A
1740(is)S
(empty,)252 1866 A
(yield)210 2160 A
(same)168 2412 A
(inode)210 2622 A
(straight)336 2874 A
(away.)210 3252 A
3504(*/)S
2880 V
(24872)210 648 A
1110(if)S
(\(string[0])420 1236 A
1698(==)S
('\\0'\))210 1824 A
(return\(get_inode\(dirp->i_dev,)1218 2076 A
(\(int\))210 3336 A
(dirp->i_num\)\);)588 3588 A
2970 V
(24873)210 648 A
3060 V
(24874)210 648 A
1110(/*)S
(Check)210 1236 A
(for)126 1488 A
(NIL_INODE.)420 1656 A
2118(*/)S
3150 V
(24875)210 648 A
1110(if)S
(\(dirp)210 1236 A
1488(==)S
(NIL_INODE\))420 1614 A
(return\(NIL_INODE\);)756 2076 A
3240 V
(24876)210 648 A
3330 V
(24877)210 648 A
1110(/*)S
1236(If)S
('string')336 1362 A
1740(is)S
(not)126 1866 A
(present)294 2034 A
2370(in)S
(the)126 2496 A
(directory,)420 2664 A
(signal)252 3126 A
(error.)252 3420 A
3714(*/)S
3420 V
(24878)210 648 A
1110(if)S
1236(\()S
1320(\(r)S
1446(=)S
(search_dir\(dirp,)672 1530 A
(string,)294 2244 A
(&numb,)252 2580 A
(LOOK_UP\)\))378 2874 A
3294(!=)S
(OK\))126 3420 A
3588({)S
3510 V
(24879)210 648 A
(err_code)336 1362 A
1740(=)S
1824(r;)S
3600 V
(24880)210 648 A
(return\(NIL_INODE\);)756 1362 A
3690 V
(24881)210 648 A
1110(})S
3780 V
(24882)210 648 A
3870 V
(24883)210 648 A
1110(/*)S
(Don't)210 1236 A
1488(go)S
(beyond)252 1614 A
(the)126 1908 A
(current)294 2076 A
(root)168 2412 A
(directory,)420 2622 A
(unless)252 3084 A
(the)126 3378 A
(string)252 3546 A
3840(is)S
(dot2.)210 3966 A
4218(*/)S
3960 V
(24884)210 648 A
1110(if)S
(\(dirp)210 1236 A
1488(==)S
(fp->fp_rootdir)588 1614 A
2244(&&)S
(strcmp\(string,)588 2370 A
(".."\))210 3000 A
3252(==)S
3378(0)S
3462(&&)S
(string)252 3588 A
3882(!=)S
(dot2\))210 4008 A
4050 V
(24885)210 648 A
(return\(get_inode\(dirp->i_dev,)1218 1698 A
(\(int\))210 2958 A
(dirp->i_num\)\);)588 3210 A
4140 V
(24886)210 648 A
4230 V
(24887)210 648 A
1110(/*)S
(The)126 1236 A
(component)378 1404 A
(has)126 1824 A
(been)168 1992 A
(found)210 2202 A
2454(in)S
(the)126 2580 A
(directory.)420 2748 A
(Get)126 3252 A
(inode.)252 3420 A
3714(*/)S
4320 V
(24888)210 648 A
1110(if)S
1236(\()S
(\(rip)168 1320 A
1530(=)S
(get_inode\(dirp->i_dev,)924 1614 A
(\(int\))210 2580 A
(numb\)\))252 2832 A
3126(==)S
(NIL_INODE\))420 3252 A
4410 V
(24889)210 648 A
(return\(NIL_INODE\);)756 1362 A
4500 V
(24890)210 648 A
4590 V
(24891)210 648 A
1110(if)S
(\(rip->i_num)462 1236 A
1740(==)S
(ROOT_INODE\))462 1866 A
4680 V
(24892)210 648 A
1362(if)S
(\(dirp->i_num)504 1488 A
2034(==)S
(ROOT_INODE\))462 2160 A
2664({)S
4770 V
(24893)210 648 A
1530(if)S
(\(string[1])420 1656 A
2118(==)S
('.'\))168 2244 A
2454({)S
4860 V
(24894)210 648 A
(for)126 1698 A
(\(sp)126 1866 A
2034(=)S
(&super_block[1];)672 2118 A
2832(sp)S
2958(<)S
(&super_block[NR_SUPERS];)1008 3042 A
(sp++\){)252 4092 A
4950 V
(24895)210 648 A
2034(if)S
(\(sp->s_dev)420 2160 A
2622(==)S
(rip->i_dev\))462 2748 A
3252({)S
5040 V
(24896)210 648 A
2370(/*)S
(Release)294 2496 A
(the)126 2832 A
(root)168 3000 A
(inode.)252 3210 A
(Replace)294 3546 A
3882(by)S
(the)126 4008 A
5130 V
(24897)210 648 A
2412(*)S
(inode)210 2496 A
(mounted)294 2748 A
(on.)126 3084 A
5220 V
(24898)210 648 A
2412(*/)S
5310 V
(24899)210 648 A
(put_inode\(rip\);)630 2370 A
5400 V
(24900)210 648 A
(mnt_dev)294 2370 A
2706(=)S
(sp->s_imount->i_dev;)840 2790 A
5490 V
(24901)210 648 A
(inumb)210 2370 A
2622(=)S
(\(int\))210 2706 A
(sp->s_imount->i_num;)840 2958 A
5580 V
(24902)210 648 A
(rip2)168 2370 A
2580(=)S
(get_inode\(mnt_dev,)756 2664 A
(inumb\);)294 3462 A
5670 V
(24903)210 648 A
(rip)126 2370 A
2538(=)S
(advance\(rip2,)546 2622 A
(string\);)336 3210 A
5760 V
(24904)210 648 A
(put_inode\(rip2\);)672 2370 A
5850 V
(24905)210 648 A
(break;)252 2370 A
5940 V
(24906)210 648 A
2034(})S
6030 V
(24907)210 648 A
1698(})S
6120 V
(24908)210 648 A
1530(})S
6210 V
(24909)210 648 A
1362(})S
8418 V
EP
%%Page: 343 343
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2151(File:)S
2384(src/fs/path.c)S
12 B
(343)180 4248 A
900 V
7 LST
(24910)210 648 A
1110(if)S
(\(rip)168 1236 A
1446(==)S
(NIL_INODE\))420 1572 A
(return\(NIL_INODE\);)756 2034 A
990 V
(24911)210 648 A
1080 V
(24912)210 648 A
1110(/*)S
(See)126 1236 A
1404(if)S
(the)126 1530 A
(inode)210 1698 A
1950(is)S
(mounted)294 2076 A
(on.)126 2412 A
2622(If)S
(so,)126 2748 A
(switch)252 2916 A
3210(to)S
(root)168 3336 A
(directory)378 3546 A
3966(of)S
(the)126 4092 A
1170 V
(24913)210 648 A
1152(*)S
(mounted)294 1236 A
(file)168 1572 A
(system.)294 1782 A
(The)126 2160 A
(super_block)462 2328 A
(provides)336 2832 A
(the)126 3210 A
(linkage)294 3378 A
(between)294 3714 A
(the)126 4050 A
1260 V
(24914)210 648 A
1152(*)S
(inode)210 1236 A
(mounted)294 1488 A
1824(on)S
(and)126 1950 A
(the)126 2118 A
(root)168 2286 A
(directory)378 2496 A
2916(of)S
(the)126 3042 A
(mounted)294 3210 A
(file)168 3546 A
(system.)294 3756 A
1350 V
(24915)210 648 A
1152(*/)S
1440 V
(24916)210 648 A
(while)210 1110 A
(\(rip)168 1362 A
1572(!=)S
(NIL_INODE)378 1698 A
2118(&&)S
(rip->i_mount)504 2244 A
2790(==)S
(I_MOUNT\))336 2916 A
3294({)S
1530 V
(24917)210 648 A
1362(/*)S
(The)126 1488 A
(inode)210 1656 A
1908(is)S
(indeed)252 2034 A
(mounted)294 2328 A
(on.)126 2664 A
2832(*/)S
1620 V
(24918)210 648 A
(for)126 1362 A
(\(sp)126 1530 A
1698(=)S
(&super_block[0];)672 1782 A
2496(sp)S
2622(<)S
(&super_block[NR_SUPERS];)1008 2706 A
(sp++\))210 3756 A
4008({)S
1710 V
(24919)210 648 A
1698(if)S
(\(sp->s_imount)546 1824 A
2412(==)S
(rip\))168 2538 A
2748({)S
1800 V
(24920)210 648 A
2034(/*)S
(Release)294 2160 A
(the)126 2496 A
(inode)210 2664 A
(mounted)294 2916 A
(on.)126 3252 A
(Replace)294 3462 A
3798(by)S
(the)126 3924 A
1890 V
(24921)210 648 A
2076(*)S
(inode)210 2160 A
2412(of)S
(the)126 2538 A
(root)168 2706 A
(inode)210 2916 A
3168(of)S
(the)126 3294 A
(mounted)294 3462 A
(device.)294 3798 A
1980 V
(24922)210 648 A
2076(*/)S
2070 V
(24923)210 648 A
(put_inode\(rip\);)630 2034 A
2160 V
(24924)210 648 A
(rip)126 2034 A
2202(=)S
(get_inode\(sp->s_dev,)840 2286 A
(ROOT_INODE\);)504 3168 A
2250 V
(24925)210 648 A
(break;)252 2034 A
2340 V
(24926)210 648 A
1698(})S
2430 V
(24927)210 648 A
1362(})S
2520 V
(24928)210 648 A
1110(})S
2610 V
(24929)210 648 A
(return\(rip\);)504 1110 A
2034(/*)S
(return)252 2160 A
(pointer)294 2454 A
2790(to)S
(inode's)294 2916 A
(component)378 3252 A
3672(*/)S
2700 V
(24930)210 648 A
1026(})S
2970 V
(24933)210 648 A
(/*===========================================================================*)3276 1026 A
3060 V
(24934)210 648 A
1068(*)S
(search_dir)420 2370 A
4260(*)S
3150 V
(24935)210 648 A
(*===========================================================================*/)3276 1068 A
3240 V
(24936)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(search_dir\(ldir_ptr,)840 1488 A
(string,)294 2370 A
(numb,)210 2706 A
(flag\))210 2958 A
3330 V
(24937)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*ldir_ptr;)420 1950 A
2706(/*)S
(ptr)126 2832 A
3000(to)S
(inode)210 3126 A
(for)126 3378 A
(dir)126 3546 A
3714(to)S
(search)252 3840 A
4134(*/)S
3420 V
(24938)210 648 A
(char)168 1026 A
(string[NAME_MAX];)714 1236 A
2370(/*)S
(component)378 2496 A
2916(to)S
(search)252 3042 A
(for)126 3336 A
3504(*/)S
3510 V
(24939)210 648 A
(ino_t)210 1026 A
(*numb;)252 1278 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
(number)252 3210 A
3504(*/)S
3600 V
(24940)210 648 A
(int)126 1026 A
(flag;)210 1194 A
2370(/*)S
(LOOK_UP,)336 2496 A
(ENTER,)252 2874 A
(DELETE)252 3168 A
3462(or)S
(IS_EMPTY)336 3588 A
3966(*/)S
3690 V
(24941)210 648 A
1026({)S
3780 V
(24942)210 648 A
1026(/*)S
(This)168 1152 A
(function)336 1362 A
(searches)336 1740 A
(the)126 2118 A
(directory)378 2286 A
(whose)210 2706 A
(inode)210 2958 A
3210(is)S
(pointed)294 3336 A
3672(to)S
3798(by)S
('ldip':)294 3924 A
3870 V
(24943)210 648 A
1068(*)S
1152(if)S
(\(flag)210 1278 A
1530(==)S
(ENTER\))252 1656 A
(enter)210 1992 A
('string')336 2244 A
2622(in)S
(the)126 2748 A
(directory)378 2916 A
(with)168 3336 A
(inode)210 3546 A
3798(#)S
('*numb';)336 3882 A
3960 V
(24944)210 648 A
1068(*)S
1152(if)S
(\(flag)210 1278 A
1530(==)S
(DELETE\))294 1656 A
(delete)252 1992 A
('string')336 2286 A
(from)168 2664 A
(the)126 2874 A
(directory;)420 3042 A
4050 V
(24945)210 648 A
1068(*)S
1152(if)S
(\(flag)210 1278 A
1530(==)S
(LOOK_UP\))336 1656 A
(search)252 2034 A
(for)126 2328 A
('string')336 2496 A
(and)126 2874 A
(return)252 3042 A
(inode)210 3336 A
3588(#)S
3672(in)S
('numb';)294 3798 A
4140 V
(24946)210 648 A
1068(*)S
1152(if)S
(\(flag)210 1278 A
1530(==)S
(IS_EMPTY\))378 1656 A
(return)252 2076 A
2370(OK)S
2496(if)S
(only)168 2622 A
2832(.)S
(and)126 2916 A
3084(..)S
3210(in)S
(dir)126 3336 A
(else)168 3504 A
(ENOTEMPTY;)420 3714 A
4230 V
(24947)210 648 A
1068(*)S
4320 V
(24948)210 648 A
1068(*)S
1278(if)S
('string')336 1404 A
1782(is)S
(dot1)168 1908 A
2118(or)S
(dot2,)210 2244 A
2496(no)S
(access)252 2622 A
(permissions)462 2916 A
(are)126 3420 A
(checked.)336 3588 A
4410 V
(24949)210 648 A
1068(*/)S
4500 V
(24950)210 648 A
4590 V
(24951)210 648 A
(register)336 1110 A
(struct)252 1488 A
(direct)252 1782 A
(*dp;)168 2076 A
4680 V
(24952)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp;)168 1950 A
4770 V
(24953)210 648 A
(int)126 1110 A
1278(i,)S
1404(r,)S
(e_hit,)252 1530 A
1824(t,)S
(match;)252 1950 A
4860 V
(24954)210 648 A
(mode_t)252 1110 A
(bits;)210 1404 A
4950 V
(24955)210 648 A
(off_t)210 1110 A
(pos;)168 1362 A
5040 V
(24956)210 648 A
(unsigned)336 1110 A
(new_slots,)420 1488 A
(old_slots;)420 1950 A
5130 V
(24957)210 648 A
(block_t)294 1110 A
1446(b;)S
5220 V
(24958)210 648 A
(struct)252 1110 A
(super_block)462 1404 A
(*sp;)168 1908 A
5310 V
(24959)210 648 A
(int)126 1110 A
(extended)336 1278 A
1656(=)S
1740(0;)S
5400 V
(24960)210 648 A
5490 V
(24961)210 648 A
1110(/*)S
1236(If)S
('ldir_ptr')420 1362 A
1824(is)S
(not)126 1950 A
2118(a)S
(pointer)294 2202 A
2538(to)S
2664(a)S
(dir)126 2748 A
(inode,)252 2916 A
(error.)252 3210 A
3504(*/)S
5580 V
(24962)210 648 A
1110(if)S
1236(\()S
(\(ldir_ptr->i_mode)714 1320 A
2076(&)S
(I_TYPE\))294 2160 A
2496(!=)S
(I_DIRECTORY\))504 2622 A
(return\(ENOTDIR\);)672 3168 A
5670 V
(24963)210 648 A
5760 V
(24964)210 648 A
1110(r)S
1194(=)S
(OK;)126 1278 A
5850 V
(24965)210 648 A
5940 V
(24966)210 648 A
1110(if)S
(\(flag)210 1236 A
1488(!=)S
(IS_EMPTY\))378 1614 A
2034({)S
6030 V
(24967)210 648 A
(bits)168 1362 A
1572(=)S
(\(flag)210 1656 A
1908(==)S
(LOOK_UP)294 2034 A
2370(?)S
(X_BIT)210 2454 A
2706(:)S
(W_BIT)210 2790 A
3042(|)S
(X_BIT\);)294 3126 A
6120 V
(24968)210 648 A
6210 V
(24969)210 648 A
1362(if)S
(\(string)294 1488 A
1824(==)S
(dot1)168 1950 A
2160(||)S
(string)252 2286 A
2580(==)S
(dot2\))210 2706 A
2958({)S
8418 V
EP
%%Page: 344 344
BP
/slant 0 def
/height 0 def
630 V
12 B
(344)180 648 A
11 R
2151(File:)S
2384(src/fs/path.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(24970)210 648 A
1698(if)S
(\(flag)210 1824 A
2076(!=)S
(LOOK_UP\))336 2202 A
2580(r)S
2664(=)S
(read_only\(ldir_ptr\);)840 2748 A
990 V
(24971)210 648 A
2580(/*)S
(only)168 2706 A
2916(a)S
(writable)336 3000 A
(device)252 3378 A
3672(is)S
(required.)378 3798 A
4218(*/)S
1080 V
(24972)210 648 A
1362(})S
1170 V
(24973)210 648 A
(else)168 1362 A
1572(r)S
1656(=)S
(forbidden\(ldir_ptr,)798 1740 A
(bits\);)252 2580 A
2874(/*)S
(check)210 3000 A
(access)252 3252 A
(permissions)462 3546 A
4050(*/)S
1260 V
(24974)210 648 A
1110(})S
1350 V
(24975)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
(return\(r\);)420 1656 A
1440 V
(24976)210 648 A
1530 V
(24977)210 648 A
1110(/*)S
(Step)168 1236 A
(through)294 1446 A
(the)126 1782 A
(directory)378 1950 A
(one)126 2370 A
(block)210 2538 A
2790(at)S
2916(a)S
(time.)210 3000 A
3252(*/)S
1620 V
(24978)210 648 A
(old_slots)378 1110 A
1530(=)S
(\(unsigned\))420 1614 A
(\(ldir_ptr->i_size/DIR_ENTRY_SIZE\);)1428 2076 A
1710 V
(24979)210 648 A
(new_slots)378 1110 A
1530(=)S
1614(0;)S
1800 V
(24980)210 648 A
(e_hit)210 1110 A
1362(=)S
(FALSE;)252 1446 A
1890 V
(24981)210 648 A
(match)210 1110 A
1362(=)S
1446(0;)S
2370(/*)S
(set)126 2496 A
(when)168 2664 A
2874(a)S
(string)252 2958 A
(match)210 3252 A
(occurs)252 3504 A
3798(*/)S
1980 V
(24982)210 648 A
2070 V
(24983)210 648 A
(for)126 1110 A
(\(pos)168 1278 A
1488(=)S
1572(0;)S
(pos)126 1698 A
1866(<)S
(ldir_ptr->i_size;)714 1950 A
(pos)126 2706 A
2874(+=)S
(BLOCK_SIZE\))462 3000 A
3504({)S
2160 V
(24984)210 648 A
1362(b)S
1446(=)S
(read_map\(ldir_ptr,)756 1530 A
(pos\);)210 2328 A
2706(/*)S
(get)126 2832 A
(block)210 3000 A
(number)252 3252 A
3546(*/)S
2250 V
(24985)210 648 A
2340 V
(24986)210 648 A
1362(/*)S
(Since)210 1488 A
(directories)462 1740 A
(don't)210 2244 A
(have)168 2496 A
(holes,)252 2706 A
('b')126 3000 A
(cannot)252 3168 A
3462(be)S
(NO_BLOCK.)378 3588 A
4008(*/)S
2430 V
(24987)210 648 A
1362(bp)S
1488(=)S
(get_block\(ldir_ptr->i_dev,)1092 1572 A
2706(b,)S
(NORMAL\);)336 2832 A
3378(/*)S
(get)126 3504 A
3672(a)S
(dir)126 3756 A
(block)210 3924 A
4176(*/)S
2520 V
(24988)210 648 A
2610 V
(24989)210 648 A
1362(/*)S
(Search)252 1488 A
1782(a)S
(directory)378 1866 A
(block.)252 2286 A
2580(*/)S
2700 V
(24990)210 648 A
(for)126 1362 A
(\(dp)126 1530 A
1698(=)S
(&bp->b_dir[0];)588 1782 A
2412(dp)S
2538(<)S
(&bp->b_dir[NR_DIR_ENTRIES];)1134 2622 A
(dp++\))210 3798 A
4050({)S
2790 V
(24991)210 648 A
1698(if)S
(\(++new_slots)504 1824 A
2370(>)S
(old_slots\))420 2454 A
2916({)S
3000(/*)S
(not)126 3126 A
(found,)252 3294 A
(but)126 3588 A
(room)168 3756 A
(left)168 3966 A
4176(*/)S
2880 V
(24992)210 648 A
2034(if)S
(\(flag)210 2160 A
2412(==)S
(ENTER\))252 2538 A
(e_hit)210 2832 A
3084(=)S
(TRUE;)210 3168 A
2970 V
(24993)210 648 A
(break;)252 2034 A
3060 V
(24994)210 648 A
1698(})S
3150 V
(24995)210 648 A
3240 V
(24996)210 648 A
1698(/*)S
(Match)210 1824 A
(occurs)252 2076 A
2370(if)S
(string)252 2496 A
(found.)252 2790 A
3084(*/)S
3330 V
(24997)210 648 A
1698(if)S
(\(flag)210 1824 A
2076(!=)S
(ENTER)210 2202 A
2454(&&)S
(dp->d_ino)378 2580 A
3000(!=)S
3126(0\))S
3252({)S
3420 V
(24998)210 648 A
2034(if)S
(\(flag)210 2160 A
2412(==)S
(IS_EMPTY\))378 2538 A
2958({)S
3510 V
(24999)210 648 A
2370(/*)S
2496(If)S
(this)168 2622 A
(test)168 2832 A
(succeeds,)378 3042 A
(dir)126 3462 A
3630(is)S
(not)126 3756 A
(empty.)252 3924 A
4218(*/)S
3600 V
(25000)210 648 A
2370(if)S
(\(strcmp\(dp->d_name,)798 2496 A
(".")126 3336 A
3504(\))S
3588(!=)S
3714(0)S
3798(&&)S
3690 V
(25001)210 648 A
(strcmp\(dp->d_name,)756 2538 A
(".."\))210 3336 A
3588(!=)S
3714(0\))S
(match)210 3840 A
4092(=)S
4176(1;)S
3780 V
(25002)210 648 A
2034(})S
(else)168 2118 A
2328({)S
3870 V
(25003)210 648 A
2370(if)S
(\(strncmp\(dp->d_name,)840 2496 A
(string,)294 3378 A
(NAME_MAX\))378 3714 A
4134(==)S
4260(0\))S
3960 V
(25004)210 648 A
(match)210 2706 A
2958(=)S
3042(1;)S
4050 V
(25005)210 648 A
2034(})S
4140 V
(25006)210 648 A
1698(})S
4230 V
(25007)210 648 A
4320 V
(25008)210 648 A
1698(if)S
(\(match\))294 1824 A
2160({)S
4410 V
(25009)210 648 A
2034(/*)S
(LOOK_UP)294 2160 A
2496(or)S
(DELETE)252 2622 A
(found)210 2916 A
(what)168 3168 A
3378(it)S
(wanted.)294 3504 A
3840(*/)S
4500 V
(25010)210 648 A
2034(r)S
2118(=)S
(OK;)126 2202 A
4590 V
(25011)210 648 A
2034(if)S
(\(flag)210 2160 A
2412(==)S
(IS_EMPTY\))378 2538 A
2958(r)S
3042(=)S
(ENOTEMPTY;)420 3126 A
4680 V
(25012)210 648 A
(else)168 2034 A
2244(if)S
(\(flag)210 2370 A
2622(==)S
(DELETE\))294 2748 A
3084({)S
4770 V
(25013)210 648 A
2370(/*)S
(Save)168 2496 A
(d_ino)210 2706 A
(for)126 2958 A
(recovery.)378 3126 A
3546(*/)S
4860 V
(25014)210 648 A
2370(t)S
2454(=)S
(NAME_MAX)336 2538 A
2916(-)S
(sizeof\(ino_t\);)588 3000 A
4950 V
(25015)210 648 A
(*\(\(ino_t)336 2370 A
2748(*\))S
(&dp->d_name[t]\))630 2874 A
3546(=)S
(dp->d_ino;)420 3630 A
5040 V
(25016)210 648 A
(dp->d_ino)378 2370 A
2790(=)S
2874(0;)S
3042(/*)S
(erase)210 3168 A
(entry)210 3420 A
3672(*/)S
5130 V
(25017)210 648 A
(bp->b_dirt)420 2370 A
2832(=)S
(DIRTY;)252 2916 A
5220 V
(25018)210 648 A
(ldir_ptr->i_update)756 2370 A
3168(|=)S
(CTIME)210 3294 A
3546(|)S
(MTIME;)252 3630 A
5310 V
(25019)210 648 A
(ldir_ptr->i_dirt)672 2370 A
3084(=)S
(DIRTY;)252 3168 A
5400 V
(25020)210 648 A
2034(})S
(else)168 2118 A
2328({)S
5490 V
(25021)210 648 A
2370(sp)S
2496(=)S
(ldir_ptr->i_sp;)630 2580 A
3378(/*)S
('flag')252 3504 A
3798(is)S
(LOOK_UP)294 3924 A
4260(*/)S
5580 V
(25022)210 648 A
(*numb)210 2370 A
2622(=)S
(conv2\(sp->s_native,)798 2706 A
(\(int\))210 3546 A
(dp->d_ino\);)462 3798 A
5670 V
(25023)210 648 A
2034(})S
5760 V
(25024)210 648 A
(put_block\(bp,)546 2034 A
(DIRECTORY_BLOCK\);)714 2622 A
5850 V
(25025)210 648 A
(return\(r\);)420 2034 A
5940 V
(25026)210 648 A
1698(})S
6030 V
(25027)210 648 A
6120 V
(25028)210 648 A
6210 V
(25029)210 648 A
1698(/*)S
(Check)210 1824 A
(for)126 2076 A
(free)168 2244 A
(slot)168 2454 A
(for)126 2664 A
(the)126 2832 A
(benefit)294 3000 A
3336(of)S
(ENTER.)252 3462 A
3756(*/)S
8418 V
EP
%%Page: 345 345
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2151(File:)S
2384(src/fs/path.c)S
12 B
(345)180 4248 A
900 V
7 LST
(25030)210 648 A
1698(if)S
(\(flag)210 1824 A
2076(==)S
(ENTER)210 2202 A
2454(&&)S
(dp->d_ino)378 2580 A
3000(==)S
3126(0\))S
3252({)S
990 V
(25031)210 648 A
(e_hit)210 2034 A
2286(=)S
(TRUE;)210 2370 A
2706(/*)S
2832(we)S
(found)210 2958 A
3210(a)S
(free)168 3294 A
(slot)168 3504 A
3714(*/)S
1080 V
(25032)210 648 A
(break;)252 2034 A
1170 V
(25033)210 648 A
1698(})S
1260 V
(25034)210 648 A
1362(})S
1350 V
(25035)210 648 A
1440 V
(25036)210 648 A
1362(/*)S
(The)126 1488 A
(whole)210 1656 A
(block)210 1908 A
(has)126 2160 A
(been)168 2328 A
(searched)336 2538 A
2916(or)S
(ENTER)210 3042 A
(has)126 3294 A
3462(a)S
(free)168 3546 A
(slot.)210 3756 A
4008(*/)S
1530 V
(25037)210 648 A
1362(if)S
(\(e_hit\))294 1488 A
(break;)252 1824 A
2370(/*)S
(e_hit)210 2496 A
(set)126 2748 A
2916(if)S
(ENTER)210 3042 A
(can)126 3294 A
3462(be)S
(performed)378 3588 A
(now)126 4008 A
4176(*/)S
1620 V
(25038)210 648 A
(put_block\(bp,)546 1362 A
(DIRECTORY_BLOCK\);)714 1950 A
2706(/*)S
(otherwise,)420 2832 A
(continue)336 3294 A
(searching)378 3672 A
(dir)126 4092 A
4260(*/)S
1710 V
(25039)210 648 A
1110(})S
1800 V
(25040)210 648 A
1890 V
(25041)210 648 A
1110(/*)S
(The)126 1236 A
(whole)210 1404 A
(directory)378 1656 A
(has)126 2076 A
(now)126 2244 A
(been)168 2412 A
(searched.)378 2622 A
3042(*/)S
1980 V
(25042)210 648 A
1110(if)S
(\(flag)210 1236 A
1488(!=)S
(ENTER\))252 1614 A
(return\(flag)462 1908 A
2412(==)S
(IS_EMPTY)336 2538 A
2916(?)S
3000(OK)S
3126(:)S
(ENOENT\);)336 3210 A
2070 V
(25043)210 648 A
2160 V
(25044)210 648 A
1110(/*)S
(This)168 1236 A
(call)168 1446 A
1656(is)S
(for)126 1782 A
(ENTER.)252 1950 A
2286(If)S
2412(no)S
(free)168 2538 A
(slot)168 2748 A
(has)126 2958 A
(been)168 3126 A
(found)210 3336 A
3588(so)S
(far,)168 3714 A
(try)126 3924 A
4092(to)S
2250 V
(25045)210 648 A
1152(*)S
(extend)252 1236 A
(directory.)420 1530 A
2340 V
(25046)210 648 A
1152(*/)S
2430 V
(25047)210 648 A
1110(if)S
(\(e_hit)252 1236 A
1530(==)S
(FALSE\))252 1656 A
1950({)S
2034(/*)S
(directory)378 2160 A
2580(is)S
(full)168 2706 A
(and)126 2916 A
3084(no)S
(room)168 3210 A
(left)168 3420 A
3630(in)S
(last)168 3756 A
(block)210 3966 A
4218(*/)S
2520 V
(25048)210 648 A
(new_slots++;)504 1362 A
2370(/*)S
(increase)336 2496 A
(directory)378 2874 A
(size)168 3294 A
3504(by)S
3630(1)S
(entry)210 3714 A
3966(*/)S
2610 V
(25049)210 648 A
1362(if)S
(\(new_slots)420 1488 A
1950(==)S
2076(0\))S
(return\(EFBIG\);)588 2202 A
2832(/*)S
(dir)126 2958 A
(size)168 3126 A
(limited)294 3336 A
3672(by)S
(slot)168 3798 A
(count)210 4008 A
4260(*/)S
2700 V
(25050)210 648 A
1362(if)S
1488(\()S
(\(bp)126 1572 A
1740(=)S
(new_block\(ldir_ptr,)798 1824 A
(ldir_ptr->i_size\)\))756 2664 A
3462(==)S
(NIL_BUF\))336 3588 A
2790 V
(25051)210 648 A
(return\(err_code\);)714 1698 A
2880 V
(25052)210 648 A
1362(dp)S
1488(=)S
(&bp->b_dir[0];)588 1572 A
2970 V
(25053)210 648 A
(extended)336 1362 A
1740(=)S
1824(1;)S
3060 V
(25054)210 648 A
1110(})S
3150 V
(25055)210 648 A
3240 V
(25056)210 648 A
1110(/*)S
('bp')168 1236 A
(now)126 1446 A
(points)252 1614 A
1908(to)S
2034(a)S
(directory)378 2118 A
(block)210 2538 A
(with)168 2790 A
(space.)252 3000 A
('dp')168 3294 A
(points)252 3504 A
3798(to)S
(slot.)210 3924 A
4176(*/)S
3330 V
(25057)210 648 A
(\(void\))252 1110 A
(memset\(dp->d_name,)756 1404 A
2202(0,)S
(\(size_t\))336 2328 A
(NAME_MAX\);)420 2706 A
3168(/*)S
(clear)210 3294 A
(entry)210 3546 A
3798(*/)S
3420 V
(25058)210 648 A
(for)126 1110 A
1278(\(i)S
1404(=)S
1488(0;)S
(string[i])378 1614 A
2034(&&)S
2160(i)S
2244(<)S
(NAME_MAX;)378 2328 A
(i++\))168 2748 A
(dp->d_name[i])546 2958 A
3546(=)S
(string[i];)420 3630 A
3510 V
(25059)210 648 A
1110(sp)S
1236(=)S
(ldir_ptr->i_sp;)630 1320 A
3600 V
(25060)210 648 A
(dp->d_ino)378 1110 A
1530(=)S
(conv2\(sp->s_native,)798 1614 A
(\(int\))210 2454 A
(*numb\);)294 2706 A
3690 V
(25061)210 648 A
(bp->b_dirt)420 1110 A
1572(=)S
(DIRTY;)252 1656 A
3780 V
(25062)210 648 A
(put_block\(bp,)546 1110 A
(DIRECTORY_BLOCK\);)714 1698 A
3870 V
(25063)210 648 A
(ldir_ptr->i_update)756 1110 A
1908(|=)S
(CTIME)210 2034 A
2286(|)S
(MTIME;)252 2370 A
2706(/*)S
(mark)168 2832 A
(mtime)210 3042 A
(for)126 3294 A
(update)252 3462 A
(later)210 3756 A
4008(*/)S
3960 V
(25064)210 648 A
(ldir_ptr->i_dirt)672 1110 A
1824(=)S
(DIRTY;)252 1908 A
4050 V
(25065)210 648 A
1110(if)S
(\(new_slots)420 1236 A
1698(>)S
(old_slots\))420 1782 A
2244({)S
4140 V
(25066)210 648 A
(ldir_ptr->i_size)672 1362 A
2076(=)S
(\(off_t\))294 2160 A
(new_slots)378 2496 A
2916(*)S
(DIR_ENTRY_SIZE;)630 3000 A
4230 V
(25067)210 648 A
1362(/*)S
(Send)168 1488 A
(the)126 1698 A
(change)252 1866 A
2160(to)S
(disk)168 2286 A
2496(if)S
(the)126 2622 A
(directory)378 2790 A
3210(is)S
(extended.)378 3336 A
3756(*/)S
4320 V
(25068)210 648 A
1362(if)S
(\(extended\))420 1488 A
(rw_inode\(ldir_ptr,)756 1950 A
(WRITING\);)378 2748 A
4410 V
(25069)210 648 A
1110(})S
4500 V
(25070)210 648 A
(return\(OK\);)462 1110 A
4590 V
(25071)210 648 A
1026(})S
5040 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5130 V
(src/fs/mount.c)588 2034 A
5220 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
5400 V
(25100)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(performs)336 1572 A
(the)126 1950 A
(MOUNT)210 2118 A
(and)126 2370 A
(UMOUNT)252 2538 A
(system)252 2832 A
(calls.)252 3126 A
5490 V
(25101)210 648 A
1068(*)S
5580 V
(25102)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
5670 V
(25103)210 648 A
1068(*)S
(do_mount:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(MOUNT)210 2202 A
(system)252 2454 A
(call)168 2748 A
5760 V
(25104)210 648 A
1068(*)S
(do_umount:)420 1236 A
(perform)294 1698 A
(the)126 2034 A
(UMOUNT)252 2202 A
(system)252 2496 A
(call)168 2790 A
5850 V
(25105)210 648 A
1068(*/)S
5940 V
(25106)210 648 A
6030 V
(25107)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
6120 V
(25108)210 648 A
(#include)336 1026 A
(<fcntl.h>)378 1404 A
6210 V
(25109)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
8418 V
EP
%%Page: 346 346
BP
/slant 0 def
/height 0 def
630 V
12 B
(346)180 648 A
11 R
2105(File:)S
(src/fs/mount.c)632 2338 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(25110)210 648 A
(#include)336 1026 A
(<sys/stat.h>)504 1404 A
990 V
(25111)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
1080 V
(25112)210 648 A
(#include)336 1026 A
("dev.h")294 1404 A
1170 V
(25113)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
1260 V
(25114)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
1350 V
(25115)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
1440 V
(25116)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
1530 V
(25117)210 648 A
(#include)336 1026 A
("super.h")378 1404 A
1620 V
(25118)210 648 A
1710 V
(25119)210 648 A
(PRIVATE)294 1026 A
(message)294 1362 A
(dev_mess;)378 1698 A
1800 V
(25120)210 648 A
1890 V
(25121)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(dev_t)210 1866 A
(name_to_dev,)504 2118 A
(\(char)210 2664 A
(*path\))252 2916 A
4050(\);)S
1980 V
(25122)210 648 A
2070 V
(25123)210 648 A
(/*===========================================================================*)3276 1026 A
2160 V
(25124)210 648 A
1068(*)S
(do_mount)336 2370 A
4260(*)S
2250 V
(25125)210 648 A
(*===========================================================================*/)3276 1068 A
2340 V
(25126)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_mount\(\))420 1488 A
2430 V
(25127)210 648 A
1026({)S
2520 V
(25128)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(mount\(name,)462 1656 A
(mfile,)252 2160 A
(rd_only\))336 2454 A
(system)252 2832 A
(call.)210 3126 A
3378(*/)S
2610 V
(25129)210 648 A
2700 V
(25130)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip,)210 2034 A
(*root_ip;)378 2286 A
2790 V
(25131)210 648 A
(struct)252 1110 A
(super_block)462 1404 A
(*xp,)168 1908 A
(*sp;)168 2118 A
2880 V
(25132)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
2970 V
(25133)210 648 A
(mode_t)252 1110 A
(bits;)210 1404 A
3060 V
(25134)210 648 A
(int)126 1110 A
(rdir,)210 1278 A
(mdir;)210 1530 A
2370(/*)S
(TRUE)168 2496 A
(iff)126 2706 A
({root|mount})504 2874 A
(file)168 3420 A
3630(is)S
(dir)126 3756 A
3924(*/)S
3150 V
(25135)210 648 A
(int)126 1110 A
1278(r,)S
(found,)252 1404 A
(major,)252 1698 A
(task;)210 1992 A
3240 V
(25136)210 648 A
3330 V
(25137)210 648 A
1110(/*)S
(Only)168 1236 A
(the)126 1446 A
(super-user)420 1614 A
(may)126 2076 A
2244(do)S
(MOUNT.)252 2370 A
2664(*/)S
3420 V
(25138)210 648 A
1110(if)S
(\(!super_user\))546 1236 A
(return\(EPERM\);)588 1824 A
3510 V
(25139)210 648 A
3600 V
(25140)210 648 A
1110(/*)S
1236(If)S
('name')252 1362 A
1656(is)S
(not)126 1782 A
(for)126 1950 A
2118(a)S
(block)210 2202 A
(special)294 2454 A
(file,)210 2790 A
(return)252 3042 A
(error.)252 3336 A
3630(*/)S
3690 V
(25141)210 648 A
1110(if)S
(\(fetch_name\(name1,)756 1236 A
(name1_length,)546 2034 A
(M1\))126 2622 A
2790(!=)S
(OK\))126 2916 A
(return\(err_code\);)714 3084 A
3780 V
(25142)210 648 A
1110(if)S
1236(\()S
(\(dev)168 1320 A
1530(=)S
(name_to_dev\(user_path\)\))966 1614 A
2622(==)S
(NO_DEV\))294 2748 A
(return\(err_code\);)714 3084 A
3870 V
(25143)210 648 A
3960 V
(25144)210 648 A
1110(/*)S
(Scan)168 1236 A
(super)210 1446 A
(block)210 1698 A
(table)210 1950 A
2202(to)S
(see)126 2328 A
2496(if)S
(dev)126 2622 A
(already)294 2790 A
(mounted)294 3126 A
3462(&)S
(find)168 3546 A
3756(a)S
(free)168 3840 A
(slot.*/)294 4050 A
4050 V
(25145)210 648 A
1110(sp)S
1236(=)S
(NIL_SUPER;)420 1320 A
4140 V
(25146)210 648 A
(found)210 1110 A
1362(=)S
(FALSE;)252 1446 A
4230 V
(25147)210 648 A
(for)126 1110 A
(\(xp)126 1278 A
1446(=)S
(&super_block[0];)672 1530 A
2244(xp)S
2370(<)S
(&super_block[NR_SUPERS];)1008 2454 A
(xp++\))210 3504 A
3756({)S
4320 V
(25148)210 648 A
1362(if)S
(\(xp->s_dev)420 1488 A
1950(==)S
(dev\))168 2076 A
(found)210 2286 A
2538(=)S
(TRUE;)210 2622 A
3042(/*)S
3168(is)S
3294(it)S
(mounted)294 3420 A
(already?)336 3756 A
4134(*/)S
4410 V
(25149)210 648 A
1362(if)S
(\(xp->s_dev)420 1488 A
1950(==)S
(NO_DEV\))294 2076 A
2412(sp)S
2538(=)S
(xp;)126 2622 A
3042(/*)S
(record)252 3168 A
(free)168 3462 A
(slot)168 3672 A
3882(*/)S
4500 V
(25150)210 648 A
1110(})S
4590 V
(25151)210 648 A
1110(if)S
(\(found\))294 1236 A
(return\(EBUSY\);)588 1572 A
2370(/*)S
(already)294 2496 A
(mounted)294 2832 A
3168(*/)S
4680 V
(25152)210 648 A
1110(if)S
(\(sp)126 1236 A
1404(==)S
(NIL_SUPER\))420 1530 A
(return\(ENFILE\);)630 1992 A
2706(/*)S
2832(no)S
(super)210 2958 A
(block)210 3210 A
(available)378 3462 A
3882(*/)S
4770 V
(25153)210 648 A
4860 V
(25154)210 648 A
(dev_mess.m_type)630 1110 A
1782(=)S
(DEV_OPEN;)378 1866 A
2706(/*)S
(distinguish)462 2832 A
(from)168 3336 A
(close)210 3546 A
3798(*/)S
4950 V
(25155)210 648 A
(dev_mess.DEVICE)630 1110 A
1782(=)S
(dev;)168 1866 A
2706(/*)S
(Touch)210 2832 A
(the)126 3084 A
(device.)294 3252 A
3588(*/)S
5040 V
(25156)210 648 A
1110(if)S
(\(rd_only\))378 1236 A
(dev_mess.COUNT)588 1656 A
2286(=)S
(R_BIT;)252 2370 A
5130 V
(25157)210 648 A
(else)168 1110 A
(dev_mess.COUNT)588 1362 A
1992(=)S
(R_BIT|W_BIT;)504 2076 A
5220 V
(25158)210 648 A
5310 V
(25159)210 648 A
(major)210 1110 A
1362(=)S
(\(dev)168 1446 A
1656(>>)S
(MAJOR\))252 1782 A
2076(&)S
(BYTE;)210 2160 A
5400 V
(25160)210 648 A
1110(if)S
(\(major)252 1236 A
1530(<=)S
1656(0)S
1740(||)S
(major)210 1866 A
2118(>=)S
(max_major\))420 2244 A
(return\(ENODEV\);)630 2706 A
5490 V
(25161)210 648 A
(task)168 1110 A
1320(=)S
(dmap[major].dmap_task;)924 1404 A
2706(/*)S
(device)252 2832 A
(task)168 3126 A
3336(nr)S
3462(*/)S
5580 V
(25162)210 648 A
(\(*dmap[major].dmap_open\)\(task,)1260 1110 A
(&dev_mess\);)462 2412 A
5670 V
(25163)210 648 A
1110(if)S
(\(dev_mess.REP_STATUS)840 1236 A
2118(!=)S
(OK\))126 2244 A
(return\(EINVAL\);)630 2412 A
5760 V
(25164)210 648 A
5850 V
(25165)210 648 A
1110(/*)S
(Fill)168 1236 A
1446(in)S
(the)126 1572 A
(super)210 1740 A
(block.)252 1992 A
2286(*/)S
5940 V
(25166)210 648 A
(sp->s_dev)378 1110 A
1530(=)S
(dev;)168 1614 A
2370(/*)S
(read_super\(\))504 2496 A
(needs)210 3042 A
3294(to)S
(know)168 3420 A
(which)210 3630 A
(dev)126 3882 A
4050(*/)S
6030 V
(25167)210 648 A
1110(r)S
1194(=)S
(read_super\(sp\);)630 1278 A
6120 V
(25168)210 648 A
6210 V
(25169)210 648 A
1110(/*)S
1236(Is)S
1362(it)S
(recognized)420 1488 A
1950(as)S
2076(a)S
(Minix)210 2160 A
(filesystem?)462 2412 A
2916(*/)S
8418 V
EP
%%Page: 347 347
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2105(File:)S
(src/fs/mount.c)632 2338 A
12 B
(347)180 4248 A
900 V
7 LST
(25170)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
1656({)S
990 V
(25171)210 648 A
(dev_mess.m_type)630 1362 A
2034(=)S
(DEV_CLOSE;)420 2118 A
1080 V
(25172)210 648 A
(dev_mess.DEVICE)630 1362 A
2034(=)S
(dev;)168 2118 A
1170 V
(25173)210 648 A
(\(*dmap[major].dmap_close\)\(task,)1302 1362 A
(&dev_mess\);)462 2706 A
1260 V
(25174)210 648 A
(return\(r\);)420 1362 A
1350 V
(25175)210 648 A
1110(})S
1440 V
(25176)210 648 A
1530 V
(25177)210 648 A
1110(/*)S
(Now)126 1236 A
(get)126 1404 A
(the)126 1572 A
(inode)210 1740 A
1992(of)S
(the)126 2118 A
(file)168 2286 A
2496(to)S
2622(be)S
(mounted)294 2748 A
(on.)126 3084 A
3252(*/)S
1620 V
(25178)210 648 A
1110(if)S
(\(fetch_name\(name2,)756 1236 A
(name2_length,)546 2034 A
(M1\))126 2622 A
2790(!=)S
(OK\))126 2916 A
3084({)S
1710 V
(25179)210 648 A
(sp->s_dev)378 1362 A
1782(=)S
(NO_DEV;)294 1866 A
1800 V
(25180)210 648 A
(dev_mess.m_type)630 1362 A
2034(=)S
(DEV_CLOSE;)420 2118 A
1890 V
(25181)210 648 A
(dev_mess.DEVICE)630 1362 A
2034(=)S
(dev;)168 2118 A
1980 V
(25182)210 648 A
(\(*dmap[major].dmap_close\)\(task,)1302 1362 A
(&dev_mess\);)462 2706 A
2070 V
(25183)210 648 A
(return\(err_code\);)714 1362 A
2160 V
(25184)210 648 A
1110(})S
2250 V
(25185)210 648 A
1110(if)S
1236(\()S
(\(rip)168 1320 A
1530(=)S
(eat_path\(user_path\)\))840 1614 A
2496(==)S
(NIL_INODE\))420 2622 A
3084({)S
2340 V
(25186)210 648 A
(sp->s_dev)378 1362 A
1782(=)S
(NO_DEV;)294 1866 A
2430 V
(25187)210 648 A
(dev_mess.m_type)630 1362 A
2034(=)S
(DEV_CLOSE;)420 2118 A
2520 V
(25188)210 648 A
(dev_mess.DEVICE)630 1362 A
2034(=)S
(dev;)168 2118 A
2610 V
(25189)210 648 A
(\(*dmap[major].dmap_close\)\(task,)1302 1362 A
(&dev_mess\);)462 2706 A
2700 V
(25190)210 648 A
(return\(err_code\);)714 1362 A
2790 V
(25191)210 648 A
1110(})S
2880 V
(25192)210 648 A
2970 V
(25193)210 648 A
1110(/*)S
1236(It)S
(may)126 1362 A
(not)126 1530 A
1698(be)S
(busy.)210 1824 A
2076(*/)S
3060 V
(25194)210 648 A
1110(r)S
1194(=)S
(OK;)126 1278 A
3150 V
(25195)210 648 A
1110(if)S
(\(rip->i_count)546 1236 A
1824(>)S
1908(1\))S
2034(r)S
2118(=)S
(EBUSY;)252 2202 A
3240 V
(25196)210 648 A
3330 V
(25197)210 648 A
1110(/*)S
1236(It)S
(may)126 1362 A
(not)126 1530 A
1698(be)S
(special.)336 1824 A
2202(*/)S
3420 V
(25198)210 648 A
(bits)168 1110 A
1320(=)S
(rip->i_mode)462 1404 A
1908(&)S
(I_TYPE;)294 1992 A
3510 V
(25199)210 648 A
1110(if)S
(\(bits)210 1236 A
1488(==)S
(I_BLOCK_SPECIAL)630 1614 A
2286(||)S
(bits)168 2412 A
2622(==)S
(I_CHAR_SPECIAL\))630 2748 A
3420(r)S
3504(=)S
(ENOTDIR;)336 3588 A
3600 V
(25200)210 648 A
3690 V
(25201)210 648 A
1110(/*)S
(Get)126 1236 A
(the)126 1404 A
(root)168 1572 A
(inode)210 1782 A
2034(of)S
(the)126 2160 A
(mounted)294 2328 A
(file)168 2664 A
(system.)294 2874 A
3210(*/)S
3780 V
(25202)210 648 A
(root_ip)294 1110 A
1446(=)S
(NIL_INODE;)420 1530 A
2370(/*)S
2496(if)S
('r')126 2622 A
(not)126 2790 A
(OK,)126 2958 A
(make)168 3126 A
(sure)168 3336 A
(this)168 3546 A
3756(is)S
(defined)294 3882 A
4218(*/)S
3870 V
(25203)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
3960 V
(25204)210 648 A
1362(if)S
1488(\()S
(\(root_ip)336 1572 A
1950(=)S
(get_inode\(dev,)588 2034 A
(ROOT_INODE\)\))504 2664 A
3210(==)S
(NIL_INODE\))420 3336 A
3798(r)S
3882(=)S
(err_code;)378 3966 A
4050 V
(25205)210 648 A
1110(})S
4140 V
(25206)210 648 A
1110(if)S
(\(root_ip)336 1236 A
1614(!=)S
(NIL_INODE)378 1740 A
2160(&&)S
(root_ip->i_mode)630 2286 A
2958(==)S
3084(0\))S
3210(r)S
3294(=)S
(EINVAL;)294 3378 A
4230 V
(25207)210 648 A
4320 V
(25208)210 648 A
1110(/*)S
(File)168 1236 A
(types)210 1446 A
1698(of)S
('rip')210 1824 A
(and)126 2076 A
('root_ip')378 2244 A
(may)126 2664 A
(not)126 2832 A
(conflict.)378 3000 A
3420(*/)S
4410 V
(25209)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
4500 V
(25210)210 648 A
(mdir)168 1362 A
1572(=)S
(\(\(rip->i_mode)546 1656 A
2244(&)S
(I_TYPE\))294 2328 A
2664(==)S
(I_DIRECTORY\);)546 2790 A
3420(/*)S
(TRUE)168 3546 A
(iff)126 3756 A
(dir)126 3924 A
4092(*/)S
4590 V
(25211)210 648 A
(rdir)168 1362 A
1572(=)S
(\(\(root_ip->i_mode)714 1656 A
2412(&)S
(I_TYPE\))294 2496 A
2832(==)S
(I_DIRECTORY\);)546 2958 A
4680 V
(25212)210 648 A
1362(if)S
(\(!mdir)252 1488 A
1782(&&)S
(rdir\))210 1908 A
2160(r)S
2244(=)S
(EISDIR;)294 2328 A
4770 V
(25213)210 648 A
1110(})S
4860 V
(25214)210 648 A
4950 V
(25215)210 648 A
1110(/*)S
1236(If)S
(error,)252 1362 A
(return)252 1656 A
(the)126 1950 A
(super)210 2118 A
(block)210 2370 A
(and)126 2622 A
(both)168 2790 A
(inodes;)294 3000 A
(release)294 3336 A
(the)126 3672 A
(maps.)210 3840 A
4092(*/)S
5040 V
(25216)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
1656({)S
5130 V
(25217)210 648 A
(put_inode\(rip\);)630 1362 A
5220 V
(25218)210 648 A
(put_inode\(root_ip\);)798 1362 A
5310 V
(25219)210 648 A
(\(void\))252 1362 A
(do_sync\(\);)420 1656 A
5400 V
(25220)210 648 A
(invalidate\(dev\);)672 1362 A
5490 V
(25221)210 648 A
5580 V
(25222)210 648 A
(sp->s_dev)378 1362 A
1782(=)S
(NO_DEV;)294 1866 A
5670 V
(25223)210 648 A
(dev_mess.m_type)630 1362 A
2034(=)S
(DEV_CLOSE;)420 2118 A
5760 V
(25224)210 648 A
(dev_mess.DEVICE)630 1362 A
2034(=)S
(dev;)168 2118 A
5850 V
(25225)210 648 A
(\(*dmap[major].dmap_close\)\(task,)1302 1362 A
(&dev_mess\);)462 2706 A
5940 V
(25226)210 648 A
(return\(r\);)420 1362 A
6030 V
(25227)210 648 A
1110(})S
6120 V
(25228)210 648 A
6210 V
(25229)210 648 A
1110(/*)S
(Nothing)294 1236 A
(else)168 1572 A
(can)126 1782 A
1950(go)S
(wrong.)252 2076 A
(Perform)294 2412 A
(the)126 2748 A
(mount.)252 2916 A
3210(*/)S
8418 V
EP
%%Page: 348 348
BP
/slant 0 def
/height 0 def
630 V
12 B
(348)180 648 A
11 R
2105(File:)S
(src/fs/mount.c)632 2338 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(25230)210 648 A
(rip->i_mount)504 1110 A
1656(=)S
(I_MOUNT;)336 1740 A
2370(/*)S
(this)168 2496 A
(bit)126 2706 A
(says)168 2874 A
(the)126 3084 A
(inode)210 3252 A
3504(is)S
(mounted)294 3630 A
3966(on)S
4092(*/)S
990 V
(25231)210 648 A
(sp->s_imount)504 1110 A
1656(=)S
(rip;)168 1740 A
1080 V
(25232)210 648 A
(sp->s_isup)420 1110 A
1572(=)S
(root_ip;)336 1656 A
1170 V
(25233)210 648 A
(sp->s_rd_only)546 1110 A
1698(=)S
(rd_only;)336 1782 A
1260 V
(25234)210 648 A
(return\(OK\);)462 1110 A
1350 V
(25235)210 648 A
1026(})S
1620 V
(25238)210 648 A
(/*===========================================================================*)3276 1026 A
1710 V
(25239)210 648 A
1068(*)S
(do_umount)378 2370 A
4260(*)S
1800 V
(25240)210 648 A
(*===========================================================================*/)3276 1068 A
1890 V
(25241)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_umount\(\))462 1488 A
1980 V
(25242)210 648 A
1026({)S
2070 V
(25243)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(umount\(name\))504 1656 A
(system)252 2202 A
(call.)210 2496 A
2748(*/)S
2160 V
(25244)210 648 A
2250 V
(25245)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
2340 V
(25246)210 648 A
(struct)252 1110 A
(super_block)462 1404 A
(*sp,)168 1908 A
(*sp1;)210 2118 A
2430 V
(25247)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
2520 V
(25248)210 648 A
(int)126 1110 A
(count;)252 1278 A
2610 V
(25249)210 648 A
(int)126 1110 A
(major,)252 1278 A
(task;)210 1572 A
2700 V
(25250)210 648 A
2790 V
(25251)210 648 A
1110(/*)S
(Only)168 1236 A
(the)126 1446 A
(super-user)420 1614 A
(may)126 2076 A
2244(do)S
(UMOUNT.)294 2370 A
2706(*/)S
2880 V
(25252)210 648 A
1110(if)S
(\(!super_user\))546 1236 A
(return\(EPERM\);)588 1824 A
2970 V
(25253)210 648 A
3060 V
(25254)210 648 A
1110(/*)S
1236(If)S
('name')252 1362 A
1656(is)S
(not)126 1782 A
(for)126 1950 A
2118(a)S
(block)210 2202 A
(special)294 2454 A
(file,)210 2790 A
(return)252 3042 A
(error.)252 3336 A
3630(*/)S
3150 V
(25255)210 648 A
1110(if)S
(\(fetch_name\(name,)714 1236 A
(name_length,)504 1992 A
(M3\))126 2538 A
2706(!=)S
(OK\))126 2832 A
(return\(err_code\);)714 3000 A
3240 V
(25256)210 648 A
1110(if)S
1236(\()S
(\(dev)168 1320 A
1530(=)S
(name_to_dev\(user_path\)\))966 1614 A
2622(==)S
(NO_DEV\))294 2748 A
(return\(err_code\);)714 3084 A
3330 V
(25257)210 648 A
3420 V
(25258)210 648 A
1110(/*)S
(See)126 1236 A
1404(if)S
(the)126 1530 A
(mounted)294 1698 A
(device)252 2034 A
2328(is)S
(busy.)210 2454 A
(Only)168 2748 A
2958(1)S
(inode)210 3042 A
(using)210 3294 A
3546(it)S
(should)252 3672 A
3966(be)S
3510 V
(25259)210 648 A
1152(*)S
(open)168 1236 A
1446(--)S
(the)126 1572 A
(root)168 1740 A
(inode)210 1950 A
2202(--)S
(and)126 2328 A
(that)168 2496 A
(inode)210 2706 A
(only)168 2958 A
3168(1)S
(time.)210 3252 A
3600 V
(25260)210 648 A
1152(*/)S
3690 V
(25261)210 648 A
(count)210 1110 A
1362(=)S
1446(0;)S
3780 V
(25262)210 648 A
(for)126 1110 A
(\(rip)168 1278 A
1488(=)S
(&inode[0];)420 1572 A
(rip<)168 2034 A
(&inode[NR_INODES];)756 2244 A
(rip++\))252 3042 A
3870 V
(25263)210 648 A
1362(if)S
(\(rip->i_count)546 1488 A
2076(>)S
2160(0)S
2244(&&)S
(rip->i_dev)420 2370 A
2832(==)S
(dev\))168 2958 A
(count)210 3168 A
3420(+=)S
(rip->i_count;)546 3546 A
3960 V
(25264)210 648 A
1110(if)S
(\(count)252 1236 A
1530(>)S
1614(1\))S
(return\(EBUSY\);)588 1740 A
2370(/*)S
(can't)210 2496 A
(umount)252 2748 A
3042(a)S
(busy)168 3126 A
(file)168 3336 A
(system)252 3546 A
3840(*/)S
4050 V
(25265)210 648 A
4140 V
(25266)210 648 A
1110(/*)S
(Find)168 1236 A
(the)126 1446 A
(super)210 1614 A
(block.)252 1866 A
2160(*/)S
4230 V
(25267)210 648 A
1110(sp)S
1236(=)S
(NIL_SUPER;)420 1320 A
4320 V
(25268)210 648 A
(for)126 1110 A
(\(sp1)168 1278 A
1488(=)S
(&super_block[0];)672 1572 A
(sp1)126 2286 A
2454(<)S
(&super_block[NR_SUPERS];)1008 2538 A
(sp1++\))252 3588 A
3882({)S
4410 V
(25269)210 648 A
1362(if)S
(\(sp1->s_dev)462 1488 A
1992(==)S
(dev\))168 2118 A
2328({)S
4500 V
(25270)210 648 A
1698(sp)S
1824(=)S
(sp1;)168 1908 A
4590 V
(25271)210 648 A
(break;)252 1698 A
4680 V
(25272)210 648 A
1362(})S
4770 V
(25273)210 648 A
1110(})S
4860 V
(25274)210 648 A
4950 V
(25275)210 648 A
1110(/*)S
(Sync)168 1236 A
(the)126 1446 A
(disk,)210 1614 A
(and)126 1866 A
(invalidate)420 2034 A
(cache.)252 2496 A
2790(*/)S
5040 V
(25276)210 648 A
(\(void\))252 1110 A
(do_sync\(\);)420 1404 A
2370(/*)S
(force)210 2496 A
(any)126 2748 A
(cached)252 2916 A
(blocks)252 3210 A
(out)126 3504 A
3672(of)S
(memory)252 3798 A
4092(*/)S
5130 V
(25277)210 648 A
(invalidate\(dev\);)672 1110 A
2370(/*)S
(invalidate)420 2496 A
(cache)210 2958 A
(entries)294 3210 A
(for)126 3546 A
(this)168 3714 A
(dev)126 3924 A
4092(*/)S
5220 V
(25278)210 648 A
1110(if)S
(\(sp)126 1236 A
1404(==)S
(NIL_SUPER\))420 1530 A
(return\(EINVAL\);)630 1992 A
5310 V
(25279)210 648 A
5400 V
(25280)210 648 A
(major)210 1110 A
1362(=)S
(\(dev)168 1446 A
1656(>>)S
(MAJOR\))252 1782 A
2076(&)S
(BYTE;)210 2160 A
2706(/*)S
(major)210 2832 A
(device)252 3084 A
3378(nr)S
3504(*/)S
5490 V
(25281)210 648 A
(task)168 1110 A
1320(=)S
(dmap[major].dmap_task;)924 1404 A
2370(/*)S
(device)252 2496 A
(task)168 2790 A
3000(nr)S
3126(*/)S
5580 V
(25282)210 648 A
(dev_mess.m_type)630 1110 A
1782(=)S
(DEV_CLOSE;)420 1866 A
2706(/*)S
(distinguish)462 2832 A
(from)168 3336 A
(open)168 3546 A
3756(*/)S
5670 V
(25283)210 648 A
(dev_mess.DEVICE)630 1110 A
1782(=)S
(dev;)168 1866 A
5760 V
(25284)210 648 A
(\(*dmap[major].dmap_close\)\(task,)1302 1110 A
(&dev_mess\);)462 2454 A
5850 V
(25285)210 648 A
5940 V
(25286)210 648 A
1110(/*)S
(Finish)252 1236 A
(off)126 1530 A
(the)126 1698 A
(unmount.)336 1866 A
2244(*/)S
6030 V
(25287)210 648 A
(sp->s_imount->i_mount)882 1110 A
2034(=)S
(NO_MOUNT;)378 2118 A
2706(/*)S
(inode)210 2832 A
(returns)294 3084 A
3420(to)S
(normal)252 3546 A
3840(*/)S
6120 V
(25288)210 648 A
(put_inode\(sp->s_imount\);)1008 1110 A
2370(/*)S
(release)294 2496 A
(the)126 2832 A
(inode)210 3000 A
(mounted)294 3252 A
3588(on)S
3714(*/)S
6210 V
(25289)210 648 A
(put_inode\(sp->s_isup\);)924 1110 A
2370(/*)S
(release)294 2496 A
(the)126 2832 A
(root)168 3000 A
(inode)210 3210 A
3462(of)S
(the)126 3588 A
(mounted)294 3756 A
4092(fs)S
4218(*/)S
8418 V
EP
%%Page: 349 349
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2105(File:)S
(src/fs/mount.c)632 2338 A
12 B
(349)180 4248 A
900 V
7 LST
(25290)210 648 A
(sp->s_imount)504 1110 A
1656(=)S
(NIL_INODE;)420 1740 A
990 V
(25291)210 648 A
(sp->s_dev)378 1110 A
1530(=)S
(NO_DEV;)294 1614 A
1080 V
(25292)210 648 A
(return\(OK\);)462 1110 A
1170 V
(25293)210 648 A
1026(})S
1440 V
(25296)210 648 A
(/*===========================================================================*)3276 1026 A
1530 V
(25297)210 648 A
1068(*)S
(name_to_dev)462 2370 A
4260(*)S
1620 V
(25298)210 648 A
(*===========================================================================*/)3276 1068 A
1710 V
(25299)210 648 A
(PRIVATE)294 1026 A
(dev_t)210 1362 A
(name_to_dev\(path\))714 1614 A
1800 V
(25300)210 648 A
(char)168 1026 A
(*path;)252 1236 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(path)168 2958 A
(name)168 3168 A
3378(*/)S
1890 V
(25301)210 648 A
1026({)S
1980 V
(25302)210 648 A
1026(/*)S
(Convert)294 1152 A
(the)126 1488 A
(block)210 1656 A
(special)294 1908 A
(file)168 2244 A
('path')252 2454 A
2748(to)S
2874(a)S
(device)252 2958 A
(number.)294 3252 A
3630(If)S
('path')252 3756 A
2070 V
(25303)210 648 A
1068(*)S
1152(is)S
(not)126 1278 A
1446(a)S
(block)210 1530 A
(special)294 1782 A
(file,)210 2118 A
(return)252 2370 A
(error)210 2664 A
(code)168 2916 A
3126(in)S
('err_code'.)462 3252 A
2160 V
(25304)210 648 A
1068(*/)S
2250 V
(25305)210 648 A
2340 V
(25306)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
2430 V
(25307)210 648 A
(register)336 1110 A
(dev_t)210 1488 A
(dev;)168 1740 A
2520 V
(25308)210 648 A
2610 V
(25309)210 648 A
1110(/*)S
1236(If)S
('path')252 1362 A
(can't)210 1656 A
1908(be)S
(opened,)294 2034 A
(give)168 2370 A
2580(up)S
(immediately.)504 2706 A
3252(*/)S
2700 V
(25310)210 648 A
1110(if)S
1236(\()S
(\(rip)168 1320 A
1530(=)S
(eat_path\(path\)\))630 1614 A
2286(==)S
(NIL_INODE\))420 2412 A
(return\(NO_DEV\);)630 2874 A
2790 V
(25311)210 648 A
2880 V
(25312)210 648 A
1110(/*)S
1236(If)S
('path')252 1362 A
1656(is)S
(not)126 1782 A
1950(a)S
(block)210 2034 A
(special)294 2286 A
(file,)210 2622 A
(return)252 2874 A
(error.)252 3168 A
3462(*/)S
2970 V
(25313)210 648 A
1110(if)S
1236(\()S
(\(rip->i_mode)504 1320 A
1866(&)S
(I_TYPE\))294 1950 A
2286(!=)S
(I_BLOCK_SPECIAL\))672 2412 A
3126({)S
3060 V
(25314)210 648 A
(err_code)336 1362 A
1740(=)S
(ENOTBLK;)336 1824 A
3150 V
(25315)210 648 A
(put_inode\(rip\);)630 1362 A
3240 V
(25316)210 648 A
(return\(NO_DEV\);)630 1362 A
3330 V
(25317)210 648 A
1110(})S
3420 V
(25318)210 648 A
3510 V
(25319)210 648 A
1110(/*)S
(Extract)294 1236 A
(the)126 1572 A
(device)252 1740 A
(number.)294 2034 A
2370(*/)S
3600 V
(25320)210 648 A
(dev)126 1110 A
1278(=)S
(\(dev_t\))294 1362 A
(rip->i_zone[0];)630 1698 A
3690 V
(25321)210 648 A
(put_inode\(rip\);)630 1110 A
3780 V
(25322)210 648 A
(return\(dev\);)504 1110 A
3870 V
(25323)210 648 A
1026(})S
4140 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4230 V
(src/fs/link.c)546 2034 A
4320 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4500 V
(25400)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(handles)294 1572 A
(the)126 1908 A
(LINK)168 2076 A
(and)126 2286 A
(UNLINK)252 2454 A
(system)252 2748 A
(calls.)252 3042 A
3378(It)S
(also)168 3504 A
(deals)210 3714 A
(with)168 3966 A
4590 V
(25401)210 648 A
1068(*)S
(deallocating)504 1152 A
(the)126 1698 A
(storage)294 1866 A
(used)168 2202 A
2412(by)S
2538(a)S
(file)168 2622 A
(when)168 2832 A
(the)126 3042 A
(last)168 3210 A
(UNLINK)252 3420 A
3714(is)S
(done)168 3840 A
4050(to)S
4176(a)S
4680 V
(25402)210 648 A
1068(*)S
(file)168 1152 A
(and)126 1362 A
(the)126 1530 A
(blocks)252 1698 A
(must)168 1992 A
2202(be)S
(returned)336 2328 A
2706(to)S
(the)126 2832 A
(free)168 3000 A
(block)210 3210 A
(pool.)210 3462 A
4770 V
(25403)210 648 A
1068(*)S
4860 V
(25404)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
4950 V
(25405)210 648 A
1068(*)S
(do_link:)336 1236 A
(perform)294 1698 A
(the)126 2034 A
(LINK)168 2202 A
(system)252 2412 A
(call)168 2706 A
5040 V
(25406)210 648 A
1068(*)S
(do_unlink:)420 1236 A
(perform)294 1698 A
(the)126 2034 A
(UNLINK)252 2202 A
(and)126 2496 A
(RMDIR)210 2664 A
(system)252 2916 A
(calls)210 3210 A
5130 V
(25407)210 648 A
1068(*)S
(do_rename:)420 1236 A
(perform)294 1698 A
(the)126 2034 A
(RENAME)252 2202 A
(system)252 2496 A
(call)168 2790 A
5220 V
(25408)210 648 A
1068(*)S
(truncate:)378 1236 A
(release)294 1698 A
(all)126 2034 A
(the)126 2202 A
(blocks)252 2370 A
(associated)420 2664 A
(with)168 3126 A
3336(an)S
(inode)210 3462 A
5310 V
(25409)210 648 A
1068(*/)S
5400 V
(25410)210 648 A
5490 V
(25411)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
5580 V
(25412)210 648 A
(#include)336 1026 A
(<sys/stat.h>)504 1404 A
5670 V
(25413)210 648 A
(#include)336 1026 A
(<string.h>)420 1404 A
5760 V
(25414)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
5850 V
(25415)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
5940 V
(25416)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
6030 V
(25417)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
6120 V
(25418)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
6210 V
(25419)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
8418 V
EP
%%Page: 350 350
BP
/slant 0 def
/height 0 def
630 V
12 B
(350)180 648 A
11 R
2160(File:)S
(src/fs/link.c)522 2393 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(25420)210 648 A
(#include)336 1026 A
("super.h")378 1404 A
990 V
(25421)210 648 A
1080 V
(25422)210 648 A
(#define)294 1026 A
(SAME)168 1362 A
(1000)168 1572 A
1170 V
(25423)210 648 A
1260 V
(25424)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(remove_dir,)462 2034 A
(\(struct)294 2538 A
(inode)210 2874 A
(*rldirp,)336 3126 A
(struct)252 3504 A
(inode)210 3798 A
(*rip,)210 4050 A
1350 V
(25425)210 648 A
(char)168 2034 A
(dir_name[NAME_MAX]\))798 2244 A
4050(\);)S
1440 V
(25426)210 648 A
1530 V
(25427)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(unlink_file,)504 2034 A
(\(struct)294 2580 A
(inode)210 2916 A
(*dirp,)252 3168 A
(struct)252 3462 A
(inode)210 3756 A
(*rip,)210 4008 A
1620 V
(25428)210 648 A
(char)168 2034 A
(file_name[NAME_MAX]\))840 2244 A
4050(\);)S
1710 V
(25429)210 648 A
1800 V
(25430)210 648 A
1890 V
(25431)210 648 A
(/*===========================================================================*)3276 1026 A
1980 V
(25432)210 648 A
1068(*)S
(do_link)294 2370 A
4260(*)S
2070 V
(25433)210 648 A
(*===========================================================================*/)3276 1068 A
2160 V
(25434)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_link\(\))378 1488 A
2250 V
(25435)210 648 A
1026({)S
2340 V
(25436)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(link\(name1,)462 1656 A
(name2\))252 2160 A
(system)252 2454 A
(call.)210 2748 A
3000(*/)S
2430 V
(25437)210 648 A
2520 V
(25438)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*ip,)168 2034 A
(*rip;)210 2244 A
2610 V
(25439)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(r;)S
2700 V
(25440)210 648 A
(char)168 1110 A
(string[NAME_MAX];)714 1320 A
2790 V
(25441)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*new_ip;)336 1656 A
2880 V
(25442)210 648 A
2970 V
(25443)210 648 A
1110(/*)S
(See)126 1236 A
1404(if)S
('name')252 1530 A
(\(file)210 1824 A
2076(to)S
2202(be)S
(linked\))294 2328 A
(exists.)294 2664 A
3000(*/)S
3060 V
(25444)210 648 A
1110(if)S
(\(fetch_name\(name1,)756 1236 A
(name1_length,)546 2034 A
(M1\))126 2622 A
2790(!=)S
(OK\))126 2916 A
(return\(err_code\);)714 3084 A
3150 V
(25445)210 648 A
1110(if)S
1236(\()S
(\(rip)168 1320 A
1530(=)S
(eat_path\(user_path\)\))840 1614 A
2496(==)S
(NIL_INODE\))420 2622 A
(return\(err_code\);)714 3084 A
3240 V
(25446)210 648 A
3330 V
(25447)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
(the)126 1908 A
(file)168 2076 A
(has)126 2286 A
(maximum)294 2454 A
(number)252 2790 A
3084(of)S
(links)210 3210 A
(already.)336 3462 A
3840(*/)S
3420 V
(25448)210 648 A
1110(r)S
1194(=)S
(OK;)126 1278 A
3510 V
(25449)210 648 A
1110(if)S
1236(\()S
(\(rip->i_nlinks)588 1320 A
1950(&)S
(BYTE\))210 2034 A
2286(>=)S
(LINK_MAX\))378 2412 A
2832(r)S
2916(=)S
(EMLINK;)294 3000 A
3600 V
(25450)210 648 A
3690 V
(25451)210 648 A
1110(/*)S
(Only)168 1236 A
(super_user)420 1446 A
(may)126 1908 A
(link)168 2076 A
2286(to)S
(directories.)504 2412 A
2958(*/)S
3780 V
(25452)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
3870 V
(25453)210 648 A
1362(if)S
1488(\()S
(\(rip->i_mode)504 1572 A
2118(&)S
(I_TYPE\))294 2202 A
2538(==)S
(I_DIRECTORY)462 2664 A
3168(&&)S
(!super_user\))504 3294 A
3840(r)S
3924(=)S
(EPERM;)252 4008 A
3960 V
(25454)210 648 A
4050 V
(25455)210 648 A
1110(/*)S
1236(If)S
(error)210 1362 A
(with)168 1614 A
('name',)294 1824 A
(return)252 2160 A
(the)126 2454 A
(inode.)252 2622 A
2916(*/)S
4140 V
(25456)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
1656({)S
4230 V
(25457)210 648 A
(put_inode\(rip\);)630 1362 A
4320 V
(25458)210 648 A
(return\(r\);)420 1362 A
4410 V
(25459)210 648 A
1110(})S
4500 V
(25460)210 648 A
4590 V
(25461)210 648 A
1110(/*)S
(Does)168 1236 A
(the)126 1446 A
(final)210 1614 A
(directory)378 1866 A
2286(of)S
('name2')294 2412 A
(exist?)252 2748 A
3042(*/)S
4680 V
(25462)210 648 A
1110(if)S
(\(fetch_name\(name2,)756 1236 A
(name2_length,)546 2034 A
(M1\))126 2622 A
2790(!=)S
(OK\))126 2916 A
3084({)S
4770 V
(25463)210 648 A
(put_inode\(rip\);)630 1362 A
4860 V
(25464)210 648 A
(return\(err_code\);)714 1362 A
4950 V
(25465)210 648 A
1110(})S
5040 V
(25466)210 648 A
1110(if)S
1236(\()S
(\(ip)126 1320 A
1488(=)S
(last_dir\(user_path,)798 1572 A
(string\)\))336 2412 A
2790(==)S
(NIL_INODE\))420 2916 A
3378(r)S
3462(=)S
(err_code;)378 3546 A
5130 V
(25467)210 648 A
5220 V
(25468)210 648 A
1110(/*)S
1236(If)S
('name2')294 1362 A
(exists)252 1698 A
1992(in)S
(full)168 2118 A
(\(even)210 2328 A
2580(if)S
2706(no)S
(space\))252 2832 A
(set)126 3126 A
('r')126 3294 A
3462(to)S
(error.)252 3588 A
3882(*/)S
5310 V
(25469)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
5400 V
(25470)210 648 A
1362(if)S
1488(\()S
(\(new_ip)294 1572 A
1908(=)S
(advance\(ip,)462 1992 A
(string\)\))336 2496 A
2874(==)S
(NIL_INODE\))420 3000 A
3462({)S
5490 V
(25471)210 648 A
1698(r)S
1782(=)S
(err_code;)378 1866 A
5580 V
(25472)210 648 A
1698(if)S
1824(\(r)S
1950(==)S
(ENOENT\))294 2076 A
2412(r)S
2496(=)S
(OK;)126 2580 A
5670 V
(25473)210 648 A
1362(})S
(else)168 1446 A
1656({)S
5760 V
(25474)210 648 A
(put_inode\(new_ip\);)756 1698 A
5850 V
(25475)210 648 A
1698(r)S
1782(=)S
(EEXIST;)294 1866 A
5940 V
(25476)210 648 A
1362(})S
6030 V
(25477)210 648 A
1110(})S
6120 V
(25478)210 648 A
6210 V
(25479)210 648 A
1110(/*)S
(Check)210 1236 A
(for)126 1488 A
(links)210 1656 A
(across)252 1908 A
(devices.)336 2202 A
2580(*/)S
8418 V
EP
%%Page: 351 351
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2160(File:)S
(src/fs/link.c)522 2393 A
12 B
(351)180 4248 A
900 V
7 LST
(25480)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
990 V
(25481)210 648 A
1362(if)S
(\(rip->i_dev)462 1488 A
1992(!=)S
(ip->i_dev\))420 2118 A
2580(r)S
2664(=)S
(EXDEV;)252 2748 A
1080 V
(25482)210 648 A
1170 V
(25483)210 648 A
1110(/*)S
(Try)126 1236 A
1404(to)S
(link.)210 1530 A
1782(*/)S
1260 V
(25484)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1350 V
(25485)210 648 A
1362(r)S
1446(=)S
(search_dir\(ip,)588 1530 A
(string,)294 2160 A
(&rip->i_num,)504 2496 A
(ENTER\);)294 3042 A
1440 V
(25486)210 648 A
1530 V
(25487)210 648 A
1110(/*)S
1236(If)S
(success,)336 1362 A
(register)336 1740 A
(the)126 2118 A
(linking.)336 2286 A
2664(*/)S
1620 V
(25488)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
1710 V
(25489)210 648 A
(rip->i_nlinks++;)672 1362 A
1800 V
(25490)210 648 A
(rip->i_update)546 1362 A
1950(|=)S
(CTIME;)252 2076 A
1890 V
(25491)210 648 A
(rip->i_dirt)462 1362 A
1866(=)S
(DIRTY;)252 1950 A
1980 V
(25492)210 648 A
1110(})S
2070 V
(25493)210 648 A
2160 V
(25494)210 648 A
1110(/*)S
(Done.)210 1236 A
(Release)294 1530 A
(both)168 1866 A
(inodes.)294 2076 A
2412(*/)S
2250 V
(25495)210 648 A
(put_inode\(rip\);)630 1110 A
2340 V
(25496)210 648 A
(put_inode\(ip\);)588 1110 A
2430 V
(25497)210 648 A
(return\(r\);)420 1110 A
2520 V
(25498)210 648 A
1026(})S
2790 V
(25501)210 648 A
(/*===========================================================================*)3276 1026 A
2880 V
(25502)210 648 A
1068(*)S
(do_unlink)378 2370 A
4260(*)S
2970 V
(25503)210 648 A
(*===========================================================================*/)3276 1068 A
3060 V
(25504)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_unlink\(\))462 1488 A
3150 V
(25505)210 648 A
1026({)S
3240 V
(25506)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(unlink\(name\))504 1656 A
2202(or)S
(rmdir\(name\))462 2328 A
(system)252 2832 A
(call.)210 3126 A
(The)126 3378 A
(code)168 3546 A
(for)126 3756 A
(these)210 3924 A
(two)126 4176 A
3330 V
(25507)210 648 A
1068(*)S
1152(is)S
(almost)252 1278 A
(the)126 1572 A
(same.)210 1740 A
(They)168 2034 A
(differ)252 2244 A
(only)168 2538 A
2748(in)S
(some)168 2874 A
(condition)378 3084 A
(testing.)336 3504 A
(Unlink\(\))336 3924 A
3420 V
(25508)210 648 A
1068(*)S
(may)126 1152 A
1320(be)S
(used)168 1446 A
1656(by)S
(the)126 1782 A
(superuser)378 1950 A
2370(to)S
2496(do)S
(dangerous)378 2622 A
(things;)294 3042 A
(rmdir\(\))294 3378 A
(may)126 3714 A
(not.)168 3882 A
3510 V
(25509)210 648 A
1068(*/)S
3600 V
(25510)210 648 A
3690 V
(25511)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
3780 V
(25512)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*rldirp;)336 1656 A
3870 V
(25513)210 648 A
(int)126 1110 A
1278(r;)S
3960 V
(25514)210 648 A
(char)168 1110 A
(string[NAME_MAX];)714 1320 A
4050 V
(25515)210 648 A
4140 V
(25516)210 648 A
1110(/*)S
(Get)126 1236 A
(the)126 1404 A
(last)168 1572 A
(directory)378 1782 A
2202(in)S
(the)126 2328 A
(path.)210 2496 A
2748(*/)S
4230 V
(25517)210 648 A
1110(if)S
(\(fetch_name\(name,)714 1236 A
(name_length,)504 1992 A
(M3\))126 2538 A
2706(!=)S
(OK\))126 2832 A
(return\(err_code\);)714 3000 A
4320 V
(25518)210 648 A
1110(if)S
1236(\()S
(\(rldirp)294 1320 A
1656(=)S
(last_dir\(user_path,)798 1740 A
(string\)\))336 2580 A
2958(==)S
(NIL_INODE\))420 3084 A
4410 V
(25519)210 648 A
(return\(err_code\);)714 1362 A
4500 V
(25520)210 648 A
4590 V
(25521)210 648 A
1110(/*)S
(The)126 1236 A
(last)168 1404 A
(directory)378 1614 A
(exists.)294 2034 A
(Does)168 2412 A
(the)126 2622 A
(file)168 2790 A
(also)168 3000 A
(exist?)252 3210 A
3504(*/)S
4680 V
(25522)210 648 A
1110(r)S
1194(=)S
(OK;)126 1278 A
4770 V
(25523)210 648 A
1110(if)S
1236(\()S
(\(rip)168 1320 A
1530(=)S
(advance\(rldirp,)630 1614 A
(string\)\))336 2286 A
2664(==)S
(NIL_INODE\))420 2790 A
3252(r)S
3336(=)S
(err_code;)378 3420 A
4860 V
(25524)210 648 A
4950 V
(25525)210 648 A
1110(/*)S
1236(If)S
(error,)252 1362 A
(return)252 1656 A
(inode.)252 1950 A
2244(*/)S
5040 V
(25526)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
1656({)S
5130 V
(25527)210 648 A
(put_inode\(rldirp\);)756 1362 A
5220 V
(25528)210 648 A
(return\(r\);)420 1362 A
5310 V
(25529)210 648 A
1110(})S
5400 V
(25530)210 648 A
5490 V
(25531)210 648 A
1110(/*)S
1236(Do)S
(not)126 1362 A
(remove)252 1530 A
1824(a)S
(mount)210 1908 A
(point.)252 2160 A
2454(*/)S
5580 V
(25532)210 648 A
1110(if)S
(\(rip->i_num)462 1236 A
1740(==)S
(ROOT_INODE\))462 1866 A
2370({)S
5670 V
(25533)210 648 A
(put_inode\(rldirp\);)756 1362 A
5760 V
(25534)210 648 A
(put_inode\(rip\);)630 1362 A
5850 V
(25535)210 648 A
(return\(EBUSY\);)588 1362 A
5940 V
(25536)210 648 A
1110(})S
6030 V
(25537)210 648 A
6120 V
(25538)210 648 A
1110(/*)S
(Now)126 1236 A
(test)168 1404 A
1614(if)S
(the)126 1740 A
(call)168 1908 A
2118(is)S
(allowed,)336 2244 A
(separately)420 2622 A
(for)126 3084 A
(unlink\(\))336 3252 A
(and)126 3630 A
(rmdir\(\).)336 3798 A
4176(*/)S
6210 V
(25539)210 648 A
1110(if)S
(\(fs_call)336 1236 A
1614(==)S
(UNLINK\))294 1740 A
2076({)S
8418 V
EP
%%Page: 352 352
BP
/slant 0 def
/height 0 def
630 V
12 B
(352)180 648 A
11 R
2160(File:)S
(src/fs/link.c)522 2393 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(25540)210 648 A
1362(/*)S
(Only)168 1488 A
(the)126 1698 A
1866(su)S
(may)126 1992 A
(unlink)252 2160 A
(directories,)504 2454 A
(but)126 3000 A
(the)126 3168 A
3336(su)S
(can)126 3462 A
(unlink)252 3630 A
(any)126 3924 A
(dir.*/)252 4092 A
990 V
(25541)210 648 A
1362(if)S
1488(\()S
(\(rip->i_mode)504 1572 A
2118(&)S
(I_TYPE\))294 2202 A
2538(==)S
(I_DIRECTORY)462 2664 A
3168(&&)S
(!super_user\))504 3294 A
3840(r)S
3924(=)S
(EPERM;)252 4008 A
1080 V
(25542)210 648 A
1170 V
(25543)210 648 A
1362(/*)S
(Don't)210 1488 A
(unlink)252 1740 A
2034(a)S
(file)168 2118 A
2328(if)S
2454(it)S
2580(is)S
(the)126 2706 A
(root)168 2874 A
3084(of)S
3210(a)S
(mounted)294 3294 A
(file)168 3630 A
(system.)294 3840 A
4176(*/)S
1260 V
(25544)210 648 A
1362(if)S
(\(rip->i_num)462 1488 A
1992(==)S
(ROOT_INODE\))462 2118 A
2622(r)S
2706(=)S
(EBUSY;)252 2790 A
1350 V
(25545)210 648 A
1440 V
(25546)210 648 A
1362(/*)S
(Actually)336 1488 A
(try)126 1866 A
2034(to)S
(unlink)252 2160 A
(the)126 2454 A
(file;)210 2622 A
(fails)210 2874 A
3126(if)S
(parent)252 3252 A
3546(is)S
(mode)168 3672 A
3882(0)S
(etc.)168 3966 A
4176(*/)S
1530 V
(25547)210 648 A
1362(if)S
1488(\(r)S
1614(==)S
(OK\))126 1740 A
1908(r)S
1992(=)S
(unlink_file\(rldirp,)798 2076 A
(rip,)168 2916 A
(string\);)336 3126 A
1620 V
(25548)210 648 A
1710 V
(25549)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1800 V
(25550)210 648 A
1362(r)S
1446(=)S
(remove_dir\(rldirp,)756 1530 A
(rip,)168 2328 A
(string\);)336 2538 A
2916(/*)S
(call)168 3042 A
3252(is)S
(RMDIR)210 3378 A
3630(*/)S
1890 V
(25551)210 648 A
1110(})S
1980 V
(25552)210 648 A
2070 V
(25553)210 648 A
1110(/*)S
1236(If)S
(unlink)252 1362 A
(was)126 1656 A
(possible,)378 1824 A
2244(it)S
(has)126 2370 A
(been)168 2538 A
(done,)210 2748 A
(otherwise)378 3000 A
3420(it)S
(has)126 3546 A
(not.)168 3714 A
3924(*/)S
2160 V
(25554)210 648 A
(put_inode\(rip\);)630 1110 A
2250 V
(25555)210 648 A
(put_inode\(rldirp\);)756 1110 A
2340 V
(25556)210 648 A
(return\(r\);)420 1110 A
2430 V
(25557)210 648 A
1026(})S
2700 V
(25560)210 648 A
(/*===========================================================================*)3276 1026 A
2790 V
(25561)210 648 A
1068(*)S
(do_rename)378 2370 A
4260(*)S
2880 V
(25562)210 648 A
(*===========================================================================*/)3276 1068 A
2970 V
(25563)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_rename\(\))462 1488 A
3060 V
(25564)210 648 A
1026({)S
3150 V
(25565)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(rename\(name1,)546 1656 A
(name2\))252 2244 A
(system)252 2538 A
(call.)210 2832 A
3084(*/)S
3240 V
(25566)210 648 A
3330 V
(25567)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*old_dirp,)420 1656 A
(*old_ip;)336 2118 A
2706(/*)S
(ptrs)168 2832 A
3042(to)S
(old)126 3168 A
(dir,)168 3336 A
(file)168 3546 A
(inodes)252 3756 A
4050(*/)S
3420 V
(25568)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*new_dirp,)420 1656 A
(*new_ip;)336 2118 A
2706(/*)S
(ptrs)168 2832 A
3042(to)S
(new)126 3168 A
(dir,)168 3336 A
(file)168 3546 A
(inodes)252 3756 A
4050(*/)S
3510 V
(25569)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*new_superdirp,)630 1656 A
(*next_new_superdirp;)840 2328 A
3600 V
(25570)210 648 A
(int)126 1110 A
1278(r)S
1362(=)S
(OK;)126 1446 A
2706(/*)S
(error)210 2832 A
(flag;)210 3084 A
(initially)378 3336 A
3756(no)S
(error)210 3882 A
4134(*/)S
3690 V
(25571)210 648 A
(int)126 1110 A
(odir,)210 1278 A
(ndir;)210 1530 A
2706(/*)S
(TRUE)168 2832 A
(iff)126 3042 A
({old|new})378 3210 A
(file)168 3630 A
3840(is)S
(dir)126 3966 A
4134(*/)S
3780 V
(25572)210 648 A
(int)126 1110 A
(same_pdir;)420 1278 A
2706(/*)S
(TRUE)168 2832 A
(iff)126 3042 A
(parent)252 3210 A
(dirs)168 3504 A
(are)126 3714 A
(the)126 3882 A
(same)168 4050 A
4260(*/)S
3870 V
(25573)210 648 A
(char)168 1110 A
(old_name[NAME_MAX],)798 1320 A
(new_name[NAME_MAX];)798 2160 A
3960 V
(25574)210 648 A
(ino_t)210 1110 A
(numb;)210 1362 A
4050 V
(25575)210 648 A
(int)126 1110 A
(r1;)126 1278 A
4140 V
(25576)210 648 A
4230 V
(25577)210 648 A
1110(/*)S
(See)126 1236 A
1404(if)S
('name1')294 1530 A
(\(existing)378 1866 A
(file\))210 2286 A
(exists.)294 2538 A
(Get)126 2916 A
(dir)126 3084 A
(and)126 3252 A
(file)168 3420 A
(inodes.)294 3630 A
3966(*/)S
4320 V
(25578)210 648 A
1110(if)S
(\(fetch_name\(name1,)756 1236 A
(name1_length,)546 2034 A
(M1\))126 2622 A
2790(!=)S
(OK\))126 2916 A
(return\(err_code\);)714 3084 A
4410 V
(25579)210 648 A
1110(if)S
1236(\()S
(\(old_dirp)378 1320 A
1740(=)S
(last_dir\(user_path,)798 1824 A
(old_name\)\)==NIL_INODE\))924 2664 A
(return\(err_code\);)714 3630 A
4500 V
(25580)210 648 A
4590 V
(25581)210 648 A
1110(if)S
1236(\()S
(\(old_ip)294 1320 A
1656(=)S
(advance\(old_dirp,)714 1740 A
(old_name\)\))420 2496 A
2958(==)S
(NIL_INODE\))420 3084 A
3546(r)S
3630(=)S
(err_code;)378 3714 A
4680 V
(25582)210 648 A
4770 V
(25583)210 648 A
1110(/*)S
(See)126 1236 A
1404(if)S
('name2')294 1530 A
(\(new)168 1866 A
(name\))210 2076 A
(exists.)294 2328 A
(Get)126 2706 A
(dir)126 2874 A
(and)126 3042 A
(file)168 3210 A
(inodes.)294 3420 A
3756(*/)S
4860 V
(25584)210 648 A
1110(if)S
(\(fetch_name\(name2,)756 1236 A
(name2_length,)546 2034 A
(M1\))126 2622 A
2790(!=)S
(OK\))126 2916 A
3084(r)S
3168(=)S
(err_code;)378 3252 A
4950 V
(25585)210 648 A
1110(if)S
1236(\()S
(\(new_dirp)378 1320 A
1740(=)S
(last_dir\(user_path,)798 1824 A
(new_name\)\))420 2664 A
3126(==)S
(NIL_INODE\))420 3252 A
3714(r)S
3798(=)S
(err_code;)378 3882 A
5040 V
(25586)210 648 A
(new_ip)252 1110 A
1404(=)S
(advance\(new_dirp,)714 1488 A
(new_name\);)420 2244 A
2706(/*)S
(not)126 2832 A
(required)336 3000 A
3378(to)S
(exist)210 3504 A
3756(*/)S
5130 V
(25587)210 648 A
5220 V
(25588)210 648 A
1110(if)S
(\(old_ip)294 1236 A
1572(!=)S
(NIL_INODE\))420 1698 A
5310 V
(25589)210 648 A
(odir)168 1362 A
1572(=)S
(\(\(old_ip->i_mode)672 1656 A
2370(&)S
(I_TYPE\))294 2454 A
2790(==)S
(I_DIRECTORY\);)546 2916 A
3546(/*)S
(TRUE)168 3672 A
(iff)126 3882 A
(dir)126 4050 A
4218(*/)S
5400 V
(25590)210 648 A
5490 V
(25591)210 648 A
1110(/*)S
1236(If)S
1362(it)S
1488(is)S
(ok,)126 1614 A
(check)210 1782 A
(for)126 2034 A
2202(a)S
(variety)294 2286 A
2622(of)S
(possible)336 2748 A
(errors.)294 3126 A
3462(*/)S
5580 V
(25592)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
5670 V
(25593)210 648 A
(same_pdir)378 1362 A
1782(=)S
(\(old_dirp)378 1866 A
2286(==)S
(new_dirp\);)420 2412 A
5760 V
(25594)210 648 A
5850 V
(25595)210 648 A
1362(/*)S
(The)126 1488 A
(old)126 1656 A
(inode)210 1824 A
(must)168 2076 A
(not)126 2286 A
2454(be)S
2580(a)S
(superdirectory)588 2664 A
3294(of)S
(the)126 3420 A
(new)126 3588 A
(last)168 3756 A
(dir.)168 3966 A
4176(*/)S
5940 V
(25596)210 648 A
1362(if)S
(\(odir)210 1488 A
1740(&&)S
(!same_pdir\))462 1866 A
2370({)S
6030 V
(25597)210 648 A
(dup_inode\(new_superdirp)966 1698 A
2706(=)S
(new_dirp\);)420 2790 A
6120 V
(25598)210 648 A
(while)210 1698 A
(\(TRUE\))252 1950 A
2244({)S
2706(/*)S
(may)126 2832 A
(hang)168 3000 A
3210(in)S
3336(a)S
(file)168 3420 A
(system)252 3630 A
(loop)168 3924 A
4134(*/)S
6210 V
(25599)210 648 A
2034(if)S
(\(new_superdirp)588 2160 A
2790(==)S
(old_ip\))294 2916 A
3252({)S
8418 V
EP
%%Page: 353 353
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2160(File:)S
(src/fs/link.c)522 2393 A
12 B
(353)180 4248 A
900 V
7 LST
(25600)210 648 A
2370(r)S
2454(=)S
(EINVAL;)294 2538 A
990 V
(25601)210 648 A
(break;)252 2370 A
1080 V
(25602)210 648 A
2034(})S
1170 V
(25603)210 648 A
(next_new_superdirp)756 2034 A
2832(=)S
(advance\(new_superdirp,)924 2916 A
(dot2\);)252 3882 A
1260 V
(25604)210 648 A
(put_inode\(new_superdirp\);)1050 2034 A
1350 V
(25605)210 648 A
2034(if)S
(\(next_new_superdirp)798 2160 A
3000(==)S
(new_superdirp\))588 3126 A
1440 V
(25606)210 648 A
(break;)252 2370 A
2706(/*)S
(back)168 2832 A
3042(at)S
(system)252 3168 A
(root)168 3462 A
(directory)378 3672 A
4092(*/)S
1530 V
(25607)210 648 A
(new_superdirp)546 2034 A
2622(=)S
(next_new_superdirp;)798 2706 A
1620 V
(25608)210 648 A
2034(if)S
(\(new_superdirp)588 2160 A
2790(==)S
(NIL_INODE\))420 2916 A
3378({)S
1710 V
(25609)210 648 A
2370(/*)S
(Missing)294 2496 A
("..")168 2832 A
(entry.)252 3042 A
(Assume)252 3378 A
(the)126 3672 A
(worst.)252 3840 A
4134(*/)S
1800 V
(25610)210 648 A
2370(r)S
2454(=)S
(EINVAL;)294 2538 A
1890 V
(25611)210 648 A
(break;)252 2370 A
1980 V
(25612)210 648 A
2034(})S
2070 V
(25613)210 648 A
1698(})S
2160 V
(25614)210 648 A
(put_inode\(new_superdirp\);)1050 1698 A
2250 V
(25615)210 648 A
1362(})S
2340 V
(25616)210 648 A
2430 V
(25617)210 648 A
1362(/*)S
(The)126 1488 A
(old)126 1656 A
1824(or)S
(new)126 1950 A
(name)168 2118 A
(must)168 2328 A
(not)126 2538 A
2706(be)S
2832(.)S
2916(or)S
3042(..)S
3168(*/)S
2520 V
(25618)210 648 A
1362(if)S
(\(strcmp\(old_name,)714 1488 A
("."\)==0)294 2244 A
2580(||)S
(strcmp\(old_name,)672 2706 A
(".."\)==0)336 3420 A
3798(||)S
2610 V
(25619)210 648 A
(strcmp\(new_name,)672 1530 A
("."\)==0)294 2244 A
2580(||)S
(strcmp\(new_name,)672 2706 A
(".."\)==0\))378 3420 A
3840(r)S
3924(=)S
(EINVAL;)294 4008 A
2700 V
(25620)210 648 A
2790 V
(25621)210 648 A
1362(/*)S
(Both)168 1488 A
(parent)252 1698 A
(directories)462 1992 A
(must)168 2496 A
2706(be)S
2832(on)S
(the)126 2958 A
(same)168 3126 A
(device.)294 3336 A
3672(*/)S
2880 V
(25622)210 648 A
1362(if)S
(\(old_dirp->i_dev)672 1488 A
2202(!=)S
(new_dirp->i_dev\))672 2328 A
3042(r)S
3126(=)S
(EXDEV;)252 3210 A
2970 V
(25623)210 648 A
3060 V
(25624)210 648 A
1362(/*)S
(Parent)252 1488 A
(dirs)168 1782 A
(must)168 1992 A
2202(be)S
(writable,)378 2328 A
(searchable)420 2748 A
(and)126 3210 A
3378(on)S
3504(a)S
(writable)336 3588 A
(device)252 3966 A
4260(*/)S
3150 V
(25625)210 648 A
1362(if)S
(\(\(r1)168 1488 A
1698(=)S
(forbidden\(old_dirp,)798 1782 A
(W_BIT)210 2622 A
2874(|)S
(X_BIT\)\))294 2958 A
3294(!=)S
3420(OK)S
3546(||)S
3240 V
(25626)210 648 A
(\(r1)126 1530 A
1698(=)S
(forbidden\(new_dirp,)798 1782 A
(W_BIT)210 2622 A
2874(|)S
(X_BIT\)\))294 2958 A
3294(!=)S
(OK\))126 3420 A
3588(r)S
3672(=)S
(r1;)126 3756 A
3330 V
(25627)210 648 A
3420 V
(25628)210 648 A
1362(/*)S
(Some)168 1488 A
(tests)210 1698 A
(apply)210 1950 A
(only)168 2202 A
2412(if)S
(the)126 2538 A
(new)126 2706 A
(path)168 2874 A
(exists.)294 3084 A
3420(*/)S
3510 V
(25629)210 648 A
1362(if)S
(\(new_ip)294 1488 A
1824(==)S
(NIL_INODE\))420 1950 A
2412({)S
3600 V
(25630)210 648 A
1698(/*)S
(don't)210 1824 A
(rename)252 2076 A
2370(a)S
(file)168 2454 A
(with)168 2664 A
2874(a)S
(file)168 2958 A
(system)252 3168 A
(mounted)294 3462 A
3798(on)S
(it.)126 3924 A
4092(*/)S
3690 V
(25631)210 648 A
1698(if)S
(\(old_ip->i_dev)588 1824 A
2454(!=)S
(old_dirp->i_dev\))672 2580 A
3294(r)S
3378(=)S
(EXDEV;)252 3462 A
3780 V
(25632)210 648 A
1698(if)S
(\(odir)210 1824 A
2076(&&)S
(\(new_dirp->i_nlinks)798 2202 A
3042(&)S
(BYTE\))210 3126 A
3378(>=)S
(LINK_MAX)336 3504 A
3882(&&)S
3870 V
(25633)210 648 A
(!same_pdir)420 1866 A
2328(&&)S
2454(r)S
2538(==)S
(OK\))126 2664 A
2832(r)S
2916(=)S
(EMLINK;)294 3000 A
3960 V
(25634)210 648 A
1362(})S
(else)168 1446 A
1656({)S
4050 V
(25635)210 648 A
1698(if)S
(\(old_ip)294 1824 A
2160(==)S
(new_ip\))294 2286 A
2622(r)S
2706(=)S
(SAME;)210 2790 A
3042(/*)S
(old=new)294 3168 A
3504(*/)S
4140 V
(25636)210 648 A
4230 V
(25637)210 648 A
1698(/*)S
(has)126 1824 A
(the)126 1992 A
(old)126 2160 A
(file)168 2328 A
2538(or)S
(new)126 2664 A
(file)168 2832 A
3042(a)S
(file)168 3126 A
(system)252 3336 A
(mounted)294 3630 A
3966(on)S
(it?)126 4092 A
4260(*/)S
4320 V
(25638)210 648 A
1698(if)S
(\(old_ip->i_dev)588 1824 A
2454(!=)S
(new_ip->i_dev\))588 2580 A
3210(r)S
3294(=)S
(EXDEV;)252 3378 A
4410 V
(25639)210 648 A
4500 V
(25640)210 648 A
(ndir)168 1698 A
1908(=)S
(\(\(new_ip->i_mode)672 1992 A
2706(&)S
(I_TYPE\))294 2790 A
3126(==)S
(I_DIRECTORY\);)546 3252 A
3840(/*)S
(dir)126 3966 A
4134(?)S
4218(*/)S
4590 V
(25641)210 648 A
1698(if)S
(\(odir)210 1824 A
2076(==)S
(TRUE)168 2202 A
2412(&&)S
(ndir)168 2538 A
2748(==)S
(FALSE\))252 2874 A
3168(r)S
3252(=)S
(ENOTDIR;)336 3336 A
4680 V
(25642)210 648 A
1698(if)S
(\(odir)210 1824 A
2076(==)S
(FALSE)210 2202 A
2454(&&)S
(ndir)168 2580 A
2790(==)S
(TRUE\))210 2916 A
3168(r)S
3252(=)S
(EISDIR;)294 3336 A
4770 V
(25643)210 648 A
1362(})S
4860 V
(25644)210 648 A
1110(})S
4950 V
(25645)210 648 A
5040 V
(25646)210 648 A
1110(/*)S
1236(If)S
1362(a)S
(process)294 1446 A
(has)126 1782 A
(another)294 1950 A
(root)168 2286 A
(directory)378 2496 A
(than)168 2916 A
(the)126 3126 A
(system)252 3294 A
(root,)210 3588 A
3840(we)S
(might)210 3966 A
5130 V
(25647)210 648 A
1152(*)S
("accidently")504 1236 A
1782(be)S
(moving)252 1908 A
(it's)168 2202 A
(working)294 2412 A
(directory)378 2748 A
3168(to)S
3294(a)S
(place)210 3378 A
(where)210 3630 A
(it's)168 3882 A
5220 V
(25648)210 648 A
1152(*)S
(root)168 1236 A
(directory)378 1446 A
(isn't)210 1866 A
2118(a)S
(super)210 2202 A
(directory)378 2454 A
2874(of)S
3000(it)S
(anymore.)336 3126 A
(This)168 3504 A
(can)126 3714 A
(make)168 3882 A
5310 V
(25649)210 648 A
1152(*)S
(the)126 1236 A
(function)336 1404 A
(chroot)252 1782 A
(useless.)336 2076 A
2454(If)S
(chroot)252 2580 A
(will)168 2874 A
3084(be)S
(used)168 3210 A
(often)210 3420 A
3672(we)S
(should)252 3798 A
5400 V
(25650)210 648 A
1152(*)S
(probably)336 1236 A
(check)210 1614 A
(for)126 1866 A
2034(it)S
(here.)210 2160 A
5490 V
(25651)210 648 A
1152(*/)S
5580 V
(25652)210 648 A
5670 V
(25653)210 648 A
1110(/*)S
(The)126 1236 A
(rename)252 1404 A
(will)168 1698 A
(probably)336 1908 A
(work.)210 2286 A
(Only)168 2538 A
(two)126 2748 A
(things)252 2916 A
(can)126 3210 A
3378(go)S
(wrong)210 3504 A
(now:)168 3756 A
5760 V
(25654)210 648 A
1152(*)S
1236(1.)S
(being)210 1362 A
(unable)252 1614 A
1908(to)S
(remove)252 2034 A
(the)126 2328 A
(new)126 2496 A
(file.)210 2664 A
(\(when)210 2916 A
(new)126 3168 A
(file)168 3336 A
(already)294 3546 A
(exists\))294 3882 A
5850 V
(25655)210 648 A
1152(*)S
1236(2.)S
(being)210 1362 A
(unable)252 1614 A
1908(to)S
(make)168 2034 A
(the)126 2244 A
(new)126 2412 A
(directory)378 2580 A
(entry.)252 3000 A
(\(new)168 3294 A
(file)168 3504 A
(doesn't)294 3714 A
(exists\))294 4050 A
5940 V
(25656)210 648 A
1152(*)S
([directory)420 1404 A
(has)126 1866 A
2034(to)S
(grow)168 2160 A
2370(by)S
(one)126 2496 A
(block)210 2664 A
(and)126 2916 A
(cannot)252 3084 A
(because)294 3378 A
(the)126 3714 A
(disk)168 3882 A
6030 V
(25657)210 648 A
1152(*)S
1446(is)S
(completely)420 1572 A
(full].)252 2034 A
6120 V
(25658)210 648 A
1152(*/)S
6210 V
(25659)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
8418 V
EP
%%Page: 354 354
BP
/slant 0 def
/height 0 def
630 V
12 B
(354)180 648 A
11 R
2160(File:)S
(src/fs/link.c)522 2393 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(25660)210 648 A
1362(if)S
(\(new_ip)294 1488 A
1824(!=)S
(NIL_INODE\))420 1950 A
2412({)S
990 V
(25661)210 648 A
1782(/*)S
(There)210 1908 A
2160(is)S
(already)294 2286 A
2622(an)S
(entry)210 2748 A
(for)126 3000 A
('new'.)252 3168 A
(Try)126 3462 A
3630(to)S
(remove)252 3756 A
(it.)126 4050 A
4218(*/)S
1080 V
(25662)210 648 A
1698(if)S
(\(odir\))252 1824 A
1170 V
(25663)210 648 A
2034(r)S
2118(=)S
(remove_dir\(new_dirp,)840 2202 A
(new_ip,)294 3084 A
(new_name\);)420 3420 A
1260 V
(25664)210 648 A
(else)168 1698 A
1350 V
(25665)210 648 A
2034(r)S
2118(=)S
(unlink_file\(new_dirp,)882 2202 A
(new_ip,)294 3126 A
(new_name\);)420 3462 A
1440 V
(25666)210 648 A
1362(})S
1530 V
(25667)210 648 A
1362(/*)S
1488(if)S
1614(r)S
1698(is)S
(OK,)126 1824 A
(the)126 1992 A
(rename)252 2160 A
(will)168 2454 A
(succeed,)336 2664 A
(while)210 3042 A
(there)210 3294 A
3546(is)S
(now)126 3672 A
3840(an)S
1620 V
(25668)210 648 A
1404(*)S
(unused)252 1488 A
(entry)210 1782 A
2034(in)S
(the)126 2160 A
(new)126 2328 A
(parent)252 2496 A
(directory.)420 2790 A
1710 V
(25669)210 648 A
1404(*/)S
1800 V
(25670)210 648 A
1110(})S
1890 V
(25671)210 648 A
1980 V
(25672)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
2070 V
(25673)210 648 A
1362(/*)S
1488(If)S
(the)126 1614 A
(new)126 1782 A
(name)168 1950 A
(will)168 2160 A
2370(be)S
2496(in)S
(the)126 2622 A
(same)168 2790 A
(parent)252 3000 A
(directory)378 3294 A
3714(as)S
(the)126 3840 A
(old)126 4008 A
(one,)168 4176 A
2160 V
(25674)210 648 A
1404(*)S
(first)210 1488 A
(remove)252 1740 A
(the)126 2034 A
(old)126 2202 A
(name)168 2370 A
2580(to)S
(free)168 2706 A
2916(an)S
(entry)210 3042 A
(for)126 3294 A
(the)126 3462 A
(new)126 3630 A
(name,)210 3798 A
2250 V
(25675)210 648 A
1404(*)S
(otherwise)378 1488 A
(first)210 1908 A
(try)126 2160 A
2328(to)S
(create)252 2454 A
(the)126 2748 A
(new)126 2916 A
(name)168 3084 A
(entry)210 3294 A
3546(to)S
(make)168 3672 A
(sure)168 3882 A
2340 V
(25676)210 648 A
1404(*)S
(the)126 1488 A
(rename)252 1656 A
(will)168 1950 A
(succeed.)336 2160 A
2430 V
(25677)210 648 A
1404(*/)S
2520 V
(25678)210 648 A
(numb)168 1362 A
1572(=)S
(old_ip->i_num;)588 1656 A
2706(/*)S
(inode)210 2832 A
(number)252 3084 A
3378(of)S
(old)126 3504 A
(file)168 3672 A
3882(*/)S
2610 V
(25679)210 648 A
2700 V
(25680)210 648 A
1362(if)S
(\(same_pdir\))462 1488 A
1992({)S
2790 V
(25681)210 648 A
1698(r)S
1782(=)S
(search_dir\(old_dirp,)840 1866 A
(old_name,)378 2748 A
(\(ino_t)252 3168 A
3462(*\))S
3588(0,)S
(DELETE\);)336 3714 A
2880 V
(25682)210 648 A
3042(/*)S
(shouldn't)378 3168 A
3588(go)S
(wrong.)252 3714 A
4008(*/)S
2970 V
(25683)210 648 A
1698(if)S
(\(r==OK\))294 1824 A
(\(void\))252 2160 A
(search_dir\(old_dirp,)840 2454 A
(new_name,)378 3336 A
(&numb,)252 3756 A
(ENTER\);)294 4050 A
3060 V
(25684)210 648 A
1362(})S
(else)168 1446 A
1656({)S
3150 V
(25685)210 648 A
1698(r)S
1782(=)S
(search_dir\(new_dirp,)840 1866 A
(new_name,)378 2748 A
(&numb,)252 3168 A
(ENTER\);)294 3462 A
3240 V
(25686)210 648 A
1698(if)S
1824(\(r)S
1950(==)S
(OK\))126 2076 A
3330 V
(25687)210 648 A
(\(void\))252 1866 A
(search_dir\(old_dirp,)840 2160 A
(old_name,)378 3042 A
(\(ino_t)252 3462 A
3756(*\))S
3882(0,)S
(DELETE\);)336 4008 A
3420 V
(25688)210 648 A
1362(})S
3510 V
(25689)210 648 A
1110(})S
3600 V
(25690)210 648 A
1110(/*)S
1236(If)S
1362(r)S
1446(is)S
(OK,)126 1572 A
(the)126 1740 A
(ctime)210 1908 A
(and)126 2160 A
(mtime)210 2328 A
2580(of)S
(old_dirp)336 2706 A
(and)126 3084 A
(new_dirp)336 3252 A
(have)168 3630 A
(been)168 3840 A
(marked)252 4050 A
3690 V
(25691)210 648 A
1152(*)S
(for)126 1236 A
(update)252 1404 A
1698(in)S
(search_dir.)462 1824 A
3780 V
(25692)210 648 A
1152(*/)S
3870 V
(25693)210 648 A
3960 V
(25694)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
1488(OK)S
1614(&&)S
(odir)168 1740 A
1950(&&)S
(!same_pdir\))462 2076 A
2580({)S
4050 V
(25695)210 648 A
1362(/*)S
(Update)252 1488 A
(the)126 1782 A
1950(..)S
(entry)210 2076 A
2328(in)S
(the)126 2454 A
(directory)378 2622 A
(\(still)252 3042 A
(points)252 3336 A
3630(to)S
(old_dirp\).)420 3756 A
4218(*/)S
4140 V
(25696)210 648 A
(numb)168 1362 A
1572(=)S
(new_dirp->i_num;)672 1656 A
4230 V
(25697)210 648 A
(\(void\))252 1362 A
(unlink_file\(old_ip,)798 1656 A
(NIL_INODE,)420 2496 A
(dot2\);)252 2958 A
4320 V
(25698)210 648 A
1362(if)S
(\(search_dir\(old_ip,)798 1488 A
(dot2,)210 2328 A
(&numb,)252 2580 A
(ENTER\))252 2874 A
3168(==)S
(OK\))126 3294 A
3462({)S
4410 V
(25699)210 648 A
1698(/*)S
(New)126 1824 A
(link)168 1992 A
(created.)336 2202 A
2580(*/)S
4500 V
(25700)210 648 A
(new_dirp->i_nlinks++;)882 1698 A
4590 V
(25701)210 648 A
(new_dirp->i_dirt)672 1698 A
2412(=)S
(DIRTY;)252 2496 A
4680 V
(25702)210 648 A
1362(})S
4770 V
(25703)210 648 A
1110(})S
4860 V
(25704)210 648 A
4950 V
(25705)210 648 A
1110(/*)S
(Release)294 1236 A
(the)126 1572 A
(inodes.)294 1740 A
2076(*/)S
5040 V
(25706)210 648 A
(put_inode\(old_dirp\);)840 1110 A
5130 V
(25707)210 648 A
(put_inode\(old_ip\);)756 1110 A
5220 V
(25708)210 648 A
(put_inode\(new_dirp\);)840 1110 A
5310 V
(25709)210 648 A
(put_inode\(new_ip\);)756 1110 A
5400 V
(25710)210 648 A
(return\(r)336 1110 A
1488(==)S
(SAME)168 1614 A
1824(?)S
1908(OK)S
2034(:)S
(r\);)126 2118 A
5490 V
(25711)210 648 A
1026(})S
5760 V
(25714)210 648 A
(/*===========================================================================*)3276 1026 A
5850 V
(25715)210 648 A
1068(*)S
(truncate)336 2370 A
4260(*)S
5940 V
(25716)210 648 A
(*===========================================================================*/)3276 1068 A
6030 V
(25717)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(truncate\(rip\))546 1530 A
6120 V
(25718)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
3210(to)S
3336(be)S
(truncated)378 3462 A
3882(*/)S
6210 V
(25719)210 648 A
1026({)S
8418 V
EP
%%Page: 355 355
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2160(File:)S
(src/fs/link.c)522 2393 A
12 B
(355)180 4248 A
900 V
7 LST
(25720)210 648 A
1026(/*)S
(Remove)252 1152 A
(all)126 1446 A
(the)126 1614 A
(zones)210 1782 A
(from)168 2034 A
(the)126 2244 A
(inode)210 2412 A
('rip')210 2664 A
(and)126 2916 A
(mark)168 3084 A
3294(it)S
(dirty.)252 3420 A
3714(*/)S
990 V
(25721)210 648 A
1080 V
(25722)210 648 A
(register)336 1110 A
(block_t)294 1488 A
1824(b;)S
1170 V
(25723)210 648 A
(zone_t)252 1110 A
1404(z,)S
(zone_size,)420 1530 A
(z1;)126 1992 A
1260 V
(25724)210 648 A
(off_t)210 1110 A
(position;)378 1362 A
1350 V
(25725)210 648 A
(int)126 1110 A
1278(i,)S
(scale,)252 1404 A
(file_type,)420 1698 A
(waspipe,)336 2160 A
(single,)294 2538 A
(nr_indirects;)546 2874 A
1440 V
(25726)210 648 A
(struct)252 1110 A
(buf)126 1404 A
(*bp;)168 1572 A
1530 V
(25727)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
1620 V
(25728)210 648 A
1710 V
(25729)210 648 A
(file_type)378 1110 A
1530(=)S
(rip->i_mode)462 1614 A
2118(&)S
(I_TYPE;)294 2202 A
2706(/*)S
(check)210 2832 A
3084(to)S
(see)126 3210 A
3378(if)S
(file)168 3504 A
3714(is)S
(special)294 3840 A
4176(*/)S
1800 V
(25730)210 648 A
1110(if)S
(\(file_type)420 1236 A
1698(==)S
(I_CHAR_SPECIAL)588 1824 A
2454(||)S
(file_type)378 2580 A
3000(==)S
(I_BLOCK_SPECIAL\))672 3126 A
(return;)294 3840 A
1890 V
(25731)210 648 A
(dev)126 1110 A
1278(=)S
(rip->i_dev;)462 1362 A
2370(/*)S
(device)252 2496 A
2790(on)S
(which)210 2916 A
(inode)210 3168 A
(resides)294 3420 A
3756(*/)S
1980 V
(25732)210 648 A
(scale)210 1110 A
1362(=)S
(rip->i_sp->s_log_zone_size;)1134 1446 A
2070 V
(25733)210 648 A
(zone_size)378 1110 A
1530(=)S
(\(zone_t\))336 1614 A
(BLOCK_SIZE)420 1992 A
2454(<<)S
(scale;)252 2580 A
2160 V
(25734)210 648 A
(nr_indirects)504 1110 A
1656(=)S
(rip->i_nindirs;)630 1740 A
2250 V
(25735)210 648 A
2340 V
(25736)210 648 A
1110(/*)S
(Pipes)210 1236 A
(can)126 1488 A
(shrink,)294 1656 A
1992(so)S
(adjust)252 2118 A
(size)168 2412 A
2622(to)S
(make)168 2748 A
(sure)168 2958 A
(all)126 3168 A
(zones)210 3336 A
(are)126 3588 A
(removed.)336 3756 A
4134(*/)S
2430 V
(25737)210 648 A
(waspipe)294 1110 A
1446(=)S
(rip->i_pipe)462 1530 A
2034(==)S
(I_PIPE;)294 2160 A
2706(/*)S
(TRUE)168 2832 A
3042(is)S
(this)168 3168 A
(was)126 3378 A
3546(a)S
(pipe)168 3630 A
3840(*/)S
2520 V
(25738)210 648 A
1110(if)S
(\(waspipe\))378 1236 A
(rip->i_size)462 1656 A
2160(=)S
(PIPE_SIZE;)420 2244 A
2610 V
(25739)210 648 A
2700 V
(25740)210 648 A
1110(/*)S
(Step)168 1236 A
(through)294 1446 A
(the)126 1782 A
(file)168 1950 A
2160(a)S
(zone)168 2244 A
2454(at)S
2580(a)S
(time,)210 2664 A
(finding)294 2916 A
(and)126 3252 A
(freeing)294 3420 A
(the)126 3756 A
(zones.)252 3924 A
4218(*/)S
2790 V
(25741)210 648 A
(for)126 1110 A
(\(position)378 1278 A
1698(=)S
1782(0;)S
(position)336 1908 A
2286(<)S
(rip->i_size;)504 2370 A
(position)336 2916 A
3294(+=)S
(zone_size\))420 3420 A
3882({)S
2880 V
(25742)210 648 A
1362(if)S
1488(\()S
1572(\(b)S
1698(=)S
(read_map\(rip,)546 1782 A
(position\)\))420 2370 A
2832(!=)S
(NO_BLOCK\))378 2958 A
3378({)S
2970 V
(25743)210 648 A
1698(z)S
1782(=)S
(\(zone_t\))336 1866 A
2244(b)S
2328(>>)S
(scale;)252 2454 A
3060 V
(25744)210 648 A
(free_zone\(dev,)588 1698 A
(z\);)126 2328 A
3150 V
(25745)210 648 A
1362(})S
3240 V
(25746)210 648 A
1110(})S
3330 V
(25747)210 648 A
3420 V
(25748)210 648 A
1110(/*)S
(All)126 1236 A
(the)126 1404 A
(data)168 1572 A
(zones)210 1782 A
(have)168 2034 A
(been)168 2244 A
(freed.)252 2454 A
(Now)126 2790 A
(free)168 2958 A
(the)126 3168 A
(indirect)336 3336 A
(zones.)252 3714 A
4008(*/)S
3510 V
(25749)210 648 A
(rip->i_dirt)462 1110 A
1614(=)S
(DIRTY;)252 1698 A
3600 V
(25750)210 648 A
1110(if)S
(\(waspipe\))378 1236 A
1656({)S
3690 V
(25751)210 648 A
(wipe_inode\(rip\);)672 1362 A
2370(/*)S
(clear)210 2496 A
(out)126 2748 A
(inode)210 2916 A
(for)126 3168 A
(pipes)210 3336 A
3588(*/)S
3780 V
(25752)210 648 A
(return;)294 1362 A
2370(/*)S
(indirect)336 2496 A
(slots)210 2874 A
(contain)294 3126 A
(file)168 3462 A
(positions)378 3672 A
4092(*/)S
3870 V
(25753)210 648 A
1110(})S
3960 V
(25754)210 648 A
(single)252 1110 A
1404(=)S
(rip->i_ndzones;)630 1488 A
4050 V
(25755)210 648 A
(free_zone\(dev,)588 1110 A
(rip->i_zone[single]\);)882 1740 A
2706(/*)S
(single)252 2832 A
(indirect)336 3126 A
(zone)168 3504 A
3714(*/)S
4140 V
(25756)210 648 A
1110(if)S
1236(\()S
1320(\(z)S
1446(=)S
(rip->i_zone[single+1]\))924 1530 A
2496(!=)S
(NO_ZONE\))336 2622 A
3000({)S
4230 V
(25757)210 648 A
1362(/*)S
(Free)168 1488 A
(all)126 1698 A
(the)126 1866 A
(single)252 2034 A
(indirect)336 2328 A
(zones)210 2706 A
(pointed)294 2958 A
3294(to)S
3420(by)S
(the)126 3546 A
(double.)294 3714 A
4050(*/)S
4320 V
(25758)210 648 A
1362(b)S
1446(=)S
(\(block_t\))378 1530 A
1950(z)S
2034(<<)S
(scale;)252 2160 A
4410 V
(25759)210 648 A
1362(bp)S
1488(=)S
(get_block\(dev,)588 1572 A
2202(b,)S
(NORMAL\);)336 2328 A
2706(/*)S
(get)126 2832 A
(double)252 3000 A
(indirect)336 3294 A
(zone)168 3672 A
3882(*/)S
4500 V
(25760)210 648 A
(for)126 1362 A
1530(\(i)S
1656(=)S
1740(0;)S
1866(i)S
1950(<)S
(nr_indirects;)546 2034 A
(i++\))168 2622 A
2832({)S
4590 V
(25761)210 648 A
1698(z1)S
1824(=)S
(rd_indir\(bp,)504 1908 A
(i\);)126 2454 A
4680 V
(25762)210 648 A
(free_zone\(dev,)588 1698 A
(z1\);)168 2328 A
4770 V
(25763)210 648 A
1362(})S
4860 V
(25764)210 648 A
4950 V
(25765)210 648 A
1362(/*)S
(Now)126 1488 A
(free)168 1656 A
(the)126 1866 A
(double)252 2034 A
(indirect)336 2328 A
(zone)168 2706 A
(itself.)294 2916 A
3252(*/)S
5040 V
(25766)210 648 A
(put_block\(bp,)546 1362 A
(INDIRECT_BLOCK\);)672 1950 A
5130 V
(25767)210 648 A
(free_zone\(dev,)588 1362 A
(z\);)126 1992 A
5220 V
(25768)210 648 A
1110(})S
5310 V
(25769)210 648 A
5400 V
(25770)210 648 A
1110(/*)S
(Leave)210 1236 A
(zone)168 1488 A
(numbers)294 1698 A
(for)126 2034 A
(de\(1\))210 2202 A
2454(to)S
(recover)294 2580 A
(file)168 2916 A
(after)210 3126 A
3378(an)S
(unlink\(2\).)420 3504 A
4008(*/)S
5490 V
(25771)210 648 A
1026(})S
5760 V
(25774)210 648 A
(/*===========================================================================*)3276 1026 A
5850 V
(25775)210 648 A
1068(*)S
(remove_dir)420 2370 A
4260(*)S
5940 V
(25776)210 648 A
(*===========================================================================*/)3276 1068 A
6030 V
(25777)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(remove_dir\(rldirp,)756 1530 A
(rip,)168 2328 A
(dir_name\))378 2538 A
6120 V
(25778)210 648 A
(struct)252 1026 A
(inode)210 1320 A
(*rldirp;)336 1572 A
2706(/*)S
(parent)252 2832 A
(directory)378 3126 A
3546(*/)S
6210 V
(25779)210 648 A
(struct)252 1026 A
(inode)210 1320 A
(*rip;)210 1572 A
2706(/*)S
(directory)378 2832 A
3252(to)S
3378(be)S
(removed)294 3504 A
3840(*/)S
8418 V
EP
%%Page: 356 356
BP
/slant 0 def
/height 0 def
630 V
12 B
(356)180 648 A
11 R
2160(File:)S
(src/fs/link.c)522 2393 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(25780)210 648 A
(char)168 1026 A
(dir_name[NAME_MAX];)798 1236 A
2706(/*)S
(name)168 2832 A
3042(of)S
(directory)378 3168 A
3588(to)S
3714(be)S
(removed)294 3840 A
4176(*/)S
990 V
(25781)210 648 A
1026({)S
1080 V
(25782)210 648 A
1110(/*)S
1236(A)S
(directory)378 1320 A
(file)168 1740 A
(has)126 1950 A
2118(to)S
2244(be)S
(removed.)336 2370 A
(Five)168 2748 A
(conditions)420 2958 A
(have)168 3420 A
3630(to)S
(met:)168 3756 A
1170 V
(25783)210 648 A
1152(*)S
1362(-)S
(The)126 1446 A
(file)168 1614 A
(must)168 1824 A
2034(be)S
2160(a)S
(directory)378 2244 A
1260 V
(25784)210 648 A
1152(*)S
1362(-)S
(The)126 1446 A
(directory)378 1614 A
(must)168 2034 A
2244(be)S
(empty)210 2370 A
(\(except)294 2622 A
(for)126 2958 A
3126(.)S
(and)126 3210 A
(..\))126 3378 A
1350 V
(25785)210 648 A
1152(*)S
1362(-)S
(The)126 1446 A
(final)210 1614 A
(component)378 1866 A
2286(of)S
(the)126 2412 A
(path)168 2580 A
(must)168 2790 A
(not)126 3000 A
3168(be)S
3294(.)S
3378(or)S
3504(..)S
1440 V
(25786)210 648 A
1152(*)S
1362(-)S
(The)126 1446 A
(directory)378 1614 A
(must)168 2034 A
(not)126 2244 A
2412(be)S
(the)126 2538 A
(root)168 2706 A
2916(of)S
3042(a)S
(mounted)294 3126 A
(file)168 3462 A
(system)252 3672 A
1530 V
(25787)210 648 A
1152(*)S
1362(-)S
(The)126 1446 A
(directory)378 1614 A
(must)168 2034 A
(not)126 2244 A
2412(be)S
(anybody's)378 2538 A
(root/working)504 2958 A
(directory)378 3504 A
1620 V
(25788)210 648 A
1152(*/)S
1710 V
(25789)210 648 A
1800 V
(25790)210 648 A
(int)126 1110 A
1278(r;)S
1890 V
(25791)210 648 A
(register)336 1110 A
(struct)252 1488 A
(fproc)210 1782 A
(*rfp;)210 2034 A
1980 V
(25792)210 648 A
2070 V
(25793)210 648 A
1110(/*)S
(search_dir)420 1236 A
(checks)252 1698 A
(that)168 1992 A
(rip)126 2202 A
2370(is)S
2496(a)S
(directory)378 2580 A
(too.)168 3000 A
3210(*/)S
2160 V
(25794)210 648 A
1110(if)S
(\(\(r)126 1236 A
1404(=)S
(search_dir\(rip,)630 1488 A
("",)126 2160 A
(\(ino_t)252 2328 A
2622(*\))S
2748(0,)S
(IS_EMPTY\)\))420 2874 A
3336(!=)S
(OK\))126 3462 A
(return)252 3630 A
3924(r;)S
2250 V
(25795)210 648 A
2340 V
(25796)210 648 A
1110(if)S
(\(strcmp\(dir_name,)714 1236 A
("."\))168 1992 A
2202(==)S
2328(0)S
2412(||)S
(strcmp\(dir_name,)672 2538 A
(".."\))210 3252 A
3504(==)S
(0\)return\(EINVAL\);)714 3630 A
2430 V
(25797)210 648 A
1110(if)S
(\(rip->i_num)462 1236 A
1740(==)S
(ROOT_INODE\))462 1866 A
(return\(EBUSY\);)588 2370 A
3000(/*)S
(can't)210 3126 A
(remove)252 3378 A
('root')252 3672 A
3966(*/)S
2520 V
(25798)210 648 A
2610 V
(25799)210 648 A
(for)126 1110 A
(\(rfp)168 1278 A
1488(=)S
(&fproc[INIT_PROC_NR)798 1572 A
2412(+)S
(1];)126 2496 A
(rfp)126 2664 A
2832(<)S
(&fproc[NR_PROCS];)714 2916 A
(rfp++\))252 3672 A
2700 V
(25800)210 648 A
1362(if)S
(\(rfp->fp_workdir)672 1488 A
2202(==)S
(rip)126 2328 A
2496(||)S
(rfp->fp_rootdir)630 2622 A
3294(==)S
(rip\))168 3420 A
(return\(EBUSY\);)588 3630 A
2790 V
(25801)210 648 A
2370(/*)S
(can't)210 2496 A
(remove)252 2748 A
(anybody's)378 3042 A
(working)294 3462 A
(dir)126 3798 A
3966(*/)S
2880 V
(25802)210 648 A
2970 V
(25803)210 648 A
1110(/*)S
(Actually)336 1236 A
(try)126 1614 A
1782(to)S
(unlink)252 1908 A
(the)126 2202 A
(file;)210 2370 A
(fails)210 2622 A
2874(if)S
(parent)252 3000 A
3294(is)S
(mode)168 3420 A
3630(0)S
(etc.)168 3714 A
3924(*/)S
3060 V
(25804)210 648 A
1110(if)S
(\(\(r)126 1236 A
1404(=)S
(unlink_file\(rldirp,)798 1488 A
(rip,)168 2328 A
(dir_name\)\))420 2538 A
3000(!=)S
(OK\))126 3126 A
(return)252 3294 A
3588(r;)S
3150 V
(25805)210 648 A
3240 V
(25806)210 648 A
1110(/*)S
(Unlink)252 1236 A
1530(.)S
(and)126 1614 A
1782(..)S
(from)168 1908 A
(the)126 2118 A
(dir.)168 2286 A
(The)126 2496 A
(super)210 2664 A
(user)168 2916 A
(can)126 3126 A
(link)168 3294 A
(and)126 3504 A
(unlink)252 3672 A
(any)126 3966 A
(dir,)168 4134 A
3330 V
(25807)210 648 A
1152(*)S
1236(so)S
(don't)210 1362 A
(make)168 1614 A
(too)126 1824 A
(many)168 1992 A
(assumptions)462 2202 A
(about)210 2706 A
(them.)210 2958 A
3420 V
(25808)210 648 A
1152(*/)S
3510 V
(25809)210 648 A
(\(void\))252 1110 A
(unlink_file\(rip,)672 1404 A
(NIL_INODE,)420 2118 A
(dot1\);)252 2580 A
3600 V
(25810)210 648 A
(\(void\))252 1110 A
(unlink_file\(rip,)672 1404 A
(NIL_INODE,)420 2118 A
(dot2\);)252 2580 A
3690 V
(25811)210 648 A
(return\(OK\);)462 1110 A
3780 V
(25812)210 648 A
1026(})S
4050 V
(25815)210 648 A
(/*===========================================================================*)3276 1026 A
4140 V
(25816)210 648 A
1068(*)S
(unlink_file)462 2370 A
4260(*)S
4230 V
(25817)210 648 A
(*===========================================================================*/)3276 1068 A
4320 V
(25818)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(unlink_file\(dirp,)714 1530 A
(rip,)168 2286 A
(file_name\))420 2496 A
4410 V
(25819)210 648 A
(struct)252 1026 A
(inode)210 1320 A
(*dirp;)252 1572 A
2370(/*)S
(parent)252 2496 A
(directory)378 2790 A
3210(of)S
(file)168 3336 A
3546(*/)S
4500 V
(25820)210 648 A
(struct)252 1026 A
(inode)210 1320 A
(*rip;)210 1572 A
2370(/*)S
(inode)210 2496 A
2748(of)S
(file,)210 2874 A
(may)126 3126 A
3294(be)S
(NIL_INODE)378 3420 A
(too.)168 3840 A
4050(*/)S
4590 V
(25821)210 648 A
(char)168 1026 A
(file_name[NAME_MAX];)840 1236 A
2370(/*)S
(name)168 2496 A
2706(of)S
(file)168 2832 A
3042(to)S
3168(be)S
(removed)294 3294 A
3630(*/)S
4680 V
(25822)210 648 A
1026({)S
4770 V
(25823)210 648 A
1026(/*)S
(Unlink)252 1152 A
('file_name';)504 1446 A
(rip)126 1992 A
(must)168 2160 A
2370(be)S
(the)126 2496 A
(inode)210 2664 A
2916(of)S
('file_name')462 3042 A
3546(or)S
(NIL_INODE.)420 3672 A
4134(*/)S
4860 V
(25824)210 648 A
4950 V
(25825)210 648 A
(ino_t)210 1110 A
(numb;)210 1362 A
2370(/*)S
(inode)210 2496 A
(number)252 2748 A
3042(*/)S
5040 V
(25826)210 648 A
(int)126 1110 A
1362(r;)S
5130 V
(25827)210 648 A
5220 V
(25828)210 648 A
1110(/*)S
1236(If)S
(rip)126 1362 A
1530(is)S
(not)126 1656 A
(NIL_INODE,)420 1824 A
2286(it)S
2412(is)S
(used)168 2538 A
2748(to)S
(get)126 2874 A
(faster)252 3042 A
(access)252 3336 A
3630(to)S
(the)126 3756 A
(inode.)252 3924 A
4218(*/)S
5310 V
(25829)210 648 A
1110(if)S
(\(rip)168 1236 A
1446(==)S
(NIL_INODE\))420 1572 A
2034({)S
5400 V
(25830)210 648 A
1362(/*)S
(Search)252 1488 A
(for)126 1782 A
(file)168 1950 A
2160(in)S
(directory)378 2286 A
(and)126 2706 A
(try)126 2874 A
3042(to)S
(get)126 3168 A
(its)126 3336 A
(inode.)252 3504 A
3798(*/)S
5490 V
(25831)210 648 A
(err_code)336 1362 A
1740(=)S
(search_dir\(dirp,)672 1824 A
(file_name,)420 2538 A
(&numb,)252 3000 A
(LOOK_UP\);)378 3294 A
5580 V
(25832)210 648 A
1362(if)S
(\(err_code)378 1488 A
1908(==)S
(OK\))126 2034 A
(rip)126 2202 A
2370(=)S
(get_inode\(dirp->i_dev,)924 2454 A
(\(int\))210 3420 A
(numb\);)252 3672 A
5670 V
(25833)210 648 A
1362(if)S
(\(err_code)378 1488 A
1908(!=)S
2034(OK)S
2160(||)S
(rip)126 2286 A
2454(==)S
(NIL_INODE\))420 2580 A
(return\(err_code\);)714 3042 A
5760 V
(25834)210 648 A
1110(})S
(else)168 1194 A
1404({)S
5850 V
(25835)210 648 A
(dup_inode\(rip\);)630 1362 A
2370(/*)S
(inode)210 2496 A
(will)168 2748 A
2958(be)S
(returned)336 3084 A
(with)168 3462 A
(put_inode)378 3672 A
4092(*/)S
5940 V
(25836)210 648 A
1110(})S
6030 V
(25837)210 648 A
6120 V
(25838)210 648 A
1110(r)S
1194(=)S
(search_dir\(dirp,)672 1278 A
(file_name,)420 1992 A
(\(ino_t)252 2454 A
2748(*\))S
2874(0,)S
(DELETE\);)336 3000 A
6210 V
(25839)210 648 A
8418 V
EP
%%Page: 357 357
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2160(File:)S
(src/fs/link.c)522 2393 A
12 B
(357)180 4248 A
900 V
7 LST
(25840)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
990 V
(25841)210 648 A
(rip->i_nlinks--;)672 1362 A
2370(/*)S
(entry)210 2496 A
(deleted)294 2748 A
(from)168 3084 A
(parent's)336 3294 A
(dir)126 3672 A
3840(*/)S
1080 V
(25842)210 648 A
(rip->i_update)546 1362 A
1950(|=)S
(CTIME;)252 2076 A
1170 V
(25843)210 648 A
(rip->i_dirt)462 1362 A
1866(=)S
(DIRTY;)252 1950 A
1260 V
(25844)210 648 A
1110(})S
1350 V
(25845)210 648 A
1440 V
(25846)210 648 A
(put_inode\(rip\);)630 1110 A
1530 V
(25847)210 648 A
(return\(r\);)420 1110 A
1620 V
(25848)210 648 A
1026(})S
1890 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1980 V
(src/fs/stadir.c)630 2034 A
2070 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2250 V
(25900)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
(the)126 1950 A
(code)168 2118 A
(for)126 2328 A
(performing)420 2496 A
(four)168 2958 A
(system)252 3168 A
(calls)210 3462 A
(relating)336 3714 A
4092(to)S
2340 V
(25901)210 648 A
1068(*)S
(status)252 1152 A
(and)126 1446 A
(directories.)504 1614 A
2430 V
(25902)210 648 A
1068(*)S
2520 V
(25903)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
2610 V
(25904)210 648 A
1068(*)S
(do_chdir:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(CHDIR)210 2202 A
(system)252 2454 A
(call)168 2748 A
2700 V
(25905)210 648 A
1068(*)S
(do_chroot:)420 1236 A
(perform)294 1698 A
(the)126 2034 A
(CHROOT)252 2202 A
(system)252 2496 A
(call)168 2790 A
2790 V
(25906)210 648 A
1068(*)S
(do_stat:)336 1236 A
(perform)294 1698 A
(the)126 2034 A
(STAT)168 2202 A
(system)252 2412 A
(call)168 2706 A
2880 V
(25907)210 648 A
1068(*)S
(do_fstat:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(FSTAT)210 2202 A
(system)252 2454 A
(call)168 2748 A
2970 V
(25908)210 648 A
1068(*/)S
3060 V
(25909)210 648 A
3150 V
(25910)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
3240 V
(25911)210 648 A
(#include)336 1026 A
(<sys/stat.h>)504 1404 A
3330 V
(25912)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
3420 V
(25913)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
3510 V
(25914)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
3600 V
(25915)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
3690 V
(25916)210 648 A
3780 V
(25917)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(change,)294 2034 A
(\(struct)294 2370 A
(inode)210 2706 A
(**iip,)252 2958 A
(char)168 3252 A
(*name_ptr,)420 3462 A
(int)126 3924 A
(len\)\);)252 4092 A
3870 V
(25918)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(int)126 1866 A
(stat_inode,)462 2034 A
(\(struct)294 2538 A
(inode)210 2874 A
(*rip,)210 3126 A
(struct)252 3378 A
(filp)168 3672 A
(*fil_ptr,)378 3882 A
3960 V
(25919)210 648 A
(char)168 2034 A
(*user_addr\))462 2244 A
4050(\);)S
4050 V
(25920)210 648 A
4140 V
(25921)210 648 A
(/*===========================================================================*)3276 1026 A
4230 V
(25922)210 648 A
1068(*)S
(do_chdir)336 2370 A
4260(*)S
4320 V
(25923)210 648 A
(*===========================================================================*/)3276 1068 A
4410 V
(25924)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_chdir\(\))420 1488 A
4500 V
(25925)210 648 A
1026({)S
4590 V
(25926)210 648 A
1026(/*)S
(Change)252 1152 A
(directory.)420 1446 A
(This)168 1950 A
(function)336 2160 A
2538(is)S
(also)168 2706 A
(called)252 2916 A
3210(by)S
3336(MM)S
3462(to)S
(simulate)336 3588 A
3966(a)S
(chdir)210 4050 A
4680 V
(25927)210 648 A
1068(*)S
1152(in)S
(order)210 1278 A
1530(to)S
1656(do)S
(EXEC,)210 1782 A
(etc.)168 2034 A
2286(It)S
(also)168 2412 A
(changes)294 2622 A
(the)126 2958 A
(root)168 3126 A
(directory,)420 3336 A
(the)126 3798 A
(uids)168 3966 A
(and)126 4176 A
4770 V
(25928)210 648 A
1068(*)S
(gids,)210 1152 A
(and)126 1404 A
(the)126 1572 A
(umask.)252 1740 A
4860 V
(25929)210 648 A
1068(*/)S
4950 V
(25930)210 648 A
5040 V
(25931)210 648 A
(int)126 1110 A
1278(r;)S
5130 V
(25932)210 648 A
(register)336 1110 A
(struct)252 1488 A
(fproc)210 1782 A
(*rfp;)210 2034 A
5220 V
(25933)210 648 A
5310 V
(25934)210 648 A
1110(if)S
(\(who)168 1236 A
1446(==)S
(MM_PROC_NR\))462 1572 A
2076({)S
5400 V
(25935)210 648 A
(rfp)126 1362 A
1530(=)S
(&fproc[slot1];)588 1614 A
5490 V
(25936)210 648 A
(put_inode\(fp->fp_rootdir\);)1092 1362 A
5580 V
(25937)210 648 A
(dup_inode\(fp->fp_rootdir)1008 1362 A
2412(=)S
(rfp->fp_rootdir\);)714 2496 A
5670 V
(25938)210 648 A
(put_inode\(fp->fp_workdir\);)1092 1362 A
5760 V
(25939)210 648 A
(dup_inode\(fp->fp_workdir)1008 1362 A
2412(=)S
(rfp->fp_workdir\);)714 2496 A
5850 V
(25940)210 648 A
5940 V
(25941)210 648 A
1362(/*)S
1488(MM)S
(uses)168 1614 A
(access\(\))336 1824 A
2202(to)S
(check)210 2328 A
(permissions.)504 2580 A
3168(To)S
(make)168 3294 A
(this)168 3504 A
(work,)210 3714 A
(pretend)294 3966 A
6030 V
(25942)210 648 A
1404(*)S
(that)168 1488 A
(the)126 1698 A
(user's)252 1866 A
(real)168 2160 A
(ids)126 2370 A
(are)126 2538 A
(the)126 2706 A
(same)168 2874 A
3084(as)S
(the)126 3210 A
(user's)252 3378 A
(effective)378 3672 A
(ids.)168 4092 A
6120 V
(25943)210 648 A
1404(*)S
1488(FS)S
(calls)210 1614 A
(other)210 1866 A
(than)168 2118 A
(access\(\))336 2328 A
2706(do)S
(not)126 2832 A
(use)126 3000 A
(the)126 3168 A
(real)168 3336 A
(ids,)168 3546 A
3756(so)S
(are)126 3882 A
(not)126 4050 A
6210 V
(25944)210 648 A
1404(*)S
(affected.)378 1488 A
8418 V
EP
%%Page: 358 358
BP
/slant 0 def
/height 0 def
630 V
12 B
(358)180 648 A
11 R
2123(File:)S
2356(src/fs/stadir.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(25945)210 648 A
1404(*/)S
990 V
(25946)210 648 A
(fp->fp_realuid)588 1362 A
1992(=)S
1080 V
(25947)210 648 A
(fp->fp_effuid)546 1362 A
1950(=)S
(rfp->fp_effuid;)630 2034 A
1170 V
(25948)210 648 A
(fp->fp_realgid)588 1362 A
1992(=)S
1260 V
(25949)210 648 A
(fp->fp_effgid)546 1362 A
1950(=)S
(rfp->fp_effgid;)630 2034 A
1350 V
(25950)210 648 A
(fp->fp_umask)504 1362 A
1908(=)S
(rfp->fp_umask;)588 1992 A
1440 V
(25951)210 648 A
(return\(OK\);)462 1362 A
1530 V
(25952)210 648 A
1110(})S
1620 V
(25953)210 648 A
1710 V
(25954)210 648 A
1110(/*)S
(Perform)294 1236 A
(the)126 1572 A
(chdir\(name\))462 1740 A
(system)252 2244 A
(call.)210 2538 A
2790(*/)S
1800 V
(25955)210 648 A
1110(r)S
1194(=)S
(change\(&fp->fp_workdir,)966 1278 A
(name,)210 2286 A
(name_length\);)546 2538 A
1890 V
(25956)210 648 A
(return\(r\);)420 1110 A
1980 V
(25957)210 648 A
1026(})S
2250 V
(25960)210 648 A
(/*===========================================================================*)3276 1026 A
2340 V
(25961)210 648 A
1068(*)S
(do_chroot)378 2370 A
4260(*)S
2430 V
(25962)210 648 A
(*===========================================================================*/)3276 1068 A
2520 V
(25963)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_chroot\(\))462 1488 A
2610 V
(25964)210 648 A
1026({)S
2700 V
(25965)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(chroot\(name\))504 1656 A
(system)252 2202 A
(call.)210 2496 A
2748(*/)S
2790 V
(25966)210 648 A
2880 V
(25967)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(r;)S
2970 V
(25968)210 648 A
3060 V
(25969)210 648 A
1110(if)S
(\(!super_user\))546 1236 A
(return\(EPERM\);)588 1824 A
2706(/*)S
(only)168 2832 A
3042(su)S
(may)126 3168 A
(chroot\(\))336 3336 A
3714(*/)S
3150 V
(25970)210 648 A
1110(r)S
1194(=)S
(change\(&fp->fp_rootdir,)966 1278 A
(name,)210 2286 A
(name_length\);)546 2538 A
3240 V
(25971)210 648 A
(return\(r\);)420 1110 A
3330 V
(25972)210 648 A
1026(})S
3600 V
(25975)210 648 A
(/*===========================================================================*)3276 1026 A
3690 V
(25976)210 648 A
1068(*)S
(change)252 2370 A
4260(*)S
3780 V
(25977)210 648 A
(*===========================================================================*/)3276 1068 A
3870 V
(25978)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(change\(iip,)462 1530 A
(name_ptr,)378 2034 A
(len\))168 2454 A
3960 V
(25979)210 648 A
(struct)252 1026 A
(inode)210 1320 A
(**iip;)252 1572 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(the)126 2958 A
(inode)210 3126 A
(pointer)294 3378 A
(for)126 3714 A
(the)126 3882 A
(dir)126 4050 A
4218(*/)S
4050 V
(25980)210 648 A
(char)168 1026 A
(*name_ptr;)420 1236 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(the)126 2958 A
(directory)378 3126 A
(name)168 3546 A
3756(to)S
(change)252 3882 A
4176(to)S
4302(*/)S
4140 V
(25981)210 648 A
(int)126 1026 A
(len;)168 1194 A
2370(/*)S
(length)252 2496 A
2790(of)S
(the)126 2916 A
(directory)378 3084 A
(name)168 3504 A
(string)252 3714 A
4008(*/)S
4230 V
(25982)210 648 A
1026({)S
4320 V
(25983)210 648 A
1026(/*)S
1152(Do)S
(the)126 1278 A
(actual)252 1446 A
(work)168 1740 A
(for)126 1950 A
(chdir\(\))294 2118 A
(and)126 2454 A
(chroot\(\).)378 2622 A
3042(*/)S
4410 V
(25984)210 648 A
4500 V
(25985)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*rip;)210 1656 A
4590 V
(25986)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(r;)S
4680 V
(25987)210 648 A
4770 V
(25988)210 648 A
1110(/*)S
(Try)126 1236 A
1404(to)S
(open)168 1530 A
(the)126 1740 A
(new)126 1908 A
(directory.)420 2076 A
2538(*/)S
4860 V
(25989)210 648 A
1110(if)S
(\(fetch_name\(name_ptr,)882 1236 A
(len,)168 2160 A
(M3\))126 2370 A
2538(!=)S
(OK\))126 2664 A
(return\(err_code\);)714 2832 A
4950 V
(25990)210 648 A
1110(if)S
1236(\()S
(\(rip)168 1320 A
1530(=)S
(eat_path\(user_path\)\))840 1614 A
2496(==)S
(NIL_INODE\))420 2622 A
(return\(err_code\);)714 3084 A
5040 V
(25991)210 648 A
5130 V
(25992)210 648 A
1110(/*)S
1236(It)S
(must)168 1362 A
1572(be)S
1698(a)S
(directory)378 1782 A
(and)126 2202 A
(also)168 2370 A
2580(be)S
(searchable.)462 2706 A
3210(*/)S
5220 V
(25993)210 648 A
1110(if)S
1236(\()S
(\(rip->i_mode)504 1320 A
1866(&)S
(I_TYPE\))294 1950 A
2286(!=)S
(I_DIRECTORY\))504 2412 A
5310 V
(25994)210 648 A
1362(r)S
1446(=)S
(ENOTDIR;)336 1530 A
5400 V
(25995)210 648 A
(else)168 1110 A
5490 V
(25996)210 648 A
1362(r)S
1446(=)S
(forbidden\(rip,)588 1530 A
(X_BIT\);)294 2160 A
2706(/*)S
(check)210 2832 A
3084(if)S
(dir)126 3210 A
3378(is)S
(searchable)420 3504 A
3966(*/)S
5580 V
(25997)210 648 A
5670 V
(25998)210 648 A
1110(/*)S
1236(If)S
(error,)252 1362 A
(return)252 1656 A
(inode.)252 1950 A
2244(*/)S
5760 V
(25999)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
1656({)S
5850 V
(26000)210 648 A
(put_inode\(rip\);)630 1362 A
5940 V
(26001)210 648 A
(return\(r\);)420 1362 A
6030 V
(26002)210 648 A
1110(})S
6120 V
(26003)210 648 A
6210 V
(26004)210 648 A
1110(/*)S
(Everything)420 1236 A
1698(is)S
(OK.)126 1824 A
(Make)168 2034 A
(the)126 2244 A
(change.)294 2412 A
2748(*/)S
8418 V
EP
%%Page: 359 359
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2123(File:)S
2356(src/fs/stadir.c)S
12 B
(359)180 4248 A
900 V
7 LST
(26005)210 648 A
(put_inode\(*iip\);)672 1110 A
2370(/*)S
(release)294 2496 A
(the)126 2832 A
(old)126 3000 A
(directory)378 3168 A
3588(*/)S
990 V
(26006)210 648 A
(*iip)168 1110 A
1320(=)S
(rip;)168 1404 A
2370(/*)S
(acquire)294 2496 A
(the)126 2832 A
(new)126 3000 A
(one)126 3168 A
3336(*/)S
1080 V
(26007)210 648 A
(return\(OK\);)462 1110 A
1170 V
(26008)210 648 A
1026(})S
1440 V
(26011)210 648 A
(/*===========================================================================*)3276 1026 A
1530 V
(26012)210 648 A
1068(*)S
(do_stat)294 2370 A
4260(*)S
1620 V
(26013)210 648 A
(*===========================================================================*/)3276 1068 A
1710 V
(26014)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_stat\(\))378 1488 A
1800 V
(26015)210 648 A
1026({)S
1890 V
(26016)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(stat\(name,)420 1656 A
(buf\))168 2118 A
(system)252 2328 A
(call.)210 2622 A
2874(*/)S
1980 V
(26017)210 648 A
2070 V
(26018)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
2160 V
(26019)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(r;)S
2250 V
(26020)210 648 A
2340 V
(26021)210 648 A
1110(/*)S
(Both)168 1236 A
(stat\(\))252 1446 A
(and)126 1740 A
(fstat\(\))294 1908 A
(use)126 2244 A
(the)126 2412 A
(same)168 2580 A
(routine)294 2790 A
3126(to)S
3252(do)S
(the)126 3378 A
(real)168 3546 A
(work.)210 3756 A
(That)168 4050 A
2430 V
(26022)210 648 A
1152(*)S
(routine)294 1236 A
(expects)294 1572 A
1908(an)S
(inode,)252 2034 A
2328(so)S
(acquire)294 2454 A
2790(it)S
(temporarily.)504 2916 A
2520 V
(26023)210 648 A
1152(*/)S
2610 V
(26024)210 648 A
1110(if)S
(\(fetch_name\(name1,)756 1236 A
(name1_length,)546 2034 A
(M1\))126 2622 A
2790(!=)S
(OK\))126 2916 A
(return\(err_code\);)714 3084 A
2700 V
(26025)210 648 A
1110(if)S
1236(\()S
(\(rip)168 1320 A
1530(=)S
(eat_path\(user_path\)\))840 1614 A
2496(==)S
(NIL_INODE\))420 2622 A
(return\(err_code\);)714 3084 A
2790 V
(26026)210 648 A
1110(r)S
1194(=)S
(stat_inode\(rip,)630 1278 A
(NIL_FILP,)378 1950 A
(name2\);)294 2370 A
2706(/*)S
(actually)336 2832 A
3210(do)S
(the)126 3336 A
(work.*/)294 3504 A
2880 V
(26027)210 648 A
(put_inode\(rip\);)630 1110 A
2370(/*)S
(release)294 2496 A
(the)126 2832 A
(inode)210 3000 A
3252(*/)S
2970 V
(26028)210 648 A
(return\(r\);)420 1110 A
3060 V
(26029)210 648 A
1026(})S
3330 V
(26032)210 648 A
(/*===========================================================================*)3276 1026 A
3420 V
(26033)210 648 A
1068(*)S
(do_fstat)336 2370 A
4260(*)S
3510 V
(26034)210 648 A
(*===========================================================================*/)3276 1068 A
3600 V
(26035)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_fstat\(\))420 1488 A
3690 V
(26036)210 648 A
1026({)S
3780 V
(26037)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(fstat\(fd,)378 1656 A
(buf\))168 2076 A
(system)252 2286 A
(call.)210 2580 A
2832(*/)S
3870 V
(26038)210 648 A
3960 V
(26039)210 648 A
(register)336 1110 A
(struct)252 1488 A
(filp)168 1782 A
(*rfilp;)294 1992 A
4050 V
(26040)210 648 A
4140 V
(26041)210 648 A
1110(/*)S
1236(Is)S
(the)126 1362 A
(file)168 1530 A
(descriptor)420 1740 A
(valid?)252 2202 A
2496(*/)S
4230 V
(26042)210 648 A
1110(if)S
1236(\()S
(\(rfilp)252 1320 A
1614(=)S
(get_filp\(fd\)\))546 1698 A
2286(==)S
(NIL_FILP\))378 2412 A
(return\(err_code\);)714 2832 A
4320 V
(26043)210 648 A
4410 V
(26044)210 648 A
(return\(stat_inode\(rfilp->filp_ino,)1428 1110 A
(rfilp,)252 2580 A
(buffer\)\);)378 2874 A
4500 V
(26045)210 648 A
1026(})S
4770 V
(26048)210 648 A
(/*===========================================================================*)3276 1026 A
4860 V
(26049)210 648 A
1068(*)S
(stat_inode)420 2370 A
4260(*)S
4950 V
(26050)210 648 A
(*===========================================================================*/)3276 1068 A
5040 V
(26051)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(stat_inode\(rip,)630 1530 A
(fil_ptr,)336 2202 A
(user_addr\))420 2580 A
5130 V
(26052)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
3210(to)S
(stat)168 3336 A
3546(*/)S
5220 V
(26053)210 648 A
(struct)252 1026 A
(filp)168 1320 A
(*fil_ptr;)378 1530 A
2370(/*)S
(filp)168 2496 A
(pointer,)336 2706 A
(supplied)336 3084 A
3462(by)S
('fstat')294 3588 A
3924(*/)S
5310 V
(26054)210 648 A
(char)168 1026 A
(*user_addr;)462 1236 A
2370(/*)S
(user)168 2496 A
(space)210 2706 A
(address)294 2958 A
(where)210 3294 A
(stat)168 3546 A
(buf)126 3756 A
(goes)168 3924 A
4134(*/)S
5400 V
(26055)210 648 A
1026({)S
5490 V
(26056)210 648 A
1026(/*)S
(Common)252 1152 A
(code)168 1446 A
(for)126 1656 A
(stat)168 1824 A
(and)126 2034 A
(fstat)210 2202 A
(system)252 2454 A
(calls.)252 2748 A
3042(*/)S
5580 V
(26057)210 648 A
5670 V
(26058)210 648 A
(struct)252 1110 A
(stat)168 1404 A
(statbuf;)336 1614 A
5760 V
(26059)210 648 A
(mode_t)252 1110 A
(mo;)126 1404 A
5850 V
(26060)210 648 A
(int)126 1110 A
1278(r,)S
1404(s;)S
5940 V
(26061)210 648 A
6030 V
(26062)210 648 A
1110(/*)S
(Update)252 1236 A
(the)126 1530 A
(atime,)252 1698 A
(ctime,)252 1992 A
(and)126 2286 A
(mtime)210 2454 A
(fields)252 2706 A
3000(in)S
(the)126 3126 A
(inode,)252 3294 A
3588(if)S
(need)168 3714 A
(be.)126 3924 A
4092(*/)S
6120 V
(26063)210 648 A
1110(if)S
(\(rip->i_update\))630 1236 A
(update_times\(rip\);)756 1908 A
6210 V
(26064)210 648 A
8418 V
EP
%%Page: 360 360
BP
/slant 0 def
/height 0 def
630 V
12 B
(360)180 648 A
11 R
2123(File:)S
2356(src/fs/stadir.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(26065)210 648 A
1110(/*)S
(Fill)168 1236 A
1446(in)S
(the)126 1572 A
(statbuf)294 1740 A
(struct.)294 2076 A
2412(*/)S
990 V
(26066)210 648 A
1110(mo)S
1236(=)S
(rip->i_mode)462 1320 A
1824(&)S
(I_TYPE;)294 1908 A
1080 V
(26067)210 648 A
1110(s)S
1194(=)S
(\(mo)126 1278 A
1446(==)S
(I_CHAR_SPECIAL)588 1572 A
2202(||)S
2328(mo)S
2454(==)S
(I_BLOCK_SPECIAL\);)714 2580 A
3378(/*)S
(true)168 3504 A
(iff)126 3714 A
(special)294 3882 A
4218(*/)S
1170 V
(26068)210 648 A
(statbuf.st_dev)588 1110 A
1740(=)S
(rip->i_dev;)462 1824 A
1260 V
(26069)210 648 A
(statbuf.st_ino)588 1110 A
1740(=)S
(rip->i_num;)462 1824 A
1350 V
(26070)210 648 A
(statbuf.st_mode)630 1110 A
1782(=)S
(rip->i_mode;)504 1866 A
1440 V
(26071)210 648 A
(statbuf.st_nlink)672 1110 A
1824(=)S
(rip->i_nlinks)546 1908 A
2496(&)S
(BYTE;)210 2580 A
1530 V
(26072)210 648 A
(statbuf.st_uid)588 1110 A
1740(=)S
(rip->i_uid;)462 1824 A
1620 V
(26073)210 648 A
(statbuf.st_gid)588 1110 A
1740(=)S
(rip->i_gid)420 1824 A
2286(&)S
(BYTE;)210 2370 A
1710 V
(26074)210 648 A
(statbuf.st_rdev)630 1110 A
1782(=)S
(\(dev_t\))294 1866 A
2202(\(s)S
2328(?)S
(rip->i_zone[0])588 2412 A
3042(:)S
(NO_DEV\);)336 3126 A
1800 V
(26075)210 648 A
(statbuf.st_size)630 1110 A
1782(=)S
(rip->i_size;)504 1866 A
1890 V
(26076)210 648 A
1980 V
(26077)210 648 A
1110(if)S
(\(rip->i_pipe)504 1236 A
1782(==)S
(I_PIPE\))294 1908 A
2244({)S
2070 V
(26078)210 648 A
(statbuf.st_mode)630 1362 A
2034(&=)S
(\304I_REGULAR;)462 2160 A
2706(/*)S
(wipe)168 2832 A
(out)126 3042 A
(I_REGULAR)378 3210 A
(bit)126 3630 A
(for)126 3798 A
(pipes)210 3966 A
4218(*/)S
2160 V
(26079)210 648 A
1362(if)S
(\(fil_ptr)336 1488 A
1866(!=)S
(NIL_FILP)336 1992 A
2370(&&)S
(fil_ptr->filp_mode)756 2496 A
3294(&)S
(R_BIT\))252 3378 A
2250 V
(26080)210 648 A
(statbuf.st_size)630 1698 A
2370(-=)S
(fil_ptr->filp_pos;)756 2496 A
2340 V
(26081)210 648 A
1110(})S
2430 V
(26082)210 648 A
2520 V
(26083)210 648 A
(statbuf.st_atime)672 1110 A
1824(=)S
(rip->i_atime;)546 1908 A
2610 V
(26084)210 648 A
(statbuf.st_mtime)672 1110 A
1824(=)S
(rip->i_mtime;)546 1908 A
2700 V
(26085)210 648 A
(statbuf.st_ctime)672 1110 A
1824(=)S
(rip->i_ctime;)546 1908 A
2790 V
(26086)210 648 A
2880 V
(26087)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(struct)252 1614 A
1908(to)S
(user)168 2034 A
(space.)252 2244 A
2538(*/)S
2970 V
(26088)210 648 A
1110(r)S
1194(=)S
(sys_copy\(FS_PROC_NR,)840 1278 A
2160(D,)S
(\(phys_bytes\))504 2286 A
(&statbuf,)378 2832 A
3060 V
(26089)210 648 A
(who,)168 1698 A
1908(D,)S
(\(phys_bytes\))504 2034 A
(user_addr,)420 2580 A
(\(phys_bytes\))504 3042 A
(sizeof\(statbuf\)\);)714 3588 A
3150 V
(26090)210 648 A
(return\(r\);)420 1110 A
3240 V
(26091)210 648 A
1026(})S
3690 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
3780 V
(src/fs/protect.c)672 2034 A
3870 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4050 V
(26100)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(deals)210 1572 A
(with)168 1824 A
(protection)420 2034 A
2496(in)S
(the)126 2622 A
(file)168 2790 A
(system.)294 3000 A
3378(It)S
(contains)336 3504 A
(the)126 3882 A
(code)168 4050 A
4140 V
(26101)210 648 A
1068(*)S
(for)126 1152 A
(four)168 1320 A
(system)252 1530 A
(calls)210 1824 A
(that)168 2076 A
(relate)252 2286 A
2580(to)S
(protection.)462 2706 A
4230 V
(26102)210 648 A
1068(*)S
4320 V
(26103)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
4410 V
(26104)210 648 A
1068(*)S
(do_chmod:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(CHMOD)210 2202 A
(system)252 2454 A
(call)168 2748 A
4500 V
(26105)210 648 A
1068(*)S
(do_chown:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(CHOWN)210 2202 A
(system)252 2454 A
(call)168 2748 A
4590 V
(26106)210 648 A
1068(*)S
(do_umask:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(UMASK)210 2202 A
(system)252 2454 A
(call)168 2748 A
4680 V
(26107)210 648 A
1068(*)S
(do_access:)420 1236 A
(perform)294 1698 A
(the)126 2034 A
(ACCESS)252 2202 A
(system)252 2496 A
(call)168 2790 A
4770 V
(26108)210 648 A
1068(*)S
(forbidden:)420 1236 A
(check)210 1698 A
1950(to)S
(see)126 2076 A
2244(if)S
2370(a)S
(given)210 2454 A
(access)252 2706 A
3000(is)S
(allowed)294 3126 A
3462(on)S
3588(a)S
(given)210 3672 A
(inode)210 3924 A
4860 V
(26109)210 648 A
1068(*/)S
4950 V
(26110)210 648 A
5040 V
(26111)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
5130 V
(26112)210 648 A
(#include)336 1026 A
(<unistd.h>)420 1404 A
5220 V
(26113)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
5310 V
(26114)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
5400 V
(26115)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
5490 V
(26116)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
5580 V
(26117)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
5670 V
(26118)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
5760 V
(26119)210 648 A
(#include)336 1026 A
("super.h")378 1404 A
5850 V
(26120)210 648 A
5940 V
(26121)210 648 A
(/*===========================================================================*)3276 1026 A
6030 V
(26122)210 648 A
1068(*)S
(do_chmod)336 2370 A
4260(*)S
6120 V
(26123)210 648 A
(*===========================================================================*/)3276 1068 A
6210 V
(26124)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_chmod\(\))420 1488 A
8418 V
EP
%%Page: 361 361
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2092(File:)S
2325(src/fs/protect.c)S
12 B
(361)180 4248 A
900 V
7 LST
(26125)210 648 A
1026({)S
990 V
(26126)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(chmod\(name,)462 1656 A
(mode\))210 2160 A
(system)252 2412 A
(call.)210 2706 A
2958(*/)S
1080 V
(26127)210 648 A
1170 V
(26128)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
1260 V
(26129)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(r;)S
1350 V
(26130)210 648 A
1440 V
(26131)210 648 A
1110(/*)S
(Temporarily)462 1236 A
(open)168 1740 A
(the)126 1950 A
(file.)210 2118 A
2370(*/)S
1530 V
(26132)210 648 A
1110(if)S
(\(fetch_name\(name,)714 1236 A
(name_length,)504 1992 A
(M3\))126 2538 A
2706(!=)S
(OK\))126 2832 A
(return\(err_code\);)714 3000 A
1620 V
(26133)210 648 A
1110(if)S
1236(\()S
(\(rip)168 1320 A
1530(=)S
(eat_path\(user_path\)\))840 1614 A
2496(==)S
(NIL_INODE\))420 2622 A
(return\(err_code\);)714 3084 A
1710 V
(26134)210 648 A
1800 V
(26135)210 648 A
1110(/*)S
(Only)168 1236 A
(the)126 1446 A
(owner)210 1614 A
1866(or)S
(the)126 1992 A
(super_user)420 2160 A
(may)126 2622 A
(change)252 2790 A
(the)126 3084 A
(mode)168 3252 A
3462(of)S
3588(a)S
(file.)210 3672 A
1890 V
(26136)210 648 A
1152(*)S
1236(No)S
(one)126 1362 A
(may)126 1530 A
(change)252 1698 A
(the)126 1992 A
(mode)168 2160 A
2370(of)S
2496(a)S
(file)168 2580 A
2790(on)S
2916(a)S
(read-only)378 3000 A
(file)168 3420 A
(system.)294 3630 A
1980 V
(26137)210 648 A
1152(*/)S
2070 V
(26138)210 648 A
1110(if)S
(\(rip->i_uid)462 1236 A
1740(!=)S
(fp->fp_effuid)546 1866 A
2454(&&)S
(!super_user\))504 2580 A
2160 V
(26139)210 648 A
1362(r)S
1446(=)S
(EPERM;)252 1530 A
2250 V
(26140)210 648 A
(else)168 1110 A
2340 V
(26141)210 648 A
1362(r)S
1446(=)S
(read_only\(rip\);)630 1530 A
2430 V
(26142)210 648 A
2520 V
(26143)210 648 A
1110(/*)S
1236(If)S
(error,)252 1362 A
(return)252 1656 A
(inode.)252 1950 A
2244(*/)S
2610 V
(26144)210 648 A
1110(if)S
1236(\(r)S
1362(!=)S
(OK\))126 1488 A
1698({)S
2700 V
(26145)210 648 A
(put_inode\(rip\);)630 1362 A
2790 V
(26146)210 648 A
(return\(r\);)420 1362 A
2880 V
(26147)210 648 A
1110(})S
2970 V
(26148)210 648 A
3060 V
(26149)210 648 A
1110(/*)S
(Now)126 1236 A
(make)168 1404 A
(the)126 1614 A
(change.)294 1782 A
(Clear)210 2118 A
(setgid)252 2370 A
(bit)126 2664 A
2832(if)S
(file)168 2958 A
3168(is)S
(not)126 3294 A
3462(in)S
(caller's)336 3588 A
(grp)126 3966 A
4134(*/)S
3150 V
(26150)210 648 A
(rip->i_mode)462 1110 A
1614(=)S
(\(rip->i_mode)504 1698 A
2244(&)S
(\304ALL_MODES\))462 2328 A
2832(|)S
(\(mode)210 2916 A
3168(&)S
(ALL_MODES\);)462 3252 A
3240 V
(26151)210 648 A
1110(if)S
(\(!super_user)504 1236 A
1782(&&)S
(rip->i_gid)420 1908 A
2370(!=)S
(fp->fp_effgid\)rip->i_mode)1050 2496 A
3588(&=)S
(\304I_SET_GID_BIT;)630 3714 A
3330 V
(26152)210 648 A
(rip->i_update)546 1110 A
1698(|=)S
(CTIME;)252 1824 A
3420 V
(26153)210 648 A
(rip->i_dirt)462 1110 A
1614(=)S
(DIRTY;)252 1698 A
3510 V
(26154)210 648 A
3600 V
(26155)210 648 A
(put_inode\(rip\);)630 1110 A
3690 V
(26156)210 648 A
(return\(OK\);)462 1110 A
3780 V
(26157)210 648 A
1026(})S
4050 V
(26160)210 648 A
(/*===========================================================================*)3276 1026 A
4140 V
(26161)210 648 A
1068(*)S
(do_chown)336 2370 A
4260(*)S
4230 V
(26162)210 648 A
(*===========================================================================*/)3276 1068 A
4320 V
(26163)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_chown\(\))420 1488 A
4410 V
(26164)210 648 A
1026({)S
4500 V
(26165)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(chown\(name,)462 1656 A
(owner,)252 2160 A
(group\))252 2454 A
(system)252 2748 A
(call.)210 3042 A
3294(*/)S
4590 V
(26166)210 648 A
4680 V
(26167)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
4770 V
(26168)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(r;)S
4860 V
(26169)210 648 A
4950 V
(26170)210 648 A
1110(/*)S
(Temporarily)462 1236 A
(open)168 1740 A
(the)126 1950 A
(file.)210 2118 A
2370(*/)S
5040 V
(26171)210 648 A
1110(if)S
(\(fetch_name\(name1,)756 1236 A
(name1_length,)546 2034 A
(M1\))126 2622 A
2790(!=)S
(OK\))126 2916 A
(return\(err_code\);)714 3084 A
5130 V
(26172)210 648 A
1110(if)S
1236(\()S
(\(rip)168 1320 A
1530(=)S
(eat_path\(user_path\)\))840 1614 A
2496(==)S
(NIL_INODE\))420 2622 A
(return\(err_code\);)714 3084 A
5220 V
(26173)210 648 A
5310 V
(26174)210 648 A
1110(/*)S
(Not)126 1236 A
(permitted)378 1404 A
1824(to)S
(change)252 1950 A
(the)126 2244 A
(owner)210 2412 A
2664(of)S
2790(a)S
(file)168 2874 A
3084(on)S
3210(a)S
(read-only)378 3294 A
(file)168 3714 A
(sys.)168 3924 A
4134(*/)S
5400 V
(26175)210 648 A
1110(r)S
1194(=)S
(read_only\(rip\);)630 1278 A
5490 V
(26176)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
5580 V
(26177)210 648 A
1362(/*)S
1488(FS)S
1614(is)S
(R/W.)168 1740 A
(Whether)294 1992 A
(call)168 2328 A
2538(is)S
(allowed)294 2664 A
(depends)294 3000 A
3336(on)S
(ownership,)420 3462 A
(etc.)168 3924 A
4134(*/)S
5670 V
(26178)210 648 A
1362(if)S
(\(super_user\))504 1488 A
2034({)S
5760 V
(26179)210 648 A
1698(/*)S
(The)126 1824 A
(super)210 1992 A
(user)168 2244 A
(can)126 2454 A
2622(do)S
(anything.)378 2748 A
3168(*/)S
5850 V
(26180)210 648 A
(rip->i_uid)420 1698 A
2160(=)S
(owner;)252 2244 A
2706(/*)S
(others)252 2832 A
(later)210 3126 A
3378(*/)S
5940 V
(26181)210 648 A
1362(})S
(else)168 1446 A
1656({)S
6030 V
(26182)210 648 A
1698(/*)S
(Regular)294 1824 A
(users)210 2160 A
(can)126 2412 A
(only)168 2580 A
(change)252 2790 A
(groups)252 3084 A
3378(of)S
(their)210 3504 A
(own)126 3756 A
(files.)252 3924 A
4218(*/)S
6120 V
(26183)210 648 A
1698(if)S
(\(rip->i_uid)462 1824 A
2328(!=)S
(fp->fp_effuid\))588 2454 A
3084(r)S
3168(=)S
(EPERM;)252 3252 A
6210 V
(26184)210 648 A
1698(if)S
(\(rip->i_uid)462 1824 A
2328(!=)S
(owner\))252 2454 A
2748(r)S
2832(=)S
(EPERM;)252 2916 A
3378(/*)S
3504(no)S
(giving)252 3630 A
(away)168 3924 A
4134(*/)S
8418 V
EP
%%Page: 362 362
BP
/slant 0 def
/height 0 def
630 V
12 B
(362)180 648 A
11 R
2092(File:)S
2325(src/fs/protect.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(26185)210 648 A
1698(if)S
(\(fp->fp_effgid)588 1824 A
2454(!=)S
(group\))252 2580 A
2874(r)S
2958(=)S
(EPERM;)252 3042 A
990 V
(26186)210 648 A
1362(})S
1080 V
(26187)210 648 A
1110(})S
1170 V
(26188)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
1260 V
(26189)210 648 A
(rip->i_gid)420 1362 A
1824(=)S
(group;)252 1908 A
1350 V
(26190)210 648 A
(rip->i_mode)462 1362 A
1866(&=)S
(\304\(I_SET_UID_BIT)630 1992 A
2664(|)S
(I_SET_GID_BIT\);)630 2748 A
1440 V
(26191)210 648 A
(rip->i_update)546 1362 A
1950(|=)S
(CTIME;)252 2076 A
1530 V
(26192)210 648 A
(rip->i_dirt)462 1362 A
1866(=)S
(DIRTY;)252 1950 A
1620 V
(26193)210 648 A
1110(})S
1710 V
(26194)210 648 A
1800 V
(26195)210 648 A
(put_inode\(rip\);)630 1110 A
1890 V
(26196)210 648 A
(return\(r\);)420 1110 A
1980 V
(26197)210 648 A
1026(})S
2250 V
(26200)210 648 A
(/*===========================================================================*)3276 1026 A
2340 V
(26201)210 648 A
1068(*)S
(do_umask)336 2370 A
4260(*)S
2430 V
(26202)210 648 A
(*===========================================================================*/)3276 1068 A
2520 V
(26203)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_umask\(\))420 1488 A
2610 V
(26204)210 648 A
1026({)S
2700 V
(26205)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(umask\(co_mode\))588 1656 A
(system)252 2286 A
(call.)210 2580 A
2832(*/)S
2790 V
(26206)210 648 A
(register)336 1110 A
(mode_t)252 1488 A
1782(r;)S
2880 V
(26207)210 648 A
2970 V
(26208)210 648 A
1110(r)S
1194(=)S
(\304fp->fp_umask;)588 1278 A
2370(/*)S
(set)126 2496 A
('r')126 2664 A
2832(to)S
(complement)420 2958 A
3420(of)S
(old)126 3546 A
(mask)168 3714 A
3924(*/)S
3060 V
(26209)210 648 A
(fp->fp_umask)504 1110 A
1656(=)S
(\304\(co_mode)378 1740 A
2160(&)S
(RWX_MODES\);)462 2244 A
3150 V
(26210)210 648 A
(return\(r\);)420 1110 A
2370(/*)S
(return)252 2496 A
(complement)420 2790 A
3252(of)S
(old)126 3378 A
(mask)168 3546 A
3756(*/)S
3240 V
(26211)210 648 A
1026(})S
3510 V
(26214)210 648 A
(/*===========================================================================*)3276 1026 A
3600 V
(26215)210 648 A
1068(*)S
(do_access)378 2370 A
4260(*)S
3690 V
(26216)210 648 A
(*===========================================================================*/)3276 1068 A
3780 V
(26217)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_access\(\))462 1488 A
3870 V
(26218)210 648 A
1026({)S
3960 V
(26219)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(access\(name,)504 1656 A
(mode\))210 2202 A
(system)252 2454 A
(call.)210 2748 A
3000(*/)S
4050 V
(26220)210 648 A
4140 V
(26221)210 648 A
(struct)252 1110 A
(inode)210 1404 A
(*rip;)210 1656 A
4230 V
(26222)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(r;)S
4320 V
(26223)210 648 A
4410 V
(26224)210 648 A
1110(/*)S
(First)210 1236 A
(check)210 1488 A
1740(to)S
(see)126 1866 A
2034(if)S
(the)126 2160 A
(mode)168 2328 A
2538(is)S
(correct.)336 2664 A
3042(*/)S
4500 V
(26225)210 648 A
1110(if)S
1236(\()S
(\(mode)210 1320 A
1572(&)S
(\304\(R_OK)252 1656 A
1950(|)S
(W_OK)168 2034 A
2244(|)S
(X_OK\)\))252 2328 A
2622(!=)S
2748(0)S
2832(&&)S
(mode)168 2958 A
3168(!=)S
(F_OK\))210 3294 A
4590 V
(26226)210 648 A
(return\(EINVAL\);)630 1362 A
4680 V
(26227)210 648 A
4770 V
(26228)210 648 A
1110(/*)S
(Temporarily)462 1236 A
(open)168 1740 A
(the)126 1950 A
(file)168 2118 A
(whose)210 2328 A
(access)252 2580 A
2874(is)S
3000(to)S
3126(be)S
(checked.)336 3252 A
3630(*/)S
4860 V
(26229)210 648 A
1110(if)S
(\(fetch_name\(name,)714 1236 A
(name_length,)504 1992 A
(M3\))126 2538 A
2706(!=)S
(OK\))126 2832 A
(return\(err_code\);)714 3000 A
4950 V
(26230)210 648 A
1110(if)S
1236(\()S
(\(rip)168 1320 A
1530(=)S
(eat_path\(user_path\)\))840 1614 A
2496(==)S
(NIL_INODE\))420 2622 A
(return\(err_code\);)714 3084 A
5040 V
(26231)210 648 A
5130 V
(26232)210 648 A
1110(/*)S
(Now)126 1236 A
(check)210 1404 A
(the)126 1656 A
(permissions.)504 1824 A
2370(*/)S
5220 V
(26233)210 648 A
1110(r)S
1194(=)S
(forbidden\(rip,)588 1278 A
(\(mode_t\))336 1908 A
(mode\);)252 2286 A
5310 V
(26234)210 648 A
(put_inode\(rip\);)630 1110 A
5400 V
(26235)210 648 A
(return\(r\);)420 1110 A
5490 V
(26236)210 648 A
1026(})S
5760 V
(26239)210 648 A
(/*===========================================================================*)3276 1026 A
5850 V
(26240)210 648 A
1068(*)S
(forbidden)378 2370 A
4260(*)S
5940 V
(26241)210 648 A
(*===========================================================================*/)3276 1068 A
6030 V
(26242)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(forbidden\(rip,)588 1488 A
(access_desired\))630 2118 A
6120 V
(26243)210 648 A
(register)336 1026 A
(struct)252 1404 A
(inode)210 1698 A
(*rip;)210 1950 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(inode)210 2958 A
3210(to)S
3336(be)S
(checked)294 3462 A
3798(*/)S
6210 V
(26244)210 648 A
(mode_t)252 1026 A
(access_desired;)630 1320 A
2034(/*)S
(RWX)126 2160 A
(bits)168 2328 A
2538(*/)S
8418 V
EP
%%Page: 363 363
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2092(File:)S
2325(src/fs/protect.c)S
12 B
(363)180 4248 A
900 V
7 LST
(26245)210 648 A
1026({)S
990 V
(26246)210 648 A
1026(/*)S
(Given)210 1152 A
1404(a)S
(pointer)294 1488 A
1824(to)S
1950(an)S
(inode,)252 2076 A
('rip',)252 2370 A
(and)126 2664 A
(the)126 2832 A
(access)252 3000 A
(desired,)336 3294 A
(determine)378 3672 A
1080 V
(26247)210 648 A
1068(*)S
1152(if)S
(the)126 1278 A
(access)252 1446 A
1740(is)S
(allowed,)336 1866 A
(and)126 2244 A
2412(if)S
(not)126 2538 A
(why)126 2706 A
(not.)168 2874 A
(The)126 3126 A
(routine)294 3294 A
(looks)210 3630 A
3882(up)S
(the)126 4008 A
1170 V
(26248)210 648 A
1068(*)S
(caller's)336 1152 A
(uid)126 1530 A
1698(in)S
(the)126 1824 A
('fproc')294 1992 A
(table.)252 2328 A
2664(If)S
(access)252 2790 A
3084(is)S
(allowed,)336 3210 A
3588(OK)S
3714(is)S
(returned)336 3840 A
1260 V
(26249)210 648 A
1068(*)S
1152(if)S
1278(it)S
1404(is)S
(forbidden,)420 1530 A
(EACCES)252 1992 A
2286(is)S
(returned.)378 2412 A
1350 V
(26250)210 648 A
1068(*/)S
1440 V
(26251)210 648 A
1530 V
(26252)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*old_rip)336 2034 A
2412(=)S
(rip;)168 2496 A
1620 V
(26253)210 648 A
(register)336 1110 A
(struct)252 1488 A
(super_block)462 1782 A
(*sp;)168 2286 A
1710 V
(26254)210 648 A
(register)336 1110 A
(mode_t)252 1488 A
(bits,)210 1782 A
(perm_bits;)420 2034 A
1800 V
(26255)210 648 A
(int)126 1110 A
1278(r,)S
(shift,)252 1404 A
(test_uid,)378 1698 A
(test_gid;)378 2118 A
1890 V
(26256)210 648 A
1980 V
(26257)210 648 A
1110(if)S
(\(rip->i_mount)546 1236 A
1824(==)S
(I_MOUNT\))336 1950 A
2370(/*)S
(The)126 2496 A
(inode)210 2664 A
2916(is)S
(mounted)294 3042 A
(on.)126 3378 A
3546(*/)S
2070 V
(26258)210 648 A
(for)126 1362 A
(\(sp)126 1530 A
1698(=)S
(&super_block[1];)672 1782 A
2496(sp)S
2622(<)S
(&super_block[NR_SUPERS];)1008 2706 A
(sp++\))210 3756 A
2160 V
(26259)210 648 A
1698(if)S
(\(sp->s_imount)546 1824 A
2412(==)S
(rip\))168 2538 A
2748({)S
2250 V
(26260)210 648 A
(rip)126 2034 A
2202(=)S
(get_inode\(sp->s_dev,)840 2286 A
(ROOT_INODE\);)504 3168 A
2340 V
(26261)210 648 A
(break;)252 2034 A
2430 V
(26262)210 648 A
1698(})S
1782(/*)S
1908(if)S
2034(*/)S
2520 V
(26263)210 648 A
2610 V
(26264)210 648 A
1110(/*)S
(Isolate)294 1236 A
(the)126 1572 A
(relevant)336 1740 A
(rwx)126 2118 A
(bits)168 2286 A
(from)168 2496 A
(the)126 2706 A
(mode.)210 2874 A
3126(*/)S
2700 V
(26265)210 648 A
(bits)168 1110 A
1320(=)S
(rip->i_mode;)504 1404 A
2790 V
(26266)210 648 A
(test_uid)336 1110 A
1488(=)S
(\(fs_call)336 1572 A
1950(==)S
(ACCESS)252 2076 A
2370(?)S
(fp->fp_realuid)588 2454 A
3084(:)S
(fp->fp_effuid\);)630 3168 A
2880 V
(26267)210 648 A
(test_gid)336 1110 A
1488(=)S
(\(fs_call)336 1572 A
1950(==)S
(ACCESS)252 2076 A
2370(?)S
(fp->fp_realgid)588 2454 A
3084(:)S
(fp->fp_effgid\);)630 3168 A
2970 V
(26268)210 648 A
1110(if)S
(\(test_uid)378 1236 A
1656(==)S
(SU_UID\))294 1782 A
2118({)S
3060 V
(26269)210 648 A
1362(/*)S
(Grant)210 1488 A
(read)168 1740 A
(and)126 1950 A
(write)210 2118 A
(permission.)462 2370 A
(Grant)210 2916 A
(search)252 3168 A
(permission)420 3462 A
(for)126 3924 A
3150 V
(26270)210 648 A
1404(*)S
(directories.)504 1488 A
(Grant)210 2076 A
(execute)294 2328 A
(permission)420 2664 A
(\(for)168 3126 A
(non-directories\))672 3336 A
4050(if)S
3240 V
(26271)210 648 A
1404(*)S
(and)126 1488 A
(only)168 1656 A
1866(if)S
(one)126 1992 A
2160(of)S
(the)126 2286 A
('X')126 2454 A
(bits)168 2622 A
2832(is)S
(set.)168 2958 A
3330 V
(26272)210 648 A
1404(*/)S
3420 V
(26273)210 648 A
1362(if)S
1488(\()S
(\(bits)210 1572 A
1824(&)S
(I_TYPE\))294 1908 A
2244(==)S
(I_DIRECTORY)462 2370 A
2874(||)S
3510 V
(26274)210 648 A
(bits)168 1572 A
1782(&)S
(\(\(X_BIT)294 1866 A
2202(<<)S
2328(6\))S
2454(|)S
(\(X_BIT)252 2538 A
2832(<<)S
2958(3\))S
3084(|)S
(X_BIT\)\))294 3168 A
3600 V
(26275)210 648 A
(perm_bits)378 1698 A
2118(=)S
(R_BIT)210 2202 A
2454(|)S
(W_BIT)210 2538 A
2790(|)S
(X_BIT;)252 2874 A
3690 V
(26276)210 648 A
(else)168 1362 A
3780 V
(26277)210 648 A
(perm_bits)378 1698 A
2118(=)S
(R_BIT)210 2202 A
2454(|)S
(W_BIT;)252 2538 A
3870 V
(26278)210 648 A
1110(})S
(else)168 1194 A
1404({)S
3960 V
(26279)210 648 A
1362(if)S
(\(test_uid)378 1488 A
1908(==)S
(rip->i_uid\))462 2034 A
(shift)210 2538 A
2790(=)S
2874(6;)S
3378(/*)S
(owner)210 3504 A
3756(*/)S
4050 V
(26280)210 648 A
(else)168 1362 A
1572(if)S
(\(test_gid)378 1698 A
2118(==)S
(rip->i_gid)420 2244 A
2706(\))S
(shift)210 2790 A
3042(=)S
3126(3;)S
3378(/*)S
(group)210 3504 A
3756(*/)S
4140 V
(26281)210 648 A
(else)168 1362 A
(shift)210 1572 A
1824(=)S
1908(0;)S
3378(/*)S
(other)210 3504 A
3756(*/)S
4230 V
(26282)210 648 A
(perm_bits)378 1362 A
1782(=)S
(\(bits)210 1866 A
2118(>>)S
(shift\))252 2244 A
2538(&)S
(\(R_BIT)252 2622 A
2916(|)S
(W_BIT)210 3000 A
3252(|)S
(X_BIT\);)294 3336 A
4320 V
(26283)210 648 A
1110(})S
4410 V
(26284)210 648 A
4500 V
(26285)210 648 A
1110(/*)S
1236(If)S
(access)252 1362 A
(desired)294 1656 A
1992(is)S
(not)126 2118 A
2286(a)S
(subset)252 2370 A
2664(of)S
(what)168 2790 A
3000(is)S
(allowed,)336 3126 A
3504(it)S
3630(is)S
(refused.)336 3756 A
4134(*/)S
4590 V
(26286)210 648 A
1110(r)S
1194(=)S
(OK;)126 1278 A
4680 V
(26287)210 648 A
1110(if)S
(\(\(perm_bits)462 1236 A
1740(|)S
(access_desired\))630 1824 A
2496(!=)S
(perm_bits\))420 2622 A
3084(r)S
3168(=)S
(EACCES;)294 3252 A
4770 V
(26288)210 648 A
4860 V
(26289)210 648 A
1110(/*)S
(Check)210 1236 A
1488(to)S
(see)126 1614 A
1782(if)S
(someone)294 1908 A
2244(is)S
(trying)252 2370 A
2664(to)S
(write)210 2790 A
3042(on)S
3168(a)S
(file)168 3252 A
(system)252 3462 A
(that)168 3756 A
3966(is)S
4950 V
(26290)210 648 A
1152(*)S
(mounted)294 1236 A
(read-only.)420 1572 A
5040 V
(26291)210 648 A
1152(*/)S
5130 V
(26292)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
5220 V
(26293)210 648 A
1362(if)S
(\(access_desired)630 1488 A
2160(&)S
(W_BIT\))252 2244 A
2538(r)S
2622(=)S
(read_only\(rip\);)630 2706 A
5310 V
(26294)210 648 A
5400 V
(26295)210 648 A
1110(if)S
(\(rip)168 1236 A
1446(!=)S
(old_rip\))336 1572 A
(put_inode\(rip\);)630 1950 A
5490 V
(26296)210 648 A
5580 V
(26297)210 648 A
(return\(r\);)420 1110 A
5670 V
(26298)210 648 A
1026(})S
5940 V
(26301)210 648 A
(/*===========================================================================*)3276 1026 A
6030 V
(26302)210 648 A
1068(*)S
(read_only)378 2370 A
4260(*)S
6120 V
(26303)210 648 A
(*===========================================================================*/)3276 1068 A
6210 V
(26304)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(read_only\(ip\))546 1488 A
8418 V
EP
%%Page: 364 364
BP
/slant 0 def
/height 0 def
630 V
12 B
(364)180 648 A
11 R
2092(File:)S
2325(src/fs/protect.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(26305)210 648 A
(struct)252 1026 A
(inode)210 1320 A
(*ip;)168 1572 A
2370(/*)S
(ptr)126 2496 A
2664(to)S
(inode)210 2790 A
(whose)210 3042 A
(file)168 3294 A
(sys)126 3504 A
3672(is)S
3798(to)S
3924(be)S
(cked)168 4050 A
4260(*/)S
990 V
(26306)210 648 A
1026({)S
1080 V
(26307)210 648 A
1026(/*)S
(Check)210 1152 A
1404(to)S
(see)126 1530 A
1698(if)S
(the)126 1824 A
(file)168 1992 A
(system)252 2202 A
2496(on)S
(which)210 2622 A
(the)126 2874 A
(inode)210 3042 A
('ip')168 3294 A
(resides)294 3504 A
3840(is)S
(mounted)294 3966 A
1170 V
(26308)210 648 A
1068(*)S
(read)168 1152 A
(only.)210 1362 A
1656(If)S
(so,)126 1782 A
(return)252 1950 A
(EROFS,)252 2244 A
(else)168 2538 A
(return)252 2748 A
(OK.)126 3042 A
1260 V
(26309)210 648 A
1068(*/)S
1350 V
(26310)210 648 A
1440 V
(26311)210 648 A
(register)336 1110 A
(struct)252 1488 A
(super_block)462 1782 A
(*sp;)168 2286 A
1530 V
(26312)210 648 A
1620 V
(26313)210 648 A
1110(sp)S
1236(=)S
(ip->i_sp;)378 1320 A
1710 V
(26314)210 648 A
(return\(sp->s_rd_only)840 1110 A
1992(?)S
(EROFS)210 2076 A
2328(:)S
(OK\);)168 2412 A
1800 V
(26315)210 648 A
1026(})S
2340 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2430 V
(src/fs/time.c)546 2034 A
2520 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2700 V
(26400)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(takes)210 1572 A
(care)168 1824 A
2034(of)S
(those)210 2160 A
(system)252 2412 A
(calls)210 2706 A
(that)168 2958 A
(deal)168 3168 A
(with)168 3378 A
(time.)210 3588 A
2790 V
(26401)210 648 A
1068(*)S
2880 V
(26402)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
2970 V
(26403)210 648 A
1068(*)S
(do_utime:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(UTIME)210 2202 A
(system)252 2454 A
(call)168 2748 A
3060 V
(26404)210 648 A
1068(*)S
(do_time:)336 1236 A
(perform)294 1698 A
(the)126 2034 A
(TIME)168 2202 A
(system)252 2412 A
(call)168 2706 A
3150 V
(26405)210 648 A
1068(*)S
(do_stime:)378 1236 A
(perform)294 1698 A
(the)126 2034 A
(STIME)210 2202 A
(system)252 2454 A
(call)168 2748 A
3240 V
(26406)210 648 A
1068(*)S
(do_tims:)336 1236 A
(perform)294 1698 A
(the)126 2034 A
(TIMES)210 2202 A
(system)252 2454 A
(call)168 2748 A
3330 V
(26407)210 648 A
1068(*/)S
3420 V
(26408)210 648 A
3510 V
(26409)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
3600 V
(26410)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
3690 V
(26411)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
3780 V
(26412)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
3870 V
(26413)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
3960 V
(26414)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
4050 V
(26415)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
4140 V
(26416)210 648 A
4230 V
(26417)210 648 A
(PRIVATE)294 1026 A
(message)294 1362 A
(clock_mess;)462 1698 A
4320 V
(26418)210 648 A
4410 V
(26419)210 648 A
(/*===========================================================================*)3276 1026 A
4500 V
(26420)210 648 A
1068(*)S
(do_utime)336 2370 A
4260(*)S
4590 V
(26421)210 648 A
(*===========================================================================*/)3276 1068 A
4680 V
(26422)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_utime\(\))420 1488 A
4770 V
(26423)210 648 A
1026({)S
4860 V
(26424)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(utime\(name,)462 1656 A
(timep\))252 2160 A
(system)252 2454 A
(call.)210 2748 A
3000(*/)S
4950 V
(26425)210 648 A
5040 V
(26426)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
5130 V
(26427)210 648 A
(register)336 1110 A
(int)126 1488 A
(len,)168 1656 A
1866(r;)S
5220 V
(26428)210 648 A
5310 V
(26429)210 648 A
1110(/*)S
(Adjust)252 1236 A
(for)126 1530 A
(case)168 1698 A
1908(of)S
(NULL)168 2034 A
('timep'.)336 2244 A
2622(*/)S
5400 V
(26430)210 648 A
(len)126 1110 A
1278(=)S
(utime_length;)546 1362 A
5490 V
(26431)210 648 A
1110(if)S
(\(len)168 1236 A
1446(==)S
1572(0\))S
(len)126 1698 A
1866(=)S
(m.m2_i2;)336 1950 A
5580 V
(26432)210 648 A
5670 V
(26433)210 648 A
1110(/*)S
(Temporarily)462 1236 A
(open)168 1740 A
(the)126 1950 A
(file.)210 2118 A
2370(*/)S
5760 V
(26434)210 648 A
1110(if)S
(\(fetch_name\(utime_file,)966 1236 A
(len,)168 2244 A
(M1\))126 2454 A
2622(!=)S
(OK\))126 2748 A
(return\(err_code\);)714 2916 A
5850 V
(26435)210 648 A
1110(if)S
1236(\()S
(\(rip)168 1320 A
1530(=)S
(eat_path\(user_path\)\))840 1614 A
2496(==)S
(NIL_INODE\))420 2622 A
(return\(err_code\);)714 3084 A
5940 V
(26436)210 648 A
6030 V
(26437)210 648 A
1110(/*)S
(Only)168 1236 A
(the)126 1446 A
(owner)210 1614 A
1866(of)S
1992(a)S
(file)168 2076 A
2286(or)S
(the)126 2412 A
(super_user)420 2580 A
(can)126 3042 A
(change)252 3210 A
(its)126 3504 A
(time.)210 3672 A
3924(*/)S
6120 V
(26438)210 648 A
1110(r)S
1194(=)S
(OK;)126 1278 A
6210 V
(26439)210 648 A
1110(if)S
(\(rip->i_uid)462 1236 A
1740(!=)S
(fp->fp_effuid)546 1866 A
2454(&&)S
(!super_user\))504 2580 A
3126(r)S
3210(=)S
(EPERM;)252 3294 A
8418 V
EP
%%Page: 365 365
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2147(File:)S
(src/fs/time.c)548 2380 A
12 B
(365)180 4248 A
900 V
7 LST
(26440)210 648 A
1110(if)S
(\(utime_length)546 1236 A
1824(==)S
1950(0)S
2034(&&)S
2160(r)S
2244(!=)S
(OK\))126 2370 A
2538(r)S
2622(=)S
(forbidden\(rip,)588 2706 A
(W_BIT\);)294 3336 A
990 V
(26441)210 648 A
1110(if)S
(\(read_only\(rip\))630 1236 A
1908(!=)S
(OK\))126 2034 A
2202(r)S
2286(=)S
(EROFS;)252 2370 A
2706(/*)S
(not)126 2832 A
(even)168 3000 A
3210(su)S
(can)126 3336 A
(touch)210 3504 A
3756(if)S
(R/O)126 3882 A
4050(*/)S
1080 V
(26442)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
(OK\))126 1488 A
1656({)S
1170 V
(26443)210 648 A
1362(if)S
(\(utime_length)546 1488 A
2076(==)S
2202(0\))S
2328({)S
1260 V
(26444)210 648 A
(rip->i_atime)504 1698 A
2244(=)S
(clock_time\(\);)546 2328 A
1350 V
(26445)210 648 A
(rip->i_mtime)504 1698 A
2244(=)S
(rip->i_atime;)546 2328 A
1440 V
(26446)210 648 A
1362(})S
(else)168 1446 A
1656({)S
1530 V
(26447)210 648 A
(rip->i_atime)504 1698 A
2244(=)S
(utime_actime;)546 2328 A
1620 V
(26448)210 648 A
(rip->i_mtime)504 1698 A
2244(=)S
(utime_modtime;)588 2328 A
1710 V
(26449)210 648 A
1362(})S
1800 V
(26450)210 648 A
(rip->i_update)546 1362 A
1950(=)S
(CTIME;)252 2034 A
2370(/*)S
(discard)294 2496 A
(any)126 2832 A
(stale)210 3000 A
(ATIME)210 3252 A
(and)126 3504 A
(MTIME)210 3672 A
(flags)210 3924 A
4176(*/)S
1890 V
(26451)210 648 A
(rip->i_dirt)462 1362 A
1866(=)S
(DIRTY;)252 1950 A
1980 V
(26452)210 648 A
1110(})S
2070 V
(26453)210 648 A
2160 V
(26454)210 648 A
(put_inode\(rip\);)630 1110 A
2250 V
(26455)210 648 A
(return\(r\);)420 1110 A
2340 V
(26456)210 648 A
1026(})S
2610 V
(26459)210 648 A
(/*===========================================================================*)3276 1026 A
2700 V
(26460)210 648 A
1068(*)S
(do_time)294 2370 A
4260(*)S
2790 V
(26461)210 648 A
(*===========================================================================*/)3276 1068 A
2880 V
(26462)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_time\(\))378 1488 A
2970 V
(26463)210 648 A
3060 V
(26464)210 648 A
1026({)S
3150 V
(26465)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(time\(tp\))336 1656 A
(system)252 2034 A
(call.)210 2328 A
2580(*/)S
3240 V
(26466)210 648 A
3330 V
(26467)210 648 A
(reply_l1)336 1110 A
1488(=)S
(clock_time\(\);)546 1572 A
2370(/*)S
(return)252 2496 A
(time)168 2790 A
3000(in)S
(seconds)294 3126 A
3462(*/)S
3420 V
(26468)210 648 A
(return\(OK\);)462 1110 A
3510 V
(26469)210 648 A
1026(})S
3780 V
(26472)210 648 A
(/*===========================================================================*)3276 1026 A
3870 V
(26473)210 648 A
1068(*)S
(do_stime)336 2370 A
4260(*)S
3960 V
(26474)210 648 A
(*===========================================================================*/)3276 1068 A
4050 V
(26475)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_stime\(\))420 1488 A
4140 V
(26476)210 648 A
1026({)S
4230 V
(26477)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(stime\(tp\))378 1656 A
(system)252 2076 A
(call.)210 2370 A
2622(*/)S
4320 V
(26478)210 648 A
4410 V
(26479)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(k;)S
4500 V
(26480)210 648 A
4590 V
(26481)210 648 A
1110(if)S
(\(!super_user\))546 1236 A
(return\(EPERM\);)588 1824 A
4680 V
(26482)210 648 A
(clock_mess.m_type)714 1110 A
1866(=)S
(SET_TIME;)378 1950 A
4770 V
(26483)210 648 A
(clock_mess.NEW_TIME)798 1110 A
1950(=)S
(\(long\))252 2034 A
(tp;)126 2328 A
4860 V
(26484)210 648 A
1110(if)S
1236(\()S
1320(\(k)S
1446(=)S
(sendrec\(CLOCK,)588 1530 A
(&clock_mess\)\))546 2160 A
2748(!=)S
(OK\))126 2874 A
(panic\("do_stime)630 3042 A
(error",)294 3714 A
(k\);)126 4050 A
4950 V
(26485)210 648 A
(return\(OK\);)462 1110 A
5040 V
(26486)210 648 A
1026(})S
5310 V
(26489)210 648 A
(/*===========================================================================*)3276 1026 A
5400 V
(26490)210 648 A
1068(*)S
(do_tims)294 2370 A
4260(*)S
5490 V
(26491)210 648 A
(*===========================================================================*/)3276 1068 A
5580 V
(26492)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_tims\(\))378 1488 A
5670 V
(26493)210 648 A
1026({)S
5760 V
(26494)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(times\(buffer\))546 1656 A
(system)252 2244 A
(call.)210 2538 A
2790(*/)S
5850 V
(26495)210 648 A
5940 V
(26496)210 648 A
(clock_t)294 1110 A
(t[5];)210 1446 A
6030 V
(26497)210 648 A
6120 V
(26498)210 648 A
(sys_times\(who,)588 1110 A
(t\);)126 1740 A
6210 V
(26499)210 648 A
(reply_t1)336 1110 A
1488(=)S
(t[0];)210 1572 A
8418 V
EP
%%Page: 366 366
BP
/slant 0 def
/height 0 def
630 V
12 B
(366)180 648 A
11 R
2147(File:)S
(src/fs/time.c)548 2380 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(26500)210 648 A
(reply_t2)336 1110 A
1488(=)S
(t[1];)210 1572 A
990 V
(26501)210 648 A
(reply_t3)336 1110 A
1488(=)S
(t[2];)210 1572 A
1080 V
(26502)210 648 A
(reply_t4)336 1110 A
1488(=)S
(t[3];)210 1572 A
1170 V
(26503)210 648 A
(reply_t5)336 1110 A
1488(=)S
(t[4];)210 1572 A
1260 V
(26504)210 648 A
(return\(OK\);)462 1110 A
1350 V
(26505)210 648 A
1026(})S
1890 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1980 V
(src/fs/misc.c)546 2034 A
2070 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
2250 V
(26600)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
1950(a)S
(collection)420 2034 A
2496(of)S
(miscellaneous)546 2622 A
(procedures.)462 3210 A
(Some)168 3756 A
3966(of)S
(them)168 4092 A
2340 V
(26601)210 648 A
1068(*)S
(perform)294 1152 A
(simple)252 1488 A
(system)252 1782 A
(calls.)252 2076 A
(Some)168 2412 A
(others)252 2622 A
2916(do)S
3042(a)S
(little)252 3126 A
(part)168 3420 A
3630(of)S
(system)252 3756 A
(calls)210 4050 A
2430 V
(26602)210 648 A
1068(*)S
(that)168 1152 A
(are)126 1362 A
(mostly)252 1530 A
(performed)378 1824 A
2244(by)S
(the)126 2370 A
(Memory)252 2538 A
(Manager.)336 2832 A
2520 V
(26603)210 648 A
1068(*)S
2610 V
(26604)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
2700 V
(26605)210 648 A
1068(*)S
(do_dup:)294 1236 A
(perform)294 1782 A
(the)126 2118 A
(DUP)126 2286 A
(system)252 2454 A
(call)168 2748 A
2790 V
(26606)210 648 A
1068(*)S
(do_fcntl:)378 1236 A
(perform)294 1782 A
(the)126 2118 A
(FCNTL)210 2286 A
(system)252 2538 A
(call)168 2832 A
2880 V
(26607)210 648 A
1068(*)S
(do_sync:)336 1236 A
(perform)294 1782 A
(the)126 2118 A
(SYNC)168 2286 A
(system)252 2496 A
(call)168 2790 A
2970 V
(26608)210 648 A
1068(*)S
(do_fork:)336 1236 A
(adjust)252 1782 A
(the)126 2076 A
(tables)252 2244 A
(after)210 2538 A
2790(MM)S
(has)126 2916 A
(performed)378 3084 A
3504(a)S
(FORK)168 3588 A
(system)252 3798 A
(call)168 4092 A
3060 V
(26609)210 648 A
1068(*)S
(do_exec:)336 1236 A
(handle)252 1782 A
(files)210 2076 A
(with)168 2328 A
(FD_CLOEXEC)420 2538 A
3000(on)S
(after)210 3126 A
3378(MM)S
(has)126 3504 A
(done)168 3672 A
3882(an)S
(EXEC)168 4008 A
3150 V
(26610)210 648 A
1068(*)S
(do_exit:)336 1236 A
1782(a)S
(process)294 1866 A
(has)126 2202 A
(exited;)294 2370 A
(note)168 2706 A
(that)168 2916 A
3126(in)S
(the)126 3252 A
(tables)252 3420 A
3240 V
(26611)210 648 A
1068(*)S
(do_set:)294 1236 A
(set)126 1782 A
(uid)126 1950 A
2118(or)S
(gid)126 2244 A
(for)126 2412 A
(some)168 2580 A
(process)294 2790 A
3330 V
(26612)210 648 A
1068(*)S
(do_revive:)420 1236 A
(revive)252 1782 A
2076(a)S
(process)294 2160 A
(that)168 2496 A
(was)126 2706 A
(waiting)294 2874 A
(for)126 3210 A
(something)378 3378 A
(\(e.g.)210 3798 A
(TTY\))168 4050 A
3420 V
(26613)210 648 A
1068(*/)S
3510 V
(26614)210 648 A
3600 V
(26615)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
3690 V
(26616)210 648 A
(#include)336 1026 A
(<fcntl.h>)378 1404 A
3780 V
(26617)210 648 A
(#include)336 1026 A
(<unistd.h>)420 1404 A
2034(/*)S
2160(cc)S
(runs)168 2286 A
(out)126 2496 A
2664(of)S
(memory)252 2790 A
(with)168 3084 A
(unistd.h)336 3294 A
(:-\()126 3672 A
3840(*/)S
3870 V
(26618)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
3960 V
(26619)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
4050 V
(26620)210 648 A
(#include)336 1026 A
(<minix/boot.h>)588 1404 A
4140 V
(26621)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
4230 V
(26622)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
4320 V
(26623)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
4410 V
(26624)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
4500 V
(26625)210 648 A
(#include)336 1026 A
("dev.h")294 1404 A
4590 V
(26626)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
4680 V
(26627)210 648 A
4770 V
(26628)210 648 A
4860 V
(26629)210 648 A
(/*===========================================================================*)3276 1026 A
4950 V
(26630)210 648 A
1068(*)S
(do_dup)252 2370 A
4260(*)S
5040 V
(26631)210 648 A
(*===========================================================================*/)3276 1068 A
5130 V
(26632)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_dup\(\))336 1488 A
5220 V
(26633)210 648 A
1026({)S
5310 V
(26634)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(dup\(fd\))294 1656 A
1992(or)S
(dup2\(fd,fd2\))504 2118 A
(system)252 2664 A
(call.)210 2958 A
(These)210 3210 A
(system)252 3462 A
(calls)210 3756 A
(are)126 4008 A
5400 V
(26635)210 648 A
1068(*)S
(obsolete.)378 1152 A
1614(In)S
(fact,)210 1740 A
1992(it)S
2118(is)S
(not)126 2244 A
(even)168 2412 A
(possible)336 2622 A
3000(to)S
(invoke)252 3126 A
(them)168 3420 A
(using)210 3630 A
(the)126 3882 A
5490 V
(26636)210 648 A
1068(*)S
(current)294 1152 A
(library)294 1488 A
(because)294 1824 A
(the)126 2160 A
(library)294 2328 A
(routines)336 2664 A
(call)168 3042 A
(fcntl\(\).)336 3252 A
(They)168 3672 A
(are)126 3882 A
5580 V
(26637)210 648 A
1068(*)S
(provided)336 1152 A
1530(to)S
(permit)252 1656 A
(old)126 1950 A
(binary)252 2118 A
(programs)336 2412 A
2790(to)S
(continue)336 2916 A
3294(to)S
(run.)168 3420 A
5670 V
(26638)210 648 A
1068(*/)S
5760 V
(26639)210 648 A
5850 V
(26640)210 648 A
(register)336 1110 A
(int)126 1488 A
(rfd;)168 1656 A
5940 V
(26641)210 648 A
(register)336 1110 A
(struct)252 1488 A
(filp)168 1782 A
(*f;)126 1992 A
6030 V
(26642)210 648 A
(struct)252 1110 A
(filp)168 1404 A
(*dummy;)294 1614 A
6120 V
(26643)210 648 A
(int)126 1110 A
1278(r;)S
6210 V
(26644)210 648 A
8418 V
EP
%%Page: 367 367
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2141(File:)S
2374(src/fs/misc.c)S
12 B
(367)180 4248 A
900 V
7 LST
(26645)210 648 A
1110(/*)S
1236(Is)S
(the)126 1362 A
(file)168 1530 A
(descriptor)420 1740 A
(valid?)252 2202 A
2496(*/)S
990 V
(26646)210 648 A
(rfd)126 1110 A
1278(=)S
1362(fd)S
1488(&)S
(\304DUP_MASK;)420 1572 A
2370(/*)S
(kill)168 2496 A
(off)126 2706 A
(dup2)168 2874 A
(bit,)168 3084 A
3294(if)S
3420(on)S
3546(*/)S
1080 V
(26647)210 648 A
1110(if)S
(\(\(f)126 1236 A
1404(=)S
(get_filp\(rfd\)\))588 1488 A
2118(==)S
(NIL_FILP\))378 2244 A
(return\(err_code\);)714 2664 A
1170 V
(26648)210 648 A
1260 V
(26649)210 648 A
1110(/*)S
(Distinguish)462 1236 A
(between)294 1740 A
(dup)126 2076 A
(and)126 2244 A
(dup2.)210 2412 A
2664(*/)S
1350 V
(26650)210 648 A
1110(if)S
(\(fd)126 1236 A
1404(==)S
(rfd\))168 1530 A
1740({)S
2706(/*)S
(bit)126 2832 A
(not)126 3000 A
3168(on)S
3294(*/)S
1440 V
(26651)210 648 A
1362(/*)S
(dup\(fd\))294 1488 A
1824(*/)S
1530 V
(26652)210 648 A
1362(if)S
1488(\()S
1572(\(r)S
1698(=)S
(get_fd\(0,)378 1782 A
2202(0,)S
(&fd2,)210 2328 A
(&dummy\)\))336 2580 A
2958(!=)S
(OK\))126 3084 A
(return\(r\);)420 3252 A
1620 V
(26653)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1710 V
(26654)210 648 A
1362(/*)S
(dup2\(fd,)336 1488 A
(fd2\))168 1866 A
2076(*/)S
1800 V
(26655)210 648 A
1362(if)S
(\(fd2)168 1488 A
1698(<)S
1782(0)S
1866(||)S
(fd2)126 1992 A
2160(>=)S
(OPEN_MAX\))378 2286 A
(return\(EBADF\);)588 2706 A
1890 V
(26656)210 648 A
1362(if)S
(\(rfd)168 1488 A
1698(==)S
(fd2\))168 1824 A
(return\(fd2\);)504 2034 A
2706(/*)S
(ignore)252 2832 A
(the)126 3126 A
(call:)210 3294 A
(dup2\(x,)294 3546 A
3882(x\))S
4008(*/)S
1980 V
(26657)210 648 A
1362(fd)S
1488(=)S
(fd2;)168 1572 A
2370(/*)S
(prepare)294 2496 A
2832(to)S
(close)210 2958 A
(fd2)126 3210 A
3378(*/)S
2070 V
(26658)210 648 A
(\(void\))252 1362 A
(do_close\(\);)462 1656 A
2370(/*)S
(cannot)252 2496 A
(fail)168 2790 A
3000(*/)S
2160 V
(26659)210 648 A
1110(})S
2250 V
(26660)210 648 A
2340 V
(26661)210 648 A
1110(/*)S
(Success.)336 1236 A
(Set)126 1614 A
1782(up)S
(new)126 1908 A
(file)168 2076 A
(descriptors.)504 2286 A
2832(*/)S
2430 V
(26662)210 648 A
(f->filp_count++;)672 1110 A
2520 V
(26663)210 648 A
(fp->fp_filp[fd2])672 1110 A
1824(=)S
1908(f;)S
2610 V
(26664)210 648 A
(return\(fd2\);)504 1110 A
2700 V
(26665)210 648 A
1026(})S
2880 V
(26667)210 648 A
(/*===========================================================================*)3276 1026 A
2970 V
(26668)210 648 A
1068(*)S
(do_fcntl)336 2370 A
4260(*)S
3060 V
(26669)210 648 A
(*===========================================================================*/)3276 1068 A
3150 V
(26670)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_fcntl\(\))420 1488 A
3240 V
(26671)210 648 A
1026({)S
3330 V
(26672)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(fcntl\(fd,)378 1656 A
(request,)336 2076 A
(...\))168 2454 A
(system)252 2664 A
(call.)210 2958 A
3210(*/)S
3420 V
(26673)210 648 A
3510 V
(26674)210 648 A
(register)336 1110 A
(struct)252 1488 A
(filp)168 1782 A
(*f;)126 1992 A
3600 V
(26675)210 648 A
(int)126 1110 A
(new_fd,)294 1278 A
1614(r,)S
(fl;)126 1740 A
3690 V
(26676)210 648 A
(long)168 1110 A
(cloexec_mask;)546 1320 A
2370(/*)S
(bit)126 2496 A
(map)126 2664 A
(for)126 2832 A
(the)126 3000 A
(FD_CLOEXEC)420 3168 A
(flag)168 3630 A
3840(*/)S
3780 V
(26677)210 648 A
(long)168 1110 A
(clo_value;)420 1320 A
2370(/*)S
(FD_CLOEXEC)420 2496 A
(flag)168 2958 A
3168(in)S
(proper)252 3294 A
(position)336 3588 A
3966(*/)S
3870 V
(26678)210 648 A
(struct)252 1110 A
(filp)168 1404 A
(*dummy;)294 1614 A
3960 V
(26679)210 648 A
4050 V
(26680)210 648 A
1110(/*)S
1236(Is)S
(the)126 1362 A
(file)168 1530 A
(descriptor)420 1740 A
(valid?)252 2202 A
2496(*/)S
4140 V
(26681)210 648 A
1110(if)S
(\(\(f)126 1236 A
1404(=)S
(get_filp\(fd\)\))546 1488 A
2076(==)S
(NIL_FILP\))378 2202 A
(return\(err_code\);)714 2622 A
4230 V
(26682)210 648 A
4320 V
(26683)210 648 A
(switch)252 1110 A
(\(request\))378 1404 A
1824({)S
4410 V
(26684)210 648 A
(case)168 1236 A
(F_DUPFD:)336 1446 A
4500 V
(26685)210 648 A
1362(/*)S
(This)168 1488 A
(replaces)336 1698 A
(the)126 2076 A
(old)126 2244 A
(dup\(\))210 2412 A
(system)252 2664 A
(call.)210 2958 A
3210(*/)S
4590 V
(26686)210 648 A
1362(if)S
(\(addr)210 1488 A
1740(<)S
1824(0)S
1908(||)S
(addr)168 2034 A
2244(>=)S
(OPEN_MAX\))378 2370 A
(return\(EINVAL\);)630 2790 A
4680 V
(26687)210 648 A
1362(if)S
(\(\(r)126 1488 A
1656(=)S
(get_fd\(addr,)504 1740 A
2286(0,)S
(&new_fd,)336 2412 A
(&dummy\)\))336 2790 A
3168(!=)S
(OK\))126 3294 A
(return\(r\);)420 3462 A
4770 V
(26688)210 648 A
(f->filp_count++;)672 1362 A
4860 V
(26689)210 648 A
(fp->fp_filp[new_fd])798 1362 A
2202(=)S
2286(f;)S
4950 V
(26690)210 648 A
(return\(new_fd\);)630 1362 A
5040 V
(26691)210 648 A
5130 V
(26692)210 648 A
(case)168 1236 A
(F_GETFD:)336 1446 A
5220 V
(26693)210 648 A
1362(/*)S
(Get)126 1488 A
(close-on-exec)546 1656 A
(flag)168 2244 A
(\(FD_CLOEXEC)462 2454 A
2958(in)S
(POSIX)210 3084 A
(Table)210 3336 A
(6-2\).)210 3588 A
3840(*/)S
5310 V
(26694)210 648 A
(return\()294 1362 A
(\(\(fp->fp_cloexec)672 1698 A
2412(>>)S
(fd\))126 2538 A
2706(&)S
(01\))126 2790 A
2958(?)S
(FD_CLOEXEC)420 3042 A
3504(:)S
(0\);)126 3588 A
5400 V
(26695)210 648 A
5490 V
(26696)210 648 A
(case)168 1236 A
(F_SETFD:)336 1446 A
5580 V
(26697)210 648 A
1362(/*)S
(Set)126 1488 A
(close-on-exec)546 1656 A
(flag)168 2244 A
(\(FD_CLOEXEC)462 2454 A
2958(in)S
(POSIX)210 3084 A
(Table)210 3336 A
(6-2\).)210 3588 A
3840(*/)S
5670 V
(26698)210 648 A
(cloexec_mask)504 1362 A
1908(=)S
1992(1L)S
2118(<<)S
(fd;)126 2244 A
2706(/*)S
(singleton)378 2832 A
(set)126 3252 A
(position)336 3420 A
3798(ok)S
3924(*/)S
5760 V
(26699)210 648 A
(clo_value)378 1362 A
1782(=)S
(\(addr)210 1866 A
2118(&)S
(FD_CLOEXEC)420 2202 A
2664(?)S
(cloexec_mask)504 2748 A
3294(:)S
(0L\);)168 3378 A
5850 V
(26700)210 648 A
(fp->fp_cloexec)588 1362 A
1992(=)S
(\(fp->fp_cloexec)630 2076 A
2748(&)S
(\304cloexec_mask\))588 2832 A
3462(|)S
(clo_value;)420 3546 A
5940 V
(26701)210 648 A
(return\(OK\);)462 1362 A
6030 V
(26702)210 648 A
6120 V
(26703)210 648 A
(case)168 1236 A
(F_GETFL:)336 1446 A
6210 V
(26704)210 648 A
1362(/*)S
(Get)126 1488 A
(file)168 1656 A
(status)252 1866 A
(flags)210 2160 A
(\(O_NONBLOCK)462 2412 A
(and)126 2916 A
(O_APPEND\).)420 3084 A
3546(*/)S
8418 V
EP
%%Page: 368 368
BP
/slant 0 def
/height 0 def
630 V
12 B
(368)180 648 A
11 R
2141(File:)S
2374(src/fs/misc.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(26705)210 648 A
1362(fl)S
1488(=)S
(f->filp_flags)546 1572 A
2160(&)S
(\(O_NONBLOCK)462 2244 A
2748(|)S
(O_APPEND)336 2832 A
3210(|)S
(O_ACCMODE\);)462 3294 A
990 V
(26706)210 648 A
(return\(fl\);)462 1362 A
1080 V
(26707)210 648 A
1170 V
(26708)210 648 A
(case)168 1236 A
(F_SETFL:)336 1446 A
1260 V
(26709)210 648 A
1362(/*)S
(Set)126 1488 A
(file)168 1656 A
(status)252 1866 A
(flags)210 2160 A
(\(O_NONBLOCK)462 2412 A
(and)126 2916 A
(O_APPEND\).)420 3084 A
3546(*/)S
1350 V
(26710)210 648 A
1362(fl)S
1488(=)S
(O_NONBLOCK)420 1572 A
2034(|)S
(O_APPEND;)378 2118 A
1440 V
(26711)210 648 A
(f->filp_flags)546 1362 A
1950(=)S
(\(f->filp_flags)588 2034 A
2664(&)S
(\304fl\))168 2748 A
2958(|)S
(\(addr)210 3042 A
3294(&)S
(fl\);)168 3378 A
1530 V
(26712)210 648 A
(return\(OK\);)462 1362 A
1620 V
(26713)210 648 A
1710 V
(26714)210 648 A
(case)168 1236 A
(F_GETLK:)336 1446 A
1800 V
(26715)210 648 A
(case)168 1236 A
(F_SETLK:)336 1446 A
1890 V
(26716)210 648 A
(case)168 1236 A
(F_SETLKW:)378 1446 A
1980 V
(26717)210 648 A
1362(/*)S
(Set)126 1488 A
1656(or)S
(clear)210 1782 A
2034(a)S
(file)168 2118 A
(lock.)210 2328 A
2580(*/)S
2070 V
(26718)210 648 A
1362(r)S
1446(=)S
(lock_op\(f,)420 1530 A
(request\);)378 1992 A
2160 V
(26719)210 648 A
(return\(r\);)420 1362 A
2250 V
(26720)210 648 A
2340 V
(26721)210 648 A
(default:)336 1236 A
2430 V
(26722)210 648 A
(return\(EINVAL\);)630 1362 A
2520 V
(26723)210 648 A
1110(})S
2610 V
(26724)210 648 A
1026(})S
2880 V
(26727)210 648 A
(/*===========================================================================*)3276 1026 A
2970 V
(26728)210 648 A
1068(*)S
(do_sync)294 2370 A
4260(*)S
3060 V
(26729)210 648 A
(*===========================================================================*/)3276 1068 A
3150 V
(26730)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_sync\(\))378 1488 A
3240 V
(26731)210 648 A
1026({)S
3330 V
(26732)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(sync\(\))252 1656 A
(system)252 1950 A
(call.)210 2244 A
(Flush)210 2538 A
(all)126 2790 A
(the)126 2958 A
(tables.)294 3126 A
3462(*/)S
3420 V
(26733)210 648 A
3510 V
(26734)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
3600 V
(26735)210 648 A
(register)336 1110 A
(struct)252 1488 A
(buf)126 1782 A
(*bp;)168 1950 A
3690 V
(26736)210 648 A
3780 V
(26737)210 648 A
1110(/*)S
(The)126 1236 A
(order)210 1404 A
1656(in)S
(which)210 1782 A
(the)126 2034 A
(various)294 2202 A
(tables)252 2538 A
(are)126 2832 A
(flushed)294 3000 A
3336(is)S
(critical.)378 3462 A
(The)126 3924 A
3870 V
(26738)210 648 A
1152(*)S
(blocks)252 1236 A
(must)168 1530 A
1740(be)S
(flushed)294 1866 A
(last,)210 2202 A
(since)210 2454 A
(rw_inode\(\))420 2706 A
(leaves)252 3168 A
(its)126 3462 A
(results)294 3630 A
3966(in)S
3960 V
(26739)210 648 A
1152(*)S
(the)126 1236 A
(block)210 1404 A
(cache.)252 1656 A
4050 V
(26740)210 648 A
1152(*/)S
4140 V
(26741)210 648 A
4230 V
(26742)210 648 A
1110(/*)S
(Write)210 1236 A
(all)126 1488 A
(the)126 1656 A
(dirty)210 1824 A
(inodes)252 2076 A
2370(to)S
(the)126 2496 A
(disk.)210 2664 A
2916(*/)S
4320 V
(26743)210 648 A
(for)126 1110 A
(\(rip)168 1278 A
1488(=)S
(&inode[0];)420 1572 A
(rip)126 2034 A
2202(<)S
(&inode[NR_INODES];)756 2286 A
(rip++\))252 3084 A
4410 V
(26744)210 648 A
1362(if)S
(\(rip->i_count)546 1488 A
2076(>)S
2160(0)S
2244(&&)S
(rip->i_dirt)462 2370 A
2874(==)S
(DIRTY\))252 3000 A
(rw_inode\(rip,)546 3294 A
(WRITING\);)378 3882 A
4500 V
(26745)210 648 A
4590 V
(26746)210 648 A
1110(/*)S
(Write)210 1236 A
(all)126 1488 A
(the)126 1656 A
(dirty)210 1824 A
(blocks)252 2076 A
2370(to)S
(the)126 2496 A
(disk,)210 2664 A
(one)126 2916 A
(drive)210 3084 A
3336(at)S
3462(a)S
(time.)210 3546 A
3798(*/)S
4680 V
(26747)210 648 A
(for)126 1110 A
(\(bp)126 1278 A
1446(=)S
(&buf[0];)336 1530 A
1908(bp)S
2034(<)S
(&buf[NR_BUFS];)588 2118 A
(bp++\))210 2748 A
4770 V
(26748)210 648 A
1362(if)S
(\(bp->b_dev)420 1488 A
1950(!=)S
(NO_DEV)252 2076 A
2370(&&)S
(bp->b_dirt)420 2496 A
2958(==)S
(DIRTY\))252 3084 A
(flushall\(bp->b_dev\);)840 3378 A
4860 V
(26749)210 648 A
4950 V
(26750)210 648 A
(return\(OK\);)462 1110 A
2034(/*)S
(sync\(\))252 2160 A
(can't)210 2454 A
(fail)168 2706 A
2916(*/)S
5040 V
(26751)210 648 A
1026(})S
5310 V
(26754)210 648 A
(/*===========================================================================*)3276 1026 A
5400 V
(26755)210 648 A
1068(*)S
(do_fork)294 2370 A
4260(*)S
5490 V
(26756)210 648 A
(*===========================================================================*/)3276 1068 A
5580 V
(26757)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_fork\(\))378 1488 A
5670 V
(26758)210 648 A
1026({)S
5760 V
(26759)210 648 A
1026(/*)S
(Perform)294 1152 A
(those)210 1488 A
(aspects)294 1740 A
2076(of)S
(the)126 2202 A
(fork\(\))252 2370 A
(system)252 2664 A
(call)168 2958 A
(that)168 3168 A
(relate)252 3378 A
3672(to)S
(files.)252 3798 A
5850 V
(26760)210 648 A
1068(*)S
1152(In)S
(particular,)462 1278 A
(let)126 1782 A
(the)126 1950 A
(child)210 2118 A
(inherit)294 2370 A
(its)126 2706 A
(parent's)336 2874 A
(file)168 3252 A
(descriptors.)504 3462 A
5940 V
(26761)210 648 A
1068(*)S
(The)126 1152 A
(parent)252 1320 A
(and)126 1614 A
(child)210 1782 A
(parameters)420 2034 A
(tell)168 2496 A
(who)126 2706 A
(forked)252 2874 A
(off)126 3168 A
(whom.)210 3336 A
(The)126 3588 A
(file)168 3756 A
6030 V
(26762)210 648 A
1068(*)S
(system)252 1152 A
(uses)168 1446 A
(the)126 1656 A
(same)168 1824 A
(slot)168 2034 A
(numbers)294 2244 A
2580(as)S
(the)126 2706 A
(kernel.)294 2874 A
(Only)168 3252 A
3462(MM)S
(makes)210 3588 A
(this)168 3840 A
(call.)210 4050 A
6120 V
(26763)210 648 A
1068(*/)S
6210 V
(26764)210 648 A
8418 V
EP
%%Page: 369 369
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2141(File:)S
2374(src/fs/misc.c)S
12 B
(369)180 4248 A
900 V
7 LST
(26765)210 648 A
(register)336 1110 A
(struct)252 1488 A
(fproc)210 1782 A
(*cp;)168 2034 A
990 V
(26766)210 648 A
(int)126 1110 A
1278(i;)S
1080 V
(26767)210 648 A
1170 V
(26768)210 648 A
1110(/*)S
(Only)168 1236 A
1446(MM)S
(may)126 1572 A
(make)168 1740 A
(this)168 1950 A
(call)168 2160 A
(directly.)378 2370 A
2790(*/)S
1260 V
(26769)210 648 A
1110(if)S
(\(who)168 1236 A
1446(!=)S
(MM_PROC_NR\))462 1572 A
(return\(EGENERIC\);)714 2076 A
1350 V
(26770)210 648 A
1440 V
(26771)210 648 A
1110(/*)S
(Copy)168 1236 A
(the)126 1446 A
(parent's)336 1614 A
(fproc)210 1992 A
(struct)252 2244 A
2538(to)S
(the)126 2664 A
(child.)252 2832 A
3126(*/)S
1530 V
(26772)210 648 A
(fproc[child])504 1110 A
1656(=)S
(fproc[parent];)588 1740 A
1620 V
(26773)210 648 A
1710 V
(26774)210 648 A
1110(/*)S
(Increase)336 1236 A
(the)126 1614 A
(counters)336 1782 A
2160(in)S
(the)126 2286 A
('filp')252 2454 A
(table.)252 2748 A
3042(*/)S
1800 V
(26775)210 648 A
1110(cp)S
1236(=)S
(&fproc[child];)588 1320 A
1890 V
(26776)210 648 A
(for)126 1110 A
1278(\(i)S
1404(=)S
1488(0;)S
1614(i)S
1698(<)S
(OPEN_MAX;)378 1782 A
(i++\))168 2202 A
1980 V
(26777)210 648 A
1362(if)S
(\(cp->fp_filp[i])630 1488 A
2160(!=)S
(NIL_FILP\))378 2286 A
(cp->fp_filp[i]->filp_count++;)1218 2706 A
2070 V
(26778)210 648 A
2160 V
(26779)210 648 A
1110(/*)S
(Fill)168 1236 A
1446(in)S
(new)126 1572 A
(process)294 1740 A
(id.)126 2076 A
2244(*/)S
2250 V
(26780)210 648 A
(cp->fp_pid)420 1110 A
1572(=)S
(pid;)168 1656 A
2340 V
(26781)210 648 A
2430 V
(26782)210 648 A
1110(/*)S
1236(A)S
(child)210 1320 A
1572(is)S
(not)126 1698 A
1866(a)S
(process)294 1950 A
(leader.)294 2286 A
2622(*/)S
2520 V
(26783)210 648 A
(cp->fp_sesldr)546 1110 A
1698(=)S
1782(0;)S
2610 V
(26784)210 648 A
2700 V
(26785)210 648 A
1110(/*)S
(Record)252 1236 A
(the)126 1530 A
(fact)168 1698 A
(that)168 1908 A
(both)168 2118 A
(root)168 2328 A
(and)126 2538 A
(working)294 2706 A
(dir)126 3042 A
(have)168 3210 A
(another)294 3420 A
(user.)210 3756 A
4008(*/)S
2790 V
(26786)210 648 A
(dup_inode\(cp->fp_rootdir\);)1092 1110 A
2880 V
(26787)210 648 A
(dup_inode\(cp->fp_workdir\);)1092 1110 A
2970 V
(26788)210 648 A
(return\(OK\);)462 1110 A
3060 V
(26789)210 648 A
1026(})S
3330 V
(26792)210 648 A
(/*===========================================================================*)3276 1026 A
3420 V
(26793)210 648 A
1068(*)S
(do_exec)294 2370 A
4260(*)S
3510 V
(26794)210 648 A
(*===========================================================================*/)3276 1068 A
3600 V
(26795)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_exec\(\))378 1488 A
3690 V
(26796)210 648 A
1026({)S
3780 V
(26797)210 648 A
1026(/*)S
(Files)210 1152 A
(can)126 1404 A
1572(be)S
(marked)252 1698 A
(with)168 1992 A
(the)126 2202 A
(FD_CLOEXEC)420 2370 A
(bit)126 2832 A
(\(in)126 3000 A
(fp->fp_cloexec\).)672 3168 A
(When)168 3924 A
3870 V
(26798)210 648 A
1068(*)S
1152(MM)S
(does)168 1278 A
1488(an)S
(EXEC,)210 1614 A
1866(it)S
(calls)210 1992 A
2244(FS)S
2370(to)S
(allow)210 2496 A
2748(FS)S
2874(to)S
(find)168 3000 A
(these)210 3210 A
(files)210 3462 A
(and)126 3714 A
(close)210 3882 A
(them.)210 4134 A
3960 V
(26799)210 648 A
1068(*/)S
4050 V
(26800)210 648 A
4140 V
(26801)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(i;)S
4230 V
(26802)210 648 A
(long)168 1110 A
(bitmap;)294 1320 A
4320 V
(26803)210 648 A
4410 V
(26804)210 648 A
1110(/*)S
(Only)168 1236 A
1446(MM)S
(may)126 1572 A
(make)168 1740 A
(this)168 1950 A
(call)168 2160 A
(directly.)378 2370 A
2790(*/)S
4500 V
(26805)210 648 A
1110(if)S
(\(who)168 1236 A
1446(!=)S
(MM_PROC_NR\))462 1572 A
(return\(EGENERIC\);)714 2076 A
4590 V
(26806)210 648 A
4680 V
(26807)210 648 A
1110(/*)S
(The)126 1236 A
(array)210 1404 A
1656(of)S
(FD_CLOEXEC)420 1782 A
(bits)168 2244 A
2454(is)S
2580(in)S
(the)126 2706 A
(fp_cloexec)420 2874 A
(bit)126 3336 A
(map.)168 3504 A
3714(*/)S
4770 V
(26808)210 648 A
1110(fp)S
1236(=)S
(&fproc[slot1];)588 1320 A
2370(/*)S
(get_filp\(\))420 2496 A
(needs)210 2958 A
('fp')168 3210 A
3420(*/)S
4860 V
(26809)210 648 A
(bitmap)252 1110 A
1404(=)S
(fp->fp_cloexec;)630 1488 A
4950 V
(26810)210 648 A
1110(if)S
(\(bitmap)294 1236 A
1572(==)S
1698(0\))S
(return\(OK\);)462 1824 A
2370(/*)S
(normal)252 2496 A
(case,)210 2790 A
3042(no)S
(FD_CLOEXECs)462 3168 A
3672(*/)S
5040 V
(26811)210 648 A
5130 V
(26812)210 648 A
1110(/*)S
(Check)210 1236 A
(the)126 1488 A
(file)168 1656 A
(desriptors)420 1866 A
(one)126 2328 A
2496(by)S
(one)126 2622 A
(for)126 2790 A
(presence)336 2958 A
3336(of)S
(FD_CLOEXEC.)462 3462 A
3966(*/)S
5220 V
(26813)210 648 A
(for)126 1110 A
1278(\(i)S
1404(=)S
1488(0;)S
1614(i)S
1698(<)S
(OPEN_MAX;)378 1782 A
(i++\))168 2202 A
2412({)S
5310 V
(26814)210 648 A
1362(fd)S
1488(=)S
1572(i;)S
5400 V
(26815)210 648 A
1362(if)S
1488(\()S
(\(bitmap)294 1572 A
1908(>>)S
2034(i\))S
2160(&)S
(01\))126 2244 A
(\(void\))252 2412 A
(do_close\(\);)462 2706 A
5490 V
(26816)210 648 A
1110(})S
5580 V
(26817)210 648 A
5670 V
(26818)210 648 A
(return\(OK\);)462 1110 A
5760 V
(26819)210 648 A
1026(})S
6030 V
(26822)210 648 A
(/*===========================================================================*)3276 1026 A
6120 V
(26823)210 648 A
1068(*)S
(do_exit)294 2370 A
4260(*)S
6210 V
(26824)210 648 A
(*===========================================================================*/)3276 1068 A
8418 V
EP
%%Page: 370 370
BP
/slant 0 def
/height 0 def
630 V
12 B
(370)180 648 A
11 R
2141(File:)S
2374(src/fs/misc.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(26825)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_exit\(\))378 1488 A
990 V
(26826)210 648 A
1026({)S
1080 V
(26827)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(file)168 1656 A
(system)252 1866 A
(portion)294 2160 A
2496(of)S
(the)126 2622 A
(exit\(status\))504 2790 A
(system)252 3336 A
(call.)210 3630 A
3882(*/)S
1170 V
(26828)210 648 A
1260 V
(26829)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(i,)S
(exitee,)294 1782 A
(task;)210 2118 A
1350 V
(26830)210 648 A
(register)336 1110 A
(struct)252 1488 A
(fproc)210 1782 A
(*rfp;)210 2034 A
1440 V
(26831)210 648 A
(register)336 1110 A
(struct)252 1488 A
(filp)168 1782 A
(*rfilp;)294 1992 A
1530 V
(26832)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
1620 V
(26833)210 648 A
(int)126 1110 A
(major;)252 1278 A
1710 V
(26834)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
1800 V
(26835)210 648 A
(message)294 1110 A
(dev_mess;)378 1446 A
1890 V
(26836)210 648 A
1980 V
(26837)210 648 A
1110(/*)S
(Only)168 1236 A
1446(MM)S
(may)126 1572 A
1740(do)S
(the)126 1866 A
(EXIT)168 2034 A
(call)168 2244 A
(directly.)378 2454 A
2874(*/)S
2070 V
(26838)210 648 A
1110(if)S
(\(who)168 1236 A
1446(!=)S
(MM_PROC_NR\))462 1572 A
(return\(EGENERIC\);)714 2076 A
2160 V
(26839)210 648 A
2250 V
(26840)210 648 A
1110(/*)S
(Nevertheless,)546 1236 A
(pretend)294 1824 A
(that)168 2160 A
(the)126 2370 A
(call)168 2538 A
(came)168 2748 A
(from)168 2958 A
(the)126 3168 A
(user.)210 3336 A
3588(*/)S
2340 V
(26841)210 648 A
1110(fp)S
1236(=)S
(&fproc[slot1];)588 1320 A
2370(/*)S
(get_filp\(\))420 2496 A
(needs)210 2958 A
('fp')168 3210 A
3420(*/)S
2430 V
(26842)210 648 A
(exitee)252 1110 A
1404(=)S
(slot1;)252 1488 A
2520 V
(26843)210 648 A
2610 V
(26844)210 648 A
1110(if)S
(\(fp->fp_suspended)714 1236 A
1992(==)S
(SUSPENDED\))420 2118 A
2580({)S
2700 V
(26845)210 648 A
(task)168 1362 A
1572(=)S
(-fp->fp_task;)546 1656 A
2790 V
(26846)210 648 A
1362(if)S
(\(task)210 1488 A
1740(==)S
(XPIPE)210 1866 A
2118(||)S
(task)168 2244 A
2454(==)S
(XPOPEN\))294 2580 A
(susp_count--;)546 2916 A
2880 V
(26847)210 648 A
(pro)126 1362 A
1530(=)S
(exitee;)294 1614 A
2970 V
(26848)210 648 A
(\(void\))252 1362 A
(do_unpause\(\);)546 1656 A
2370(/*)S
(this)168 2496 A
(always)252 2706 A
(succeeds)336 3000 A
(for)126 3378 A
3546(MM)S
3672(*/)S
3060 V
(26849)210 648 A
(fp->fp_suspended)672 1362 A
2076(=)S
(NOT_SUSPENDED;)588 2160 A
3150 V
(26850)210 648 A
1110(})S
3240 V
(26851)210 648 A
3330 V
(26852)210 648 A
1110(/*)S
(Loop)168 1236 A
1446(on)S
(file)168 1572 A
(descriptors,)504 1782 A
(closing)294 2328 A
(any)126 2664 A
(that)168 2832 A
(are)126 3042 A
(open.)210 3210 A
3462(*/)S
3420 V
(26853)210 648 A
(for)126 1110 A
1278(\(i)S
1404(=)S
1488(0;)S
1614(i)S
1698(<)S
(OPEN_MAX;)378 1782 A
(i++\))168 2202 A
2412({)S
3510 V
(26854)210 648 A
1362(fd)S
1488(=)S
1572(i;)S
3600 V
(26855)210 648 A
(\(void\))252 1362 A
(do_close\(\);)462 1656 A
3690 V
(26856)210 648 A
1110(})S
3780 V
(26857)210 648 A
3870 V
(26858)210 648 A
1110(/*)S
(Release)294 1236 A
(root)168 1572 A
(and)126 1782 A
(working)294 1950 A
(directories.)504 2286 A
2832(*/)S
3960 V
(26859)210 648 A
(put_inode\(fp->fp_rootdir\);)1092 1110 A
4050 V
(26860)210 648 A
(put_inode\(fp->fp_workdir\);)1092 1110 A
4140 V
(26861)210 648 A
(fp->fp_rootdir)588 1110 A
1740(=)S
(NIL_INODE;)420 1824 A
4230 V
(26862)210 648 A
(fp->fp_workdir)588 1110 A
1740(=)S
(NIL_INODE;)420 1824 A
4320 V
(26863)210 648 A
4410 V
(26864)210 648 A
1110(/*)S
1236(If)S
1362(a)S
(session)294 1446 A
(leader)252 1782 A
(exits)210 2076 A
(then)168 2328 A
(revoke)252 2538 A
(access)252 2832 A
3126(to)S
(its)126 3252 A
(controlling)462 3420 A
(tty)126 3924 A
(from)168 4092 A
4500 V
(26865)210 648 A
1152(*)S
(all)126 1236 A
(other)210 1404 A
(processes)378 1656 A
(using)210 2076 A
(it.)126 2328 A
4590 V
(26866)210 648 A
1152(*/)S
4680 V
(26867)210 648 A
1110(if)S
(\(!fp->fp_sesldr\))672 1236 A
(return\(OK\);)462 1950 A
3042(/*)S
(not)126 3168 A
3336(a)S
(session)294 3420 A
(leader)252 3756 A
4050(*/)S
4770 V
(26868)210 648 A
(fp->fp_sesldr)546 1110 A
1698(=)S
(FALSE;)252 1782 A
4860 V
(26869)210 648 A
1110(if)S
(\(fp->fp_tty)462 1236 A
1740(==)S
1866(0\))S
(return\(OK\);)462 1992 A
3042(/*)S
3168(no)S
(controlling)462 3294 A
(tty)126 3798 A
3966(*/)S
4950 V
(26870)210 648 A
(dev)126 1110 A
1278(=)S
(fp->fp_tty;)462 1362 A
5040 V
(26871)210 648 A
5130 V
(26872)210 648 A
(for)126 1110 A
(\(rfp)168 1278 A
1488(=)S
(&fproc[LOW_USER];)714 1572 A
(rfp)126 2328 A
2496(<)S
(&fproc[NR_PROCS];)714 2580 A
(rfp++\))252 3336 A
3630({)S
5220 V
(26873)210 648 A
1362(if)S
(\(rfp->fp_tty)504 1488 A
2034(==)S
(dev\))168 2160 A
(rfp->fp_tty)462 2370 A
2874(=)S
2958(0;)S
5310 V
(26874)210 648 A
5400 V
(26875)210 648 A
(for)126 1362 A
1530(\(i)S
1656(=)S
1740(0;)S
1866(i)S
1950(<)S
(OPEN_MAX;)378 2034 A
(i++\))168 2454 A
2664({)S
5490 V
(26876)210 648 A
1698(if)S
(\(\(rfilp)294 1824 A
2160(=)S
(rfp->fp_filp[i]\))672 2244 A
2958(==)S
(NIL_FILP\))378 3084 A
(continue;)378 3504 A
5580 V
(26877)210 648 A
1698(if)S
(\(rfilp->filp_mode)714 1824 A
2580(==)S
(FILP_CLOSED\))504 2706 A
(continue;)378 3252 A
5670 V
(26878)210 648 A
(rip)126 1698 A
1866(=)S
(rfilp->filp_ino;)672 1950 A
5760 V
(26879)210 648 A
1698(if)S
(\(\(rip->i_mode)546 1824 A
2412(&)S
(I_TYPE\))294 2496 A
2832(!=)S
(I_CHAR_SPECIAL\))630 2958 A
(continue;)378 3630 A
5850 V
(26880)210 648 A
1698(if)S
(\(\(dev_t\))336 1824 A
(rip->i_zone[0])588 2202 A
2832(!=)S
(dev\))168 2958 A
(continue;)378 3168 A
5940 V
(26881)210 648 A
(dev_mess.m_type)630 1698 A
2370(=)S
(DEV_CLOSE;)420 2454 A
6030 V
(26882)210 648 A
(dev_mess.DEVICE)630 1698 A
2370(=)S
(dev;)168 2454 A
6120 V
(26883)210 648 A
(major)210 1698 A
1950(=)S
(\(dev)168 2034 A
2244(>>)S
(MAJOR\))252 2370 A
2664(&)S
(BYTE;)210 2748 A
3042(/*)S
(major)210 3168 A
(device)252 3420 A
3714(nr)S
3840(*/)S
6210 V
(26884)210 648 A
(task)168 1698 A
1908(=)S
(dmap[major].dmap_task;)924 1992 A
3042(/*)S
(device)252 3168 A
(task)168 3462 A
3672(nr)S
3798(*/)S
8418 V
EP
%%Page: 371 371
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2141(File:)S
2374(src/fs/misc.c)S
12 B
(371)180 4248 A
900 V
7 LST
(26885)210 648 A
(\(*dmap[major].dmap_close\)\(task,)1302 1698 A
(&dev_mess\);)462 3042 A
990 V
(26886)210 648 A
(rfilp->filp_mode)672 1698 A
2412(=)S
(FILP_CLOSED;)504 2496 A
1080 V
(26887)210 648 A
1362(})S
1170 V
(26888)210 648 A
1110(})S
1260 V
(26889)210 648 A
(return\(OK\);)462 1110 A
1350 V
(26890)210 648 A
1026(})S
1620 V
(26893)210 648 A
(/*===========================================================================*)3276 1026 A
1710 V
(26894)210 648 A
1068(*)S
(do_set)252 2370 A
4260(*)S
1800 V
(26895)210 648 A
(*===========================================================================*/)3276 1068 A
1890 V
(26896)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_set\(\))336 1488 A
1980 V
(26897)210 648 A
1026({)S
2070 V
(26898)210 648 A
1026(/*)S
(Set)126 1152 A
(uid_t)210 1320 A
1572(or)S
(gid_t)210 1698 A
(field.)252 1950 A
2244(*/)S
2160 V
(26899)210 648 A
2250 V
(26900)210 648 A
(register)336 1110 A
(struct)252 1488 A
(fproc)210 1782 A
(*tfp;)210 2034 A
2340 V
(26901)210 648 A
2430 V
(26902)210 648 A
1110(/*)S
(Only)168 1236 A
1446(MM)S
(may)126 1572 A
(make)168 1740 A
(this)168 1950 A
(call)168 2160 A
(directly.)378 2370 A
2790(*/)S
2520 V
(26903)210 648 A
1110(if)S
(\(who)168 1236 A
1446(!=)S
(MM_PROC_NR\))462 1572 A
(return\(EGENERIC\);)714 2076 A
2610 V
(26904)210 648 A
2700 V
(26905)210 648 A
(tfp)126 1110 A
1278(=)S
(&fproc[slot1];)588 1362 A
2790 V
(26906)210 648 A
1110(if)S
(\(fs_call)336 1236 A
1614(==)S
(SETUID\))294 1740 A
2076({)S
2880 V
(26907)210 648 A
(tfp->fp_realuid)630 1362 A
2034(=)S
(\(uid_t\))294 2118 A
(real_user_id;)546 2454 A
2970 V
(26908)210 648 A
(tfp->fp_effuid)588 1362 A
1992(=)S
(\(uid_t\))294 2118 A
(eff_user_id;)504 2454 A
3060 V
(26909)210 648 A
1110(})S
3150 V
(26910)210 648 A
1110(if)S
(\(fs_call)336 1236 A
1614(==)S
(SETGID\))294 1740 A
2076({)S
3240 V
(26911)210 648 A
(tfp->fp_effgid)588 1362 A
1992(=)S
(\(gid_t\))294 2118 A
(eff_grp_id;)462 2454 A
3330 V
(26912)210 648 A
(tfp->fp_realgid)630 1362 A
2034(=)S
(\(gid_t\))294 2118 A
(real_grp_id;)504 2454 A
3420 V
(26913)210 648 A
1110(})S
3510 V
(26914)210 648 A
(return\(OK\);)462 1110 A
3600 V
(26915)210 648 A
1026(})S
3870 V
(26918)210 648 A
(/*===========================================================================*)3276 1026 A
3960 V
(26919)210 648 A
1068(*)S
(do_revive)378 2370 A
4260(*)S
4050 V
(26920)210 648 A
(*===========================================================================*/)3276 1068 A
4140 V
(26921)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_revive\(\))462 1488 A
4230 V
(26922)210 648 A
1026({)S
4320 V
(26923)210 648 A
1026(/*)S
1152(A)S
(task,)210 1236 A
(typically)378 1488 A
(TTY,)168 1908 A
(has)126 2118 A
(now)126 2286 A
(gotten)252 2454 A
(the)126 2748 A
(characters)420 2916 A
(that)168 3378 A
(were)168 3588 A
(needed)252 3798 A
(for)126 4092 A
4260(a)S
4410 V
(26924)210 648 A
1068(*)S
(previous)336 1152 A
(read.)210 1530 A
(The)126 1824 A
(process)294 1992 A
(did)126 2328 A
(not)126 2496 A
(get)126 2664 A
2832(a)S
(reply)210 2916 A
(when)168 3168 A
3378(it)S
(made)168 3504 A
(the)126 3714 A
(call.)210 3882 A
4500 V
(26925)210 648 A
1068(*)S
(Instead)294 1152 A
1488(it)S
(was)126 1614 A
(suspended.)420 1782 A
(Now)126 2286 A
2454(we)S
(can)126 2580 A
(send)168 2748 A
(the)126 2958 A
(reply)210 3126 A
3378(to)S
(wake)168 3504 A
3714(it)S
(up.)126 3840 A
(This)168 4050 A
4590 V
(26926)210 648 A
1068(*)S
(business)336 1152 A
(has)126 1530 A
1698(to)S
1824(be)S
(done)168 1950 A
(carefully,)420 2160 A
(since)210 2622 A
(the)126 2874 A
(incoming)336 3042 A
(message)294 3420 A
3756(is)S
(from)168 3882 A
4680 V
(26927)210 648 A
1068(*)S
1152(a)S
(task)168 1236 A
(\(to)126 1446 A
(which)210 1614 A
1866(no)S
(reply)210 1992 A
(can)126 2244 A
2412(be)S
(sent\),)252 2538 A
(and)126 2832 A
(the)126 3000 A
(reply)210 3168 A
(must)168 3420 A
3630(go)S
3756(to)S
3882(a)S
(process)294 3966 A
4770 V
(26928)210 648 A
1068(*)S
(that)168 1152 A
(blocked)294 1362 A
(earlier.)336 1698 A
(The)126 2118 A
(reply)210 2286 A
2538(to)S
(the)126 2664 A
(caller)252 2832 A
3126(is)S
(inhibited)378 3252 A
3672(by)S
(setting)294 3798 A
(the)126 4134 A
4860 V
(26929)210 648 A
1068(*)S
('dont_reply')504 1152 A
(flag,)210 1698 A
(and)126 1950 A
(the)126 2118 A
(reply)210 2286 A
2538(to)S
(the)126 2664 A
(blocked)294 2832 A
(process)294 3168 A
3504(is)S
(done)168 3630 A
(explicitly)420 3840 A
4950 V
(26930)210 648 A
1068(*)S
1152(in)S
(revive\(\).)378 1278 A
5040 V
(26931)210 648 A
1068(*/)S
5130 V
(26932)210 648 A
5220 V
(26933)210 648 A
(#if)126 1026 A
(!ALLOW_USER_SEND)672 1194 A
5310 V
(26934)210 648 A
1110(if)S
(\(who)168 1236 A
1446(>=)S
(LOW_USER\))378 1572 A
(return\(EPERM\);)588 1992 A
5400 V
(26935)210 648 A
(#endif)252 1026 A
5490 V
(26936)210 648 A
5580 V
(26937)210 648 A
(revive\(m.REP_PROC_NR,)882 1110 A
(m.REP_STATUS\);)588 2034 A
5670 V
(26938)210 648 A
(dont_reply)420 1110 A
1572(=)S
(TRUE;)210 1656 A
2370(/*)S
(don't)210 2496 A
(reply)210 2748 A
3000(to)S
(the)126 3126 A
(TTY)126 3294 A
(task)168 3462 A
3672(*/)S
5760 V
(26939)210 648 A
(return\(OK\);)462 1110 A
5850 V
(26940)210 648 A
1026(})S
8418 V
EP
%%Page: 372 372
BP
/slant 0 def
/height 0 def
630 V
12 B
(372)180 648 A
11 R
2101(File:)S
2334(src/fs/device.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/fs/device.c)630 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(27000)210 648 A
1026(/*)S
(When)168 1152 A
1362(a)S
(needed)252 1446 A
(block)210 1740 A
1992(is)S
(not)126 2118 A
2286(in)S
(the)126 2412 A
(cache,)252 2580 A
2874(it)S
(must)168 3000 A
3210(be)S
(fetched)294 3336 A
(from)168 3672 A
(the)126 3882 A
(disk.)210 4050 A
1440 V
(27001)210 648 A
1068(*)S
(Special)294 1152 A
(character)378 1488 A
(files)210 1908 A
(also)168 2160 A
(require)294 2370 A
(I/O.)168 2706 A
(The)126 2958 A
(routines)336 3126 A
(for)126 3504 A
(these)210 3672 A
(are)126 3924 A
(here.)210 4092 A
1530 V
(27002)210 648 A
1068(*)S
1620 V
(27003)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
1866(in)S
(this)168 1992 A
(file)168 2202 A
(are:)168 2412 A
1710 V
(27004)210 648 A
1068(*)S
(dev_io:)294 1236 A
(perform)294 1740 A
2076(a)S
(read)168 2160 A
2370(or)S
(write)210 2496 A
2748(on)S
2874(a)S
(block)210 2958 A
3210(or)S
(character)378 3336 A
(device)252 3756 A
1800 V
(27005)210 648 A
1068(*)S
(dev_opcl:)378 1236 A
(perform)294 1740 A
(generic)294 2076 A
(device-specific)630 2412 A
(processing)420 3084 A
(for)126 3546 A
(open)168 3714 A
3924(&)S
(close)210 4008 A
1890 V
(27006)210 648 A
1068(*)S
(tty_open:)378 1236 A
(perform)294 1740 A
(tty-specific)504 2076 A
(processing)420 2622 A
(for)126 3084 A
(open)168 3252 A
1980 V
(27007)210 648 A
1068(*)S
(ctty_open:)420 1236 A
(perform)294 1740 A
(controlling-tty-specific)1008 2076 A
(processing)420 3126 A
(for)126 3588 A
(open)168 3756 A
2070 V
(27008)210 648 A
1068(*)S
(ctty_close:)462 1236 A
(perform)294 1740 A
(controlling-tty-specific)1008 2076 A
(processing)420 3126 A
(for)126 3588 A
(close)210 3756 A
2160 V
(27009)210 648 A
1068(*)S
(do_setsid:)420 1236 A
(perform)294 1740 A
(the)126 2076 A
(SETSID)252 2244 A
(system)252 2538 A
(call)168 2832 A
(\(FS)126 3042 A
(side\))210 3210 A
2250 V
(27010)210 648 A
1068(*)S
(do_ioctl:)378 1236 A
(perform)294 1740 A
(the)126 2076 A
(IOCTL)210 2244 A
(system)252 2496 A
(call)168 2790 A
2340 V
(27011)210 648 A
1068(*)S
(call_task:)420 1236 A
(procedure)378 1740 A
(that)168 2160 A
(actually)336 2370 A
(calls)210 2748 A
(the)126 3000 A
(kernel)252 3168 A
(tasks)210 3462 A
2430 V
(27012)210 648 A
1068(*)S
(call_ctty:)420 1236 A
(procedure)378 1740 A
(that)168 2160 A
(actually)336 2370 A
(calls)210 2748 A
(task)168 3000 A
(for)126 3210 A
(/dev/tty)336 3378 A
2520 V
(27013)210 648 A
1068(*/)S
2610 V
(27014)210 648 A
2700 V
(27015)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
2790 V
(27016)210 648 A
(#include)336 1026 A
(<fcntl.h>)378 1404 A
2880 V
(27017)210 648 A
(#include)336 1026 A
(<minix/callnr.h>)672 1404 A
2970 V
(27018)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
3060 V
(27019)210 648 A
(#include)336 1026 A
("dev.h")294 1404 A
3150 V
(27020)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
3240 V
(27021)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
3330 V
(27022)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
3420 V
(27023)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
3510 V
(27024)210 648 A
3600 V
(27025)210 648 A
(PRIVATE)294 1026 A
(message)294 1362 A
(dev_mess;)378 1698 A
3690 V
(27026)210 648 A
(PRIVATE)294 1026 A
(major,)252 1362 A
(minor,)252 1656 A
(task;)210 1950 A
3780 V
(27027)210 648 A
3870 V
(27028)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(find_dev,)378 2076 A
(\(Dev_t)252 2496 A
(dev\))168 2790 A
4050(\);)S
3960 V
(27029)210 648 A
4050 V
(27030)210 648 A
(/*===========================================================================*)3276 1026 A
4140 V
(27031)210 648 A
1068(*)S
(dev_io)252 2370 A
4260(*)S
4230 V
(27032)210 648 A
(*===========================================================================*/)3276 1068 A
4320 V
(27033)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(dev_io\(op,)420 1488 A
(nonblock,)378 1950 A
(dev,)168 2370 A
(pos,)168 2580 A
(bytes,)252 2790 A
(proc,)210 3084 A
(buff\))210 3336 A
4410 V
(27034)210 648 A
(int)126 1026 A
(op;)126 1194 A
2370(/*)S
(DEV_READ,)378 2496 A
(DEV_WRITE,)420 2916 A
(DEV_IOCTL,)420 3378 A
(etc.)168 3840 A
4050(*/)S
4500 V
(27035)210 648 A
(int)126 1026 A
(nonblock;)378 1194 A
2370(/*)S
(TRUE)168 2496 A
2706(if)S
(nonblocking)462 2832 A
3336(op)S
3462(*/)S
4590 V
(27036)210 648 A
(dev_t)210 1026 A
(dev;)168 1278 A
2370(/*)S
(major-minor)462 2496 A
(device)252 3000 A
(number)252 3294 A
3588(*/)S
4680 V
(27037)210 648 A
(off_t)210 1026 A
(pos;)168 1278 A
2370(/*)S
(byte)168 2496 A
(position)336 2706 A
3084(*/)S
4770 V
(27038)210 648 A
(int)126 1026 A
(bytes;)252 1194 A
2370(/*)S
(how)126 2496 A
(many)168 2664 A
(bytes)210 2874 A
3126(to)S
(transfer)336 3252 A
3630(*/)S
4860 V
(27039)210 648 A
(int)126 1026 A
(proc;)210 1194 A
2370(/*)S
2496(in)S
(whose)210 2622 A
(address)294 2874 A
(space)210 3210 A
3462(is)S
(buff?)210 3588 A
3840(*/)S
4950 V
(27040)210 648 A
(char)168 1026 A
(*buff;)252 1236 A
2370(/*)S
(virtual)294 2496 A
(address)294 2832 A
3168(of)S
(the)126 3294 A
(buffer)252 3462 A
3756(*/)S
5040 V
(27041)210 648 A
1026({)S
5130 V
(27042)210 648 A
1026(/*)S
(Read)168 1152 A
1362(or)S
(write)210 1488 A
(from)168 1740 A
1950(a)S
(device.)294 2034 A
(The)126 2412 A
(parameter)378 2580 A
('dev')210 3000 A
(tells)210 3252 A
(which)210 3504 A
(one.)168 3756 A
3966(*/)S
5220 V
(27043)210 648 A
5310 V
(27044)210 648 A
(find_dev\(dev\);)588 1110 A
2370(/*)S
(load)168 2496 A
(the)126 2706 A
(variables)378 2874 A
(major,)252 3294 A
(minor,)252 3588 A
(and)126 3882 A
(task)168 4050 A
4260(*/)S
5400 V
(27045)210 648 A
5490 V
(27046)210 648 A
1110(/*)S
(Set)126 1236 A
1404(up)S
(the)126 1530 A
(message)294 1698 A
(passed)252 2034 A
2328(to)S
(task.)210 2454 A
2706(*/)S
5580 V
(27047)210 648 A
(dev_mess.m_type)630 1110 A
1866(=)S
(op;)126 1950 A
5670 V
(27048)210 648 A
(dev_mess.DEVICE)630 1110 A
1866(=)S
(\(dev)168 1950 A
2160(>>)S
(MINOR\))252 2286 A
2580(&)S
(BYTE;)210 2664 A
5760 V
(27049)210 648 A
(dev_mess.POSITION)714 1110 A
1866(=)S
(pos;)168 1950 A
5850 V
(27050)210 648 A
(dev_mess.PROC_NR)672 1110 A
1866(=)S
(proc;)210 1950 A
5940 V
(27051)210 648 A
(dev_mess.ADDRESS)672 1110 A
1866(=)S
(buff;)210 1950 A
6030 V
(27052)210 648 A
(dev_mess.COUNT)588 1110 A
1866(=)S
(bytes;)252 1950 A
6120 V
(27053)210 648 A
(dev_mess.TTY_FLAGS)756 1110 A
1908(=)S
(nonblock;)378 1992 A
2412(/*)S
(temporary)378 2538 A
(kludge)252 2958 A
3252(*/)S
6210 V
(27054)210 648 A
8418 V
EP
%%Page: 373 373
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2101(File:)S
2334(src/fs/device.c)S
12 B
(373)180 4248 A
900 V
7 LST
(27055)210 648 A
1110(/*)S
(Call)168 1236 A
(the)126 1446 A
(task.)210 1614 A
1866(*/)S
990 V
(27056)210 648 A
(\(*dmap[major].dmap_rw\)\(task,)1176 1110 A
(&dev_mess\);)462 2328 A
1080 V
(27057)210 648 A
1170 V
(27058)210 648 A
1110(/*)S
(Task)168 1236 A
(has)126 1446 A
(completed.)420 1614 A
(See)126 2118 A
2286(if)S
(call)168 2412 A
(completed.)420 2622 A
3084(*/)S
1260 V
(27059)210 648 A
1110(if)S
(\(dev_mess.REP_STATUS)840 1236 A
2118(==)S
(SUSPEND\))336 2244 A
2622({)S
1350 V
(27060)210 648 A
1362(if)S
(\(op)126 1488 A
1656(==)S
(DEV_OPEN\))378 1782 A
(task)168 2202 A
2412(=)S
(XPOPEN;)294 2496 A
1440 V
(27061)210 648 A
(suspend\(task\);)588 1362 A
2370(/*)S
(suspend)294 2496 A
(user)168 2832 A
3042(*/)S
1530 V
(27062)210 648 A
1110(})S
1620 V
(27063)210 648 A
1710 V
(27064)210 648 A
(return\(dev_mess.REP_STATUS\);)1176 1110 A
1800 V
(27065)210 648 A
1026(})S
2070 V
(27068)210 648 A
(/*===========================================================================*)3276 1026 A
2160 V
(27069)210 648 A
1068(*)S
(dev_opcl)336 2370 A
4260(*)S
2250 V
(27070)210 648 A
(*===========================================================================*/)3276 1068 A
2340 V
(27071)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(dev_opcl\(task_nr,)714 1530 A
(mess_ptr\))378 2286 A
2430 V
(27072)210 648 A
(int)126 1026 A
(task_nr;)336 1194 A
2370(/*)S
(which)210 2496 A
(task)168 2748 A
2958(*/)S
2520 V
(27073)210 648 A
(message)294 1026 A
(*mess_ptr;)420 1362 A
2370(/*)S
(message)294 2496 A
(pointer)294 2832 A
3168(*/)S
2610 V
(27074)210 648 A
1026({)S
2700 V
(27075)210 648 A
1026(/*)S
(Called)252 1152 A
(from)168 1446 A
(the)126 1656 A
(dmap)168 1824 A
(struct)252 2034 A
2328(in)S
(table.c)294 2454 A
2790(on)S
(opens)210 2916 A
3168(&)S
(closes)252 3252 A
3546(of)S
(special)294 3672 A
(files.*/)336 4008 A
2790 V
(27076)210 648 A
2880 V
(27077)210 648 A
(int)126 1110 A
(op;)126 1278 A
2970 V
(27078)210 648 A
3060 V
(27079)210 648 A
1110(op)S
1236(=)S
(mess_ptr->m_type;)714 1320 A
2370(/*)S
(save)168 2496 A
(DEV_OPEN)336 2706 A
3084(or)S
(DEV_CLOSE)378 3210 A
(for)126 3630 A
(later)210 3798 A
4050(*/)S
3150 V
(27080)210 648 A
(mess_ptr->DEVICE)672 1110 A
1824(=)S
(\(mess_ptr->DEVICE)714 1908 A
2664(>>)S
(MINOR\))252 2790 A
3084(&)S
(BYTE;)210 3168 A
3240 V
(27081)210 648 A
(mess_ptr->PROC_NR)714 1110 A
1866(=)S
1950(fp)S
2076(-)S
(fproc;)252 2160 A
3330 V
(27082)210 648 A
3420 V
(27083)210 648 A
(call_task\(task_nr,)756 1110 A
(mess_ptr\);)420 1908 A
3510 V
(27084)210 648 A
3600 V
(27085)210 648 A
1110(/*)S
(Task)168 1236 A
(has)126 1446 A
(completed.)420 1614 A
(See)126 2118 A
2286(if)S
(call)168 2412 A
(completed.)420 2622 A
3084(*/)S
3690 V
(27086)210 648 A
1110(if)S
(\(mess_ptr->REP_STATUS)882 1236 A
2160(==)S
(SUSPEND\))336 2286 A
2664({)S
3780 V
(27087)210 648 A
1362(if)S
(\(op)126 1488 A
1656(==)S
(DEV_OPEN\))378 1782 A
(task_nr)294 2202 A
2538(=)S
(XPOPEN;)294 2622 A
3870 V
(27088)210 648 A
(suspend\(task_nr\);)714 1362 A
2370(/*)S
(suspend)294 2496 A
(user)168 2832 A
3042(*/)S
3960 V
(27089)210 648 A
1110(})S
4050 V
(27090)210 648 A
1026(})S
4230 V
(27092)210 648 A
(/*===========================================================================*)3276 1026 A
4320 V
(27093)210 648 A
1068(*)S
(tty_open)336 2370 A
4260(*)S
4410 V
(27094)210 648 A
(*===========================================================================*/)3276 1068 A
4500 V
(27095)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(tty_open\(task_nr,)714 1530 A
(mess_ptr\))378 2286 A
4590 V
(27096)210 648 A
(int)126 1026 A
(task_nr;)336 1194 A
4680 V
(27097)210 648 A
(message)294 1026 A
(*mess_ptr;)420 1362 A
4770 V
(27098)210 648 A
1026({)S
4860 V
(27099)210 648 A
1026(/*)S
(This)168 1152 A
(procedure)378 1362 A
1782(is)S
(called)252 1908 A
(from)168 2202 A
(the)126 2412 A
(dmap)168 2580 A
(struct)252 2790 A
3084(in)S
(table.c)294 3210 A
3546(on)S
(tty)126 3672 A
(opens.)252 3840 A
4134(*/)S
4950 V
(27100)210 648 A
5040 V
(27101)210 648 A
(int)126 1110 A
1278(r;)S
5130 V
(27102)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
5220 V
(27103)210 648 A
(int)126 1110 A
(flags,)252 1278 A
(proc;)210 1572 A
5310 V
(27104)210 648 A
(register)336 1110 A
(struct)252 1488 A
(fproc)210 1782 A
(*rfp;)210 2034 A
5400 V
(27105)210 648 A
5490 V
(27106)210 648 A
(dev)126 1110 A
1278(=)S
(\(dev_t\))294 1362 A
(mess_ptr->DEVICE;)714 1698 A
5580 V
(27107)210 648 A
(flags)210 1110 A
1362(=)S
(mess_ptr->COUNT;)672 1446 A
5670 V
(27108)210 648 A
(proc)168 1110 A
1320(=)S
1404(fp)S
1530(-)S
(fproc;)252 1614 A
5760 V
(27109)210 648 A
5850 V
(27110)210 648 A
1110(/*)S
(Add)126 1236 A
(O_NOCTTY)336 1404 A
1782(to)S
(the)126 1908 A
(flags)210 2076 A
2328(if)S
(this)168 2454 A
(process)294 2664 A
3000(is)S
(not)126 3126 A
3294(a)S
(session)294 3378 A
(leader,)294 3714 A
4050(or)S
5940 V
(27111)210 648 A
1152(*)S
1236(if)S
1362(it)S
(already)294 1488 A
(has)126 1824 A
1992(a)S
(controlling)462 2076 A
(tty,)168 2580 A
2790(or)S
2916(if)S
3042(it)S
3168(is)S
(someone)294 3294 A
(elses)210 3630 A
6030 V
(27112)210 648 A
1152(*)S
(controlling)462 1236 A
(tty.)168 1740 A
6120 V
(27113)210 648 A
1152(*/)S
6210 V
(27114)210 648 A
1110(if)S
(\(!fp->fp_sesldr)630 1236 A
1908(||)S
(fp->fp_tty)420 2034 A
2496(!=)S
2622(0\))S
2748({)S
8418 V
EP
%%Page: 374 374
BP
/slant 0 def
/height 0 def
630 V
12 B
(374)180 648 A
11 R
2101(File:)S
2334(src/fs/device.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(27115)210 648 A
(flags)210 1362 A
1614(|=)S
(O_NOCTTY;)378 1740 A
990 V
(27116)210 648 A
1110(})S
(else)168 1194 A
1404({)S
1080 V
(27117)210 648 A
(for)126 1362 A
(\(rfp)168 1530 A
1740(=)S
(&fproc[LOW_USER];)714 1824 A
(rfp)126 2580 A
2748(<)S
(&fproc[NR_PROCS];)714 2832 A
(rfp++\))252 3588 A
3882({)S
1170 V
(27118)210 648 A
1698(if)S
(\(rfp->fp_tty)504 1824 A
2370(==)S
(dev\))168 2496 A
(flags)210 2706 A
2958(|=)S
(O_NOCTTY;)378 3084 A
1260 V
(27119)210 648 A
1362(})S
1350 V
(27120)210 648 A
1110(})S
1440 V
(27121)210 648 A
1530 V
(27122)210 648 A
1110(r)S
1194(=)S
(dev_io\(DEV_OPEN,)672 1278 A
(mode,)210 1992 A
(dev,)168 2244 A
(\(off_t\))294 2454 A
2790(0,)S
(flags,)252 2916 A
(proc,)210 3210 A
(NIL_PTR\);)378 3462 A
1620 V
(27123)210 648 A
1710 V
(27124)210 648 A
1110(if)S
1236(\(r)S
1362(==)S
1488(1\))S
1614({)S
1800 V
(27125)210 648 A
(fp->fp_tty)420 1362 A
1824(=)S
(dev;)168 1908 A
1890 V
(27126)210 648 A
1362(r)S
1446(=)S
(OK;)126 1530 A
1980 V
(27127)210 648 A
1110(})S
2070 V
(27128)210 648 A
2160 V
(27129)210 648 A
(mess_ptr->REP_STATUS)840 1110 A
1992(=)S
2076(r;)S
2250 V
(27130)210 648 A
1026(})S
2520 V
(27133)210 648 A
(/*===========================================================================*)3276 1026 A
2610 V
(27134)210 648 A
1068(*)S
(ctty_open)378 2370 A
4260(*)S
2700 V
(27135)210 648 A
(*===========================================================================*/)3276 1068 A
2790 V
(27136)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(ctty_open\(task_nr,)756 1530 A
(mess_ptr\))378 2328 A
2880 V
(27137)210 648 A
(int)126 1026 A
(task_nr;)336 1194 A
2970 V
(27138)210 648 A
(message)294 1026 A
(*mess_ptr;)420 1362 A
3060 V
(27139)210 648 A
1026({)S
3150 V
(27140)210 648 A
1026(/*)S
(This)168 1152 A
(procedure)378 1362 A
1782(is)S
(called)252 1908 A
(from)168 2202 A
(the)126 2412 A
(dmap)168 2580 A
(struct)252 2790 A
3084(in)S
(table.c)294 3210 A
3546(on)S
(opening)294 3672 A
3240 V
(27141)210 648 A
1068(*)S
(/dev/tty,)378 1152 A
(the)126 1572 A
(magic)210 1740 A
(device)252 1992 A
(that)168 2286 A
(translates)420 2496 A
2958(to)S
(the)126 3084 A
(controlling)462 3252 A
(tty.)168 3756 A
3330 V
(27142)210 648 A
1068(*/)S
3420 V
(27143)210 648 A
3510 V
(27144)210 648 A
(mess_ptr->REP_STATUS)840 1110 A
1992(=)S
(fp->fp_tty)420 2076 A
2538(==)S
2664(0)S
2748(?)S
(ENXIO)210 2832 A
3084(:)S
(OK;)126 3168 A
3600 V
(27145)210 648 A
1026(})S
3870 V
(27148)210 648 A
(/*===========================================================================*)3276 1026 A
3960 V
(27149)210 648 A
1068(*)S
(ctty_close)420 2370 A
4260(*)S
4050 V
(27150)210 648 A
(*===========================================================================*/)3276 1068 A
4140 V
(27151)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(ctty_close\(task_nr,)798 1530 A
(mess_ptr\))378 2370 A
4230 V
(27152)210 648 A
(int)126 1026 A
(task_nr;)336 1194 A
4320 V
(27153)210 648 A
(message)294 1026 A
(*mess_ptr;)420 1362 A
4410 V
(27154)210 648 A
1026({)S
4500 V
(27155)210 648 A
1026(/*)S
(Close)210 1152 A
(/dev/tty.)378 1404 A
1824(*/)S
4590 V
(27156)210 648 A
4680 V
(27157)210 648 A
(mess_ptr->REP_STATUS)840 1110 A
1992(=)S
(OK;)126 2076 A
4770 V
(27158)210 648 A
1026(})S
5040 V
(27161)210 648 A
(/*===========================================================================*)3276 1026 A
5130 V
(27162)210 648 A
1068(*)S
(do_setsid)378 2370 A
4260(*)S
5220 V
(27163)210 648 A
(*===========================================================================*/)3276 1068 A
5310 V
(27164)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_setsid\(\))462 1488 A
5400 V
(27165)210 648 A
1026({)S
5490 V
(27166)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
1656(FS)S
(side)168 1782 A
1992(of)S
(the)126 2118 A
(SETSID)252 2286 A
(call,)210 2580 A
(i.e.)168 2832 A
(get)126 3042 A
(rid)126 3210 A
3378(of)S
(the)126 3504 A
(controlling)462 3672 A
5580 V
(27167)210 648 A
1068(*)S
(terminal)336 1152 A
1530(of)S
1656(a)S
(process,)336 1740 A
(and)126 2118 A
(make)168 2286 A
(the)126 2496 A
(process)294 2664 A
3000(a)S
(session)294 3084 A
(leader.)294 3420 A
5670 V
(27168)210 648 A
1068(*/)S
5760 V
(27169)210 648 A
(register)336 1110 A
(struct)252 1488 A
(fproc)210 1782 A
(*rfp;)210 2034 A
5850 V
(27170)210 648 A
5940 V
(27171)210 648 A
1110(/*)S
(Only)168 1236 A
1446(MM)S
(may)126 1572 A
1740(do)S
(the)126 1866 A
(SETSID)252 2034 A
(call)168 2328 A
(directly.)378 2538 A
2958(*/)S
6030 V
(27172)210 648 A
1110(if)S
(\(who)168 1236 A
1446(!=)S
(MM_PROC_NR\))462 1572 A
(return\(ENOSYS\);)630 2076 A
6120 V
(27173)210 648 A
6210 V
(27174)210 648 A
1110(/*)S
(Make)168 1236 A
(the)126 1446 A
(process)294 1614 A
1950(a)S
(session)294 2034 A
(leader)252 2370 A
(with)168 2664 A
2874(no)S
(controlling)462 3000 A
(tty.)168 3504 A
3714(*/)S
8418 V
EP
%%Page: 375 375
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2101(File:)S
2334(src/fs/device.c)S
12 B
(375)180 4248 A
900 V
7 LST
(27175)210 648 A
(rfp)126 1110 A
1278(=)S
(&fproc[slot1];)588 1362 A
990 V
(27176)210 648 A
(rfp->fp_sesldr)588 1110 A
1740(=)S
(TRUE;)210 1824 A
1080 V
(27177)210 648 A
(rfp->fp_tty)462 1110 A
1614(=)S
1698(0;)S
1170 V
(27178)210 648 A
1026(})S
1440 V
(27181)210 648 A
(/*===========================================================================*)3276 1026 A
1530 V
(27182)210 648 A
1068(*)S
(do_ioctl)336 2370 A
4260(*)S
1620 V
(27183)210 648 A
(*===========================================================================*/)3276 1068 A
1710 V
(27184)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(do_ioctl\(\))420 1488 A
1800 V
(27185)210 648 A
1026({)S
1890 V
(27186)210 648 A
1026(/*)S
(Perform)294 1152 A
(the)126 1488 A
(ioctl\(ls_fd,)504 1656 A
(request,)336 2202 A
(argx\))210 2580 A
(system)252 2832 A
(call)168 3126 A
(\(uses)210 3336 A
3588(m2)S
(fmt\).)210 3714 A
3966(*/)S
1980 V
(27187)210 648 A
2070 V
(27188)210 648 A
(struct)252 1110 A
(filp)168 1404 A
(*f;)126 1614 A
2160 V
(27189)210 648 A
(register)336 1110 A
(struct)252 1488 A
(inode)210 1782 A
(*rip;)210 2034 A
2250 V
(27190)210 648 A
(dev_t)210 1110 A
(dev;)168 1362 A
2340 V
(27191)210 648 A
2430 V
(27192)210 648 A
1110(if)S
1236(\()S
1320(\(f)S
1446(=)S
(get_filp\(ls_fd\)\))672 1530 A
2244(==)S
(NIL_FILP\))378 2370 A
(return\(err_code\);)714 2790 A
2520 V
(27193)210 648 A
(rip)126 1110 A
1278(=)S
(f->filp_ino;)504 1362 A
2370(/*)S
(get)126 2496 A
(inode)210 2664 A
(pointer)294 2916 A
3252(*/)S
2610 V
(27194)210 648 A
1110(if)S
1236(\()S
(\(rip->i_mode)504 1320 A
1866(&)S
(I_TYPE\))294 1950 A
2286(!=)S
(I_CHAR_SPECIAL)588 2412 A
2700 V
(27195)210 648 A
1362(&&)S
(\(rip->i_mode)504 1488 A
2034(&)S
(I_TYPE\))294 2118 A
2454(!=)S
(I_BLOCK_SPECIAL\))672 2580 A
(return\(ENOTTY\);)630 3294 A
2790 V
(27196)210 648 A
(dev)126 1110 A
1278(=)S
(\(dev_t\))294 1362 A
(rip->i_zone[0];)630 1698 A
2880 V
(27197)210 648 A
(find_dev\(dev\);)588 1110 A
2970 V
(27198)210 648 A
3060 V
(27199)210 648 A
(dev_mess=)378 1110 A
1530(m;)S
3150 V
(27200)210 648 A
3240 V
(27201)210 648 A
(dev_mess.m_type)630 1110 A
1824(=)S
(DEV_IOCTL;)420 1908 A
3330 V
(27202)210 648 A
(dev_mess.PROC_NR)672 1110 A
1824(=)S
(who;)168 1908 A
3420 V
(27203)210 648 A
(dev_mess.TTY_LINE)714 1110 A
1866(=)S
(minor;)252 1950 A
3510 V
(27204)210 648 A
3600 V
(27205)210 648 A
1110(/*)S
(Call)168 1236 A
(the)126 1446 A
(task.)210 1614 A
1866(*/)S
3690 V
(27206)210 648 A
(\(*dmap[major].dmap_rw\)\(task,)1176 1110 A
(&dev_mess\);)462 2328 A
3780 V
(27207)210 648 A
3870 V
(27208)210 648 A
1110(/*)S
(Task)168 1236 A
(has)126 1446 A
(completed.)420 1614 A
(See)126 2118 A
2286(if)S
(call)168 2412 A
(completed.)420 2622 A
3084(*/)S
3960 V
(27209)210 648 A
1110(if)S
(\(dev_mess.REP_STATUS)840 1236 A
2118(==)S
(SUSPEND\))336 2244 A
2622({)S
4050 V
(27210)210 648 A
1362(if)S
(\(f->filp_flags)588 1488 A
2118(&)S
(O_NONBLOCK\))462 2202 A
2706({)S
4140 V
(27211)210 648 A
1698(/*)S
(Not)126 1824 A
(supposed)336 1992 A
2370(to)S
(block.)252 2496 A
2790(*/)S
4230 V
(27212)210 648 A
(dev_mess.m_type)630 1698 A
2370(=)S
(CANCEL;)294 2454 A
4320 V
(27213)210 648 A
(dev_mess.PROC_NR)672 1698 A
2412(=)S
(who;)168 2496 A
4410 V
(27214)210 648 A
(dev_mess.TTY_LINE)714 1698 A
2454(=)S
(minor;)252 2538 A
4500 V
(27215)210 648 A
(\(*dmap[major].dmap_rw\)\(task,)1176 1698 A
(&dev_mess\);)462 2916 A
4590 V
(27216)210 648 A
1698(if)S
(\(dev_mess.REP_STATUS)840 1824 A
2706(==)S
(EINTR\))252 2832 A
(dev_mess.REP_STATUS)798 3126 A
3966(=)S
(EAGAIN;)294 4050 A
4680 V
(27217)210 648 A
1362(})S
(else)168 1446 A
1656({)S
4770 V
(27218)210 648 A
(suspend\(task\);)588 1698 A
2706(/*)S
(User)168 2832 A
(must)168 3042 A
3252(be)S
(suspended.)420 3378 A
3840(*/)S
4860 V
(27219)210 648 A
1362(})S
4950 V
(27220)210 648 A
1110(})S
5040 V
(27221)210 648 A
(return\(dev_mess.REP_STATUS\);)1176 1110 A
5130 V
(27222)210 648 A
1026(})S
5400 V
(27225)210 648 A
(/*===========================================================================*)3276 1026 A
5490 V
(27226)210 648 A
1068(*)S
(find_dev)336 2370 A
4260(*)S
5580 V
(27227)210 648 A
(*===========================================================================*/)3276 1068 A
5670 V
(27228)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(find_dev\(dev\))546 1572 A
5760 V
(27229)210 648 A
(dev_t)210 1026 A
(dev;)168 1278 A
2370(/*)S
(device)252 2496 A
2790(*/)S
5850 V
(27230)210 648 A
1026({)S
5940 V
(27231)210 648 A
1026(/*)S
(Extract)294 1152 A
(the)126 1488 A
(major)210 1656 A
(and)126 1908 A
(minor)210 2076 A
(device)252 2328 A
(number)252 2622 A
(from)168 2916 A
(the)126 3126 A
(parameter.)420 3294 A
3756(*/)S
6030 V
(27232)210 648 A
6120 V
(27233)210 648 A
(major)210 1110 A
1362(=)S
(\(dev)168 1446 A
1656(>>)S
(MAJOR\))252 1782 A
2076(&)S
(BYTE;)210 2160 A
2706(/*)S
(major)210 2832 A
(device)252 3084 A
(number)252 3378 A
3672(*/)S
6210 V
(27234)210 648 A
(minor)210 1110 A
1362(=)S
(\(dev)168 1446 A
1656(>>)S
(MINOR\))252 1782 A
2076(&)S
(BYTE;)210 2160 A
2706(/*)S
(minor)210 2832 A
(device)252 3084 A
(number)252 3378 A
3672(*/)S
8418 V
EP
%%Page: 376 376
BP
/slant 0 def
/height 0 def
630 V
12 B
(376)180 648 A
11 R
2101(File:)S
2334(src/fs/device.c)S
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(27235)210 648 A
1110(if)S
(\(major)252 1236 A
1530(>=)S
(max_major\))420 1656 A
2118({)S
990 V
(27236)210 648 A
(major)210 1362 A
1614(=)S
(minor)210 1698 A
1950(=)S
2034(0;)S
2706(/*)S
(will)168 2832 A
(fail)168 3042 A
(with)168 3252 A
(ENODEV)252 3462 A
3756(*/)S
1080 V
(27237)210 648 A
1110(})S
1170 V
(27238)210 648 A
(task)168 1110 A
1320(=)S
(dmap[major].dmap_task;)924 1404 A
2370(/*)S
(which)210 2496 A
(task)168 2748 A
(services)336 2958 A
(the)126 3336 A
(device)252 3504 A
3798(*/)S
1260 V
(27239)210 648 A
1026(})S
1530 V
(27242)210 648 A
(/*===========================================================================*)3276 1026 A
1620 V
(27243)210 648 A
1068(*)S
(call_task)378 2370 A
4260(*)S
1710 V
(27244)210 648 A
(*===========================================================================*/)3276 1068 A
1800 V
(27245)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(call_task\(task_nr,)756 1530 A
(mess_ptr\))378 2328 A
1890 V
(27246)210 648 A
(int)126 1026 A
(task_nr;)336 1194 A
2370(/*)S
(which)210 2496 A
(task)168 2748 A
2958(to)S
(call)168 3084 A
3294(*/)S
1980 V
(27247)210 648 A
(message)294 1026 A
(*mess_ptr;)420 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
(for)126 3294 A
(task)168 3462 A
3672(*/)S
2070 V
(27248)210 648 A
1026({)S
2160 V
(27249)210 648 A
1026(/*)S
(All)126 1152 A
(file)168 1320 A
(system)252 1530 A
(I/O)126 1824 A
(ultimately)420 1992 A
(comes)210 2454 A
(down)168 2706 A
2916(to)S
(I/O)126 3042 A
3210(on)S
(major/minor)462 3336 A
(device)252 3840 A
2250 V
(27250)210 648 A
1068(*)S
(pairs.)252 1152 A
(These)210 1488 A
(lead)168 1740 A
1950(to)S
(calls)210 2076 A
2328(on)S
(the)126 2454 A
(following)378 2622 A
(routines)336 3042 A
(via)126 3420 A
(the)126 3588 A
(dmap)168 3756 A
(table.)252 3966 A
2340 V
(27251)210 648 A
1068(*/)S
2430 V
(27252)210 648 A
2520 V
(27253)210 648 A
(int)126 1110 A
1278(r,)S
(proc_nr;)336 1404 A
2610 V
(27254)210 648 A
(message)294 1110 A
(local_m;)336 1446 A
2700 V
(27255)210 648 A
2790 V
(27256)210 648 A
(proc_nr)294 1110 A
1446(=)S
(mess_ptr->PROC_NR;)756 1530 A
2880 V
(27257)210 648 A
2970 V
(27258)210 648 A
(while)210 1110 A
(\(\(r)126 1362 A
1530(=)S
(sendrec\(task_nr,)672 1614 A
(mess_ptr\)\))420 2328 A
2790(==)S
(ELOCKED\))336 2916 A
3294({)S
3060 V
(27259)210 648 A
1362(/*)S
(sendrec\(\))378 1488 A
(failed)252 1908 A
2202(to)S
(avoid)210 2328 A
(deadlock.)378 2580 A
(The)126 3000 A
(task)168 3168 A
('task_nr')378 3378 A
3798(is)S
3150 V
(27260)210 648 A
1404(*)S
(trying)252 1488 A
1782(to)S
(send)168 1908 A
2118(a)S
(REVIVE)252 2202 A
(message)294 2496 A
(for)126 2832 A
3000(an)S
(earlier)294 3126 A
(request.)336 3462 A
3240 V
(27261)210 648 A
1404(*)S
(Handle)252 1488 A
1782(it)S
(and)126 1908 A
2076(go)S
(try)126 2202 A
(again.)252 2370 A
3330 V
(27262)210 648 A
1404(*/)S
3420 V
(27263)210 648 A
1362(if)S
(\(\(r)126 1488 A
1656(=)S
(receive\(task_nr,)672 1740 A
(&local_m\)\))420 2454 A
2916(!=)S
(OK\))126 3042 A
(break;)252 3210 A
3510 V
(27264)210 648 A
3600 V
(27265)210 648 A
1362(/*)S
1488(If)S
(we're)210 1614 A
(trying)252 1866 A
2160(to)S
(send)168 2286 A
2496(a)S
(cancel)252 2580 A
(message)294 2874 A
3210(to)S
3336(a)S
(task)168 3420 A
(which)210 3630 A
(has)126 3882 A
(just)168 4050 A
3690 V
(27266)210 648 A
1404(*)S
(sent)168 1488 A
1698(a)S
(completion)420 1782 A
(reply,)252 2244 A
(ignore)252 2538 A
(the)126 2832 A
(reply)210 3000 A
(and)126 3252 A
(abort)210 3420 A
(the)126 3672 A
(cancel)252 3840 A
3780 V
(27267)210 648 A
1404(*)S
(request.)336 1488 A
(The)126 1866 A
(caller)252 2034 A
(will)168 2328 A
2538(do)S
(the)126 2664 A
(revive)252 2832 A
(for)126 3126 A
(the)126 3294 A
(process.)336 3462 A
3870 V
(27268)210 648 A
1404(*/)S
3960 V
(27269)210 648 A
1362(if)S
(\(mess_ptr->m_type)714 1488 A
2244(==)S
(CANCEL)252 2370 A
2664(&&)S
(local_m.REP_PROC_NR)798 2790 A
3630(==)S
(proc_nr\))336 3756 A
4050 V
(27270)210 648 A
(return;)294 1698 A
4140 V
(27271)210 648 A
4230 V
(27272)210 648 A
1362(/*)S
(Otherwise)378 1488 A
1908(it)S
(should)252 2034 A
2328(be)S
2454(a)S
(REVIVE.)294 2538 A
2874(*/)S
4320 V
(27273)210 648 A
1362(if)S
(\(local_m.m_type)630 1488 A
2160(!=)S
(REVIVE\))294 2286 A
2622({)S
4410 V
(27274)210 648 A
(printf\()294 1698 A
4500 V
(27275)210 648 A
("fs:)168 1698 A
(strange)294 1908 A
(device)252 2244 A
(reply)210 2538 A
(from)168 2790 A
(%d,)126 3000 A
(type)168 3168 A
3378(=)S
(%d,)126 3462 A
(proc)168 3630 A
3840(=)S
(%d\\n",)252 3924 A
4590 V
(27276)210 648 A
(local_m.m_source,)714 2034 A
4680 V
(27277)210 648 A
(local_m.m_type,)630 2034 A
(local_m.REP_PROC_NR\);)882 2706 A
4770 V
(27278)210 648 A
(continue;)378 1698 A
4860 V
(27279)210 648 A
1362(})S
4950 V
(27280)210 648 A
5040 V
(27281)210 648 A
(revive\(local_m.REP_PROC_NR,)1134 1362 A
(local_m.REP_STATUS\);)840 2538 A
5130 V
(27282)210 648 A
1110(})S
5220 V
(27283)210 648 A
5310 V
(27284)210 648 A
1110(/*)S
(The)126 1236 A
(message)294 1404 A
(received)336 1740 A
(may)126 2118 A
2286(be)S
2412(a)S
(reply)210 2496 A
2748(to)S
(this)168 2874 A
(call,)210 3084 A
3336(or)S
3462(a)S
(REVIVE)252 3546 A
(for)126 3840 A
(some)168 4008 A
5400 V
(27285)210 648 A
1152(*)S
(other)210 1236 A
(process.)336 1488 A
5490 V
(27286)210 648 A
1152(*/)S
5580 V
(27287)210 648 A
(for)126 1110 A
(\(;;\))168 1278 A
1488({)S
5670 V
(27288)210 648 A
1362(if)S
1488(\(r)S
1614(!=)S
(OK\))126 1740 A
(panic\("call_task:)714 1908 A
(can't)210 2664 A
(send/receive",)588 2916 A
(NO_NUM\);)336 3546 A
5760 V
(27289)210 648 A
5850 V
(27290)210 648 A
1362(/*)S
(Did)126 1488 A
(the)126 1656 A
(process)294 1824 A
2160(we)S
(did)126 2286 A
(the)126 2454 A
(sendrec\(\))378 2622 A
(for)126 3042 A
(get)126 3210 A
3378(a)S
(result?)294 3462 A
3798(*/)S
5940 V
(27291)210 648 A
1362(if)S
(\(mess_ptr->REP_PROC_NR)924 1488 A
2454(==)S
(proc_nr\))336 2580 A
(break;)252 2958 A
6030 V
(27292)210 648 A
6120 V
(27293)210 648 A
1362(/*)S
(Otherwise)378 1488 A
1908(it)S
(should)252 2034 A
2328(be)S
2454(a)S
(REVIVE.)294 2538 A
2874(*/)S
6210 V
(27294)210 648 A
1362(if)S
(\(mess_ptr->m_type)714 1488 A
2244(!=)S
(REVIVE\))294 2370 A
2706({)S
8418 V
EP
%%Page: 377 377
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2101(File:)S
2334(src/fs/device.c)S
12 B
(377)180 4248 A
900 V
7 LST
(27295)210 648 A
(printf\()294 1698 A
990 V
(27296)210 648 A
("fs:)168 1698 A
(strange)294 1908 A
(device)252 2244 A
(reply)210 2538 A
(from)168 2790 A
(%d,)126 3000 A
(type)168 3168 A
3378(=)S
(%d,)126 3462 A
(proc)168 3630 A
3840(=)S
(%d\\n",)252 3924 A
1080 V
(27297)210 648 A
(mess_ptr->m_source,)798 2034 A
1170 V
(27298)210 648 A
(mess_ptr->m_type,)714 2034 A
(mess_ptr->REP_PROC_NR\);)966 2790 A
1260 V
(27299)210 648 A
(continue;)378 1698 A
1350 V
(27300)210 648 A
1362(})S
1440 V
(27301)210 648 A
(revive\(mess_ptr->REP_PROC_NR,)1218 1362 A
(mess_ptr->REP_STATUS\);)924 2622 A
1530 V
(27302)210 648 A
1620 V
(27303)210 648 A
1362(r)S
1446(=)S
(receive\(task_nr,)672 1530 A
(mess_ptr\);)420 2244 A
1710 V
(27304)210 648 A
1110(})S
1800 V
(27305)210 648 A
1026(})S
2070 V
(27308)210 648 A
(/*===========================================================================*)3276 1026 A
2160 V
(27309)210 648 A
1068(*)S
(call_ctty)378 2370 A
4596(*)S
2250 V
(27310)210 648 A
(*===========================================================================*/)3276 1068 A
2340 V
(27311)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(call_ctty\(task_nr,)756 1530 A
(mess_ptr\))378 2328 A
2430 V
(27312)210 648 A
(int)126 1026 A
(task_nr;)336 1194 A
2370(/*)S
(not)126 2496 A
(used)168 2664 A
2874(-)S
(for)126 2958 A
(compatibility)546 3126 A
(with)168 3714 A
(dmap_t)252 3924 A
4218(*/)S
2520 V
(27313)210 648 A
(message)294 1026 A
(*mess_ptr;)420 1362 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(message)294 2958 A
(for)126 3294 A
(task)168 3462 A
3672(*/)S
2610 V
(27314)210 648 A
1026({)S
2700 V
(27315)210 648 A
1026(/*)S
(This)168 1152 A
(routine)294 1362 A
1698(is)S
(only)168 1824 A
(called)252 2034 A
(for)126 2328 A
(one)126 2496 A
(device,)294 2664 A
(namely)252 3000 A
(/dev/tty.)378 3294 A
(Its)126 3756 A
(job)126 3924 A
2790 V
(27316)210 648 A
1068(*)S
1152(is)S
1278(to)S
(change)252 1404 A
(the)126 1698 A
(message)294 1866 A
2202(to)S
(use)126 2328 A
(the)126 2496 A
(controlling)462 2664 A
(terminal,)378 3168 A
(instead)294 3588 A
3924(of)S
(the)126 4050 A
2880 V
(27317)210 648 A
1068(*)S
(major/minor)462 1152 A
(pair)168 1656 A
(for)126 1866 A
(/dev/tty)336 2034 A
(itself.)294 2412 A
2970 V
(27318)210 648 A
1068(*/)S
3060 V
(27319)210 648 A
3150 V
(27320)210 648 A
(int)126 1110 A
(major_device;)546 1278 A
3240 V
(27321)210 648 A
3330 V
(27322)210 648 A
1110(if)S
(\(fp->fp_tty)462 1236 A
1740(==)S
1866(0\))S
1992({)S
3420 V
(27323)210 648 A
1362(/*)S
1488(No)S
(controlling)462 1614 A
(tty)126 2118 A
(present)294 2286 A
(anymore,)336 2622 A
(return)252 3000 A
3294(an)S
(I/O)126 3420 A
(error.)252 3588 A
3882(*/)S
3510 V
(27324)210 648 A
(mess_ptr->REP_STATUS)840 1362 A
2244(=)S
(EIO;)168 2328 A
3600 V
(27325)210 648 A
(return;)294 1362 A
3690 V
(27326)210 648 A
1110(})S
3780 V
(27327)210 648 A
(major_device)504 1110 A
1656(=)S
(\(fp->fp_tty)462 1740 A
2244(>>)S
(MAJOR\))252 2370 A
2664(&)S
(BYTE;)210 2748 A
3870 V
(27328)210 648 A
(task_nr)294 1110 A
1446(=)S
(dmap[major_device].dmap_task;)1218 1530 A
3042(/*)S
(task)168 3168 A
(for)126 3378 A
(controlling)462 3546 A
(tty)126 4050 A
4218(*/)S
3960 V
(27329)210 648 A
(mess_ptr->DEVICE)672 1110 A
1824(=)S
(\(fp->fp_tty)462 1908 A
2412(>>)S
(MINOR\))252 2538 A
2832(&)S
(BYTE;)210 2916 A
4050 V
(27330)210 648 A
(call_task\(task_nr,)756 1110 A
(mess_ptr\);)420 1908 A
4140 V
(27331)210 648 A
1026(})S
4410 V
(27334)210 648 A
(/*===========================================================================*)3276 1026 A
4500 V
(27335)210 648 A
1068(*)S
(no_dev)252 2370 A
4260(*)S
4590 V
(27336)210 648 A
(*===========================================================================*/)3276 1068 A
4680 V
(27337)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(no_dev\(task_nr,)630 1530 A
(m_ptr\))252 2202 A
4770 V
(27338)210 648 A
(int)126 1026 A
(task_nr;)336 1194 A
2370(/*)S
(not)126 2496 A
(used)168 2664 A
2874(-)S
(for)126 2958 A
(compatibility)546 3126 A
(with)168 3714 A
(dmap_t)252 3924 A
4218(*/)S
4860 V
(27339)210 648 A
(message)294 1026 A
(*m_ptr;)294 1362 A
2370(/*)S
(message)294 2496 A
(pointer)294 2832 A
3168(*/)S
4950 V
(27340)210 648 A
1026({)S
5040 V
(27341)210 648 A
1026(/*)S
1152(No)S
(device)252 1278 A
(there.)252 1572 A
1866(*/)S
5130 V
(27342)210 648 A
5220 V
(27343)210 648 A
(m_ptr->REP_STATUS)714 1110 A
1866(=)S
(ENODEV;)294 1950 A
5310 V
(27344)210 648 A
1026(})S
8418 V
EP
%%Page: 378 378
BP
/slant 0 def
/height 0 def
630 V
12 B
(378)180 648 A
11 R
2114(File:)S
(src/fs/utility.c)615 2347 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
990 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1080 V
(src/fs/utility.c)672 2034 A
1170 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
1350 V
(27400)210 648 A
1026(/*)S
(This)168 1152 A
(file)168 1362 A
(contains)336 1572 A
1950(a)S
(few)126 2034 A
(general)294 2202 A
(purpose)294 2538 A
(utility)294 2874 A
(routines.)378 3210 A
1440 V
(27401)210 648 A
1068(*)S
1530 V
(27402)210 648 A
1068(*)S
(The)126 1152 A
(entry)210 1320 A
(points)252 1572 A
(into)168 1866 A
(this)168 2076 A
(file)168 2286 A
(are)126 2496 A
1620 V
(27403)210 648 A
1068(*)S
(clock_time:)462 1236 A
(ask)126 1782 A
(the)126 1950 A
(clock)210 2118 A
(task)168 2370 A
(for)126 2580 A
(the)126 2748 A
(real)168 2916 A
(time)168 3126 A
1710 V
(27404)210 648 A
1068(*)S
(copy:)210 1236 A
(copy)168 1782 A
1992(a)S
(block)210 2076 A
2328(of)S
(data)168 2454 A
1800 V
(27405)210 648 A
1068(*)S
(fetch_name:)462 1236 A
1782(go)S
(get)126 1908 A
2076(a)S
(path)168 2160 A
(name)168 2370 A
(from)168 2580 A
(user)168 2790 A
(space)210 3000 A
1890 V
(27406)210 648 A
1068(*)S
(no_sys:)294 1236 A
(reject)252 1782 A
2076(a)S
(system)252 2160 A
(call)168 2454 A
(that)168 2664 A
2874(FS)S
(does)168 3000 A
(not)126 3210 A
(handle)252 3378 A
1980 V
(27407)210 648 A
1068(*)S
(panic:)252 1236 A
(something)378 1782 A
(awful)210 2202 A
(has)126 2454 A
(occurred;)378 2622 A
(MINIX)210 3084 A
(cannot)252 3336 A
(continue)336 3630 A
2070 V
(27408)210 648 A
1068(*)S
(conv2:)252 1236 A
1782(do)S
(byte)168 1908 A
(swapping)336 2118 A
2496(on)S
2622(a)S
(16-bit)252 2706 A
(int)126 3000 A
2160 V
(27409)210 648 A
1068(*)S
(conv4:)252 1236 A
1782(do)S
(byte)168 1908 A
(swapping)336 2118 A
2496(on)S
2622(a)S
(32-bit)252 2706 A
(long)168 3000 A
2250 V
(27410)210 648 A
1068(*/)S
2340 V
(27411)210 648 A
2430 V
(27412)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
2520 V
(27413)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
2610 V
(27414)210 648 A
(#include)336 1026 A
(<minix/boot.h>)588 1404 A
2700 V
(27415)210 648 A
(#include)336 1026 A
(<unistd.h>)420 1404 A
2790 V
(27416)210 648 A
(#include)336 1026 A
("buf.h")294 1404 A
2880 V
(27417)210 648 A
(#include)336 1026 A
("file.h")336 1404 A
2970 V
(27418)210 648 A
(#include)336 1026 A
("fproc.h")378 1404 A
3060 V
(27419)210 648 A
(#include)336 1026 A
("inode.h")378 1404 A
3150 V
(27420)210 648 A
(#include)336 1026 A
("param.h")378 1404 A
3240 V
(27421)210 648 A
3330 V
(27422)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(panicking;)420 1530 A
2370(/*)S
(inhibits)336 2496 A
(recursive)378 2874 A
(panics)252 3294 A
(during)252 3588 A
(sync)168 3882 A
4092(*/)S
3420 V
(27423)210 648 A
(PRIVATE)294 1026 A
(message)294 1362 A
(clock_mess;)462 1698 A
3510 V
(27424)210 648 A
3600 V
(27425)210 648 A
(/*===========================================================================*)3276 1026 A
3690 V
(27426)210 648 A
1068(*)S
(clock_time)420 2370 A
4260(*)S
3780 V
(27427)210 648 A
(*===========================================================================*/)3276 1068 A
3870 V
(27428)210 648 A
(PUBLIC)252 1026 A
(time_t)252 1320 A
(clock_time\(\))504 1614 A
3960 V
(27429)210 648 A
1026({)S
4050 V
(27430)210 648 A
1026(/*)S
(This)168 1152 A
(routine)294 1362 A
(returns)294 1698 A
(the)126 2034 A
(time)168 2202 A
2412(in)S
(seconds)294 2538 A
(since)210 2874 A
(1.1.1970.)378 3126 A
(MINIX)210 3588 A
3840(is)S
3966(an)S
4140 V
(27431)210 648 A
1068(*)S
(astrophysically)630 1152 A
(naive)210 1824 A
(system)252 2076 A
(that)168 2370 A
(assumes)294 2580 A
(the)126 2916 A
(earth)210 3084 A
(rotates)294 3336 A
3672(at)S
3798(a)S
(constant)336 3882 A
4230 V
(27432)210 648 A
1068(*)S
(rate)168 1152 A
(and)126 1362 A
(that)168 1530 A
(such)168 1740 A
(things)252 1950 A
2244(as)S
(leap)168 2370 A
(seconds)294 2580 A
2916(do)S
(not)126 3042 A
(exist.)252 3210 A
4320 V
(27433)210 648 A
1068(*/)S
4410 V
(27434)210 648 A
4500 V
(27435)210 648 A
(register)336 1110 A
(int)126 1488 A
1656(k;)S
4590 V
(27436)210 648 A
4680 V
(27437)210 648 A
(clock_mess.m_type)714 1110 A
1866(=)S
(GET_TIME;)378 1950 A
4770 V
(27438)210 648 A
1110(if)S
1236(\()S
1320(\(k)S
1446(=)S
(sendrec\(CLOCK,)588 1530 A
(&clock_mess\)\))546 2160 A
2748(!=)S
(OK\))126 2874 A
(panic\("clock_time)714 3042 A
(err",)210 3798 A
(k\);)126 4050 A
4860 V
(27439)210 648 A
4950 V
(27440)210 648 A
(return\()294 1110 A
(\(time_t\))336 1446 A
(clock_mess.NEW_TIME\);)882 1824 A
5040 V
(27441)210 648 A
1026(})S
5310 V
(27444)210 648 A
(/*===========================================================================*)3276 1026 A
5400 V
(27445)210 648 A
1068(*)S
(fetch_name)420 2370 A
4260(*)S
5490 V
(27446)210 648 A
(*===========================================================================*/)3276 1068 A
5580 V
(27447)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(fetch_name\(path,)672 1488 A
(len,)168 2202 A
(flag\))210 2412 A
5670 V
(27448)210 648 A
(char)168 1026 A
(*path;)252 1236 A
2370(/*)S
(pointer)294 2496 A
2832(to)S
(the)126 2958 A
(path)168 3126 A
3336(in)S
(user)168 3462 A
(space)210 3672 A
3924(*/)S
5760 V
(27449)210 648 A
(int)126 1026 A
(len;)168 1194 A
2370(/*)S
(path)168 2496 A
(length,)294 2706 A
(including)378 3042 A
3462(0)S
(byte)168 3546 A
3756(*/)S
5850 V
(27450)210 648 A
(int)126 1026 A
(flag;)210 1194 A
2370(/*)S
2496(M3)S
(means)210 2622 A
(path)168 2874 A
(may)126 3084 A
3252(be)S
3378(in)S
(message)294 3504 A
3840(*/)S
5940 V
(27451)210 648 A
1026({)S
6030 V
(27452)210 648 A
1026(/*)S
1152(Go)S
(get)126 1278 A
(path)168 1446 A
(and)126 1656 A
(put)126 1824 A
1992(it)S
2118(in)S
('user_path'.)504 2244 A
6120 V
(27453)210 648 A
1068(*)S
1152(If)S
('flag')252 1278 A
1572(=)S
1656(M3)S
(and)126 1782 A
('len')210 1950 A
2202(<=)S
(M3_STRING,)420 2328 A
(the)126 2790 A
(path)168 2958 A
3168(is)S
(present)294 3294 A
3630(in)S
('message'.)420 3756 A
6210 V
(27454)210 648 A
1068(*)S
1152(If)S
1278(it)S
1404(is)S
(not,)168 1530 A
1740(go)S
(copy)168 1866 A
2076(it)S
(from)168 2202 A
(user)168 2412 A
(space.)252 2622 A
8418 V
EP
%%Page: 379 379
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2114(File:)S
(src/fs/utility.c)615 2347 A
12 B
(379)180 4248 A
900 V
7 LST
(27455)210 648 A
1068(*/)S
990 V
(27456)210 648 A
1080 V
(27457)210 648 A
(register)336 1110 A
(char)168 1488 A
(*rpu,)210 1698 A
(*rpm;)210 1950 A
1170 V
(27458)210 648 A
(int)126 1110 A
1278(r;)S
1260 V
(27459)210 648 A
1350 V
(27460)210 648 A
1110(/*)S
(Check)210 1236 A
(name)168 1488 A
(length)252 1698 A
(for)126 1992 A
(validity.)378 2160 A
2580(*/)S
1440 V
(27461)210 648 A
1110(if)S
(\(len)168 1236 A
1446(<=)S
1572(0\))S
1698({)S
1530 V
(27462)210 648 A
(err_code)336 1362 A
1740(=)S
(EINVAL;)294 1824 A
1620 V
(27463)210 648 A
(return\(EGENERIC\);)714 1362 A
1710 V
(27464)210 648 A
1110(})S
1800 V
(27465)210 648 A
1890 V
(27466)210 648 A
1110(if)S
(\(len)168 1236 A
1446(>)S
(PATH_MAX\))378 1530 A
1950({)S
1980 V
(27467)210 648 A
(err_code)336 1362 A
1740(=)S
(ENAMETOOLONG;)546 1824 A
2070 V
(27468)210 648 A
(return\(EGENERIC\);)714 1362 A
2160 V
(27469)210 648 A
1110(})S
2250 V
(27470)210 648 A
2340 V
(27471)210 648 A
1110(if)S
(\(flag)210 1236 A
1488(==)S
1614(M3)S
1740(&&)S
(len)126 1866 A
2034(<=)S
(M3_STRING\))420 2160 A
2622({)S
2430 V
(27472)210 648 A
1362(/*)S
(Just)168 1488 A
(copy)168 1698 A
(the)126 1908 A
(path)168 2076 A
(from)168 2286 A
(the)126 2496 A
(message)294 2664 A
3000(to)S
('user_path'.)504 3126 A
3672(*/)S
2520 V
(27473)210 648 A
(rpu)126 1362 A
1530(=)S
(&user_path[0];)588 1614 A
2610 V
(27474)210 648 A
(rpm)126 1362 A
1530(=)S
(pathname;)378 1614 A
2370(/*)S
(contained)378 2496 A
2916(in)S
(input)210 3042 A
(message)294 3294 A
3630(*/)S
2700 V
(27475)210 648 A
1362(do)S
1488({)S
(*rpu++)252 1572 A
1866(=)S
(*rpm++;)294 1950 A
2286(})S
(while)210 2370 A
(\(--len\);)336 2622 A
2790 V
(27476)210 648 A
1362(r)S
1446(=)S
(OK;)126 1530 A
2880 V
(27477)210 648 A
1110(})S
(else)168 1194 A
1404({)S
2970 V
(27478)210 648 A
1362(/*)S
(String)252 1488 A
1782(is)S
(not)126 1908 A
(contained)378 2076 A
2496(in)S
(the)126 2622 A
(message.)336 2790 A
(Get)126 3210 A
3378(it)S
(from)168 3504 A
(user)168 3714 A
(space.)252 3924 A
4218(*/)S
3060 V
(27479)210 648 A
1362(r)S
1446(=)S
(sys_copy\(who,)546 1530 A
2118(D,)S
(\(phys_bytes\))504 2244 A
(path,)210 2790 A
3150 V
(27480)210 648 A
(FS_PROC_NR,)462 1698 A
2202(D,)S
(\(phys_bytes\))504 2328 A
(user_path,)420 2874 A
(\(phys_bytes\))504 3336 A
(len\);)210 3882 A
3240 V
(27481)210 648 A
1110(})S
3330 V
(27482)210 648 A
(return\(r\);)420 1110 A
3420 V
(27483)210 648 A
1026(})S
3690 V
(27486)210 648 A
(/*===========================================================================*)3276 1026 A
3780 V
(27487)210 648 A
1068(*)S
(no_sys)252 2370 A
4260(*)S
3870 V
(27488)210 648 A
(*===========================================================================*/)3276 1068 A
3960 V
(27489)210 648 A
(PUBLIC)252 1026 A
(int)126 1320 A
(no_sys\(\))336 1488 A
4050 V
(27490)210 648 A
1026({)S
4140 V
(27491)210 648 A
1026(/*)S
(Somebody)336 1152 A
(has)126 1530 A
(used)168 1698 A
1908(an)S
(illegal)294 2034 A
(system)252 2370 A
(call)168 2664 A
(number)252 2874 A
3168(*/)S
4230 V
(27492)210 648 A
4320 V
(27493)210 648 A
(return\(EINVAL\);)630 1110 A
4410 V
(27494)210 648 A
1026(})S
4680 V
(27497)210 648 A
(/*===========================================================================*)3276 1026 A
4770 V
(27498)210 648 A
1068(*)S
(panic)210 2370 A
4260(*)S
4860 V
(27499)210 648 A
(*===========================================================================*/)3276 1068 A
4950 V
(27500)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(panic\(format,)546 1530 A
(num\))168 2118 A
5040 V
(27501)210 648 A
(char)168 1026 A
(*format;)336 1236 A
2370(/*)S
(format)252 2496 A
(string)252 2790 A
3084(*/)S
5130 V
(27502)210 648 A
(int)126 1026 A
(num;)168 1194 A
2370(/*)S
(number)252 2496 A
2790(to)S
2916(go)S
(with)168 3042 A
(format)252 3252 A
(string)252 3546 A
3840(*/)S
5220 V
(27503)210 648 A
1026({)S
5310 V
(27504)210 648 A
1026(/*)S
(Something)378 1152 A
(awful)210 1572 A
(has)126 1824 A
(happened.)378 1992 A
(Panics)252 2454 A
(are)126 2748 A
(caused)252 2916 A
(when)168 3210 A
3420(an)S
(internal)336 3546 A
5400 V
(27505)210 648 A
1068(*)S
(inconsistency)546 1152 A
1740(is)S
(detected,)378 1866 A
(e.g.,)210 2286 A
2538(a)S
(programming)462 2622 A
(error)210 3126 A
3378(or)S
(illegal)294 3504 A
(value)210 3840 A
4092(of)S
4218(a)S
5490 V
(27506)210 648 A
1068(*)S
(defined)294 1152 A
(constant.)378 1488 A
5580 V
(27507)210 648 A
1068(*/)S
5670 V
(27508)210 648 A
5760 V
(27509)210 648 A
1110(if)S
(\(panicking\))462 1236 A
(return;)294 1740 A
2370(/*)S
2496(do)S
(not)126 2622 A
(panic)210 2790 A
(during)252 3042 A
3336(a)S
(sync)168 3420 A
3630(*/)S
5850 V
(27510)210 648 A
(panicking)378 1110 A
1530(=)S
(TRUE;)210 1614 A
2370(/*)S
(prevent)294 2496 A
(another)294 2832 A
(panic)210 3168 A
(during)252 3420 A
(the)126 3714 A
(sync)168 3882 A
4092(*/)S
5940 V
(27511)210 648 A
(printf\("File)504 1110 A
(system)252 1656 A
(panic:)252 1950 A
2244(%s)S
2370(",)S
(format\);)336 2496 A
6030 V
(27512)210 648 A
1110(if)S
(\(num)168 1236 A
1446(!=)S
(NO_NUM\))294 1572 A
(printf\("%d",num\);)714 1908 A
6120 V
(27513)210 648 A
(printf\("\\n"\);)546 1110 A
6210 V
(27514)210 648 A
(\(void\))252 1110 A
(do_sync\(\);)420 1404 A
2370(/*)S
(flush)210 2496 A
(everything)420 2748 A
3210(to)S
(the)126 3336 A
(disk)168 3504 A
3714(*/)S
8418 V
EP
%%Page: 380 380
BP
/slant 0 def
/height 0 def
630 V
12 B
(380)180 648 A
11 R
2114(File:)S
(src/fs/utility.c)615 2347 A
10 R
3402(MINIX)S
3730(SOURCE)S
4153(CODE)S
900 V
7 LST
(27515)210 648 A
(sys_abort\(RBT_PANIC\);)882 1110 A
990 V
(27516)210 648 A
1026(})S
1260 V
(27519)210 648 A
(/*===========================================================================*)3276 1026 A
1350 V
(27520)210 648 A
1068(*)S
(conv2)210 2370 A
4260(*)S
1440 V
(27521)210 648 A
(*===========================================================================*/)3276 1068 A
1530 V
(27522)210 648 A
(PUBLIC)252 1026 A
(unsigned)336 1320 A
(conv2\(norm,)462 1698 A
2202(w\))S
1620 V
(27523)210 648 A
(int)126 1026 A
(norm;)210 1194 A
2370(/*)S
(TRUE)168 2496 A
2706(if)S
2832(no)S
(swap,)210 2958 A
(FALSE)210 3210 A
(for)126 3462 A
(byte)168 3630 A
(swap)168 3840 A
4050(*/)S
1710 V
(27524)210 648 A
(int)126 1026 A
1194(w;)S
2370(/*)S
(promotion)378 2496 A
2916(of)S
(16-bit)252 3042 A
(word)168 3336 A
3546(to)S
3672(be)S
(swapped)294 3798 A
4134(*/)S
1800 V
(27525)210 648 A
1026({)S
1890 V
(27526)210 648 A
1026(/*)S
(Possibly)336 1152 A
(swap)168 1530 A
1740(a)S
(16-bit)252 1824 A
(word)168 2118 A
(between)294 2328 A
(8086)168 2664 A
(and)126 2874 A
(68000)210 3042 A
(byte)168 3294 A
(order.)252 3504 A
3798(*/)S
1980 V
(27527)210 648 A
2070 V
(27528)210 648 A
1110(if)S
(\(norm\))252 1236 A
(return\()294 1530 A
(\(unsigned\))420 1866 A
2328(w)S
2412(&)S
(0xFFFF\);)336 2496 A
2160 V
(27529)210 648 A
(return\()294 1110 A
(\(\(w&BYTE\))378 1446 A
1866(<<)S
1992(8\))S
2118(|)S
2202(\()S
(\(w>>8\))252 2286 A
2580(&)S
(BYTE\)\);)294 2664 A
2250 V
(27530)210 648 A
1026(})S
2520 V
(27533)210 648 A
(/*===========================================================================*)3276 1026 A
2610 V
(27534)210 648 A
1068(*)S
(conv4)210 2370 A
4260(*)S
2700 V
(27535)210 648 A
(*===========================================================================*/)3276 1068 A
2790 V
(27536)210 648 A
(PUBLIC)252 1026 A
(long)168 1320 A
(conv4\(norm,)462 1530 A
2034(x\))S
2880 V
(27537)210 648 A
(int)126 1026 A
(norm;)210 1194 A
2370(/*)S
(TRUE)168 2496 A
2706(if)S
2832(no)S
(swap,)210 2958 A
(FALSE)210 3210 A
(for)126 3462 A
(byte)168 3630 A
(swap)168 3840 A
4050(*/)S
2970 V
(27538)210 648 A
(long)168 1026 A
1236(x;)S
2370(/*)S
(32-bit)252 2496 A
(long)168 2790 A
3000(to)S
3126(be)S
(byte)168 3252 A
(swapped)294 3462 A
3798(*/)S
3060 V
(27539)210 648 A
1026({)S
3150 V
(27540)210 648 A
1026(/*)S
(Possibly)336 1152 A
(swap)168 1530 A
1740(a)S
(32-bit)252 1824 A
(long)168 2118 A
(between)294 2328 A
(8086)168 2664 A
(and)126 2874 A
(68000)210 3042 A
(byte)168 3294 A
(order.)252 3504 A
3798(*/)S
3240 V
(27541)210 648 A
3330 V
(27542)210 648 A
(unsigned)336 1110 A
(lo,)126 1488 A
(hi;)126 1656 A
3420 V
(27543)210 648 A
(long)168 1110 A
1320(l;)S
3510 V
(27544)210 648 A
3600 V
(27545)210 648 A
1110(if)S
(\(norm\))252 1236 A
(return\(x\);)420 1530 A
2706(/*)S
(byte)168 2832 A
(order)210 3042 A
(was)126 3294 A
(already)294 3462 A
3798(ok)S
3924(*/)S
3690 V
(27546)210 648 A
1110(lo)S
1236(=)S
(conv2\(FALSE,)504 1320 A
(\(int\))210 1866 A
2118(x)S
2202(&)S
(0xFFFF\);)336 2286 A
2706(/*)S
(low-order)378 2832 A
(half,)210 3252 A
(byte)168 3504 A
(swapped)294 3714 A
4050(*/)S
3780 V
(27547)210 648 A
1110(hi)S
1236(=)S
(conv2\(FALSE,)504 1320 A
(\(int\))210 1866 A
(\(x>>16\))294 2118 A
2454(&)S
(0xFFFF\);)336 2538 A
3042(/*)S
(high-order)420 3168 A
(half,)210 3630 A
(swapped)294 3882 A
4218(*/)S
3870 V
(27548)210 648 A
1110(l)S
1194(=)S
1278(\()S
(\(long\))252 1362 A
1656(lo)S
(<<16\))210 1782 A
2034(|)S
(hi;)126 2118 A
3960 V
(27549)210 648 A
(return\(l\);)420 1110 A
4050 V
(27550)210 648 A
1026(})S
4590 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4680 V
(src/fs/putk.c)546 2034 A
4770 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4950 V
(27600)210 648 A
1026(/*)S
1152(FS)S
(must)168 1278 A
(occasionally)504 1488 A
(print)210 2034 A
(some)168 2286 A
(message.)336 2496 A
2916(It)S
(uses)168 3042 A
(the)126 3252 A
(standard)336 3420 A
(library)294 3798 A
5040 V
(27601)210 648 A
1068(*)S
(routine)294 1152 A
(prink\(\).)336 1488 A
(\(The)168 1908 A
(name)168 2118 A
("printf")336 2328 A
2706(is)S
(really)252 2832 A
3126(a)S
(macro)210 3210 A
(defined)294 3462 A
3798(as)S
("printk"\).)420 3924 A
5130 V
(27602)210 648 A
1068(*)S
(Printing)336 1152 A
1530(is)S
(done)168 1656 A
1866(by)S
(calling)294 1992 A
(the)126 2328 A
(TTY)126 2496 A
(task)168 2664 A
(directly,)378 2874 A
(not)126 3294 A
(going)210 3462 A
(through)294 3714 A
(FS.)126 4050 A
5220 V
(27603)210 648 A
1068(*/)S
5310 V
(27604)210 648 A
5400 V
(27605)210 648 A
(#include)336 1026 A
("fs.h")252 1404 A
5490 V
(27606)210 648 A
(#include)336 1026 A
(<minix/com.h>)546 1404 A
5580 V
(27607)210 648 A
5670 V
(27608)210 648 A
(#define)294 1026 A
(BUF_SIZE)336 1362 A
(100)126 2118 A
2370(/*)S
(print)210 2496 A
(buffer)252 2748 A
(size)168 3042 A
3252(*/)S
5760 V
(27609)210 648 A
5850 V
(27610)210 648 A
(PRIVATE)294 1026 A
(int)126 1362 A
(buf_count;)420 1530 A
2370(/*)S
2496(#)S
(characters)420 2580 A
3042(in)S
(the)126 3168 A
(buffer)252 3336 A
3630(*/)S
5940 V
(27611)210 648 A
(PRIVATE)294 1026 A
(char)168 1362 A
(print_buf[BUF_SIZE];)840 1572 A
2706(/*)S
(output)252 2832 A
3126(is)S
(buffered)336 3252 A
(here)168 3630 A
3840(*/)S
6030 V
(27612)210 648 A
(PRIVATE)294 1026 A
(message)294 1362 A
(putch_msg;)420 1698 A
2370(/*)S
(used)168 2496 A
(for)126 2706 A
(message)294 2874 A
3210(to)S
(TTY)126 3336 A
(task)168 3504 A
3714(*/)S
6120 V
(27613)210 648 A
6210 V
(27614)210 648 A
(FORWARD)294 1026 A
(_PROTOTYPE\()462 1362 A
(void)168 1866 A
(flush,)252 2076 A
(\(void\))252 2370 A
4050(\);)S
8418 V
EP
%%Page: 381 381
BP
/slant 0 def
/height 0 def
630 V
10 R
648(MINIX)S
976(SOURCE)S
1399(CODE)S
11 R
2148(File:)S
2381(src/fs/putk.c)S
12 B
(381)180 4248 A
900 V
7 LST
(27615)210 648 A
990 V
(27616)210 648 A
(/*===========================================================================*)3276 1026 A
1080 V
(27617)210 648 A
1068(*)S
(putk)168 2370 A
4260(*)S
1170 V
(27618)210 648 A
(*===========================================================================*/)3276 1068 A
1260 V
(27619)210 648 A
(PUBLIC)252 1026 A
(void)168 1320 A
(putk\(c\))294 1530 A
1350 V
(27620)210 648 A
(int)126 1026 A
1194(c;)S
1440 V
(27621)210 648 A
1026({)S
1530 V
(27622)210 648 A
1026(/*)S
(Accumulate)420 1152 A
(another)294 1614 A
(character.)420 1950 A
2454(If)S
2580(0)S
2664(or)S
(buffer)252 2790 A
(full,)210 3084 A
(print)210 3336 A
(it.)126 3588 A
3756(*/)S
1620 V
(27623)210 648 A
1710 V
(27624)210 648 A
1110(if)S
1236(\(c)S
1362(==)S
1488(0)S
1572(||)S
(buf_count)378 1698 A
2118(==)S
(BUF_SIZE\))378 2244 A
(flush\(\);)336 2664 A
1800 V
(27625)210 648 A
1110(if)S
1236(\(c)S
1362(==)S
('\\n'\))210 1488 A
(putk\('\\r'\);)462 1740 A
1890 V
(27626)210 648 A
1110(if)S
1236(\(c)S
1362(!=)S
1488(0\))S
(print_buf[buf_count++])924 1614 A
2580(=)S
2664(c;)S
1980 V
(27627)210 648 A
1026(})S
2250 V
(27630)210 648 A
(/*===========================================================================*)3276 1026 A
2340 V
(27631)210 648 A
1068(*)S
(flush)210 2370 A
4260(*)S
2430 V
(27632)210 648 A
(*===========================================================================*/)3276 1068 A
2520 V
(27633)210 648 A
(PRIVATE)294 1026 A
(void)168 1362 A
(flush\(\))294 1572 A
2610 V
(27634)210 648 A
1026({)S
2700 V
(27635)210 648 A
1026(/*)S
(Flush)210 1152 A
(the)126 1404 A
(print)210 1572 A
(buffer)252 1824 A
2118(by)S
(calling)294 2244 A
(TTY)126 2580 A
(task.)210 2748 A
3000(*/)S
2790 V
(27636)210 648 A
2880 V
(27637)210 648 A
2970 V
(27638)210 648 A
1110(if)S
(\(buf_count)420 1236 A
1698(==)S
1824(0\))S
(return;)294 1950 A
3060 V
(27639)210 648 A
(putch_msg.m_type)672 1110 A
1824(=)S
(DEV_WRITE;)420 1908 A
3150 V
(27640)210 648 A
(putch_msg.PROC_NR)714 1110 A
1908(=)S
1992(1;)S
3240 V
(27641)210 648 A
(putch_msg.TTY_LINE)756 1110 A
1908(=)S
1992(0;)S
3330 V
(27642)210 648 A
(putch_msg.ADDRESS)714 1110 A
1908(=)S
(print_buf;)420 1992 A
3420 V
(27643)210 648 A
(putch_msg.COUNT)630 1110 A
1782(=)S
(buf_count;)420 1866 A
3510 V
(27644)210 648 A
(call_task\(TTY,)588 1110 A
(&putch_msg\);)504 1740 A
3600 V
(27645)210 648 A
(buf_count)378 1110 A
1530(=)S
1614(0;)S
3690 V
(27646)210 648 A
1026(})S
4140 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
4230 V
(./end_of_list)546 2034 A
4320 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3528 648 A
8418 V
EP
%%Trailer
%%DocumentFonts: Times-Roman Times-Bold LucidaSans-Typewriter
%%Pages: 381
